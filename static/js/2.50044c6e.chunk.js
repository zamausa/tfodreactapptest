/*! For license information please see 2.50044c6e.chunk.js.LICENSE.txt */
(this.webpackJsonpreactapptestausa=this.webpackJsonpreactapptestausa||[]).push([[2],[function(e,t,n){"use strict";n.d(t,"fc",(function(){return b.fc})),n.d(t,"gd",(function(){return b.gd})),n.d(t,"hd",(function(){return b.hd})),n.d(t,"qf",(function(){return b.qf})),n.d(t,"Cf",(function(){return b.Cf})),n.d(t,"rd",(function(){return b.rd})),n.d(t,"sd",(function(){return b.sd})),n.d(t,"td",(function(){return b.td})),n.d(t,"ud",(function(){return b.ud})),n.d(t,"vd",(function(){return b.vd})),n.d(t,"wd",(function(){return b.wd})),n.d(t,"xd",(function(){return b.xd})),n.d(t,"Ad",(function(){return b.Ad})),n.d(t,"Bd",(function(){return b.Bd})),n.d(t,"Cd",(function(){return b.Cd})),n.d(t,"Dd",(function(){return b.Dd})),n.d(t,"Gd",(function(){return b.Gd})),n.d(t,"Hd",(function(){return b.Hd})),n.d(t,"Id",(function(){return b.Id})),n.d(t,"Jd",(function(){return b.Jd})),n.d(t,"Kd",(function(){return b.Kd})),n.d(t,"Ld",(function(){return b.Ld})),n.d(t,"Md",(function(){return b.Md})),n.d(t,"Nd",(function(){return b.Nd})),n.d(t,"Od",(function(){return b.Od})),n.d(t,"Pd",(function(){return b.Pd})),n.d(t,"Qd",(function(){return b.Qd})),n.d(t,"Rd",(function(){return b.Rd})),n.d(t,"Sd",(function(){return b.Sd})),n.d(t,"Td",(function(){return b.Td})),n.d(t,"Ud",(function(){return b.Ud})),n.d(t,"Xd",(function(){return b.Xd})),n.d(t,"Zd",(function(){return b.Zd})),n.d(t,"ce",(function(){return b.ce})),n.d(t,"de",(function(){return b.de})),n.d(t,"ee",(function(){return b.ee})),n.d(t,"fe",(function(){return b.fe})),n.d(t,"ge",(function(){return b.ge})),n.d(t,"he",(function(){return b.he})),n.d(t,"je",(function(){return b.je})),n.d(t,"ke",(function(){return b.ke})),n.d(t,"le",(function(){return b.le})),n.d(t,"qe",(function(){return b.qe})),n.d(t,"se",(function(){return b.se})),n.d(t,"te",(function(){return b.te})),n.d(t,"ue",(function(){return b.ue})),n.d(t,"ve",(function(){return b.ve})),n.d(t,"we",(function(){return b.we})),n.d(t,"xe",(function(){return b.xe})),n.d(t,"ye",(function(){return b.ye})),n.d(t,"ze",(function(){return b.ze})),n.d(t,"Ae",(function(){return b.Ae})),n.d(t,"Be",(function(){return b.Be})),n.d(t,"De",(function(){return b.De})),n.d(t,"Ee",(function(){return b.Ee})),n.d(t,"Fe",(function(){return b.Fe})),n.d(t,"Ge",(function(){return b.Ge})),n.d(t,"Ie",(function(){return b.Ie})),n.d(t,"Je",(function(){return b.Je})),n.d(t,"Ke",(function(){return b.Ke})),n.d(t,"Le",(function(){return b.Le})),n.d(t,"Me",(function(){return b.Me})),n.d(t,"Ne",(function(){return b.Ne})),n.d(t,"Oe",(function(){return b.Oe})),n.d(t,"Pe",(function(){return b.Pe})),n.d(t,"Qe",(function(){return b.Qe})),n.d(t,"Te",(function(){return b.Te})),n.d(t,"Ue",(function(){return b.Ue})),n.d(t,"Ve",(function(){return b.Ve})),n.d(t,"We",(function(){return b.We})),n.d(t,"Xe",(function(){return b.Xe})),n.d(t,"Ye",(function(){return b.Ye})),n.d(t,"bf",(function(){return b.bf})),n.d(t,"cf",(function(){return b.cf})),n.d(t,"df",(function(){return b.df})),n.d(t,"ef",(function(){return b.ef})),n.d(t,"ff",(function(){return b.ff})),n.d(t,"gf",(function(){return b.gf})),n.d(t,"if",(function(){return b.if})),n.d(t,"jf",(function(){return b.jf})),n.d(t,"kf",(function(){return b.kf})),n.d(t,"lf",(function(){return b.lf})),n.d(t,"mf",(function(){return b.mf})),n.d(t,"nf",(function(){return b.nf})),n.d(t,"of",(function(){return b.of})),n.d(t,"pf",(function(){return b.pf})),n.d(t,"rf",(function(){return b.rf})),n.d(t,"sf",(function(){return b.sf})),n.d(t,"tf",(function(){return b.tf})),n.d(t,"uf",(function(){return b.uf})),n.d(t,"xf",(function(){return b.xf})),n.d(t,"Af",(function(){return b.Af})),n.d(t,"Bf",(function(){return b.Bf})),n.d(t,"Ef",(function(){return b.Ef})),n.d(t,"Hf",(function(){return b.Hf})),n.d(t,"If",(function(){return b.If})),n.d(t,"Jf",(function(){return b.Jf})),n.d(t,"zf",(function(){return b.zf})),n.d(t,"Yd",(function(){return b.Yd})),n.d(t,"me",(function(){return b.me})),n.d(t,"re",(function(){return b.re})),n.d(t,"ie",(function(){return b.ie})),n.d(t,"yf",(function(){return b.yf})),n.d(t,"ae",(function(){return b.ae})),n.d(t,"Ce",(function(){return b.Ce})),n.d(t,"wf",(function(){return b.wf})),n.d(t,"Wd",(function(){return b.Wd})),n.d(t,"oe",(function(){return b.oe})),n.d(t,"af",(function(){return b.af})),n.d(t,"Re",(function(){return b.Re})),n.d(t,"yd",(function(){return b.yd})),n.d(t,"Se",(function(){return b.Se})),n.d(t,"Ff",(function(){return b.Ff})),n.d(t,"be",(function(){return b.be})),n.d(t,"Gf",(function(){return b.Gf})),n.d(t,"He",(function(){return b.He})),n.d(t,"Fd",(function(){return b.Fd})),n.d(t,"ne",(function(){return b.ne})),n.d(t,"Ze",(function(){return b.Ze})),n.d(t,"Df",(function(){return b.Df})),n.d(t,"zd",(function(){return b.zd})),n.d(t,"Ed",(function(){return b.Ed})),n.d(t,"vf",(function(){return b.vf})),n.d(t,"hf",(function(){return b.hf})),n.d(t,"Vd",(function(){return b.Vd})),n.d(t,"pe",(function(){return b.pe})),n.d(t,"yb",(function(){return b.yb})),n.d(t,"N",(function(){return b.N})),n.d(t,"a",(function(){return b.a})),n.d(t,"b",(function(){return b.b})),n.d(t,"c",(function(){return b.c})),n.d(t,"d",(function(){return b.d})),n.d(t,"e",(function(){return b.e})),n.d(t,"f",(function(){return b.f})),n.d(t,"g",(function(){return b.g})),n.d(t,"h",(function(){return b.h})),n.d(t,"i",(function(){return b.i})),n.d(t,"j",(function(){return b.j})),n.d(t,"k",(function(){return b.k})),n.d(t,"l",(function(){return b.l})),n.d(t,"n",(function(){return b.n})),n.d(t,"m",(function(){return b.m})),n.d(t,"o",(function(){return b.o})),n.d(t,"r",(function(){return b.r})),n.d(t,"p",(function(){return b.p})),n.d(t,"q",(function(){return b.q})),n.d(t,"s",(function(){return b.s})),n.d(t,"t",(function(){return b.t})),n.d(t,"u",(function(){return b.u})),n.d(t,"v",(function(){return b.v})),n.d(t,"w",(function(){return b.w})),n.d(t,"x",(function(){return b.x})),n.d(t,"y",(function(){return b.y})),n.d(t,"z",(function(){return b.z})),n.d(t,"A",(function(){return b.A})),n.d(t,"B",(function(){return b.B})),n.d(t,"C",(function(){return b.C})),n.d(t,"D",(function(){return b.D})),n.d(t,"E",(function(){return b.E})),n.d(t,"F",(function(){return b.F})),n.d(t,"G",(function(){return b.G})),n.d(t,"H",(function(){return b.H})),n.d(t,"I",(function(){return b.I})),n.d(t,"J",(function(){return b.J})),n.d(t,"L",(function(){return b.L})),n.d(t,"M",(function(){return b.M})),n.d(t,"K",(function(){return b.K})),n.d(t,"O",(function(){return b.O})),n.d(t,"P",(function(){return b.P})),n.d(t,"Q",(function(){return b.Q})),n.d(t,"R",(function(){return b.R})),n.d(t,"S",(function(){return b.S})),n.d(t,"T",(function(){return b.T})),n.d(t,"U",(function(){return b.U})),n.d(t,"W",(function(){return b.W})),n.d(t,"V",(function(){return b.V})),n.d(t,"pc",(function(){return b.pc})),n.d(t,"X",(function(){return b.X})),n.d(t,"Y",(function(){return b.Y})),n.d(t,"Z",(function(){return b.Z})),n.d(t,"bb",(function(){return b.bb})),n.d(t,"ab",(function(){return b.ab})),n.d(t,"cb",(function(){return b.cb})),n.d(t,"db",(function(){return b.db})),n.d(t,"eb",(function(){return b.eb})),n.d(t,"fb",(function(){return b.fb})),n.d(t,"gb",(function(){return b.gb})),n.d(t,"hb",(function(){return b.hb})),n.d(t,"ib",(function(){return b.ib})),n.d(t,"jb",(function(){return b.jb})),n.d(t,"lb",(function(){return b.lb})),n.d(t,"pb",(function(){return b.pb})),n.d(t,"ob",(function(){return b.ob})),n.d(t,"qb",(function(){return b.qb})),n.d(t,"rb",(function(){return b.rb})),n.d(t,"tb",(function(){return b.tb})),n.d(t,"sb",(function(){return b.sb})),n.d(t,"ub",(function(){return b.ub})),n.d(t,"vb",(function(){return b.vb})),n.d(t,"wb",(function(){return b.wb})),n.d(t,"xb",(function(){return b.xb})),n.d(t,"Bb",(function(){return b.Bb})),n.d(t,"Cb",(function(){return b.Cb})),n.d(t,"Db",(function(){return b.Db})),n.d(t,"Eb",(function(){return b.Eb})),n.d(t,"Fb",(function(){return b.Fb})),n.d(t,"Gb",(function(){return b.Gb})),n.d(t,"Hb",(function(){return b.Hb})),n.d(t,"Ib",(function(){return b.Ib})),n.d(t,"Jb",(function(){return b.Jb})),n.d(t,"zb",(function(){return b.zb})),n.d(t,"Ab",(function(){return b.Ab})),n.d(t,"Kb",(function(){return b.Kb})),n.d(t,"Qb",(function(){return b.Qb})),n.d(t,"Lb",(function(){return b.Lb})),n.d(t,"Ob",(function(){return b.Ob})),n.d(t,"Mb",(function(){return b.Mb})),n.d(t,"Nb",(function(){return b.Nb})),n.d(t,"Pb",(function(){return b.Pb})),n.d(t,"Rb",(function(){return b.Rb})),n.d(t,"Sb",(function(){return b.Sb})),n.d(t,"Tb",(function(){return b.Tb})),n.d(t,"Ub",(function(){return b.Ub})),n.d(t,"Vb",(function(){return b.Vb})),n.d(t,"Wb",(function(){return b.Wb})),n.d(t,"Xb",(function(){return b.Xb})),n.d(t,"Yb",(function(){return b.Yb})),n.d(t,"cc",(function(){return b.cc})),n.d(t,"Zb",(function(){return b.Zb})),n.d(t,"ac",(function(){return b.ac})),n.d(t,"bc",(function(){return b.bc})),n.d(t,"ec",(function(){return b.ec})),n.d(t,"dc",(function(){return b.dc})),n.d(t,"gc",(function(){return b.gc})),n.d(t,"hc",(function(){return b.hc})),n.d(t,"ic",(function(){return b.ic})),n.d(t,"jc",(function(){return b.jc})),n.d(t,"kc",(function(){return b.kc})),n.d(t,"lc",(function(){return b.lc})),n.d(t,"mc",(function(){return b.mc})),n.d(t,"nc",(function(){return b.nc})),n.d(t,"oc",(function(){return b.oc})),n.d(t,"qc",(function(){return b.qc})),n.d(t,"rc",(function(){return b.rc})),n.d(t,"tc",(function(){return b.tc})),n.d(t,"wc",(function(){return b.wc})),n.d(t,"xc",(function(){return b.xc})),n.d(t,"uc",(function(){return b.uc})),n.d(t,"vc",(function(){return b.vc})),n.d(t,"sc",(function(){return b.sc})),n.d(t,"yc",(function(){return b.yc})),n.d(t,"Ac",(function(){return b.Ac})),n.d(t,"Bc",(function(){return b.Bc})),n.d(t,"Cc",(function(){return b.Cc})),n.d(t,"Dc",(function(){return b.Dc})),n.d(t,"Ec",(function(){return b.Ec})),n.d(t,"Fc",(function(){return b.Fc})),n.d(t,"Kc",(function(){return b.Kc})),n.d(t,"Ic",(function(){return b.Ic})),n.d(t,"Jc",(function(){return b.Jc})),n.d(t,"Hc",(function(){return b.Hc})),n.d(t,"Gc",(function(){return b.Gc})),n.d(t,"Mc",(function(){return b.Mc})),n.d(t,"Uc",(function(){return b.Uc})),n.d(t,"dd",(function(){return b.dd})),n.d(t,"Nc",(function(){return b.Nc})),n.d(t,"Tc",(function(){return b.Tc})),n.d(t,"Lc",(function(){return b.Lc})),n.d(t,"Oc",(function(){return b.Oc})),n.d(t,"Pc",(function(){return b.Pc})),n.d(t,"Qc",(function(){return b.Qc})),n.d(t,"Rc",(function(){return b.Rc})),n.d(t,"Sc",(function(){return b.Sc})),n.d(t,"Wc",(function(){return b.Wc})),n.d(t,"Vc",(function(){return b.Vc})),n.d(t,"Yc",(function(){return b.Yc})),n.d(t,"Zc",(function(){return b.Zc})),n.d(t,"ad",(function(){return b.ad})),n.d(t,"bd",(function(){return b.bd})),n.d(t,"cd",(function(){return b.cd})),n.d(t,"ed",(function(){return b.ed})),n.d(t,"fd",(function(){return b.fd})),n.d(t,"id",(function(){return b.id})),n.d(t,"jd",(function(){return b.jd})),n.d(t,"kd",(function(){return b.kd})),n.d(t,"ld",(function(){return b.ld})),n.d(t,"md",(function(){return b.md})),n.d(t,"nd",(function(){return b.nd})),n.d(t,"od",(function(){return b.od})),n.d(t,"pd",(function(){return b.pd})),n.d(t,"Xc",(function(){return b.Xc})),n.d(t,"kb",(function(){return b.kb})),n.d(t,"zc",(function(){return b.zc})),n.d(t,"qd",(function(){return b.qd})),n.d(t,"mb",(function(){return b.mb})),n.d(t,"nb",(function(){return b.nb}));var r=n(12),a=(n(145),n(2)),i=n(4),o=n(30),s=n(192),u=n(193),c=n(99),l=function(){function e(){Object(a.a)(this,e),this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}return Object(i.a)(e,[{key:"fetch",value:function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,t){return fetch(e,t)}))},{key:"now",value:function(){return performance.now()}},{key:"encode",value:function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Browser's encoder only supports utf-8, but got ".concat(t));return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}},{key:"decode",value:function(e,t){return new TextDecoder(t).decode(e)}},{key:"setTimeoutCustom",value:function(e,t){var n=this;window&&Object(o.b)().getBool("USE_SETTIMEOUTCUSTOM")?(this.functionRefs.push(e),setTimeout((function(){window.postMessage({name:n.messageName,index:n.functionRefs.length-1},"*")}),t),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",(function(e){e.source===window&&e.data.name===n.messageName&&(e.stopPropagation(),(0,n.functionRefs[e.data.index])(),n.handledMessageCount++,n.handledMessageCount===n.functionRefs.length&&(n.functionRefs=[],n.handledMessageCount=0))}),!0))):setTimeout(e,t)}}]),e}();if(Object(o.b)().get("IS_BROWSER")){Object(o.b)().setPlatform("browser",new l);try{c.a.registerManager(u.a.URL_SCHEME,new u.b)}catch(g){}try{c.a.registerManager(s.a.URL_SCHEME,new s.b)}catch(g){}}n(264);var d=n(59),p=n(22),f=n(79),h=n(154),m=n(13);Object(r.b)();var v={buffer:d.a,cast:p.a,clone:f.a,print:h.a};Object(m.f)(v);var b=n(149)},function(e,t,n){e.exports=n(260)},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(190);var a=n(110),i=n(191);function o(e,t){return Object(r.a)(e)||function(e,t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(u){a=!0,i=u}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}return n}}(e,t)||Object(a.a)(e,t)||Object(i.a)()}},function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}n.d(t,"a",(function(){return a}))},function(e,t,n){"use strict";n.d(t,"d",(function(){return i})),n.d(t,"e",(function(){return o})),n.d(t,"f",(function(){return s})),n.d(t,"b",(function(){return u})),n.d(t,"g",(function(){return l})),n.d(t,"c",(function(){return d})),n.d(t,"a",(function(){return p}));var r=n(3),a=n(0);function i(e,t,n,r,i){var s=t.inputParams[e];if(s&&void 0!==s.inputIndexStart){var u=s.inputIndexStart,c=0===s.inputIndexEnd?void 0:void 0===s.inputIndexEnd?u+1:s.inputIndexEnd;if("tensor"===s.type)return o(t.inputNames[s.inputIndexStart],n,r,i);if("tensors"===s.type)return t.inputNames.slice(u,c).map((function(e){return o(e,n,r,i)}));var l=o(t.inputNames.slice(u)[0],n,r,i),d=l.dataSync();return"number"===s.type?d[0]:a.Df.toNestedArray(l.shape,d)}var p=t.attrParams[e];return p&&p.value}function o(e,t,n,a){var i=l(e),o=Object(r.a)(i,2),s=o[0],u=o[1];if(null!=a){var d=a.getHashTableHandleByName(s);if(null!=d)return d}var p=n.currentContextIds.find((function(e){return!!t[c(s,e)]}));return void 0!==p?t[c(s,p)][u]:void 0}function s(e,t,n){return t[c(e,n.currentContextId)]}function u(e,t){var n=l(e),a=Object(r.a)(n,3),i=a[0],o=a[1],s=a[2];return[c(i,t&&t.currentContextId),o,s]}function c(e,t){return t?"".concat(e,"-").concat(t):e}function l(e){var t=e.split(":");if(1===t.length)return[e,0,void 0];var n=t[0],r=3===t.length?t[1]:void 0;return[n,Number(t[t.length-1]),r]}function d(e,t,n){var r=i("pad",e,t,n);if("explicit"===r){r=i("explicitPaddings",e,t,n);for(var a=[[0,0],[0,0],[0,0],[0,0]],o=0;o<4;o++)a[o][0]=r[2*o],a[o][1]=r[2*o+1];return a}return r}function p(e){return e.kept?e:Object(a.Jd)(e)}},function(e,t,n){"use strict";n.d(t,"c",(function(){return u})),n.d(t,"a",(function(){return l})),n.d(t,"b",(function(){return d}));var r=n(12),a=n(30),i=n(13),o=n(18),s=n(21);function u(e,t){var n=e;if(Object(o.A)(e))return"string"===t?[]:[e.length];if(!Array.isArray(e))return[];for(var r=[];Array.isArray(n)||Object(o.A)(n)&&"string"!==t;)r.push(n.length),n=n[0];return Array.isArray(e)&&Object(a.b)().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function e(t,n,r){if(r=r||[],!Array.isArray(t)&&!Object(o.A)(t))return void Object(o.b)(0===n.length,(function(){return"Element arr[".concat(r.join("]["),"] is a primitive, ")+"but should be an array/TypedArray of ".concat(n[0]," elements")}));Object(o.b)(n.length>0,(function(){return"Element arr[".concat(r.join("]["),"] should be a primitive, ")+"but is an array of ".concat(t.length," elements")})),Object(o.b)(t.length===n[0],(function(){return"Element arr[".concat(r.join("]["),"] should have ").concat(n[0]," ")+"elements, but has ".concat(t.length," elements")}));for(var a=n.slice(1),i=0;i<t.length;++i)e(t[i],a,r.concat(i))}(e,r,[]),r}function c(e,t,n,r){if("string_or_numeric"!==e){if(null==e)throw new Error("Expected dtype cannot be null.");if("numeric"!==e&&e!==t||"numeric"===e&&"string"===t)throw new Error("Argument '".concat(n,"' passed to '").concat(r,"' must ")+"be ".concat(e," tensor, but got ").concat(t," tensor"))}}function l(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"numeric";if(e instanceof i.a)return c(a,e.dtype,t,n),e;var l=Object(o.r)(e);if("string"!==l&&["bool","int32","float32"].indexOf(a)>=0&&(l=a),c(a,l,t,n),null==e||!Object(o.A)(e)&&!Array.isArray(e)&&"number"!==typeof e&&"boolean"!==typeof e&&"string"!==typeof e){var d=null==e?"null":e.constructor.name;throw new Error("Argument '".concat(t,"' passed to '").concat(n,"' must be a ")+"Tensor or TensorLike, but got '".concat(d,"'"))}var p=u(e,l);Object(o.A)(e)||Array.isArray(e)||(e=[e]);var f=!0,h="string"!==l?Object(s.toTypedArray)(e,l):Object(o.m)(e,[],f);return r.a.makeTensor(h,p,l)}function d(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"numeric";if(!Array.isArray(e))throw new Error("Argument ".concat(t," passed to ").concat(n," must be a ")+"`Tensor[]` or `TensorLike[]`");var a=e;return a.map((function(e,a){return l(e,"".concat(t,"[").concat(a,"]"),n,r)}))}},function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return i})),n.d(t,"d",(function(){return o})),n.d(t,"e",(function(){return s})),n.d(t,"f",(function(){return u})),n.d(t,"g",(function(){return c})),n.d(t,"h",(function(){return l})),n.d(t,"i",(function(){return d})),n.d(t,"j",(function(){return p})),n.d(t,"k",(function(){return f})),n.d(t,"l",(function(){return h})),n.d(t,"n",(function(){return m})),n.d(t,"m",(function(){return v})),n.d(t,"o",(function(){return b})),n.d(t,"r",(function(){return g})),n.d(t,"p",(function(){return y})),n.d(t,"q",(function(){return x})),n.d(t,"s",(function(){return k})),n.d(t,"t",(function(){return w})),n.d(t,"u",(function(){return O})),n.d(t,"w",(function(){return I})),n.d(t,"v",(function(){return S})),n.d(t,"x",(function(){return N})),n.d(t,"y",(function(){return j})),n.d(t,"z",(function(){return T})),n.d(t,"A",(function(){return C})),n.d(t,"B",(function(){return E})),n.d(t,"C",(function(){return _})),n.d(t,"D",(function(){return A})),n.d(t,"E",(function(){return R})),n.d(t,"F",(function(){return D})),n.d(t,"G",(function(){return F})),n.d(t,"H",(function(){return M})),n.d(t,"I",(function(){return z})),n.d(t,"J",(function(){return L})),n.d(t,"K",(function(){return P})),n.d(t,"M",(function(){return B})),n.d(t,"N",(function(){return W})),n.d(t,"L",(function(){return U})),n.d(t,"O",(function(){return V})),n.d(t,"P",(function(){return G})),n.d(t,"Q",(function(){return H})),n.d(t,"R",(function(){return q})),n.d(t,"S",(function(){return K})),n.d(t,"T",(function(){return X})),n.d(t,"U",(function(){return Y})),n.d(t,"W",(function(){return Z})),n.d(t,"V",(function(){return J})),n.d(t,"oc",(function(){return Q})),n.d(t,"X",(function(){return $})),n.d(t,"Y",(function(){return ee})),n.d(t,"Z",(function(){return te})),n.d(t,"bb",(function(){return ne})),n.d(t,"ab",(function(){return re})),n.d(t,"cb",(function(){return ae})),n.d(t,"db",(function(){return ie})),n.d(t,"eb",(function(){return oe})),n.d(t,"fb",(function(){return se})),n.d(t,"gb",(function(){return ue})),n.d(t,"hb",(function(){return ce})),n.d(t,"ib",(function(){return le})),n.d(t,"jb",(function(){return de})),n.d(t,"lb",(function(){return pe})),n.d(t,"pb",(function(){return fe})),n.d(t,"ob",(function(){return he})),n.d(t,"qb",(function(){return me})),n.d(t,"rb",(function(){return ve})),n.d(t,"tb",(function(){return be})),n.d(t,"sb",(function(){return ge})),n.d(t,"ub",(function(){return ye})),n.d(t,"vb",(function(){return xe})),n.d(t,"wb",(function(){return ke})),n.d(t,"xb",(function(){return we})),n.d(t,"Ab",(function(){return Oe})),n.d(t,"Bb",(function(){return Ie})),n.d(t,"Cb",(function(){return Se})),n.d(t,"Db",(function(){return Ne})),n.d(t,"Eb",(function(){return je})),n.d(t,"Fb",(function(){return Te})),n.d(t,"Hb",(function(){return Ce})),n.d(t,"Ib",(function(){return Ee})),n.d(t,"Jb",(function(){return _e})),n.d(t,"Gb",(function(){return Ae})),n.d(t,"yb",(function(){return Re})),n.d(t,"zb",(function(){return De})),n.d(t,"Kb",(function(){return Fe})),n.d(t,"Qb",(function(){return Me})),n.d(t,"Lb",(function(){return ze})),n.d(t,"Ob",(function(){return Le})),n.d(t,"Mb",(function(){return Pe})),n.d(t,"Nb",(function(){return Be})),n.d(t,"Pb",(function(){return We})),n.d(t,"Rb",(function(){return Ue})),n.d(t,"Sb",(function(){return Ve})),n.d(t,"Tb",(function(){return Ge})),n.d(t,"Ub",(function(){return He})),n.d(t,"Vb",(function(){return qe})),n.d(t,"Wb",(function(){return Ke})),n.d(t,"Xb",(function(){return Xe})),n.d(t,"Yb",(function(){return Ye})),n.d(t,"cc",(function(){return Ze})),n.d(t,"Zb",(function(){return Je})),n.d(t,"ac",(function(){return Qe})),n.d(t,"bc",(function(){return $e})),n.d(t,"ec",(function(){return et})),n.d(t,"dc",(function(){return tt})),n.d(t,"fc",(function(){return nt})),n.d(t,"gc",(function(){return rt})),n.d(t,"hc",(function(){return at})),n.d(t,"ic",(function(){return it})),n.d(t,"jc",(function(){return ot})),n.d(t,"kc",(function(){return st})),n.d(t,"lc",(function(){return ut})),n.d(t,"mc",(function(){return ct})),n.d(t,"nc",(function(){return lt})),n.d(t,"pc",(function(){return dt})),n.d(t,"qc",(function(){return pt})),n.d(t,"sc",(function(){return ft})),n.d(t,"vc",(function(){return ht})),n.d(t,"wc",(function(){return mt})),n.d(t,"tc",(function(){return vt})),n.d(t,"uc",(function(){return bt})),n.d(t,"rc",(function(){return gt})),n.d(t,"xc",(function(){return yt})),n.d(t,"zc",(function(){return xt})),n.d(t,"Ac",(function(){return kt})),n.d(t,"Bc",(function(){return wt})),n.d(t,"Cc",(function(){return Ot})),n.d(t,"Dc",(function(){return It})),n.d(t,"Ec",(function(){return St})),n.d(t,"Jc",(function(){return Nt})),n.d(t,"Hc",(function(){return jt})),n.d(t,"Ic",(function(){return Tt})),n.d(t,"Gc",(function(){return Ct})),n.d(t,"Fc",(function(){return Et})),n.d(t,"Lc",(function(){return _t})),n.d(t,"Tc",(function(){return At})),n.d(t,"cd",(function(){return Rt})),n.d(t,"Mc",(function(){return Dt})),n.d(t,"Sc",(function(){return Ft})),n.d(t,"Kc",(function(){return Mt})),n.d(t,"Nc",(function(){return zt})),n.d(t,"Oc",(function(){return Lt})),n.d(t,"Pc",(function(){return Pt})),n.d(t,"Qc",(function(){return Bt})),n.d(t,"Rc",(function(){return Wt})),n.d(t,"Vc",(function(){return Ut})),n.d(t,"Uc",(function(){return Vt})),n.d(t,"Xc",(function(){return Gt})),n.d(t,"Yc",(function(){return Ht})),n.d(t,"Zc",(function(){return qt})),n.d(t,"ad",(function(){return Kt})),n.d(t,"bd",(function(){return Xt})),n.d(t,"dd",(function(){return Yt})),n.d(t,"ed",(function(){return Zt})),n.d(t,"fd",(function(){return Jt})),n.d(t,"gd",(function(){return Qt})),n.d(t,"hd",(function(){return $t})),n.d(t,"id",(function(){return en})),n.d(t,"jd",(function(){return tn})),n.d(t,"kd",(function(){return nn})),n.d(t,"ld",(function(){return rn})),n.d(t,"md",(function(){return an})),n.d(t,"Wc",(function(){return on})),n.d(t,"kb",(function(){return sn})),n.d(t,"yc",(function(){return un})),n.d(t,"nd",(function(){return cn})),n.d(t,"mb",(function(){return ln})),n.d(t,"nb",(function(){return dn}));var r="Abs",a="Acos",i="Acosh",o="Add",s="AddN",u="All",c="Any",l="ArgMax",d="ArgMin",p="Asin",f="Asinh",h="Atan",m="Atanh",v="Atan2",b="AvgPool",g="AvgPoolGrad",y="AvgPool3D",x="AvgPool3DGrad",k="BatchMatMul",w="BatchToSpaceND",O="Bincount",I="BroadcastTo",S="BroadcastArgs",N="Cast",j="Ceil",T="ClipByValue",C="Complex",E="ComplexAbs",_="Concat",A="Conv2D",R="Conv2DBackpropFilter",D="Conv2DBackpropInput",F="Conv3D",M="Conv3DBackpropFilterV2",z="Conv3DBackpropInputV2",L="Cos",P="Cosh",B="Cumprod",W="Cumsum",U="CropAndResize",V="DenseBincount",G="DepthToSpace",H="DepthwiseConv2dNative",q="DepthwiseConv2dNativeBackpropFilter",K="DepthwiseConv2dNativeBackpropInput",X="Diag",Y="Dilation2D",Z="Dilation2DBackpropInput",J="Dilation2DBackpropFilter",Q="RealDiv",$="Einsum",ee="Elu",te="EluGrad",ne="Erf",re="Equal",ae="Exp",ie="ExpandDims",oe="Expm1",se="FFT",ue="Fill",ce="FlipLeftRight",le="Floor",de="FloorDiv",pe="FusedBatchNorm",fe="GatherV2",he="GatherNd",me="Greater",ve="GreaterEqual",be="Identity",ge="IFFT",ye="Imag",xe="IsFinite",ke="IsInf",we="IsNan",Oe="LeakyRelu",Ie="Less",Se="LessEqual",Ne="LinSpace",je="Log",Te="Log1p",Ce="LogicalAnd",Ee="LogicalNot",_e="LogicalOr",Ae="LogSoftmax",Re="LRN",De="LRNGrad",Fe="Max",Me="Maximum",ze="MaxPool",Le="MaxPoolGrad",Pe="MaxPool3D",Be="MaxPool3DGrad",We="MaxPoolWithArgmax",Ue="Mean",Ve="Min",Ge="Minimum",He="MirrorPad",qe="Mod",Ke="Multinomial",Xe="Multiply",Ye="Neg",Ze="NotEqual",Je="NonMaxSuppressionV3",Qe="NonMaxSuppressionV4",$e="NonMaxSuppressionV5",et="OnesLike",tt="OneHot",nt="Pack",rt="PadV2",at="Pow",it="Prelu",ot="Prod",st="RaggedGather",ut="RaggedTensorToTensor",ct="Range",lt="Real",dt="Reciprocal",pt="Relu",ft="Reshape",ht="ResizeNearestNeighbor",mt="ResizeNearestNeighborGrad",vt="ResizeBilinear",bt="ResizeBilinearGrad",gt="Relu6",yt="Reverse",xt="Round",kt="Rsqrt",wt="ScatterNd",Ot="SearchSorted",It="Select",St="Selu",Nt="Slice",jt="Sin",Tt="Sinh",Ct="Sign",Et="Sigmoid",_t="Softplus",At="Sqrt",Rt="Sum",Dt="SpaceToBatchND",Ft="SplitV",Mt="Softmax",zt="SparseFillEmptyRows",Lt="SparseReshape",Pt="SparseSegmentMean",Bt="SparseSegmentSum",Wt="SparseToDense",Ut="SquaredDifference",Vt="Square",Gt="StridedSlice",Ht="StringNGrams",qt="StringSplit",Kt="StringToHashBucketFast",Xt="Sub",Yt="Tan",Zt="Tanh",Jt="Tile",Qt="TopK",$t="Transform",en="Transpose",tn="Unique",nn="Unpack",rn="UnsortedSegmentSum",an="ZerosLike",on="Step",sn="FromPixels",un="RotateWithOffset",cn="_FusedMatMul",ln="FusedConv2D",dn="FusedDepthwiseConv2D"},function(e,t,n){"use strict";function r(e,t,n,r,a,i,o){try{var s=e[i](o),u=s.value}catch(c){return void n(c)}s.done?t(u):Promise.resolve(u).then(r,a)}function a(e){return function(){var t=this,n=arguments;return new Promise((function(a,i){var o=e.apply(t,n);function s(e){r(o,a,i,s,u,"next",e)}function u(e){r(o,a,i,s,u,"throw",e)}s(void 0)}))}}n.d(t,"a",(function(){return a}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return o}));var r=n(12),a=n(18),i="__op";function o(e){var t=Object.keys(e);if(1!==t.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+"".concat(t.length," keys."));var n=t[0],o=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n+=i;var s=function(){r.a.startScope(n);try{var e=o.apply(void 0,arguments);return Object(a.x)(e)&&console.error("Cannot return a Promise inside of tidy."),r.a.endScope(e),e}catch(t){throw r.a.endScope(null),t}};return Object.defineProperty(s,"name",{value:n,configurable:!0}),s}},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(139);function a(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Object(r.a)(e,t)}},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(19),a=n(189),i=n(41);function o(e){return function(){var t,n=Object(r.a)(e);if(Object(a.a)()){var o=Object(r.a)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return Object(i.a)(this,t)}}},function(e,t,n){"use strict";n.d(t,"b",(function(){return T})),n.d(t,"a",(function(){return C}));var r=n(14),a=n(15),i=n(1),o=n.n(i),s=n(8),u=n(2),c=n(4),l=n(146),d=n(30),p=n(116),f=n(7),h=n(73),m=n(85),v=n(21),b=n(18),g=function(){function e(t,n){Object(u.a)(this,e),this.backendTimer=t,this.logger=n,null==n&&(this.logger=new y)}return Object(c.a)(e,[{key:"profileKernel",value:function(e,t,n){var a,i,o=function(){a=n()},s=v.now();if(this.backendTimer.timerAvailable())i=this.backendTimer.time(o);else{o();var u,c=Object(r.a)(a);try{for(c.s();!(u=c.n()).done;){u.value.dataSync()}}catch(f){c.e(f)}finally{c.f()}i=Promise.resolve({kernelMs:v.now()-s})}if(Object(d.b)().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(var l=function(t){var n=a[t];n.data().then((function(t){!function(e,t,n){if("float32"!==t)return!1;for(var r=0;r<e.length;r++){var a=e[r];if(isNaN(a)||!isFinite(a))return console.warn("Found ".concat(a," in the result of '").concat(n,"'")),!0}}(t,n.dtype,e)}))},p=0;p<a.length;p++)l(p);return{kernelName:e,outputs:a,inputs:t,timeMs:i.then((function(e){return e.kernelMs})),extraInfo:i.then((function(e){return null!=e.getExtraProfileInfo?e.getExtraProfileInfo():""}))}}},{key:"logKernelProfile",value:function(e){var t=this,n=e.kernelName,r=e.outputs,a=e.timeMs,i=e.inputs,o=e.extraInfo;r.forEach((function(e){Promise.all([e.data(),a,o]).then((function(r){t.logger.logKernelProfile(n,e,r[0],r[1],i,r[2])}))}))}}]),e}();var y=function(){function e(){Object(u.a)(this,e)}return Object(c.a)(e,[{key:"logKernelProfile",value:function(e,t,n,r,a,i){var o="number"===typeof r?b.L("".concat(r,"ms"),9):r.error,s=b.L(e,25),u=t.rank,c=t.size,l=b.L(t.shape.toString(),14),d="";for(var p in a){var f=a[p];if(null!=f){var h=f.shape||t.shape,m=h.length;d+="".concat(p,": ").concat(m,"D ").concat(m>0?h:""," ")}}console.log("%c".concat(s,"\t%c").concat(o,"\t%c").concat(u,"D ").concat(l,"\t%c").concat(c,"\t%c").concat(d,"\t%c").concat(i),"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}]),e}();function x(e,t,n){for(var r={},a={},i=0;i<t.length;i++)r[t[i].id]=!0;for(var o=0;o<e.length;o++){var s=e[o],u=s.inputs;for(var c in u){for(var l=u[c],d=!1,p=0;p<t.length;p++)if(r[l.id]){s.outputs.forEach((function(e){return r[e.id]=!0})),d=!0,a[s.id]=!0;break}if(d)break}}var f={};f[n.id]=!0;for(var h={},m=e.length-1;m>=0;m--)for(var v=e[m],b=v.inputs,g=0;g<v.outputs.length;g++)if(f[v.outputs[g].id]){for(var y in b)f[b[y].id]=!0,h[v.id]=!0;break}for(var x=[],k=0;k<e.length;k++){var w=e[k];if(a[w.id]&&h[w.id]){var O={};for(var I in w.inputs){var S=w.inputs[I];r[S.id]&&(O[I]=S)}var N=Object.assign({},w);N.inputs=O,N.outputs=w.outputs,x.push(N)}}return x}function k(e,t,n,r){for(var a=function(a){var i=t[a],o=[];if(i.outputs.forEach((function(t){var n=e[t.id];null!=n?o.push(n):o.push(null)})),null==i.gradient)throw new Error("Cannot compute gradient: gradient function not found "+"for ".concat(i.kernelName,"."));var s=i.gradient(o),u=function(t){if(!(t in s))throw new Error("Cannot backprop through input ".concat(t,". ")+"Available gradients found: ".concat(Object.keys(s),"."));var a=n((function(){return s[t]()}));if("float32"!==a.dtype)throw new Error("Error in gradient for op ".concat(i.kernelName,". The gradient of input ")+"".concat(t," must have 'float32' dtype, but has '").concat(a.dtype,"'"));var o=i.inputs[t];if(!b.a(a.shape,o.shape))throw new Error("Error in gradient for op ".concat(i.kernelName,". The gradient of input ")+"'".concat(t,"' has shape '").concat(a.shape,"', which does not match ")+"the shape of the input '".concat(o.shape,"'"));if(null==e[o.id])e[o.id]=a;else{var u=e[o.id];e[o.id]=r(u,a),u.dispose()}};for(var c in i.inputs)u(c)},i=t.length-1;i>=0;i--)a(i)}var w=n(13),O=n(32);function I(e){return null!=e.kernelName}var S=function(){function e(){Object(u.a)(this,e),this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map((function(e){return e.name}))))}}}return Object(c.a)(e,[{key:"dispose",value:function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()}}]),e}(),N=function(){function e(t){Object(u.a)(this,e),this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new S}return Object(c.a)(e,[{key:"ready",value:function(){var e=Object(s.a)(o.a.mark((function e(){var t,n,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.pendingBackendInit){e.next=2;break}return e.abrupt("return",this.pendingBackendInit.then((function(){})));case 2:if(null==this.backendInstance){e.next=4;break}return e.abrupt("return");case 4:t=this.getSortedBackends(),n=0;case 6:if(!(n<t.length)){e.next=18;break}return r=t[n],e.next=10,this.initializeBackend(r).success;case 10:if(!e.sent){e.next=15;break}return e.next=14,this.setBackend(r);case 14:return e.abrupt("return");case 15:n++,e.next=6;break;case 18:throw new Error("Could not initialize any backends, all backend initializations failed.");case 19:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"backendNames",value:function(){return Object.keys(this.registryFactory)}},{key:"findBackend",value:function(e){if(!(e in this.registry)){if(!(e in this.registryFactory))return null;if(this.initializeBackend(e).asyncInit)return null}return this.registry[e]}},{key:"findBackendFactory",value:function(e){return e in this.registryFactory?this.registryFactory[e].factory:null}},{key:"registerBackend",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return e in this.registryFactory?(m.b("".concat(e," backend was already registered. ")+"Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)}},{key:"setBackend",value:function(){var e=Object(s.a)(o.a.mark((function e(t){var n,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=this.registryFactory[t]){e.next=2;break}throw new Error("Backend name '".concat(t,"' not found in registry"));case 2:if(this.backendName=t,null!=this.registry[t]){e.next=16;break}if(this.backendInstance=null,n=this.initializeBackend(t),r=n.success,!n.asyncInit){e.next=12;break}return e.next=9,r;case 9:e.t0=e.sent,e.next=13;break;case 12:e.t0=r;case 13:if(e.t0){e.next=16;break}return e.abrupt("return",!1);case 16:return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new g(this.backendInstance),e.abrupt("return",!0);case 20:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setupRegisteredKernels",value:function(){var e=this;Object(h.c)(this.backendName).forEach((function(t){null!=t.setupFunc&&t.setupFunc(e.backendInstance)}))}},{key:"disposeRegisteredKernels",value:function(e){var t=this;Object(h.c)(e).forEach((function(n){null!=n.disposeFunc&&n.disposeFunc(t.registry[e])}))}},{key:"initializeBackend",value:function(e){var t=this,n=this.registryFactory[e];if(null==n)throw new Error("Cannot initialize backend ".concat(e,", no registration found."));try{var r=n.factory();if(!r||r instanceof l.b||"function"!==typeof r.then)return this.registry[e]=r,{success:!0,asyncInit:!1};var a=++this.pendingBackendInitId,i=r.then((function(n){return!(a<t.pendingBackendInitId)&&(t.registry[e]=n,t.pendingBackendInit=null,!0)})).catch((function(n){return a<t.pendingBackendInitId||(t.pendingBackendInit=null,m.b("Initialization of backend ".concat(e," failed")),m.b(n.stack||n.message)),!1}));return this.pendingBackendInit=i,{success:i,asyncInit:!0}}catch(o){return m.b("Initialization of backend ".concat(e," failed")),m.b(o.stack||o.message),{success:!1,asyncInit:!1}}}},{key:"removeBackend",value:function(e){if(!(e in this.registryFactory))throw new Error("".concat(e," backend not found in registry"));this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}},{key:"getSortedBackends",value:function(){var e=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority}))}},{key:"initializeBackendsAndReturnBest",value:function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],r=this.initializeBackend(n),a=r.success,i=r.asyncInit;if(i||a)return{name:n,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}},{key:"moveData",value:function(e,t){var n=this.state.tensorInfo.get(t),r=n.backend,a=this.readSync(t),i=r.refCount(t);r.disposeData(t,!0),n.backend=e,e.move(t,a,n.shape,n.dtype,i),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}},{key:"tidy",value:function(e,t){var n,r=this,a=null;if(null==t){if("function"!==typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!==typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!==typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=e}return this.scopedRun((function(){return r.startScope(a)}),(function(){return r.endScope(n)}),(function(){return(n=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n}))}},{key:"scopedRun",value:function(e,t,n){e();try{var r=n();return t(),r}catch(a){throw t(),a}}},{key:"nextTensorId",value:function(){return e.nextTensorId++}},{key:"nextVariableId",value:function(){return e.nextVariableId++}},{key:"clone",value:function(e){var t=C.runKernel(f.tb,{x:e}),n={x:e};return this.addTapeNode(this.state.activeScope.name,n,[t],(function(e){return{x:function(){var t={x:e},n={dtype:"float32"};return C.runKernel(f.x,t,n)}}}),[],{}),t}},{key:"runKernel",value:function(e,t,n){if(null==this.backendName&&this.backend,!(null!=Object(h.b)(e,this.backendName)))throw new Error("Kernel '".concat(e,"' not registered for backend '").concat(this.backendName,"'"));return this.runKernelFunc({kernelName:e,inputs:t,attrs:n})}},{key:"shouldCheckForMemLeaks",value:function(){return this.ENV.getBool("IS_TEST")}},{key:"checkKernelForMemLeak",value:function(e,t,n){var r=this.backend.numDataIds(),a=0;n.forEach((function(e){a+="complex64"===e.dtype?3:1}));var i=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],o=r-t-a-i;if(o>0)throw new Error("Backend '".concat(this.backendName,"' has an internal memory leak ")+"(".concat(o," data ids) after running '").concat(e,"'"))}},{key:"runKernelFunc",value:function(e){var t,n,r,a=this,i=[],o=this.isTapeOn(),s=this.state.numBytes,u=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0),null==this.backendName&&this.backend;var c=I(e)?e.kernelName:null!=this.state.activeScope?this.state.activeScope.name:"";if(I(e)){var l=e.kernelName,d=e.inputs,p=e.attrs;null==this.backendName&&this.backend;var f=Object(h.b)(l,this.backendName);b.b(null!=f,(function(){return"Cannot find registered kernel '".concat(l,"' for backend '").concat(a.backendName,"'")})),n=function(){var e=a.backend.numDataIds();r=f.kernelFunc({inputs:d,attrs:p,backend:a.backend});var t=Array.isArray(r)?r:[r];a.shouldCheckForMemLeaks()&&a.checkKernelForMemLeak(l,e,t);var n=t.map((function(e){return null!=e.rank?e:a.makeTensorFromTensorInfo(e)}));if(o){var s=a.getTensorsForGradient(l,d,n);i=a.saveTensorsForBackwardMode(s)}return n}}else{var m=e.forwardFunc,v=function(e){o&&(i=e.map((function(e){return a.keep(a.clone(e))})))};n=function(){var e=a.backend.numDataIds();r=a.tidy((function(){return m(a.backend,v)}));var t=Array.isArray(r)?r:[r];return a.shouldCheckForMemLeaks()&&a.checkKernelForMemLeak(c,e,t),t}}var g,y=e.inputs,x=e.attrs,k=I(e)?null:e.backwardsFunc;return this.scopedRun((function(){return a.state.kernelDepth++}),(function(){return a.state.kernelDepth--}),(function(){a.ENV.getBool("DEBUG")||a.state.profiling?(g=a.profiler.profileKernel(c,y,(function(){return n()})),a.ENV.getBool("DEBUG")&&a.profiler.logKernelProfile(g),t=g.outputs):t=n()})),o&&this.addTapeNode(c,y,t,k,i,x),this.state.profiling&&this.state.activeProfile.kernels.push({name:c,bytesAdded:this.state.numBytes-s,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-u,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(y).map((function(e){return null!=y[e]?y[e].shape:null})),outputShapes:t.map((function(e){return e.shape})),kernelTimeMs:g.timeMs,extraInfo:g.extraInfo}),Array.isArray(r)?t:t[0]}},{key:"saveTensorsForBackwardMode",value:function(e){var t=this;return e.map((function(e){return t.keep(t.clone(e))}))}},{key:"getTensorsForGradient",value:function(e,t,n){var r=Object(h.a)(e);if(null!=r){var a,i=r.inputsToSave||[],o=r.outputsToSave||[];r.saveAllInputs?(b.b(Array.isArray(t),(function(){return"saveAllInputs is true, expected inputs to be an array."})),a=Object.keys(t).map((function(e){return t[e]}))):a=i.map((function(e){return t[e]}));var s=n.filter((function(e,t){return o[t]}));return a.concat(s)}return[]}},{key:"makeTensor",value:function(e,t,n,r){if(null==e)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;var a=e;"string"===n&&b.z(e[0])&&(a=e.map((function(e){return v.encodeString(e)})));var i=r.write(a,t,n),o=new w.a(t,n,i,this.nextTensorId());if(this.trackTensor(o,r),"string"===n){var s=this.state.tensorInfo.get(i),u=Object(b.f)(a);this.state.numBytes+=u-s.bytes,s.bytes=u}return o}},{key:"makeTensorFromDataId",value:function(e,t,n,r){var a={dataId:e,shape:t,dtype:n=n||"float32"};return this.makeTensorFromTensorInfo(a,r)}},{key:"makeTensorFromTensorInfo",value:function(e,t){var n=e.dataId,r=e.shape,a=e.dtype,i=new w.a(r,a,n,this.nextTensorId());return this.trackTensor(i,t),i}},{key:"makeVariable",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;n=n||this.nextVariableId().toString(),null!=r&&r!==e.dtype&&(e=e.cast(r));var a=new w.c(e,t,n,this.nextTensorId());if(null!=this.state.registeredVariables[a.name])throw new Error("Variable with name ".concat(a.name," was already registered"));return this.state.registeredVariables[a.name]=a,this.incRef(a,this.backend),a}},{key:"trackTensor",value:function(e,t){this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++;var n=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(n=e.size*b.g(e.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:n})),e instanceof w.c||this.track(e)}},{key:"incRef",value:function(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}},{key:"removeDataId",value:function(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}},{key:"disposeTensor",value:function(e){if(this.state.tensorInfo.has(e.dataId)){var t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,"string"===e.dtype&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),"complex64"!==e.dtype&&"string"!==e.dtype){var n=e.size*b.g(e.dtype);this.state.numBytes-=n}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}}},{key:"disposeVariables",value:function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}}},{key:"disposeVariable",value:function(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]}},{key:"memory",value:function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}},{key:"profile",value:function(){var e=Object(s.a)(o.a.mark((function e(t){var n,i,s,u,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.state.profiling=!0,n=this.state.numBytes,i=this.state.numTensors,this.state.activeProfile.kernels=[],e.next=6,t();case 6:this.state.activeProfile.result=e.sent,this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,Object(a.a)(this.state.activeProfile.kernels.map((function(e){return e.totalBytesSnapshot})))),this.state.activeProfile.newBytes=this.state.numBytes-n,this.state.activeProfile.newTensors=this.state.numTensors-i,s=Object(r.a)(this.state.activeProfile.kernels),e.prev=12,s.s();case 14:if((u=s.n()).done){e.next=24;break}return c=u.value,e.next=18,c.kernelTimeMs;case 18:return c.kernelTimeMs=e.sent,e.next=21,c.extraInfo;case 21:c.extraInfo=e.sent;case 22:e.next=14;break;case 24:e.next=29;break;case 26:e.prev=26,e.t0=e.catch(12),s.e(e.t0);case 29:return e.prev=29,s.f(),e.finish(29);case 32:return e.abrupt("return",this.state.activeProfile);case 33:case"end":return e.stop()}}),e,this,[[12,26,29,32]])})));return function(t){return e.apply(this,arguments)}}()},{key:"isTapeOn",value:function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth}},{key:"addTapeNode",value:function(e,t,n,r,a,i){var o=this,s={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:a},u=Object(h.a)(e);null!=u&&(r=u.gradFunc),null!=r&&(s.gradient=function(e){return e=e.map((function(e,t){if(null==e){var r=n[t],a=b.F(r.size,r.dtype);return o.makeTensor(a,r.shape,r.dtype)}return e})),r(e.length>1?e:e[0],a,i)}),this.state.activeTape.push(s)}},{key:"keep",value:function(e){return e.kept=!0,e}},{key:"startTape",value:function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++}},{key:"endTape",value:function(){this.state.gradientDepth--}},{key:"startScope",value:function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}},{key:"endScope",value:function(e){for(var t=this,n=Object(O.getTensorsInContainer)(e),r=new Set(n.map((function(e){return e.id}))),a=0;a<this.state.activeScope.track.length;a++){var i=this.state.activeScope.track[a];i.kept||r.has(i.id)||i.dispose()}var o=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach((function(e){e.kept||e.scopeId!==o.id||t.track(e)}))}},{key:"gradients",value:function(e,t,n){var a=this,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(b.b(t.length>0,(function(){return"gradients() received an empty list of xs."})),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '".concat(n.dtype,"'"));var o=this.scopedRun((function(){return a.startTape()}),(function(){return a.endTape()}),(function(){return a.tidy("forward",e)}));b.b(o instanceof w.a,(function(){return"The result y returned by f() must be a tensor."}));var s=x(this.state.activeTape,t,o);if(!i&&0===s.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(function(){var e={};e[o.id]=null==n?j(o.shape):n,k(e,s,(function(e){return a.tidy(e)}),E);var i=t.map((function(t){return e[t.id]}));return 0===a.state.gradientDepth&&(a.state.activeTape.forEach((function(e){var t,n=Object(r.a)(e.saved);try{for(n.s();!(t=n.n()).done;){t.value.dispose()}}catch(a){n.e(a)}finally{n.f()}})),a.state.activeTape=null),{value:o,grads:i}}))}},{key:"customGrad",value:function(e){var t=this;return b.b(b.u(e),(function(){return"The f passed in customGrad(f) must be a function."})),function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];var i;b.b(r.every((function(e){return e instanceof w.a})),(function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"}));var o={};r.forEach((function(e,t){o[t]=e}));var s=function(t,n){return i=e.apply(void 0,[].concat(r,[n])),b.b(i.value instanceof w.a,(function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"})),b.b(b.u(i.gradFunc),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."})),i.value},u=function(e,t){var n=i.gradFunc(e,t),a=Array.isArray(n)?n:[n];b.b(a.length===r.length,(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."})),b.b(a.every((function(e){return e instanceof w.a})),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."}));var o={};return a.forEach((function(e,t){o[t]=function(){return e}})),o};return t.runKernelFunc({forwardFunc:s,backwardsFunc:u,inputs:o})}}},{key:"readSync",value:function(e){return this.state.tensorInfo.get(e).backend.readSync(e)}},{key:"read",value:function(e){return this.state.tensorInfo.get(e).backend.read(e)}},{key:"readToGPU",value:function(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}},{key:"time",value:function(){var e=Object(s.a)(o.a.mark((function e(t){var n,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object(v.now)(),e.next=3,this.backend.time(t);case 3:return(r=e.sent).wallMs=Object(v.now)()-n,e.abrupt("return",r);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"track",value:function(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}},{key:"reset",value:function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new S,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}},{key:"backend",get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '".concat(this.backendName,"' has not yet been initialized. Make ")+"sure to await tf.ready() or await tf.setBackend() before calling other methods");if(null==this.backendInstance){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '".concat(t,"' has not yet been ")+"initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance}},{key:"registeredVariables",get:function(){return this.state.registeredVariables}}]),e}();function j(e){var t=Object(b.D)(Object(b.O)(e),"float32");return C.makeTensor(t,e,"float32")}function T(){var e=Object(p.b)();if(null==e._tfengine){var t=new d.a(e);e._tfengine=new N(t)}return Object(d.c)(e._tfengine.ENV),Object(w.g)((function(){return e._tfengine})),e._tfengine}N.nextTensorId=0,N.nextVariableId=0;var C=T();function E(e,t){var n={a:e,b:t};return C.runKernel(f.d,n)}},function(e,t,n){"use strict";n.d(t,"b",(function(){return g})),n.d(t,"g",(function(){return k})),n.d(t,"f",(function(){return w})),n.d(t,"e",(function(){return O})),n.d(t,"a",(function(){return I})),n.d(t,"d",(function(){return S})),n.d(t,"c",(function(){return N}));var r=n(10),a=n(11),i=n(1),o=n.n(i),s=n(8),u=n(2),c=n(4),l=n(116),d=n(15),p=n(18);function f(e,t,n,r){var a=Object(p.j)(t),i=function(e,t,n,r){var a=Object(p.O)(t),i=r[r.length-1],o=new Array(i).fill(0),s=t.length,u="complex64"===n?v(e):e;if(s>1)for(var c=0;c<a/i;c++)for(var l=c*i,d=0;d<i;d++)o[d]=Math.max(o[d],h(u[l+d],0,n).length);return o}(e,t,n,a),o=t.length,s=function e(t,n,r,a,i){var o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],s="complex64"===r?2:1,u=n[0],c=n.length;if(0===c){if("complex64"===r){var l=v(t);return[h(l[0],0,r)]}return"bool"===r?[m(t[0])]:[t[0].toString()]}if(1===c){if(u>20){var p=3*s,f=Array.from(t.slice(0,p)),b=Array.from(t.slice((u-3)*s,u*s));return"complex64"===r&&(f=v(f),b=v(b)),["["+f.map((function(e,t){return h(e,i[t],r)})).join(", ")+", ..., "+b.map((function(e,t){return h(e,i[u-3+t],r)})).join(", ")+"]"]}var g="complex64"===r?v(t):Array.from(t);return["["+g.map((function(e,t){return h(e,i[t],r)})).join(", ")+"]"]}var y=n.slice(1),x=a.slice(1),k=a[0]*s,w=[];if(u>20){for(var O=0;O<3;O++){var I=O*k,S=I+k;w.push.apply(w,Object(d.a)(e(t.slice(I,S),y,r,x,i,!1)))}w.push("...");for(var N=u-3;N<u;N++){var j=N*k,T=j+k;w.push.apply(w,Object(d.a)(e(t.slice(j,T),y,r,x,i,N===u-1)))}}else for(var C=0;C<u;C++){var E=C*k,_=E+k;w.push.apply(w,Object(d.a)(e(t.slice(E,_),y,r,x,i,C===u-1)))}var A=2===c?",":"";w[0]="["+w[0]+A;for(var R=1;R<w.length-1;R++)w[R]=" "+w[R]+A;for(var D=",\n",F=2;F<c;F++)D+="\n";return w[w.length-1]=" "+w[w.length-1]+"]"+(o?"":D),w}(e,t,n,a,i),u=["Tensor"];return r&&(u.push("  dtype: ".concat(n)),u.push("  rank: ".concat(o)),u.push("  shape: [".concat(t,"]")),u.push("  values:")),u.push(s.map((function(e){return"    "+e})).join("\n")),u.join("\n")}function h(e,t,n){var r;return r=Array.isArray(e)?"".concat(parseFloat(e[0].toFixed(7))," + ")+"".concat(parseFloat(e[1].toFixed(7)),"j"):Object(p.z)(e)?"'".concat(e,"'"):"bool"===n?m(e):parseFloat(e.toFixed(7)).toString(),Object(p.L)(r,t)}function m(e){return 0===e?"false":"true"}function v(e){for(var t=[],n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}var b=n(21),g=function(){function e(t,n,r){var a=this;if(Object(u.a)(this,e),this.dtype=n,this.shape=t.slice(),this.size=p.O(t),null!=r){var i=r.length;p.b(i===this.size,(function(){return"Length of values '".concat(i,"' does not match the size ")+"inferred by the shape '".concat(a.size,"'.")}))}if("complex64"===n)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||p.n(n,this.size),this.strides=Object(p.j)(t)}return Object(c.a)(e,[{key:"set",value:function(e){for(var t=this,n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];0===r.length&&(r=[0]),p.b(r.length===this.rank,(function(){return"The number of provided coordinates (".concat(r.length,") must ")+"match the rank (".concat(t.rank,")")}));var i=this.locToIndex(r);this.values[i]=e}},{key:"get",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];0===t.length&&(t=[0]);for(var r=0,a=0,i=t;a<i.length;a++){var o=i[a];if(o<0||o>=this.shape[r]){var s="Requested out of range element at ".concat(t,". ")+"  Buffer shape=".concat(this.shape);throw new Error(s)}r++}for(var u=t[t.length-1],c=0;c<t.length-1;++c)u+=this.strides[c]*t[c];return this.values[u]}},{key:"locToIndex",value:function(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t}},{key:"indexToLoc",value:function(e){if(0===this.rank)return[];if(1===this.rank)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t}},{key:"toTensor",value:function(){return y().makeTensor(this.values,this.shape,this.dtype)}},{key:"rank",get:function(){return this.shape.length}}]),e}(),y=null,x=null;function k(e){y=e}function w(e){x=e}function O(e){e}var I=function(){function e(t,n,r,a){Object(u.a)(this,e),this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=n||"float32",this.size=p.O(t),this.strides=Object(p.j)(t),this.dataId=r,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}return Object(c.a)(e,[{key:"buffer",value:function(){var e=Object(s.a)(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data();case 2:return t=e.sent,e.abrupt("return",x.buffer(this.shape,this.dtype,t));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"bufferSync",value:function(){return x.buffer(this.shape,this.dtype,this.dataSync())}},{key:"array",value:function(){var e=Object(s.a)(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data();case 2:return t=e.sent,e.abrupt("return",Object(p.U)(this.shape,t,"complex64"===this.dtype));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"arraySync",value:function(){return Object(p.U)(this.shape,this.dataSync(),"complex64"===this.dtype)}},{key:"data",value:function(){var e=Object(s.a)(o.a.mark((function e(){var t,n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.throwIfDisposed(),t=y().read(this.dataId),"string"!==this.dtype){e.next=13;break}return e.next=5,t;case 5:return n=e.sent,e.prev=6,e.abrupt("return",n.map((function(e){return b.decodeString(e)})));case 10:throw e.prev=10,e.t0=e.catch(6),new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().");case 13:return e.abrupt("return",t);case 14:case"end":return e.stop()}}),e,this,[[6,10]])})));return function(){return e.apply(this,arguments)}}()},{key:"dataToGPU",value:function(e){return this.throwIfDisposed(),y().readToGPU(this.dataId,e)}},{key:"dataSync",value:function(){this.throwIfDisposed();var e=y().readSync(this.dataId);if("string"===this.dtype)try{return e.map((function(e){return b.decodeString(e)}))}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}},{key:"bytes",value:function(){var e=Object(s.a)(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.throwIfDisposed(),e.next=3,y().read(this.dataId);case 3:if(t=e.sent,"string"!==this.dtype){e.next=8;break}return e.abrupt("return",t);case 8:return e.abrupt("return",new Uint8Array(t.buffer));case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"dispose",value:function(){this.isDisposed||(y().disposeTensor(this),this.isDisposedInternal=!0)}},{key:"throwIfDisposed",value:function(){if(this.isDisposed)throw new Error("Tensor is disposed.")}},{key:"print",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return x.print(this,e)}},{key:"clone",value:function(){return this.throwIfDisposed(),x.clone(this)}},{key:"toString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.dataSync();return f(t,this.shape,this.dtype,e)}},{key:"cast",value:function(e){return this.throwIfDisposed(),x.cast(this,e)}},{key:"variable",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;return this.throwIfDisposed(),y().makeVariable(this,e,t,n)}},{key:"rank",get:function(){return this.shape.length}},{key:"isDisposed",get:function(){return this.isDisposedInternal}}]),e}();function S(){return Object(l.a)("Tensor",(function(){return I}))}Object.defineProperty(I,Symbol.hasInstance,{value:function(e){return!!e&&null!=e.data&&null!=e.dataSync&&null!=e.throwIfDisposed}}),S();var N=function(e){Object(r.a)(n,e);var t=Object(a.a)(n);function n(e,r,a,i){var o;return Object(u.a)(this,n),(o=t.call(this,e.shape,e.dtype,e.dataId,i)).trainable=r,o.name=a,o}return Object(c.a)(n,[{key:"assign",value:function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value (".concat(e.dtype,") and ")+"previous value (".concat(this.dtype,") must match"));if(!p.a(e.shape,this.shape))throw new Error("shape of the new value (".concat(e.shape,") and ")+"previous value (".concat(this.shape,") must match"));y().disposeTensor(this),this.dataId=e.dataId,y().incRef(this,null)}},{key:"dispose",value:function(){y().disposeVariable(this),this.isDisposedInternal=!0}}]),n}(I);Object.defineProperty(N,Symbol.hasInstance,{value:function(e){return e instanceof I&&null!=e.assign&&e.assign instanceof Function}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(110);function a(e){if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=Object(r.a)(e))){var t=0,n=function(){};return{s:n,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i,o=!0,s=!1;return{s:function(){a=e[Symbol.iterator]()},n:function(){var e=a.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==a.return||a.return()}finally{if(s)throw i}}}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(150);var a=n(188),i=n(110);function o(e){return function(e){if(Array.isArray(e))return Object(r.a)(e)}(e)||Object(a.a)(e)||Object(i.a)(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(7),i=n(6),o=n(9);var s=Object(o.b)({reshape_:function(e,t){var n={x:Object(i.a)(e,"x","reshape","string_or_numeric")},o={shape:t};return r.a.runKernel(a.sc,n,o)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(3),a=n(12),i=n(7),o=n(32),s=n(6),u=n(9);var c=Object(u.b)({mul_:function(e,t){var n=Object(s.a)(e,"a","mul"),u=Object(s.a)(t,"b","mul"),c=Object(o.makeTypesMatch)(n,u),l=Object(r.a)(c,2),d={a:n=l[0],b:u=l[1]};return a.a.runKernel(i.Xb,d)}})},function(e,t,n){"use strict";function r(e){for(var t=e.length,n=0;t>0;)n=Math.random()*t|0,s(e,--t,n)}function a(e,t){if(e.length!==t.length)throw new Error("Array sizes must match to be shuffled together "+"First array length was ".concat(e.length)+"Second array length was ".concat(t.length));for(var n=e.length,r=0;n>0;)r=Math.random()*n|0,s(e,--n,r),s(t,n,r)}function i(e,t,n){return Math.max(e,Math.min(t,n))}function o(e){return e%2===0?e:e+1}function s(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function u(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t}function c(e,t){var n=Math.random();return t*n+(1-n)*e}function l(e,t){for(var n=0,r=0;r<e.length;r++){var a=Number(e[r])-Number(t[r]);n+=a*a}return n}function d(e,t){if(!e)throw new Error("string"===typeof t?t:t())}function p(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";d(b(e,t),(function(){return n+" Shapes ".concat(e," and ").concat(t," must match")}))}function f(e){d(null!=e,(function(){return"The input to the tensor constructor must be a non-null value."}))}function h(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==t&&(t=[]),Array.isArray(e)||A(e)&&!n)for(var r=0;r<e.length;++r)h(e[r],t,n);else t.push(e);return t}function m(e){if(0===e.length)return 1;for(var t=e[0],n=1;n<e.length;n++)t*=e[n];return t}function v(e){return 0===e.length}function b(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function g(e){return e%1===0}function y(e){if(null!=Math.tanh)return Math.tanh(e);if(e===1/0)return 1;if(e===-1/0)return-1;var t=Math.exp(2*e);return(t-1)/(t+1)}function x(e){var t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function k(e){for(var t=new Uint32Array(e),n=0;n<e;++n)t[n]=n;return r(t),t}function w(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function O(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return 0},n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:setTimeout;return new Promise((function(a,i){var o=0;!function s(){if(e())a();else{o++;var u=t(o);null!=n&&o>=n?i():r(s,u)}}()}))}function I(e,t){for(var n=1,r=-1,a=0;a<e.length;++a)if(e[a]>=0)n*=e[a];else if(-1===e[a]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. "+"Found -1 at dim ".concat(r," and dim ").concat(a));r=a}else if(e[a]<0)throw Error("Shapes can not be < 0. Found ".concat(e[a]," at dim ").concat(a));if(-1===r){if(t>0&&t!==n)throw Error("Size(".concat(t,") must match the product of shape ").concat(e));return e}if(0===n)throw Error("Cannot infer the missing size in [".concat(e,"] when ")+"there are 0 elements");if(t%n!==0)throw Error("The implicit shape can't be a fractional number. "+"Got ".concat(t," / ").concat(n));var i=e.slice();return i[r]=t/n,i}function S(e,t){var n=t.length;return d((e=null==e?t.map((function(e,t){return t})):[].concat(e)).every((function(e){return e>=-n&&e<n})),(function(){return"All values in axis param must be in range [-".concat(n,", ").concat(n,") but ")+"got axis ".concat(e)})),d(e.every((function(e){return g(e)})),(function(){return"All values in axis param must be integers but "+"got axis ".concat(e)})),e.map((function(e){return e<0?n+e:e}))}function N(e,t){for(var n=[],r=[],a=null!=t&&Array.isArray(t)&&0===t.length,i=null==t||a?null:S(t,e).sort(),o=0,s=0;s<e.length;++s){if(null!=i){if(i[o]===s&&1!==e[s])throw new Error("Can't squeeze axis ".concat(s," since its dim '").concat(e[s],"' is not 1"));(null==i[o]||i[o]>s)&&1===e[s]&&(n.push(e[s]),r.push(s)),i[o]<=s&&o++}1!==e[s]&&(n.push(e[s]),r.push(s))}return{newShape:n,keptDims:r}}function j(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else{if("bool"!==e)throw new Error("Unknown data type ".concat(e));n=new Uint8Array(t)}return n}function T(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else if("bool"===e)n=new Uint8Array(t);else{if("string"!==e)throw new Error("Unknown data type ".concat(e));n=new Array(t)}return n}function C(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type ".concat(t," being uploaded contains ").concat(r,"."))}}function E(e){return"bool"===e||"complex64"===e||"float32"===e||"int32"===e||"string"===e}function _(e,t){return"complex64"!==t&&(("float32"!==t||"complex64"===e)&&(("int32"!==t||"float32"===e||"complex64"===e)&&("bool"!==t||"bool"!==e)))}function A(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray}function R(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error("Unknown dtype ".concat(e))}function D(e){if(null==e)return 0;var t=0;return e.forEach((function(e){return t+=e.length})),t}function F(e){return"string"===typeof e||e instanceof String}function M(e){return"boolean"===typeof e}function z(e){return"number"===typeof e}function L(e){return Array.isArray(e)?L(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray?"int32":z(e)?"float32":F(e)?"string":M(e)?"bool":"float32"}function P(e){return!!(e&&e.constructor&&e.call&&e.apply)}function B(e,t){for(var n=t;n<e;++n)if(e%n===0)return n;return e}function W(e){var t=e.length;if(t<2)return[];var n=new Array(t-1);n[t-2]=e[t-1];for(var r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function U(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=new Array;if(1===t.length)for(var i=t[0]*(r?2:1),o=0;o<i;o++)a[o]=n[e+o];else for(var s=t[0],u=t.slice(1),c=u.reduce((function(e,t){return e*t}))*(r?2:1),l=0;l<s;l++)a[l]=U(e+l*c,u,n,r);return a}function V(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(0===e.length)return t[0];var r=e.reduce((function(e,t){return e*t}))*(n?2:1);if(0===r)return[];if(r!==t.length)throw new Error("[".concat(e,"] does not match the input size ").concat(t.length).concat(n?" for a complex tensor":"","."));return U(0,e,t,n)}function G(e,t){for(var n=H(e,t),r=0;r<n.length;r++)n[r]=1;return n}function H(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error("Unknown data type ".concat(t))}function q(e,t){var n=e.reduce((function(e,t){return e*t}),1);if(null==t||"float32"===t)return V(e,new Float32Array(n));if("int32"===t)return V(e,new Int32Array(n));if("bool"===t)return V(e,new Uint8Array(n));throw new Error("Unknown data type ".concat(t))}function K(e){e.forEach((function(t){d(Number.isInteger(t)&&t>=0,(function(){return"Tensor must have a shape comprised of positive integers but got "+"shape [".concat(e,"].")}))}))}function X(e,t,n){if(0===t)return 0;if(1===t)return e[0];for(var r=e[e.length-1],a=0;a<e.length-1;++a)r+=n[a]*e[a];return r}function Y(e,t,n){if(0===t)return[];if(1===t)return[e];for(var r=new Array(t),a=0;a<r.length-1;++a)r[a]=Math.floor(e/n[a]),e-=r[a]*n[a];return r[r.length-1]=e,r}function Z(e){return e&&e.then&&"function"===typeof e.then}n.d(t,"M",(function(){return r})),n.d(t,"N",(function(){return a})),n.d(t,"i",(function(){return i})),n.d(t,"H",(function(){return o})),n.d(t,"S",(function(){return s})),n.d(t,"R",(function(){return u})),n.d(t,"J",(function(){return c})),n.d(t,"l",(function(){return l})),n.d(t,"b",(function(){return d})),n.d(t,"e",(function(){return p})),n.d(t,"d",(function(){return f})),n.d(t,"m",(function(){return h})),n.d(t,"O",(function(){return m})),n.d(t,"y",(function(){return v})),n.d(t,"a",(function(){return b})),n.d(t,"v",(function(){return g})),n.d(t,"T",(function(){return y})),n.d(t,"P",(function(){return x})),n.d(t,"k",(function(){return k})),n.d(t,"L",(function(){return w})),n.d(t,"K",(function(){return O})),n.d(t,"s",(function(){return I})),n.d(t,"I",(function(){return S})),n.d(t,"Q",(function(){return N})),n.d(t,"o",(function(){return j})),n.d(t,"n",(function(){return T})),n.d(t,"h",(function(){return C})),n.d(t,"B",(function(){return E})),n.d(t,"p",(function(){return _})),n.d(t,"A",(function(){return A})),n.d(t,"g",(function(){return R})),n.d(t,"f",(function(){return D})),n.d(t,"z",(function(){return F})),n.d(t,"t",(function(){return M})),n.d(t,"w",(function(){return z})),n.d(t,"r",(function(){return L})),n.d(t,"u",(function(){return P})),n.d(t,"G",(function(){return B})),n.d(t,"j",(function(){return W})),n.d(t,"U",(function(){return V})),n.d(t,"D",(function(){return G})),n.d(t,"F",(function(){return H})),n.d(t,"E",(function(){return q})),n.d(t,"c",(function(){return K})),n.d(t,"C",(function(){return X})),n.d(t,"q",(function(){return Y})),n.d(t,"x",(function(){return Z}))},function(e,t,n){"use strict";function r(e){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(19);function a(e,t,n){return(a="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var a=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Object(r.a)(e)););return e}(e,t);if(a){var i=Object.getOwnPropertyDescriptor(a,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}},function(e,t,n){"use strict";n.r(t),n.d(t,"shuffle",(function(){return a.M})),n.d(t,"shuffleCombo",(function(){return a.N})),n.d(t,"clamp",(function(){return a.i})),n.d(t,"nearestLargerEven",(function(){return a.H})),n.d(t,"swap",(function(){return a.S})),n.d(t,"sum",(function(){return a.R})),n.d(t,"randUniform",(function(){return a.J})),n.d(t,"distSquared",(function(){return a.l})),n.d(t,"assert",(function(){return a.b})),n.d(t,"assertShapesMatch",(function(){return a.e})),n.d(t,"assertNonNull",(function(){return a.d})),n.d(t,"flatten",(function(){return a.m})),n.d(t,"sizeFromShape",(function(){return a.O})),n.d(t,"isScalarShape",(function(){return a.y})),n.d(t,"arraysEqual",(function(){return a.a})),n.d(t,"isInt",(function(){return a.v})),n.d(t,"tanh",(function(){return a.T})),n.d(t,"sizeToSquarishShape",(function(){return a.P})),n.d(t,"createShuffledIndices",(function(){return a.k})),n.d(t,"rightPad",(function(){return a.L})),n.d(t,"repeatedTry",(function(){return a.K})),n.d(t,"inferFromImplicitShape",(function(){return a.s})),n.d(t,"parseAxisParam",(function(){return a.I})),n.d(t,"squeezeShape",(function(){return a.Q})),n.d(t,"getTypedArrayFromDType",(function(){return a.o})),n.d(t,"getArrayFromDType",(function(){return a.n})),n.d(t,"checkConversionForErrors",(function(){return a.h})),n.d(t,"isValidDtype",(function(){return a.B})),n.d(t,"hasEncodingLoss",(function(){return a.p})),n.d(t,"isTypedArray",(function(){return a.A})),n.d(t,"bytesPerElement",(function(){return a.g})),n.d(t,"bytesFromStringArray",(function(){return a.f})),n.d(t,"isString",(function(){return a.z})),n.d(t,"isBoolean",(function(){return a.t})),n.d(t,"isNumber",(function(){return a.w})),n.d(t,"inferDtype",(function(){return a.r})),n.d(t,"isFunction",(function(){return a.u})),n.d(t,"nearestDivisor",(function(){return a.G})),n.d(t,"computeStrides",(function(){return a.j})),n.d(t,"toNestedArray",(function(){return a.U})),n.d(t,"makeOnesTypedArray",(function(){return a.D})),n.d(t,"makeZerosTypedArray",(function(){return a.F})),n.d(t,"makeZerosNestedTypedArray",(function(){return a.E})),n.d(t,"assertNonNegativeIntegerDimensions",(function(){return a.c})),n.d(t,"locToIndex",(function(){return a.C})),n.d(t,"indexToLoc",(function(){return a.q})),n.d(t,"isPromise",(function(){return a.x})),n.d(t,"hexToLong",(function(){return s})),n.d(t,"fingerPrint64",(function(){return k})),n.d(t,"createScalarValue",(function(){return w})),n.d(t,"toTypedArray",(function(){return O})),n.d(t,"now",(function(){return I})),n.d(t,"fetch",(function(){return S})),n.d(t,"encodeString",(function(){return N})),n.d(t,"decodeString",(function(){return j}));var r=n(30),a=n(18),i=n(201),o=n.n(i).a||i;function s(e){return o.fromString(e,!0,16)}var u=s("c3a5c85c97cb3127"),c=s("b492b66fbe98f273"),l=s("9ae16a3b2f90404f");function d(e){return e.xor(e.shru(47))}function p(e,t,n){var r=e.slice(t,t+n);return o.fromBytes(Array.from(r),!0,!0)}function f(e,t){return p(e,t,8)}function h(e,t){return p(e,t,4)}function m(e,t){return 0===t?e:e.shru(t).or(e.shl(64-t))}function v(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:s("9ddfea08eb382d69"),r=e.xor(t).mul(n);r=r.xor(r.shru(47));var a=t.xor(r).mul(n);return a=(a=a.xor(a.shru(47))).mul(n)}function b(e,t,n,r){return function(e,t,n,r,a,i){a=a.add(e),i=m(i.add(a).add(r),21);var o=a;return a=(a=a.add(t)).add(n),i=i.add(m(a,44)),[a.add(r),i.add(o)]}(f(e,t),f(e,t+8),f(e,t+16),f(e,t+24),n,r)}function g(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length;if(t>=8){var n=l.add(2*t),r=f(e,0).add(l),a=f(e,t-8),i=m(a,37).mul(n).add(r),o=m(r,25).add(a).mul(n);return v(i,o,n)}if(t>=4){var s=l.add(2*t),c=h(e,0);return v(c.shl(3).add(t),h(e,t-4),s)}if(t>0){var p=e[0],b=e[t>>1],g=e[t-1],y=p+(b<<8),x=t+(g<<2);return d(l.mul(y).xor(u.mul(x))).mul(l)}return l}function y(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length,n=l.add(2*t),r=f(e,0).mul(c),a=f(e,8),i=f(e,t-8).mul(n),o=f(e,t-16).mul(l);return v(m(r.add(a),43).add(m(i,30)).add(o),r.add(m(a.add(l),18)).add(i),n)}function x(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length,n=l.add(2*t),r=f(e,0).mul(l),a=f(e,8),i=f(e,t-8).mul(n),o=f(e,t-16).mul(l),s=m(r.add(a),43).add(m(i,30)).add(o),u=v(s,r.add(m(a.add(l),18)).add(i),n),c=f(e,16).mul(n),d=f(e,24),p=s.add(f(e,t-32)).mul(n),h=u.add(f(e,t-24)).mul(n);return v(m(c.add(d),43).add(m(p,30)).add(h),c.add(m(d.add(r),18)).add(p),n)}function k(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length,n=o.fromNumber(81,!0);if(t<=32)return t<=16?g(e,t):y(e,t);if(t<=64)return x(e,t);var r=n,a=n.mul(c).add(113),i=d(a.mul(l).add(113)).mul(l),s=[o.UZERO,o.UZERO],p=[o.UZERO,o.UZERO];r=r.mul(l).add(f(e,0));var h=0,k=64*(t-1>>6),w=k+(t-1&63)-63;do{r=m(r.add(a).add(s[0]).add(f(e,h+8)),37).mul(c),a=m(a.add(s[1]).add(f(e,h+48)),42).mul(c),r=r.xor(p[1]),a=a.add(s[0]).add(f(e,h+40)),i=m(i.add(p[0]),33).mul(c),s=b(e,h,s[1].mul(c),r.add(p[0])),p=b(e,h+32,i.add(p[1]),a.add(f(e,h+16)));var O=[r,i];i=O[0],r=O[1],h+=64}while(h!==k);var I=c.add(i.and(255).shl(1));h=w,p[0]=p[0].add(t-1&63),s[0]=s[0].add(p[0]),p[0]=p[0].add(s[0]),r=m(r.add(a).add(s[0]).add(f(e,h+8)),37).mul(I),a=m(a.add(s[1]).add(f(e,h+48)),42).mul(I),r=r.xor(p[1].mul(9)),a=a.add(s[0].mul(9).add(f(e,h+40))),i=m(i.add(p[0]),33).mul(I),s=b(e,h,s[1].mul(I),r.add(p[0])),p=b(e,h+32,i.add(p[1]),a.add(f(e,h+16)));var S=[r,i];return i=S[0],r=S[1],v(v(s[0],p[0],I).add(d(a).mul(u)).add(i),v(s[1],p[1],I).add(r),I)}function w(e,t){return"string"===t?N(e):O([e],t)}function O(e,t){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=a.m(e)),Object(r.b)().getBool("DEBUG")&&a.h(e,t),function(e,t){return e instanceof Float32Array&&"float32"===t||e instanceof Int32Array&&"int32"===t||e instanceof Uint8Array&&"bool"===t}(e,t))return e;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){for(var n=new Uint8Array(e.length),i=0;i<n.length;++i)0!==Math.round(e[i])&&(n[i]=1);return n}throw new Error("Unknown data type ".concat(t))}function I(){return Object(r.b)().platform.now()}function S(e,t){return Object(r.b)().platform.fetch(e,t)}function N(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8";return t=t||"utf-8",Object(r.b)().platform.encode(e,t)}function j(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8";return t=t||"utf-8",Object(r.b)().platform.decode(e,t)}},function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(12),a=n(7),i=n(6),o=n(18),s=n(9);var u=Object(s.b)({cast_:function(e,t){var n=Object(i.a)(e,"x","cast");if(!o.B(t))throw new Error("Failed to cast to unknown dtype ".concat(t));if("string"===t&&"string"!==n.dtype||"string"!==t&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");var s={x:n},u={dtype:t};return r.a.runKernel(a.x,s,u)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(3),a=n(12),i=n(7),o=n(32),s=n(6),u=n(9);var c=Object(u.b)({add_:function(e,t){var n=Object(s.a)(e,"a","add"),u=Object(s.a)(t,"b","add"),c=Object(o.makeTypesMatch)(n,u),l=Object(r.a)(c,2),d={a:n=l[0],b:u=l[1]};return a.a.runKernel(i.d,d)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(3),a=n(12),i=n(7),o=n(32),s=n(6),u=n(9);var c=Object(u.b)({sub_:function(e,t){var n=Object(s.a)(e,"a","sub"),u=Object(s.a)(t,"b","sub"),c=Object(o.makeTypesMatch)(n,u),l=Object(r.a)(c,2),d={a:n=l[0],b:u=l[1]};return a.a.runKernel(i.bd,d)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var r=n(3),a=n(12),i=n(7),o=n(32),s=n(6),u=n(123),c=n(9);var l=Object(c.b)({div_:function(e,t){var n=Object(s.a)(e,"a","div"),c=Object(s.a)(t,"b","div"),l=Object(o.makeTypesMatch)(n,c),d=Object(r.a)(l,2);if(n=d[0],c=d[1],"int32"===n.dtype&&"int32"===c.dtype)return Object(u.a)(n,c);var p={a:n,b:c};return a.a.runKernel(i.oc,p,{})}})},function(e,t,n){"use strict";function r(e,t){for(var n=e.length,r=[],a=0;a<n;a++){var i=n-1-a,o=e[i]||1;(t[t.length-1-a]||1)>1&&1===o&&r.unshift(i)}return r}function a(e,t){for(var n=[],r=0;r<t.length;r++){var a=e[e.length-r-1],i=t.length-r-1,o=t[i];(null==a||1===a&&o>1)&&n.unshift(i)}return n}function i(e,t){for(var n=[],r=Math.max(e.length,t.length),a=0;a<r;a++){var i=e[e.length-a-1];null==i&&(i=1);var o=t[t.length-a-1];if(null==o&&(o=1),1===i)n.unshift(o);else if(1===o)n.unshift(i);else{if(i!==o){var s="Operands could not be broadcast together with shapes "+"".concat(e," and ").concat(t,".");throw Error(s)}n.unshift(i)}}return n}n.r(t),n.d(t,"getBroadcastDims",(function(){return r})),n.d(t,"getReductionAxes",(function(){return a})),n.d(t,"assertAndGetBroadcastShape",(function(){return i}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(12),a=n(7),i=n(6),o=n(22),s=n(9);var u=Object(s.b)({sum_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=Object(i.a)(e,"x","sum");"bool"===s.dtype&&(s=Object(o.a)(s,"int32"));var u={x:s},c={axis:t,keepDims:n};return r.a.runKernel(a.cd,u,c)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(18),a=n(62);function i(e,t){if((Object(r.A)(e)&&"string"!==t||Array.isArray(e))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===t&&Object(r.A)(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Object(a.a)(e,[],[],t)}},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(7),i=n(6),o=n(9);var s=Object(o.b)({zerosLike_:function(e){var t={x:Object(i.a)(e,"x","zerosLike")};return r.a.runKernel(a.md,t)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return l})),n.d(t,"b",(function(){return f})),n.d(t,"c",(function(){return m}));var r=n(3),a=n(1),i=n.n(a),o=n(8),s=n(2),u=n(4),c=n(18),l=function(){function e(t){Object(s.a)(this,e),this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=d,this.populateURLFlags()}return Object(u.a)(e,[{key:"setPlatform",value:function(e,t){null!=this.platform&&(f().getBool("IS_TEST")||f().getBool("PROD")||console.warn("Platform ".concat(this.platformName," has already been set. ")+"Overwriting the platform with ".concat(e,"."))),this.platformName=e,this.platform=t}},{key:"registerFlag",value:function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},null!=this.urlFlags[e]){var r=this.urlFlags[e];f().getBool("IS_TEST")||f().getBool("PROD")||console.warn("Setting feature override from URL ".concat(e,": ").concat(r,".")),this.set(e,r)}}},{key:"getAsync",value:function(){var e=Object(o.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t in this.flags)){e.next=2;break}return e.abrupt("return",this.flags[t]);case 2:return e.next=4,this.evaluateFlag(t);case 4:return this.flags[t]=e.sent,e.abrupt("return",this.flags[t]);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"get",value:function(e){if(e in this.flags)return this.flags[e];var t=this.evaluateFlag(e);if(Object(c.x)(t))throw new Error("Flag ".concat(e," cannot be synchronously evaluated. ")+"Please use getAsync() instead.");return this.flags[e]=t,this.flags[e]}},{key:"getNumber",value:function(e){return this.get(e)}},{key:"getBool",value:function(e){return this.get(e)}},{key:"getFlags",value:function(){return this.flags}},{key:"set",value:function(e,t){if(null==this.flagRegistry[e])throw new Error("Cannot set flag ".concat(e," as it has not been registered."));this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)}},{key:"evaluateFlag",value:function(e){if(null==this.flagRegistry[e])throw new Error("Cannot evaluate flag '".concat(e,"': no evaluation function found."));return this.flagRegistry[e].evaluationFn()}},{key:"setFlags",value:function(e){this.flags=Object.assign({},e)}},{key:"reset",value:function(){this.flags={},this.urlFlags={},this.populateURLFlags()}},{key:"populateURLFlags",value:function(){var e=this;if("undefined"!==typeof this.global&&"undefined"!==typeof this.global.location&&"undefined"!==typeof this.global.location.search){var t=this.getQueryParams(this.global.location.search);if("tfjsflags"in t)t.tfjsflags.split(",").forEach((function(t){var n=t.split(":"),a=Object(r.a)(n,2),i=a[0],o=a[1];e.urlFlags[i]=function(e,t){if("true"===(t=t.toLowerCase())||"false"===t)return"true"===t;if("".concat(+t)===t)return+t;throw new Error("Could not parse value flag value ".concat(t," for flag ").concat(e,"."))}(i,o)}))}}},{key:"features",get:function(){return this.flags}}]),e}();function d(e){var t={};return e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return p(t,r[0],r[1]),r.join("=")})),t}function p(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}function f(){return h}var h=null;function m(e){h=e}},function(e,t,n){"use strict";n.d(t,"b",(function(){return a.a})),n.d(t,"c",(function(){return i.a})),n.d(t,"d",(function(){return o.a})),n.d(t,"e",(function(){return s.a})),n.d(t,"f",(function(){return f})),n.d(t,"g",(function(){return h.a})),n.d(t,"h",(function(){return m.a})),n.d(t,"i",(function(){return v.a})),n.d(t,"j",(function(){return b.a})),n.d(t,"k",(function(){return g.a})),n.d(t,"l",(function(){return y.a})),n.d(t,"m",(function(){return x.a})),n.d(t,"n",(function(){return k.a})),n.d(t,"o",(function(){return w.a})),n.d(t,"p",(function(){return O.a})),n.d(t,"q",(function(){return j})),n.d(t,"r",(function(){return D})),n.d(t,"w",(function(){return F.a})),n.d(t,"s",(function(){return M.a})),n.d(t,"t",(function(){return z})),n.d(t,"u",(function(){return L})),n.d(t,"v",(function(){return P})),n.d(t,"x",(function(){return B})),n.d(t,"z",(function(){return W})),n.d(t,"A",(function(){return U.a})),n.d(t,"B",(function(){return V.a})),n.d(t,"C",(function(){return S.a})),n.d(t,"D",(function(){return G.a})),n.d(t,"E",(function(){return H.a})),n.d(t,"F",(function(){return q.a})),n.d(t,"G",(function(){return K.a})),n.d(t,"H",(function(){return T.a})),n.d(t,"I",(function(){return X})),n.d(t,"J",(function(){return Y})),n.d(t,"K",(function(){return Z})),n.d(t,"L",(function(){return J})),n.d(t,"M",(function(){return Q.a})),n.d(t,"N",(function(){return $.a})),n.d(t,"O",(function(){return ee.a})),n.d(t,"P",(function(){return te})),n.d(t,"Q",(function(){return re})),n.d(t,"R",(function(){return ae.a})),n.d(t,"S",(function(){return ie.a})),n.d(t,"U",(function(){return oe.a})),n.d(t,"V",(function(){return se.a})),n.d(t,"W",(function(){return ue})),n.d(t,"X",(function(){return ce.a})),n.d(t,"Y",(function(){return le.a})),n.d(t,"Z",(function(){return de})),n.d(t,"ab",(function(){return pe.a})),n.d(t,"bb",(function(){return fe.a})),n.d(t,"cb",(function(){return he.a})),n.d(t,"db",(function(){return me.a})),n.d(t,"fb",(function(){return ve})),n.d(t,"gb",(function(){return be.a})),n.d(t,"ib",(function(){return ge.a})),n.d(t,"jb",(function(){return ye.a})),n.d(t,"kb",(function(){return xe.a})),n.d(t,"lb",(function(){return ke.a})),n.d(t,"mb",(function(){return we.a})),n.d(t,"nb",(function(){return Oe.a})),n.d(t,"ob",(function(){return Se})),n.d(t,"qb",(function(){return Ne.a})),n.d(t,"rb",(function(){return je.a})),n.d(t,"sb",(function(){return Te.a})),n.d(t,"ub",(function(){return Ce.a})),n.d(t,"wb",(function(){return Ee.a})),n.d(t,"xb",(function(){return _e.a})),n.d(t,"zb",(function(){return Ae.a})),n.d(t,"Db",(function(){return Re.a})),n.d(t,"Eb",(function(){return De.a})),n.d(t,"Fb",(function(){return Fe.a})),n.d(t,"Gb",(function(){return Me.a})),n.d(t,"Hb",(function(){return ze.a})),n.d(t,"Ib",(function(){return Le.a})),n.d(t,"Kb",(function(){return Pe})),n.d(t,"Lb",(function(){return Be.a})),n.d(t,"Mb",(function(){return We.a})),n.d(t,"Nb",(function(){return Ue.a})),n.d(t,"Ob",(function(){return Ve.a})),n.d(t,"Pb",(function(){return Ge.a})),n.d(t,"Qb",(function(){return He.a})),n.d(t,"Rb",(function(){return qe.a})),n.d(t,"Sb",(function(){return Ke.a})),n.d(t,"Tb",(function(){return Xe.a})),n.d(t,"Ub",(function(){return Ye.a})),n.d(t,"Wb",(function(){return Je})),n.d(t,"Xb",(function(){return C.a})),n.d(t,"Yb",(function(){return Qe.a})),n.d(t,"Zb",(function(){return $e.a})),n.d(t,"ac",(function(){return et})),n.d(t,"bc",(function(){return tt})),n.d(t,"cc",(function(){return nt.a})),n.d(t,"dc",(function(){return rt.a})),n.d(t,"ec",(function(){return ot})),n.d(t,"fc",(function(){return st.a})),n.d(t,"gc",(function(){return ut.a})),n.d(t,"hc",(function(){return ct.a})),n.d(t,"ic",(function(){return lt.a})),n.d(t,"jc",(function(){return ht})),n.d(t,"lc",(function(){return E.a})),n.d(t,"mc",(function(){return mt})),n.d(t,"nc",(function(){return vt})),n.d(t,"oc",(function(){return bt.a})),n.d(t,"qc",(function(){return gt.a})),n.d(t,"rc",(function(){return yt.a})),n.d(t,"sc",(function(){return at.a})),n.d(t,"tc",(function(){return xt.a})),n.d(t,"vc",(function(){return kt})),n.d(t,"wc",(function(){return wt.a})),n.d(t,"xc",(function(){return Ot})),n.d(t,"yc",(function(){return It})),n.d(t,"zc",(function(){return St})),n.d(t,"Ac",(function(){return Nt})),n.d(t,"Bc",(function(){return jt.a})),n.d(t,"Cc",(function(){return Tt.a})),n.d(t,"Dc",(function(){return Ct.a})),n.d(t,"Ec",(function(){return Et.a})),n.d(t,"Fc",(function(){return _t.a})),n.d(t,"Gc",(function(){return At})),n.d(t,"Hc",(function(){return Rt})),n.d(t,"Ic",(function(){return Dt})),n.d(t,"Jc",(function(){return Wt})),n.d(t,"Kc",(function(){return Ut})),n.d(t,"Lc",(function(){return Vt})),n.d(t,"Mc",(function(){return Gt})),n.d(t,"Nc",(function(){return Ht})),n.d(t,"Oc",(function(){return qt.a})),n.d(t,"Pc",(function(){return Kt.a})),n.d(t,"Qc",(function(){return Xt.a})),n.d(t,"Rc",(function(){return Yt.a})),n.d(t,"Sc",(function(){return N.a})),n.d(t,"Tc",(function(){return Zt.a})),n.d(t,"Uc",(function(){return Jt})),n.d(t,"Vc",(function(){return Qt})),n.d(t,"Wc",(function(){return $t})),n.d(t,"Xc",(function(){return en})),n.d(t,"Zc",(function(){return tn.a})),n.d(t,"ad",(function(){return nn.a})),n.d(t,"bd",(function(){return rn.a})),n.d(t,"ed",(function(){return an.a})),n.d(t,"fd",(function(){return on.a})),n.d(t,"gd",(function(){return dn})),n.d(t,"hd",(function(){return _.a})),n.d(t,"id",(function(){return pn.a})),n.d(t,"kd",(function(){return fn.a})),n.d(t,"ld",(function(){return hn.a})),n.d(t,"md",(function(){return A.a})),n.d(t,"nd",(function(){return mn})),n.d(t,"od",(function(){return vn})),n.d(t,"pd",(function(){return bn})),n.d(t,"qd",(function(){return gn})),n.d(t,"rd",(function(){return yn.a})),n.d(t,"sd",(function(){return xn.a})),n.d(t,"td",(function(){return kn.a})),n.d(t,"pb",(function(){return wn.a})),n.d(t,"yb",(function(){return On.a})),n.d(t,"Cb",(function(){return In.a})),n.d(t,"Yc",(function(){return Sn.a})),n.d(t,"xd",(function(){return Nn.a})),n.d(t,"yd",(function(){return jn.a})),n.d(t,"zd",(function(){return pt.a})),n.d(t,"Ad",(function(){return Tn.a})),n.d(t,"Bd",(function(){return Cn.a})),n.d(t,"Cd",(function(){return En.a})),n.d(t,"Dd",(function(){return _n.a})),n.d(t,"Ed",(function(){return An.a})),n.d(t,"Gd",(function(){return ft.a})),n.d(t,"Hd",(function(){return Rn.a})),n.d(t,"Id",(function(){return Dn.a})),n.d(t,"Jd",(function(){return R.a})),n.d(t,"Kd",(function(){return Fn.a})),n.d(t,"Ld",(function(){return zn})),n.d(t,"Md",(function(){return Ln})),n.d(t,"Nd",(function(){return Pn.a})),n.d(t,"Od",(function(){return Bn})),n.d(t,"Pd",(function(){return Wn})),n.d(t,"Qd",(function(){return Un})),n.d(t,"Rd",(function(){return Ie.a})),n.d(t,"Sd",(function(){return Vn.a})),n.d(t,"Ud",(function(){return Gn})),n.d(t,"Vd",(function(){return Hn.a})),n.d(t,"Wd",(function(){return qn.a})),n.d(t,"Xd",(function(){return Kn.a})),n.d(t,"Yd",(function(){return Xn})),n.d(t,"Zd",(function(){return Yn})),n.d(t,"ae",(function(){return Zn.a})),n.d(t,"be",(function(){return $n})),n.d(t,"ce",(function(){return er.a})),n.d(t,"de",(function(){return tr.a})),n.d(t,"y",(function(){return rr})),n.d(t,"Td",(function(){return ar.a})),n.d(t,"pc",(function(){return ir.a})),n.d(t,"kc",(function(){return sr})),n.d(t,"cd",(function(){return cr})),n.d(t,"dd",(function(){return Ze})),n.d(t,"vd",(function(){return dr})),n.d(t,"vb",(function(){return pr})),n.d(t,"eb",(function(){return fr})),n.d(t,"hb",(function(){return hr})),n.d(t,"T",(function(){return mr})),n.d(t,"Bb",(function(){return br})),n.d(t,"uc",(function(){return p.b})),n.d(t,"a",(function(){return p.a})),n.d(t,"Ab",(function(){return Sa})),n.d(t,"Jb",(function(){return Na})),n.d(t,"Vb",(function(){return ja})),n.d(t,"wd",(function(){return Oa})),n.d(t,"tb",(function(){return r})),n.d(t,"jd",(function(){return Ia})),n.d(t,"ud",(function(){return Ta})),n.d(t,"Fd",(function(){return Ca}));var r={};n.r(r),n.d(r,"conv2d",(function(){return Ir})),n.d(r,"depthwiseConv2d",(function(){return jr})),n.d(r,"matMul",(function(){return Tr}));var a=n(53),i=n(205),o=n(206),s=n(23),u=n(12),c=n(7),l=n(6),d=n(18),p=n(9);var f=Object(p.b)({addN_:function(e){d.b(Array.isArray(e),(function(){return"The argument passed to tf.addN() must be a list of tensors"})),d.b(e.length>=1,(function(){return"Must pass at least one tensor to tf.addN(), but got "+"".concat(e.length)}));var t=e.map((function(e,t){return Object(l.a)(e,"tensors".concat(t),"addN")})),n=t[0];t.forEach((function(e){if(e.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")})),t.forEach((function(e){if(!d.a(e.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}));var r=t;return u.a.runKernel(c.e,r)}}),h=n(155),m=n(156),v=n(157),b=n(158),g=n(207),y=n(208),x=n(209),k=n(159),w=n(210),O=n(120),I=n(33),S=n(22),N=n(16);var j=Object(p.b)({avgPool3d_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NDHWC",o=Object(l.a)(e,"x","avgPool3d","float32"),s=o,p=!1;4===o.rank&&(p=!0,s=Object(N.a)(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),d.b(5===s.rank,(function(){return"Error in avgPool3d: x must be rank 5 but got rank ".concat(s.rank,".")})),d.b("NDHWC"===i,(function(){return"Error in avgPool3d: Only NDHWC is currently supported, "+"but got dataFormat of ".concat(i)})),Object(I.a)("avgPool3d",r,a);var f={x:s},h={filterSize:t,strides:n,pad:r,dimRoundingMode:a,dataFormat:i},m=u.a.runKernel(c.p,f,h);return m=Object(S.a)(m,s.dtype),p?Object(N.a)(m,[m.shape[1],m.shape[2],m.shape[3],m.shape[4]]):m}}),T=n(43),C=n(36),E=n(17),_=n(80),A=n(37),R=n(147);var D=Object(p.b)({basicLSTMCell_:function(e,t,n,r,a,i){var o=Object(l.a)(e,"forgetBias","basicLSTMCell"),u=Object(l.a)(t,"lstmKernel","basicLSTMCell"),c=Object(l.a)(n,"lstmBias","basicLSTMCell"),d=Object(l.a)(r,"data","basicLSTMCell"),p=Object(l.a)(a,"c","basicLSTMCell"),f=Object(l.a)(i,"h","basicLSTMCell"),h=Object(T.a)([d,f],1),m=Object(C.a)(h,u),v=Object(s.a)(m,c),b=v.shape[0],g=v.shape[1]/4,y=[b,g],x=Object(A.a)(v,[0,0],y),k=Object(A.a)(v,[0,g],y),w=Object(A.a)(v,[0,2*g],y),O=Object(A.a)(v,[0,3*g],y),I=Object(s.a)(Object(E.a)(Object(_.a)(x),Object(R.a)(k)),Object(E.a)(p,Object(_.a)(Object(s.a)(o,w))));return[I,Object(E.a)(Object(R.a)(I),Object(_.a)(O))]}}),F=n(100),M=n(93);var z=Object(p.b)({batchNorm2d_:function(e,t,n,r,a,i){var o,s,u=Object(l.a)(e,"x","batchNorm"),c=Object(l.a)(t,"mean","batchNorm"),p=Object(l.a)(n,"variance","batchNorm");return null!=a&&(o=Object(l.a)(a,"scale","batchNorm")),null!=r&&(s=Object(l.a)(r,"offset","batchNorm")),d.b(2===u.rank,(function(){return"Error in batchNorm2D: x must be rank 2 but got rank "+"".concat(u.rank,".")})),d.b(2===c.rank||1===c.rank,(function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but "+"got rank ".concat(c.rank,".")})),d.b(2===p.rank||1===p.rank,(function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 "+"but got rank ".concat(p.rank,".")})),null!=o&&d.b(2===o.rank||1===o.rank,(function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 "+"but got rank ".concat(o.rank,".")})),null!=s&&d.b(2===s.rank||1===s.rank,(function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 "+"but got rank ".concat(s.rank,".")})),Object(M.a)(u,c,p,s,o,i)}});var L=Object(p.b)({batchNorm3d_:function(e,t,n,r,a,i){var o,s,u=Object(l.a)(e,"x","batchNorm"),c=Object(l.a)(t,"mean","batchNorm"),p=Object(l.a)(n,"variance","batchNorm");return null!=a&&(o=Object(l.a)(a,"scale","batchNorm")),null!=r&&(s=Object(l.a)(r,"offset","batchNorm")),d.b(3===u.rank,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+"".concat(u.rank,".")})),d.b(3===c.rank||1===c.rank,(function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but "+"got rank ".concat(c.rank,".")})),d.b(3===p.rank||1===p.rank,(function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 "+"but got rank ".concat(p.rank,".")})),null!=o&&d.b(3===o.rank||1===o.rank,(function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 "+"but got rank ".concat(o.rank,".")})),null!=s&&d.b(3===s.rank||1===s.rank,(function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 "+"but got rank ".concat(s.rank,".")})),Object(M.a)(u,c,p,s,o,i)}});var P=Object(p.b)({batchNorm4d_:function(e,t,n,r,a,i){var o,s,u=Object(l.a)(e,"x","batchNorm"),c=Object(l.a)(t,"mean","batchNorm"),p=Object(l.a)(n,"variance","batchNorm");return null!=a&&(o=Object(l.a)(a,"scale","batchNorm")),null!=r&&(s=Object(l.a)(r,"offset","batchNorm")),d.b(4===u.rank,(function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+"".concat(u.rank,".")})),d.b(4===c.rank||1===c.rank,(function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but "+"got rank ".concat(c.rank,".")})),d.b(4===p.rank||1===p.rank,(function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 "+"but got rank ".concat(p.rank,".")})),null!=o&&d.b(4===o.rank||1===o.rank,(function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 "+"but got rank ".concat(o.rank,".")})),null!=s&&d.b(4===s.rank||1===s.rank,(function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 "+"but got rank ".concat(s.rank,".")})),Object(M.a)(u,c,p,s,o,i)}});var B=Object(p.b)({bincount_:function(e,t,n){var r=Object(l.a)(e,"x","bincount"),a=Object(l.a)(t,"weights","bincount");d.b("int32"===r.dtype,(function(){return"Error in bincount: input "+"dtype must be int32, but got ".concat(r.dtype)})),d.b(n>=0,(function(){return"size must be non-negative, but got ".concat(n,".")})),d.b(a.size===r.size||0===a.size,(function(){return"Error in bincount: weights must have the same size as input or"+"0-length, but got input shape: ".concat(r.shape,", weights shape: ")+"".concat(a.shape,".")}));var i={x:r,weights:a},o={size:n};return u.a.runKernel(c.u,i,o)}});var W=Object(p.b)({broadcastArgs_:function(e,t){var n=Object(l.a)(e,"s0","broadcastArgs","int32"),r=Object(l.a)(t,"s1","broadcastArgs","int32");if(1!==n.rank)throw new Error("broadcastArgs(): first input must be a vector (rank=1). "+"Has rank ".concat(n.rank));if(1!==r.rank)throw new Error("broadcastArgs(): second input must be a vector (rank=1). "+"Has rank ".concat(r.rank));var a={s0:n,s1:r};return u.a.runKernel(c.v,a)}}),U=n(111),V=n(59),G=n(211),H=n(212),q=n(79),K=n(63);var X=Object(p.b)({concat1d_:function(e){return Object(T.a)(e,0)}});var Y=Object(p.b)({concat2d_:function(e,t){return Object(T.a)(e,t)}});var Z=Object(p.b)({concat3d_:function(e,t){return Object(T.a)(e,t)}});var J=Object(p.b)({concat4d_:function(e,t){return Object(T.a)(e,t)}}),Q=n(160),$=n(77),ee=n(161);var te=Object(p.b)({conv3d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NDHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1,1],o=Object(l.a)(e,"x","conv3d"),s=Object(l.a)(t,"filter","conv3d"),p=o,f=!1;4===o.rank&&(f=!0,p=Object(N.a)(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),d.b(5===p.rank,(function(){return"Error in conv3d: input must be rank 5, but got rank ".concat(p.rank,".")})),d.b(5===s.rank,(function(){return"Error in conv3d: filter must be rank 5, but got rank "+"".concat(s.rank,".")})),d.b(p.shape[4]===s.shape[3],(function(){return"Error in conv3d: depth of input (".concat(p.shape[4],") must match ")+"input depth for filter ".concat(s.shape[3],".")})),d.b(Object(I.i)(n,i),(function(){return"Error in conv3D: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(i,"'")})),d.b("NDHWC"===a,(function(){return"Error in conv3d: got dataFormat of ".concat(a," but only NDHWC is currently supported.")}));var h={x:p,filter:s},m={strides:n,pad:r,dataFormat:a,dilations:i},v=u.a.runKernel(c.G,h,m);return f?Object(N.a)(v,[v.shape[1],v.shape[2],v.shape[3],v.shape[4]]):v}}),ne=n(194);var re=Object(p.b)({conv3dTranspose_:function(e,t,n,r,a){var i=Object(l.a)(e,"x","conv3dTranspose"),o=Object(l.a)(t,"filter","conv3dTranspose");return Object(ne.a)(n,i,o,r,a)}}),ae=n(121),ie=n(162),oe=n(113),se=n(122);var ue=Object(p.b)({denseBincount_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=Object(l.a)(e,"x","denseBincount"),i=Object(l.a)(t,"weights","denseBincount");d.b("int32"===a.dtype,(function(){return"Error in denseBincount: input "+"dtype must be int32, but got ".concat(a.dtype)})),d.b(a.rank<=2,(function(){return"Error in denseBincount: input must be at most rank 2, but got "+"rank ".concat(a.rank,".")})),d.b(n>=0,(function(){return"size must be non-negative, but got ".concat(n,".")})),d.b(i.size===a.size||0===i.size,(function(){return"Error in denseBincount: weights must have the same shape as x or "+"0-length, but got x shape: ".concat(a.shape,", weights shape: ")+"".concat(i.shape,".")}));var o={x:a,weights:i},s={size:n,binaryOutput:r};return u.a.runKernel(c.O,o,s)}}),ce=n(163),le=n(101);var de=Object(p.b)({diag_:function(e){var t={x:Object(l.a)(e,"x","diag")};return u.a.runKernel(c.T,t)}}),pe=n(164),fe=n(25),he=n(165),me=n(166);var ve=Object(p.b)({einsum_:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=n.map((function(e,t){return Object(l.a)(e,"tensors".concat(t),"einsum")})),i={equation:e};return u.a.runKernel(c.X,a,i)}}),be=n(124),ge=n(102),ye=n(213),xe=n(167),ke=n(50),we=n(74),Oe=n(214),Ie=n(82);var Se=Object(p.b)({eye_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32";null==t&&(t=e);for(var a=Object(V.a)([e,t],r),i=e<=t?e:t,o=0;o<i;++o)a.set(1,o,o);var s=Object(N.a)(a.toTensor(),[e,t]);if(null==n)return s;if(1===n.length)return Object(Ie.a)(Object(we.a)(s,0),[n[0],1,1]);if(2===n.length)return Object(Ie.a)(Object(we.a)(Object(we.a)(s,0),0),[n[0],n[1],1,1]);if(3===n.length)return Object(Ie.a)(Object(we.a)(Object(we.a)(Object(we.a)(s,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D "+"batchShapes, but received ".concat(n.length,"D."))}}),Ne=n(88),je=n(125),Te=n(123),Ce=n(104),Ee=n(52),_e=n(78),Ae=n(105),Re=n(215),De=n(216),Fe=n(217),Me=n(126),ze=n(127),Le=n(66);function Pe(e,t,n){if(n<=0)throw new Error("The number of values should be positive.");var r={start:e,stop:t,num:n};return u.a.runKernel(c.Db,{},r)}var Be=n(168),We=n(84),Ue=n(169),Ve=n(218),Ge=n(219),He=n(128),qe=n(70),Ke=n(106),Xe=n(129),Ye=n(171);var Ze=Object(p.b)({searchSorted_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"left",r=Object(l.a)(e,"sortedSequence","searchSorted"),a=Object(l.a)(t,"values","searchSorted"),i=r.shape[r.shape.length-1],o=a.shape[a.shape.length-1],s=Object(N.a)(r,[-1,i]),p=Object(N.a)(a,[-1,o]);if(s.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(s.shape[0]!==p.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(Object(d.O)(p.shape)>=2147483648)throw new Error("values tensor size must less than ".concat(2147483648));if(s.shape[1]>=2147483648)throw new Error("trailing dim_size must less than ".concat(2147483648," for int32 output type, was ").concat(s.shape[1]));var f={sortedSequence:s,values:p},h={side:n};return u.a.runKernel(c.Cc,f,h)}});function Je(e,t){return Ze(e,t,"left")}var Qe=n(81),$e=n(130);var et=Object(p.b)({maxPool3d_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[1,1,1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NDHWC",o=Object(l.a)(e,"x","maxPool3d"),s=o,p=!1;4===o.rank&&(p=!0,s=Object(N.a)(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),d.b(5===s.rank,(function(){return"Error in maxPool3d: x must be rank 5 but got rank ".concat(s.rank,".")})),d.b("NDHWC"===i,(function(){return"Error in maxPool3d: Only NDHWC is currently supported, "+"but got dataFormat of ".concat(i)})),Object(I.a)("maxPool3d",r,a);var f={x:s},h={filterSize:t,strides:n,pad:r,dimRoundingMode:a,dataFormat:i},m=u.a.runKernel(c.Mb,f,h);return p?Object(N.a)(m,[m.shape[1],m.shape[2],m.shape[3],m.shape[4]]):m}});var tt=Object(p.b)({maxPoolWithArgmax_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=Object(l.a)(e,"x","maxPoolWithArgmax"),o={x:i},s={filterSize:t,strides:n,pad:r,includeBatchInIndex:a},d=u.a.runKernel(c.Pb,o,s);return{result:d[0],indexes:d[1]}}}),nt=n(107),rt=n(96),at=n(65),it=n(13);function ot(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.indexing,a=void 0===r?"xy":r;if("xy"!==a&&"ij"!==a)throw new TypeError("".concat(a," is not a valid third argument to meshgrid"));if(void 0===e)return[];var i=Object(l.a)(e,"x","meshgrid",e instanceof it.a?e.dtype:"float32");if(void 0===t)return[i];var o=Object(l.a)(t,"y","meshgrid",t instanceof it.a?t.dtype:"float32"),s=Object(d.O)(i.shape),u=Object(d.O)(o.shape);return"xy"===a?(i=Object(N.a)(i,[1,-1]),o=Object(N.a)(o,[-1,1]),[Object(C.a)(Object(at.a)([u,1],i.dtype),i),Object(C.a)(o,Object(at.a)([1,s],o.dtype))]):(i=Object(N.a)(i,[-1,1]),o=Object(N.a)(o,[1,-1]),[Object(C.a)(i,Object(at.a)([1,u],i.dtype)),Object(C.a)(Object(at.a)([s,1],o.dtype),o)])}var st=n(114),ut=n(131),ct=n(172),lt=n(173),dt=n(49),pt=n(34),ft=n(24);var ht=Object(p.b)({moments_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e=Object(l.a)(e,"x","moments");var r=Object(d.I)(t,e.shape),a=Object(rt.a)(e,r,n),i=a.shape;n||(i=Object(dt.e)(a.shape,r));var o=Object(pt.a)(Object(ft.a)(Object(S.a)(e,"float32"),Object(N.a)(a,i))),s=Object(rt.a)(o,r,n);return{mean:a,variance:s}}});var mt=Object(p.b)({multiRNNCell_:function(e,t,n,r){for(var a=Object(l.a)(t,"data","multiRNNCell"),i=Object(l.b)(n,"c","multiRNNCell"),o=Object(l.b)(r,"h","multiRNNCell"),s=a,u=[],c=0;c<e.length;c++){var d=e[c](s,i[c],o[c]);u.push(d[0]),u.push(d[1]),s=d[1]}for(var p=[],f=[],h=0;h<u.length;h+=2)p.push(u[h]),f.push(u[h+1]);return[p,f]}});var vt=Object(p.b)({multinomial_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=Object(l.a)(e,"logits","multinomial"),i=a.size,o=a.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+"".concat(i,"."));if(o>2)throw new Error("Rank of probabilities must be 1 or 2, but is ".concat(o));n=n||Math.random();var s=1===o?Object(N.a)(a,[1,-1]):a,d={logits:s},p={numSamples:t,seed:n,normalized:r},f=u.a.runKernel(c.Wb,d,p);return 1===o?Object(N.a)(f,[f.size]):f}}),bt=n(38),gt=n(132),yt=n(174),xt=n(220);var kt=Object(p.b)({outerProduct_:function(e,t){var n=Object(l.a)(e,"v1","outerProduct"),r=Object(l.a)(t,"v2","outerProduct");d.b(1===n.rank&&1===r.rank,(function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+"".concat(n.rank," and ").concat(r.rank,".")}));var a=Object(N.a)(n,[-1,1]),i=Object(N.a)(r,[1,-1]);return Object(C.a)(a,i)}}),wt=n(67);var Ot=Object(p.b)({pad1d_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Object(d.b)(2===t.length,(function(){return"Invalid number of paddings. Must be length of 2."})),Object(wt.a)(e,[t],n)}});var It=Object(p.b)({pad2d_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Object(d.b)(2===t.length&&2===t[0].length&&2===t[1].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),Object(wt.a)(e,t,n)}});var St=Object(p.b)({pad3d_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Object(d.b)(3===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),Object(wt.a)(e,t,n)}});var Nt=Object(p.b)({pad4d_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Object(d.b)(4===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length&&2===t[3].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),Object(wt.a)(e,t,n)}}),jt=n(175),Tt=n(64),Ct=n(133),Et=n(154),_t=n(176);var At=Object(p.b)({raggedGather_:function(e,t,n,r){var a={paramsNestedSplits:e.map((function(e,t){return Object(l.a)(e,"tensors".concat(t),"raggedGather","int32")})),paramsDenseValues:Object(l.a)(t,"paramsDenseValues","raggedGather"),indices:Object(l.a)(n,"indices","raggedGather","int32")},i={outputRaggedRank:r},o=u.a.runKernel(c.kc,a,i);return{outputNestedSplits:o.slice(0,o.length-1),outputDenseValues:o[o.length-1]}}});var Rt=Object(p.b)({raggedTensorToTensor_:function(e,t,n,r,a){var i=Object(l.a)(e,"shape","raggedTensorToTensor","int32"),o=Object(l.a)(t,"values","raggedTensorToTensor"),s={shape:i,values:o,defaultValue:Object(l.a)(n,"defaultValue","raggedTensorToTensor",o.dtype),rowPartitionTensors:r.map((function(e,t){return Object(l.a)(e,"tensors".concat(t),"raggedTensorToTensor","int32")}))},d={rowPartitionTypes:a};return u.a.runKernel(c.lc,s,d)}});var Dt=Object(p.b)({rand_:function(e,t,n){var r=Object(d.O)(e),a=null;if(null==n||"float32"===n)a=new Float32Array(r);else if("int32"===n)a=new Int32Array(r);else{if("bool"!==n)throw new Error("Unknown data type ".concat(n));a=new Uint8Array(r)}for(var i=0;i<r;i++)a[i]=t();return u.a.makeTensor(a,e,n)}}),Ft=n(2),Mt=n(4),zt=n(200),Lt=(n(141),function(){function e(t,n,r,a,i){Object(Ft.a)(this,e),this.mean=t,this.stdDev=n,this.dtype=r,this.nextVal=NaN,this.truncated=a,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var o=i||Math.random();this.random=zt.alea(o.toString())}return Object(Mt.a)(e,[{key:"nextValue",value:function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,n,r=!1;!r;){var a=void 0,i=void 0,o=void 0;do{o=(a=2*this.random()-1)*a+(i=2*this.random()-1)*i}while(o>=1||0===o);var s=Math.sqrt(-2*Math.log(o)/o);t=this.mean+this.stdDev*a*s,n=this.mean+this.stdDev*i*s,this.truncated&&!this.isValidTruncated(t)||(r=!0)}return this.truncated&&!this.isValidTruncated(n)||(this.nextVal=this.convertValue(n)),this.convertValue(t)}},{key:"convertValue",value:function(e){return null==this.dtype||"float32"===this.dtype?e:Math.round(e)}},{key:"isValidTruncated",value:function(e){return e<=this.upper&&e>=this.lower}}]),e}()),Pt=function(){function e(t,n,r,a){Object(Ft.a)(this,e),this.alpha=t,this.beta=1/n,this.dtype=r;var i=a||Math.random();this.randu=zt.alea(i.toString()),this.randn=new Lt(0,1,r,!1,this.randu()),this.d=t<1?t+2/3:t-1/3,this.c=1/Math.sqrt(9*this.d)}return Object(Mt.a)(e,[{key:"nextValue",value:function(){for(var e,t,n,r,a,i;;){do{r=this.randn.nextValue(),i=1+this.c*r}while(i<=0);if(i*=i*i,t=1-.331*(e=r*r)*e,n=.5*e+this.d*(1-i+Math.log(i)),(a=this.randu())<t||Math.log(a)<n)break}return i=1/this.beta*this.d*i,this.alpha<1&&(i*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(i)}},{key:"convertValue",value:function(e){return"float32"===this.dtype?e:Math.round(e)}}]),e}(),Bt=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if(Object(Ft.a)(this,e),this.canReturnFloat=function(){return null==t.dtype||"float32"===t.dtype},this.min=n,this.range=r-n,this.dtype=a,null==i&&(i=Math.random()),"number"===typeof i&&(i=i.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between ".concat(n," - ").concat(r," <= 1 and dtype is not float"));this.random=zt.alea(i)}return Object(Mt.a)(e,[{key:"convertValue",value:function(e){return this.canReturnFloat()?e:Math.round(e)}},{key:"nextValue",value:function(){return this.convertValue(this.min+this.range*this.random())}}]),e}();var Wt=Object(p.b)({randomGamma_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32",a=arguments.length>4?arguments[4]:void 0;if(null==n&&(n=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error("Unsupported data type ".concat(r));for(var i=new Pt(t,n,r,a),o=Object(V.a)(e,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}});var Ut=Object(p.b)({randomNormal_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;if(null!=r&&"bool"===r)throw new Error("Unsupported data type ".concat(r));for(var i=new Lt(t,n,r,!1,a),o=Object(V.a)(e,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}});var Vt=Object(p.b)({randomStandardNormal_:function(e,t,n){if(null!=t&&"bool"===t)throw new Error("Unsupported data type ".concat(t));return Ut(e,0,1,t,n)}});var Gt=Object(p.b)({randomUniform_:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32",a=arguments.length>4?arguments[4]:void 0,i=Object(V.a)(e,r),o=new Bt(t,n,null,a),s=0;s<i.values.length;s++)i.values[s]=o.nextValue();return i.toTensor()}});function Ht(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32";if(0===n)throw new Error("Cannot have a step of zero");var a={start:e,stop:t,step:n,dtype:r};return u.a.runKernel(c.mc,{},a)}var qt=n(97),Kt=n(221),Xt=n(90),Yt=n(134),Zt=n(60);var Jt=Object(p.b)({reverse1d_:function(e){var t=Object(l.a)(e,"x","reverse");return d.b(1===t.rank,(function(){return"Error in reverse1D: x must be rank 1 but got rank ".concat(t.rank,".")})),Object(Zt.a)(t,0)}});var Qt=Object(p.b)({reverse2d_:function(e,t){var n=Object(l.a)(e,"x","reverse");return d.b(2===n.rank,(function(){return"Error in reverse2D: x must be rank 2 but got rank ".concat(n.rank,".")})),Object(Zt.a)(n,t)}});var $t=Object(p.b)({reverse3d_:function(e,t){var n=Object(l.a)(e,"x","reverse");return d.b(3===n.rank,(function(){return"Error in reverse3D: x must be rank 3 but got rank ".concat(n.rank,".")})),Object(Zt.a)(n,t)}});var en=Object(p.b)({reverse4d_:function(e,t){var n=Object(l.a)(e,"x","reverse");return d.b(4===n.rank,(function(){return"Error in reverse4D: x must be rank 4 but got rank ".concat(n.rank,".")})),Object(Zt.a)(n,t)}}),tn=n(177),nn=n(178),rn=n(28),an=n(179),on=n(180),sn=n(1),un=n.n(sn),cn=n(8);function ln(){return(ln=Object(cn.a)(un.a.mark((function e(t,n){var r,a,i,o,s,u,c,p,f,h,m;return un.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Object(l.a)(t,"x","setdiff1d"),a=Object(l.a)(n,"y","setdiff1d"),d.b(r.dtype===a.dtype,(function(){return"x and y should have the same dtype, but got x (".concat(r.dtype,") and y (").concat(a.dtype,").")})),d.b(1===r.rank,(function(){return"x should be 1D tensor, but got x (".concat(r.shape,").")})),d.b(1===a.rank,(function(){return"y should be 1D tensor, but got y (".concat(a.shape,").")})),e.next=7,r.data();case 7:return i=e.sent,e.next=10,a.data();case 10:for(o=e.sent,s=new Set(o),u=0,c=0;c<i.length;c++)s.has(i[c])||u++;for(p=new it.b([u],r.dtype),f=new it.b([u],"int32"),h=0,m=0;h<i.length;h++)s.has(i[h])||(p.values[m]=i[h],f.values[m]=h,m++);return e.abrupt("return",[p.toTensor(),f.toTensor()]);case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var dn=function(e,t){return ln.apply(this,arguments)},pn=n(222),fn=n(181),hn=n(182);var mn=Object(p.b)({slice1d_:function(e,t,n){var r=Object(l.a)(e,"x","slice1d");return d.b(1===r.rank,(function(){return"slice1d expects a rank-1 tensor, but got a rank-".concat(r.rank," tensor")})),Object(A.a)(r,[t],[n])}});var vn=Object(p.b)({slice2d_:function(e,t,n){var r=Object(l.a)(e,"x","slice2d");return d.b(2===r.rank,(function(){return"slice2d expects a rank-2 tensor, but got a rank-".concat(r.rank," tensor")})),Object(A.a)(r,t,n)}});var bn=Object(p.b)({slice3d_:function(e,t,n){var r=Object(l.a)(e,"x","slice3d");return d.b(3===r.rank,(function(){return"slice3d expects a rank-3 tensor, but got a rank-".concat(r.rank," tensor")})),Object(A.a)(r,t,n)}});var gn=Object(p.b)({slice4d_:function(e,t,n){var r=Object(l.a)(e,"x","slice4d");return d.b(4===r.rank,(function(){return"slice4d expects a rank-4 tensor, but got a rank-".concat(r.rank," tensor")})),Object(A.a)(r,t,n)}}),yn=n(223),xn=n(170),kn=n(108),wn=n(135),On=n(115),In=n(183),Sn=n(136),Nn=n(71),jn=n(47),Tn=n(137),Cn=n(109),En=n(72),_n=n(91),An=n(224),Rn=n(27),Dn=n(225),Fn=n(94),Mn=n(62);function zn(e,t){Object(d.d)(e);var n=Object(l.c)(e,t);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Object(Mn.a)(e,null,n,t)}function Ln(e,t,n){if(Object(d.d)(e),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");var r=Object(l.c)(e,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Object(Mn.a)(e,t,r,n)}var Pn=n(184);function Bn(e,t,n){if(Object(d.d)(e),null!=t&&4!==t.length)throw new Error("tensor4d() requires shape to have four numbers");var r=Object(l.c)(e,n);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Object(Mn.a)(e,t,r,n)}function Wn(e,t,n){if(Object(d.d)(e),null!=t&&5!==t.length)throw new Error("tensor5d() requires shape to have five numbers");var r=Object(l.c)(e,n);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Object(Mn.a)(e,t,r,n)}function Un(e,t,n){if(Object(d.d)(e),null!=t&&6!==t.length)throw new Error("tensor6d() requires shape to have six numbers");var r=Object(l.c)(e,n);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return t=t||r,Object(Mn.a)(e,t,r,n)}var Vn=n(185);var Gn=Object(p.b)({truncatedNormal_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;if(null!=r&&"bool"===r)throw new Error("Unsupported data type $ { dtype }");for(var i=new Lt(t,n,r,!0,a),o=Object(V.a)(e,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}}),Hn=n(186),qn=n(138),Kn=n(92);function Xn(e,t){return Ze(e,t,"right")}function Yn(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;return u.a.makeVariable(e,t,n,r)}var Zn=n(44),Jn=n(187);function Qn(){return(Qn=Object(cn.a)(un.a.mark((function e(t){var n,r,a;return un.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object(l.a)(t,"condition","whereAsync","bool"),e.next=3,n.data();case 3:return r=e.sent,a=Object(Jn.a)(n.shape,r),t!==n&&n.dispose(),e.abrupt("return",a);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var $n=function(e){return Qn.apply(this,arguments)},er=n(89),tr=n(29);function nr(){return(nr=Object(cn.a)(un.a.mark((function e(t,n,r){var a,i,o,s,u,c,p,f,h,m,v,b,g;return un.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a=Object(l.a)(t,"tensor","boolMask"),i=Object(l.a)(n,"mask","boolMask","bool"),o=null==r?0:r,s=i.rank,u=a.shape,d.b(s>0,(function(){return"mask cannot be scalar"})),d.e(u.slice(o,o+s),i.shape,"mask's shape must match the first K dimensions of tensor's shape,"),c=1,p=o;p<o+s;p++)c*=u[p];return f=u.slice(0,o).concat([c],u.slice(o+s)),h=Object(N.a)(a,f),m=Object(N.a)(i,[-1]),e.next=14,$n(m);case 14:return v=e.sent,b=Object(Cn.a)(v,[1]),g=Object(Ce.a)(h,b,o),t!==a&&a.dispose(),n!==i&&i.dispose(),b.dispose(),h.dispose(),m.dispose(),v.dispose(),e.abrupt("return",g);case 24:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var rr=function(e,t,n){return nr.apply(this,arguments)},ar=n(61),ir=n(103),or=n(32);var sr=Object(p.b)({movingAverage_:function(e,t,n,r){var a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=Object(l.a)(e,"v","movingAverage"),o=Object(l.a)(t,"x","movingAverage"),u=Object(l.a)(n,"decay","movingAverage");Object(or.assertTypesMatch)(i,o),d.b(d.a(i.shape,o.shape),(function(){return"Shape mismatch in v and x"}));var c=Object(rn.a)(1),p=Object(ft.a)(c,u),f=Object(E.a)(Object(ft.a)(o,i),p);if(a){d.b(null!=r,(function(){return"When using zeroDebias: true, step is required."}));var h=Object(l.a)(r,"step","movingAverage");f=Object(fe.a)(f,Object(ft.a)(c,Object(Tt.a)(u,h)))}return Object(s.a)(i,f)}}),ur=n(118);var cr=Object(p.b)({scatterND_:function(e,t,n){var r=Object(l.a)(e,"indices","scatterND","int32"),a=Object(l.a)(t,"updates","scatterND");ur.b(a,r,n);var i={indices:r,updates:a},o={shape:n};return u.a.runKernel(c.Bc,i,o)}});function lr(e,t,n,r){if("int32"!==e.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type,"+" but the dtype was ".concat(e.dtype,"."));if(e.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix,"+" but got shape ".concat(e.shape,"."));var a=e.rank>0?e.shape[0]:1,i=e.rank>1?e.shape[1]:1;if(n.length!==i)throw new Error("outputShape has incorrect number of elements:,"+" ".concat(n.length,", should be: ").concat(i,"."));var o=t.size;if(0!==t.rank&&(1!==t.rank||o!==a))throw new Error("sparseValues has incorrect shape "+"".concat(t.shape,", should be [] or [").concat(a,"]"));if(t.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}var dr=Object(p.b)({sparseToDense_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=Object(l.a)(e,"sparseIndices","sparseToDense","int32"),i=Object(l.a)(t,"sparseValues","sparseToDense","string_or_numeric"),o=Object(l.a)(r,"defaultValue","sparseToDense",i.dtype);lr(a,i,n,o);var s={sparseIndices:a,sparseValues:i,defaultValue:o},d={outputShape:n};return u.a.runKernel(c.Rc,s,d)}});var pr=Object(p.b)({gatherND_:function(e,t){var n=Object(l.a)(t,"indices","gatherND","int32"),r={params:Object(l.a)(e,"x","gatherND","string_or_numeric"),indices:n};return u.a.runKernel(c.ob,r)}});var fr=Object(p.b)({dropout_:function(e,t,n,r){var a=Object(l.a)(e,"x","dropout");if(d.b("float32"===a.dtype,(function(){return"x has to be a floating point tensor since it's going to be "+"scaled, but got a ".concat(a.dtype," tensor instead.")})),d.b(t>=0&&t<1,(function(){return"rate must be a float in the range [0, 1), but got ".concat(t,".")})),0===t)return e instanceof it.a?a.clone():a;var i=function(e,t){if(null==t)return e.shape.slice();if(d.a(e.shape,t))return t;if(e.shape.length===t.length){for(var n=[],r=0;r<e.shape.length;r++)null==t[r]&&null!=e.shape[r]?n.push(e.shape[r]):n.push(t[r]);return n}return t}(a,n),o=1-t,u=Object(fe.a)(Object(je.a)(Object(s.a)(Gt(i,0,1,"float32",r),o)),o);return Object(E.a)(a,u)}});function hr(e){return Math.floor(Math.pow(2,Math.ceil(Math.log(e)/Math.log(2))))}function mr(e,t,n){for(var r=1-e%2,a=new Float32Array(e),i=0;i<e;++i){var o=2*Math.PI*i/(e+r-1);a[i]=t-n*Math.cos(o)}return zn(a,"float32")}function vr(){return(vr=Object(cn.a)(un.a.mark((function e(t,n){var r,a,i,o,s,u,c,p,f,h,m,v,b,g,y,x=arguments;return un.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=x.length>2&&void 0!==x[2]?x[2]:1,a=Object(l.a)(t,"predictions","inTopK"),i=Object(l.a)(n,"targets","inTopK"),Object(d.b)(a.rank>1,(function(){return"inTopK() expects the predictions to be of rank 2 or higher, "+"but got ".concat(a.rank)})),Object(d.b)(a.rank-1===i.rank,(function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+"".concat(a.rank," and targets rank ").concat(i.rank)})),Object(d.e)(a.shape.slice(0,a.shape.length-1),i.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),o=a.shape[a.shape.length-1],Object(d.b)(r>0&&r<=o,(function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last "+"dimension (".concat(o,"), but got ").concat(r)})),e.next=10,a.data();case 10:return s=e.sent,e.next=13,i.data();case 13:u=e.sent,c=s.length/o,p=o,f=Object(d.o)("bool",c),h=0;case 17:if(!(h<c)){e.next=35;break}for(m=h*p,v=s.subarray(m,m+p),b=[],g=0;g<v.length;g++)b.push({value:v[g],index:g});b.sort((function(e,t){return t.value-e.value})),f[h]=0,y=0;case 25:if(!(y<r)){e.next=32;break}if(b[y].index!==u[h]){e.next=29;break}return f[h]=1,e.abrupt("break",32);case 29:y++,e.next=25;break;case 32:h++,e.next=17;break;case 35:return t!==a&&a.dispose(),n!==i&&i.dispose(),e.abrupt("return",Object(Fn.a)(f,i.shape,"bool"));case 38:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var br=function(e,t){return vr.apply(this,arguments)},gr=n(3),yr=n(45),xr=n(26),kr=n(142),wr=n(140),Or=n(54);var Ir=Object(p.b)({fusedConv2d_:function(e){var t=e.x,n=e.filter,r=e.strides,a=e.pad,i=e.dataFormat,o=void 0===i?"NHWC":i,p=e.dilations,f=void 0===p?[1,1]:p,h=e.dimRoundingMode,m=e.bias,v=e.activation,b=void 0===v?"linear":v,g=e.preluActivationWeights,y=e.leakyreluAlpha;if(b=b||"linear",!1===Object(Or.d)(u.a.state.gradientDepth,b)){d.b("NHWC"===o,(function(){return"Error in fused conv2d: got dataFormat of ".concat(o," but ")+"only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear."}));var x=Object($.a)(t,n,r,a,o,f,h);return null!=m&&(x=Object(s.a)(x,m)),Object(Or.a)(x,b,g,y)}var k=Object(l.a)(t,"x","conv2d","float32"),w=Object(l.a)(n,"filter","conv2d","float32"),O=k,S=!1;3===k.rank&&(S=!0,O=Object(N.a)(k,[1,k.shape[0],k.shape[1],k.shape[2]])),d.b(4===O.rank,(function(){return"Error in fused conv2d: input must be rank 4, but got rank "+"".concat(O.rank,".")})),d.b(4===w.rank,(function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+"".concat(w.rank,".")})),I.a("fused conv2d",a,h);var j="NHWC"===o?O.shape[3]:O.shape[1];d.b(w.shape[2]===j,(function(){return"Error in conv2d: depth of input (".concat(j,") must match ")+"input depth for filter ".concat(w.shape[2],".")})),d.b(I.i(r,f),(function(){return"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(r," and dilations '").concat(f,"'")}));var T,C,E=I.b(O.shape,w.shape,r,f,a,h);if(null!=m){T=Object(l.a)(m,"bias","fused conv2d");var _=Object(or.makeTypesMatch)(T,k),A=Object(gr.a)(_,1);T=A[0],"NHWC"===o?xr.assertAndGetBroadcastShape(E.outShape,T.shape):(d.b(T.shape.length<=1,(function(){return"Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of "+"rank-".concat(T.shape.length,".")})),d.b(0===T.shape.length||T.shape[0]===E.outChannels||1===T.shape[0],(function(){return"Error in fused conv2d: bias shape (".concat(T.shape,") is not ")+"compatible with the number of output channels "+"(".concat(E.outChannels,")")})))}if(null!=g){var R=g.shape;if(d.b(R.length<=1||3===R.length,(function(){return"Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of "+"rank-".concat(R.length,".")})),1===R.length)d.b(1===R[0]||R[0]===E.outChannels,(function(){return"Error in fused conv2d: PReLU activation weights "+"(".concat(R,") is not compatible with the number of output ")+"channels (".concat(E.outChannels,").")}));else if(3===R.length)try{xr.assertAndGetBroadcastShape(R,E.outShape)}catch(L){var D="Error in fused conv2d: PReLU activation weights (".concat(R,") ")+"is not compatible with the output shape of the conv2d "+"(".concat(E.outShape,").");throw Error(D)}C=Object(l.a)(g,"prelu weights","fused conv2d")}var F=function(e,t){d.b("NHWC"===o,(function(){return"Error in gradient of fused conv2D: got dataFormat of ".concat(o," but only NHWC is currently supported.")}));var n=Object(gr.a)(t,4),i=n[0],s=n[1],u=n[2],c=n[3],l=Object(Or.c)(e,u,b);d.b(I.j(f),(function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 "+"are not yet supported in gradients. Got dilations '".concat(f,"'")}));var p=[Object(wr.a)(s.shape,l,i,r,a),Object(kr.a)(s,l,i.shape,r,a)];if(null!=c){var h=Object(Or.b)(c,l);p.push(h)}return p},M={x:O,filter:w,bias:T,preluActivationWeights:C},z={strides:r,pad:a,dataFormat:o,dilations:f,dimRoundingMode:h,activation:b,leakyreluAlpha:y};return null==m?Object(yr.a)((function(e,t,n){var r=u.a.runKernel(c.mb,M,z);return n([t,e,r]),S&&(r=Object(N.a)(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:F}}))(O,w):Object(yr.a)((function(e,t,n,r){var a=u.a.runKernel(c.mb,M,z);return r([t,e,a,n]),S&&(a=Object(N.a)(a,[a.shape[1],a.shape[2],a.shape[3]])),{value:a,gradFunc:F}}))(O,w,T)}}),Sr=n(198),Nr=n(197);var jr=Object(p.b)({fusedDepthwiseConv2d_:function(e){var t=e.x,n=e.filter,r=e.strides,a=e.pad,i=e.dataFormat,o=void 0===i?"NHWC":i,p=e.dilations,f=void 0===p?[1,1]:p,h=e.dimRoundingMode,m=e.bias,v=e.activation,b=void 0===v?"linear":v,g=e.preluActivationWeights,y=e.leakyreluAlpha;if(!1===Object(Or.d)(u.a.state.gradientDepth,b)){var x=Object(le.a)(t,n,r,a,o,f,h);return null!=m&&(x=Object(s.a)(x,m)),Object(Or.a)(x,b,g,y)}var k=Object(l.a)(t,"x","depthwiseConv2d","float32"),w=Object(l.a)(n,"filter","depthwiseConv2d","float32"),O=k,S=!1;3===k.rank&&(S=!0,O=Object(N.a)(k,[1,k.shape[0],k.shape[1],k.shape[2]])),d.b(4===O.rank,(function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got "+"rank ".concat(O.rank,".")})),d.b(4===w.rank,(function(){return"Error in fused depthwiseConv2d: filter must be rank 4, "+"but got rank ".concat(w.rank,".")})),d.b(O.shape[3]===w.shape[2],(function(){return"Error in fused depthwiseConv2d: number of input channels "+"(".concat(O.shape[3],") must match the inChannels dimension in ")+"filter ".concat(w.shape[2],".")})),null==f&&(f=[1,1]),d.b(I.i(r,f),(function(){return"Error in fused depthwiseConv2d: Either strides or dilations must "+"be 1. Got strides ".concat(r," and dilations '").concat(f,"'")})),I.a("fused depthwiseConv2d",a,h);var j,T,C=I.b(O.shape,w.shape,r,f,a,h,!0);if(null!=m){j=Object(l.a)(m,"bias","fused conv2d");var E=Object(or.makeTypesMatch)(j,k),_=Object(gr.a)(E,1);j=_[0],xr.assertAndGetBroadcastShape(C.outShape,j.shape)}null!=g&&(T=Object(l.a)(g,"prelu weights","fused depthwiseConv2d"));var A=function(e,t){d.b(I.j(f),(function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations "+"'".concat(f,"'")}));var n=Object(gr.a)(t,4),i=n[0],o=n[1],s=n[2],u=n[3],c=Object(Or.c)(e,s,b),l=Object(Nr.a)(o.shape,c,i,r,a,f,h),p=Object(Sr.a)(o,c,i.shape,r,a,f,h);return null!=u?[l,p,Object(Or.b)(j,c)]:[l,p]},R={x:O,filter:w,bias:j,preluActivationWeights:T},D={strides:r,pad:a,dataFormat:o,dilations:f,dimRoundingMode:h,activation:b,leakyreluAlpha:y};return null==m?Object(yr.a)((function(e,t,n){var r=u.a.runKernel(c.nb,R,D);return n([t,e,r]),S&&(r=Object(N.a)(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:A}}))(O,w):Object(yr.a)((function(e,t,n,r){var a=u.a.runKernel(c.nb,R,D);return r([t,e,a,n]),S&&(a=Object(N.a)(a,[a.shape[1],a.shape[2],a.shape[3]])),{value:a,gradFunc:A}}))(O,w,j)}});var Tr=Object(p.b)({fusedMatMul_:function(e){var t=e.a,n=e.b,r=e.transposeA,a=void 0!==r&&r,i=e.transposeB,o=void 0!==i&&i,p=e.bias,f=e.activation,h=void 0===f?"linear":f,m=e.preluActivationWeights,v=e.leakyreluAlpha,b=void 0===v?.2:v;if(!1===Object(Or.d)(u.a.state.gradientDepth,h)){var g=Object(C.a)(t,n,a,o);return null!=p&&(g=Object(s.a)(g,p)),Object(Or.a)(g,h,m,b)}var y=Object(l.a)(t,"a","fused matMul"),x=Object(l.a)(n,"b","fused matMul"),k=Object(or.makeTypesMatch)(y,x),w=Object(gr.a)(k,2);y=w[0],x=w[1];var O=a?y.shape[y.rank-2]:y.shape[y.rank-1],I=o?x.shape[x.rank-1]:x.shape[x.rank-2],S=a?y.shape[y.rank-1]:y.shape[y.rank-2],j=o?x.shape[x.rank-2]:x.shape[x.rank-1],T=y.shape.slice(0,-2),E=x.shape.slice(0,-2),_=d.O(T),A=d.O(E);d.b(O===I,(function(){return"Error in fused matMul: inner shapes (".concat(O,") and (")+"".concat(I,") of Tensors with shapes ").concat(y.shape," and ")+"".concat(x.shape," and transposeA=").concat(a)+" and transposeB=".concat(o," must match.")}));var R,D,F=xr.assertAndGetBroadcastShape(y.shape.slice(0,-2),x.shape.slice(0,-2)).concat([S,j]),M=a?Object(N.a)(y,[_,O,S]):Object(N.a)(y,[_,S,O]),z=o?Object(N.a)(x,[A,j,I]):Object(N.a)(x,[A,I,j]);if(null!=p){R=Object(l.a)(p,"bias","fused matMul");var L=Object(or.makeTypesMatch)(R,y);R=Object(gr.a)(L,1)[0],xr.assertAndGetBroadcastShape(F,R.shape)}null!=m&&(D=Object(l.a)(m,"prelu weights","fused matMul"));var P=function(e,t){var n,r,i=Object(gr.a)(t,4),s=i[0],u=i[1],c=i[2],l=i[3],d=Object(Or.c)(Object(N.a)(e,c.shape),c,h);return a||o?!a&&o?(n=Object(C.a)(d,u,!1,!1),r=Object(C.a)(d,s,!0,!1)):a&&!o?(n=Object(C.a)(u,d,!1,!0),r=Object(C.a)(s,d,!1,!1)):(n=Object(C.a)(u,d,!0,!0),r=Object(C.a)(d,s,!0,!0)):(n=Object(C.a)(d,u,!1,!0),r=Object(C.a)(s,d,!0,!1)),null!=p?[n,r,Object(Or.b)(l,d)]:[n,r]},B={a:M,b:z,bias:R,preluActivationWeights:D},W={transposeA:a,transposeB:o,activation:h,leakyreluAlpha:b};return null==p?Object(yr.a)((function(e,t,n){var r=u.a.runKernel(c.nd,B,W);return n([e,t,r]),{value:Object(N.a)(r,F),gradFunc:P}}))(M,z):Object(yr.a)((function(e,t,n,r){var a=u.a.runKernel(c.nd,B,W);return r([e,t,a,n]),{value:Object(N.a)(a,F),gradFunc:P}}))(M,z,R)}});var Cr=Object(p.b)({hammingWindow_:function(e){return mr(e,.54,.46)}});var Er=Object(p.b)({hannWindow_:function(e){return mr(e,.5,.5)}});var _r=Object(p.b)({frame_:function(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=0,o=[];i+t<=e.size;)o.push(Object(A.a)(e,i,t)),i+=n;if(r)for(;i<e.size;){var s=i+t-e.size,u=Object(T.a)([Object(A.a)(e,i,t-s),Object(Ne.a)([s],a)]);o.push(u),i+=n}return 0===o.length?Ln([],[0,t]):Object(N.a)(Object(T.a)(o),[o.length,t])}});var Ar=Object(p.b)({stft_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Er;null==r&&(r=hr(t));var i=_r(e,t,n),o=Object(E.a)(i,a(t));return Object(Sn.a)(o,r)}});var Rr=Object(p.b)({cropAndResize_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"bilinear",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=Object(l.a)(e,"image","cropAndResize"),s=Object(l.a)(t,"boxes","cropAndResize","float32"),p=Object(l.a)(n,"boxInd","cropAndResize","int32"),f=s.shape[0];d.b(4===o.rank,(function(){return"Error in cropAndResize: image must be rank 4,"+"but got rank ".concat(o.rank,".")})),d.b(2===s.rank&&4===s.shape[1],(function(){return"Error in cropAndResize: boxes must be have size [".concat(f,",4] ")+"but had shape ".concat(s.shape,".")})),d.b(1===p.rank&&p.shape[0]===f,(function(){return"Error in cropAndResize: boxInd must be have size [".concat(f,"] ")+"but had shape ".concat(s.shape,".")})),d.b(2===r.length,(function(){return"Error in cropAndResize: cropSize must be of length 2, but got "+"length ".concat(r.length,".")})),d.b(r[0]>=1&&r[1]>=1,(function(){return"cropSize must be atleast [1,1], but was ".concat(r)})),d.b("bilinear"===a||"nearest"===a,(function(){return"method must be bilinear or nearest, but was ".concat(a)}));var h={image:o,boxes:s,boxInd:p},m={method:a,extrapolationValue:i,cropSize:r},v=u.a.runKernel(c.L,h,m);return v}});var Dr=Object(p.b)({flipLeftRight_:function(e){var t=Object(l.a)(e,"image","flipLeftRight","float32");d.b(4===t.rank,(function(){return"Error in flipLeftRight: image must be rank 4,"+"but got rank ".concat(t.rank,".")}));var n={image:t};return u.a.runKernel(c.hb,n,{})}});var Fr=Object(p.b)({grayscaleToRGB_:function(e){var t=Object(l.a)(e,"image","grayscaleToRGB"),n=t.rank-1,r=t.shape[n];d.b(t.rank>=2,(function(){return"Error in grayscaleToRGB: images must be at least rank 2, "+"but got rank ".concat(t.rank,".")})),d.b(1===r,(function(){return"Error in grayscaleToRGB: last dimension of a grayscale image "+"should be size 1, but got size ".concat(r,".")}));var a=new Array(t.rank);return a.fill(1,0,n),a[n]=3,Object(Ie.a)(t,a)}});var Mr=Object(p.b)({rotateWithOffset_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=Object(l.a)(e,"image","rotateWithOffset","float32");d.b(4===a.rank,(function(){return"Error in rotateWithOffset: image must be rank 4,"+"but got rank ".concat(a.rank,".")}));var i={image:a},o={radians:t,fillValue:n,center:r},s=u.a.runKernel(c.yc,i,o);return s}});function zr(e,t,n,r,a,i){null==r&&(r=.5),null==a&&(a=Number.NEGATIVE_INFINITY),null==i&&(i=0);var o=e.shape[0];return n=Math.min(n,o),d.b(0<=r&&r<=1,(function(){return"iouThreshold must be in [0, 1], but was '".concat(r,"'")})),d.b(2===e.rank,(function(){return"boxes must be a 2D tensor, but was of rank '".concat(e.rank,"'")})),d.b(4===e.shape[1],(function(){return"boxes must have 4 columns, but 2nd dimension was ".concat(e.shape[1])})),d.b(1===t.rank,(function(){return"scores must be a 1D tensor"})),d.b(t.shape[0]===o,(function(){return"scores has incompatible shape with boxes. Expected ".concat(o,", ")+"but was ".concat(t.shape[0])})),d.b(0<=i&&i<=1,(function(){return"softNmsSigma must be in [0, 1], but was '".concat(i,"'")})),{maxOutputSize:n,iouThreshold:r,scoreThreshold:a,softNmsSigma:i}}var Lr=Object(p.b)({nonMaxSuppression_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=Object(l.a)(e,"boxes","nonMaxSuppression","float32"),o=Object(l.a)(t,"scores","nonMaxSuppression","float32"),s=zr(i,o,n,r,a),d={maxOutputSize:n=s.maxOutputSize,iouThreshold:r=s.iouThreshold,scoreThreshold:a=s.scoreThreshold};return u.a.runKernel(c.Zb,{boxes:i,scores:o},d)}}),Pr=n(87);function Br(){return(Br=Object(cn.a)(un.a.mark((function e(t,n,r){var a,i,o,s,u,c,d,p,f,h,m=arguments;return un.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=m.length>3&&void 0!==m[3]?m[3]:.5,i=m.length>4&&void 0!==m[4]?m[4]:Number.NEGATIVE_INFINITY,o=Object(l.a)(t,"boxes","nonMaxSuppressionAsync"),s=Object(l.a)(n,"scores","nonMaxSuppressionAsync"),u=zr(o,s,r,a,i),r=u.maxOutputSize,a=u.iouThreshold,i=u.scoreThreshold,e.next=10,Promise.all([o.data(),s.data()]);case 10:return c=e.sent,d=c[0],p=c[1],f=Object(Pr.a)(d,p,r,a,i),h=f.selectedIndices,o!==t&&o.dispose(),s!==n&&s.dispose(),e.abrupt("return",zn(h,"int32"));case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Wr=function(e,t,n){return Br.apply(this,arguments)};var Ur=Object(p.b)({nonMaxSuppressionWithScore_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=Object(l.a)(e,"boxes","nonMaxSuppression"),s=Object(l.a)(t,"scores","nonMaxSuppression"),d=zr(o,s,n,r,a,i),p={boxes:o,scores:s},f={maxOutputSize:n=d.maxOutputSize,iouThreshold:r=d.iouThreshold,scoreThreshold:a=d.scoreThreshold,softNmsSigma:i=d.softNmsSigma},h=u.a.runKernel(c.bc,p,f);return{selectedIndices:h[0],selectedScores:h[1]}}});function Vr(){return(Vr=Object(cn.a)(un.a.mark((function e(t,n,r){var a,i,o,s,u,c,d,p,f,h,m,v,b=arguments;return un.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=b.length>3&&void 0!==b[3]?b[3]:.5,i=b.length>4&&void 0!==b[4]?b[4]:Number.NEGATIVE_INFINITY,o=b.length>5&&void 0!==b[5]?b[5]:0,s=Object(l.a)(t,"boxes","nonMaxSuppressionAsync"),u=Object(l.a)(n,"scores","nonMaxSuppressionAsync"),c=zr(s,u,r,a,i,o),r=c.maxOutputSize,a=c.iouThreshold,i=c.scoreThreshold,o=c.softNmsSigma,e.next=12,Promise.all([s.data(),u.data()]);case 12:return d=e.sent,p=d[0],f=d[1],h=Object(Pr.c)(p,f,r,a,i,o),m=h.selectedIndices,v=h.selectedScores,s!==t&&s.dispose(),u!==n&&u.dispose(),e.abrupt("return",{selectedIndices:zn(m,"int32"),selectedScores:zn(v)});case 19:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Gr=function(e,t,n){return Vr.apply(this,arguments)};var Hr=Object(p.b)({nonMaxSuppressionPadded_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=Object(l.a)(e,"boxes","nonMaxSuppression"),s=Object(l.a)(t,"scores","nonMaxSuppression"),d=zr(o,s,n,r,a,null),p=d.maxOutputSize,f=d.iouThreshold,h=d.scoreThreshold,m={boxes:o,scores:s},v={maxOutputSize:p,iouThreshold:f,scoreThreshold:h,padToMaxOutputSize:i},b=u.a.runKernel(c.ac,m,v);return{selectedIndices:b[0],validOutputs:b[1]}}});function qr(){return(qr=Object(cn.a)(un.a.mark((function e(t,n,r){var a,i,o,s,u,c,d,p,f,h,m,v,b,g,y,x,k=arguments;return un.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=k.length>3&&void 0!==k[3]?k[3]:.5,i=k.length>4&&void 0!==k[4]?k[4]:Number.NEGATIVE_INFINITY,o=k.length>5&&void 0!==k[5]&&k[5],s=Object(l.a)(t,"boxes","nonMaxSuppressionAsync"),u=Object(l.a)(n,"scores","nonMaxSuppressionAsync"),c=zr(s,u,r,a,i,null),d=c.maxOutputSize,p=c.iouThreshold,f=c.scoreThreshold,e.next=11,Promise.all([s.data(),u.data()]);case 11:return h=e.sent,m=Object(gr.a)(h,2),v=m[0],b=m[1],g=Object(Pr.b)(v,b,d,p,f,o),y=g.selectedIndices,x=g.validOutputs,s!==t&&s.dispose(),u!==n&&u.dispose(),e.abrupt("return",{selectedIndices:zn(y,"int32"),validOutputs:Object(rn.a)(x,"int32")});case 19:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Kr=function(e,t,n){return qr.apply(this,arguments)},Xr=n(196),Yr=n(195);function Zr(e,t){for(var n,r,a,i,o,u,c=zn([-1]),l=zn([0]),d=zn([0]),p=0;p<e.size-1;p++){n=Object(A.a)(e,0,p+1),r=Object(A.a)(e,p+1),o=Object(fe.a)(Object(Rn.a)(n),t),u=Object(fe.a)(Object(Rn.a)(r),t);var f=Object(Rn.a)(Object(E.a)(n,Ht(0,n.size)));a=Object(fe.a)(f,Object(Rn.a)(n));var h=Object(Ne.a)(r.shape,n.size),m=Object(s.a)(Ht(0,r.size),h),v=Object(E.a)(r,m);i=Object(fe.a)(Object(Rn.a)(v),Object(Rn.a)(r));var b=Object(ft.a)(a,i),g=Object(ft.a)(a,i),y=Object(E.a)(o,u);d=Object(E.a)(Object(E.a)(y,b),g);var x=Object(Ee.a)(d,l);l=Object(Zn.a)(x,d,l),c=Object(Zn.a)(x,zn([p]),c)}return c}var Jr=Object(p.b)({threshold_:function(e){var t,n,r,a,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"binary",o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,c=Object(l.a)(e,"image","threshold"),p=.2989,f=.587,h=.114,m=c.shape[0]*c.shape[1],v=Object(E.a)(zn([u]),255);if(d.b(3===c.rank,(function(){return"Error in threshold: image must be rank 3,"+"but got rank ".concat(c.rank,".")})),d.b(3===c.shape[2]||1===c.shape[2],(function(){return"Error in threshold: image color channel must be equal to 3 or 1"+"but got ".concat(c.shape[2],".")})),d.b("int32"===c.dtype||"float32"===c.dtype,(function(){return"Error in dtype: image dtype must be int32 or float32,"+"but got dtype ".concat(c.dtype,".")})),d.b("otsu"===i||"binary"===i,(function(){return"Method must be binary or otsu, but was ".concat(i)})),3===c.shape[2]){var b=Object(Nn.a)(c,[1,1,1],-1),g=Object(gr.a)(b,3);t=g[0],n=g[1],r=g[2];var y=Object(E.a)(t,p),x=Object(E.a)(n,f),k=Object(E.a)(r,h);a=Object(s.a)(Object(s.a)(y,x),k)}else a=e;if("otsu"===i){var w=B(Object(S.a)(Object(tn.a)(a),"int32"),Object(Fn.a)([]),256);v=Zr(w,m)}var O=o?Object(Le.a)(a,v):Object(Ee.a)(a,v),I=Object(S.a)(Object(E.a)(O,255),"int32");return I}});var Qr=Object(p.b)({transform_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"nearest",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"constant",a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5?arguments[5]:void 0,o=Object(l.a)(e,"image","transform","float32"),s=Object(l.a)(t,"transforms","transform","float32");d.b(4===o.rank,(function(){return"Error in transform: image must be rank 4,"+"but got rank ".concat(o.rank,".")})),d.b(2===s.rank&&(s.shape[0]===o.shape[0]||1===s.shape[0])&&8===s.shape[1],(function(){return"Error in transform: Input transform should be batch x 8 or 1 x 8"})),d.b(null==i||2===i.length,(function(){return"Error in transform: outputShape must be [height, width] or null, "+"but got ".concat(i,".")}));var p={image:o,transforms:s},f={interpolation:n,fillMode:r,fillValue:a,outputShape:i};return u.a.runKernel(c.hd,p,f)}});var $r=Object(p.b)({bandPart_:function(e,t,n){Object(d.b)(t%1===0,(function(){return"bandPart(): numLower must be an integer, got ".concat(t,".")})),Object(d.b)(n%1===0,(function(){return"bandPart(): numUpper must be an integer, got ".concat(n,".")}));var r=Object(l.a)(e,"a","bandPart");Object(d.b)(r.rank>=2,(function(){return"bandPart(): Rank must be at least 2, got ".concat(r.rank,".")}));var a=r.shape,i=r.shape.slice(-2),o=Object(gr.a)(i,2),s=o[0],u=o[1];if(!(t<=s))throw new Error("bandPart(): numLower (".concat(t,")")+" must not be greater than the number of rows (".concat(s,")."));if(!(n<=u))throw new Error("bandPart(): numUpper (".concat(n,")")+" must not be greater than the number of columns (".concat(u,")."));t<0&&(t=s),n<0&&(n=u);var c=Object(N.a)(Ht(0,s,1,"int32"),[-1,1]),p=Ht(0,u,1,"int32"),f=Object(ft.a)(c,p),h=Object(qe.a)(Object(Le.a)(f,Object(rn.a)(+t,"int32")),Object(_e.a)(f,Object(rn.a)(-n,"int32"))),m=Object(er.a)([s,u],r.dtype);return Object(N.a)(Object(En.a)(Object(Kn.a)(Object(N.a)(r,[-1,s,u])).map((function(e){return Object(Zn.a)(h,e,m)}))),a)}});var ea=Object(p.b)({gramSchmidt_:function(e){var t;Array.isArray(e)?function(){t=!1,Object(d.b)(null!=e&&e.length>0,(function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"}));for(var n=e[0].shape[0],r=function(t){Object(d.b)(e[t].shape[0]===n,(function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: "+"(".concat(e[t].shape[0]," vs. ").concat(n,")")}))},a=1;a<e.length;++a)r(a)}():(t=!0,e=Object(Nn.a)(e,e.shape[0],0).map((function(e){return Object(Cn.a)(e,[0])}))),Object(d.b)(e.length<=e[0].shape[0],(function(){return"Gram-Schmidt: Number of vectors (".concat(e.length,") exceeds ")+"number of dimensions (".concat(e[0].shape[0],").")}));for(var n=[],r=e,a=function(e){n.push(u.a.tidy((function(){var t=r[e];if(e>0)for(var a=0;a<e;++a){var i=Object(E.a)(Object(Rn.a)(Object(E.a)(n[a],t)),n[a]);t=Object(ft.a)(t,i)}return Object(fe.a)(t,Object(ir.a)(t,"euclidean"))})))},i=0;i<e.length;++i)a(i);return t?Object(En.a)(n,0):n}}),ta=n(35);function na(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return u.a.tidy((function(){Object(d.b)(2===e.shape.length,(function(){return"qr2d() requires a 2D Tensor, but got a ".concat(e.shape.length,"D Tensor.")}));for(var n=e.shape[0],r=e.shape[1],a=Se(n),i=Object(q.a)(e),o=Ln([[1]],[1,1]),s=Object(q.a)(o),c=n>=r?r:n,l=function(e){var t=i,c=s,l=a,d=u.a.tidy((function(){var t=Object(A.a)(i,[e,e],[n-e,1]),u=Object(ir.a)(t),c=Object(A.a)(i,[e,e],[1,1]),l=Object(Zn.a)(Object(Ee.a)(c,0),Ln([[-1]]),Ln([[1]])),d=Object(ft.a)(c,Object(E.a)(l,u)),p=Object(fe.a)(t,d);s=1===p.shape[0]?Object(q.a)(o):Object(T.a)([o,Object(A.a)(p,[1,0],[p.shape[0]-1,p.shape[1]])],0);var f=Object(bt.a)(Object(fe.a)(Object(C.a)(l,d),u)),h=Object(A.a)(i,[e,0],[n-e,r]),m=Object(E.a)(f,s),v=Object(ar.a)(s);if(0===e)i=Object(ft.a)(h,Object(C.a)(m,Object(C.a)(v,h)));else{var b=Object(ft.a)(h,Object(C.a)(m,Object(C.a)(v,h)));i=Object(T.a)([Object(A.a)(i,[0,0],[e,r]),b],0)}var g=Object(ar.a)(m),y=Object(A.a)(a,[0,e],[n,a.shape[1]-e]);if(0===e)a=Object(ft.a)(y,Object(C.a)(Object(C.a)(y,s),g));else{var x=Object(ft.a)(y,Object(C.a)(Object(C.a)(y,s),g));a=Object(T.a)([Object(A.a)(a,[0,0],[n,e]),x],1)}return[s,i,a]})),p=Object(gr.a)(d,3);s=p[0],i=p[1],a=p[2],Object(ta.b)([t,c,l])},p=0;p<c;++p)l(p);return!t&&n>r&&(a=Object(A.a)(a,[0,0],[n,r]),i=Object(A.a)(i,[0,0],[r,r])),[a,i]}))}var ra=Object(p.b)({qr_:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(Object(d.b)(e.rank>=2,(function(){return"qr() requires input tensor to have a rank >= 2, but got rank ".concat(e.rank)})),2===e.rank)return na(e,t);var n=e.shape.slice(0,e.shape.length-2).reduce((function(e,t){return e*t})),r=Object(Kn.a)(Object(N.a)(e,[n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),a=[],i=[];r.forEach((function(e){var n=na(e,t),r=Object(gr.a)(n,2),o=r[0],s=r[1];a.push(o),i.push(s)}));var o=Object(N.a)(Object(En.a)(a,0),e.shape),s=Object(N.a)(Object(En.a)(i,0),e.shape);return[o,s]}}),aa=n(46);var ia=Object(p.b)({computeWeightedLoss_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:aa.a.SUM_BY_NONZERO_WEIGHTS,r=Object(l.a)(e,"losses","computeWeightedLoss"),a=null;null!=t&&(a=Object(l.a)(t,"weights","computeWeightedLoss"));var i=null==a?r:Object(E.a)(r,a);if(n===aa.a.NONE)return i;if(n===aa.a.SUM)return Object(Rn.a)(i);if(n===aa.a.MEAN){if(null==a)return Object(rt.a)(i);var o=r.size/a.size,s=Object(fe.a)(Object(Rn.a)(i),Object(Rn.a)(a));return o>1?Object(fe.a)(s,Object(rn.a)(o)):s}if(n===aa.a.SUM_BY_NONZERO_WEIGHTS){if(null==a)return Object(fe.a)(Object(Rn.a)(i),Object(rn.a)(r.size));var u=Object(E.a)(a,Object(at.a)(r.shape)),c=Object(S.a)(Object(Rn.a)(Object(gt.a)(u,Object(rn.a)(0))),"float32");return Object(fe.a)(Object(Rn.a)(i),c)}throw Error("Unknown reduction: ".concat(n))}});var oa=Object(p.b)({absoluteDifference_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:aa.a.SUM_BY_NONZERO_WEIGHTS,i=Object(l.a)(e,"labels","absoluteDifference"),o=Object(l.a)(t,"predictions","absoluteDifference"),s=null;null!=n&&(s=Object(l.a)(n,"weights","absoluteDifference")),Object(d.e)(i.shape,o.shape,"Error in absoluteDifference: ");var u=Object(a.a)(Object(ft.a)(i,o));return ia(u,s,r)}});var sa=Object(p.b)({cosineDistance_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:aa.a.SUM_BY_NONZERO_WEIGHTS,i=Object(l.a)(e,"labels","cosineDistance"),o=Object(l.a)(t,"predictions","cosineDistance"),s=null;null!=r&&(s=Object(l.a)(r,"weights","cosineDistance")),Object(d.e)(i.shape,o.shape,"Error in cosineDistance: ");var u=Object(rn.a)(1),c=Object(ft.a)(u,Object(Rn.a)(Object(E.a)(i,o),n,!0));return ia(c,s,a)}});var ua=Object(p.b)({hingeLoss_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:aa.a.SUM_BY_NONZERO_WEIGHTS,a=Object(l.a)(e,"labels","hingeLoss"),i=Object(l.a)(t,"predictions","hingeLoss"),o=null;null!=n&&(o=Object(l.a)(n,"weights","hingeLoss")),Object(d.e)(a.shape,i.shape,"Error in hingeLoss: ");var s=Object(rn.a)(1);a=Object(ft.a)(Object(E.a)(Object(rn.a)(2),a),s);var u=Object(Xt.a)(Object(ft.a)(s,Object(E.a)(a,i)));return ia(u,o,r)}});var ca=Object(p.b)({huberLoss_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:aa.a.SUM_BY_NONZERO_WEIGHTS,o=Object(l.a)(e,"labels","huberLoss"),u=Object(l.a)(t,"predictions","huberLoss"),c=null;null!=n&&(c=Object(l.a)(n,"weights","huberLoss")),Object(d.e)(o.shape,u.shape,"Error in huberLoss: ");var p=Object(rn.a)(r),f=Object(a.a)(Object(ft.a)(u,o)),h=Object(ut.a)(f,p),m=Object(ft.a)(f,h),v=Object(s.a)(Object(E.a)(Object(rn.a)(.5),Object(pt.a)(h)),Object(E.a)(p,m));return ia(v,c,i)}});var la=Object(p.b)({logLoss_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e-7,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:aa.a.SUM_BY_NONZERO_WEIGHTS,i=Object(l.a)(e,"labels","logLoss"),o=Object(l.a)(t,"predictions","logLoss"),u=null;null!=n&&(u=Object(l.a)(n,"weights","logLoss")),Object(d.e)(i.shape,o.shape,"Error in logLoss: ");var c=Object(rn.a)(1),p=Object(rn.a)(r),f=Object(bt.a)(Object(E.a)(i,Object(We.a)(Object(s.a)(o,p)))),h=Object(E.a)(Object(ft.a)(c,i),Object(We.a)(Object(s.a)(Object(ft.a)(c,o),p))),m=Object(ft.a)(f,h);return ia(m,u,a)}});var da=Object(p.b)({meanSquaredError_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:aa.a.SUM_BY_NONZERO_WEIGHTS,a=Object(l.a)(e,"labels","meanSquaredError"),i=Object(l.a)(t,"predictions","meanSquaredError"),o=null;null!=n&&(o=Object(l.a)(n,"weights","meanSquaredError")),Object(d.e)(a.shape,i.shape,"Error in meanSquaredError: ");var s=Object(Tn.a)(a,i);return ia(s,o,r)}});function pa(e,t){var n=Object(l.a)(e,"labels","sigmoidCrossEntropyWithLogits"),r=Object(l.a)(t,"logits","sigmoidCrossEntropyWithLogits");Object(d.e)(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var i=Object(Xt.a)(r),o=Object(E.a)(r,n),u=Object(Ue.a)(Object(ke.a)(Object(bt.a)(Object(a.a)(r))));return Object(s.a)(Object(ft.a)(i,o),u)}var fa=Object(p.b)({sigmoidCrossEntropy_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:aa.a.SUM_BY_NONZERO_WEIGHTS,i=Object(l.a)(e,"multiClassLabels","sigmoidCrossEntropy"),o=Object(l.a)(t,"logits","sigmoidCrossEntropy"),u=null;if(null!=n&&(u=Object(l.a)(n,"weights","sigmoidCrossEntropy")),Object(d.e)(i.shape,o.shape,"Error in sigmoidCrossEntropy: "),r>0){var c=Object(rn.a)(r),p=Object(rn.a)(1),f=Object(rn.a)(.5);i=Object(s.a)(Object(E.a)(i,Object(ft.a)(p,c)),Object(E.a)(f,c))}var h=pa(i,o);return ia(h,u,a)}});function ha(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(-1===n&&(n=t.rank-1),n!==t.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet "+"supported. Labels / logits was rank ".concat(t.rank," ")+"and dim was ".concat(n));var r=Object(yr.a)((function(e,t,r){var a=Object(He.a)(t,[n],!0),i=Object(ft.a)(Object(S.a)(t,"float32"),a);r([e,i]);var o=Object(bt.a)(Object(E.a)(i,e));return{value:Object(Rn.a)(o,[n]),gradFunc:function(e,t){var r=Object(gr.a)(t,2),a=r[0],i=r[1],o=Object(dt.e)(e.shape,[n]);return[Object(E.a)(Object(N.a)(e,o),Object(ft.a)(Object(S.a)(a,"float32"),Object(ke.a)(i))),Object(E.a)(Object(N.a)(e,o),Object(ft.a)(Object(ke.a)(i),Object(S.a)(a,"float32")))]}}}));return r(e,t)}var ma=Object(p.b)({softmaxCrossEntropy_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:aa.a.SUM_BY_NONZERO_WEIGHTS,i=Object(l.a)(e,"onehotLabels","softmaxCrossEntropy"),o=Object(l.a)(t,"logits","softmaxCrossEntropy"),u=null;if(null!=n&&(u=Object(l.a)(n,"weights","softmaxCrossEntropy")),Object(d.e)(i.shape,o.shape,"Error in softmaxCrossEntropy: "),r>0){var c=Object(rn.a)(r),p=Object(rn.a)(1),f=Object(rn.a)(i.shape[1]);i=Object(s.a)(Object(E.a)(i,Object(ft.a)(p,c)),Object(fe.a)(c,f))}var h=ha(i,o);return ia(h,u,a)}});var va=Object(p.b)({sparseFillEmptyRows_:function(e,t,n,r){var a=Object(l.a)(e,"indices","sparseFillEmptyRows","int32"),i=Object(l.a)(t,"values","sparseFillEmptyRows"),o=Object(l.a)(n,"denseShape","sparseFillEmptyRows","int32"),s=Object(l.a)(r,"defaultValue","sparseFillEmptyRows",i.dtype);if(2!==a.rank)throw new Error("Indices should be Tensor2D but received shape\n        ".concat(a.shape));if(1!==i.rank)throw new Error("Values should be Tensor1D but received shape ".concat(i.shape));if(1!==o.rank)throw new Error("Dense shape should be Tensor1D but received shape ".concat(o.shape));if(0!==s.rank)throw new Error("Default value should be a scalar but received shape ".concat(s.shape));var d={indices:a,values:i,denseShape:o,defaultValue:s},p=u.a.runKernel(c.Nc,d);return{outputIndices:p[0],outputValues:p[1],emptyRowIndicator:p[2],reverseIndexMap:p[3]}}});var ba=Object(p.b)({sparseReshape_:function(e,t,n){var r=Object(l.a)(e,"inputIndices","sparseReshape","int32"),a=Object(l.a)(t,"inputShape","sparseReshape","int32"),i=Object(l.a)(n,"newShape","sparseReshape","int32");if(2!==r.rank)throw new Error("Input indices should be Tensor2D but received shape\n        ".concat(r.shape));if(1!==a.rank)throw new Error("Input shape should be Tensor1D but received shape ".concat(a.shape));if(1!==i.rank)throw new Error("New shape should be Tensor1D but received shape ".concat(i.shape));var o={inputIndices:r,inputShape:a,newShape:i},s=u.a.runKernel(c.Oc,o);return{outputIndices:s[0],outputShape:s[1]}}});var ga=Object(p.b)({sparseSegmentMean_:function(e,t,n){var r=Object(l.a)(e,"data","sparseSegmentMean"),a=Object(l.a)(t,"indices","sparseSegmentMean","int32"),i=Object(l.a)(n,"segmentIds","sparseSegmentMean","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.rank)throw new Error("Indices should be Tensor1D but received shape\n          ".concat(a.shape));if(1!==i.rank)throw new Error("Segment ids should be Tensor1D but received shape\n          ".concat(i.shape));var o={data:r,indices:a,segmentIds:i};return u.a.runKernel(c.Pc,o)}});var ya=Object(p.b)({sparseSegmentSum_:function(e,t,n){var r=Object(l.a)(e,"data","sparseSegmentSum"),a=Object(l.a)(t,"indices","sparseSegmentSum","int32"),i=Object(l.a)(n,"segmentIds","sparseSegmentSum","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.rank)throw new Error("Indices should be Tensor1D but received shape\n         ".concat(a.shape));if(1!==i.rank)throw new Error("Segment ids should be Tensor1D but received shape\n         ".concat(i.shape));var o={data:r,indices:a,segmentIds:i};return u.a.runKernel(c.Qc,o)}});var xa=Object(p.b)({stringNGrams_:function(e,t,n,r,a,i,o,s){var d=Object(l.a)(e,"data","stringNGrams","string");if("string"!==d.dtype)throw new Error("Data must be of datatype string");if(1!==d.shape.length)throw new Error("Data must be a vector, saw: ".concat(d.shape));var p=Object(l.a)(t,"dataSplits","stringNGrams");if("int32"!==p.dtype)throw new Error("Data splits must be of datatype int32");var f={separator:n,nGramWidths:r,leftPad:a,rightPad:i,padWidth:o,preserveShortSequences:s},h={data:d,dataSplits:p},m=u.a.runKernel(c.Yc,h,f);return{nGrams:m[0],nGramsSplits:m[1]}}});var ka=Object(p.b)({stringSplit_:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=Object(l.a)(e,"input","stringSplit","string"),a=Object(l.a)(t,"delimiter","stringSplit","string");if(1!==r.rank)throw new Error("Input should be Tensor1D but received shape ".concat(r.shape));if(0!==a.rank)throw new Error("Delimiter should be a scalar but received shape ".concat(a.shape));var i={skipEmpty:n},o={input:r,delimiter:a},s=u.a.runKernel(c.Zc,o,i);return{indices:s[0],values:s[1],shape:s[2]}}});var wa=Object(p.b)({stringToHashBucketFast_:function(e,t){var n=Object(l.a)(e,"input","stringToHashBucketFast","string"),r={numBuckets:t};if(t<=0)throw new Error("Number of buckets must be at least 1");var a={input:n};return u.a.runKernel(c.ad,a,r)}}),Oa={fft:wn.a,ifft:On.a,rfft:Sn.a,irfft:In.a},Ia={hammingWindow:Cr,hannWindow:Er,frame:_r,stft:Ar},Sa={flipLeftRight:Dr,grayscaleToRGB:Fr,resizeNearestNeighbor:Yr.a,resizeBilinear:Xr.a,rotateWithOffset:Mr,cropAndResize:Rr,nonMaxSuppression:Lr,nonMaxSuppressionAsync:Wr,nonMaxSuppressionWithScore:Ur,nonMaxSuppressionWithScoreAsync:Gr,nonMaxSuppressionPadded:Hr,nonMaxSuppressionPaddedAsync:Kr,threshold:Jr,transform:Qr},Na={bandPart:$r,gramSchmidt:ea,qr:ra},ja={absoluteDifference:oa,computeWeightedLoss:ia,cosineDistance:sa,hingeLoss:ua,huberLoss:ca,logLoss:la,meanSquaredError:da,sigmoidCrossEntropy:fa,softmaxCrossEntropy:ma},Ta={sparseFillEmptyRows:va,sparseReshape:ba,sparseSegmentMean:ga,sparseSegmentSum:ya},Ca={stringNGrams:xa,stringSplit:ka,stringToHashBucketFast:wa}},function(e,t,n){"use strict";n.r(t),n.d(t,"makeTypesMatch",(function(){return o})),n.d(t,"assertTypesMatch",(function(){return s})),n.d(t,"isTensorInList",(function(){return u})),n.d(t,"getTensorsInContainer",(function(){return c}));var r=n(13),a=n(98),i=n(18);function o(e,t){if(e.dtype===t.dtype)return[e,t];var n=Object(a.b)(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function s(e,t){Object(i.b)(e.dtype===t.dtype,(function(){return"The dtypes of the first(".concat(e.dtype,") and")+" second(".concat(t.dtype,") input must match")}))}function u(e,t){return t.some((function(t){return t.id===e.id}))}function c(e){var t=[];return function e(t,n,a){if(null==t)return;if(t instanceof r.a)return void n.push(t);if(i=t,!Array.isArray(i)&&"object"!==typeof i)return;var i;var o=t;for(var s in o){var u=o[s];a.has(u)||(a.add(u),e(u,n,a))}}(e,t,new Set),t}},function(e,t,n){"use strict";n.d(t,"e",(function(){return o})),n.d(t,"f",(function(){return s})),n.d(t,"g",(function(){return u})),n.d(t,"b",(function(){return c})),n.d(t,"c",(function(){return l})),n.d(t,"d",(function(){return d})),n.d(t,"j",(function(){return g})),n.d(t,"i",(function(){return y})),n.d(t,"h",(function(){return x})),n.d(t,"a",(function(){return k}));var r=n(3),a=n(15),i=n(18);function o(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",o=arguments.length>5?arguments[5]:void 0,s=e[3],u=[].concat(Object(a.a)(t),[s]),l=x(i);return c(e,u,n,o,r,null,null,l)}function s(e,t,n,a,i,o){var s,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"channelsLast",l=p(t),d=Object(r.a)(l,2),f=d[0],h=d[1];if("channelsLast"===u)s=[f,h,e[3],e[3]];else{if("channelsFirst"!==u)throw new Error("Unknown dataFormat ".concat(u));s=[f,h,e[1],e[1]]}return c(e,s,n,a,i,o,!1,u)}function u(e,t,n,a,i,o){var s,u,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"NDHWC",d=f(t),p=Object(r.a)(d,3),h=p[0],m=p[1],v=p[2];if("NDHWC"===c)u="channelsLast",s=[h,m,v,e[4],e[4]];else{if("NCDHW"!==c)throw new Error("Unknown dataFormat ".concat(c));u="channelsFirst",s=[h,m,v,e[1],e[1]]}return l(e,s,n,a,i,!1,u,o)}function c(e,t,n,a,i,o){var s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"channelsLast",c=-1,l=-1,d=-1,f=-1;if("channelsLast"===u){var v=Object(r.a)(e,4);c=v[0],l=v[1],d=v[2],f=v[3]}else{if("channelsFirst"!==u)throw new Error("Unknown dataFormat ".concat(u));var b=Object(r.a)(e,4);c=b[0],f=b[1],l=b[2],d=b[3]}var g,y=Object(r.a)(t,4),x=y[0],k=y[1],w=y[3],O=p(n),I=Object(r.a)(O,2),S=I[0],N=I[1],j=p(a),T=Object(r.a)(j,2),C=T[0],E=T[1],_=h(x,C),A=h(k,E),R=m(i,l,d,S,N,_,A,o,u),D=R.padInfo,F=R.outHeight,M=R.outWidth,z=s?w*f:w;return"channelsFirst"===u?g=[c,z,F,M]:"channelsLast"===u&&(g=[c,F,M,z]),{batchSize:c,dataFormat:u,inHeight:l,inWidth:d,inChannels:f,outHeight:F,outWidth:M,outChannels:z,padInfo:D,strideHeight:S,strideWidth:N,filterHeight:x,filterWidth:k,effectiveFilterHeight:_,effectiveFilterWidth:A,dilationHeight:C,dilationWidth:E,inShape:e,outShape:g,filterShape:t}}function l(e,t,n,a,i){var o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"channelsLast",u=arguments.length>7?arguments[7]:void 0,c=-1,l=-1,d=-1,p=-1,m=-1;if("channelsLast"===s){var b=Object(r.a)(e,5);c=b[0],l=b[1],d=b[2],p=b[3],m=b[4]}else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat ".concat(s));var g=Object(r.a)(e,5);c=g[0],m=g[1],l=g[2],d=g[3],p=g[4]}var y,x=Object(r.a)(t,5),k=x[0],w=x[1],O=x[2],I=x[4],S=f(n),N=Object(r.a)(S,3),j=N[0],T=N[1],C=N[2],E=f(a),_=Object(r.a)(E,3),A=_[0],R=_[1],D=_[2],F=h(k,A),M=h(w,R),z=h(O,D),L=v(i,l,d,p,j,T,C,F,M,z,u),P=L.padInfo,B=L.outDepth,W=L.outHeight,U=L.outWidth,V=o?I*m:I;return"channelsFirst"===s?y=[c,V,B,W,U]:"channelsLast"===s&&(y=[c,B,W,U,V]),{batchSize:c,dataFormat:s,inDepth:l,inHeight:d,inWidth:p,inChannels:m,outDepth:B,outHeight:W,outWidth:U,outChannels:V,padInfo:P,strideDepth:j,strideHeight:T,strideWidth:C,filterDepth:k,filterHeight:w,filterWidth:O,effectiveFilterDepth:F,effectiveFilterHeight:M,effectiveFilterWidth:z,dilationDepth:A,dilationHeight:R,dilationWidth:D,inShape:e,outShape:y,filterShape:t}}function d(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=h(t,r);return Math.floor((e[0]*(n-1)-n+a)/2)}function p(e){return"number"===typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}function f(e){return"number"===typeof e?[e,e,e]:e}function h(e,t){return t<=1?e:e+(e-1)*(t-1)}function m(e,t,n,r,a,i,o,s,u){var c,l,p;if("number"===typeof e){c={top:e,bottom:e,left:e,right:e,type:0===e?"VALID":"NUMBER"};var f=function(e,t,n,r,a){null==r&&(r=d(e,t,n));var i=e[0],o=e[1];return[b((i-t+2*r)/n+1,a),b((o-t+2*r)/n+1,a)]}([t,n],i,r,e,s);l=f[0],p=f[1]}else if("same"===e){l=Math.ceil(t/r),p=Math.ceil(n/a);var h=Math.max(0,(l-1)*r+i-t),m=Math.max(0,(p-1)*a+o-n),v=Math.floor(h/2),g=h-v,y=Math.floor(m/2);c={top:v,bottom:g,left:y,right:m-y,type:"SAME"}}else if("valid"===e)c={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((t-i+1)/r),p=Math.ceil((n-o+1)/a);else{if("object"!==typeof e)throw Error("Unknown padding parameter: ".concat(e));var x="channelsLast"===u?e[1][0]:e[2][0],k="channelsLast"===u?e[1][1]:e[2][1],w="channelsLast"===u?e[2][0]:e[3][0],O="channelsLast"===u?e[2][1]:e[3][1];c={top:x,bottom:k,left:w,right:O,type:0===x&&0===k&&0===w&&0===O?"VALID":"EXPLICIT"},l=b((t-i+x+k)/r+1,s),p=b((n-o+w+O)/a+1,s)}return{padInfo:c,outHeight:l,outWidth:p}}function v(e,t,n,r,a,i,o,s,u,c,l){var p,f,h,m;if("number"===typeof e){p={top:e,bottom:e,left:e,right:e,front:e,back:e,type:0===e?"VALID":"NUMBER"};var v=function(e,t,n,r,a,i){null==a&&(a=d(e,t,r));var o=e[0],s=e[1],u=e[2];return[b((o-t+2*a)/r+1,i),b((s-t+2*a)/r+1,i),b((u-t+2*a)/r+1,i),n]}([t,n,r,1],s,1,a,e,l);f=v[0],h=v[1],m=v[2]}else if("same"===e){var g=((f=Math.ceil(t/a))-1)*a+s-t,y=((h=Math.ceil(n/i))-1)*i+u-n,x=((m=Math.ceil(r/o))-1)*o+c-r,k=Math.floor(g/2),w=g-k,O=Math.floor(y/2),I=y-O,S=Math.floor(x/2);p={top:O,bottom:I,left:S,right:x-S,front:k,back:w,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: ".concat(e));p={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},f=Math.ceil((t-s+1)/a),h=Math.ceil((n-u+1)/i),m=Math.ceil((r-c+1)/o)}return{padInfo:p,outDepth:f,outHeight:h,outWidth:m}}function b(e,t){if(!t)return Math.trunc(e);switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode ".concat(t))}}function g(e){var t=p(e),n=Object(r.a)(t,3),a=n[0],i=n[1],o=n[2];return 1===a&&1===i&&1===o}function y(e,t){return g(e)||g(t)}function x(e){if("NHWC"===e)return"channelsLast";if("NCHW"===e)return"channelsFirst";throw new Error("Unknown dataFormat ".concat(e))}function k(e,t,n){if(null!=n){if("string"===typeof t)throw Error("Error in ".concat(e,": pad must be an integer when using ")+"dimRoundingMode ".concat(n," but got pad ").concat(t,"."));if("number"===typeof t)i.b(i.v(t),(function(){return"Error in ".concat(e,": pad must be an integer when using ")+"dimRoundingMode ".concat(n," but got pad ").concat(t,".")}));else{if("object"!==typeof t)throw Error("Error in ".concat(e,": Unknown padding parameter: ").concat(t));t.forEach((function(t){t.forEach((function(t){i.b(i.v(t),(function(){return"Error in ".concat(e,": pad must be an integer when using ")+"dimRoundingMode ".concat(n," but got pad ").concat(t,".")}))}))}))}}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(12),a=n(6),i=n(9);var o=Object(i.b)({square_:function(e){var t=Object(a.a)(e,"x","square");return r.a.runKernel("Square",{x:t},{})}})},function(e,t,n){"use strict";n.d(t,"c",(function(){return s})),n.d(t,"e",(function(){return u})),n.d(t,"h",(function(){return c})),n.d(t,"b",(function(){return l})),n.d(t,"d",(function(){return d})),n.d(t,"g",(function(){return p})),n.d(t,"f",(function(){return f})),n.d(t,"a",(function(){return h}));var r=n(12),a=n(30),i=n(13),o=n(32);function s(){return r.a}function u(){return r.a.memory()}function c(e,t){return r.a.tidy(e,t)}function l(e){Object(o.getTensorsInContainer)(e).forEach((function(e){return e.dispose()}))}function d(e){return r.a.keep(e)}function p(e){return r.a.setBackend(e)}function f(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return r.a.registerBackend(e,t,n)}function h(){return r.a.backend}Object(i.e)((function(e){Object(a.b)().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(3),a=n(12),i=n(7),o=n(32),s=n(6),u=n(9);var c=Object(u.b)({matMul_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],u=arguments.length>3&&void 0!==arguments[3]&&arguments[3],c=Object(s.a)(e,"a","matMul"),l=Object(s.a)(t,"b","matMul"),d=Object(o.makeTypesMatch)(c,l),p=Object(r.a)(d,2),f={a:c=p[0],b:l=p[1]},h={transposeA:n,transposeB:u};return a.a.runKernel(i.s,f,h)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(7),i=n(6),o=n(9);var s=Object(o.b)({slice_:function(e,t,n){var o=Object(i.a)(e,"x","slice","string_or_numeric");if(0===o.rank)throw new Error("Slicing scalar is not possible");var s={x:o},u={begin:t,size:n};return r.a.runKernel(a.Jc,s,u)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(7),i=n(6),o=n(9);var s=Object(o.b)({neg_:function(e){var t={x:Object(i.a)(e,"x","neg")};return r.a.runKernel(a.Yb,t)}})},function(e,t){e.exports=function(){throw new Error("define cannot be used indirect")}},function(e,t,n){"use strict";function r(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";function r(e){return(r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}n.d(t,"a",(function(){return i}));var a=n(40);function i(e,t){return!t||"object"!==r(t)&&"function"!==typeof t?Object(a.a)(e):t}},function(e,t,n){"use strict";(function(e){n.d(t,"f",(function(){return f})),n.d(t,"e",(function(){return m})),n.d(t,"a",(function(){return y})),n.d(t,"b",(function(){return x})),n.d(t,"d",(function(){return k})),n.d(t,"c",(function(){return w})),n.d(t,"j",(function(){return O})),n.d(t,"h",(function(){return I})),n.d(t,"g",(function(){return S})),n.d(t,"i",(function(){return j})),n.d(t,"k",(function(){return T}));var r=n(3),a=n(1),i=n.n(a),o=n(15),s=n(14),u=n(8),c=n(63),l=n(94),d=n(18),p=n(151);function f(e,t){return h.apply(this,arguments)}function h(){return(h=Object(u.a)(i.a.mark((function e(t,n){var r,a,o,s,c,l;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=[],a=[],o=Array.isArray(t)?t.map((function(e){return e.name})):Object.keys(t),s=function(e){var s=o[e],c=Array.isArray(t)?t[e].tensor:t[s];if("float32"!==c.dtype&&"int32"!==c.dtype&&"bool"!==c.dtype&&"string"!==c.dtype&&"complex64"!==c.dtype)throw new Error("Unsupported dtype in weight '".concat(s,"': ").concat(c.dtype));var l={name:s,shape:c.shape,dtype:c.dtype};if("string"===c.dtype){var d=new Promise(function(){var e=Object(u.a)(i.a.mark((function e(t){var n,r,a,o,s,u,l;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.bytes();case 2:for(n=e.sent,r=n.reduce((function(e,t){return e+t.length}),0)+4*n.length,a=new Uint8Array(r),o=0,s=0;s<n.length;s++)u=n[s],l=new Uint8Array(new Uint32Array([u.length]).buffer),a.set(l,o),o+=4,a.set(u,o),o+=u.length;t(a);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());a.push(d)}else a.push(c.data());null!=n&&(l.group=n),r.push(l)},c=0;c<o.length;++c)s(c);return e.next=7,Promise.all(a);case 7:return l=e.sent,e.abrupt("return",{data:v(l),specs:r});case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e,t){var n,r,a={},i=0,o=Object(s.a)(t);try{for(o.s();!(r=o.n()).done;){var u=r.value,f=u.name,h=u.dtype,m=u.shape,v=Object(d.O)(m),b=void 0;if("quantization"in u){var g=u.quantization;if("uint8"===g.dtype||"uint16"===g.dtype){if(!("min"in g)||!("scale"in g))throw new Error("Weight ".concat(u.name," with quantization ").concat(g.dtype," ")+"doesn't have corresponding metadata min and scale.")}else{if("float16"!==g.dtype)throw new Error("Weight ".concat(u.name," has unknown ")+"quantization dtype ".concat(g.dtype,". ")+"Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.");if("float32"!==h)throw new Error("Weight ".concat(u.name," is quantized with ").concat(g.dtype," ")+"which only supports weights of type float32 not ".concat(h,"."))}var y=p.a[g.dtype],x=e.slice(i,i+v*y),k="uint8"===g.dtype?new Uint8Array(x):new Uint16Array(x);if("float32"===h)if("uint8"===g.dtype||"uint16"===g.dtype){b=new Float32Array(k.length);for(var w=0;w<k.length;w++){var O=k[w];b[w]=O*g.scale+g.min}}else{if("float16"!==g.dtype)throw new Error("Unsupported quantization type ".concat(g.dtype," ")+"for weight type float32.");void 0===n&&(n=C()),b=n(k)}else{if("int32"!==h)throw new Error("Unsupported dtype in weight '".concat(f,"': ").concat(h));if("uint8"!==g.dtype&&"uint16"!==g.dtype)throw new Error("Unsupported quantization type ".concat(g.dtype," ")+"for weight type int32.");b=new Int32Array(k.length);for(var I=0;I<k.length;I++){var S=k[I];b[I]=Math.round(S*g.scale+g.min)}}i+=v*y}else if("string"===h){var N=Object(d.O)(u.shape);b=[];for(var j=0;j<N;j++){var T=new Uint32Array(e.slice(i,i+4))[0];i+=4;var E=new Uint8Array(e.slice(i,i+T));b.push(E),i+=T}}else{var _=p.a[h],A=e.slice(i,i+v*_);if("float32"===h)b=new Float32Array(A);else if("int32"===h)b=new Int32Array(A);else if("bool"===h)b=new Uint8Array(A);else{if("complex64"!==h)throw new Error("Unsupported dtype in weight '".concat(f,"': ").concat(h));b=new Float32Array(A);for(var R=new Float32Array(b.length/2),D=new Float32Array(b.length/2),F=0;F<R.length;F++)R[F]=b[2*F],D[F]=b[2*F+1];var M=Object(l.a)(R,m,"float32"),z=Object(l.a)(D,m,"float32");a[f]=Object(c.a)(M,z),M.dispose(),z.dispose()}i+=v*_}"complex64"!==h&&(a[f]=Object(l.a)(b,m,h))}}catch(L){o.e(L)}finally{o.f()}return a}function v(e){if(null===e)throw new Error("Invalid input value: ".concat(JSON.stringify(e)));var t=0,n=[];e.forEach((function(e){if(t+=e.byteLength,n.push(e.byteLength===e.buffer.byteLength?e:new e.constructor(e)),!(e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: ".concat(e.constructor.name))}));var r=new Uint8Array(t),a=0;return n.forEach((function(e){r.set(new Uint8Array(e.buffer),a),a+=e.byteLength})),r.buffer}var b="undefined"!==typeof e&&("undefined"===typeof Blob||"undefined"===typeof atob||"undefined"===typeof btoa);function g(t){return b?e.byteLength(t):new Blob([t]).size}function y(t){if(b)return e.from(t).toString("base64");for(var n=new Uint8Array(t),r="",a=0,i=n.length;a<i;a++)r+=String.fromCharCode(n[a]);return btoa(r)}function x(t){if(b){var n=e.from(t,"base64");return n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength)}for(var r=atob(t),a=new Uint8Array(r.length),i=0;i<r.length;++i)a.set([r.charCodeAt(i)],i);return a.buffer}function k(e){if(1===e.length)return e[0];var t=0;e.forEach((function(e){t+=e.byteLength}));var n=new Uint8Array(t),r=0;return e.forEach((function(e){n.set(new Uint8Array(e),r),r+=e.byteLength})),n.buffer}function w(e){for(e=e.trim();e.endsWith("/");)e=e.slice(0,e.length-1);var t=e.split("/");return t[t.length-1]}function O(e,t){var n={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:t};return null!=e.signature&&(n.signature=e.signature),null!=e.userDefinedMetadata&&(n.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(n.modelInitializer=e.modelInitializer),null!=e.trainingConfig&&(n.trainingConfig=e.trainingConfig),n}function I(e,t,n){var r={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy};if(null!=e.trainingConfig&&(r.trainingConfig=e.trainingConfig),null!=e.weightsManifest){if(!t)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!n)throw new Error("modelJSON has weightsManifest but weightData is null");r.weightSpecs=t,r.weightData=n}return null!=e.signature&&(r.signature=e.signature),null!=e.userDefinedMetadata&&(r.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(r.modelInitializer=e.modelInitializer),r}function S(e,t){return N.apply(this,arguments)}function N(){return(N=Object(u.a)(i.a.mark((function e(t,n){var a,o,s,u;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==t.weightsManifest){e.next=7;break}return e.next=3,n(t.weightsManifest);case 3:s=e.sent,u=Object(r.a)(s,2),a=u[0],o=u[1];case 7:return e.abrupt("return",I(t,a,o));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:g(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:g(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:e.weightData.byteLength}}function T(e){var t,n=[],r=Object(s.a)(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;n.push.apply(n,Object(o.a)(a.weights))}}catch(i){r.e(i)}finally{r.f()}return n}function C(){var e=function(){var e=function(e){for(var t=e<<13,n=0;0===(8388608&t);)n-=8388608,t<<=1;return(t&=-8388609)|(n+=947912704)},t=new Uint32Array(2048);t[0]=0;for(var n=1;n<1024;n++)t[n]=e(n);for(var r=1024;r<2048;r++)t[r]=939524096+(r-1024<<13);return t}(),t=function(){var e=new Uint32Array(64);e[0]=0,e[31]=1199570944,e[32]=2147483648,e[63]=3347054592;for(var t=1;t<31;t++)e[t]=t<<23;for(var n=33;n<63;n++)e[n]=2147483648+(n-32<<23);return e}(),n=function(){for(var e=new Uint32Array(64),t=0;t<64;t++)e[t]=1024;return e[0]=e[32]=0,e}();return function(r){for(var a=new ArrayBuffer(4*r.length),i=new Uint32Array(a),o=0;o<r.length;o++){var s=r[o],u=e[n[s>>10]+(1023&s)]+t[s>>10];i[o]=u}return new Float32Array(a)}}}).call(this,n(152).Buffer)},function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(12),a=n(7),i=n(6),o=n(18),s=n(79),u=n(9);var c=Object(u.b)({concat_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Object(o.b)(e.length>=1,(function(){return"Pass at least one tensor to concat"}));var n=Object(i.b)(e,"tensors","concat","string_or_numeric");if("complex64"===n[0].dtype&&n.forEach((function(e){if("complex64"!==e.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype ".concat(e.dtype,". "))})),1===n.length)return Object(s.a)(n[0]);var u=n,c={axis:t};return r.a.runKernel(a.C,u,c)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(12),a=n(7),i=n(6),o=n(111),s=n(26),u=n(9);var c=Object(u.b)({where_:function(e,t,n){var u=Object(i.a)(t,"a","where"),c=Object(i.a)(n,"b","where"),l=Object(i.a)(e,"condition","where","bool"),d=Object(s.assertAndGetBroadcastShape)(Object(s.assertAndGetBroadcastShape)(l.shape,u.shape),c.shape),p={condition:Object(o.a)(l,d),t:Object(o.a)(u,d),e:Object(o.a)(c,d)};return r.a.runKernel(a.Dc,p)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return o}));n(15);var r=n(12),a=n(13),i=(n(6),n(18));function o(e,t){i.b(i.u(e),(function(){return"The f passed in variableGrads(f) must be a function"})),i.b(null==t||Array.isArray(t)&&t.every((function(e){return e instanceof a.c})),(function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"}));var n=null!=t;if(!n)for(var o in t=[],r.a.registeredVariables)t.push(r.a.registeredVariables[o]);var s=n?t.filter((function(e){return!e.trainable})):null,u=t.length;t=t.filter((function(e){return e.trainable})),i.b(t.length>0,(function(){return"variableGrads() expects at least one of the input variables to "+"be trainable, but none of the ".concat(u," variables is ")+"trainable."}));var c=r.a.gradients(e,t,null,!0),l=c.value,d=c.grads;i.b(d.some((function(e){return null!=e})),(function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."})),i.b(0===l.rank,(function(){return"The f passed in variableGrads(f) must return a scalar, but it "+"returned a rank-".concat(l.rank," tensor")}));var p={};return t.forEach((function(e,t){null!=d[t]&&(p[e.name]=d[t])})),null!=s&&s.forEach((function(e){return p[e.name]=null})),{value:l,grads:p}}function s(e){return r.a.customGrad(e)}},function(e,t,n){"use strict";var r;n.d(t,"a",(function(){return r})),function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(r||(r={}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(7),i=n(6),o=n(9);var s=Object(o.b)({sqrt_:function(e){var t={x:Object(i.a)(e,"x","sqrt","float32")};return r.a.runKernel(a.Tc,t)}})},function(e,t){(function(t){e.exports=t}).call(this,{})},function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return i})),n.d(t,"d",(function(){return o})),n.d(t,"e",(function(){return s})),n.d(t,"a",(function(){return u})),n.d(t,"f",(function(){return c})),n.d(t,"h",(function(){return l})),n.d(t,"g",(function(){return d}));var r=n(18);function a(e,t){for(var n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function i(e,t,n){for(var r=e.length+t.length,a=[],i=0,o=0,s=0;s<r;s++)-1===n.indexOf(s)?a.push(e[i++]):a.push(t[o++]);return a}function o(e,t){for(var n=[],r=e.length,a=0;a<r;a++)-1===t.indexOf(a)&&n.push(e[a]);return[n,t.map((function(t){return e[t]}))]}function s(e,t){return i(e,t.map((function(e){return 1})),t)}function u(e,t,n){r.b(a(t,n),(function(){return"".concat(e," supports only inner-most axes for now. ")+"Got axes ".concat(t," and rank-").concat(n," input.")}))}function c(e,t){if(a(e,t))return null;for(var n=[],r=0;r<t;++r)-1===e.indexOf(r)&&n.push(r);return e.forEach((function(e){return n.push(e)})),n}function l(e){return e.map((function(e,t){return[t,e]})).sort((function(e,t){return e[1]-t[1]})).map((function(e){return e[0]}))}function d(e,t){for(var n=[],r=t-e;r<t;++r)n.push(r);return n}},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(7),i=n(6),o=n(9);var s=Object(o.b)({exp_:function(e){var t={x:Object(i.a)(e,"x","exp")};return r.a.runKernel(a.cb,t)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"e",(function(){return o})),n.d(t,"d",(function(){return s})),n.d(t,"c",(function(){return u})),n.d(t,"b",(function(){return c}));var r=n(2),a=n(4),i=function(){function e(){Object(r.a)(this,e),this.saveRouters=[],this.loadRouters=[]}return Object(a.a)(e,null,[{key:"getInstance",value:function(){return null==e.instance&&(e.instance=new e),e.instance}},{key:"registerSaveRouter",value:function(t){e.getInstance().saveRouters.push(t)}},{key:"registerLoadRouter",value:function(t){e.getInstance().loadRouters.push(t)}},{key:"getSaveHandlers",value:function(t){return e.getHandlers(t,"save")}},{key:"getLoadHandlers",value:function(t,n){return e.getHandlers(t,"load",n)}},{key:"getHandlers",value:function(t,n,r){var a=[];return("load"===n?e.getInstance().loadRouters:e.getInstance().saveRouters).forEach((function(e){var n=e(t,r);null!==n&&a.push(n)})),a}}]),e}(),o=function(e){return i.registerSaveRouter(e)},s=function(e){return i.registerLoadRouter(e)},u=function(e){return i.getSaveHandlers(e)},c=function(e,t){return i.getLoadHandlers(e,t)}},function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var r=n(3),a=n(12),i=n(7),o=n(32),s=n(6),u=n(26),c=n(9);var l=Object(c.b)({greater_:function(e,t){var n=Object(s.a)(e,"a","greater","string_or_numeric"),c=Object(s.a)(t,"b","greater","string_or_numeric"),l=Object(o.makeTypesMatch)(n,c),d=Object(r.a)(l,2);n=d[0],c=d[1],Object(u.assertAndGetBroadcastShape)(n.shape,c.shape);var p={a:n,b:c};return a.a.runKernel(i.qb,p)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(7),i=n(6),o=n(9);var s=Object(o.b)({abs_:function(e){var t=Object(i.a)(e,"x","abs");if("complex64"===t.dtype){var n={x:t};return r.a.runKernel(a.B,n)}var o={x:t};return r.a.runKernel(a.a,o)}})},function(e,t,n){"use strict";n.d(t,"c",(function(){return h})),n.d(t,"b",(function(){return m})),n.d(t,"a",(function(){return v})),n.d(t,"d",(function(){return b}));var r=n(26),a=n(124),i=n(126),o=n(17),s=n(133),u=n(90),c=n(134),l=n(16),d=n(80),p=n(91),f=n(27);function h(e,t,n){if(null==n||"linear"===n)return e;if("relu"===n)return Object(o.a)(e,Object(p.a)(t));throw new Error("Cannot compute gradient for fused activation ".concat(n,"."))}function m(e,t){var n=t,a=r.getReductionAxes(e.shape,t.shape);return a.length>0&&(n=Object(f.a)(n,a)),Object(l.a)(n,e.shape)}function v(e,t,n,r){if("linear"===t)return e;if("relu"===t)return Object(u.a)(e);if("elu"===t)return Object(a.a)(e);if("relu6"===t)return Object(c.a)(e);if("prelu"===t)return Object(s.a)(e,n);if("leakyrelu"===t)return Object(i.a)(e,r);if("sigmoid"===t)return Object(d.a)(e);throw new Error("Unknown fused activation ".concat(t,"."))}var b=function(e,t){return!(e>0)||"linear"===t}},function(e,t,n){"use strict";n.d(t,"f",(function(){return y})),n.d(t,"e",(function(){return x})),n.d(t,"d",(function(){return k})),n.d(t,"g",(function(){return w})),n.d(t,"a",(function(){return I})),n.d(t,"b",(function(){return F})),n.d(t,"c",(function(){return O}));var r=n(14),a=n(10),i=n(11),o=n(1),s=n.n(o),u=n(8),c=n(2),l=n(4),d=n(0),p=n(199),f=n(83);function h(e){return e instanceof d.gd?{value:e.clone(),recurse:!1}:Object(f.e)(e)?{value:null,recurse:!0}:{value:e,recurse:!1}}var m=n(20),v=n(19),b=function(){function e(t){if(Object(c.a)(this,e),this.capacity=t,this.begin=0,this.end=0,null==t)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(t<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(t),this.doubledCapacity=2*t}return Object(l.a)(e,[{key:"wrap",value:function(e){for(;e<0;)e+=this.doubledCapacity;return e%this.doubledCapacity}},{key:"get",value:function(e){if(e<0)throw new RangeError("Can't get item at a negative index.");return this.data[e%this.capacity]}},{key:"set",value:function(e,t){if(e<0)throw new RangeError("Can't set item at a negative index.");this.data[e%this.capacity]=t}},{key:"length",value:function(){var e=this.end-this.begin;return e<0&&(e=this.doubledCapacity+e),e}},{key:"isFull",value:function(){return this.length()===this.capacity}},{key:"isEmpty",value:function(){return 0===this.length()}},{key:"push",value:function(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,e),this.end=this.wrap(this.end+1)}},{key:"pushAll",value:function(e){var t,n=Object(r.a)(e);try{for(n.s();!(t=n.n()).done;){var a=t.value;this.push(a)}}catch(i){n.e(i)}finally{n.f()}}},{key:"pop",value:function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);var e=this.get(this.end);return this.set(this.end,void 0),e}},{key:"unshift",value:function(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,e)}},{key:"shift",value:function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var e=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),e}},{key:"shuffleExcise",value:function(e){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var t=this.wrap(this.begin+e),n=this.get(t);return this.set(t,this.pop()),n}}]),e}(),g=function(e){Object(a.a)(n,e);var t=Object(i.a)(n);function n(){return Object(c.a)(this,n),t.call(this,n.INITIAL_CAPACITY)}return Object(l.a)(n,[{key:"isFull",value:function(){return!1}},{key:"push",value:function(e){Object(m.a)(Object(v.a)(n.prototype),"isFull",this).call(this)&&this.expand(),Object(m.a)(Object(v.a)(n.prototype),"push",this).call(this,e)}},{key:"unshift",value:function(e){Object(m.a)(Object(v.a)(n.prototype),"isFull",this).call(this)&&this.expand(),Object(m.a)(Object(v.a)(n.prototype),"unshift",this).call(this,e)}},{key:"expand",value:function(){for(var e=2*this.capacity,t=new Array(e),n=this.length(),r=0;r<n;r++)t[r]=this.get(this.wrap(this.begin+r));this.data=t,this.capacity=e,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=n}}]),n}(b);function y(e){return new S(e)}function x(e){return new N(e)}function k(e,t){return new z(e,t)}function w(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:O.FAIL;return new L(e,t)}g.INITIAL_CAPACITY=32;var O,I=function(){function e(){Object(c.a)(this,e)}return Object(l.a)(e,[{key:"toArray",value:function(){var e=Object(u.a)(s.a.mark((function e(){var t,n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.next=3,this.next();case 3:n=e.sent;case 4:if(n.done){e.next=11;break}return t.push(n.value),e.next=8,this.next();case 8:n=e.sent,e.next=4;break;case 11:return e.abrupt("return",t);case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"toArrayForTest",value:function(){var e=Object(u.a)(s.a.mark((function e(){var t,n,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.prefetch(100),n=[],e.next=4,t.next();case 4:r=e.sent;case 5:if(r.done){e.next=12;break}return n.push(r.value),e.next=9,t.next();case 9:r=e.sent,e.next=5;break;case 12:return e.abrupt("return",n);case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"resolveFully",value:function(){var e=Object(u.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.next();case 2:t=e.sent;case 3:if(t.done){e.next=9;break}return e.next=6,this.next();case 6:t=e.sent,e.next=3;break;case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"resolveWhile",value:function(){var e=Object(u.a)(s.a.mark((function e(t){var n,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.next();case 2:n=e.sent,r=t(n.value);case 4:if(n.done||!r){e.next=11;break}return e.next=7,this.next();case 7:n=e.sent,r=t(n.value),e.next=4;break;case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleErrors",value:function(e){return new R(this,e)}},{key:"filter",value:function(e){return new _(this,e)}},{key:"map",value:function(e){return new A(this,e)}},{key:"mapAsync",value:function(e){return new D(this,e)}},{key:"serialMapAsync",value:function(e){return new D(this,e).serial()}},{key:"flatmap",value:function(e){return new M(this,e)}},{key:"forEachAsync",value:function(){var e=Object(u.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.map(t).resolveFully());case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"serialForEach",value:function(){var e=Object(u.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.serialMapAsync(t).resolveWhile((function(e){return!0===e})));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"rowMajorBatch",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new E(this,e,t)}},{key:"columnMajorBatch",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:f.f,r=this.rowMajorBatch(e,t);return r.map((function(e){return Object(f.d)(e,n)}))}},{key:"concatenate",value:function(e,t){return new z(y([this,e]),t)}},{key:"take",value:function(e){return e<0||null==e?this:new C(this,e)}},{key:"skip",value:function(e){return e<0||null==e?this:new T(this,e)}},{key:"prefetch",value:function(e){return new P(this,e)}},{key:"shuffle",value:function(e,t){return new B(this,e,t)}},{key:"serial",value:function(){return new j(this)}}]),e}(),S=function(e){Object(a.a)(n,e);var t=Object(i.a)(n);function n(e){var r;return Object(c.a)(this,n),(r=t.call(this)).items=e,r.trav=0,r}return Object(l.a)(n,[{key:"summary",value:function(){return"Array of ".concat(this.items.length," items")}},{key:"next",value:function(){var e=Object(u.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.trav>=this.items.length)){e.next=2;break}return e.abrupt("return",{value:null,done:!0});case 2:return t=this.items[this.trav],this.trav++,e.abrupt("return",{value:(n=t,Object(f.b)(n,h)),done:!1});case 5:case"end":return e.stop()}var n}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(I),N=function(e){Object(a.a)(n,e);var t=Object(i.a)(n);function n(e){var r;return Object(c.a)(this,n),(r=t.call(this)).nextFn=e,r}return Object(l.a)(n,[{key:"summary",value:function(){return"Function call"}},{key:"next",value:function(){var e=Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.abrupt("return",this.nextFn());case 4:throw e.prev=4,e.t0=e.catch(0),e.t0.message="Error thrown while iterating through a dataset: ".concat(e.t0.message),e.t0;case 8:case"end":return e.stop()}}),e,this,[[0,4]])})));return function(){return e.apply(this,arguments)}}()}]),n}(I),j=function(e){Object(a.a)(n,e);var t=Object(i.a)(n);function n(e){var r;return Object(c.a)(this,n),(r=t.call(this)).upstream=e,r.lastRead=Promise.resolve({value:null,done:!1}),r}return Object(l.a)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Serial")}},{key:"next",value:function(){var e=Object(u.a)(s.a.mark((function e(){var t=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lastRead=this.lastRead.then((function(){return t.serialNext()})),e.abrupt("return",this.lastRead);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.upstream.next());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(I),T=function(e){Object(a.a)(n,e);var t=Object(i.a)(n);function n(e,r){var a;return Object(c.a)(this,n),(a=t.call(this)).upstream=e,a.maxCount=r,a.count=0,a.lastRead=Promise.resolve({value:null,done:!1}),a}return Object(l.a)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Skip")}},{key:"next",value:function(){var e=Object(u.a)(s.a.mark((function e(){var t=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lastRead=this.lastRead.then((function(){return t.serialNext()})),e.abrupt("return",this.lastRead);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=Object(u.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.count++<this.maxCount)){e.next=9;break}return e.next=3,this.upstream.next();case 3:if(!(t=e.sent).done){e.next=6;break}return e.abrupt("return",t);case 6:d.Wd(t.value),e.next=0;break;case 9:return e.abrupt("return",this.upstream.next());case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(I),C=function(e){Object(a.a)(n,e);var t=Object(i.a)(n);function n(e,r){var a;return Object(c.a)(this,n),(a=t.call(this)).upstream=e,a.maxCount=r,a.count=0,a}return Object(l.a)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Take")}},{key:"next",value:function(){var e=Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.count++>=this.maxCount)){e.next=2;break}return e.abrupt("return",{value:null,done:!0});case 2:return e.abrupt("return",this.upstream.next());case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(I),E=function(e){Object(a.a)(n,e);var t=Object(i.a)(n);function n(e,r){var a,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return Object(c.a)(this,n),(a=t.call(this)).upstream=e,a.batchSize=r,a.enableSmallLastBatch=i,a.lastRead=Promise.resolve({value:null,done:!1}),a}return Object(l.a)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> RowMajorBatch")}},{key:"next",value:function(){var e=Object(u.a)(s.a.mark((function e(){var t=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lastRead=this.lastRead.then((function(){return t.serialNext()})),e.abrupt("return",this.lastRead);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=Object(u.a)(s.a.mark((function e(){var t,n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[];case 1:if(!(t.length<this.batchSize)){e.next=12;break}return e.next=4,this.upstream.next();case 4:if(!(n=e.sent).done){e.next=9;break}if(!(this.enableSmallLastBatch&&t.length>0)){e.next=8;break}return e.abrupt("return",{value:t,done:!1});case 8:return e.abrupt("return",{value:null,done:!0});case 9:t.push(n.value),e.next=1;break;case 12:return e.abrupt("return",{value:t,done:!1});case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(I),_=function(e){Object(a.a)(n,e);var t=Object(i.a)(n);function n(e,r){var a;return Object(c.a)(this,n),(a=t.call(this)).upstream=e,a.predicate=r,a.lastRead=Promise.resolve({value:null,done:!1}),a}return Object(l.a)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Filter")}},{key:"next",value:function(){var e=Object(u.a)(s.a.mark((function e(){var t=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lastRead=this.lastRead.then((function(){return t.serialNext()})),e.abrupt("return",this.lastRead);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=Object(u.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,this.upstream.next();case 3:if(!(t=e.sent).done&&!this.predicate(t.value)){e.next=6;break}return e.abrupt("return",t);case 6:d.Wd(t.value),e.next=0;break;case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(I),A=function(e){Object(a.a)(n,e);var t=Object(i.a)(n);function n(e,r){var a;return Object(c.a)(this,n),(a=t.call(this)).upstream=e,a.transform=r,a}return Object(l.a)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Map")}},{key:"next",value:function(){var e=Object(u.a)(s.a.mark((function e(){var t,n,a,i,o,u,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=5;break}return e.abrupt("return",{value:null,done:!0});case 5:n=d.vf.getTensorsInContainer(t.value),a=this.transform(t.value),i=d.vf.getTensorsInContainer(a),o=Object(r.a)(n);try{for(o.s();!(u=o.n()).done;)c=u.value,d.vf.isTensorInList(c,i)||c.dispose()}catch(s){o.e(s)}finally{o.f()}return e.abrupt("return",{value:a,done:!1});case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(I),R=function(e){Object(a.a)(n,e);var t=Object(i.a)(n);function n(e,r){var a;return Object(c.a)(this,n),(a=t.call(this)).upstream=e,a.handler=r,a.count=0,a.lastRead=Promise.resolve({value:null,done:!1}),a}return Object(l.a)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> handleErrors")}},{key:"next",value:function(){var e=Object(u.a)(s.a.mark((function e(){var t=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lastRead=this.lastRead.then((function(){return t.serialNext()})),e.abrupt("return",this.lastRead);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=1,e.next=4,this.upstream.next();case 4:return e.abrupt("return",e.sent);case 7:if(e.prev=7,e.t0=e.catch(1),this.handler(e.t0)){e.next=11;break}return e.abrupt("return",{value:null,done:!0});case 11:e.next=0;break;case 13:case"end":return e.stop()}}),e,this,[[1,7]])})));return function(){return e.apply(this,arguments)}}()}]),n}(I),D=function(e){Object(a.a)(n,e);var t=Object(i.a)(n);function n(e,r){var a;return Object(c.a)(this,n),(a=t.call(this)).upstream=e,a.transform=r,a}return Object(l.a)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> AsyncMap")}},{key:"next",value:function(){var e=Object(u.a)(s.a.mark((function e(){var t,n,a,i,o,u,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=5;break}return e.abrupt("return",{value:null,done:!0});case 5:return n=d.vf.getTensorsInContainer(t.value),e.next=8,this.transform(t.value);case 8:a=e.sent,i=d.vf.getTensorsInContainer(a),o=Object(r.a)(n);try{for(o.s();!(u=o.n()).done;)c=u.value,d.vf.isTensorInList(c,i)||c.dispose()}catch(s){o.e(s)}finally{o.f()}return e.abrupt("return",{value:a,done:!1});case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(I),F=function(e){Object(a.a)(n,e);var t=Object(i.a)(n);function n(){var e;return Object(c.a)(this,n),(e=t.call(this)).outputQueue=new g,e.lastRead=Promise.resolve({value:null,done:!1}),e}return Object(l.a)(n,[{key:"next",value:function(){var e=Object(u.a)(s.a.mark((function e(){var t=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lastRead=this.lastRead.then((function(){return t.serialNext()})),e.abrupt("return",this.lastRead);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.outputQueue.length()){e.next=7;break}return e.next=3,this.pump();case 3:if(e.sent){e.next=5;break}return e.abrupt("return",{value:null,done:!0});case 5:e.next=0;break;case 7:return e.abrupt("return",{value:this.outputQueue.shift(),done:!1});case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(I),M=function(e){Object(a.a)(n,e);var t=Object(i.a)(n);function n(e,r){var a;return Object(c.a)(this,n),(a=t.call(this)).upstream=e,a.transform=r,a}return Object(l.a)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Flatmap")}},{key:"pump",value:function(){var e=Object(u.a)(s.a.mark((function e(){var t,n,a,i,o,u,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=5;break}return e.abrupt("return",!1);case 5:n=d.vf.getTensorsInContainer(t.value),a=this.transform(t.value),i=d.vf.getTensorsInContainer(a),this.outputQueue.pushAll(a),o=Object(r.a)(n);try{for(o.s();!(u=o.n()).done;)c=u.value,d.vf.isTensorInList(c,i)||c.dispose()}catch(s){o.e(s)}finally{o.f()}return e.abrupt("return",!0);case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(F),z=function(e){Object(a.a)(n,e);var t=Object(i.a)(n);function n(e,r){var a;return Object(c.a)(this,n),(a=t.call(this)).baseErrorHandler=r,a.lastRead=null,a.iterator=null,a.moreIterators=e,a}return Object(l.a)(n,[{key:"summary",value:function(){return"".concat("TODO: fill in upstream of chained summaries"," -> Chained")}},{key:"next",value:function(){var e=Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lastRead=this.readFromChain(this.lastRead),e.abrupt("return",this.lastRead);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"readFromChain",value:function(){var e=Object(u.a)(s.a.mark((function e(t){var n,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t;case 2:if(null!=this.iterator){e.next=10;break}return e.next=5,this.moreIterators.next();case 5:if(!(n=e.sent).done){e.next=8;break}return e.abrupt("return",{value:null,done:!0});case 8:this.iterator=n.value,null!=this.baseErrorHandler&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler));case 10:return e.next=12,this.iterator.next();case 12:if(!(r=e.sent).done){e.next=16;break}return this.iterator=null,e.abrupt("return",this.readFromChain(t));case 16:return e.abrupt("return",r);case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(I);!function(e){e[e.FAIL=0]="FAIL",e[e.SHORTEST=1]="SHORTEST",e[e.LONGEST=2]="LONGEST"}(O||(O={}));var L=function(e){Object(a.a)(n,e);var t=Object(i.a)(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:O.FAIL;return Object(c.a)(this,n),(r=t.call(this)).iterators=e,r.mismatchMode=a,r.count=0,r.currentPromise=null,r}return Object(l.a)(n,[{key:"summary",value:function(){return"{".concat("TODO: fill in upstream of zip summaries","} -> Zip")}},{key:"nextState",value:function(){var e=Object(u.a)(s.a.mark((function e(t){var n,r,a,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=function(e){return e instanceof I?{value:e.next().then((function(e){return n++,e.done&&r++,e.value})),recurse:!1}:{value:null,recurse:!0}},e.next=3,t;case 3:return n=0,r=0,e.next=7,Object(f.c)(this.iterators,a);case 7:if(i=e.sent,n!==r){e.next=10;break}return e.abrupt("return",{value:null,done:!0});case 10:if(!(r>0)){e.next=16;break}e.t0=this.mismatchMode,e.next=e.t0===O.FAIL?14:e.t0===O.SHORTEST?15:(e.t0,O.LONGEST,16);break;case 14:throw new Error("Zipped streams should have the same length. "+"Mismatched at element ".concat(this.count,"."));case 15:return e.abrupt("return",{value:null,done:!0});case 16:return this.count++,e.abrupt("return",{value:i,done:!1});case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"next",value:function(){var e=Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.currentPromise=this.nextState(this.currentPromise),e.abrupt("return",this.currentPromise);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(I),P=function(e){Object(a.a)(n,e);var t=Object(i.a)(n);function n(e,r){var a;return Object(c.a)(this,n),(a=t.call(this)).upstream=e,a.bufferSize=r,a.buffer=new b(r),a}return Object(l.a)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Prefetch")}},{key:"refill",value:function(){for(;!this.buffer.isFull();){var e=this.upstream.next();this.buffer.push(e)}}},{key:"next",value:function(){return this.refill(),this.buffer.shift()}}]),n}(I),B=function(e){Object(a.a)(n,e);var t=Object(i.a)(n);function n(e,r,a){var i;return Object(c.a)(this,n),(i=t.call(this,e,r)).upstream=e,i.windowSize=r,i.upstreamExhausted=!1,i.random=p.alea(a||d.Df.now().toString()),i.lastRead=Promise.resolve({value:null,done:!1}),i}return Object(l.a)(n,[{key:"next",value:function(){var e=Object(u.a)(s.a.mark((function e(){var t=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lastRead=this.lastRead.then((function(){return t.serialNext()})),e.abrupt("return",this.lastRead);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"randomInt",value:function(e){return Math.floor(this.random()*e)}},{key:"chooseIndex",value:function(){return this.randomInt(this.buffer.length())}},{key:"serialNext",value:function(){var e=Object(u.a)(s.a.mark((function e(){var t,n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.upstreamExhausted||this.refill();case 1:if(this.buffer.isEmpty()){e.next=14;break}return t=this.chooseIndex(),e.next=5,this.buffer.shuffleExcise(t);case 5:if(!(n=e.sent).done){e.next=10;break}this.upstreamExhausted=!0,e.next=12;break;case 10:return this.refill(),e.abrupt("return",n);case 12:e.next=1;break;case 14:return e.abrupt("return",{value:null,done:!0});case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(P)},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(58);function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){Object(r.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){"use strict";function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(13),a=n(18);function i(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32",n=arguments.length>2?arguments[2]:void 0;return t=t||"float32",a.c(e),new r.b(e,t,n)}},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(7),i=n(6),o=n(9);var s=Object(o.b)({reverse_:function(e,t){var n={x:Object(i.a)(e,"x","reverse")},o={dims:t};return r.a.runKernel(a.xc,n,o)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return f}));var r=n(12),a=n(35),i=n(7),o=n(6),s=n(18),u=n(63),c=n(105),l=n(38),d=n(9),p=n(97);var f=Object(d.b)({transpose_:function(e,t,n){var d=Object(o.a)(e,"x","transpose");if(null==t&&(t=d.shape.map((function(e,t){return t})).reverse()),s.b(d.rank===t.length,(function(){return"Error in transpose: rank of input ".concat(d.rank," ")+"must match length of perm ".concat(t,".")})),t.forEach((function(e){s.b(e>=0&&e<d.rank,(function(){return"All entries in 'perm' must be between 0 and ".concat(d.rank-1)+" but got ".concat(t)}))})),d.rank<=1)return d.clone();var f={x:d},h={perm:t};return"complex64"===d.dtype?Object(a.h)((function(){var e=Object(p.a)(d),t=Object(c.a)(d);return e=r.a.runKernel(i.id,{x:e},h),t=r.a.runKernel(i.id,{x:t},h),n&&(t=Object(l.a)(t)),Object(u.a)(e,t)})):r.a.runKernel(i.id,f,h)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(12),a=n(18),i=n(21);function o(e,t,n,o){if(null==o&&(o=Object(a.r)(e)),"complex64"===o)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!Object(a.A)(e)&&!Array.isArray(e)&&"number"!==typeof e&&"boolean"!==typeof e&&"string"!==typeof e)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){Object(a.c)(t);var s=Object(a.O)(t),u=Object(a.O)(n);Object(a.b)(s===u,(function(){return"Based on the provided shape, [".concat(t,"], the tensor should have ")+"".concat(s," values but has ").concat(u)}));for(var c=0;c<n.length;++c){var l=n[c],d=c!==n.length-1||l!==Object(a.O)(t.slice(c));Object(a.b)(n[c]===t[c]||!d,(function(){return"Error creating a new Tensor. Inferred shape "+"(".concat(n,") does not match the provided ")+"shape (".concat(t,"). ")}))}}return Object(a.A)(e)||Array.isArray(e)||(e=[e]),t=t||n,e="string"!==o?Object(i.toTypedArray)(e,o):Object(a.m)(e,[],!0),r.a.makeTensor(e,t,o)}},function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(12),a=n(7),i=n(6),o=n(18),s=n(9);var u=Object(s.b)({complex_:function(e,t){var n=Object(i.a)(e,"real","complex"),s=Object(i.a)(t,"imag","complex");o.e(n.shape,s.shape,"real and imag shapes, ".concat(n.shape," and ").concat(s.shape,", ")+"must match in call to tf.complex().");var u={real:n,imag:s};return r.a.runKernel(a.A,u)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(3),a=n(12),i=n(7),o=n(32),s=n(6),u=n(9);var c=Object(u.b)({pow_:function(e,t){var n=Object(s.a)(e,"base","pow"),u=Object(s.a)(t,"exp","pow"),c=Object(o.makeTypesMatch)(n,u),l=Object(r.a)(c,2),d={a:n=l[0],b:u=l[1]};return a.a.runKernel(i.hc,d)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(18),i=n(63),o=n(89);function s(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32";if("complex64"===t){var n=s(e,"float32"),u=Object(o.a)(e,"float32");return Object(i.a)(n,u)}var c=Object(a.D)(Object(a.O)(e),t);return r.a.makeTensor(c,e,t)}},function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var r=n(3),a=n(12),i=n(7),o=n(32),s=n(6),u=n(26),c=n(9);var l=Object(c.b)({lessEqual_:function(e,t){var n=Object(s.a)(e,"a","lessEqual","string_or_numeric"),c=Object(s.a)(t,"b","lessEqual","string_or_numeric"),l=Object(o.makeTypesMatch)(n,c),d=Object(r.a)(l,2);n=d[0],c=d[1],Object(u.assertAndGetBroadcastShape)(n.shape,c.shape);var p={a:n,b:c};return a.a.runKernel(i.Cb,p)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(7),i=n(6),o=n(9);var s=Object(o.b)({pad_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=Object(i.a)(e,"x","pad");if(0===o.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var s={paddings:t,constantValue:n},u={x:o};return r.a.runKernel(a.gc,u,s)}})},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return E})),n.d(t,"i",(function(){return A})),n.d(t,"c",(function(){return R})),n.d(t,"f",(function(){return D})),n.d(t,"e",(function(){return z})),n.d(t,"d",(function(){return L})),n.d(t,"k",(function(){return B})),n.d(t,"g",(function(){return W})),n.d(t,"h",(function(){return U})),n.d(t,"j",(function(){return V})),n.d(t,"b",(function(){return G}));var r=n(3),a=n(15),i=n(2),o=n(4),s=n(0),u=n(86),c=n(112),l=n(5),d=n(230),p=n(231),f=n(232),h=n(233),m=n(234),v=n(235),b=n(236),g=n(237),y=n(238),x=n(239),k=n(240),w=n(241),O=n(242),I=n(243),S=n(244),N=n(245),j=n(246),T=n(247),C=n(248),E=function(){function e(){var t;Object(i.a)(this,e);var n=[d,p,f,h,m,v,b,g,y,x,k,w,O,I,S,N,j,T,C],r=(t=[]).concat.apply(t,Object(a.a)(n.map((function(e){return e.json}))));this.opMappers=r.reduce((function(e,t){return e[t.tfOpName]=t,e}),{})}return Object(o.a)(e,null,[{key:"Instance",get:function(){return this._instance||(this._instance=new this)}}]),Object(o.a)(e,[{key:"transformGraph",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=e.node,i=[],o=[],s=[],u=a.reduce((function(e,n){return e[n.name]=t.mapNode(n),n.op.startsWith("Placeholder")?i.push(e[n.name]):"Const"===n.op?o.push(e[n.name]):null!=n.input&&0!==n.input.length||s.push(e[n.name]),e}),{}),c=[],d=[],p={},f={};null!=n&&(p=this.mapSignatureEntries(n.inputs),f=this.mapSignatureEntries(n.outputs));var h=Object.keys(u);h.forEach((function(e){var t=u[e];t.inputNames.forEach((function(e,n){var a=Object(l.b)(e),i=Object(r.a)(a,3),o=i[0],s=i[2],c=u[o];if(null!=c.outputs){var d=c.outputs.indexOf(s);if(-1!==d){var p="".concat(o,":").concat(d);t.inputNames[n]=p}}t.inputs.push(c),c.children.push(t)}))})),0===Object.keys(f).length?h.forEach((function(e){var t=u[e];0===t.children.length&&d.push(t)})):Object.keys(f).forEach((function(e){var t=Object(l.b)(e),n=Object(r.a)(t,1)[0],a=u[n];null!=a&&(a.signatureKey=f[e],d.push(a))})),Object.keys(p).length>0?Object.keys(p).forEach((function(e){var t=Object(l.b)(e),n=Object(r.a)(t,1)[0],a=u[n];a&&(a.signatureKey=p[e],c.push(a))})):c=i;var m={};null!=e.library&&null!=e.library.function&&(m=e.library.function.reduce((function(e,n){return e[n.signature.name]=t.mapFunction(n),e}),{}));var v={nodes:u,inputs:c,outputs:d,weights:o,placeholders:i,signature:n,functions:m};return s.length>0&&(v.initNodes=s),v}},{key:"mapSignatureEntries",value:function(e){return Object.keys(e||{}).reduce((function(t,n){return t[e[n].name]=n,t}),{})}},{key:"mapNode",value:function(e){var t=Object(c.a)(e.op)||this.opMappers[e.op]||{};null==e.attr&&(e.attr={});var n={name:e.name,op:e.op,category:t.category,inputNames:(e.input||[]).map((function(e){return e.startsWith("^")?e.slice(1):e})),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:e.attr,outputs:t.outputs};return null!=t.inputs&&(n.inputParams=t.inputs.reduce((function(e,t){return e[t.name]={type:t.type,inputIndexStart:t.start,inputIndexEnd:t.end},e}),{})),null!=t.attrs&&(n.attrParams=t.attrs.reduce((function(t,n){var r=n.type,a=void 0;switch(n.type){case"string":void 0===(a=A(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=A(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"string[]":void 0===(a=U(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=U(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"number":void 0===(a=D(e.attr,n.tfName,n.defaultValue||0))&&n.tfDeprecatedName&&(a=D(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"number[]":void 0===(a=W(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=W(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool":void 0===(a=R(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=R(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool[]":void 0===(a=G(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=G(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape":void 0===(a=B(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=B(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape[]":void 0===(a=V(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=V(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype":void 0===(a=z(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=z(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype[]":void 0===(a=L(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=L(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"func":void 0===(a=M(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=M(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error("Unsupported param type: ".concat(n.type," for op: ").concat(e.op))}return t[n.name]={value:a,type:r},t}),{})),n}},{key:"mapFunction",value:function(e){var t=this,n=e.nodeDef,a=[],i={};null!=n&&(i=n.reduce((function(e,n){return e[n.name]=t.mapNode(n),"Const"===n.op&&a.push(e[n.name]),e}),{}));var o=[],s=[];e.signature.inputArg.forEach((function(e){var t=Object(l.b)(e.name),n=Object(r.a)(t,1)[0],a={name:n,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:F(e.type),type:"dtype"}},children:[]};a.signatureKey=e.name,o.push(a),i[n]=a})),Object.keys(i).forEach((function(e){var t=i[e];t.inputNames.forEach((function(e,n){var a=Object(l.b)(e),o=Object(r.a)(a,3),s=o[0],u=o[2],c=i[s];if(null!=c.outputs){var d=c.outputs.indexOf(u);if(-1!==d){var p="".concat(s,":").concat(d);t.inputNames[n]=p}}t.inputs.push(c),c.children.push(t)}))}));var u=e.ret;e.signature.outputArg.forEach((function(e){var t=Object(l.b)(u[e.name]),n=Object(r.a)(t,2),a=n[0],o=n[1],c=i[a];null!=c&&(c.defaultOutput=o,s.push(c))}));var c=this.mapArgsToSignature(e);return{nodes:i,inputs:o,outputs:s,weights:a,placeholders:[],signature:c}}},{key:"mapArgsToSignature",value:function(e){var t=this;return{methodName:e.signature.name,inputs:e.signature.inputArg.reduce((function(e,n){return e[n.name]=t.mapArgToTensorInfo(n),e}),{}),outputs:e.signature.outputArg.reduce((function(n,r){return n[r.name]=t.mapArgToTensorInfo(r,e.ret),n}),{})}}},{key:"mapArgToTensorInfo",value:function(e,t){var n=e.name;return null!=t&&(n=t[n]),{name:n,dtype:e.type}}}]),e}();function _(t,n){var r=Array.isArray(t)?String.fromCharCode.apply(null,t):function(t){var n=Object(s.be)().global;if("undefined"!==typeof n.atob)return n.atob(t);if("undefined"!==typeof e)return new e(t,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}(t);return n?r:r.toLowerCase()}function A(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e[t];return null!=a?_(a.s,r):n}function R(e,t,n){var r=e[t];return r?r.b:n}function D(e,t,n){var r=e[t]||{},a=null!=r.i?r.i:null!=r.f?r.f:n;return"number"===typeof a?a:parseInt(a,10)}function F(e){switch("string"===typeof e&&(e=u.a[e]),e){case u.a.DT_FLOAT:case u.a.DT_HALF:return"float32";case u.a.DT_INT32:case u.a.DT_INT64:case u.a.DT_INT8:case u.a.DT_UINT8:return"int32";case u.a.DT_BOOL:return"bool";case u.a.DT_DOUBLE:return"float32";case u.a.DT_STRING:return"string";default:return null}}function M(e,t,n){var r=e[t];return r&&r.func?r.func.name:n}function z(e,t,n){var r=e[t];return r&&r.type?F(r.type):n}function L(e,t,n){var r=e[t];return r&&r.list&&r.list.type?r.list.type.map((function(e){return F(e)})):n}function P(e){if(!e.unknownRank)return null!=e.dim?e.dim.map((function(e){return"number"===typeof e.size?e.size:parseInt(e.size,10)})):[]}function B(e,t,n){var r=e[t];return r&&r.shape?P(r.shape):n}function W(e,t,n){var r=e[t];return r?((r.list.f&&r.list.f.length?r.list.f:r.list.i)||[]).map((function(e){return"number"===typeof e?e:parseInt(e,10)})):n}function U(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e[t];return a&&a.list&&a.list.s?a.list.s.map((function(e){return _(e,r)})):n}function V(e,t,n){var r=e[t];return r&&r.list&&r.list.shape?r.list.shape.map((function(e){return P(e)})):n}function G(e,t,n){var r=e[t];return r&&r.list&&r.list.b?r.list.b:n}}).call(this,n(152).Buffer)},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(19),a=n(139);var i=n(189);function o(e,t,n){return(o=Object(i.a)()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&Object(a.a)(i,n.prototype),i}).apply(null,arguments)}function s(e){var t="function"===typeof Map?new Map:void 0;return(s=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!==typeof e)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof t){if(t.has(e))return t.get(e);t.set(e,i)}function i(){return o(e,arguments,Object(r.a)(this).constructor)}return i.prototype=Object.create(e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),Object(a.a)(i,e)})(e)}},function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(12),a=n(7),i=n(6),o=n(26),s=n(9);var u=Object(s.b)({logicalAnd_:function(e,t){var n=Object(i.a)(e,"a","logicalAnd","bool"),s=Object(i.a)(t,"b","logicalAnd","bool");Object(o.assertAndGetBroadcastShape)(n.shape,s.shape);var u={a:n,b:s};return r.a.runKernel(a.Hb,u)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(7),i=n(6),o=n(9);var s=Object(o.b)({split_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=Object(i.a)(e,"x","split"),s={x:o},u={numOrSizeSplits:t,axis:n};return r.a.runKernel(a.Sc,s,u)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(12),a=n(7),i=n(6),o=n(18),s=n(9);var u=Object(s.b)({stack_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Object(i.b)(e,"tensors","stack","string_or_numeric");o.b(n.length>=1,(function(){return"Pass at least one tensor to tf.stack"})),n.length>0&&o.b(t<=n[0].rank,(function(){return"Axis must be <= rank of the tensor"}));var s=n,u={axis:t};return r.a.runKernel(a.fc,s,u)}})},function(e,t,n){"use strict";n.d(t,"b",(function(){return c})),n.d(t,"a",(function(){return l})),n.d(t,"c",(function(){return d})),n.d(t,"e",(function(){return p})),n.d(t,"d",(function(){return f}));var r=n(3),a=n(30),i=n(116),o=n(85),s=Object(i.a)("kernelRegistry",(function(){return new Map})),u=Object(i.a)("gradRegistry",(function(){return new Map}));function c(e,t){var n=h(e,t);return s.get(n)}function l(e){return u.get(e)}function d(e){for(var t=s.entries(),n=[];;){var a=t.next(),i=a.done,o=a.value;if(i)break;var u=Object(r.a)(o,2),c=u[0],l=u[1],d=c.split("_");Object(r.a)(d,1)[0]===e&&n.push(l)}return n}function p(e){var t=e.kernelName,n=e.backendName,r=h(t,n);s.has(r)&&o.b("The kernel '".concat(t,"' for backend ")+"'".concat(n,"' is already registered")),s.set(r,e)}function f(e){var t=e.kernelName;u.has(t)&&Object(a.b)().getBool("DEBUG")&&o.b("Overriding the gradient for '".concat(t,"'")),u.set(t,e)}function h(e,t){return"".concat(t,"_").concat(e)}},function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(12),a=n(7),i=n(6),o=n(18),s=n(9);var u=Object(s.b)({expandDims_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Object(i.a)(e,"x","expandDims","string_or_numeric");o.b(t<=n.rank,(function(){return"Axis must be <= rank of the tensor"}));var s={input:n},u={dim:t};return r.a.runKernel(a.db,s,u)}})},function(e,t,n){"use strict";e.exports=n(255)},function(e,t,n){"use strict";(function(e,r,a,i,o,s){n.d(t,"a",(function(){return B1})),n.d(t,"b",(function(){return KQ})),n.d(t,"c",(function(){return g$})),n.d(t,"d",(function(){return P1})),n.d(t,"e",(function(){return L1})),n.d(t,"f",(function(){return mQ})),n.d(t,"g",(function(){return A$})),n.d(t,"h",(function(){return P$})),n.d(t,"i",(function(){return g1})),n.d(t,"j",(function(){return W1}));var u=n(56),c=n(202),l=n(58),d=n(20),p=n(19),f=n(40),h=n(69),m=n(41),v=n(117),b=n(10),g=n(11),y=n(3),x=n(1),k=n.n(x),w=n(8),O=n(2),I=n(4),S=n(15),N=n(14),j=Object.defineProperty,T=n(228),C=function(e,t){for(var n in t)j(e,n,{get:t[n],enumerable:!0})};C({},{Abs:function(){return pt},Acos:function(){return ft},Acosh:function(){return ht},AdadeltaOptimizer:function(){return Oh},AdagradOptimizer:function(){return Ih},AdamOptimizer:function(){return Sh},AdamaxOptimizer:function(){return Nh},Add:function(){return mt},AddN:function(){return vt},All:function(){return bt},Any:function(){return gt},ArgMax:function(){return yt},ArgMin:function(){return xt},Asin:function(){return kt},Asinh:function(){return wt},Atan:function(){return Ot},Atan2:function(){return St},Atanh:function(){return It},AvgPool:function(){return Nt},AvgPool3D:function(){return Tt},AvgPool3DGrad:function(){return Ct},AvgPoolGrad:function(){return jt},BackendWasm:function(){return ZJ},BatchMatMul:function(){return Et},BatchToSpaceND:function(){return _t},Bincount:function(){return At},BitwiseAnd:function(){return Rt},BroadcastArgs:function(){return Ft},BroadcastTo:function(){return Dt},Callback:function(){return SN},CallbackList:function(){return Kx},Cast:function(){return Mt},Ceil:function(){return zt},ClipByValue:function(){return Lt},Complex:function(){return Pt},ComplexAbs:function(){return Bt},Concat:function(){return Wt},Conv2D:function(){return Ut},Conv2DBackpropFilter:function(){return Vt},Conv2DBackpropInput:function(){return Gt},Conv3D:function(){return Ht},Conv3DBackpropFilterV2:function(){return qt},Conv3DBackpropInputV2:function(){return Kt},Cos:function(){return Xt},Cosh:function(){return Yt},CropAndResize:function(){return Qt},Cumprod:function(){return Zt},Cumsum:function(){return Jt},CustomCallback:function(){return Zx},DataStorage:function(){return oe},DenseBincount:function(){return $t},DepthToSpace:function(){return en},DepthwiseConv2dNative:function(){return tn},DepthwiseConv2dNativeBackpropFilter:function(){return nn},DepthwiseConv2dNativeBackpropInput:function(){return rn},Diag:function(){return an},Dilation2D:function(){return on},Dilation2DBackpropFilter:function(){return un},Dilation2DBackpropInput:function(){return sn},Draw:function(){return cn},ENV:function(){return ct},EarlyStopping:function(){return TN},Einsum:function(){return dn},Elu:function(){return pn},EluGrad:function(){return fn},Environment:function(){return at},Equal:function(){return mn},Erf:function(){return hn},Exp:function(){return vn},ExpandDims:function(){return bn},Expm1:function(){return gn},FFT:function(){return yn},Fill:function(){return xn},FlipLeftRight:function(){return kn},Floor:function(){return wn},FloorDiv:function(){return On},FromPixels:function(){return Na},FusedBatchNorm:function(){return In},FusedConv2D:function(){return Ca},FusedDepthwiseConv2D:function(){return Ea},GPGPUContext:function(){return aP},GatherNd:function(){return Nn},GatherV2:function(){return Sn},GraphModel:function(){return zT},Greater:function(){return jn},GreaterEqual:function(){return Tn},History:function(){return Yx},IFFT:function(){return En},Identity:function(){return Cn},Imag:function(){return _n},InputSpec:function(){return Yy},IsFinite:function(){return An},IsInf:function(){return Rn},IsNan:function(){return Dn},KernelBackend:function(){return se},LRN:function(){return Kn},LRNGrad:function(){return Xn},LayerVariable:function(){return qy},LayersModel:function(){return sw},LeakyRelu:function(){return Fn},Less:function(){return Mn},LessEqual:function(){return zn},LinSpace:function(){return Ln},Log:function(){return Pn},Log1p:function(){return Bn},LogSoftmax:function(){return Hn},LogicalAnd:function(){return Wn},LogicalNot:function(){return Un},LogicalOr:function(){return Vn},LogicalXor:function(){return Gn},LowerBound:function(){return qn},MathBackendCPU:function(){return dE},MathBackendWebGL:function(){return jB},MatrixBandPart:function(){return Yn},Max:function(){return Zn},MaxPool:function(){return Qn},MaxPool3D:function(){return er},MaxPool3DGrad:function(){return tr},MaxPoolGrad:function(){return $n},MaxPoolWithArgmax:function(){return nr},Maximum:function(){return Jn},Mean:function(){return rr},Min:function(){return ar},Minimum:function(){return ir},MirrorPad:function(){return or},Mod:function(){return sr},MomentumOptimizer:function(){return Th},Multinomial:function(){return ur},Multiply:function(){return cr},Neg:function(){return lr},NonMaxSuppressionV3:function(){return pr},NonMaxSuppressionV4:function(){return fr},NonMaxSuppressionV5:function(){return hr},NotEqual:function(){return dr},OP_SCOPE_SUFFIX:function(){return co},OneHot:function(){return vr},OnesLike:function(){return mr},Optimizer:function(){return wh},OptimizerConstructors:function(){return Mm},Pack:function(){return br},PadV2:function(){return gr},Pool:function(){return yr},Pow:function(){return xr},Prelu:function(){return kr},Prod:function(){return wr},RMSPropOptimizer:function(){return Ch},RNN:function(){return gO},RaggedGather:function(){return Or},RaggedRange:function(){return Ir},RaggedTensorToTensor:function(){return Sr},Range:function(){return Nr},Rank:function(){return _i},Real:function(){return jr},RealDiv:function(){return ln},Reciprocal:function(){return Tr},Reduction:function(){return Gf},Relu:function(){return Cr},Relu6:function(){return Fr},Reshape:function(){return Er},ResizeBilinear:function(){return Rr},ResizeBilinearGrad:function(){return Dr},ResizeNearestNeighbor:function(){return _r},ResizeNearestNeighborGrad:function(){return Ar},Reverse:function(){return Mr},RotateWithOffset:function(){return ja},Round:function(){return zr},Rsqrt:function(){return Lr},SGDOptimizer:function(){return jh},ScatterNd:function(){return Pr},SearchSorted:function(){return Wr},Select:function(){return Ur},Selu:function(){return Vr},Sequential:function(){return vw},Sigmoid:function(){return Xr},Sign:function(){return Kr},Sin:function(){return Hr},Sinh:function(){return qr},Slice:function(){return Gr},Softmax:function(){return ea},Softplus:function(){return Yr},SpaceToBatchND:function(){return Qr},SparseFillEmptyRows:function(){return ta},SparseReshape:function(){return na},SparseSegmentMean:function(){return ra},SparseSegmentSum:function(){return aa},SparseToDense:function(){return ia},SplitV:function(){return $r},Sqrt:function(){return Zr},Square:function(){return sa},SquaredDifference:function(){return oa},StaticRegexReplace:function(){return ua},Step:function(){return Sa},StridedSlice:function(){return ca},StringNGrams:function(){return la},StringSplit:function(){return da},StringToHashBucketFast:function(){return pa},Sub:function(){return fa},Sum:function(){return Jr},SymbolicTensor:function(){return Zy},Tan:function(){return ha},Tanh:function(){return ma},Tensor:function(){return Ti},TensorBuffer:function(){return Si},TensorScatterUpdate:function(){return Br},Tile:function(){return va},TopK:function(){return ba},Transform:function(){return ga},Transpose:function(){return ya},Unique:function(){return xa},Unpack:function(){return ka},UnsortedSegmentSum:function(){return wa},UpperBound:function(){return Oa},Variable:function(){return Ei},ZerosLike:function(){return Ia},_FusedMatMul:function(){return Ta},abs:function(){return eu},acos:function(){return tu},acosh:function(){return nu},add:function(){return Zs},addN:function(){return ru},all:function(){return au},any:function(){return iu},argMax:function(){return ou},argMin:function(){return su},asin:function(){return uu},asinh:function(){return cu},atan:function(){return lu},atan2:function(){return du},atanh:function(){return pu},avgPool:function(){return _u},avgPool3d:function(){return Au},backend:function(){return Xs},backend_util:function(){return Wm},basicLSTMCell:function(){return Lu},batchNorm:function(){return Wu},batchNorm2d:function(){return Uu},batchNorm3d:function(){return Vu},batchNorm4d:function(){return Gu},batchToSpaceND:function(){return Pu},bincount:function(){return Hu},bitwiseAnd:function(){return qu},booleanMaskAsync:function(){return Pp},broadcastArgs:function(){return Ku},broadcastTo:function(){return Xu},broadcast_util:function(){return gc},browser:function(){return rm},buffer:function(){return Ss},callbacks:function(){return _N},cast:function(){return Ns},ceil:function(){return Yu},clipByValue:function(){return Ju},clone:function(){return js},complex:function(){return po},concat:function(){return Ru},concat1d:function(){return Qu},concat2d:function(){return $u},concat3d:function(){return ec},concat4d:function(){return tc},constraints:function(){return lx},conv1d:function(){return rc},conv2d:function(){return nc},conv2dTranspose:function(){return ic},conv3d:function(){return oc},conv3dTranspose:function(){return uc},copyRegisteredKernels:function(){return Ua},cos:function(){return cc},cosh:function(){return lc},cosineWindow:function(){return Xp},cumprod:function(){return dc},cumsum:function(){return pc},customGrad:function(){return xl},data:function(){return VT},denseBincount:function(){return fc},deprecationWarn:function(){return As},depthToSpace:function(){return hc},depthwiseConv2d:function(){return mc},deregisterOp:function(){return FN},device_util:function(){return eo},diag:function(){return vc},dilation2d:function(){return bc},disableDeprecationWarnings:function(){return _s},dispose:function(){return Ls},disposeVariables:function(){return Rs},div:function(){return Qs},divNoNan:function(){return Sc},dot:function(){return Nc},dropout:function(){return qp},einsum:function(){return jc},elu:function(){return Tc},enableDebugMode:function(){return Es},enableProdMode:function(){return Cs},enclosingPowerOfTwo:function(){return Kp},engine:function(){return Ds},ensureShape:function(){return Cc},env:function(){return st},equal:function(){return wc},erf:function(){return Ec},euclideanNorm:function(){return Xc},exp:function(){return Yc},expandDims:function(){return Zc},expm1:function(){return Jc},eye:function(){return $c},fft:function(){return op},fill:function(){return Zu},findBackend:function(){return Hs},findBackendFactory:function(){return qs},floor:function(){return el},floorDiv:function(){return Js},forceHalfFloat:function(){return CB},fused:function(){return Jp},gather:function(){return tl},gatherND:function(){return Hp},gather_util:function(){return mm},getBackend:function(){return Vs},getGradient:function(){return Ma},getKernel:function(){return Fa},getKernelsForBackend:function(){return za},getThreadsCount:function(){return pQ},gpgpu_util:function(){return FL},grad:function(){return ml},grads:function(){return vl},greater:function(){return nl},greaterEqual:function(){return rl},ifft:function(){return sp},imag:function(){return al},image:function(){return fh},inTopKAsync:function(){return Zp},initializers:function(){return Sx},input:function(){return yw},io:function(){return _h},irfft:function(){return up},isFinite:function(){return il},isInf:function(){return ol},isNaN:function(){return sl},keep:function(){return Ps},kernel_impls:function(){return Gv},layers:function(){return Ux},leakyRelu:function(){return ul},less:function(){return cl},lessEqual:function(){return ll},linalg:function(){return hh},linspace:function(){return dl},loadGraphModel:function(){return LT},loadGraphModelSync:function(){return BT},loadLayersModel:function(){return dw},localResponseNormalization:function(){return pl},log:function(){return fl},log1p:function(){return hl},logSigmoid:function(){return Il},logSoftmax:function(){return Nl},logSumExp:function(){return jl},logicalAnd:function(){return Tl},logicalNot:function(){return Cl},logicalOr:function(){return El},logicalXor:function(){return _l},losses:function(){return mh},lowerBound:function(){return Dl},matMul:function(){return Du},math:function(){return tm},max:function(){return Pc},maxPool:function(){return Fl},maxPool3d:function(){return Ml},maxPoolWithArgmax:function(){return zl},maximum:function(){return Ll},mean:function(){return Pl},memory:function(){return Fs},meshgrid:function(){return Ul},metrics:function(){return aN},min:function(){return Bc},minimum:function(){return Vl},mirrorPad:function(){return Gl},mod:function(){return Hl},model:function(){return bw},models:function(){return xN},moments:function(){return ql},movingAverage:function(){return Wp},mul:function(){return $s},multiRNNCell:function(){return Kl},multinomial:function(){return Xl},neg:function(){return wl},nextFrame:function(){return Pm},norm:function(){return Kc},notEqual:function(){return Yl},oneHot:function(){return Zl},ones:function(){return Wl},onesLike:function(){return Jl},op:function(){return lo},outerProduct:function(){return Ql},pad:function(){return $l},pad1d:function(){return ed},pad2d:function(){return td},pad3d:function(){return nd},pad4d:function(){return rd},pool:function(){return id},pow:function(){return Wc},prelu:function(){return od},print:function(){return Ts},prod:function(){return sd},profile:function(){return Ms},raggedGather:function(){return ud},raggedRange:function(){return cd},raggedTensorToTensor:function(){return ld},rand:function(){return dd},randomGamma:function(){return _d},randomNormal:function(){return Ad},randomStandardNormal:function(){return Rd},randomUniform:function(){return Dd},randomUniformInt:function(){return Fd},range:function(){return Md},ready:function(){return Us},real:function(){return zd},reciprocal:function(){return Ld},registerBackend:function(){return Ks},registerCallbackConstructor:function(){return xw},registerGradient:function(){return Pa},registerKernel:function(){return La},registerOp:function(){return RN},regularizers:function(){return kN},relu:function(){return Pd},relu6:function(){return Bd},removeBackend:function(){return Gs},reshape:function(){return Eu},reverse:function(){return Wd},reverse1d:function(){return Ud},reverse2d:function(){return Vd},reverse3d:function(){return Gd},reverse4d:function(){return Hd},rfft:function(){return lp},round:function(){return qd},rsqrt:function(){return Kd},scalar:function(){return Uc},scatterND:function(){return Up},scatter_util:function(){return Op},searchSorted:function(){return Rl},selu:function(){return Xd},separableConv2d:function(){return Yd},sequential:function(){return gw},serialization:function(){return gh},setBackend:function(){return Ws},setPlatform:function(){return Ys},setThreadsCount:function(){return dQ},setWasmPath:function(){return sQ},setWasmPaths:function(){return uQ},setWebGLContext:function(){return GM},setdiff1dAsync:function(){return Jd},shared:function(){return pE},sigmoid:function(){return Fu},sign:function(){return Qd},signal:function(){return ph},sin:function(){return $d},sinh:function(){return ep},slice:function(){return Mu},slice1d:function(){return tp},slice2d:function(){return np},slice3d:function(){return rp},slice4d:function(){return ap},slice_util:function(){return bm},softmax:function(){return ip},softplus:function(){return Ol},spaceToBatchND:function(){return ad},sparse:function(){return vh},sparseToDense:function(){return Gp},spectral:function(){return dh},split:function(){return cp},sqrt:function(){return Vc},square:function(){return Gc},squaredDifference:function(){return dp},squeeze:function(){return pp},stack:function(){return fp},step:function(){return hp},stridedSlice:function(){return mp},string:function(){return bh},sub:function(){return Sl},sum:function(){return Hc},sumOutType:function(){return Pi},tan:function(){return vp},tanh:function(){return zu},tensor:function(){return ho},tensor1d:function(){return bp},tensor2d:function(){return gp},tensor3d:function(){return yp},tensor4d:function(){return xp},tensor5d:function(){return kp},tensor6d:function(){return wp},tensorScatterUpdate:function(){return jp},tensor_util:function(){return Mi},test_util:function(){return fd},tidy:function(){return zs},tile:function(){return Qc},time:function(){return Bs},topk:function(){return Tp},train:function(){return zm},transpose:function(){return Bp},truncatedNormal:function(){return Cp},unique:function(){return Ep},unregisterGradient:function(){return Wa},unregisterKernel:function(){return Ba},unsortedSegmentSum:function(){return _p},unstack:function(){return Ap},upcastType:function(){return Li},upperBound:function(){return Rp},util:function(){return Ga},valueAndGrad:function(){return bl},valueAndGrads:function(){return gl},variable:function(){return Dp},variableGrads:function(){return yl},version:function(){return hQ},version_converter:function(){return UT},version_core:function(){return Fm},version_cpu:function(){return LA},version_layers:function(){return Dk},version_wasm:function(){return fQ},version_webgl:function(){return TB},webgl:function(){return EB},webgl_util:function(){return LM},where:function(){return Oc},whereAsync:function(){return zp},zeros:function(){return Bl},zerosLike:function(){return Ic}});var E=Object.create,_=Object.defineProperty,A=Object.getOwnPropertyDescriptor,R=Object.getOwnPropertyNames,D=Object.getPrototypeOf,F=Object.prototype.hasOwnProperty,M=function(e,t){return function(){return t||e((t={exports:{}}).exports,t),t.exports}},z=function(e,t){for(var n in t)_(e,n,{get:t[n],enumerable:!0})},L=function(e,t,n){return n=null!=e?E(D(e)):{},function(e,t,n,r){if(t&&"object"==typeof t||"function"==typeof t){var a,i=Object(N.a)(R(t));try{var o=function(){var i=a.value;!F.call(e,i)&&i!==n&&_(e,i,{get:function(){return t[i]},enumerable:!(r=A(t,i))||r.enumerable})};for(i.s();!(a=i.n()).done;)o()}catch(s){i.e(s)}finally{i.f()}}return e}(!t&&e&&e.__esModule?n:_(n,"default",{value:e,enumerable:!0}),e)},P=M((function(e,t){t.exports=r;var n=null;try{n=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(N){}function r(e,t,n){this.low=0|e,this.high=0|t,this.unsigned=!!n}function a(e){return!0===(e&&e.__isLong__)}r.prototype.__isLong__,Object.defineProperty(r.prototype,"__isLong__",{value:!0}),r.isLong=a;var i={},o={};function s(e,t){var n,r,a;return t?(a=0<=(e>>>=0)&&e<256)&&(r=o[e])?r:(n=c(e,(0|e)<0?-1:0,!0),a&&(o[e]=n),n):(a=-128<=(e|=0)&&e<128)&&(r=i[e])?r:(n=c(e,e<0?-1:0,!1),a&&(i[e]=n),n)}function u(e,t){if(isNaN(e))return t?g:b;if(t){if(e<0)return g;if(e>=h)return O}else{if(e<=-m)return I;if(e+1>=m)return w}return e<0?u(-e,t).neg():c(e%f|0,e/f|0,t)}function c(e,t,n){return new r(e,t,n)}r.fromInt=s,r.fromNumber=u,r.fromBits=c;var l=Math.pow;function d(e,t,n){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return b;if("number"==typeof t?(n=t,t=!1):t=!!t,(n=n||10)<2||36<n)throw RangeError("radix");var r;if((r=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return d(e.substring(1),t,n).neg();for(var a=u(l(n,8)),i=b,o=0;o<e.length;o+=8){var s=Math.min(8,e.length-o),c=parseInt(e.substring(o,o+s),n);if(s<8){var p=u(l(n,s));i=i.mul(p).add(u(c))}else i=(i=i.mul(a)).add(u(c))}return i.unsigned=t,i}function p(e,t){return"number"==typeof e?u(e,t):"string"==typeof e?d(e,t):c(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}r.fromString=d,r.fromValue=p;var f=4294967296,h=f*f,m=h/2,v=s(1<<24),b=s(0);r.ZERO=b;var g=s(0,!0);r.UZERO=g;var y=s(1);r.ONE=y;var x=s(1,!0);r.UONE=x;var k=s(-1);r.NEG_ONE=k;var w=c(-1,2147483647,!1);r.MAX_VALUE=w;var O=c(-1,-1,!0);r.MAX_UNSIGNED_VALUE=O;var I=c(0,-2147483648,!1);r.MIN_VALUE=I;var S=r.prototype;S.toInt=function(){return this.unsigned?this.low>>>0:this.low},S.toNumber=function(){return this.unsigned?(this.high>>>0)*f+(this.low>>>0):this.high*f+(this.low>>>0)},S.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(I)){var t=u(e),n=this.div(t),r=n.mul(t).sub(this);return n.toString(e)+r.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var a=u(l(e,6),this.unsigned),i=this,o="";;){var s=i.div(a),c=(i.sub(s.mul(a)).toInt()>>>0).toString(e);if((i=s).isZero())return c+o;for(;c.length<6;)c="0"+c;o=""+c+o}},S.getHighBits=function(){return this.high},S.getHighBitsUnsigned=function(){return this.high>>>0},S.getLowBits=function(){return this.low},S.getLowBitsUnsigned=function(){return this.low>>>0},S.getNumBitsAbs=function(){if(this.isNegative())return this.eq(I)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&!(e&1<<t);t--);return 0!=this.high?t+33:t+1},S.isZero=function(){return 0===this.high&&0===this.low},S.eqz=S.isZero,S.isNegative=function(){return!this.unsigned&&this.high<0},S.isPositive=function(){return this.unsigned||this.high>=0},S.isOdd=function(){return 1===(1&this.low)},S.isEven=function(){return 0===(1&this.low)},S.equals=function(e){return a(e)||(e=p(e)),(this.unsigned===e.unsigned||this.high>>>31!==1||e.high>>>31!==1)&&(this.high===e.high&&this.low===e.low)},S.eq=S.equals,S.notEquals=function(e){return!this.eq(e)},S.neq=S.notEquals,S.ne=S.notEquals,S.lessThan=function(e){return this.comp(e)<0},S.lt=S.lessThan,S.lessThanOrEqual=function(e){return this.comp(e)<=0},S.lte=S.lessThanOrEqual,S.le=S.lessThanOrEqual,S.greaterThan=function(e){return this.comp(e)>0},S.gt=S.greaterThan,S.greaterThanOrEqual=function(e){return this.comp(e)>=0},S.gte=S.greaterThanOrEqual,S.ge=S.greaterThanOrEqual,S.compare=function(e){if(a(e)||(e=p(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},S.comp=S.compare,S.negate=function(){return!this.unsigned&&this.eq(I)?I:this.not().add(y)},S.neg=S.negate,S.add=function(e){a(e)||(e=p(e));var t=this.high>>>16,n=65535&this.high,r=this.low>>>16,i=65535&this.low,o=e.high>>>16,s=65535&e.high,u=e.low>>>16,l=0,d=0,f=0,h=0;return f+=(h+=i+(65535&e.low))>>>16,d+=(f+=r+u)>>>16,l+=(d+=n+s)>>>16,l+=t+o,c((f&=65535)<<16|(h&=65535),(l&=65535)<<16|(d&=65535),this.unsigned)},S.subtract=function(e){return a(e)||(e=p(e)),this.add(e.neg())},S.sub=S.subtract,S.multiply=function(e){if(this.isZero())return b;if(a(e)||(e=p(e)),n)return c(n.mul(this.low,this.high,e.low,e.high),n.get_high(),this.unsigned);if(e.isZero())return b;if(this.eq(I))return e.isOdd()?I:b;if(e.eq(I))return this.isOdd()?I:b;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(v)&&e.lt(v))return u(this.toNumber()*e.toNumber(),this.unsigned);var t=this.high>>>16,r=65535&this.high,i=this.low>>>16,o=65535&this.low,s=e.high>>>16,l=65535&e.high,d=e.low>>>16,f=65535&e.low,h=0,m=0,g=0,y=0;return g+=(y+=o*f)>>>16,m+=(g+=i*f)>>>16,g&=65535,m+=(g+=o*d)>>>16,h+=(m+=r*f)>>>16,m&=65535,h+=(m+=i*d)>>>16,m&=65535,h+=(m+=o*l)>>>16,h+=t*f+r*d+i*l+o*s,c((g&=65535)<<16|(y&=65535),(h&=65535)<<16|(m&=65535),this.unsigned)},S.mul=S.multiply,S.divide=function(e){if(a(e)||(e=p(e)),e.isZero())throw Error("division by zero");var t,r,i;if(n)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?c((this.unsigned?n.div_u:n.div_s)(this.low,this.high,e.low,e.high),n.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?g:b;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return g;if(e.gt(this.shru(1)))return x;i=g}else{if(this.eq(I))return e.eq(y)||e.eq(k)?I:e.eq(I)?y:(t=this.shr(1).div(e).shl(1)).eq(b)?e.isNegative()?y:k:(r=this.sub(e.mul(t)),i=t.add(r.div(e)));if(e.eq(I))return this.unsigned?g:b;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=b}for(r=this;r.gte(e);){t=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));for(var o=Math.ceil(Math.log(t)/Math.LN2),s=o<=48?1:l(2,o-48),d=u(t),f=d.mul(e);f.isNegative()||f.gt(r);)f=(d=u(t-=s,this.unsigned)).mul(e);d.isZero()&&(d=y),i=i.add(d),r=r.sub(f)}return i},S.div=S.divide,S.modulo=function(e){return a(e)||(e=p(e)),n?c((this.unsigned?n.rem_u:n.rem_s)(this.low,this.high,e.low,e.high),n.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},S.mod=S.modulo,S.rem=S.modulo,S.not=function(){return c(~this.low,~this.high,this.unsigned)},S.and=function(e){return a(e)||(e=p(e)),c(this.low&e.low,this.high&e.high,this.unsigned)},S.or=function(e){return a(e)||(e=p(e)),c(this.low|e.low,this.high|e.high,this.unsigned)},S.xor=function(e){return a(e)||(e=p(e)),c(this.low^e.low,this.high^e.high,this.unsigned)},S.shiftLeft=function(e){return a(e)&&(e=e.toInt()),0===(e&=63)?this:e<32?c(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):c(0,this.low<<e-32,this.unsigned)},S.shl=S.shiftLeft,S.shiftRight=function(e){return a(e)&&(e=e.toInt()),0===(e&=63)?this:e<32?c(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):c(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},S.shr=S.shiftRight,S.shiftRightUnsigned=function(e){if(a(e)&&(e=e.toInt()),0===(e&=63))return this;var t=this.high;return e<32?c(this.low>>>e|t<<32-e,t>>>e,this.unsigned):c(32===e?t:t>>>e-32,0,this.unsigned)},S.shru=S.shiftRightUnsigned,S.shr_u=S.shiftRightUnsigned,S.toSigned=function(){return this.unsigned?c(this.low,this.high,!1):this},S.toUnsigned=function(){return this.unsigned?this:c(this.low,this.high,!0)},S.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},S.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},S.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},r.fromBytes=function(e,t,n){return n?r.fromBytesLE(e,t):r.fromBytesBE(e,t)},r.fromBytesLE=function(e,t){return new r(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},r.fromBytesBE=function(e,t){return new r(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)}})),B=M((function(){})),W=M((function(){})),U=M((function(e,t){!function(e,t,n){function r(e){var t=this,n=function(){var e=4022871197;return function(t){t=String(t);for(var n=0;n<t.length;n++){var r=.02519603282416938*(e+=t.charCodeAt(n));r-=e=r>>>0,e=(r*=e)>>>0,e+=4294967296*(r-=e)}return 2.3283064365386963e-10*(e>>>0)}}();t.next=function(){var e=2091639*t.s0+2.3283064365386963e-10*t.c;return t.s0=t.s1,t.s1=t.s2,t.s2=e-(t.c=0|e)},t.c=1,t.s0=n(" "),t.s1=n(" "),t.s2=n(" "),t.s0-=n(e),t.s0<0&&(t.s0+=1),t.s1-=n(e),t.s1<0&&(t.s1+=1),t.s2-=n(e),t.s2<0&&(t.s2+=1),n=null}function a(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function i(e,t){var n=new r(e),i=t&&t.state,o=n.next;return o.int32=function(){return 4294967296*n.next()|0},o.double=function(){return o()+11102230246251565e-32*(2097152*o()|0)},o.quick=o,i&&("object"==typeof i&&a(i,n),o.state=function(){return a(n,{})}),o}t&&t.exports?t.exports=i:n&&n.amd?n((function(){return i})):this.alea=i}(0,"object"==typeof t&&t,"function"==typeof define&&define)})),V=M((function(e,t){!function(e,t,n){function r(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function a(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function i(e,t){var n=new r(e),i=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,i&&("object"==typeof i&&a(i,n),o.state=function(){return a(n,{})}),o}t&&t.exports?t.exports=i:n&&n.amd?n((function(){return i})):this.xor128=i}(0,"object"==typeof t&&t,"function"==typeof define&&define)})),G=M((function(e,t){!function(e,t,n){function r(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function a(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function i(e,t){var n=new r(e),i=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,i&&("object"==typeof i&&a(i,n),o.state=function(){return a(n,{})}),o}t&&t.exports?t.exports=i:n&&n.amd?n((function(){return i})):this.xorwow=i}(0,"object"==typeof t&&t,"function"==typeof define&&define)})),H=M((function(e,t){!function(e,t,n){function r(e){var t=this;t.next=function(){var e,n,r=t.x,a=t.i;return e=r[a],n=(e^=e>>>7)^e<<24,n^=(e=r[a+1&7])^e>>>10,n^=(e=r[a+3&7])^e>>>3,n^=(e=r[a+4&7])^e<<7,e=r[a+7&7],n^=(e^=e<<13)^e<<9,r[a]=n,t.i=a+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function a(e,t){return t.x=e.x.slice(),t.i=e.i,t}function i(e,t){null==e&&(e=+new Date);var n=new r(e),i=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,i&&(i.x&&a(i,n),o.state=function(){return a(n,{})}),o}t&&t.exports?t.exports=i:n&&n.amd?n((function(){return i})):this.xorshift7=i}(0,"object"==typeof t&&t,"function"==typeof define&&define)})),q=M((function(e,t){!function(e,t,n){function r(e){var t=this;t.next=function(){var e,n,r=t.w,a=t.X,i=t.i;return t.w=r=r+1640531527|0,n=a[i+34&127],e=a[i=i+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=a[i]=n^e,t.i=i,n+(r^r>>>16)|0},function(e,t){var n,r,a,i,o,s=[],u=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,u=Math.max(u,t.length)),a=0,i=-32;i<u;++i)t&&(r^=t.charCodeAt((i+32)%t.length)),0===i&&(o=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,i>=0&&(o=o+1640531527|0,a=0==(n=s[127&i]^=r+o)?a+1:0);for(a>=128&&(s[127&(t&&t.length||0)]=-1),a=127,i=512;i>0;--i)r=s[a+34&127],n=s[a=a+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,s[a]=r^n;e.w=o,e.X=s,e.i=a}(t,e)}function a(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function i(e,t){null==e&&(e=+new Date);var n=new r(e),i=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,i&&(i.X&&a(i,n),o.state=function(){return a(n,{})}),o}t&&t.exports?t.exports=i:n&&n.amd?n((function(){return i})):this.xor4096=i}(0,"object"==typeof t&&t,"function"==typeof define&&define)})),K=M((function(e,t){!function(e,t,n){function r(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,a=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^a,a=a-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^a,t.a=a-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function a(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function i(e,t){var n=new r(e),i=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,i&&("object"==typeof i&&a(i,n),o.state=function(){return a(n,{})}),o}t&&t.exports?t.exports=i:n&&n.amd?n((function(){return i})):this.tychei=i}(0,"object"==typeof t&&t,"function"==typeof define&&define)})),X=M((function(){})),Y=M((function(e,t){!function(e,r,a){var i,o=256,s="random",u=a.pow(o,6),c=a.pow(2,52),l=2*c,d=255;function p(t,n,d){var p=[],b=m(function e(t,n){var r,a=[],i=typeof t;if(n&&"object"==i)for(r in t)try{a.push(e(t[r],n-1))}catch(g){}return a.length?a:"string"==i?t:t+"\0"}((n=1==n?{entropy:!0}:n||{}).entropy?[t,v(r)]:null==t?function(){try{var t;return i&&(t=i.randomBytes)?t=t(o):(t=new Uint8Array(o),(e.crypto||e.msCrypto).getRandomValues(t)),v(t)}catch(p){var n=e.navigator,a=n&&n.plugins;return[+new Date,e,a,e.screen,v(r)]}}():t,3),p),g=new f(p),y=function(){for(var e=g.g(6),t=u,n=0;e<c;)e=(e+n)*o,t*=o,n=g.g(1);for(;e>=l;)e/=2,t/=2,n>>>=1;return(e+n)/t};return y.int32=function(){return 0|g.g(4)},y.quick=function(){return g.g(4)/4294967296},y.double=y,m(v(g.S),r),(n.pass||d||function(e,t,n,r){return r&&(r.S&&h(r,g),e.state=function(){return h(g,{})}),n?(a[s]=e,t):e})(y,b,"global"in n?n.global:this==a,n.state)}function f(e){var t,n=e.length,r=this,a=0,i=r.i=r.j=0,s=r.S=[];for(n||(e=[n++]);a<o;)s[a]=a++;for(a=0;a<o;a++)s[a]=s[i=d&i+e[a%n]+(t=s[a])],s[i]=t;(r.g=function(e){for(var t,n=0,a=r.i,i=r.j,s=r.S;e--;)t=s[a=d&a+1],n=n*o+s[d&(s[a]=s[i=d&i+t])+(s[i]=t)];return r.i=a,r.j=i,n})(o)}function h(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function m(e,t){for(var n,r=e+"",a=0;a<r.length;)t[d&a]=d&(n^=19*t[d&a])+r.charCodeAt(a++);return v(t)}function v(e){return String.fromCharCode.apply(0,e)}if(m(a.random(),r),"object"==typeof t&&t.exports){t.exports=p;try{i=X()}catch(b){}}else"function"==typeof define&&n(48)?define((function(){return p})):a.seedrandom=p}("undefined"!=typeof self?self:e,[],Math)})),Z=M((function(e,t){var n=U(),r=V(),a=G(),i=H(),o=q(),s=K(),u=Y();u.alea=n,u.xor128=r,u.xorwow=a,u.xorshift7=i,u.xor4096=o,u.tychei=s,t.exports=u})),J=M((function(){})),Q=M((function(){})),$=M((function(){})),ee=M((function(){})),te=M((function(){})),ne=M((function(){})),re=M((function(t,o){var s=function(){var t="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0;return t=t||e,function(e){function n(){return M.buffer!=B&&Y(M.buffer),U}function o(){return M.buffer!=B&&Y(M.buffer),V}function s(){return M.buffer!=B&&Y(M.buffer),G}function u(){return M.buffer!=B&&Y(M.buffer),H}var c,l,d,p="undefined"!=typeof(e=e||{})?e:{};p.ready=new Promise((function(e,t){c=e,l=t})),"undefined"!=typeof r&&r.listeners&&(d={uncaughtException:r.listeners("uncaughtException"),unhandledRejection:r.listeners("unhandledRejection")});var f,h,m,v=Object.assign({},p),b=[],g=function(e,t){throw t},y="object"==typeof window,x="function"==typeof importScripts,k="object"==typeof r&&"object"==typeof r.versions&&"string"==typeof r.versions.node,w=p.ENVIRONMENT_IS_PTHREAD||!1,O="";function I(e){return p.locateFile?p.locateFile(e,O):O+e}if(k){var j,T=Q(),C=$();O=x?C.dirname(O)+"/":a+"/",f=function(e,t){return e=ve(e)?new URL(e):C.normalize(e),T.readFileSync(e,t?void 0:"utf8")},m=function(e){var t=f(e,!0);return t.buffer||(t=new Uint8Array(t)),t},h=function(e,t,n){e=ve(e)?new URL(e):C.normalize(e),T.readFile(e,(function(e,r){e?n(e):t(r.buffer)}))},r.argv.length>1&&r.argv[1].replace(/\\/g,"/"),b=r.argv.slice(2),r.on("uncaughtException",(function(e){if(!(e instanceof ye))throw e})),r.on("unhandledRejection",(function(e){throw e})),g=function(e,t){if(oe())throw r.exitCode=e,t;(function(e){e instanceof ye||R("exiting due to exception: "+e)})(t),r.exit(e)},p.inspect=function(){return"[Emscripten Module object]"};try{j=ee()}catch(st){throw console.error('The "worker_threads" module is not supported in this node.js build - perhaps a newer version is needed?'),st}i.Worker=j.Worker}else(y||x)&&(x?O=self.location.href:"undefined"!=typeof document&&document.currentScript&&(O=document.currentScript.src),"undefined"!=typeof t&&t&&(O=t),O=0!==O.indexOf("blob:")?O.substr(0,O.replace(/[?#].*/,"").lastIndexOf("/")+1):"",k||(f=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},x&&(m=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),h=function(e,t,n){var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer",r.onload=function(){200==r.status||0==r.status&&r.response?t(r.response):n()},r.onerror=n,r.send(null)}),function(e){return document.title=e});k&&"undefined"==typeof performance&&(i.performance=te().performance);var E=console.log.bind(console),_=console.warn.bind(console);k&&(E=function(e){return T.writeSync(1,e+"\n")},_=function(e){return T.writeSync(2,e+"\n")});var A=p.print||E,R=p.printErr||_;Object.assign(p,v),v=null,p.arguments&&(b=p.arguments),p.thisProgram&&p.thisProgram,p.quit&&(g=p.quit);var D;Atomics.load,Atomics.store,Atomics.compareExchange;p.wasmBinary&&(D=p.wasmBinary);var F=p.noExitRuntime||!0;"object"!=typeof WebAssembly&&fe("no native wasm support detected");var M,z,L,P=!1;var B,W,U,V,G,H,q="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function K(e,t,n){for(var r=(t>>>=0)+n,a=t;e[a]&&!(a>=r);)++a;if(a-t>16&&e.buffer&&q)return q.decode(e.buffer instanceof SharedArrayBuffer?e.slice(t,a):e.subarray(t,a));for(var i="";t<a;){var o=e[t++];if(128&o){var s=63&e[t++];if(192!=(224&o)){var u=63&e[t++];if((o=224==(240&o)?(15&o)<<12|s<<6|u:(7&o)<<18|s<<12|u<<6|63&e[t++])<65536)i+=String.fromCharCode(o);else{var c=o-65536;i+=String.fromCharCode(55296|c>>10,56320|1023&c)}}else i+=String.fromCharCode((31&o)<<6|s)}else i+=String.fromCharCode(o)}return i}function X(e,t){return(e>>>=0)?K(n(),e,t):""}function Y(e){B=e,p.HEAP8=W=new Int8Array(e),p.HEAP16=new Int16Array(e),p.HEAP32=V=new Int32Array(e),p.HEAPU8=U=new Uint8Array(e),p.HEAPU16=new Uint16Array(e),p.HEAPU32=G=new Uint32Array(e),p.HEAPF32=new Float32Array(e),p.HEAPF64=H=new Float64Array(e)}w&&(B=p.buffer);var Z=p.INITIAL_MEMORY||16777216;if(w)M=p.wasmMemory,B=p.buffer;else if(p.wasmMemory)M=p.wasmMemory;else if(!((M=new WebAssembly.Memory({initial:Z/65536,maximum:65536,shared:!0})).buffer instanceof SharedArrayBuffer))throw R("requested a shared WebAssembly.Memory but the returned buffer is not a SharedArrayBuffer, indicating that while the browser has SharedArrayBuffer it does not have WebAssembly threads support - you may need to set a flag"),k&&R("(on node you may need: --experimental-wasm-threads --experimental-wasm-bulk-memory and/or recent version)"),Error("bad memory");M&&(B=M.buffer),Z=B.byteLength,Y(B);var J,re=[],ae=[],ie=[];function oe(){return F}function se(){!0,!w&&Se(ae)}function ue(e){re.unshift(e)}function ce(e){ie.unshift(e)}var le=0,de=null,pe=null;function fe(e){p.onAbort&&p.onAbort(e),R(e="Aborted("+e+")"),P=!0,L=1,e+=". Build with -sASSERTIONS for more info.";var t=new WebAssembly.RuntimeError(e);throw l(t),t}var he;function me(e){return e.startsWith("data:application/octet-stream;base64,")}function ve(e){return e.startsWith("file://")}function be(e){try{if(e==he&&D)return new Uint8Array(D);if(m)return m(e);throw"both async and sync fetching of the wasm failed"}catch(st){fe(st)}}me(he="tfjs-backend-wasm-threaded-simd.wasm")||(he=I(he));var ge={};function ye(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function xe(e){var t=Ie.pthreads[e];(function(e,t){e||fe(t)})(t),Ie.returnWorkerToPool(t)}function ke(e){var t=Ie.getNewWorker();if(!t)return 6;Ie.runningWorkers.push(t),Ie.pthreads[e.pthread_ptr]=t,t.pthread_ptr=e.pthread_ptr;var n={cmd:"run",start_routine:e.startRoutine,arg:e.arg,pthread_ptr:e.pthread_ptr};return t.runPthread=function(){k&&t.ref(),t.postMessage(n,e.transferList),delete t.runPthread},t.loaded&&t.runPthread(),0}function we(e){if(w)return Re(1,1,e);L=e,oe()||(Ie.terminateAllThreads(),p.onExit&&p.onExit(e),P=!0),g(e,new ye(e))}var Oe=function(e,t){if(L=e,!t&&w)throw Ne(e),"unwind";we(e)};var Ie={unusedWorkers:[],runningWorkers:[],tlsInitFunctions:[],pthreads:{},init:function(){w?Ie.initWorker():Ie.initMainThread()},initMainThread:function(){for(var e=8;e--;)Ie.allocateUnusedWorker()},initWorker:function(){F=!1},setExitStatus:function(e){L=e},terminateAllThreads:function(){for(var e=0,t=Object.values(Ie.pthreads);e<t.length;e++){var n=t[e];Ie.returnWorkerToPool(n)}var r,a=Object(N.a)(Ie.unusedWorkers);try{for(a.s();!(r=a.n()).done;){(n=r.value).terminate()}}catch(i){a.e(i)}finally{a.f()}Ie.unusedWorkers=[]},returnWorkerToPool:function(e){var t=e.pthread_ptr;delete Ie.pthreads[t],Ie.unusedWorkers.push(e),Ie.runningWorkers.splice(Ie.runningWorkers.indexOf(e),1),e.pthread_ptr=0,k&&e.unref(),$e(t)},receiveObjectTransfer:function(e){},threadInitTLS:function(){Ie.tlsInitFunctions.forEach((function(e){return e()}))},loadWasmModuleToWorker:function(e,n){e.onmessage=function(t){var r=t.data,a=r.cmd;if(e.pthread_ptr&&(Ie.currentProxiedOperationCallerThread=e.pthread_ptr),r.targetThread&&r.targetThread!=Ye()){var i=Ie.pthreads[r.targetThread];return i?i.postMessage(r,r.transferList):R('Internal error! Worker sent a message "'+a+'" to target pthread '+r.targetThread+", but that thread no longer exists!"),void(Ie.currentProxiedOperationCallerThread=void 0)}"processProxyingQueue"===a?_e(r.queue):"spawnThread"===a?ke(r):"cleanupThread"===a?xe(r.thread):"killThread"===a?function(e){var t=Ie.pthreads[e];delete Ie.pthreads[e],t.terminate(),$e(e),Ie.runningWorkers.splice(Ie.runningWorkers.indexOf(t),1),t.pthread_ptr=0}(r.thread):"cancelThread"===a?function(e){Ie.pthreads[e].postMessage({cmd:"cancel"})}(r.thread):"loaded"===a?(e.loaded=!0,k&&e.unref(),n&&n(e),e.runPthread&&e.runPthread()):"print"===a?A("Thread "+r.threadId+": "+r.text):"printErr"===a?R("Thread "+r.threadId+": "+r.text):"alert"===a?alert("Thread "+r.threadId+": "+r.text):"setimmediate"===r.target?e.postMessage(r):"callHandler"===a?p[r.handler].apply(p,Object(S.a)(r.args)):a&&R("worker sent an unknown command "+a),Ie.currentProxiedOperationCallerThread=void 0},e.onerror=function(e){throw R("worker sent an error! "+e.filename+":"+e.lineno+": "+e.message),e},k&&(e.on("message",(function(t){e.onmessage({data:t})})),e.on("error",(function(t){e.onerror(t)})),e.on("detachedExit",(function(){})));for(var r=[],a=0,i=["onExit","onAbort","print","printErr"];a<i.length;a++){var o=i[a];p.hasOwnProperty(o)&&r.push(o)}e.postMessage({cmd:"load",handlers:r,urlOrBlob:p.mainScriptUrlOrBlob||t,wasmMemory:M,wasmModule:z})},allocateUnusedWorker:function(){var e,t=I("tfjs-backend-wasm-threaded-simd.worker.js");e=new Worker(t),Ie.unusedWorkers.push(e)},getNewWorker:function(){return 0==Ie.unusedWorkers.length&&(Ie.allocateUnusedWorker(),Ie.loadWasmModuleToWorker(Ie.unusedWorkers[0])),Ie.unusedWorkers.pop()}};function Se(e){for(;e.length>0;)e.shift()(p)}function Ne(e){if(w)return Re(2,0,e);try{Oe(e)}catch(st){!function(e){if(e instanceof ye||"unwind"==e)return L;g(1,e)}(st)}}p.PThread=Ie,p.establishStackSpace=function(){var e=Ye(),t=o()[e+52>>>2],n=o()[e+56>>>2];tt(t,t-n),rt(t)};var je=[];function Te(e,t,n,r){return w?Re(3,1,e,t,n,r):Ce(e,t,n,r)}function Ce(e,t,n,r){if("undefined"==typeof SharedArrayBuffer)return R("Current environment does not support SharedArrayBuffer, pthreads are not available!"),6;var a=[];if(w&&0===a.length)return Te(e,t,n,r);var i={startRoutine:n,pthread_ptr:e,arg:r,transferList:a};return w?(i.cmd="spawnThread",postMessage(i,a),0):ke(i)}p.invokeEntryPoint=function(e,t){var n=function(e){var t=je[e];return t||(e>=je.length&&(je.length=e+1),je[e]=t=J.get(e)),t}(e)(t);oe()?Ie.setExitStatus(n):et(n)};var Ee;function _e(e){Atomics.store(o(),e>>2,1),Ye()&&Qe(e),Atomics.compareExchange(o(),e>>2,1,0)}function Ae(e){var t=nt(),n=e();return rt(t),n}function Re(e,t){var n=arguments.length-2,r=arguments;return Ae((function(){for(var a=n,i=at(8*a),o=i>>3,s=0;s<n;s++){var c=r[2+s];u()[o+s>>>0]=c}return Je(e,a,i,t)}))}p.executeNotifiedProxyingQueue=_e,Ee=k?function(){var e=r.hrtime();return 1e3*e[0]+e[1]/1e6}:function(){return performance.timeOrigin+performance.now()};var De=[];function Fe(e){try{return M.grow(e-B.byteLength+65535>>>16),Y(M.buffer),1}catch(st){}}function Me(e){return w?Re(4,1,e):52}function ze(e,t,n,r,a){return w?Re(5,1,e,t,n,r,a):70}var Le=[null,[],[]];function Pe(e,t){var n=Le[e];0===t||10===t?((1===e?A:R)(K(n,0)),n.length=0):n.push(t)}function Be(e,t,r,a){if(w)return Re(6,1,e,t,r,a);for(var i=0,o=0;o<r;o++){var u=s()[t>>>2],c=s()[t+4>>>2];t+=8;for(var l=0;l<c;l++)Pe(e,n()[u+l>>>0]);i+=c}return s()[a>>>2]=i,0}function We(e){return p["_"+e]}function Ue(e,t){(M.buffer!=B&&Y(M.buffer),W).set(e,t>>>0)}function Ve(e,t,r,a,i){var o={string:function(e){var t=0;if(null!=e&&0!==e){var r=1+(e.length<<2);(function(e,t,r){(function(e,t,n,r){if(!(r>0))return 0;for(var a=n>>>=0,i=n+r-1,o=0;o<e.length;++o){var s=e.charCodeAt(o);if(s>=55296&&s<=57343)s=65536+((1023&s)<<10)|1023&e.charCodeAt(++o);if(s<=127){if(n>=i)break;t[n++>>>0]=s}else if(s<=2047){if(n+1>=i)break;t[n++>>>0]=192|s>>6,t[n++>>>0]=128|63&s}else if(s<=65535){if(n+2>=i)break;t[n++>>>0]=224|s>>12,t[n++>>>0]=128|s>>6&63,t[n++>>>0]=128|63&s}else{if(n+3>=i)break;t[n++>>>0]=240|s>>18,t[n++>>>0]=128|s>>12&63,t[n++>>>0]=128|s>>6&63,t[n++>>>0]=128|63&s}}t[n>>>0]=0})(e,n(),t,r)})(e,t=at(r),r)}return t},array:function(e){var t=at(e.length);return Ue(e,t),t}};var s=We(e),u=[],c=0;if(a)for(var l=0;l<a.length;l++){var d=o[r[l]];d?(0===c&&(c=nt()),u[l]=d(a[l])):u[l]=a[l]}var p,f=s.apply(null,u);return p=f,0!==c&&rt(c),f=function(e){return"string"===t?X(e):"boolean"===t?!!e:e}(p)}Ie.init();var Ge,He,qe,Ke=[null,we,Ne,Te,Me,ze,Be],Xe={__emscripten_init_main_thread_js:function(e){Ze(e,!x,1,!y),Ie.threadInitTLS()},__emscripten_thread_cleanup:function(e){w?postMessage({cmd:"cleanupThread",thread:e}):xe(e)},__pthread_create_js:Ce,_emscripten_default_pthread_stack_size:function(){return 65536},_emscripten_get_now_is_monotonic:function(){return!0},_emscripten_notify_task_queue:function(e,t,n,r){if(e==t)setTimeout((function(){return _e(r)}));else if(w)postMessage({targetThread:e,cmd:"processProxyingQueue",queue:r});else{var a=Ie.pthreads[e];if(!a)return;a.postMessage({cmd:"processProxyingQueue",queue:r})}return 1},_emscripten_set_offscreencanvas_size:function(e,t,n){return-1},abort:function(){fe("")},emscripten_check_blocking_allowed:function(){k||x||function e(t){e.shown||(e.shown={}),e.shown[t]||(e.shown[t]=1,k&&(t="warning: "+t),R(t))}("Blocking on the main thread is very dangerous, see https://emscripten.org/docs/porting/pthreads.html#blocking-on-the-main-browser-thread")},emscripten_date_now:function(){return Date.now()},emscripten_get_heap_max:function(){return 4294901760},emscripten_get_now:Ee,emscripten_memcpy_big:function(e,t,r){n().copyWithin(e>>>0,t>>>0,t+r>>>0)},emscripten_num_logical_cores:function(){return k?ne().cpus().length:navigator.hardwareConcurrency},emscripten_receive_on_main_thread_js:function(e,t,n){De.length=t;for(var r=n>>3,a=0;a<t;a++)De[a]=u()[r+a>>>0];return(e<0?ge[-e-1]:Ke[e]).apply(null,De)},emscripten_resize_heap:function(e){var t=n().length;if((e>>>=0)<=t)return!1;var r=4294901760;if(e>r)return!1;for(var a,i,o=1;o<=4;o*=2){var s=t*(1+.2/o);if(s=Math.min(s,e+100663296),Fe(Math.min(r,(a=Math.max(e,s))+((i=65536)-a%i)%i)))return!0}return!1},emscripten_unwind_to_js_event_loop:function(){throw"unwind"},exit:Oe,fd_close:Me,fd_seek:ze,fd_write:Be,memory:M||p.wasmMemory},Ye=(function(){var e={env:Xe,wasi_snapshot_preview1:Xe};function t(e,t){var n=e.exports;if(p.asm=n,function(e){Ie.tlsInitFunctions.push(e)}(p.asm._emscripten_tls_init),J=p.asm.__indirect_function_table,function(e){ae.unshift(e)}(p.asm.__wasm_call_ctors),z=t,!w){var r=Ie.unusedWorkers.length;Ie.unusedWorkers.forEach((function(e){Ie.loadWasmModuleToWorker(e,(function(){--r||function(e){if(le--,p.monitorRunDependencies&&p.monitorRunDependencies(le),0==le&&(null!==de&&(clearInterval(de),de=null),pe)){var t=pe;pe=null,t()}}()}))}))}}function n(e){t(e.instance,e.module)}function r(t){return function(){if(!D&&(y||x)){if("function"==typeof fetch&&!ve(he))return fetch(he,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+he+"'";return e.arrayBuffer()})).catch((function(){return be(he)}));if(h)return new Promise((function(e,t){h(he,(function(t){e(new Uint8Array(t))}),t)}))}return Promise.resolve().then((function(){return be(he)}))}().then((function(t){return WebAssembly.instantiate(t,e)})).then((function(e){return e})).then(t,(function(e){R("failed to asynchronously prepare wasm: "+e),fe(e)}))}if(w||(le++,p.monitorRunDependencies&&p.monitorRunDependencies(le)),p.instantiateWasm)try{return p.instantiateWasm(e,t)}catch(a){R("Module.instantiateWasm callback failed with error: "+a),l(a)}(D||"function"!=typeof WebAssembly.instantiateStreaming||me(he)||ve(he)||k||"function"!=typeof fetch?r(n):fetch(he,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(n,(function(e){return R("wasm streaming compile failed: "+e),R("falling back to ArrayBuffer instantiation"),r(n)}))}))).catch(l)}(),p.___wasm_call_ctors=function(){return(p.___wasm_call_ctors=p.asm.__wasm_call_ctors).apply(null,arguments)},p._init=function(){return(p._init=p.asm.init).apply(null,arguments)},p._init_with_threads_count=function(){return(p._init_with_threads_count=p.asm.init_with_threads_count).apply(null,arguments)},p._get_threads_count=function(){return(p._get_threads_count=p.asm.get_threads_count).apply(null,arguments)},p._register_tensor=function(){return(p._register_tensor=p.asm.register_tensor).apply(null,arguments)},p._dispose_data=function(){return(p._dispose_data=p.asm.dispose_data).apply(null,arguments)},p._dispose=function(){return(p._dispose=p.asm.dispose).apply(null,arguments)},p._Abs=function(){return(p._Abs=p.asm.Abs).apply(null,arguments)},p._Acos=function(){return(p._Acos=p.asm.Acos).apply(null,arguments)},p._Acosh=function(){return(p._Acosh=p.asm.Acosh).apply(null,arguments)},p._Add=function(){return(p._Add=p.asm.Add).apply(null,arguments)},p._AddN=function(){return(p._AddN=p.asm.AddN).apply(null,arguments)},p._All=function(){return(p._All=p.asm.All).apply(null,arguments)},p._Any=function(){return(p._Any=p.asm.Any).apply(null,arguments)},p._ArgMax=function(){return(p._ArgMax=p.asm.ArgMax).apply(null,arguments)},p._ArgMin=function(){return(p._ArgMin=p.asm.ArgMin).apply(null,arguments)},p._Asin=function(){return(p._Asin=p.asm.Asin).apply(null,arguments)},p._Asinh=function(){return(p._Asinh=p.asm.Asinh).apply(null,arguments)},p._Atan=function(){return(p._Atan=p.asm.Atan).apply(null,arguments)},p._Atan2=function(){return(p._Atan2=p.asm.Atan2).apply(null,arguments)},p._Atanh=function(){return(p._Atanh=p.asm.Atanh).apply(null,arguments)},p._AvgPool=function(){return(p._AvgPool=p.asm.AvgPool).apply(null,arguments)},p._AvgPool3D=function(){return(p._AvgPool3D=p.asm.AvgPool3D).apply(null,arguments)},p._AvgPool3DGrad=function(){return(p._AvgPool3DGrad=p.asm.AvgPool3DGrad).apply(null,arguments)},p._AvgPoolGrad=function(){return(p._AvgPoolGrad=p.asm.AvgPoolGrad).apply(null,arguments)},p._BatchMatMul=function(){return(p._BatchMatMul=p.asm.BatchMatMul).apply(null,arguments)},p._Bincount=function(){return(p._Bincount=p.asm.Bincount).apply(null,arguments)},p._BitwiseAnd=function(){return(p._BitwiseAnd=p.asm.BitwiseAnd).apply(null,arguments)},p._Ceil=function(){return(p._Ceil=p.asm.Ceil).apply(null,arguments)},p._ClipByValue=function(){return(p._ClipByValue=p.asm.ClipByValue).apply(null,arguments)},p._Conv2D=function(){return(p._Conv2D=p.asm.Conv2D).apply(null,arguments)},p._Conv2DBackpropInput=function(){return(p._Conv2DBackpropInput=p.asm.Conv2DBackpropInput).apply(null,arguments)},p._Conv3D=function(){return(p._Conv3D=p.asm.Conv3D).apply(null,arguments)},p._Conv3DBackpropFilterV2=function(){return(p._Conv3DBackpropFilterV2=p.asm.Conv3DBackpropFilterV2).apply(null,arguments)},p._Conv3DBackpropInputV2=function(){return(p._Conv3DBackpropInputV2=p.asm.Conv3DBackpropInputV2).apply(null,arguments)},p._Cos=function(){return(p._Cos=p.asm.Cos).apply(null,arguments)},p._Cosh=function(){return(p._Cosh=p.asm.Cosh).apply(null,arguments)},p._CropAndResize=function(){return(p._CropAndResize=p.asm.CropAndResize).apply(null,arguments)},p._Cumprod=function(){return(p._Cumprod=p.asm.Cumprod).apply(null,arguments)},p._Cumsum=function(){return(p._Cumsum=p.asm.Cumsum).apply(null,arguments)},p._DenseBincount=function(){return(p._DenseBincount=p.asm.DenseBincount).apply(null,arguments)},p._DepthToSpace=function(){return(p._DepthToSpace=p.asm.DepthToSpace).apply(null,arguments)},p._DepthwiseConv2dNative=function(){return(p._DepthwiseConv2dNative=p.asm.DepthwiseConv2dNative).apply(null,arguments)},p._Diag=function(){return(p._Diag=p.asm.Diag).apply(null,arguments)},p._Dilation2D=function(){return(p._Dilation2D=p.asm.Dilation2D).apply(null,arguments)},p._Dilation2DBackpropFilter=function(){return(p._Dilation2DBackpropFilter=p.asm.Dilation2DBackpropFilter).apply(null,arguments)},p._Dilation2DBackpropInput=function(){return(p._Dilation2DBackpropInput=p.asm.Dilation2DBackpropInput).apply(null,arguments)},p._Elu=function(){return(p._Elu=p.asm.Elu).apply(null,arguments)},p._EluGrad=function(){return(p._EluGrad=p.asm.EluGrad).apply(null,arguments)},p._Equal=function(){return(p._Equal=p.asm.Equal).apply(null,arguments)},p._Erf=function(){return(p._Erf=p.asm.Erf).apply(null,arguments)},p._Exp=function(){return(p._Exp=p.asm.Exp).apply(null,arguments)},p._Expm1=function(){return(p._Expm1=p.asm.Expm1).apply(null,arguments)},p._FlipLeftRight=function(){return(p._FlipLeftRight=p.asm.FlipLeftRight).apply(null,arguments)},p._Floor=function(){return(p._Floor=p.asm.Floor).apply(null,arguments)},p._FloorDiv=function(){return(p._FloorDiv=p.asm.FloorDiv).apply(null,arguments)},p._FusedBatchNorm=function(){return(p._FusedBatchNorm=p.asm.FusedBatchNorm).apply(null,arguments)},p._FusedConv2D=function(){return(p._FusedConv2D=p.asm.FusedConv2D).apply(null,arguments)},p._FusedDepthwiseConv2D=function(){return(p._FusedDepthwiseConv2D=p.asm.FusedDepthwiseConv2D).apply(null,arguments)},p._Gather=function(){return(p._Gather=p.asm.Gather).apply(null,arguments)},p._GatherNd=function(){return(p._GatherNd=p.asm.GatherNd).apply(null,arguments)},p._Greater=function(){return(p._Greater=p.asm.Greater).apply(null,arguments)},p._GreaterEqual=function(){return(p._GreaterEqual=p.asm.GreaterEqual).apply(null,arguments)},p._IsFinite=function(){return(p._IsFinite=p.asm.IsFinite).apply(null,arguments)},p._IsInf=function(){return(p._IsInf=p.asm.IsInf).apply(null,arguments)},p._IsNan=function(){return(p._IsNan=p.asm.IsNan).apply(null,arguments)},p._LRN=function(){return(p._LRN=p.asm.LRN).apply(null,arguments)},p._LRNGrad=function(){return(p._LRNGrad=p.asm.LRNGrad).apply(null,arguments)},p._LeakyRelu=function(){return(p._LeakyRelu=p.asm.LeakyRelu).apply(null,arguments)},p._Less=function(){return(p._Less=p.asm.Less).apply(null,arguments)},p._LessEqual=function(){return(p._LessEqual=p.asm.LessEqual).apply(null,arguments)},p._LinSpace=function(){return(p._LinSpace=p.asm.LinSpace).apply(null,arguments)},p._Log=function(){return(p._Log=p.asm.Log).apply(null,arguments)},p._Log1p=function(){return(p._Log1p=p.asm.Log1p).apply(null,arguments)},p._LogicalAnd=function(){return(p._LogicalAnd=p.asm.LogicalAnd).apply(null,arguments)},p._LogicalNot=function(){return(p._LogicalNot=p.asm.LogicalNot).apply(null,arguments)},p._LogicalOr=function(){return(p._LogicalOr=p.asm.LogicalOr).apply(null,arguments)},p._LogicalXor=function(){return(p._LogicalXor=p.asm.LogicalXor).apply(null,arguments)},p._Max=function(){return(p._Max=p.asm.Max).apply(null,arguments)},p._MaxPool=function(){return(p._MaxPool=p.asm.MaxPool).apply(null,arguments)},p._MaxPool3D=function(){return(p._MaxPool3D=p.asm.MaxPool3D).apply(null,arguments)},p._MaxPool3DGrad=function(){return(p._MaxPool3DGrad=p.asm.MaxPool3DGrad).apply(null,arguments)},p._MaxPoolGrad=function(){return(p._MaxPoolGrad=p.asm.MaxPoolGrad).apply(null,arguments)},p._MaxPoolWithArgmax=function(){return(p._MaxPoolWithArgmax=p.asm.MaxPoolWithArgmax).apply(null,arguments)},p._Maximum=function(){return(p._Maximum=p.asm.Maximum).apply(null,arguments)},p._Mean=function(){return(p._Mean=p.asm.Mean).apply(null,arguments)},p._Min=function(){return(p._Min=p.asm.Min).apply(null,arguments)},p._Minimum=function(){return(p._Minimum=p.asm.Minimum).apply(null,arguments)},p._MirrorPad=function(){return(p._MirrorPad=p.asm.MirrorPad).apply(null,arguments)},p._Mod=function(){return(p._Mod=p.asm.Mod).apply(null,arguments)},p._Multinomial=function(){return(p._Multinomial=p.asm.Multinomial).apply(null,arguments)},p._Multiply=function(){return(p._Multiply=p.asm.Multiply).apply(null,arguments)},p._Neg=function(){return(p._Neg=p.asm.Neg).apply(null,arguments)},p._NonMaxSuppressionV3=function(){return(p._NonMaxSuppressionV3=p.asm.NonMaxSuppressionV3).apply(null,arguments)},p._NonMaxSuppressionV4=function(){return(p._NonMaxSuppressionV4=p.asm.NonMaxSuppressionV4).apply(null,arguments)},p._NonMaxSuppressionV5=function(){return(p._NonMaxSuppressionV5=p.asm.NonMaxSuppressionV5).apply(null,arguments)},p._NotEqual=function(){return(p._NotEqual=p.asm.NotEqual).apply(null,arguments)},p._OneHot=function(){return(p._OneHot=p.asm.OneHot).apply(null,arguments)},p._PadV2=function(){return(p._PadV2=p.asm.PadV2).apply(null,arguments)},p._Pow=function(){return(p._Pow=p.asm.Pow).apply(null,arguments)},p._Prelu=function(){return(p._Prelu=p.asm.Prelu).apply(null,arguments)},p._Prod=function(){return(p._Prod=p.asm.Prod).apply(null,arguments)},p._RealDiv=function(){return(p._RealDiv=p.asm.RealDiv).apply(null,arguments)},p._Reciprocal=function(){return(p._Reciprocal=p.asm.Reciprocal).apply(null,arguments)},p._Relu=function(){return(p._Relu=p.asm.Relu).apply(null,arguments)},p._Relu6=function(){return(p._Relu6=p.asm.Relu6).apply(null,arguments)},p._ResizeBilinear=function(){return(p._ResizeBilinear=p.asm.ResizeBilinear).apply(null,arguments)},p._ResizeBilinearGrad=function(){return(p._ResizeBilinearGrad=p.asm.ResizeBilinearGrad).apply(null,arguments)},p._ResizeNearestNeighbor=function(){return(p._ResizeNearestNeighbor=p.asm.ResizeNearestNeighbor).apply(null,arguments)},p._ResizeNearestNeighborGrad=function(){return(p._ResizeNearestNeighborGrad=p.asm.ResizeNearestNeighborGrad).apply(null,arguments)},p._Reverse=function(){return(p._Reverse=p.asm.Reverse).apply(null,arguments)},p._RotateWithOffset=function(){return(p._RotateWithOffset=p.asm.RotateWithOffset).apply(null,arguments)},p._Round=function(){return(p._Round=p.asm.Round).apply(null,arguments)},p._Rsqrt=function(){return(p._Rsqrt=p.asm.Rsqrt).apply(null,arguments)},p._ScatterNd=function(){return(p._ScatterNd=p.asm.ScatterNd).apply(null,arguments)},p._SearchSorted=function(){return(p._SearchSorted=p.asm.SearchSorted).apply(null,arguments)},p._SelectV2=function(){return(p._SelectV2=p.asm.SelectV2).apply(null,arguments)},p._Selu=function(){return(p._Selu=p.asm.Selu).apply(null,arguments)},p._Sigmoid=function(){return(p._Sigmoid=p.asm.Sigmoid).apply(null,arguments)},p._Sign=function(){return(p._Sign=p.asm.Sign).apply(null,arguments)},p._Sin=function(){return(p._Sin=p.asm.Sin).apply(null,arguments)},p._Sinh=function(){return(p._Sinh=p.asm.Sinh).apply(null,arguments)},p._Softmax=function(){return(p._Softmax=p.asm.Softmax).apply(null,arguments)},p._Softplus=function(){return(p._Softplus=p.asm.Softplus).apply(null,arguments)},p._SparseFillEmptyRows=function(){return(p._SparseFillEmptyRows=p.asm.SparseFillEmptyRows).apply(null,arguments)},p._SparseReshape=function(){return(p._SparseReshape=p.asm.SparseReshape).apply(null,arguments)},p._SparseSegmentReduction=function(){return(p._SparseSegmentReduction=p.asm.SparseSegmentReduction).apply(null,arguments)},p._SparseToDense=function(){return(p._SparseToDense=p.asm.SparseToDense).apply(null,arguments)},p._Sqrt=function(){return(p._Sqrt=p.asm.Sqrt).apply(null,arguments)},p._Square=function(){return(p._Square=p.asm.Square).apply(null,arguments)},p._SquaredDifference=function(){return(p._SquaredDifference=p.asm.SquaredDifference).apply(null,arguments)},p._Step=function(){return(p._Step=p.asm.Step).apply(null,arguments)},p._StridedSlice=function(){return(p._StridedSlice=p.asm.StridedSlice).apply(null,arguments)},p._Sub=function(){return(p._Sub=p.asm.Sub).apply(null,arguments)},p._Sum=function(){return(p._Sum=p.asm.Sum).apply(null,arguments)},p._Tan=function(){return(p._Tan=p.asm.Tan).apply(null,arguments)},p._Tanh=function(){return(p._Tanh=p.asm.Tanh).apply(null,arguments)},p._TensorScatterUpdate=function(){return(p._TensorScatterUpdate=p.asm.TensorScatterUpdate).apply(null,arguments)},p._Tile=function(){return(p._Tile=p.asm.Tile).apply(null,arguments)},p._TopK=function(){return(p._TopK=p.asm.TopK).apply(null,arguments)},p._Transform=function(){return(p._Transform=p.asm.Transform).apply(null,arguments)},p._Transpose=function(){return(p._Transpose=p.asm.Transpose).apply(null,arguments)},p.__FusedMatMul=function(){return(p.__FusedMatMul=p.asm._FusedMatMul).apply(null,arguments)},p._malloc=function(){return(p._malloc=p.asm.malloc).apply(null,arguments)},p._free=function(){return(p._free=p.asm.free).apply(null,arguments)},p.__emscripten_tls_init=function(){return(p.__emscripten_tls_init=p.asm._emscripten_tls_init).apply(null,arguments)},p._pthread_self=function(){return(Ye=p._pthread_self=p.asm.pthread_self).apply(null,arguments)}),Ze=(p.___errno_location=function(){return(p.___errno_location=p.asm.__errno_location).apply(null,arguments)},p.__emscripten_thread_init=function(){return(Ze=p.__emscripten_thread_init=p.asm._emscripten_thread_init).apply(null,arguments)}),Je=(p.__emscripten_thread_crashed=function(){return(p.__emscripten_thread_crashed=p.asm._emscripten_thread_crashed).apply(null,arguments)},p._emscripten_main_thread_process_queued_calls=function(){return(p._emscripten_main_thread_process_queued_calls=p.asm.emscripten_main_thread_process_queued_calls).apply(null,arguments)},p._emscripten_main_browser_thread_id=function(){return(p._emscripten_main_browser_thread_id=p.asm.emscripten_main_browser_thread_id).apply(null,arguments)},p._emscripten_run_in_main_runtime_thread_js=function(){return(Je=p._emscripten_run_in_main_runtime_thread_js=p.asm.emscripten_run_in_main_runtime_thread_js).apply(null,arguments)}),Qe=(p._emscripten_dispatch_to_thread_=function(){return(p._emscripten_dispatch_to_thread_=p.asm.emscripten_dispatch_to_thread_).apply(null,arguments)},p.__emscripten_proxy_execute_task_queue=function(){return(Qe=p.__emscripten_proxy_execute_task_queue=p.asm._emscripten_proxy_execute_task_queue).apply(null,arguments)}),$e=p.__emscripten_thread_free_data=function(){return($e=p.__emscripten_thread_free_data=p.asm._emscripten_thread_free_data).apply(null,arguments)},et=p.__emscripten_thread_exit=function(){return(et=p.__emscripten_thread_exit=p.asm._emscripten_thread_exit).apply(null,arguments)},tt=p._emscripten_stack_set_limits=function(){return(tt=p._emscripten_stack_set_limits=p.asm.emscripten_stack_set_limits).apply(null,arguments)},nt=p.stackSave=function(){return(nt=p.stackSave=p.asm.stackSave).apply(null,arguments)},rt=p.stackRestore=function(){return(rt=p.stackRestore=p.asm.stackRestore).apply(null,arguments)},at=p.stackAlloc=function(){return(at=p.stackAlloc=p.asm.stackAlloc).apply(null,arguments)};p.dynCall_iijjiiii=function(){return(p.dynCall_iijjiiii=p.asm.dynCall_iijjiiii).apply(null,arguments)},p.dynCall_jiji=function(){return(p.dynCall_jiji=p.asm.dynCall_jiji).apply(null,arguments)};function it(e){if(e=e||b,!(le>0)){if(w)return c(p),se(),void startWorker(p);(function(){if(p.preRun)for("function"==typeof p.preRun&&(p.preRun=[p.preRun]);p.preRun.length;)ue(p.preRun.shift());Se(re)})(),le>0||(p.setStatus?(p.setStatus("Running..."),setTimeout((function(){setTimeout((function(){p.setStatus("")}),1),t()}),1)):t())}function t(){Ge||(Ge=!0,p.calledRun=!0,!P&&(se(),c(p),p.onRuntimeInitialized&&p.onRuntimeInitialized(),function(){if(!w){if(p.postRun)for("function"==typeof p.postRun&&(p.postRun=[p.postRun]);p.postRun.length;)ce(p.postRun.shift());Se(ie)}}()))}}if(p.keepRuntimeAlive=oe,p.wasmMemory=M,p.cwrap=function(e,t,n,r){var a=(n=n||[]).every((function(e){return"number"===e||"boolean"===e}));return"string"!==t&&a&&!r?We(e):function(){return Ve(e,t,n,arguments)}},p.ExitStatus=ye,p.PThread=Ie,pe=function e(){Ge||it(),Ge||(pe=e)},p.preInit)for("function"==typeof p.preInit&&(p.preInit=[p.preInit]);p.preInit.length>0;)p.preInit.pop()();if(it(),d&&(He={uncaughtException:r.listeners("uncaughtException").filter((function(e){return!d.uncaughtException.indexOf(e)>-1})),unhandledRejection:r.listeners("unhandledRejection").filter((function(e){return!d.unhandledRejection.indexOf(e)>-1}))}),"undefined"!=typeof WasmBackendModule)qe=WasmBackendModule;else{if("undefined"==typeof e)throw new Error("Could not find wasm module in post.js");qe=e}if(He){var ot=qe._dispose;qe._dispose=function(){ot(),He.uncaughtException.forEach((function(e){r.removeListener("uncaughtException",e)})),He.unhandledRejection.forEach((function(e){r.removeListener("unhandledRejection",e)}))}}return e.ready}}();"object"==typeof t&&"object"==typeof o?o.exports=s:"function"==typeof define&&n(48)?define([],(function(){return s})):"object"==typeof t&&(t.WasmBackendModuleThreadedSimd=s)})),ae=M((function(e,t){t.exports.wasmWorkerContents='"use strict";var Module={};var ENVIRONMENT_IS_NODE=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string";if(ENVIRONMENT_IS_NODE){var nodeWorkerThreads=require("worker_threads");var parentPort=nodeWorkerThreads.parentPort;parentPort.on("message",data=>onmessage({data:data}));var fs=require("fs");Object.assign(global,{self:global,require:require,Module:Module,location:{href:__filename},Worker:nodeWorkerThreads.Worker,importScripts:function(f){(0,eval)(fs.readFileSync(f,"utf8")+"//# sourceURL="+f)},postMessage:function(msg){parentPort.postMessage(msg)},performance:global.performance||{now:function(){return Date.now()}}})}var initializedJS=false;var pendingNotifiedProxyingQueues=[];function threadPrintErr(){var text=Array.prototype.slice.call(arguments).join(" ");if(ENVIRONMENT_IS_NODE){fs.writeSync(2,text+"\n");return}console.error(text)}function threadAlert(){var text=Array.prototype.slice.call(arguments).join(" ");postMessage({cmd:"alert",text:text,threadId:Module["_pthread_self"]()})}var err=threadPrintErr;self.alert=threadAlert;Module["instantiateWasm"]=(info,receiveInstance)=>{var instance=new WebAssembly.Instance(Module["wasmModule"],info);receiveInstance(instance);Module["wasmModule"]=null;return instance.exports};self.onunhandledrejection=e=>{throw e.reason??e};self.startWorker=instance=>{Module=instance;postMessage({"cmd":"loaded"})};self.onmessage=e=>{try{if(e.data.cmd==="load"){Module["wasmModule"]=e.data.wasmModule;for(const handler of e.data.handlers){Module[handler]=function(){postMessage({cmd:"callHandler",handler:handler,args:[...arguments]})}}Module["wasmMemory"]=e.data.wasmMemory;Module["buffer"]=Module["wasmMemory"].buffer;Module["ENVIRONMENT_IS_PTHREAD"]=true;if(typeof e.data.urlOrBlob=="string"){importScripts(e.data.urlOrBlob)}else{var objectUrl=URL.createObjectURL(e.data.urlOrBlob);importScripts(objectUrl);URL.revokeObjectURL(objectUrl)}WasmBackendModuleThreadedSimd(Module)}else if(e.data.cmd==="run"){Module["__emscripten_thread_init"](e.data.pthread_ptr,0,0,1);Module["establishStackSpace"]();Module["PThread"].receiveObjectTransfer(e.data);Module["PThread"].threadInitTLS();if(!initializedJS){pendingNotifiedProxyingQueues.forEach(queue=>{Module["executeNotifiedProxyingQueue"](queue)});pendingNotifiedProxyingQueues=[];initializedJS=true}try{Module["invokeEntryPoint"](e.data.start_routine,e.data.arg)}catch(ex){if(ex!="unwind"){if(ex instanceof Module["ExitStatus"]){if(Module["keepRuntimeAlive"]()){}else{Module["__emscripten_thread_exit"](ex.status)}}else{throw ex}}}}else if(e.data.cmd==="cancel"){if(Module["_pthread_self"]()){Module["__emscripten_thread_exit"](-1)}}else if(e.data.target==="setimmediate"){}else if(e.data.cmd==="processProxyingQueue"){if(initializedJS){Module["executeNotifiedProxyingQueue"](e.data.queue)}else{pendingNotifiedProxyingQueues.push(e.data.queue)}}else if(e.data.cmd){err("worker.js received unknown command "+e.data.cmd);err(e.data)}}catch(ex){if(Module["__emscripten_thread_crashed"]){Module["__emscripten_thread_crashed"]()}throw ex}};'})),ie=M((function(t,i){var o=function(){var t="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0;return t=t||e,function(e){var n,i,o,s="undefined"!=typeof(e=e||{})?e:{};s.ready=new Promise((function(e,t){n=e,i=t})),"undefined"!=typeof r&&r.listeners&&(o={uncaughtException:r.listeners("uncaughtException"),unhandledRejection:r.listeners("unhandledRejection")});var u,c,l,d=Object.assign({},s),p=[],f="object"==typeof window,h="function"==typeof importScripts,m="object"==typeof r&&"object"==typeof r.versions&&"string"==typeof r.versions.node,v="";if(m){var b=Q(),g=$();v=h?g.dirname(v)+"/":a+"/",u=function(e,t){return e=V(e)?new URL(e):g.normalize(e),b.readFileSync(e,t?void 0:"utf8")},l=function(e){var t=u(e,!0);return t.buffer||(t=new Uint8Array(t)),t},c=function(e,t,n){e=V(e)?new URL(e):g.normalize(e),b.readFile(e,(function(e,r){e?n(e):t(r.buffer)}))},r.argv.length>1&&r.argv[1].replace(/\\/g,"/"),p=r.argv.slice(2),r.on("uncaughtException",(function(e){if(!(e instanceof H))throw e})),r.on("unhandledRejection",(function(e){throw e})),function(e,t){if(w)throw r.exitCode=e,t;(function(e){e instanceof H||x("exiting due to exception: "+e)})(t),r.exit(e)},s.inspect=function(){return"[Emscripten Module object]"}}else(f||h)&&(h?v=self.location.href:"undefined"!=typeof document&&document.currentScript&&(v=document.currentScript.src),t&&(v=t),v=0!==v.indexOf("blob:")?v.substr(0,v.replace(/[?#].*/,"").lastIndexOf("/")+1):"",u=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},h&&(l=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),c=function(e,t,n){var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer",r.onload=function(){200==r.status||0==r.status&&r.response?t(r.response):n()},r.onerror=n,r.send(null)},function(e){return document.title=e});var y=s.print||console.log.bind(console),x=s.printErr||console.warn.bind(console);Object.assign(s,d),d=null,s.arguments&&(p=s.arguments),s.thisProgram&&s.thisProgram,s.quit&&s.quit;var k;s.wasmBinary&&(k=s.wasmBinary);var w=s.noExitRuntime||!0;"object"!=typeof WebAssembly&&P("no native wasm support detected");var O,I=!1;var S,N,j,T,C="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function E(e,t,n){for(var r=(t>>>=0)+n,a=t;e[a]&&!(a>=r);)++a;if(a-t>16&&e.buffer&&C)return C.decode(e.subarray(t,a));for(var i="";t<a;){var o=e[t++];if(128&o){var s=63&e[t++];if(192!=(224&o)){var u=63&e[t++];if((o=224==(240&o)?(15&o)<<12|s<<6|u:(7&o)<<18|s<<12|u<<6|63&e[t++])<65536)i+=String.fromCharCode(o);else{var c=o-65536;i+=String.fromCharCode(55296|c>>10,56320|1023&c)}}else i+=String.fromCharCode((31&o)<<6|s)}else i+=String.fromCharCode(o)}return i}function _(e,t){return(e>>>=0)?E(j,e,t):""}function A(e){S=e,s.HEAP8=N=new Int8Array(e),s.HEAP16=new Int16Array(e),s.HEAP32=new Int32Array(e),s.HEAPU8=j=new Uint8Array(e),s.HEAPU16=new Uint16Array(e),s.HEAPU32=T=new Uint32Array(e),s.HEAPF32=new Float32Array(e),s.HEAPF64=new Float64Array(e)}s.INITIAL_MEMORY;var R=[],D=[],F=[];var M=0,z=null,L=null;function P(e){s.onAbort&&s.onAbort(e),x(e="Aborted("+e+")"),I=!0,1,e+=". Build with -sASSERTIONS for more info.";var t=new WebAssembly.RuntimeError(e);throw i(t),t}var B,W;function U(e){return e.startsWith("data:application/octet-stream;base64,")}function V(e){return e.startsWith("file://")}function G(e){try{if(e==B&&k)return new Uint8Array(k);if(l)return l(e);throw"both async and sync fetching of the wasm failed"}catch(t){P(t)}}function H(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function q(e){for(;e.length>0;)e.shift()(s)}function K(e){try{return O.grow(e-S.byteLength+65535>>>16),A(O.buffer),1}catch(t){}}U(B="tfjs-backend-wasm.wasm")||(W=B,B=s.locateFile?s.locateFile(W,v):v+W);var X=[null,[],[]];function Y(e,t){var n=X[e];0===t||10===t?((1===e?y:x)(E(n,0)),n.length=0):n.push(t)}function Z(e){return s["_"+e]}function J(e,t,n,r,a){var i={string:function(e){var t=0;if(null!=e&&0!==e){var n=1+(e.length<<2);(function(e,t,n){(function(e,t,n,r){if(!(r>0))return 0;for(var a=n>>>=0,i=n+r-1,o=0;o<e.length;++o){var s=e.charCodeAt(o);if(s>=55296&&s<=57343)s=65536+((1023&s)<<10)|1023&e.charCodeAt(++o);if(s<=127){if(n>=i)break;t[n++>>>0]=s}else if(s<=2047){if(n+1>=i)break;t[n++>>>0]=192|s>>6,t[n++>>>0]=128|63&s}else if(s<=65535){if(n+2>=i)break;t[n++>>>0]=224|s>>12,t[n++>>>0]=128|s>>6&63,t[n++>>>0]=128|63&s}else{if(n+3>=i)break;t[n++>>>0]=240|s>>18,t[n++>>>0]=128|s>>12&63,t[n++>>>0]=128|s>>6&63,t[n++>>>0]=128|63&s}}t[n>>>0]=0})(e,j,t,n)})(e,t=oe(n),n)}return t},array:function(e){var t=oe(e.length);return function(e,t){N.set(e,t>>>0)}(e,t),t}};var o=Z(e),s=[],u=0;if(r)for(var c=0;c<r.length;c++){var l=i[n[c]];l?(0===u&&(u=ae()),s[c]=l(r[c])):s[c]=r[c]}var d,p=o.apply(null,s);return d=p,0!==u&&ie(u),p=function(e){return"string"===t?_(e):"boolean"===t?!!e:e}(d)}var ee,te,ne,re={abort:function(){P("")},emscripten_get_heap_max:function(){return 4294901760},emscripten_memcpy_big:function(e,t,n){j.copyWithin(e>>>0,t>>>0,t+n>>>0)},emscripten_resize_heap:function(e){var t=j.length,n=4294901760;if((e>>>=0)>n)return!1;for(var r,a,i=1;i<=4;i*=2){var o=t*(1+.2/i);if(o=Math.min(o,e+100663296),K(Math.min(n,(r=Math.max(e,o))+((a=65536)-r%a)%a)))return!0}return!1},fd_close:function(e){return 52},fd_seek:function(e,t,n,r,a){return 70},fd_write:function(e,t,n,r){for(var a=0,i=0;i<n;i++){var o=T[t>>>2],s=T[t+4>>>2];t+=8;for(var u=0;u<s;u++)Y(e,j[o+u>>>0]);a+=s}return T[r>>>2]=a,0}},ae=(function(){var e={env:re,wasi_snapshot_preview1:re};function t(e,t){var n=e.exports;s.asm=n,A((O=s.asm.memory).buffer),s.asm.__indirect_function_table,function(e){D.unshift(e)}(s.asm.__wasm_call_ctors),function(e){if(M--,s.monitorRunDependencies&&s.monitorRunDependencies(M),0==M&&(null!==z&&(clearInterval(z),z=null),L)){var t=L;L=null,t()}}()}function n(e){t(e.instance)}function r(t){return function(){if(!k&&(f||h)){if("function"==typeof fetch&&!V(B))return fetch(B,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+B+"'";return e.arrayBuffer()})).catch((function(){return G(B)}));if(c)return new Promise((function(e,t){c(B,(function(t){e(new Uint8Array(t))}),t)}))}return Promise.resolve().then((function(){return G(B)}))}().then((function(t){return WebAssembly.instantiate(t,e)})).then((function(e){return e})).then(t,(function(e){x("failed to asynchronously prepare wasm: "+e),P(e)}))}if(M++,s.monitorRunDependencies&&s.monitorRunDependencies(M),s.instantiateWasm)try{return s.instantiateWasm(e,t)}catch(a){x("Module.instantiateWasm callback failed with error: "+a),i(a)}(k||"function"!=typeof WebAssembly.instantiateStreaming||U(B)||V(B)||m||"function"!=typeof fetch?r(n):fetch(B,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(n,(function(e){return x("wasm streaming compile failed: "+e),x("falling back to ArrayBuffer instantiation"),r(n)}))}))).catch(i)}(),s.___wasm_call_ctors=function(){return(s.___wasm_call_ctors=s.asm.__wasm_call_ctors).apply(null,arguments)},s._init=function(){return(s._init=s.asm.init).apply(null,arguments)},s._init_with_threads_count=function(){return(s._init_with_threads_count=s.asm.init_with_threads_count).apply(null,arguments)},s._get_threads_count=function(){return(s._get_threads_count=s.asm.get_threads_count).apply(null,arguments)},s._register_tensor=function(){return(s._register_tensor=s.asm.register_tensor).apply(null,arguments)},s._dispose_data=function(){return(s._dispose_data=s.asm.dispose_data).apply(null,arguments)},s._dispose=function(){return(s._dispose=s.asm.dispose).apply(null,arguments)},s._Abs=function(){return(s._Abs=s.asm.Abs).apply(null,arguments)},s._Acos=function(){return(s._Acos=s.asm.Acos).apply(null,arguments)},s._Acosh=function(){return(s._Acosh=s.asm.Acosh).apply(null,arguments)},s._Add=function(){return(s._Add=s.asm.Add).apply(null,arguments)},s._AddN=function(){return(s._AddN=s.asm.AddN).apply(null,arguments)},s._All=function(){return(s._All=s.asm.All).apply(null,arguments)},s._Any=function(){return(s._Any=s.asm.Any).apply(null,arguments)},s._ArgMax=function(){return(s._ArgMax=s.asm.ArgMax).apply(null,arguments)},s._ArgMin=function(){return(s._ArgMin=s.asm.ArgMin).apply(null,arguments)},s._Asin=function(){return(s._Asin=s.asm.Asin).apply(null,arguments)},s._Asinh=function(){return(s._Asinh=s.asm.Asinh).apply(null,arguments)},s._Atan=function(){return(s._Atan=s.asm.Atan).apply(null,arguments)},s._Atan2=function(){return(s._Atan2=s.asm.Atan2).apply(null,arguments)},s._Atanh=function(){return(s._Atanh=s.asm.Atanh).apply(null,arguments)},s._AvgPool=function(){return(s._AvgPool=s.asm.AvgPool).apply(null,arguments)},s._AvgPool3D=function(){return(s._AvgPool3D=s.asm.AvgPool3D).apply(null,arguments)},s._AvgPool3DGrad=function(){return(s._AvgPool3DGrad=s.asm.AvgPool3DGrad).apply(null,arguments)},s._AvgPoolGrad=function(){return(s._AvgPoolGrad=s.asm.AvgPoolGrad).apply(null,arguments)},s._BatchMatMul=function(){return(s._BatchMatMul=s.asm.BatchMatMul).apply(null,arguments)},s._Bincount=function(){return(s._Bincount=s.asm.Bincount).apply(null,arguments)},s._BitwiseAnd=function(){return(s._BitwiseAnd=s.asm.BitwiseAnd).apply(null,arguments)},s._Ceil=function(){return(s._Ceil=s.asm.Ceil).apply(null,arguments)},s._ClipByValue=function(){return(s._ClipByValue=s.asm.ClipByValue).apply(null,arguments)},s._Conv2D=function(){return(s._Conv2D=s.asm.Conv2D).apply(null,arguments)},s._Conv2DBackpropInput=function(){return(s._Conv2DBackpropInput=s.asm.Conv2DBackpropInput).apply(null,arguments)},s._Conv3D=function(){return(s._Conv3D=s.asm.Conv3D).apply(null,arguments)},s._Conv3DBackpropFilterV2=function(){return(s._Conv3DBackpropFilterV2=s.asm.Conv3DBackpropFilterV2).apply(null,arguments)},s._Conv3DBackpropInputV2=function(){return(s._Conv3DBackpropInputV2=s.asm.Conv3DBackpropInputV2).apply(null,arguments)},s._Cos=function(){return(s._Cos=s.asm.Cos).apply(null,arguments)},s._Cosh=function(){return(s._Cosh=s.asm.Cosh).apply(null,arguments)},s._CropAndResize=function(){return(s._CropAndResize=s.asm.CropAndResize).apply(null,arguments)},s._Cumprod=function(){return(s._Cumprod=s.asm.Cumprod).apply(null,arguments)},s._Cumsum=function(){return(s._Cumsum=s.asm.Cumsum).apply(null,arguments)},s._DenseBincount=function(){return(s._DenseBincount=s.asm.DenseBincount).apply(null,arguments)},s._DepthToSpace=function(){return(s._DepthToSpace=s.asm.DepthToSpace).apply(null,arguments)},s._DepthwiseConv2dNative=function(){return(s._DepthwiseConv2dNative=s.asm.DepthwiseConv2dNative).apply(null,arguments)},s._Diag=function(){return(s._Diag=s.asm.Diag).apply(null,arguments)},s._Dilation2D=function(){return(s._Dilation2D=s.asm.Dilation2D).apply(null,arguments)},s._Dilation2DBackpropFilter=function(){return(s._Dilation2DBackpropFilter=s.asm.Dilation2DBackpropFilter).apply(null,arguments)},s._Dilation2DBackpropInput=function(){return(s._Dilation2DBackpropInput=s.asm.Dilation2DBackpropInput).apply(null,arguments)},s._Elu=function(){return(s._Elu=s.asm.Elu).apply(null,arguments)},s._EluGrad=function(){return(s._EluGrad=s.asm.EluGrad).apply(null,arguments)},s._Equal=function(){return(s._Equal=s.asm.Equal).apply(null,arguments)},s._Erf=function(){return(s._Erf=s.asm.Erf).apply(null,arguments)},s._Exp=function(){return(s._Exp=s.asm.Exp).apply(null,arguments)},s._Expm1=function(){return(s._Expm1=s.asm.Expm1).apply(null,arguments)},s._FlipLeftRight=function(){return(s._FlipLeftRight=s.asm.FlipLeftRight).apply(null,arguments)},s._Floor=function(){return(s._Floor=s.asm.Floor).apply(null,arguments)},s._FloorDiv=function(){return(s._FloorDiv=s.asm.FloorDiv).apply(null,arguments)},s._FusedBatchNorm=function(){return(s._FusedBatchNorm=s.asm.FusedBatchNorm).apply(null,arguments)},s._FusedConv2D=function(){return(s._FusedConv2D=s.asm.FusedConv2D).apply(null,arguments)},s._FusedDepthwiseConv2D=function(){return(s._FusedDepthwiseConv2D=s.asm.FusedDepthwiseConv2D).apply(null,arguments)},s._Gather=function(){return(s._Gather=s.asm.Gather).apply(null,arguments)},s._GatherNd=function(){return(s._GatherNd=s.asm.GatherNd).apply(null,arguments)},s._Greater=function(){return(s._Greater=s.asm.Greater).apply(null,arguments)},s._GreaterEqual=function(){return(s._GreaterEqual=s.asm.GreaterEqual).apply(null,arguments)},s._IsFinite=function(){return(s._IsFinite=s.asm.IsFinite).apply(null,arguments)},s._IsInf=function(){return(s._IsInf=s.asm.IsInf).apply(null,arguments)},s._IsNan=function(){return(s._IsNan=s.asm.IsNan).apply(null,arguments)},s._LRN=function(){return(s._LRN=s.asm.LRN).apply(null,arguments)},s._LRNGrad=function(){return(s._LRNGrad=s.asm.LRNGrad).apply(null,arguments)},s._LeakyRelu=function(){return(s._LeakyRelu=s.asm.LeakyRelu).apply(null,arguments)},s._Less=function(){return(s._Less=s.asm.Less).apply(null,arguments)},s._LessEqual=function(){return(s._LessEqual=s.asm.LessEqual).apply(null,arguments)},s._LinSpace=function(){return(s._LinSpace=s.asm.LinSpace).apply(null,arguments)},s._Log=function(){return(s._Log=s.asm.Log).apply(null,arguments)},s._Log1p=function(){return(s._Log1p=s.asm.Log1p).apply(null,arguments)},s._LogicalAnd=function(){return(s._LogicalAnd=s.asm.LogicalAnd).apply(null,arguments)},s._LogicalNot=function(){return(s._LogicalNot=s.asm.LogicalNot).apply(null,arguments)},s._LogicalOr=function(){return(s._LogicalOr=s.asm.LogicalOr).apply(null,arguments)},s._LogicalXor=function(){return(s._LogicalXor=s.asm.LogicalXor).apply(null,arguments)},s._Max=function(){return(s._Max=s.asm.Max).apply(null,arguments)},s._MaxPool=function(){return(s._MaxPool=s.asm.MaxPool).apply(null,arguments)},s._MaxPool3D=function(){return(s._MaxPool3D=s.asm.MaxPool3D).apply(null,arguments)},s._MaxPool3DGrad=function(){return(s._MaxPool3DGrad=s.asm.MaxPool3DGrad).apply(null,arguments)},s._MaxPoolGrad=function(){return(s._MaxPoolGrad=s.asm.MaxPoolGrad).apply(null,arguments)},s._MaxPoolWithArgmax=function(){return(s._MaxPoolWithArgmax=s.asm.MaxPoolWithArgmax).apply(null,arguments)},s._Maximum=function(){return(s._Maximum=s.asm.Maximum).apply(null,arguments)},s._Mean=function(){return(s._Mean=s.asm.Mean).apply(null,arguments)},s._Min=function(){return(s._Min=s.asm.Min).apply(null,arguments)},s._Minimum=function(){return(s._Minimum=s.asm.Minimum).apply(null,arguments)},s._MirrorPad=function(){return(s._MirrorPad=s.asm.MirrorPad).apply(null,arguments)},s._Mod=function(){return(s._Mod=s.asm.Mod).apply(null,arguments)},s._Multinomial=function(){return(s._Multinomial=s.asm.Multinomial).apply(null,arguments)},s._Multiply=function(){return(s._Multiply=s.asm.Multiply).apply(null,arguments)},s._Neg=function(){return(s._Neg=s.asm.Neg).apply(null,arguments)},s._NonMaxSuppressionV3=function(){return(s._NonMaxSuppressionV3=s.asm.NonMaxSuppressionV3).apply(null,arguments)},s._NonMaxSuppressionV4=function(){return(s._NonMaxSuppressionV4=s.asm.NonMaxSuppressionV4).apply(null,arguments)},s._NonMaxSuppressionV5=function(){return(s._NonMaxSuppressionV5=s.asm.NonMaxSuppressionV5).apply(null,arguments)},s._NotEqual=function(){return(s._NotEqual=s.asm.NotEqual).apply(null,arguments)},s._OneHot=function(){return(s._OneHot=s.asm.OneHot).apply(null,arguments)},s._PadV2=function(){return(s._PadV2=s.asm.PadV2).apply(null,arguments)},s._Pow=function(){return(s._Pow=s.asm.Pow).apply(null,arguments)},s._Prelu=function(){return(s._Prelu=s.asm.Prelu).apply(null,arguments)},s._Prod=function(){return(s._Prod=s.asm.Prod).apply(null,arguments)},s._RealDiv=function(){return(s._RealDiv=s.asm.RealDiv).apply(null,arguments)},s._Reciprocal=function(){return(s._Reciprocal=s.asm.Reciprocal).apply(null,arguments)},s._Relu=function(){return(s._Relu=s.asm.Relu).apply(null,arguments)},s._Relu6=function(){return(s._Relu6=s.asm.Relu6).apply(null,arguments)},s._ResizeBilinear=function(){return(s._ResizeBilinear=s.asm.ResizeBilinear).apply(null,arguments)},s._ResizeBilinearGrad=function(){return(s._ResizeBilinearGrad=s.asm.ResizeBilinearGrad).apply(null,arguments)},s._ResizeNearestNeighbor=function(){return(s._ResizeNearestNeighbor=s.asm.ResizeNearestNeighbor).apply(null,arguments)},s._ResizeNearestNeighborGrad=function(){return(s._ResizeNearestNeighborGrad=s.asm.ResizeNearestNeighborGrad).apply(null,arguments)},s._Reverse=function(){return(s._Reverse=s.asm.Reverse).apply(null,arguments)},s._RotateWithOffset=function(){return(s._RotateWithOffset=s.asm.RotateWithOffset).apply(null,arguments)},s._Round=function(){return(s._Round=s.asm.Round).apply(null,arguments)},s._Rsqrt=function(){return(s._Rsqrt=s.asm.Rsqrt).apply(null,arguments)},s._ScatterNd=function(){return(s._ScatterNd=s.asm.ScatterNd).apply(null,arguments)},s._SearchSorted=function(){return(s._SearchSorted=s.asm.SearchSorted).apply(null,arguments)},s._SelectV2=function(){return(s._SelectV2=s.asm.SelectV2).apply(null,arguments)},s._Selu=function(){return(s._Selu=s.asm.Selu).apply(null,arguments)},s._Sigmoid=function(){return(s._Sigmoid=s.asm.Sigmoid).apply(null,arguments)},s._Sign=function(){return(s._Sign=s.asm.Sign).apply(null,arguments)},s._Sin=function(){return(s._Sin=s.asm.Sin).apply(null,arguments)},s._Sinh=function(){return(s._Sinh=s.asm.Sinh).apply(null,arguments)},s._Softmax=function(){return(s._Softmax=s.asm.Softmax).apply(null,arguments)},s._Softplus=function(){return(s._Softplus=s.asm.Softplus).apply(null,arguments)},s._SparseFillEmptyRows=function(){return(s._SparseFillEmptyRows=s.asm.SparseFillEmptyRows).apply(null,arguments)},s._SparseReshape=function(){return(s._SparseReshape=s.asm.SparseReshape).apply(null,arguments)},s._SparseSegmentReduction=function(){return(s._SparseSegmentReduction=s.asm.SparseSegmentReduction).apply(null,arguments)},s._SparseToDense=function(){return(s._SparseToDense=s.asm.SparseToDense).apply(null,arguments)},s._Sqrt=function(){return(s._Sqrt=s.asm.Sqrt).apply(null,arguments)},s._Square=function(){return(s._Square=s.asm.Square).apply(null,arguments)},s._SquaredDifference=function(){return(s._SquaredDifference=s.asm.SquaredDifference).apply(null,arguments)},s._Step=function(){return(s._Step=s.asm.Step).apply(null,arguments)},s._StridedSlice=function(){return(s._StridedSlice=s.asm.StridedSlice).apply(null,arguments)},s._Sub=function(){return(s._Sub=s.asm.Sub).apply(null,arguments)},s._Sum=function(){return(s._Sum=s.asm.Sum).apply(null,arguments)},s._Tan=function(){return(s._Tan=s.asm.Tan).apply(null,arguments)},s._Tanh=function(){return(s._Tanh=s.asm.Tanh).apply(null,arguments)},s._TensorScatterUpdate=function(){return(s._TensorScatterUpdate=s.asm.TensorScatterUpdate).apply(null,arguments)},s._Tile=function(){return(s._Tile=s.asm.Tile).apply(null,arguments)},s._TopK=function(){return(s._TopK=s.asm.TopK).apply(null,arguments)},s._Transform=function(){return(s._Transform=s.asm.Transform).apply(null,arguments)},s._Transpose=function(){return(s._Transpose=s.asm.Transpose).apply(null,arguments)},s.__FusedMatMul=function(){return(s.__FusedMatMul=s.asm._FusedMatMul).apply(null,arguments)},s._malloc=function(){return(s._malloc=s.asm.malloc).apply(null,arguments)},s._free=function(){return(s._free=s.asm.free).apply(null,arguments)},s.___errno_location=function(){return(s.___errno_location=s.asm.__errno_location).apply(null,arguments)},s.stackSave=function(){return(ae=s.stackSave=s.asm.stackSave).apply(null,arguments)}),ie=s.stackRestore=function(){return(ie=s.stackRestore=s.asm.stackRestore).apply(null,arguments)},oe=s.stackAlloc=function(){return(oe=s.stackAlloc=s.asm.stackAlloc).apply(null,arguments)};s.dynCall_iijjiiii=function(){return(s.dynCall_iijjiiii=s.asm.dynCall_iijjiiii).apply(null,arguments)},s.dynCall_jiji=function(){return(s.dynCall_jiji=s.asm.dynCall_jiji).apply(null,arguments)};function se(e){function t(){ee||(ee=!0,s.calledRun=!0,!I&&(!0,q(D),n(s),s.onRuntimeInitialized&&s.onRuntimeInitialized(),function(){if(s.postRun)for("function"==typeof s.postRun&&(s.postRun=[s.postRun]);s.postRun.length;)e=s.postRun.shift(),F.unshift(e);var e;q(F)}()))}e=e||p,M>0||(function(){if(s.preRun)for("function"==typeof s.preRun&&(s.preRun=[s.preRun]);s.preRun.length;)e=s.preRun.shift(),R.unshift(e);var e;q(R)}(),M>0)||(s.setStatus?(s.setStatus("Running..."),setTimeout((function(){setTimeout((function(){s.setStatus("")}),1),t()}),1)):t())}if(s.cwrap=function(e,t,n,r){var a=(n=n||[]).every((function(e){return"number"===e||"boolean"===e}));return"string"!==t&&a&&!r?Z(e):function(){return J(e,t,n,arguments)}},L=function e(){ee||se(),ee||(L=e)},s.preInit)for("function"==typeof s.preInit&&(s.preInit=[s.preInit]);s.preInit.length>0;)s.preInit.pop()();if(se(),o&&(te={uncaughtException:r.listeners("uncaughtException").filter((function(e){return!o.uncaughtException.indexOf(e)>-1})),unhandledRejection:r.listeners("unhandledRejection").filter((function(e){return!o.unhandledRejection.indexOf(e)>-1}))}),"undefined"!=typeof e)ne=e;else{if("undefined"==typeof WasmBackendModuleThreadedSimd)throw new Error("Could not find wasm module in post.js");ne=WasmBackendModuleThreadedSimd}if(te){var ue=ne._dispose;ne._dispose=function(){ue(),te.uncaughtException.forEach((function(e){r.removeListener("uncaughtException",e)})),te.unhandledRejection.forEach((function(e){r.removeListener("unhandledRejection",e)}))}}return e.ready}}();"object"==typeof t&&"object"==typeof i?i.exports=o:"function"==typeof define&&n(48)?define([],(function(){return o})):"object"==typeof t&&(t.WasmBackendModule=o)})),oe=function(){function e(t,n){Object(O.a)(this,e),this.backend=t,this.dataMover=n,this.data=new WeakMap,this.dataIdsCount=0}return Object(I.a)(e,[{key:"get",value:function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}},{key:"set",value:function(e,t){this.dataIdsCount++,this.data.set(e,t)}},{key:"has",value:function(e){return this.data.has(e)}},{key:"delete",value:function(e){return this.dataIdsCount--,this.data.delete(e)}},{key:"numDataIds",value:function(){return this.dataIdsCount}}]),e}(),se=function(){function e(){Object(O.a)(this,e)}return Object(I.a)(e,[{key:"refCount",value:function(e){return ue("refCount")}},{key:"incRef",value:function(e){return ue("incRef")}},{key:"timerAvailable",value:function(){return!0}},{key:"time",value:function(e){return ue("time")}},{key:"read",value:function(e){return ue("read")}},{key:"readSync",value:function(e){return ue("readSync")}},{key:"readToGPU",value:function(e,t){return ue("readToGPU")}},{key:"numDataIds",value:function(){return ue("numDataIds")}},{key:"disposeData",value:function(e,t){return ue("disposeData")}},{key:"write",value:function(e,t,n){return ue("write")}},{key:"move",value:function(e,t,n,r,a){return ue("move")}},{key:"createTensorFromGPUData",value:function(e,t,n){return ue("createTensorFromGPUData")}},{key:"memory",value:function(){return ue("memory")}},{key:"floatPrecision",value:function(){return ue("floatPrecision")}},{key:"epsilon",value:function(){return 32===this.floatPrecision()?1e-7:1e-4}},{key:"dispose",value:function(){return ue("dispose")}}]),e}();function ue(e){throw new Error("'".concat(e,"' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen"))}function ce(e){for(var t=e.length,n=0;t>0;)n=Math.random()*t|0,fe(e,--t,n)}function le(e,t){if(e.length!==t.length)throw new Error("Array sizes must match to be shuffled together First array length was ".concat(e.length,"Second array length was ").concat(t.length));for(var n=e.length,r=0;n>0;)r=Math.random()*n|0,fe(e,--n,r),fe(t,n,r)}function de(e,t,n){return Math.max(e,Math.min(t,n))}function pe(e){return e%2===0?e:e+1}function fe(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function he(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t}function me(e,t){var n=Math.random();return t*n+(1-n)*e}function ve(e,t){for(var n=0,r=0;r<e.length;r++){var a=Number(e[r])-Number(t[r]);n+=a*a}return n}function be(e,t){if(!e)throw new Error("string"==typeof t?t:t())}function ge(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";be(Oe(e,t),(function(){return n+" Shapes ".concat(e," and ").concat(t," must match")}))}function ye(e){be(null!=e,(function(){return"The input to the tensor constructor must be a non-null value."}))}function xe(e){if(0===e.length)return 1;for(var t=e[0],n=1;n<e.length;n++)t*=e[n];return t}function ke(e){return 0===e.length}function we(e,t){if(e===t)return!0;if(null==e||null==t||e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(null!==e[n]&&null!==t[n]&&e[n]!==t[n])return!1;return!0}function Oe(e,t){if(e===t)return!0;if(null==e||null==t||e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function Ie(e){return e%1===0}function Se(e){if(null!=Math.tanh)return Math.tanh(e);if(e===1/0)return 1;if(e===-1/0)return-1;var t=Math.exp(2*e);return(t-1)/(t+1)}function Ne(e){var t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function je(e){for(var t=new Uint32Array(e),n=0;n<e;++n)t[n]=n;return ce(t),t}function Te(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function Ce(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return 0},n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;return new Promise((function(a,i){var o=0;!function s(){if(e())a();else{o++;var u=t(o);null!=n&&o>=n?i():null!=r?r(s,u):setTimeout(s,u)}}()}))}function Ee(e,t){for(var n=1,r=-1,a=0;a<e.length;++a)if(e[a]>=0)n*=e[a];else if(-1===e[a]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. Found -1 at dim ".concat(r," and dim ").concat(a));r=a}else if(e[a]<0)throw Error("Shapes can not be < 0. Found ".concat(e[a]," at dim ").concat(a));if(-1===r){if(t>0&&t!==n)throw Error("Size(".concat(t,") must match the product of shape ").concat(e));return e}if(0===n)throw Error("Cannot infer the missing size in [".concat(e,"] when there are 0 elements"));if(t%n!==0)throw Error("The implicit shape can't be a fractional number. Got ".concat(t," / ").concat(n));var i=e.slice();return i[r]=t/n,i}function _e(e,t){var n=t.length;return be((e=null==e?t.map((function(e,t){return t})):[].concat(e)).every((function(e){return e>=-n&&e<n})),(function(){return"All values in axis param must be in range [-".concat(n,", ").concat(n,") but got axis ").concat(e)})),be(e.every((function(e){return Ie(e)})),(function(){return"All values in axis param must be integers but got axis ".concat(e)})),e.map((function(e){return e<0?n+e:e}))}function Ae(e,t){for(var n=[],r=[],a=null!=t&&Array.isArray(t)&&0===t.length,i=null==t||a?null:_e(t,e).sort(),o=0,s=0;s<e.length;++s){if(null!=i){if(i[o]===s&&1!==e[s])throw new Error("Can't squeeze axis ".concat(s," since its dim '").concat(e[s],"' is not 1"));(null==i[o]||i[o]>s)&&1===e[s]&&(n.push(e[s]),r.push(s)),i[o]<=s&&o++}1!==e[s]&&(n.push(e[s]),r.push(s))}return{newShape:n,keptDims:r}}function Re(e,t){return De(e,t)}function De(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else if("bool"===e)n=new Uint8Array(t);else{if("string"!==e)throw new Error("Unknown data type ".concat(e));n=new Array(t)}return n}function Fe(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type ".concat(t," being uploaded contains ").concat(r,"."))}}function Me(e){return"bool"===e||"complex64"===e||"float32"===e||"int32"===e||"string"===e}function ze(e,t){return!("complex64"===t||"float32"===t&&"complex64"!==e||"int32"===t&&"float32"!==e&&"complex64"!==e||"bool"===t&&"bool"===e)}function Le(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error("Unknown dtype ".concat(e))}function Pe(e){if(null==e)return 0;var t=0;return e.forEach((function(e){return t+=e.length})),t}function Be(e){return"string"==typeof e||e instanceof String}function We(e){return"boolean"==typeof e}function Ue(e){return"number"==typeof e}function Ve(e){return Array.isArray(e)?Ve(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray?"int32":Ue(e)?"float32":Be(e)?"string":We(e)?"bool":"float32"}function Ge(e){return!!(e&&e.constructor&&e.call&&e.apply)}function He(e,t){for(var n=t;n<e;++n)if(e%n===0)return n;return e}function qe(e){var t=e.length;if(t<2)return[];var n=new Array(t-1);n[t-2]=e[t-1];for(var r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function Ke(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=new Array;if(1===t.length)for(var i=t[0]*(r?2:1),o=0;o<i;o++)a[o]=n[e+o];else for(var s=t[0],u=t.slice(1),c=u.reduce((function(e,t){return e*t}))*(r?2:1),l=0;l<s;l++)a[l]=Ke(e+l*c,u,n,r);return a}function Xe(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(0===e.length)return t[0];var r=e.reduce((function(e,t){return e*t}))*(n?2:1);if(0===r)return[];if(r!==t.length)throw new Error("[".concat(e,"] does not match the input size ").concat(t.length).concat(n?" for a complex tensor":"","."));return Ke(0,e,t,n)}function Ye(e,t){if(Array.isArray(e))return e;if("float32"===t)return e instanceof Float32Array?e:new Float32Array(e);if("int32"===t)return e instanceof Int32Array?e:new Int32Array(e);if("bool"===t||"string"===t)return Uint8Array.from(new Int32Array(e));throw new Error("Unknown dtype ".concat(t))}function Ze(e,t){for(var n=Je(e,t),r=0;r<n.length;r++)n[r]=1;return n}function Je(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error("Unknown data type ".concat(t))}function Qe(e,t){var n=e.reduce((function(e,t){return e*t}),1);if(null==t||"float32"===t)return Xe(e,new Float32Array(n));if("int32"===t)return Xe(e,new Int32Array(n));if("bool"===t)return Xe(e,new Uint8Array(n));throw new Error("Unknown data type ".concat(t))}function $e(e){e.forEach((function(t){be(Number.isInteger(t)&&t>=0,(function(){return"Tensor must have a shape comprised of positive integers but got shape [".concat(e,"].")}))}))}function et(e,t,n){if(0===t)return 0;if(1===t)return e[0];for(var r=e[e.length-1],a=0;a<e.length-1;++a)r+=n[a]*e[a];return r}function tt(e,t,n){if(0===t)return[];if(1===t)return[e];for(var r=new Array(t),a=0;a<r.length-1;++a)r[a]=Math.floor(e/n[a]),e-=r[a]*n[a];return r[r.length-1]=e,r}function nt(e){return e&&e.then&&"function"==typeof e.then}var rt="tfjsflags",at=function(){function e(t){Object(O.a)(this,e),this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=it,this.populateURLFlags()}return Object(I.a)(e,[{key:"setPlatform",value:function(e,t){null!=this.platform&&(st().getBool("IS_TEST")||st().getBool("PROD")||console.warn("Platform ".concat(this.platformName," has already been set. Overwriting the platform with ").concat(e,"."))),this.platformName=e,this.platform=t}},{key:"registerFlag",value:function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},null!=this.urlFlags[e]){var r=this.urlFlags[e];st().getBool("IS_TEST")||st().getBool("PROD")||console.warn("Setting feature override from URL ".concat(e,": ").concat(r,".")),this.set(e,r)}}},{key:"getAsync",value:function(){var e=Object(w.a)(k.a.mark((function e(t){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t in this.flags)){e.next=4;break}e.t0=this.flags[t],e.next=8;break;case 4:return e.next=6,this.evaluateFlag(t);case 6:this.flags[t]=e.sent,e.t0=this.flags[t];case 8:return e.abrupt("return",e.t0);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"get",value:function(e){if(e in this.flags)return this.flags[e];var t=this.evaluateFlag(e);if(nt(t))throw new Error("Flag ".concat(e," cannot be synchronously evaluated. Please use getAsync() instead."));return this.flags[e]=t,this.flags[e]}},{key:"getNumber",value:function(e){return this.get(e)}},{key:"getBool",value:function(e){return this.get(e)}},{key:"getString",value:function(e){return this.get(e)}},{key:"getFlags",value:function(){return this.flags}},{key:"set",value:function(e,t){if(null==this.flagRegistry[e])throw new Error("Cannot set flag ".concat(e," as it has not been registered."));this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)}},{key:"evaluateFlag",value:function(e){if(null==this.flagRegistry[e])throw new Error("Cannot evaluate flag '".concat(e,"': no evaluation function found."));return this.flagRegistry[e].evaluationFn()}},{key:"setFlags",value:function(e){this.flags=Object.assign({},e)}},{key:"reset",value:function(){this.flags={},this.urlFlags={},this.populateURLFlags()}},{key:"populateURLFlags",value:function(){var e=this;if("undefined"!=typeof this.global&&"undefined"!=typeof this.global.location&&"undefined"!=typeof this.global.location.search){var t=this.getQueryParams(this.global.location.search);rt in t&&t[rt].split(",").forEach((function(t){var n=t.split(":"),r=Object(y.a)(n,2),a=r[0],i=r[1];e.urlFlags[a]=function(e,t){var n=t.toLowerCase();return"true"===n||"false"===n?"true"===n:"".concat(+n)===n?+n:t}(0,i)}))}}},{key:"features",get:function(){return this.flags}}]),e}();function it(e){var t={};return e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return ot(t,r[0],r[1]),r.join("=")})),t}function ot(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}function st(){return ct}var ut,ct=null;function lt(){if(null==ut){var e;if("undefined"!=typeof window)e=window;else if("undefined"!=typeof i)e=i;else if("undefined"!=typeof r)e=r;else{if("undefined"==typeof self)throw new Error("Could not find a global object");e=self}ut=e}return ut}function dt(e,t){var n=function(){var e=lt();return null==e._tfGlobals&&(e._tfGlobals=new Map),e._tfGlobals}();if(n.has(e))return n.get(e);var r=t();return n.set(e,r),n.get(e)}var pt="Abs",ft="Acos",ht="Acosh",mt="Add",vt="AddN",bt="All",gt="Any",yt="ArgMax",xt="ArgMin",kt="Asin",wt="Asinh",Ot="Atan",It="Atanh",St="Atan2",Nt="AvgPool",jt="AvgPoolGrad",Tt="AvgPool3D",Ct="AvgPool3DGrad",Et="BatchMatMul",_t="BatchToSpaceND",At="Bincount",Rt="BitwiseAnd",Dt="BroadcastTo",Ft="BroadcastArgs",Mt="Cast",zt="Ceil",Lt="ClipByValue",Pt="Complex",Bt="ComplexAbs",Wt="Concat",Ut="Conv2D",Vt="Conv2DBackpropFilter",Gt="Conv2DBackpropInput",Ht="Conv3D",qt="Conv3DBackpropFilterV2",Kt="Conv3DBackpropInputV2",Xt="Cos",Yt="Cosh",Zt="Cumprod",Jt="Cumsum",Qt="CropAndResize",$t="DenseBincount",en="DepthToSpace",tn="DepthwiseConv2dNative",nn="DepthwiseConv2dNativeBackpropFilter",rn="DepthwiseConv2dNativeBackpropInput",an="Diag",on="Dilation2D",sn="Dilation2DBackpropInput",un="Dilation2DBackpropFilter",cn="Draw",ln="RealDiv",dn="Einsum",pn="Elu",fn="EluGrad",hn="Erf",mn="Equal",vn="Exp",bn="ExpandDims",gn="Expm1",yn="FFT",xn="Fill",kn="FlipLeftRight",wn="Floor",On="FloorDiv",In="FusedBatchNorm",Sn="GatherV2",Nn="GatherNd",jn="Greater",Tn="GreaterEqual",Cn="Identity",En="IFFT",_n="Imag",An="IsFinite",Rn="IsInf",Dn="IsNan",Fn="LeakyRelu",Mn="Less",zn="LessEqual",Ln="LinSpace",Pn="Log",Bn="Log1p",Wn="LogicalAnd",Un="LogicalNot",Vn="LogicalOr",Gn="LogicalXor",Hn="LogSoftmax",qn="LowerBound",Kn="LRN",Xn="LRNGrad",Yn="MatrixBandPart",Zn="Max",Jn="Maximum",Qn="MaxPool",$n="MaxPoolGrad",er="MaxPool3D",tr="MaxPool3DGrad",nr="MaxPoolWithArgmax",rr="Mean",ar="Min",ir="Minimum",or="MirrorPad",sr="Mod",ur="Multinomial",cr="Multiply",lr="Neg",dr="NotEqual",pr="NonMaxSuppressionV3",fr="NonMaxSuppressionV4",hr="NonMaxSuppressionV5",mr="OnesLike",vr="OneHot",br="Pack",gr="PadV2",yr="Pool",xr="Pow",kr="Prelu",wr="Prod",Or="RaggedGather",Ir="RaggedRange",Sr="RaggedTensorToTensor",Nr="Range",jr="Real",Tr="Reciprocal",Cr="Relu",Er="Reshape",_r="ResizeNearestNeighbor",Ar="ResizeNearestNeighborGrad",Rr="ResizeBilinear",Dr="ResizeBilinearGrad",Fr="Relu6",Mr="Reverse",zr="Round",Lr="Rsqrt",Pr="ScatterNd",Br="TensorScatterUpdate",Wr="SearchSorted",Ur="Select",Vr="Selu",Gr="Slice",Hr="Sin",qr="Sinh",Kr="Sign",Xr="Sigmoid",Yr="Softplus",Zr="Sqrt",Jr="Sum",Qr="SpaceToBatchND",$r="SplitV",ea="Softmax",ta="SparseFillEmptyRows",na="SparseReshape",ra="SparseSegmentMean",aa="SparseSegmentSum",ia="SparseToDense",oa="SquaredDifference",sa="Square",ua="StaticRegexReplace",ca="StridedSlice",la="StringNGrams",da="StringSplit",pa="StringToHashBucketFast",fa="Sub",ha="Tan",ma="Tanh",va="Tile",ba="TopK",ga="Transform",ya="Transpose",xa="Unique",ka="Unpack",wa="UnsortedSegmentSum",Oa="UpperBound",Ia="ZerosLike",Sa="Step",Na="FromPixels",ja="RotateWithOffset",Ta="_FusedMatMul",Ca="FusedConv2D",Ea="FusedDepthwiseConv2D";function _a(){var e;st().getBool("IS_TEST")||st().getBool("PROD")||(e=console).warn.apply(e,arguments)}function Aa(){var e;st().getBool("IS_TEST")||st().getBool("PROD")||(e=console).log.apply(e,arguments)}var Ra=dt("kernelRegistry",(function(){return new Map})),Da=dt("gradRegistry",(function(){return new Map}));function Fa(e,t){var n=Va(e,t);return Ra.get(n)}function Ma(e){return Da.get(e)}function za(e){for(var t=Ra.entries(),n=[];;){var r=t.next(),a=r.done,i=r.value;if(a)break;var o=Object(y.a)(i,2),s=o[0],u=o[1],c=s.split("_");Object(y.a)(c,1)[0]===e&&n.push(u)}return n}function La(e){var t=e.kernelName,n=e.backendName,r=Va(t,n);Ra.has(r)&&_a("The kernel '".concat(t,"' for backend '").concat(n,"' is already registered")),Ra.set(r,e)}function Pa(e){var t=e.kernelName;Da.has(t)&&st().getBool("DEBUG")&&_a("Overriding the gradient for '".concat(t,"'")),Da.set(t,e)}function Ba(e,t){var n=Va(e,t);if(!Ra.has(n))throw new Error("The kernel '".concat(e,"' for backend '").concat(t,"' is not registered"));Ra.delete(n)}function Wa(e){if(!Da.has(e))throw new Error("The gradient '".concat(e,"' for backend is not registered"));Da.delete(e)}function Ua(e,t){za(e).forEach((function(e){La(Object.assign({},e,{backendName:t}))}))}function Va(e,t){return"".concat(t,"_").concat(e)}var Ga={};function Ha(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray}z(Ga,{arraysEqual:function(){return Oe},arraysEqualWithNull:function(){return we},assert:function(){return be},assertNonNegativeIntegerDimensions:function(){return $e},assertNonNull:function(){return ye},assertShapesMatch:function(){return ge},bytesFromStringArray:function(){return Pe},bytesPerElement:function(){return Le},checkConversionForErrors:function(){return Fe},clamp:function(){return de},computeStrides:function(){return qe},convertBackendValuesAndArrayBuffer:function(){return Ye},createScalarValue:function(){return ci},createShuffledIndices:function(){return je},decodeString:function(){return hi},distSquared:function(){return ve},encodeString:function(){return fi},fetch:function(){return pi},fingerPrint64:function(){return ui},flatten:function(){return vi},getArrayFromDType:function(){return De},getTypedArrayFromDType:function(){return Re},hasEncodingLoss:function(){return ze},hexToLong:function(){return Xa},indexToLoc:function(){return tt},inferDtype:function(){return Ve},inferFromImplicitShape:function(){return Ee},isBoolean:function(){return We},isFunction:function(){return Ge},isInt:function(){return Ie},isNumber:function(){return Ue},isPromise:function(){return nt},isScalarShape:function(){return ke},isString:function(){return Be},isTypedArray:function(){return mi},isValidDtype:function(){return Me},locToIndex:function(){return et},makeOnesTypedArray:function(){return Ze},makeZerosNestedTypedArray:function(){return Qe},makeZerosTypedArray:function(){return Je},nearestDivisor:function(){return He},nearestLargerEven:function(){return pe},now:function(){return di},parseAxisParam:function(){return _e},randUniform:function(){return me},repeatedTry:function(){return Ce},rightPad:function(){return Te},shuffle:function(){return ce},shuffleCombo:function(){return le},sizeFromShape:function(){return xe},sizeToSquarishShape:function(){return Ne},squeezeShape:function(){return Ae},sum:function(){return he},swap:function(){return fe},tanh:function(){return Se},toNestedArray:function(){return Xe},toTypedArray:function(){return li}});var qa=L(P()),Ka=qa.default||qa;function Xa(e){return Ka.fromString(e,!0,16)}var Ya=Xa("c3a5c85c97cb3127"),Za=Xa("b492b66fbe98f273"),Ja=Xa("9ae16a3b2f90404f");function Qa(e){return e.xor(e.shru(47))}function $a(e,t,n){var r=e.slice(t,t+n);return Ka.fromBytes(Array.from(r),!0,!0)}function ei(e,t){return $a(e,t,8)}function ti(e,t){return $a(e,t,4)}function ni(e,t){return 0===t?e:e.shru(t).or(e.shl(64-t))}function ri(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Xa("9ddfea08eb382d69"),r=e.xor(t).mul(n);r=r.xor(r.shru(47));var a=t.xor(r).mul(n);return a=(a=a.xor(a.shru(47))).mul(n)}function ai(e,t,n,r){return function(e,t,n,r,a,i){a=a.add(e),i=ni(i.add(a).add(r),21);var o=a;return a=(a=a.add(t)).add(n),i=i.add(ni(a,44)),[a.add(r),i.add(o)]}(ei(e,t),ei(e,t+8),ei(e,t+16),ei(e,t+24),n,r)}function ii(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length;if(t>=8){var n=Ja.add(2*t),r=ei(e,0).add(Ja),a=ei(e,t-8),i=ni(a,37).mul(n).add(r),o=ni(r,25).add(a).mul(n);return ri(i,o,n)}if(t>=4){var s=Ja.add(2*t),u=ti(e,0);return ri(u.shl(3).add(t),ti(e,t-4),s)}if(t>0){var c=e[0],l=e[t>>1],d=e[t-1],p=c+(l<<8),f=t+(d<<2);return Qa(Ja.mul(p).xor(Ya.mul(f))).mul(Ja)}return Ja}function oi(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length,n=Ja.add(2*t),r=ei(e,0).mul(Za),a=ei(e,8),i=ei(e,t-8).mul(n),o=ei(e,t-16).mul(Ja);return ri(ni(r.add(a),43).add(ni(i,30)).add(o),r.add(ni(a.add(Ja),18)).add(i),n)}function si(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length,n=Ja.add(2*t),r=ei(e,0).mul(Ja),a=ei(e,8),i=ei(e,t-8).mul(n),o=ei(e,t-16).mul(Ja),s=ni(r.add(a),43).add(ni(i,30)).add(o),u=ri(s,r.add(ni(a.add(Ja),18)).add(i),n),c=ei(e,16).mul(n),l=ei(e,24),d=s.add(ei(e,t-32)).mul(n),p=u.add(ei(e,t-24)).mul(n);return ri(ni(c.add(l),43).add(ni(d,30)).add(p),c.add(ni(l.add(r),18)).add(d),n)}function ui(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length,r=Ka.fromNumber(81,!0);if(n<=32)return n<=16?ii(e,n):oi(e,n);if(n<=64)return si(e,n);var a=r,i=r.mul(Za).add(113),o=Qa(i.mul(Ja).add(113)).mul(Ja),s=[Ka.UZERO,Ka.UZERO],u=[Ka.UZERO,Ka.UZERO];a=a.mul(Ja).add(ei(e,0));var c=0,l=64*(n-1>>6),d=l+(n-1&63)-63;do{var p;a=ni(a.add(i).add(s[0]).add(ei(e,c+8)),37).mul(Za),i=ni(i.add(s[1]).add(ei(e,c+48)),42).mul(Za),a=a.xor(u[1]),i=i.add(s[0]).add(ei(e,c+40)),o=ni(o.add(u[0]),33).mul(Za),s=ai(e,c,s[1].mul(Za),a.add(u[0])),u=ai(e,c+32,o.add(u[1]),i.add(ei(e,c+16))),o=(p=[a,o])[0],a=p[1],c+=64}while(c!==l);var f=Za.add(o.and(255).shl(1));return c=d,u[0]=u[0].add(n-1&63),s[0]=s[0].add(u[0]),u[0]=u[0].add(s[0]),a=ni(a.add(i).add(s[0]).add(ei(e,c+8)),37).mul(f),i=ni(i.add(s[1]).add(ei(e,c+48)),42).mul(f),a=a.xor(u[1].mul(9)),i=i.add(s[0].mul(9).add(ei(e,c+40))),o=ni(o.add(u[0]),33).mul(f),s=ai(e,c,s[1].mul(f),a.add(u[0])),u=ai(e,c+32,o.add(u[1]),i.add(ei(e,c+16))),o=(t=[a,o])[0],a=t[1],ri(ri(s[0],u[0],f).add(Qa(i).mul(Ya)).add(o),ri(s[1],u[1],f).add(a),f)}function ci(e,t){return"string"===t?fi(e):li([e],t)}function li(e,t){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=vi(e)),st().getBool("DEBUG")&&Fe(e,t),function(e,t){return e instanceof Float32Array&&"float32"===t||e instanceof Int32Array&&"int32"===t||e instanceof Uint8Array&&"bool"===t}(e,t))return e;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){for(var n=new Uint8Array(e.length),r=0;r<n.length;++r)0!==Math.round(e[r])&&(n[r]=1);return n}throw new Error("Unknown data type ".concat(t))}function di(){return st().platform.now()}function pi(e,t){return st().platform.fetch(e,t)}function fi(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8";return t=t||"utf-8",st().platform.encode(e,t)}function hi(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8";return t=t||"utf-8",st().platform.decode(e,t)}function mi(e){return null!=st().platform.isTypedArray?st().platform.isTypedArray(e):Ha(e)}function vi(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==t&&(t=[]),"boolean"==typeof e||"number"==typeof e||"string"==typeof e||nt(e)||null==e||mi(e)&&n)t.push(e);else if(Array.isArray(e)||mi(e))for(var r=0;r<e.length;++r)vi(e[r],t,n);else{for(var a=-1,i=0,o=Object.keys(e);i<o.length;i++){var s=o[i];/^([1-9]+[0-9]*|0)$/.test(s)&&(a=Math.max(a,Number(s)))}for(var u=0;u<=a;u++)vi(e[u],t,n)}return t}var bi=function(){function e(t,n){Object(O.a)(this,e),this.backendTimer=t,this.logger=n,null==n&&(this.logger=new gi)}return Object(I.a)(e,[{key:"profileKernel",value:function(e,t,n){var r,a,i=function(){r=n()},o=di();if(this.backendTimer.timerAvailable())a=this.backendTimer.time(i);else{i();var s,u=Object(N.a)(r);try{for(u.s();!(s=u.n()).done;){s.value.dataSync()}}catch(d){u.e(d)}finally{u.f()}a=Promise.resolve({kernelMs:di()-o})}if(st().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(var c=function(t){var n=r[t];n.data().then((function(t){!function(e,t,n){if("float32"!==t)return!1;for(var r=0;r<e.length;r++){var a=e[r];if(isNaN(a)||!isFinite(a))return console.warn("Found ".concat(a," in the result of '").concat(n,"'")),!0}}(t,n.dtype,e)}))},l=0;l<r.length;l++)c(l);return{kernelName:e,outputs:r,inputs:t,timeMs:a.then((function(e){return e.kernelMs})),extraInfo:a.then((function(e){return null!=e.getExtraProfileInfo?e.getExtraProfileInfo():""}))}}},{key:"logKernelProfile",value:function(e){var t=this,n=e.kernelName,r=e.outputs,a=e.timeMs,i=e.inputs,o=e.extraInfo;r.forEach((function(e){Promise.all([e.data(),a,o]).then((function(r){t.logger.logKernelProfile(n,e,r[0],r[1],i,r[2])}))}))}}]),e}();var gi=function(){function e(){Object(O.a)(this,e)}return Object(I.a)(e,[{key:"logKernelProfile",value:function(e,t,n,r,a,i){var o="number"==typeof r?Te("".concat(r,"ms"),9):r.error,s=Te(e,25),u=t.rank,c=t.size,l=Te(t.shape.toString(),14),d="";for(var p in a){var f=a[p];if(null!=f){var h=f.shape||t.shape,m=h.length;d+="".concat(p,": ").concat(m,"D ").concat(m>0?h:""," ")}}console.log("%c".concat(s,"\t%c").concat(o,"\t%c").concat(u,"D ").concat(l,"\t%c").concat(c,"\t%c").concat(d,"\t%c").concat(i),"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}]),e}();function yi(e,t,n){for(var r={},a={},i=0;i<t.length;i++)r[t[i].id]=!0;for(var o=0;o<e.length;o++){var s=e[o],u=s.inputs;for(var c in u){for(var l=u[c],d=!1,p=0;p<t.length;p++)if(r[l.id]){s.outputs.forEach((function(e){return r[e.id]=!0})),d=!0,a[s.id]=!0;break}if(d)break}}var f={};f[n.id]=!0;for(var h={},m=e.length-1;m>=0;m--)for(var v=e[m],b=v.inputs,g=0;g<v.outputs.length;g++)if(f[v.outputs[g].id]){for(var y in b)f[b[y].id]=!0,h[v.id]=!0;break}for(var x=[],k=0;k<e.length;k++){var w=e[k];if(a[w.id]&&h[w.id]){var O={};for(var I in w.inputs){var S=w.inputs[I];r[S.id]&&(O[I]=S)}var N=Object.assign({},w);N.inputs=O,N.outputs=w.outputs,x.push(N)}}return x}function xi(e,t,n,r){for(var a=function(a){var i=t[a],o=[];if(i.outputs.forEach((function(t){var n=e[t.id];null!=n?o.push(n):o.push(null)})),null==i.gradient)throw new Error("Cannot compute gradient: gradient function not found for ".concat(i.kernelName,"."));var s=i.gradient(o),u=function(t){if(!(t in s))throw new Error("Cannot backprop through input ".concat(t,". Available gradients found: ").concat(Object.keys(s),"."));var a=n((function(){return s[t]()}));if("float32"!==a.dtype)throw new Error("Error in gradient for op ".concat(i.kernelName,". The gradient of input ").concat(t," must have 'float32' dtype, but has '").concat(a.dtype,"'"));var o=i.inputs[t];if(!Oe(a.shape,o.shape))throw new Error("Error in gradient for op ".concat(i.kernelName,". The gradient of input '").concat(t,"' has shape '").concat(a.shape,"', which does not match the shape of the input '").concat(o.shape,"'"));if(null==e[o.id])e[o.id]=a;else{var u=e[o.id];e[o.id]=r(u,a),u.dispose()}};for(var c in i.inputs)u(c)},i=t.length-1;i>=0;i--)a(i)}function ki(e,t,n,r){var a=qe(t),i=function(e,t,n,r){var a=xe(t),i=r[r.length-1],o=new Array(i).fill(0),s=t.length,u="complex64"===n?Ii(e):e;if(s>1)for(var c=0;c<a/i;c++)for(var l=c*i,d=0;d<i;d++)o[d]=Math.max(o[d],wi(u[l+d],0,n).length);return o}(e,t,n,a),o=t.length,s=function e(t,n,r,a,i){var o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],s="complex64"===r?2:1,u=n[0],c=n.length;if(0===c){if("complex64"===r){var l=Ii(t);return[wi(l[0],0,r)]}return"bool"===r?[Oi(t[0])]:[t[0].toString()]}if(1===c){if(u>20){var d=3*s,p=Array.from(t.slice(0,d)),f=Array.from(t.slice((u-3)*s,u*s));return"complex64"===r&&(p=Ii(p),f=Ii(f)),["["+p.map((function(e,t){return wi(e,i[t],r)})).join(", ")+", ..., "+f.map((function(e,t){return wi(e,i[u-3+t],r)})).join(", ")+"]"]}return["["+("complex64"===r?Ii(t):Array.from(t)).map((function(e,t){return wi(e,i[t],r)})).join(", ")+"]"]}var h=n.slice(1),m=a.slice(1),v=a[0]*s,b=[];if(u>20){for(var g=0;g<3;g++){var y=g*v,x=y+v;b.push.apply(b,Object(S.a)(e(t.slice(y,x),h,r,m,i,!1)))}b.push("...");for(var k=u-3;k<u;k++){var w=k*v,O=w+v;b.push.apply(b,Object(S.a)(e(t.slice(w,O),h,r,m,i,k===u-1)))}}else for(var I=0;I<u;I++){var N=I*v,j=N+v;b.push.apply(b,Object(S.a)(e(t.slice(N,j),h,r,m,i,I===u-1)))}var T=2===c?",":"";b[0]="["+(u>0?b[0]+T:"");for(var C=1;C<b.length-1;C++)b[C]=" "+b[C]+T;for(var E=",\n",_=2;_<c;_++)E+="\n";return b[b.length-1]=" "+b[b.length-1]+"]"+(o?"":E),b}(e,t,n,a,i),u=["Tensor"];return r&&(u.push("  dtype: ".concat(n)),u.push("  rank: ".concat(o)),u.push("  shape: [".concat(t,"]")),u.push("  values:")),u.push(s.map((function(e){return"    "+e})).join("\n")),u.join("\n")}function wi(e,t,n){return Te(Array.isArray(e)?"".concat(parseFloat(e[0].toFixed(7))," + ").concat(parseFloat(e[1].toFixed(7)),"j"):Be(e)?"'".concat(e,"'"):"bool"===n?Oi(e):parseFloat(e.toFixed(7)).toString(),t)}function Oi(e){return 0===e?"false":"true"}function Ii(e){for(var t=[],n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}var Si=function(){function e(t,n,r){var a=this;if(Object(O.a)(this,e),this.dtype=n,this.shape=t.slice(),this.size=xe(t),null!=r){var i=r.length;be(i===this.size,(function(){return"Length of values '".concat(i,"' does not match the size inferred by the shape '").concat(a.size,"'.")}))}if("complex64"===n)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||De(n,this.size),this.strides=qe(t)}return Object(I.a)(e,[{key:"set",value:function(e){for(var t=this,n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];0===r.length&&(r=[0]),be(r.length===this.rank,(function(){return"The number of provided coordinates (".concat(r.length,") must match the rank (").concat(t.rank,")")}));var i=this.locToIndex(r);this.values[i]=e}},{key:"get",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];0===t.length&&(t=[0]);for(var r=0,a=0,i=t;a<i.length;a++){var o=i[a];if(o<0||o>=this.shape[r]){var s="Requested out of range element at ".concat(t,".   Buffer shape=").concat(this.shape);throw new Error(s)}r++}for(var u=t[t.length-1],c=0;c<t.length-1;++c)u+=this.strides[c]*t[c];return this.values[u]}},{key:"locToIndex",value:function(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t}},{key:"indexToLoc",value:function(e){if(0===this.rank)return[];if(1===this.rank)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t}},{key:"toTensor",value:function(){return Ni().makeTensor(this.values,this.shape,this.dtype)}},{key:"rank",get:function(){return this.shape.length}}]),e}(),Ni=null,ji=null;var Ti=function(){function e(t,n,r,a){Object(O.a)(this,e),this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=n||"float32",this.size=xe(t),this.strides=qe(t),this.dataId=r,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}return Object(I.a)(e,[{key:"buffer",value:function(){var e=Object(w.a)(k.a.mark((function e(){var t;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data();case 2:return t=e.sent,e.abrupt("return",ji.buffer(this.shape,this.dtype,t));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"bufferSync",value:function(){return ji.buffer(this.shape,this.dtype,this.dataSync())}},{key:"array",value:function(){var e=Object(w.a)(k.a.mark((function e(){var t;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data();case 2:return t=e.sent,e.abrupt("return",Xe(this.shape,t,"complex64"===this.dtype));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"arraySync",value:function(){return Xe(this.shape,this.dataSync(),"complex64"===this.dtype)}},{key:"data",value:function(){var e=Object(w.a)(k.a.mark((function e(){var t,n;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.throwIfDisposed(),t=Ni().read(this.dataId),"string"!==this.dtype){e.next=13;break}return e.next=5,t;case 5:return n=e.sent,e.prev=6,e.abrupt("return",n.map((function(e){return hi(e)})));case 10:throw e.prev=10,e.t0=e.catch(6),new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().");case 13:return e.abrupt("return",t);case 14:case"end":return e.stop()}}),e,this,[[6,10]])})));return function(){return e.apply(this,arguments)}}()},{key:"dataToGPU",value:function(e){return this.throwIfDisposed(),Ni().readToGPU(this.dataId,e)}},{key:"dataSync",value:function(){this.throwIfDisposed();var e=Ni().readSync(this.dataId);if("string"===this.dtype)try{return e.map((function(e){return hi(e)}))}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}},{key:"bytes",value:function(){var e=Object(w.a)(k.a.mark((function e(){var t;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.throwIfDisposed(),e.next=3,Ni().read(this.dataId);case 3:return t=e.sent,e.abrupt("return","string"===this.dtype?t:new Uint8Array(t.buffer));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"dispose",value:function(){this.isDisposed||(Ni().disposeTensor(this),this.isDisposedInternal=!0)}},{key:"throwIfDisposed",value:function(){if(this.isDisposed)throw new Error("Tensor is disposed.")}},{key:"print",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return ji.print(this,e)}},{key:"clone",value:function(){return this.throwIfDisposed(),ji.clone(this)}},{key:"toString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.dataSync();return ki(t,this.shape,this.dtype,e)}},{key:"cast",value:function(e){return this.throwIfDisposed(),ji.cast(this,e)}},{key:"variable",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;return this.throwIfDisposed(),Ni().makeVariable(this,e,t,n)}},{key:"rank",get:function(){return this.shape.length}},{key:"isDisposed",get:function(){return this.isDisposedInternal}}]),e}();function Ci(){return dt("Tensor",(function(){return Ti}))}Object.defineProperty(Ti,Symbol.hasInstance,{value:function(e){return!!e&&null!=e.data&&null!=e.dataSync&&null!=e.throwIfDisposed}}),Ci();var Ei=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e,r,a,i){var o;return Object(O.a)(this,n),(o=t.call(this,e.shape,e.dtype,e.dataId,i)).trainable=r,o.name=a,o}return Object(I.a)(n,[{key:"assign",value:function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value (".concat(e.dtype,") and previous value (").concat(this.dtype,") must match"));if(!Oe(e.shape,this.shape))throw new Error("shape of the new value (".concat(e.shape,") and previous value (").concat(this.shape,") must match"));Ni().disposeTensor(this),this.dataId=e.dataId,Ni().incRef(this,null)}},{key:"dispose",value:function(){Ni().disposeVariable(this),this.isDisposedInternal=!0}}]),n}(Ti);Object.defineProperty(Ei,Symbol.hasInstance,{value:function(e){return e instanceof Ti&&null!=e.assign&&e.assign instanceof Function}});var _i,Ai,Ri,Di,Fi,Mi={};z(Mi,{assertTypesMatch:function(){return Vi},getTensorsInContainer:function(){return Hi},isTensorInList:function(){return Gi},makeTypesMatch:function(){return Ui}}),function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"}(_i||(_i={})),function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(Ai||(Ai={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(Ri||(Ri={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(Di||(Di={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(Fi||(Fi={}));var zi={float32:Di,int32:Ai,bool:Ri,complex64:Fi};function Li(e,t){if("string"===e||"string"===t){if("string"===e&&"string"===t)return"string";throw new Error("Can not upcast ".concat(e," with ").concat(t))}return zi[e][t]}function Pi(e){return Li(e,"int32")}function Bi(e){return null!=e&&"object"==typeof e&&"texture"in e&&e.texture instanceof WebGLTexture}function Wi(e){return"undefined"!=typeof GPUBuffer&&null!=e&&"object"==typeof e&&"buffer"in e&&e.buffer instanceof GPUBuffer}function Ui(e,t){if(e.dtype===t.dtype)return[e,t];var n=Li(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function Vi(e,t){be(e.dtype===t.dtype,(function(){return"The dtypes of the first(".concat(e.dtype,") and second(").concat(t.dtype,") input must match")}))}function Gi(e,t){return t.some((function(t){return t.id===e.id}))}function Hi(e){var t=[];return function e(t,n,r){if(null==t)return;if(t instanceof Ti)return void n.push(t);if(!function(e){return Array.isArray(e)||"object"==typeof e}(t))return;var a=t;for(var i in a){var o=a[i];r.has(o)||(r.add(o),e(o,n,r))}}(e,t,new Set),t}function qi(e){return null!=e.kernelName}var Ki=function(){function e(){Object(O.a)(this,e),this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map((function(e){return e.name}))))}}}return Object(I.a)(e,[{key:"dispose",value:function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()}}]),e}(),Xi=function(){function e(t){Object(O.a)(this,e),this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Ki}return Object(I.a)(e,[{key:"ready",value:function(){var e=Object(w.a)(k.a.mark((function e(){var t,n,r;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.pendingBackendInit){e.next=2;break}return e.abrupt("return",this.pendingBackendInit.then((function(){})));case 2:if(null==this.backendInstance){e.next=4;break}return e.abrupt("return");case 4:t=this.getSortedBackends(),n=0;case 6:if(!(n<t.length)){e.next=17;break}return r=t[n],e.next=10,this.initializeBackend(r).success;case 10:if(!e.sent){e.next=14;break}return e.next=13,this.setBackend(r);case 13:return e.abrupt("return");case 14:n++,e.next=6;break;case 17:throw new Error("Could not initialize any backends, all backend initializations failed.");case 18:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"backendNames",value:function(){return Object.keys(this.registryFactory)}},{key:"findBackend",value:function(e){if(!(e in this.registry)){if(!(e in this.registryFactory))return null;if(this.initializeBackend(e).asyncInit)return null}return this.registry[e]}},{key:"findBackendFactory",value:function(e){return e in this.registryFactory?this.registryFactory[e].factory:null}},{key:"registerBackend",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return e in this.registryFactory?(_a("".concat(e," backend was already registered. Reusing existing backend factory.")),!1):(this.registryFactory[e]={factory:t,priority:n},!0)}},{key:"setBackend",value:function(){var e=Object(w.a)(k.a.mark((function e(t){var n,r;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=this.registryFactory[t]){e.next=2;break}throw new Error("Backend name '".concat(t,"' not found in registry"));case 2:if(this.backendName=t,null!=this.registry[t]){e.next=14;break}if(this.backendInstance=null,n=this.initializeBackend(t),r=n.success,!n.asyncInit){e.next=11;break}return e.next=8,r;case 8:e.t0=e.sent,e.next=12;break;case 11:e.t0=r;case 12:if(e.t0){e.next=14;break}return e.abrupt("return",!1);case 14:return e.abrupt("return",(this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new bi(this.backendInstance),!0));case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setupRegisteredKernels",value:function(){var e=this;za(this.backendName).forEach((function(t){null!=t.setupFunc&&t.setupFunc(e.backendInstance)}))}},{key:"disposeRegisteredKernels",value:function(e){var t=this;za(e).forEach((function(n){null!=n.disposeFunc&&n.disposeFunc(t.registry[e])}))}},{key:"initializeBackend",value:function(e){var t=this,n=this.registryFactory[e];if(null==n)throw new Error("Cannot initialize backend ".concat(e,", no registration found."));try{var r=n.factory();if(!r||r instanceof se||"function"!=typeof r.then)return this.registry[e]=r,{success:!0,asyncInit:!1};var a=++this.pendingBackendInitId,i=r.then((function(n){return!(a<t.pendingBackendInitId)&&(t.registry[e]=n,t.pendingBackendInit=null,!0)})).catch((function(n){return a<t.pendingBackendInitId||(t.pendingBackendInit=null,_a("Initialization of backend ".concat(e," failed")),_a(n.stack||n.message)),!1}));return this.pendingBackendInit=i,{success:i,asyncInit:!0}}catch(r){return _a("Initialization of backend ".concat(e," failed")),_a(r.stack||r.message),{success:!1,asyncInit:!1}}}},{key:"removeBackend",value:function(e){if(!(e in this.registryFactory))throw new Error("".concat(e," backend not found in registry"));this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}},{key:"getSortedBackends",value:function(){var e=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority}))}},{key:"initializeBackendsAndReturnBest",value:function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],r=this.initializeBackend(n),a=r.success,i=r.asyncInit;if(i||a)return{name:n,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}},{key:"moveData",value:function(e,t){var n=this.state.tensorInfo.get(t),r=n.backend,a=this.readSync(t),i=r.refCount(t);r.disposeData(t,!0),n.backend=e,e.move(t,a,n.shape,n.dtype,i),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}},{key:"tidy",value:function(e,t){var n,r=this,a=null;if(null==t){if("function"!=typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!=typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=e}return this.scopedRun((function(){return r.startScope(a)}),(function(){return r.endScope(n)}),(function(){return(n=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n}))}},{key:"scopedRun",value:function(e,t,n){e();try{var r=n();return t(),r}catch(r){throw t(),r}}},{key:"nextTensorId",value:function(){return e.nextTensorId++}},{key:"nextVariableId",value:function(){return e.nextVariableId++}},{key:"clone",value:function(e){var t=Ji.runKernel(Cn,{x:e}),n={x:e};return this.addTapeNode(this.state.activeScope.name,n,[t],(function(e){return{x:function(){var t={x:e},n={dtype:"float32"};return Ji.runKernel(Mt,t,n)}}}),[],{}),t}},{key:"runKernel",value:function(e,t,n){if(null==this.backendName&&this.backend,null==Fa(e,this.backendName))throw new Error("Kernel '".concat(e,"' not registered for backend '").concat(this.backendName,"'"));return this.runKernelFunc({kernelName:e,inputs:t,attrs:n})}},{key:"shouldCheckForMemLeaks",value:function(){return this.ENV.getBool("IS_TEST")}},{key:"checkKernelForMemLeak",value:function(e,t,n){var r=this.backend.numDataIds(),a=0;n.forEach((function(e){a+="complex64"===e.dtype?3:1}));var i=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],o=r-t-a-i;if(o>0)throw new Error("Backend '".concat(this.backendName,"' has an internal memory leak (").concat(o," data ids) after running '").concat(e,"'"))}},{key:"runKernelFunc",value:function(e){var t,n,r=this,a=[],i=this.isTapeOn(),o=this.state.numBytes,s=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0),null==this.backendName&&this.backend;var u,c=qi(e)?e.kernelName:null!=this.state.activeScope?this.state.activeScope.name:"";if(qi(e)){var l=e.kernelName,d=e.inputs,p=e.attrs;null==this.backendName&&this.backend;var f=Fa(l,this.backendName);be(null!=f,(function(){return"Cannot find registered kernel '".concat(l,"' for backend '").concat(r.backendName,"'")})),n=function(){var e=r.backend.numDataIds();u=f.kernelFunc({inputs:d,attrs:p,backend:r.backend});var t=Array.isArray(u)?u:[u];r.shouldCheckForMemLeaks()&&r.checkKernelForMemLeak(l,e,t);var n=t.map((function(e){return null!=e.rank?e:r.makeTensorFromTensorInfo(e)}));if(i){var o=r.getTensorsForGradient(l,d,n);a=r.saveTensorsForBackwardMode(o)}return n}}else{var h=e.forwardFunc,m=function(e){i&&(a=e.map((function(e){return r.keep(r.clone(e))})))};n=function(){var e=r.backend.numDataIds();u=r.tidy((function(){return h(r.backend,m)}));var t=Array.isArray(u)?u:[u];return r.shouldCheckForMemLeaks()&&r.checkKernelForMemLeak(c,e,t),t}}var v,b=e.inputs,g=e.attrs,y=qi(e)?null:e.backwardsFunc;return this.scopedRun((function(){return r.state.kernelDepth++}),(function(){return r.state.kernelDepth--}),(function(){r.ENV.getBool("DEBUG")||r.state.profiling?(v=r.profiler.profileKernel(c,b,(function(){return n()})),r.ENV.getBool("DEBUG")&&r.profiler.logKernelProfile(v),t=v.outputs):t=n()})),i&&this.addTapeNode(c,b,t,y,a,g),this.state.profiling&&this.state.activeProfile.kernels.push({name:c,bytesAdded:this.state.numBytes-o,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-s,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(b).map((function(e){return null!=b[e]?b[e].shape:null})),outputShapes:t.map((function(e){return e.shape})),kernelTimeMs:v.timeMs,extraInfo:v.extraInfo}),Array.isArray(u)?t:t[0]}},{key:"saveTensorsForBackwardMode",value:function(e){var t=this;return e.map((function(e){return t.keep(t.clone(e))}))}},{key:"getTensorsForGradient",value:function(e,t,n){var r=Ma(e);if(null!=r){var a,i=r.inputsToSave||[],o=r.outputsToSave||[];r.saveAllInputs?(be(Array.isArray(t),(function(){return"saveAllInputs is true, expected inputs to be an array."})),a=Object.keys(t).map((function(e){return t[e]}))):a=i.map((function(e){return t[e]}));var s=n.filter((function(e,t){return o[t]}));return a.concat(s)}return[]}},{key:"makeTensor",value:function(e,t,n,r){if(null==e)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;var a=e;"string"===n&&Be(e[0])&&(a=e.map((function(e){return fi(e)})));var i=r.write(a,t,n),o=new Ti(t,n,i,this.nextTensorId());if(this.trackTensor(o,r),"string"===n){var s=this.state.tensorInfo.get(i),u=Pe(a);this.state.numBytes+=u-s.bytes,s.bytes=u}return o}},{key:"makeTensorFromDataId",value:function(e,t,n,r){var a={dataId:e,shape:t,dtype:n=n||"float32"};return this.makeTensorFromTensorInfo(a,r)}},{key:"makeTensorFromTensorInfo",value:function(e,t){var n=e.dataId,r=e.shape,a=e.dtype,i=new Ti(r,a,n,this.nextTensorId());return this.trackTensor(i,t),i}},{key:"makeVariable",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;n=n||this.nextVariableId().toString(),null!=r&&r!==e.dtype&&(e=e.cast(r));var a=new Ei(e,t,n,this.nextTensorId());if(null!=this.state.registeredVariables[a.name])throw new Error("Variable with name ".concat(a.name," was already registered"));return this.state.registeredVariables[a.name]=a,this.incRef(a,this.backend),a}},{key:"trackTensor",value:function(e,t){this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++;var n=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(n=e.size*Le(e.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:n})),e instanceof Ei||this.track(e)}},{key:"incRef",value:function(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}},{key:"removeDataId",value:function(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}},{key:"disposeTensor",value:function(e){if(this.state.tensorInfo.has(e.dataId)){var t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,"string"===e.dtype&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),"complex64"!==e.dtype&&"string"!==e.dtype){var n=e.size*Le(e.dtype);this.state.numBytes-=n}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}}},{key:"disposeVariables",value:function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}}},{key:"disposeVariable",value:function(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]}},{key:"memory",value:function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}},{key:"profile",value:function(){var e=Object(w.a)(k.a.mark((function e(t){var n,r,a,i,o;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.state.profiling=!0,n=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],e.next=5,t();case 5:this.state.activeProfile.result=e.sent,this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,Object(S.a)(this.state.activeProfile.kernels.map((function(e){return e.totalBytesSnapshot})))),this.state.activeProfile.newBytes=this.state.numBytes-n,this.state.activeProfile.newTensors=this.state.numTensors-r,a=Object(N.a)(this.state.activeProfile.kernels),e.prev=11,a.s();case 13:if((i=a.n()).done){e.next=23;break}return o=i.value,e.next=17,o.kernelTimeMs;case 17:return o.kernelTimeMs=e.sent,e.next=20,o.extraInfo;case 20:o.extraInfo=e.sent;case 21:e.next=13;break;case 23:e.next=28;break;case 25:e.prev=25,e.t0=e.catch(11),a.e(e.t0);case 28:return e.prev=28,a.f(),e.finish(28);case 31:return e.abrupt("return",this.state.activeProfile);case 32:case"end":return e.stop()}}),e,this,[[11,25,28,31]])})));return function(t){return e.apply(this,arguments)}}()},{key:"isTapeOn",value:function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth}},{key:"addTapeNode",value:function(e,t,n,r,a,i){var o=this,s={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:a},u=Ma(e);null!=u&&(r=u.gradFunc),null!=r&&(s.gradient=function(e){return e=e.map((function(e,t){if(null==e){var r=n[t],a=Je(r.size,r.dtype);return o.makeTensor(a,r.shape,r.dtype)}return e})),r(e.length>1?e:e[0],a,i)}),this.state.activeTape.push(s)}},{key:"keep",value:function(e){return e.kept=!0,e}},{key:"startTape",value:function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++}},{key:"endTape",value:function(){this.state.gradientDepth--}},{key:"startScope",value:function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}},{key:"endScope",value:function(e){for(var t=this,n=Hi(e),r=new Set(n.map((function(e){return e.id}))),a=0;a<this.state.activeScope.track.length;a++){var i=this.state.activeScope.track[a];!i.kept&&!r.has(i.id)&&i.dispose()}var o=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach((function(e){!e.kept&&e.scopeId===o.id&&t.track(e)}))}},{key:"gradients",value:function(e,t,n){var r=this,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(be(t.length>0,(function(){return"gradients() received an empty list of xs."})),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '".concat(n.dtype,"'"));var i=this.scopedRun((function(){return r.startTape()}),(function(){return r.endTape()}),(function(){return r.tidy("forward",e)}));be(i instanceof Ti,(function(){return"The result y returned by f() must be a tensor."}));var o=yi(this.state.activeTape,t,i);if(!a&&0===o.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(function(){var e={};e[i.id]=null==n?Yi(i.shape):n,xi(e,o,(function(e){return r.tidy(e)}),Qi);var a=t.map((function(t){return e[t.id]}));return 0===r.state.gradientDepth&&(r.state.activeTape.forEach((function(e){var t,n=Object(N.a)(e.saved);try{for(n.s();!(t=n.n()).done;){t.value.dispose()}}catch(r){n.e(r)}finally{n.f()}})),r.state.activeTape=null),{value:i,grads:a}}))}},{key:"customGrad",value:function(e){var t=this;return be(Ge(e),(function(){return"The f passed in customGrad(f) must be a function."})),function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];be(r.every((function(e){return e instanceof Ti})),(function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"}));var i,o={};r.forEach((function(e,t){o[t]=e}));var s=function(t,n){return be((i=e.apply(void 0,r.concat([n]))).value instanceof Ti,(function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"})),be(Ge(i.gradFunc),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."})),i.value},u=function(e,t){var n=i.gradFunc(e,t),a=Array.isArray(n)?n:[n];be(a.length===r.length,(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."})),be(a.every((function(e){return e instanceof Ti})),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."}));var o={};return a.forEach((function(e,t){o[t]=function(){return e}})),o};return t.runKernelFunc({forwardFunc:s,backwardsFunc:u,inputs:o})}}},{key:"readSync",value:function(e){return this.state.tensorInfo.get(e).backend.readSync(e)}},{key:"read",value:function(e){return this.state.tensorInfo.get(e).backend.read(e)}},{key:"readToGPU",value:function(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}},{key:"time",value:function(){var e=Object(w.a)(k.a.mark((function e(t){var n,r;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=di(),e.next=3,this.backend.time(t);case 3:return r=e.sent,e.abrupt("return",(r.wallMs=di()-n,r));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"track",value:function(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}},{key:"reset",value:function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Ki,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}},{key:"backend",get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '".concat(this.backendName,"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods"));if(null==this.backendInstance){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '".concat(t,"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods"));this.setBackend(t)}return this.backendInstance}},{key:"registeredVariables",get:function(){return this.state.registeredVariables}}]),e}();function Yi(e){var t=Ze(xe(e),"float32");return Ji.makeTensor(t,e,"float32")}function Zi(){var e=lt();if(null==e._tfengine){var t=new at(e);e._tfengine=new Xi(t)}return function(e){ct=e}(e._tfengine.ENV),function(e){Ni=e}((function(){return e._tfengine})),e._tfengine}Xi.nextTensorId=0,Xi.nextVariableId=0;var Ji=Zi();function Qi(e,t){var n={a:e,b:t};return Ji.runKernel(mt,n)}var $i,eo={};function to(e){$i=e}function no(e){if(void 0!==$i)return $i;if(e||"undefined"!=typeof navigator&&null!=navigator){if(e||(e=navigator),"ReactNative"===e.product)return!0;var t=e.userAgent||e.vendor||("undefined"!=typeof window?window.opera:"");if(!t){var n=e;return n.userAgentData&&n.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))}return!1}function ro(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}z(eo,{isBrowser:function(){return ro},isMobile:function(){return no},mockIsMobile:function(){return to}});var ao=st();function io(e,t){var n=e;if(mi(e))return"string"===t?[]:[e.length];if(Bi(e)){var r=e.channels||"RGBA";return[e.height,e.width*r.length]}if(Wi(e))return[e.buffer.size/(null==t?4:Le(t))];if(!Array.isArray(e))return[];for(var a=[];Array.isArray(n)||mi(n)&&"string"!==t;)a.push(n.length),n=n[0];return Array.isArray(e)&&st().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function e(t,n,r){if(r=r||[],!Array.isArray(t)&&!mi(t))return void be(0===n.length,(function(){return"Element arr[".concat(r.join("]["),"] is a primitive, but should be an array/TypedArray of ").concat(n[0]," elements")}));be(n.length>0,(function(){return"Element arr[".concat(r.join("]["),"] should be a primitive, but is an array of ").concat(t.length," elements")})),be(t.length===n[0],(function(){return"Element arr[".concat(r.join("]["),"] should have ").concat(n[0]," elements, but has ").concat(t.length," elements")}));for(var a=n.slice(1),i=0;i<t.length;++i)e(t[i],a,r.concat(i))}(e,a,[]),a}function oo(e,t,n,r){if("string_or_numeric"!==e){if(null==e)throw new Error("Expected dtype cannot be null.");if("numeric"!==e&&e!==t||"numeric"===e&&"string"===t)throw new Error("Argument '".concat(n,"' passed to '").concat(r,"' must be ").concat(e," tensor, but got ").concat(t," tensor"))}}function so(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"numeric";if(e instanceof Ti)return oo(r,e.dtype,t,n),e;var a=Ve(e);if("string"!==a&&["bool","int32","float32"].indexOf(r)>=0&&(a=r),oo(r,a,t,n),null==e||!mi(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e){var i=null==e?"null":e.constructor.name;throw new Error("Argument '".concat(t,"' passed to '").concat(n,"' must be a Tensor or TensorLike, but got '").concat(i,"'"))}var o=io(e,a);!mi(e)&&!Array.isArray(e)&&(e=[e]);var s="string"!==a?li(e,a):vi(e,[],!0);return Ji.makeTensor(s,o,a)}function uo(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"numeric";if(!Array.isArray(e))throw new Error("Argument ".concat(t," passed to ").concat(n," must be a `Tensor[]` or `TensorLike[]`"));return e.map((function(e,a){return so(e,"".concat(t,"[").concat(a,"]"),n,r)}))}ao.registerFlag("DEBUG",(function(){return!1}),(function(e){e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),ao.registerFlag("IS_BROWSER",(function(){return ro()})),ao.registerFlag("IS_NODE",(function(){return"undefined"!=typeof r&&"undefined"!=typeof r.versions&&"undefined"!=typeof r.versions.node})),ao.registerFlag("IS_CHROME",(function(){return"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)})),ao.registerFlag("IS_SAFARI",(function(){return"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor)})),ao.registerFlag("PROD",(function(){return!1})),ao.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(function(){return ao.getBool("DEBUG")})),ao.registerFlag("DEPRECATION_WARNINGS_ENABLED",(function(){return!0})),ao.registerFlag("IS_TEST",(function(){return!1})),ao.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",(function(){return ao.getBool("DEBUG")})),ao.registerFlag("WRAP_TO_IMAGEBITMAP",(function(){return!1})),ao.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",(function(){return!1})),ao.registerFlag("USE_SETTIMEOUTCUSTOM",(function(){return!1}));var co="__op";function lo(e){var t=Object.keys(e);if(1!==t.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with ".concat(t.length," keys."));var n=t[0],r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n+=co;var a=function(){Ji.startScope(n);try{var e=r.apply(void 0,arguments);return nt(e)&&console.error("Cannot return a Promise inside of tidy."),Ji.endScope(e),e}catch(e){throw Ji.endScope(null),e}};return Object.defineProperty(a,"name",{value:n,configurable:!0}),a}var po=lo({complex_:function(e,t){var n=so(e,"real","complex"),r=so(t,"imag","complex");ge(n.shape,r.shape,"real and imag shapes, ".concat(n.shape," and ").concat(r.shape,", must match in call to tf.complex()."));var a={real:n,imag:r};return Ji.runKernel(Pt,a)}});function fo(e,t,n,r){if(null==r)r=Ve(e);else if("complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(Wi(e)||Bi(e)){if("float32"!==r&&"int32"!==r)throw new Error("Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ".concat(r,"."));return Ji.backend.createTensorFromGPUData(e,t||n,r)}if(!mi(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){$e(t);var a=xe(t),i=xe(n);be(a===i,(function(){return"Based on the provided shape, [".concat(t,"], the tensor should have ").concat(a," values but has ").concat(i)}));for(var o=0;o<n.length;++o){var s=n[o],u=o!==n.length-1||s!==xe(t.slice(o));be(n[o]===t[o]||!u,(function(){return"Error creating a new Tensor. Inferred shape (".concat(n,") does not match the provided shape (").concat(t,"). ")}))}}return!mi(e)&&!Array.isArray(e)&&(e=[e]),t=t||n,e="string"!==r?li(e,r):vi(e,[],!0),Ji.makeTensor(e,t,r)}function ho(e,t,n){return fo(e,t,io(e,n),n)}var mo={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8},vo=function(){function e(t){if(Object(O.a)(this,e),this.shards=[],this.previousShardIndex=0,null!=t&&(t instanceof Array||(t=[t]),0!==(t=t.map((function(e){return mi(e)?e.buffer:e}))).length)){this.bufferUniformSize=t[0].byteLength;for(var n=0,r=0;r<t.length;r++){var a=t[r];r!==t.length-1&&a.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);var i=n+a.byteLength;this.shards.push({buffer:a,start:n,end:i}),n=i}0===this.shards.length&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}}return Object(I.a)(e,null,[{key:"join",value:function(t){return new e(t).slice()}}]),Object(I.a)(e,[{key:"slice",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.byteLength;if(0===this.shards.length)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,t=isNaN(Number(t))?0:t,e=Math.max(0,e),(t=Math.min(this.byteLength,t))<=e)return new ArrayBuffer(0);var n=this.findShardForByte(e);if(-1===n)throw new Error("Could not find start shard for byte ".concat(e));for(var r=t-e,a=new ArrayBuffer(r),i=new Uint8Array(a),o=0,s=n;s<this.shards.length;s++){var u=this.shards[s],c=e+o-u.start,l=o,d=Math.min(t,u.end)-u.start,p=new Uint8Array(u.buffer,c,d-c);if(i.set(p,l),o+=p.length,t<u.end)break}return a}},{key:"findShardForByte",value:function(e){if(0===this.shards.length||e<0||e>=this.byteLength)return-1;if(null!=this.bufferUniformSize)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function t(t){return e<t.start?-1:e>=t.end?1:0}if(0===t(this.shards[this.previousShardIndex]))return this.previousShardIndex;var n=function(e,t){for(var n=0,r=e.length;n<=r;){var a=Math.floor((r-n)/2)+n,i=t(e[a]);if(0===i)return a;i<0?r=a:n=a+1}return-1}(this.shards,t);return-1===n?-1:(this.previousShardIndex=n,this.previousShardIndex)}}]),e}();function bo(e,t){return go.apply(this,arguments)}function go(){return(go=Object(w.a)(k.a.mark((function e(t,n){var r,a,i,o,s,u;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=[],a=[],i=Array.isArray(t)?t.map((function(e){return e.name})):Object.keys(t),o=function(e){var o=i[e],s=Array.isArray(t)?t[e].tensor:t[o];if("float32"!==s.dtype&&"int32"!==s.dtype&&"bool"!==s.dtype&&"string"!==s.dtype&&"complex64"!==s.dtype)throw new Error("Unsupported dtype in weight '".concat(o,"': ").concat(s.dtype));var u={name:o,shape:s.shape,dtype:s.dtype};if("string"===s.dtype){var c=new Promise(function(){var e=Object(w.a)(k.a.mark((function e(t){var n,r,a,i,o,u,c;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.bytes();case 2:for(n=e.sent,r=n.reduce((function(e,t){return e+t.length}),0)+4*n.length,a=new Uint8Array(r),i=0,o=0;o<n.length;o++)u=n[o],c=new Uint8Array(new Uint32Array([u.length]).buffer),a.set(c,i),i+=4,a.set(u,i),i+=u.length;t(a);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());a.push(c)}else a.push(s.data());null!=n&&(u.group=n),r.push(u)},s=0;s<i.length;++s)o(s);return e.next=5,Promise.all(a);case 5:return u=e.sent,e.abrupt("return",{data:xo(u),specs:r});case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function yo(e,t){var n,r,a=new vo(e),i={},o=0,s=Object(N.a)(t);try{for(s.s();!(r=s.n()).done;){var u=r.value,c=u.name,l=u.dtype,d=u.shape,p=xe(d),f=void 0;if("quantization"in u){var h=u.quantization;if("uint8"===h.dtype||"uint16"===h.dtype){if(!("min"in h)||!("scale"in h))throw new Error("Weight ".concat(u.name," with quantization ").concat(h.dtype," doesn't have corresponding metadata min and scale."))}else{if("float16"!==h.dtype)throw new Error("Weight ".concat(u.name," has unknown quantization dtype ").concat(h.dtype,". Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'."));if("float32"!==l)throw new Error("Weight ".concat(u.name," is quantized with ").concat(h.dtype," which only supports weights of type float32 not ").concat(l,"."))}var m=mo[h.dtype],v=a.slice(o,o+p*m),b="uint8"===h.dtype?new Uint8Array(v):new Uint16Array(v);if("float32"===l)if("uint8"===h.dtype||"uint16"===h.dtype){f=new Float32Array(b.length);for(var g=0;g<b.length;g++){var y=b[g];f[g]=y*h.scale+h.min}}else{if("float16"!==h.dtype)throw new Error("Unsupported quantization type ".concat(h.dtype," for weight type float32."));void 0===n&&(n=Ro()),f=n(b)}else{if("int32"!==l)throw new Error("Unsupported dtype in weight '".concat(c,"': ").concat(l));if("uint8"!==h.dtype&&"uint16"!==h.dtype)throw new Error("Unsupported quantization type ".concat(h.dtype," for weight type int32."));f=new Int32Array(b.length);for(var x=0;x<b.length;x++){var k=b[x];f[x]=Math.round(k*h.scale+h.min)}}o+=p*m}else if("string"===l){var w=xe(u.shape);f=[];for(var O=0;O<w;O++){var I=new Uint32Array(a.slice(o,o+4))[0];o+=4;var S=new Uint8Array(a.slice(o,o+I));f.push(S),o+=I}}else{var j=mo[l],T=a.slice(o,o+p*j);if("float32"===l)f=new Float32Array(T);else if("int32"===l)f=new Int32Array(T);else if("bool"===l)f=new Uint8Array(T);else{if("complex64"!==l)throw new Error("Unsupported dtype in weight '".concat(c,"': ").concat(l));f=new Float32Array(T);for(var C=new Float32Array(f.length/2),E=new Float32Array(f.length/2),_=0;_<C.length;_++)C[_]=f[2*_],E[_]=f[2*_+1];var A=ho(C,d,"float32"),R=ho(E,d,"float32");i[c]=po(A,R),A.dispose(),R.dispose()}o+=p*j}"complex64"!==l&&(i[c]=ho(f,d,l))}}catch(D){s.e(D)}finally{s.f()}return i}function xo(e){if(null===e)throw new Error("Invalid input value: ".concat(JSON.stringify(e)));var t=0,n=[];e.forEach((function(e){if(t+=e.byteLength,n.push(e.byteLength===e.buffer.byteLength?e:new e.constructor(e)),!(e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: ".concat(e.constructor.name))}));var r=new Uint8Array(t),a=0;return n.forEach((function(e){r.set(new Uint8Array(e.buffer),a),a+=e.byteLength})),r.buffer}var ko="undefined"!=typeof o&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function wo(e){return ko?o.byteLength(e,"utf8"):new Blob([e]).size}function Oo(e){if(ko)return o.from(e).toString("base64");for(var t=new Uint8Array(e),n="",r=0,a=t.length;r<a;r++)n+=String.fromCharCode(t[r]);return btoa(n)}function Io(e){if(ko){var t=o.from(e,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}for(var n=atob(e),r=new Uint8Array(n.length),a=0;a<n.length;++a)r.set([n.charCodeAt(a)],a);return r.buffer}function So(e){return vo.join(e)}function No(e){for(e=e.trim();e.endsWith("/");)e=e.slice(0,e.length-1);var t=e.split("/");return t[t.length-1]}function jo(e,t){var n={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:t};return null!=e.signature&&(n.signature=e.signature),null!=e.userDefinedMetadata&&(n.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(n.modelInitializer=e.modelInitializer),null!=e.initializerSignature&&(n.initializerSignature=e.initializerSignature),null!=e.trainingConfig&&(n.trainingConfig=e.trainingConfig),n}function To(e,t,n){var r={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy};if(null!=e.trainingConfig&&(r.trainingConfig=e.trainingConfig),null!=e.weightsManifest){if(!t)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!n)throw new Error("modelJSON has weightsManifest but weightData is null");r.weightSpecs=t,r.weightData=n}return null!=e.signature&&(r.signature=e.signature),null!=e.userDefinedMetadata&&(r.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(r.modelInitializer=e.modelInitializer),null!=e.initializerSignature&&(r.initializerSignature=e.initializerSignature),r}function Co(e,t){return Eo.apply(this,arguments)}function Eo(){return(Eo=Object(w.a)(k.a.mark((function e(t,n){var r,a,i,o;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=null!=t.weightsManifest,!e.t0){e.next=9;break}return e.next=4,n(t.weightsManifest);case 4:r=e.sent,a=Object(y.a)(r,2),i=a[0],o=a[1];case 9:return e.abrupt("return",To(t,i,o));case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _o(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:wo(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:wo(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:new vo(e.weightData).byteLength}}function Ao(e){var t,n=[],r=Object(N.a)(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;n.push.apply(n,Object(S.a)(a.weights))}}catch(i){r.e(i)}finally{r.f()}return n}function Ro(){var e=function(){var e=function(e){for(var t=e<<13,n=0;!(8388608&t);)n-=8388608,t<<=1;return(t&=-8388609)|(n+=947912704)},t=new Uint32Array(2048);t[0]=0;for(var n=1;n<1024;n++)t[n]=e(n);for(var r=1024;r<2048;r++)t[r]=939524096+(r-1024<<13);return t}(),t=function(){var e=new Uint32Array(64);e[0]=0,e[31]=1199570944,e[32]=2147483648,e[63]=3347054592;for(var t=1;t<31;t++)e[t]=t<<23;for(var n=33;n<63;n++)e[n]=2147483648+(n-32<<23);return e}(),n=function(){for(var e=new Uint32Array(64),t=0;t<64;t++)e[t]=1024;return e[0]=e[32]=0,e}();return function(r){for(var a=new ArrayBuffer(4*r.length),i=new Uint32Array(a),o=0;o<r.length;o++){var s=r[o],u=e[n[s>>10]+(1023&s)]+t[s>>10];i[o]=u}return new Float32Array(a)}}var Do=function(){function e(){Object(O.a)(this,e),this.saveRouters=[],this.loadRouters=[]}return Object(I.a)(e,null,[{key:"getInstance",value:function(){return null==e.instance&&(e.instance=new e),e.instance}},{key:"registerSaveRouter",value:function(t){e.getInstance().saveRouters.push(t)}},{key:"registerLoadRouter",value:function(t){e.getInstance().loadRouters.push(t)}},{key:"getSaveHandlers",value:function(t){return e.getHandlers(t,"save")}},{key:"getLoadHandlers",value:function(t,n){return e.getHandlers(t,"load",n)}},{key:"getHandlers",value:function(t,n,r){var a=[];return("load"===n?e.getInstance().loadRouters:e.getInstance().saveRouters).forEach((function(e){var n=e(t,r);null!==n&&a.push(n)})),a}}]),e}(),Fo=function(e){return Do.registerSaveRouter(e)},Mo=function(e){return Do.registerLoadRouter(e)},zo=function(e){return Do.getSaveHandlers(e)},Lo=function(e,t){return Do.getLoadHandlers(e,t)},Po="tensorflowjs",Bo="models_store",Wo="model_info_store";function Uo(){if(!st().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var e="undefined"==typeof window?self:window,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function Vo(e){var t=e.result;t.createObjectStore(Bo,{keyPath:"modelPath"}),t.createObjectStore(Wo,{keyPath:"modelPath"})}var Go=function(){function e(t){if(Object(O.a)(this,e),this.indexedDB=Uo(),null==t||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}return Object(I.a)(e,[{key:"save",value:function(){var e=Object(w.a)(k.a.mark((function e(t){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=2;break}throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");case 2:return e.abrupt("return",this.databaseAction(this.modelPath,t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=Object(w.a)(k.a.mark((function e(){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.databaseAction(this.modelPath));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"databaseAction",value:function(e,t){var n=this;return new Promise((function(e,r){var a=n.indexedDB.open(Po,1);a.onupgradeneeded=function(){return Vo(a)},a.onsuccess=function(){var i=a.result;if(null==t){var o=i.transaction(Bo,"readonly"),s=o.objectStore(Bo).get(n.modelPath);s.onsuccess=function(){if(null==s.result)return i.close(),r(new Error("Cannot find model with path '".concat(n.modelPath,"' in IndexedDB.")));e(s.result.modelArtifacts)},s.onerror=function(e){return i.close(),r(s.error)},o.oncomplete=function(){return i.close()}}else{t.weightData=vo.join(t.weightData);var u,c,l=_o(t),d=i.transaction(Wo,"readwrite"),p=d.objectStore(Wo);try{u=p.put({modelPath:n.modelPath,modelArtifactsInfo:l})}catch(f){return r(f)}u.onsuccess=function(){var a,o=(c=i.transaction(Bo,"readwrite")).objectStore(Bo);try{a=o.put({modelPath:n.modelPath,modelArtifacts:t,modelArtifactsInfo:l})}catch(s){return r(s)}a.onsuccess=function(){return e({modelArtifactsInfo:l})},a.onerror=function(e){var t=(p=d.objectStore(Wo)).delete(n.modelPath);t.onsuccess=function(){return i.close(),r(a.error)},t.onerror=function(e){return i.close(),r(a.error)}}},u.onerror=function(e){return i.close(),r(u.error)},d.oncomplete=function(){null==c?i.close():c.oncomplete=function(){return i.close()}}}},a.onerror=function(e){return r(a.error)}}))}}]),e}();Go.URL_SCHEME="indexeddb://";var Ho=function(e){return st().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Go.URL_SCHEME)?function(e){return new Go(e)}(e.slice(Go.URL_SCHEME.length)):null};function qo(e){return e.startsWith(Go.URL_SCHEME)?e.slice(Go.URL_SCHEME.length):e}Do.registerSaveRouter(Ho),Do.registerLoadRouter(Ho);var Ko=function(){function e(){Object(O.a)(this,e),this.indexedDB=Uo()}return Object(I.a)(e,[{key:"listModels",value:function(){var e=Object(w.a)(k.a.mark((function e(){var t=this;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=t.indexedDB.open(Po,1);r.onupgradeneeded=function(){return Vo(r)},r.onsuccess=function(){var t=r.result,a=t.transaction(Wo,"readonly"),i=a.objectStore(Wo).getAll();i.onsuccess=function(){var t,n={},r=Object(N.a)(i.result);try{for(r.s();!(t=r.n()).done;){var a=t.value;n[a.modelPath]=a.modelArtifactsInfo}}catch(o){r.e(o)}finally{r.f()}e(n)},i.onerror=function(e){return t.close(),n(i.error)},a.oncomplete=function(){return t.close()}},r.onerror=function(e){return n(r.error)}})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"removeModel",value:function(){var e=Object(w.a)(k.a.mark((function e(t){var n=this;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(t=qo(t),new Promise((function(e,r){var a=n.indexedDB.open(Po,1);a.onupgradeneeded=function(){return Vo(a)},a.onsuccess=function(){var n,i=a.result,o=i.transaction(Wo,"readwrite"),s=o.objectStore(Wo),u=s.get(t);u.onsuccess=function(){if(null==u.result)return i.close(),r(new Error("Cannot find model with path '".concat(t,"' in IndexedDB.")));var a=s.delete(t),o=function(){var a=(n=i.transaction(Bo,"readwrite")).objectStore(Bo).delete(t);a.onsuccess=function(){return e(u.result.modelArtifactsInfo)},a.onerror=function(e){return r(u.error)}};a.onsuccess=o,a.onerror=function(e){return o(),i.close(),r(u.error)}},u.onerror=function(e){return i.close(),r(u.error)},o.oncomplete=function(){null==n?i.close():n.oncomplete=function(){return i.close()}}},a.onerror=function(e){return r(a.error)}}))));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),Xo="/",Yo="tensorflowjs_models",Zo="info",Jo="model_topology",Qo="weight_specs",$o="weight_data",es="model_metadata";function ts(e){return{info:[Yo,e,Zo].join(Xo),topology:[Yo,e,Jo].join(Xo),weightSpecs:[Yo,e,Qo].join(Xo),weightData:[Yo,e,$o].join(Xo),modelMetadata:[Yo,e,es].join(Xo)}}function ns(e){for(var t=0,n=Object.values(e);t<n.length;t++){var r=n[t];window.localStorage.removeItem(r)}}function rs(e){var t=e.split(Xo);if(t.length<3)throw new Error("Invalid key format: ".concat(e));return t.slice(1,t.length-1).join(Xo)}function as(e){return e.startsWith(is.URL_SCHEME)?e.slice(is.URL_SCHEME.length):e}var is=function(){function e(t){if(Object(O.a)(this,e),!st().getBool("IS_BROWSER")||"undefined"==typeof window||"undefined"==typeof window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==t||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=ts(this.modelPath)}return Object(I.a)(e,[{key:"save",value:function(){var e=Object(w.a)(k.a.mark((function e(t){var n,r,a,i,o;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=2;break}throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");case 2:return n=JSON.stringify(t.modelTopology),r=JSON.stringify(t.weightSpecs),a=_o(t),i=vo.join(t.weightData),e.prev=3,this.LS.setItem(this.keys.info,JSON.stringify(a)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,Oo(i)),o={format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,signature:null!=t.signature?t.signature:void 0,userDefinedMetadata:null!=t.userDefinedMetadata?t.userDefinedMetadata:void 0,modelInitializer:null!=t.modelInitializer?t.modelInitializer:void 0,initializerSignature:null!=t.initializerSignature?t.initializerSignature:void 0,trainingConfig:null!=t.trainingConfig?t.trainingConfig:void 0},e.abrupt("return",(this.LS.setItem(this.keys.modelMetadata,JSON.stringify(o)),{modelArtifactsInfo:a}));case 9:throw e.prev=9,e.t0=e.catch(3),ns(this.keys),new Error("Failed to save model '".concat(this.modelPath,"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=").concat(a.modelTopologyBytes,", weightSpecsBytes=").concat(a.weightSpecsBytes,", weightDataBytes=").concat(a.weightDataBytes,"."));case 12:case"end":return e.stop()}}),e,this,[[3,9]])})));return function(t){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=Object(w.a)(k.a.mark((function e(){var t,n,r,a,i,o,s;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(t=JSON.parse(this.LS.getItem(this.keys.info)))){e.next=3;break}throw new Error("In local storage, there is no model with name '".concat(this.modelPath,"'"));case 3:if("JSON"===t.modelTopologyType){e.next=5;break}throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");case 5:if(n={},null!=(r=JSON.parse(this.LS.getItem(this.keys.topology)))){e.next=8;break}throw new Error("In local storage, the topology of model '".concat(this.modelPath,"' is missing."));case 8:if(n.modelTopology=r,null!=(a=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))){e.next=12;break}throw new Error("In local storage, the weight specs of model '".concat(this.modelPath,"' are missing."));case 12:if(n.weightSpecs=a,null!=(i=this.LS.getItem(this.keys.modelMetadata))&&(o=JSON.parse(i),n.format=o.format,n.generatedBy=o.generatedBy,n.convertedBy=o.convertedBy,null!=o.signature&&(n.signature=o.signature),null!=o.userDefinedMetadata&&(n.userDefinedMetadata=o.userDefinedMetadata),null!=o.modelInitializer&&(n.modelInitializer=o.modelInitializer),null!=o.initializerSignature&&(n.initializerSignature=o.initializerSignature),null!=o.trainingConfig&&(n.trainingConfig=o.trainingConfig)),null!=(s=this.LS.getItem(this.keys.weightData))){e.next=18;break}throw new Error("In local storage, the binary weight values of model '".concat(this.modelPath,"' are missing."));case 18:return e.abrupt("return",(n.weightData=Io(s),n));case 19:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}();is.URL_SCHEME="localstorage://";var os=function(e){return st().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(is.URL_SCHEME)?function(e){return new is(e)}(e.slice(is.URL_SCHEME.length)):null};Do.registerSaveRouter(os),Do.registerLoadRouter(os);var ss=function(){function e(){Object(O.a)(this,e),be(st().getBool("IS_BROWSER"),(function(){return"Current environment is not a web browser"})),be("undefined"==typeof window||"undefined"!=typeof window.localStorage,(function(){return"Current browser does not appear to support localStorage"})),this.LS=window.localStorage}return Object(I.a)(e,[{key:"listModels",value:function(){var e=Object(w.a)(k.a.mark((function e(){var t,n,r,a,i,o;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t={},n=Yo+Xo,r=Xo+Zo,a=0;a<this.LS.length;++a)(i=this.LS.key(a)).startsWith(n)&&i.endsWith(r)&&(o=rs(i),t[o]=JSON.parse(this.LS.getItem(i)));return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"removeModel",value:function(){var e=Object(w.a)(k.a.mark((function e(t){var n,r;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=as(t),n=ts(t),null!=this.LS.getItem(n.info)){e.next=4;break}throw new Error("Cannot find model at path '".concat(t,"'"));case 4:return r=JSON.parse(this.LS.getItem(n.info)),e.abrupt("return",(ns(n),r));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),us="://",cs=function(){function e(){Object(O.a)(this,e),this.managers={}}return Object(I.a)(e,null,[{key:"getInstance",value:function(){return null==e.instance&&(e.instance=new e),e.instance}},{key:"registerManager",value:function(t,n){be(null!=t,(function(){return"scheme must not be undefined or null."})),t.endsWith(us)&&(t=t.slice(0,t.indexOf(us))),be(t.length>0,(function(){return"scheme must not be an empty string."}));var r=e.getInstance();be(null==r.managers[t],(function(){return"A model store manager is already registered for scheme '".concat(t,"'.")})),r.managers[t]=n}},{key:"getManager",value:function(t){var n=e.getInstance().managers[t];if(null==n)throw new Error("Cannot find model manager for scheme '".concat(t,"'"));return n}},{key:"getSchemes",value:function(){return Object.keys(e.getInstance().managers)}}]),e}();function ls(e){if(-1===e.indexOf(us))throw new Error("The url string provided does not contain a scheme. Supported schemes are: ".concat(cs.getSchemes().join(",")));return{scheme:e.split(us)[0],path:e.split(us)[1]}}function ds(e,t){return ps.apply(this,arguments)}function ps(){return(ps=Object(w.a)(k.a.mark((function e(t,n){var r,a,i,o,s,u,c,l,d,p,f=arguments;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=f.length>2&&void 0!==f[2]&&f[2],be(t!==n,(function(){return"Old path and new path are the same: '".concat(t,"'")})),be((a=Do.getLoadHandlers(t)).length>0,(function(){return"Copying failed because no load handler is found for source URL ".concat(t,".")})),be(a.length<2,(function(){return"Copying failed because more than one (".concat(a.length,") load handlers for source URL ").concat(t,".")})),i=a[0],be((o=Do.getSaveHandlers(n)).length>0,(function(){return"Copying failed because no save handler is found for destination URL ".concat(n,".")})),be(o.length<2,(function(){return"Copying failed because more than one (".concat(a.length,") save handlers for destination URL ").concat(n,".")})),s=o[0],u=ls(t).scheme,c=ls(t).path,l=u===ls(t).scheme,e.next=12,i.load();case 12:if(d=e.sent,e.t0=r&&l,!e.t0){e.next=17;break}return e.next=17,cs.getManager(u).removeModel(c);case 17:return e.next=19,s.save(d);case 19:if(p=e.sent,e.t1=r&&!l,!e.t1){e.next=24;break}return e.next=24,cs.getManager(u).removeModel(c);case 24:return e.abrupt("return",p.modelArtifactsInfo);case 25:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function fs(){return hs.apply(this,arguments)}function hs(){return(hs=Object(w.a)(k.a.mark((function e(){var t,n,r,a,i,o,s;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=cs.getSchemes(),n={},r=Object(N.a)(t),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=12;break}return i=a.value,e.next=8,cs.getManager(i).listModels();case 8:for(s in o=e.sent)n[i+us+s]=o[s];case 10:e.next=4;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(2),r.e(e.t0);case 17:return e.prev=17,r.f(),e.finish(17);case 20:return e.abrupt("return",n);case 21:case"end":return e.stop()}}),e,null,[[2,14,17,20]])})))).apply(this,arguments)}function ms(e){return vs.apply(this,arguments)}function vs(){return(vs=Object(w.a)(k.a.mark((function e(t){var n;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=ls(t),e.abrupt("return",cs.getManager(n.scheme).removeModel(n.path));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function bs(e,t){return gs.apply(this,arguments)}function gs(){return(gs=Object(w.a)(k.a.mark((function e(t,n){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",ds(t,n,!1));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ys(e,t){return xs.apply(this,arguments)}function xs(){return(xs=Object(w.a)(k.a.mark((function e(t,n){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",ds(t,n,!0));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ks=function(){function e(){Object(O.a)(this,e),this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}return Object(I.a)(e,[{key:"fetch",value:function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,t){return fetch(e,t)}))},{key:"now",value:function(){return performance.now()}},{key:"encode",value:function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Browser's encoder only supports utf-8, but got ".concat(t));return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}},{key:"decode",value:function(e,t){return new TextDecoder(t).decode(e)}},{key:"setTimeoutCustom",value:function(e,t){var n=this;"undefined"!=typeof window&&st().getBool("USE_SETTIMEOUTCUSTOM")?(this.functionRefs.push(e),setTimeout((function(){window.postMessage({name:n.messageName,index:n.functionRefs.length-1},"*")}),t),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",(function(e){e.source===window&&e.data.name===n.messageName&&(e.stopPropagation(),(0,n.functionRefs[e.data.index])(),n.handledMessageCount++,n.handledMessageCount===n.functionRefs.length&&(n.functionRefs=[],n.handledMessageCount=0))}),!0))):setTimeout(e,t)}},{key:"isTypedArray",value:function(e){return Ha(e)}}]),e}();if(st().get("IS_BROWSER")){st().setPlatform("browser",new ks);try{cs.registerManager(is.URL_SCHEME,new ss)}catch(U1){}try{cs.registerManager(Go.URL_SCHEME,new Ko)}catch(U1){}}var ws,Os=function(){return B()},Is=function(){function e(){Object(O.a)(this,e),this.util=W(),this.textEncoder=new this.util.TextEncoder}return Object(I.a)(e,[{key:"fetch",value:function(e,t){return null!=st().global.fetch?st().global.fetch(e,t):(null==ws&&(ws=Os()),ws(e,t))}},{key:"now",value:function(){var e=r.hrtime();return 1e3*e[0]+e[1]/1e6}},{key:"encode",value:function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Node built-in encoder only supports utf-8, but got ".concat(t));return this.textEncoder.encode(e)}},{key:"decode",value:function(e,t){return 0===e.length?"":new this.util.TextDecoder(t).decode(e)}},{key:"isTypedArray",value:function(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}}]),e}();function Ss(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32",n=arguments.length>2?arguments[2]:void 0;return t=t||"float32",$e(e),new Si(e,t,n)}st().get("IS_NODE")&&!st().get("IS_BROWSER")&&st().setPlatform("node",new Is);var Ns=lo({cast_:function(e,t){var n=so(e,"x","cast");if(!Me(t))throw new Error("Failed to cast to unknown dtype ".concat(t));if("string"===t&&"string"!==n.dtype||"string"!==t&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");var r={x:n},a={dtype:t};return Ji.runKernel(Mt,r,a)}});var js=lo({clone_:function(e){var t={x:so(e,"x","clone","string_or_numeric")};return Ji.runKernel(Cn,t)}});function Ts(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];console.log(e.toString(t))}function Cs(){st().set("PROD",!0)}function Es(){st().set("DEBUG",!0)}function _s(){st().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function As(e){st().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function Rs(){Ji.disposeVariables()}function Ds(){return Ji}function Fs(){return Ji.memory()}function Ms(e){return Ji.profile(e)}function zs(e,t){return Ji.tidy(e,t)}function Ls(e){Hi(e).forEach((function(e){return e.dispose()}))}function Ps(e){return Ji.keep(e)}function Bs(e){return Ji.time(e)}function Ws(e){return Ji.setBackend(e)}function Us(){return Ji.ready()}function Vs(){return Ji.backendName}function Gs(e){Ji.removeBackend(e)}function Hs(e){return Ji.findBackend(e)}function qs(e){return Ji.findBackendFactory(e)}function Ks(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Ji.registerBackend(e,t,n)}function Xs(){return Ji.backend}function Ys(e,t){st().setPlatform(e,t)}Zi(),function(e){ji=e}({buffer:Ss,cast:Ns,clone:js,print:Ts}),function(e){e}(As);var Zs=lo({add_:function(e,t){var n=so(e,"a","add"),r=so(t,"b","add"),a=Ui(n,r),i=Object(y.a)(a,2),o={a:n=i[0],b:r=i[1]};return Ji.runKernel(mt,o)}});var Js=lo({floorDiv_:function(e,t){var n=so(e,"a","floorDiv"),r=so(t,"b","floorDiv"),a=Ui(n,r),i=Object(y.a)(a,2),o={a:n=i[0],b:r=i[1]};return Ji.runKernel(On,o)}});var Qs=lo({div_:function(e,t){var n,r,a=so(e,"a","div"),i=so(t,"b","div");if(n=Ui(a,i),a=(r=Object(y.a)(n,2))[0],i=r[1],"int32"===a.dtype&&"int32"===i.dtype)return Js(a,i);var o={a:a,b:i};return Ji.runKernel(ln,o,{})}});var $s=lo({mul_:function(e,t){var n=so(e,"a","mul"),r=so(t,"b","mul"),a=Ui(n,r),i=Object(y.a)(a,2),o={a:n=i[0],b:r=i[1]};return Ji.runKernel(cr,o)}});var eu=lo({abs_:function(e){var t=so(e,"x","abs");if("complex64"===t.dtype){var n={x:t};return Ji.runKernel(Bt,n)}var r={x:t};return Ji.runKernel(pt,r)}});var tu=lo({acos_:function(e){var t={x:so(e,"x","acos")};return Ji.runKernel(ft,t)}});var nu=lo({acosh_:function(e){var t={x:so(e,"x","acosh")};return Ji.runKernel(ht,t)}});var ru=lo({addN_:function(e){be(Array.isArray(e),(function(){return"The argument passed to tf.addN() must be a list of tensors"})),be(e.length>=1,(function(){return"Must pass at least one tensor to tf.addN(), but got ".concat(e.length)}));var t=e.map((function(e,t){return so(e,"tensors".concat(t),"addN")})),n=t[0];t.forEach((function(e){if(e.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")})),t.forEach((function(e){if(!Oe(e.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}));var r=t;return Ji.runKernel(vt,r)}});var au=lo({all_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={x:so(e,"x","all","bool")},a={axis:t,keepDims:n};return Ji.runKernel(bt,r,a)}});var iu=lo({any_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={x:so(e,"x","any","bool")},a={axis:t,keepDims:n};return Ji.runKernel(gt,r,a)}});var ou=lo({argMax_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n={x:so(e,"x","argMax")},r={axis:t};return Ji.runKernel(yt,n,r)}});var su=lo({argMin_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n={x:so(e,"x","argMin")},r={axis:t};return Ji.runKernel(xt,n,r)}});var uu=lo({asin_:function(e){var t={x:so(e,"x","asin")};return Ji.runKernel(kt,t)}});var cu=lo({asinh_:function(e){var t={x:so(e,"x","asinh")};return Ji.runKernel(wt,t)}});var lu=lo({atan_:function(e){var t={x:so(e,"x","atan")};return Ji.runKernel(Ot,t)}});var du=lo({atan2_:function(e,t){var n=so(e,"a","atan2"),r=so(t,"b","atan2"),a=Ui(n,r),i=Object(y.a)(a,2),o={a:n=i[0],b:r=i[1]};return Ji.runKernel(St,o)}});var pu=lo({atanh_:function(e){var t={x:so(e,"x","atanh")};return Ji.runKernel(It,t)}});function fu(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5?arguments[5]:void 0,o=e[3],s=[].concat(Object(S.a)(t),[o]),u=Tu(a);return vu(e,s,n,i,r,null,null,u)}function hu(e,t,n,r,a,i){var o,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"channelsLast",u=yu(t),c=Object(y.a)(u,2),l=c[0],d=c[1];if("channelsLast"===s)o=[l,d,e[3],e[3]];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat ".concat(s));o=[l,d,e[1],e[1]]}return vu(e,o,n,r,a,i,!1,s)}function mu(e,t,n,r,a,i){var o,s,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"NDHWC",c=xu(t),l=Object(y.a)(c,3),d=l[0],p=l[1],f=l[2];if("NDHWC"===u)s="channelsLast",o=[d,p,f,e[4],e[4]];else{if("NCDHW"!==u)throw new Error("Unknown dataFormat ".concat(u));s="channelsFirst",o=[d,p,f,e[1],e[1]]}return bu(e,o,n,r,a,!1,s,i)}function vu(e,t,n,r,a,i){var o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"channelsLast",u=-1,c=-1,l=-1,d=-1;if("channelsLast"===s){var p=Object(y.a)(e,4);u=p[0],c=p[1],l=p[2],d=p[3]}else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat ".concat(s));var f=Object(y.a)(e,4);u=f[0],d=f[1],c=f[2],l=f[3]}var h,m=Object(y.a)(t,4),v=m[0],b=m[1],g=m[3],x=yu(n),k=Object(y.a)(x,2),w=k[0],O=k[1],I=yu(r),S=Object(y.a)(I,2),N=S[0],j=S[1],T=ku(v,N),C=ku(b,j),E=wu(a,c,l,w,O,T,C,i,s),_=E.padInfo,A=E.outHeight,R=E.outWidth,D=o?g*d:g;return"channelsFirst"===s?h=[u,D,A,R]:"channelsLast"===s&&(h=[u,A,R,D]),{batchSize:u,dataFormat:s,inHeight:c,inWidth:l,inChannels:d,outHeight:A,outWidth:R,outChannels:D,padInfo:_,strideHeight:w,strideWidth:O,filterHeight:v,filterWidth:b,effectiveFilterHeight:T,effectiveFilterWidth:C,dilationHeight:N,dilationWidth:j,inShape:e,outShape:h,filterShape:t}}function bu(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"channelsLast",s=arguments.length>7?arguments[7]:void 0,u=-1,c=-1,l=-1,d=-1,p=-1;if("channelsLast"===o){var f=Object(y.a)(e,5);u=f[0],c=f[1],l=f[2],d=f[3],p=f[4]}else{if("channelsFirst"!==o)throw new Error("Unknown dataFormat ".concat(o));var h=Object(y.a)(e,5);u=h[0],p=h[1],c=h[2],l=h[3],d=h[4]}var m,v=Object(y.a)(t,5),b=v[0],g=v[1],x=v[2],k=v[4],w=xu(n),O=Object(y.a)(w,3),I=O[0],S=O[1],N=O[2],j=xu(r),T=Object(y.a)(j,3),C=T[0],E=T[1],_=T[2],A=ku(b,C),R=ku(g,E),D=ku(x,_),F=Ou(a,c,l,d,I,S,N,A,R,D,s),M=F.padInfo,z=F.outDepth,L=F.outHeight,P=F.outWidth,B=i?k*p:k;return"channelsFirst"===o?m=[u,B,z,L,P]:"channelsLast"===o&&(m=[u,z,L,P,B]),{batchSize:u,dataFormat:o,inDepth:c,inHeight:l,inWidth:d,inChannels:p,outDepth:z,outHeight:L,outWidth:P,outChannels:B,padInfo:M,strideDepth:I,strideHeight:S,strideWidth:N,filterDepth:b,filterHeight:g,filterWidth:x,effectiveFilterDepth:A,effectiveFilterHeight:R,effectiveFilterWidth:D,dilationDepth:C,dilationHeight:E,dilationWidth:_,inShape:e,outShape:m,filterShape:t}}function gu(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=ku(t,r);return Math.floor((e[0]*(n-1)-n+a)/2)}function yu(e){return"number"==typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}function xu(e){return"number"==typeof e?[e,e,e]:e}function ku(e,t){return t<=1?e:e+(e-1)*(t-1)}function wu(e,t,n,r,a,i,o,s,u){var c,l,d;if("number"==typeof e){c={top:e,bottom:e,left:e,right:e,type:0===e?"VALID":"NUMBER"};var p=function(e,t,n,r,a){null==r&&(r=gu(e,t,n));var i=e[0],o=e[1];return[Iu((i-t+2*r)/n+1,a),Iu((o-t+2*r)/n+1,a)]}([t,n],i,r,e,s);l=p[0],d=p[1]}else if("same"===e){l=Math.ceil(t/r),d=Math.ceil(n/a);var f=Math.max(0,(l-1)*r+i-t),h=Math.max(0,(d-1)*a+o-n),m=Math.floor(f/2),v=f-m,b=Math.floor(h/2);c={top:m,bottom:v,left:b,right:h-b,type:"SAME"}}else if("valid"===e)c={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((t-i+1)/r),d=Math.ceil((n-o+1)/a);else{if("object"!=typeof e)throw Error("Unknown padding parameter: ".concat(e));var g="channelsLast"===u?e[1][0]:e[2][0],y="channelsLast"===u?e[1][1]:e[2][1],x="channelsLast"===u?e[2][0]:e[3][0],k="channelsLast"===u?e[2][1]:e[3][1];c={top:g,bottom:y,left:x,right:k,type:0===g&&0===y&&0===x&&0===k?"VALID":"EXPLICIT"},l=Iu((t-i+g+y)/r+1,s),d=Iu((n-o+x+k)/a+1,s)}return{padInfo:c,outHeight:l,outWidth:d}}function Ou(e,t,n,r,a,i,o,s,u,c,l){var d,p,f,h;if("valid"===e&&(e=0),"number"==typeof e){d={top:e,bottom:e,left:e,right:e,front:e,back:e,type:0===e?"VALID":"NUMBER"};var m=function(e,t,n,r,a,i){null==a&&(a=gu(e,t[0],r[0]));for(var o=[0,0,0,n],s=0;s<3;s++)e[s]+2*a>=t[s]&&(o[s]=Iu((e[s]-t[s]+2*a)/r[s]+1,i));return o}([t,n,r,1],[s,u,c],1,[a,i,o],e,l);p=m[0],f=m[1],h=m[2]}else{if("same"!==e)throw Error("Unknown padding parameter: ".concat(e));var v=((p=Math.ceil(t/a))-1)*a+s-t,b=((f=Math.ceil(n/i))-1)*i+u-n,g=((h=Math.ceil(r/o))-1)*o+c-r,y=Math.floor(v/2),x=v-y,k=Math.floor(b/2),w=b-k,O=Math.floor(g/2);d={top:k,bottom:w,left:O,right:g-O,front:y,back:x,type:"SAME"}}return{padInfo:d,outDepth:p,outHeight:f,outWidth:h}}function Iu(e,t){if(!t)return Math.trunc(e);switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode ".concat(t))}}function Su(e){var t=yu(e),n=Object(y.a)(t,3),r=n[0],a=n[1],i=n[2];return 1===r&&1===a&&1===i}function Nu(e,t){return Su(e)||Su(t)}function ju(e){return yu(e).every((function(e){return e>0}))}function Tu(e){if("NHWC"===e)return"channelsLast";if("NCHW"===e)return"channelsFirst";throw new Error("Unknown dataFormat ".concat(e))}function Cu(e,t,n){if(null!=n){if("string"==typeof t)throw Error("Error in ".concat(e,": pad must be an integer when using dimRoundingMode ").concat(n," but got pad ").concat(t,"."));if("number"==typeof t)be(Ie(t),(function(){return"Error in ".concat(e,": pad must be an integer when using dimRoundingMode ").concat(n," but got pad ").concat(t,".")}));else{if("object"!=typeof t)throw Error("Error in ".concat(e,": Unknown padding parameter: ").concat(t));t.forEach((function(t){t.forEach((function(t){be(Ie(t),(function(){return"Error in ".concat(e,": pad must be an integer when using dimRoundingMode ").concat(n," but got pad ").concat(t,".")}))}))}))}}}var Eu=lo({reshape_:function(e,t){var n={x:so(e,"x","reshape","string_or_numeric")},r={shape:t};return Ji.runKernel(Er,n,r)}});var _u=lo({avgPool_:function(e,t,n,r,a){var i=so(e,"x","avgPool","float32");be(Nu(n,1),(function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides ".concat(n," and dilations '").concat(1,"'")}));var o=i,s=!1;3===i.rank&&(s=!0,o=Eu(i,[1,i.shape[0],i.shape[1],i.shape[2]])),be(4===o.rank,(function(){return"Error in avgPool: x must be rank 4 but got rank ".concat(o.rank,".")})),Cu("avgPool",r,a);var u={x:o},c={filterSize:t,strides:n,pad:r,dimRoundingMode:a},l=Ji.runKernel(Nt,u,c);return l=Ns(l,i.dtype),s?Eu(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});var Au=lo({avgPool3d_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NDHWC",o=so(e,"x","avgPool3d","float32"),s=o,u=!1;4===o.rank&&(u=!0,s=Eu(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),be(5===s.rank,(function(){return"Error in avgPool3d: x must be rank 5 but got rank ".concat(s.rank,".")})),be("NDHWC"===i,(function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ".concat(i)})),be("number"==typeof n&&n>0||Array.isArray(n)&&n[0]>0&&n[1]>0&&n[2]>0,(function(){return"Error in avgPool3d: Stride must be > 0, but got '".concat(n,"'")})),Cu("avgPool3d",r,a);var c={x:s},l={filterSize:t,strides:n,pad:r,dimRoundingMode:a,dataFormat:i},d=Ji.runKernel(Tt,c,l);return d=Ns(d,s.dtype),u?Eu(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}});var Ru=lo({concat_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;be(e.length>=1,(function(){return"Pass at least one tensor to concat"}));var n=uo(e,"tensors","concat","string_or_numeric");if("complex64"===n[0].dtype&&n.forEach((function(e){if("complex64"!==e.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype ".concat(e.dtype,". "))})),1===n.length)return js(n[0]);var r=n,a={axis:t};return Ji.runKernel(Wt,r,a)}});var Du=lo({matMul_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=so(e,"a","matMul"),i=so(t,"b","matMul"),o=Ui(a,i),s=Object(y.a)(o,2),u={a:a=s[0],b:i=s[1]},c={transposeA:n,transposeB:r};return Ji.runKernel(Et,u,c)}});var Fu=lo({sigmoid_:function(e){var t={x:so(e,"x","sigmoid","float32")};return Ji.runKernel(Xr,t)}});var Mu=lo({slice_:function(e,t,n){var r=so(e,"x","slice","string_or_numeric");if(0===r.rank)throw new Error("Slicing scalar is not possible");var a={x:r},i={begin:t,size:n};return Ji.runKernel(Gr,a,i)}});var zu=lo({tanh_:function(e){var t={x:so(e,"x","tanh","float32")};return Ji.runKernel(ma,t)}});var Lu=lo({basicLSTMCell_:function(e,t,n,r,a,i){var o=so(e,"forgetBias","basicLSTMCell"),s=so(t,"lstmKernel","basicLSTMCell"),u=so(n,"lstmBias","basicLSTMCell"),c=so(r,"data","basicLSTMCell"),l=so(a,"c","basicLSTMCell"),d=so(i,"h","basicLSTMCell"),p=Ru([c,d],1),f=Du(p,s),h=Zs(f,u),m=h.shape[0],v=h.shape[1]/4,b=[m,v],g=Mu(h,[0,0],b),y=Mu(h,[0,v],b),x=Mu(h,[0,2*v],b),k=Mu(h,[0,3*v],b),w=Zs($s(Fu(g),zu(y)),$s(l,Fu(Zs(o,x))));return[w,$s(zu(w),Fu(k))]}});var Pu=lo({batchToSpaceND_:function(e,t,n){var r=so(e,"x","batchToSpaceND"),a=t.reduce((function(e,t){return e*t}));be(r.rank>=1+t.length,(function(){return"input rank is ".concat(r.rank," but should be > than blockShape.length ").concat(t.length)})),be(n.length===t.length,(function(){return"crops.length is ".concat(n.length," but should be equal to blockShape.length  ").concat(t.length)})),be(r.shape[0]%a===0,(function(){return"input tensor batch is ".concat(r.shape[0]," but is not divisible by the product of the elements of blockShape ").concat(t.join(" * ")," === ").concat(a)}));var i={x:r},o={blockShape:t,crops:n};return Ji.runKernel(_t,i,o)}});function Bu(e){return 0===e.rank||1===e.rank?Eu(e,[1,1,1,e.size]):2===e.rank?Eu(e,[1,1,e.shape[0],e.shape[1]]):3===e.rank?Eu(e,[1,e.shape[0],e.shape[1],e.shape[2]]):e}var Wu=lo({batchNorm_:function(e,t,n,r,a,i){null==i&&(i=.001);var o,s,u=so(e,"x","batchNorm"),c=so(t,"mean","batchNorm"),l=so(n,"variance","batchNorm");null!=a&&(o=so(a,"scale","batchNorm")),null!=r&&(s=so(r,"offset","batchNorm")),be(c.rank===l.rank,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),be(null==s||c.rank===s.rank,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),be(null==o||c.rank===o.rank,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}));var d={x:Bu(u),scale:o,offset:s,mean:c,variance:l},p={varianceEpsilon:i},f=Ji.runKernel(In,d,p);return Eu(f,u.shape)}});var Uu=lo({batchNorm2d_:function(e,t,n,r,a,i){var o,s,u=so(e,"x","batchNorm"),c=so(t,"mean","batchNorm"),l=so(n,"variance","batchNorm");return null!=a&&(o=so(a,"scale","batchNorm")),null!=r&&(s=so(r,"offset","batchNorm")),be(2===u.rank,(function(){return"Error in batchNorm2D: x must be rank 2 but got rank ".concat(u.rank,".")})),be(2===c.rank||1===c.rank,(function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ".concat(c.rank,".")})),be(2===l.rank||1===l.rank,(function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ".concat(l.rank,".")})),null!=o&&be(2===o.rank||1===o.rank,(function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ".concat(o.rank,".")})),null!=s&&be(2===s.rank||1===s.rank,(function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ".concat(s.rank,".")})),Wu(u,c,l,s,o,i)}});var Vu=lo({batchNorm3d_:function(e,t,n,r,a,i){var o,s,u=so(e,"x","batchNorm"),c=so(t,"mean","batchNorm"),l=so(n,"variance","batchNorm");return null!=a&&(o=so(a,"scale","batchNorm")),null!=r&&(s=so(r,"offset","batchNorm")),be(3===u.rank,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank ".concat(u.rank,".")})),be(3===c.rank||1===c.rank,(function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ".concat(c.rank,".")})),be(3===l.rank||1===l.rank,(function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ".concat(l.rank,".")})),null!=o&&be(3===o.rank||1===o.rank,(function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ".concat(o.rank,".")})),null!=s&&be(3===s.rank||1===s.rank,(function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ".concat(s.rank,".")})),Wu(u,c,l,s,o,i)}});var Gu=lo({batchNorm4d_:function(e,t,n,r,a,i){var o,s,u=so(e,"x","batchNorm"),c=so(t,"mean","batchNorm"),l=so(n,"variance","batchNorm");return null!=a&&(o=so(a,"scale","batchNorm")),null!=r&&(s=so(r,"offset","batchNorm")),be(4===u.rank,(function(){return"Error in batchNorm4D: x must be rank 4 but got rank ".concat(u.rank,".")})),be(4===c.rank||1===c.rank,(function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ".concat(c.rank,".")})),be(4===l.rank||1===l.rank,(function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ".concat(l.rank,".")})),null!=o&&be(4===o.rank||1===o.rank,(function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ".concat(o.rank,".")})),null!=s&&be(4===s.rank||1===s.rank,(function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ".concat(s.rank,".")})),Wu(u,c,l,s,o,i)}});var Hu=lo({bincount_:function(e,t,n){var r=so(e,"x","bincount"),a=so(t,"weights","bincount");be("int32"===r.dtype,(function(){return"Error in bincount: input dtype must be int32, but got ".concat(r.dtype)})),be(n>=0,(function(){return"size must be non-negative, but got ".concat(n,".")})),be(a.size===r.size||0===a.size,(function(){return"Error in bincount: weights must have the same size as input or0-length, but got input shape: ".concat(r.shape,", weights shape: ").concat(a.shape,".")}));var i={x:r,weights:a},o={size:n};return Ji.runKernel(At,i,o)}});var qu=lo({bitwiseAnd_:function(e,t){var n=so(e,"x","bitwiseAnd"),r=so(t,"y","bitwiseAnd");if(!Oe(n.shape,r.shape))throw new Error("BitwiseAnd: Tensors must have the same shape. x: ".concat(n.shape,", y: ").concat(r.shape));if("int32"!==n.dtype||"int32"!==r.dtype)throw new Error("BitwiseAnd: Only supports 'int32' values in tensor, found type of x: ".concat(n.dtype," and type of y: ").concat(r.dtype));var a={a:n,b:r};return Ji.runKernel(Rt,a)}});var Ku=lo({broadcastArgs_:function(e,t){var n=so(e,"s0","broadcastArgs","int32"),r=so(t,"s1","broadcastArgs","int32");if(1!==n.rank)throw new Error("broadcastArgs(): first input must be a vector (rank=1). Has rank ".concat(n.rank));if(1!==r.rank)throw new Error("broadcastArgs(): second input must be a vector (rank=1). Has rank ".concat(r.rank));var a={s0:n,s1:r};return Ji.runKernel(Ft,a)}});var Xu=lo({broadcastTo_:function(e,t){var n=so(e,"broadcastTo","x"),r=n.shape;if($e(t),t.length<n.rank)throw new Error("broadcastTo(): shape.length=".concat(t.length," < input.rank=").concat(n.rank,"."));if(t.length>n.rank){for(var a=n.shape.slice();a.length<t.length;)a.unshift(1);n=Eu(n,a)}for(var i=n.shape,o=Array.from(t),s=t.length-1;s>=0;s--)if(i[s]===t[s])o[s]=1;else if(1!==n.shape[s])throw new Error("broadcastTo(): [".concat(r,"] cannot be broadcast to [").concat(t,"]."));if(0===o.map((function(e,t){return e>1?t:-1})).filter((function(e){return e>=0})).length)return js(n);var u={x:n},c={reps:o};return Ji.runKernel(va,u,c)}});var Yu=lo({ceil_:function(e){var t={x:so(e,"x","ceil","float32")};return Ji.runKernel(zt,t)}});function Zu(e,t,n){$e(e);var r={shape:e,value:t,dtype:n=n||Ve(t)};return Ji.runKernel(xn,{},r)}var Ju=lo({clipByValue_:function(e,t,n){var r=so(e,"x","clipByValue");if(be(t<=n,(function(){return"Error in clip: min (".concat(t,") must be less than or equal to max (").concat(n,").")})),t===n)return Zu(r.shape,t,r.dtype);var a={x:r},i={clipValueMin:t,clipValueMax:n};return Ji.runKernel(Lt,a,i)}});var Qu=lo({concat1d_:function(e){return Ru(e,0)}});var $u=lo({concat2d_:function(e,t){return Ru(e,t)}});var ec=lo({concat3d_:function(e,t){return Ru(e,t)}});var tc=lo({concat4d_:function(e,t){return Ru(e,t)}});var nc=lo({conv2d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=so(e,"x","conv2d","float32"),u=so(t,"filter","conv2d","float32"),c=s,l=!1;3===s.rank&&(l=!0,c=Eu(s,[1,s.shape[0],s.shape[1],s.shape[2]])),be(4===c.rank,(function(){return"Error in conv2d: input must be rank 4, but got rank ".concat(c.rank,".")})),be(4===u.rank,(function(){return"Error in conv2d: filter must be rank 4, but got rank ".concat(u.rank,".")})),Cu("conv2d",r,o);var d="NHWC"===a?c.shape[3]:c.shape[1];be(d===u.shape[2],(function(){return"Error in conv2d: depth of input (".concat(d,") must match input depth for filter ").concat(u.shape[2],".")})),be(Nu(n,i),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides ".concat(n," and dilations '").concat(i,"'")})),be(ju(i),(function(){return"Error in conv2D: Dilated rates should be larger than 0."})),be(ju(n),(function(){return"Error in conv2D: Strides should be larger than 0."}));var p={x:c,filter:u},f={strides:n,pad:r,dataFormat:a,dilations:i,dimRoundingMode:o},h=Ji.runKernel(Ut,p,f);return l?Eu(h,[h.shape[1],h.shape[2],h.shape[3]]):h}});var rc=lo({conv1d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,o=arguments.length>6?arguments[6]:void 0,s=so(e,"x","conv1d"),u=so(t,"filter","conv1d"),c=s,l=!1;2===s.rank&&(l=!0,c=Eu(s,[1,s.shape[0],s.shape[1]])),be(3===c.rank,(function(){return"Error in conv1d: input must be rank 3, but got rank ".concat(c.rank,".")})),be(3===u.rank,(function(){return"Error in conv1d: filter must be rank 3, but got rank ".concat(u.rank,".")})),Cu("conv1d",r,o),be(c.shape[2]===u.shape[1],(function(){return"Error in conv1d: depth of input (".concat(c.shape[2],") must match input depth for filter ").concat(u.shape[1],".")})),be(Nu(n,i),(function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride ".concat(n," and dilation '").concat(i,"'")})),be(ju(i),(function(){return"Error in conv1D: Dilated rates should be larger than 0."})),be(ju(n),(function(){return"Error in conv1D: Stride should be larger than 0."})),be("NWC"===a,(function(){return"Error in conv1d: got dataFormat of ".concat(a," but only NWC is currently supported.")}));var d=Eu(u,[1,u.shape[0],u.shape[1],u.shape[2]]),p=Eu(c,[c.shape[0],1,c.shape[1],c.shape[2]]),f=nc(p,d,[1,n],r,"NHWC",[1,i],o);return Eu(f,l?[f.shape[2],f.shape[3]]:[f.shape[0],f.shape[2],f.shape[3]])}});var ac=lo({conv2DBackpropInput_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",o=arguments.length>6?arguments[6]:void 0;be(e.length===t.rank,(function(){return"Length of inShape (".concat(e.length,") and rank of dy (").concat(t.rank,") must match")}));var s=e,u=t,c=!1;3===t.rank&&(c=!0,u=Eu(t,[1,t.shape[0],t.shape[1],t.shape[2]]),s=[1,e[0],e[1],e[2]]),be(4===s.length,(function(){return"Error in conv2dDerInput: inShape must be length 4, but got length ".concat(s.length,".")})),be(4===u.rank,(function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank ".concat(u.rank)})),be(4===n.rank,(function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank ".concat(n.rank)}));var l="NHWC"===i?s[3]:s[1],d="NHWC"===i?u.shape[3]:u.shape[1];be(l===n.shape[2],(function(){return"Error in conv2dDerInput: depth of input (".concat(l,") must match input depth for filter ").concat(n.shape[2],".")})),be(d===n.shape[3],(function(){return"Error in conv2dDerInput: depth of output (".concat(d,") must match output depth for filter ").concat(n.shape[3],".")})),Cu("conv2dDerInput",a,o);var p={dy:u,filter:n},f={strides:r,pad:a,dataFormat:i,dimRoundingMode:o,inputShape:s},h=Ji.runKernel(Gt,p,f);return c?Eu(h,[h.shape[1],h.shape[2],h.shape[3]]):h}});var ic=lo({conv2dTranspose_:function(e,t,n,r,a,i){var o=so(e,"x","conv2dTranspose"),s=so(t,"filter","conv2dTranspose");return ac(n,o,s,r,a,"NHWC",i)}});var oc=lo({conv3d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NDHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1,1],o=so(e,"x","conv3d"),s=so(t,"filter","conv3d"),u=o,c=!1;4===o.rank&&(c=!0,u=Eu(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),be(5===u.rank,(function(){return"Error in conv3d: input must be rank 5, but got rank ".concat(u.rank,".")})),be(5===s.rank,(function(){return"Error in conv3d: filter must be rank 5, but got rank ".concat(s.rank,".")})),be(u.shape[4]===s.shape[3],(function(){return"Error in conv3d: depth of input (".concat(u.shape[4],") must match input depth for filter ").concat(s.shape[3],".")})),be(Nu(n,i),(function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides ".concat(n," and dilations '").concat(i,"'")})),be("NDHWC"===a,(function(){return"Error in conv3d: got dataFormat of ".concat(a," but only NDHWC is currently supported.")})),be(ju(i),(function(){return"Error in conv3D: Dilated rates should be larger than 0."})),be(ju(n),(function(){return"Error in conv3D: Strides should be larger than 0."}));var l={x:u,filter:s},d={strides:n,pad:r,dataFormat:a,dilations:i},p=Ji.runKernel(Ht,l,d);return c?Eu(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}});var sc=lo({conv3DBackpropInput_:function(e,t,n,r,a){be(e.length===t.rank,(function(){return"Length of inShape (".concat(e.length,") and rank of dy (").concat(t.rank,") must match")}));var i=e,o=t,s=!1;4===t.rank&&(s=!0,o=Eu(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]),i=[1,e[0],e[1],e[2],e[3]]);var u=i[4],c=o.shape[4];be(5===i.length,(function(){return"Error in conv3dDerInput: inShape must be length 5, but got length ".concat(i.length,".")})),be(5===o.rank,(function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank ".concat(o.rank)})),be(5===n.rank,(function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank ".concat(n.rank)})),be(u===n.shape[3],(function(){return"Error in conv3dDerInput: depth of input (".concat(u,") must match input depth for filter ").concat(n.shape[3],".")})),be(c===n.shape[4],(function(){return"Error in conv3dDerInput: depth of output (".concat(c,") must match output depth for filter ").concat(n.shape[4],".")}));var l={dy:o,filter:n},d={pad:a,strides:r,inputShape:i},p=Ji.runKernel(Kt,l,d);return s?Eu(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}});var uc=lo({conv3dTranspose_:function(e,t,n,r,a){var i=so(e,"x","conv3dTranspose"),o=so(t,"filter","conv3dTranspose");return sc(n,i,o,r,a)}});var cc=lo({cos_:function(e){var t={x:so(e,"x","cos","float32")};return Ji.runKernel(Xt,t)}});var lc=lo({cosh_:function(e){var t={x:so(e,"x","cosh","float32")};return Ji.runKernel(Yt,t)}});var dc=lo({cumprod_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a={x:so(e,"x","cumprod")},i={axis:t,exclusive:n,reverse:r};return Ji.runKernel(Zt,a,i)}});var pc=lo({cumsum_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a={x:so(e,"x","cumsum")},i={axis:t,exclusive:n,reverse:r};return Ji.runKernel(Jt,a,i)}});var fc=lo({denseBincount_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=so(e,"x","denseBincount"),i=so(t,"weights","denseBincount");be("int32"===a.dtype,(function(){return"Error in denseBincount: input dtype must be int32, but got ".concat(a.dtype)})),be(a.rank<=2,(function(){return"Error in denseBincount: input must be at most rank 2, but got rank ".concat(a.rank,".")})),be(n>=0,(function(){return"size must be non-negative, but got ".concat(n,".")})),be(i.size===a.size||0===i.size,(function(){return"Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ".concat(a.shape,", weights shape: ").concat(i.shape,".")}));var o={x:a,weights:i},s={size:n,binaryOutput:r};return Ji.runKernel($t,o,s)}});var hc=lo({depthToSpace_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"NHWC",r=so(e,"x","depthToSpace","float32"),a="NHWC"===n?r.shape[1]:r.shape[2],i="NHWC"===n?r.shape[2]:r.shape[3],o="NHWC"===n?r.shape[3]:r.shape[1];be(t>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: ".concat(t)})),be(a*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n    ".concat(a," and ").concat(t,"  for depthToSpace with input shape\n    ").concat(r.shape)})),be(i*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n    ".concat(i," and ").concat(t," for depthToSpace with input shape\n        ").concat(r.shape)})),be(o%(t*t)===0,(function(){return"Dimension size must be evenly divisible by ".concat(t*t," but is ").concat(o," for depthToSpace with input shape ").concat(r.shape)}));var s={x:r},u={blockSize:t,dataFormat:n};return Ji.runKernel(en,s,u)}});var mc=lo({depthwiseConv2d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=so(e,"x","depthwiseConv2d","float32"),u=so(t,"filter","depthwiseConv2d","float32"),c=s,l=!1;3===s.rank&&(l=!0,c=Eu(s,[1,s.shape[0],s.shape[1],s.shape[2]])),be(4===c.rank,(function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank ".concat(c.rank,".")})),be(4===u.rank,(function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank ".concat(u.rank,".")}));var d="NHWC"===a?c.shape[3]:c.shape[1];be(d===u.shape[2],(function(){return"Error in depthwiseConv2d: number of input channels (".concat(d,") must match the inChannels dimension in filter ").concat(u.shape[2],".")})),Cu("depthwiseConv2d",r,o);var p={x:c,filter:u},f={strides:n,pad:r,dataFormat:a,dilations:i,dimRoundingMode:o},h=Ji.runKernel(tn,p,f);return l?Eu(h,[h.shape[1],h.shape[2],h.shape[3]]):h}});var vc=lo({diag_:function(e){var t={x:so(e,"x","diag")};return Ji.runKernel(an,t)}});var bc=lo({dilation2d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[1,1],i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",o=so(e,"x","dilation2d"),s=so(t,"filter","dilation2d");be(3===o.rank||4===o.rank,(function(){return"Error in dilation2d: input must be rank 3 or 4, but got rank ".concat(o.rank,".")})),be(3===s.rank,(function(){return"Error in dilation2d: filter must be rank 3, but got rank ".concat(s.rank,".")})),be("NHWC"===i,(function(){return"Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ".concat(i)}));var u=o,c=!1;3===o.rank&&(u=Eu(o,[1,o.shape[0],o.shape[1],o.shape[2]]),c=!0),be(u.shape[3]===s.shape[2],(function(){return"Error in dilation2d:  input and filter must have the same depth: ".concat(u.shape[3]," vs ").concat(s.shape[2])}));var l={x:u,filter:s},d={strides:n,pad:r,dilations:a},p=Ji.runKernel(on,l,d);return c?Eu(p,[p.shape[1],p.shape[2],p.shape[3]]):p}}),gc={};function yc(e,t){for(var n=e.length,r=[],a=0;a<n;a++){var i=n-1-a,o=e[i]||1;(t[t.length-1-a]||1)>1&&1===o&&r.unshift(i)}return r}function xc(e,t){for(var n=[],r=0;r<t.length;r++){var a=e[e.length-r-1],i=t.length-r-1,o=t[i];(null==a||1===a&&o>1)&&n.unshift(i)}return n}function kc(e,t){for(var n=Math.max(e.length,t.length),r=new Array(n),a=0;a<n;a++){var i=e[e.length-a-1];null==i&&(i=1);var o=t[t.length-a-1];if(null==o&&(o=1),1===i)r[n-a-1]=o;else if(1===o)r[n-a-1]=i;else{if(i!==o){var s="Operands could not be broadcast together with shapes ".concat(e," and ").concat(t,".");throw Error(s)}r[n-a-1]=i}}return r}z(gc,{assertAndGetBroadcastShape:function(){return kc},getBroadcastDims:function(){return yc},getReductionAxes:function(){return xc}});var wc=lo({equal_:function(e,t){var n,r,a=so(e,"a","equal","string_or_numeric"),i=so(t,"b","equal","string_or_numeric");n=Ui(a,i),a=(r=Object(y.a)(n,2))[0],i=r[1],kc(a.shape,i.shape);var o={a:a,b:i};return Ji.runKernel(mn,o)}});var Oc=lo({where_:function(e,t,n){var r=so(t,"a","where"),a=so(n,"b","where"),i=so(e,"condition","where","bool"),o=kc(kc(i.shape,r.shape),a.shape),s={condition:Xu(i,o),t:Xu(r,o),e:Xu(a,o)};return Ji.runKernel(Ur,s)}});var Ic=lo({zerosLike_:function(e){var t={x:so(e,"x","zerosLike")};return Ji.runKernel(Ia,t)}});var Sc=lo({divNoNan_:function(e,t){var n=so(e,"a","div"),r=so(t,"b","div"),a=Ui(n,r),i=Object(y.a)(a,2);n=i[0],r=i[1];var o=Qs(n,r),s=Ic(o),u=wc(r,s);return Oc(u,s,o)}});var Nc=lo({dot_:function(e,t){var n=so(e,"t1","dot"),r=so(t,"t2","dot");be((1===n.rank||2===n.rank)&&(1===r.rank||2===r.rank),(function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks ".concat(n.rank," and ").concat(r.rank,".")}));var a=1===n.rank?n.size:n.shape[1],i=1===r.rank?r.size:r.shape[0];if(be(a===i,(function(){return"Error in dot: inner dimensions of inputs must match, but got ".concat(a," and ").concat(i,".")})),1===n.rank&&1===r.rank){var o=Eu(n,[1,-1]),s=Eu(r,[-1,1]),u=Du(o,s);return Eu(u,[])}if(1===n.rank&&2===r.rank){var c=Eu(n,[1,-1]),l=Eu(r,[r.shape[0],r.shape[1]]),d=Du(c,l);return Eu(d,[d.size])}if(2===n.rank&&1===r.rank){var p=Eu(r,[-1,1]),f=Du(n,p);return Eu(f,[f.size])}var h=Eu(r,[r.shape[0],r.shape[1]]);return Du(n,h)}});var jc=lo({einsum_:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=n.map((function(e,t){return so(e,"tensors".concat(t),"einsum")})),i={equation:e};return Ji.runKernel(dn,a,i)}});var Tc=lo({elu_:function(e){var t={x:so(e,"x","elu","float32")};return Ji.runKernel(pn,t)}});var Cc=lo({ensureShape_:function(e,t){var n=so(e,"x","ensureShape","string_or_numeric");if(!we(n.shape,t))throw new Error("EnsureShape: Shape of tensor ".concat(n.shape," is not compatible with expected shape ").concat(t));return e}});var Ec=lo({erf_:function(e){var t=so(e,"x","erf");be("int32"===t.dtype||"float32"===t.dtype,(function(){return"Input dtype must be `int32` or `float32`."})),"int32"===t.dtype&&(t=Ns(t,"float32"));var n={x:t};return Ji.runKernel(hn,n)}});function _c(e,t){for(var n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function Ac(e,t,n){for(var r=e.length+t.length,a=[],i=0,o=0,s=0;s<r;s++)-1===n.indexOf(s)?a.push(e[i++]):a.push(t[o++]);return a}function Rc(e,t){for(var n=[],r=e.length,a=0;a<r;a++)-1===t.indexOf(a)&&n.push(e[a]);return[n,t.map((function(t){return e[t]}))]}function Dc(e,t){return Ac(e,t.map((function(e){return 1})),t)}function Fc(e,t,n){be(_c(t,n),(function(){return"".concat(e," supports only inner-most axes for now. Got axes ").concat(t," and rank-").concat(n," input.")}))}function Mc(e,t){if(_c(e,t))return null;for(var n=[],r=0;r<t;++r)-1===e.indexOf(r)&&n.push(r);return e.forEach((function(e){return n.push(e)})),n}function zc(e){return e.map((function(e,t){return[t,e]})).sort((function(e,t){return e[1]-t[1]})).map((function(e){return e[0]}))}function Lc(e,t){for(var n=[],r=t-e;r<t;++r)n.push(r);return n}var Pc=lo({max_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={x:so(e,"x","max")},a={reductionIndices:t,keepDims:n};return Ji.runKernel(Zn,r,a)}});var Bc=lo({min_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={x:so(e,"x","min")},a={axis:t,keepDims:n};return Ji.runKernel(ar,r,a)}});var Wc=lo({pow_:function(e,t){var n=so(e,"base","pow"),r=so(t,"exp","pow"),a=Ui(n,r),i=Object(y.a)(a,2),o={a:n=i[0],b:r=i[1]};return Ji.runKernel(xr,o)}});function Uc(e,t){if((mi(e)&&"string"!==t||Array.isArray(e))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===t&&mi(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return fo(e,[],[],t)}var Vc=lo({sqrt_:function(e){var t={x:so(e,"x","sqrt","float32")};return Ji.runKernel(Zr,t)}});var Gc=lo({square_:function(e){var t=so(e,"x","square");return Ji.runKernel("Square",{x:t},{})}});var Hc=lo({sum_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=so(e,"x","sum");"bool"===r.dtype&&(r=Ns(r,"int32"));var a={x:r},i={axis:t,keepDims:n};return Ji.runKernel(Jr,a,i)}});function qc(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(0===e.rank)return eu(e);if(1!==e.rank&&null===n)return qc(Eu(e,[-1]),t,n);if(1===e.rank||"number"==typeof n||Array.isArray(n)&&1===n.length){if(1===t)return Hc(eu(e),n);if(t===1/0)return Pc(eu(e),n);if(t===-1/0)return Bc(eu(e),n);if("euclidean"===t||2===t)return Vc(Hc(Wc(eu(e),Uc(2,"int32")),n));throw new Error("Error in norm: invalid ord value: ".concat(t))}if(Array.isArray(n)&&2===n.length){if(1===t)return Pc(Hc(eu(e),n[0]),n[1]-1);if(t===1/0)return Pc(Hc(eu(e),n[1]),n[0]);if(t===-1/0)return Bc(Hc(eu(e),n[1]),n[0]);if("fro"===t||"euclidean"===t)return Vc(Hc(Gc(e),n));throw new Error("Error in norm: invalid ord value: ".concat(t))}throw new Error("Error in norm: invalid axis: ".concat(n))}var Kc=lo({norm_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"euclidean",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=qc(e=so(e,"x","norm"),t,n),i=a.shape;if(r){var o=_e(n,e.shape);i=Dc(a.shape,o)}return Eu(a,i)}});var Xc=lo({euclideanNorm_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Kc(e,"euclidean",t,n)}});var Yc=lo({exp_:function(e){var t={x:so(e,"x","exp")};return Ji.runKernel(vn,t)}});var Zc=lo({expandDims_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=so(e,"x","expandDims","string_or_numeric");be(t<=n.rank,(function(){return"Axis must be <= rank of the tensor"}));var r={input:n},a={dim:t};return Ji.runKernel(bn,r,a)}});var Jc=lo({expm1_:function(e){var t={x:so(e,"x","expm1")};return Ji.runKernel(gn,t)}});var Qc=lo({tile_:function(e,t){var n=so(e,"x","tile","string_or_numeric");be(n.rank===t.length,(function(){return"Error in transpose: rank of input ".concat(n.rank," must match length of reps ").concat(t,".")}));var r={x:n},a={reps:t};return Ji.runKernel(va,r,a)}});var $c=lo({eye_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32";null==t&&(t=e);for(var a=Ss([e,t],r),i=e<=t?e:t,o=0;o<i;++o)a.set(1,o,o);var s=Eu(a.toTensor(),[e,t]);if(null==n)return s;if(1===n.length)return Qc(Zc(s,0),[n[0],1,1]);if(2===n.length)return Qc(Zc(Zc(s,0),0),[n[0],n[1],1,1]);if(3===n.length)return Qc(Zc(Zc(Zc(s,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received ".concat(n.length,"D."))}});var el=lo({floor_:function(e){var t={x:so(e,"x","floor","float32")};return Ji.runKernel(wn,t)}});var tl=lo({gather_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=so(e,"x","gather"),i=so(t,"indices","gather","int32"),o={x:a,indices:i},s={axis:n,batchDims:r};return Ji.runKernel(Sn,o,s)}});var nl=lo({greater_:function(e,t){var n,r,a=so(e,"a","greater","string_or_numeric"),i=so(t,"b","greater","string_or_numeric");n=Ui(a,i),a=(r=Object(y.a)(n,2))[0],i=r[1],kc(a.shape,i.shape);var o={a:a,b:i};return Ji.runKernel(jn,o)}});var rl=lo({greaterEqual_:function(e,t){var n,r,a=so(e,"a","greaterEqual","string_or_numeric"),i=so(t,"b","greaterEqual","string_or_numeric");n=Ui(a,i),a=(r=Object(y.a)(n,2))[0],i=r[1],kc(a.shape,i.shape);var o={a:a,b:i};return Ji.runKernel(Tn,o)}});var al=lo({imag_:function(e){var t={input:so(e,"input","imag")};return Ji.runKernel(_n,t)}});var il=lo({isFinite_:function(e){var t={x:so(e,"x","isFinite")};return Ji.runKernel(An,t)}});var ol=lo({isInf_:function(e){var t={x:so(e,"x","isInf")};return Ji.runKernel(Rn,t)}});var sl=lo({isNaN_:function(e){var t={x:so(e,"x","isNaN")};return Ji.runKernel(Dn,t)}});var ul=lo({leakyRelu_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2,n={x:so(e,"x","leakyRelu")},r={alpha:t};return Ji.runKernel(Fn,n,r)}});var cl=lo({less_:function(e,t){var n,r,a=so(e,"a","less","string_or_numeric"),i=so(t,"b","less","string_or_numeric");n=Ui(a,i),a=(r=Object(y.a)(n,2))[0],i=r[1],kc(a.shape,i.shape);var o={a:a,b:i};return Ji.runKernel(Mn,o)}});var ll=lo({lessEqual_:function(e,t){var n,r,a=so(e,"a","lessEqual","string_or_numeric"),i=so(t,"b","lessEqual","string_or_numeric");n=Ui(a,i),a=(r=Object(y.a)(n,2))[0],i=r[1],kc(a.shape,i.shape);var o={a:a,b:i};return Ji.runKernel(zn,o)}});function dl(e,t,n){if(n<=0)throw new Error("The number of values should be positive.");var r={start:e,stop:t,num:n};return Ji.runKernel(Ln,{},r)}var pl=lo({localResponseNormalization_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5,i=so(e,"x","localResponseNormalization");be(4===i.rank||3===i.rank,(function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank ".concat(i.rank,".")})),be(Ie(t),(function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ".concat(t,".")}));var o=i,s=!1;3===i.rank&&(s=!0,o=Eu(i,[1,i.shape[0],i.shape[1],i.shape[2]]));var u={x:o},c={depthRadius:t,bias:n,alpha:r,beta:a},l=Ji.runKernel(Kn,u,c);return s?Eu(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});var fl=lo({log_:function(e){var t={x:so(e,"x","log","float32")};return Ji.runKernel(Pn,t)}});var hl=lo({log1p_:function(e){var t={x:so(e,"x","log1p")};return Ji.runKernel(Bn,t)}});function ml(e){return be(Ge(e),(function(){return"The f passed in grad(f) must be a function"})),function(t,n){var r=so(t,"x","tf.grad","string_or_numeric"),a=null!=n?so(n,"dy","tf.grad"):null;return Ji.tidy((function(){var t=Ji.gradients((function(){return e(r)}),[r],a),n=t.value,i=t.grads;return null!=a&&ge(n.shape,a.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),kl(i),i[0]}))}}function vl(e){return be(Ge(e),(function(){return"The f passed in grads(f) must be a function"})),function(t,n){be(Array.isArray(t),(function(){return"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s"}));var r=uo(t,"args","tf.grads","string_or_numeric"),a=null!=n?so(n,"dy","tf.grads"):null;return Ji.tidy((function(){var t=Ji.gradients((function(){return e.apply(void 0,Object(S.a)(r))}),r,a),n=t.value,i=t.grads;return null!=a&&ge(n.shape,a.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),kl(i),i}))}}function bl(e){return be(Ge(e),(function(){return"The f passed in valueAndGrad(f) must be a function"})),function(t,n){be(t instanceof Ti,(function(){return"The x passed in valueAndGrad(f)(x) must be a tensor"})),be(null==n||n instanceof Ti,(function(){return"The dy passed in valueAndGrad(f)(x, dy) must be a tensor"}));var r=Ji.gradients((function(){return e(t)}),[t],n),a=r.grads,i=r.value;return kl(a),{grad:a[0],value:i}}}function gl(e){return be(Ge(e),(function(){return"The f passed in valueAndGrads(f) must be a function"})),function(t,n){be(Array.isArray(t)&&t.every((function(e){return e instanceof Ti})),(function(){return"The args passed in valueAndGrads(f)(args) must be array of tensors"})),be(null==n||n instanceof Ti,(function(){return"The dy passed in valueAndGrads(f)(args, dy) must be a tensor"}));var r=Ji.gradients((function(){return e.apply(void 0,Object(S.a)(t))}),t,n);return null!=n&&ge(r.value.shape,n.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),kl(r.grads),r}}function yl(e,t){be(Ge(e),(function(){return"The f passed in variableGrads(f) must be a function"})),be(null==t||Array.isArray(t)&&t.every((function(e){return e instanceof Ei})),(function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"}));var n=null!=t;if(!n)for(var r in t=[],Ji.registeredVariables)t.push(Ji.registeredVariables[r]);var a=n?t.filter((function(e){return!e.trainable})):null,i=t.length;be((t=t.filter((function(e){return e.trainable}))).length>0,(function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the ".concat(i," variables is trainable.")}));var o=Ji.gradients(e,t,null,!0),s=o.value,u=o.grads;be(u.some((function(e){return null!=e})),(function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."})),be(0===s.rank,(function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-".concat(s.rank," tensor")}));var c={};return t.forEach((function(e,t){null!=u[t]&&(c[e.name]=u[t])})),null!=a&&a.forEach((function(e){return c[e.name]=null})),{value:s,grads:c}}function xl(e){return Ji.customGrad(e)}function kl(e){if(e.filter((function(e){return null==e})).length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that\n    the f you passed encloses all operations that lead from x to y.")}var wl=lo({neg_:function(e){var t={x:so(e,"x","neg")};return Ji.runKernel(lr,t)}});var Ol=lo({softplus_:function(e){var t={x:so(e,"x","softplus")};return Ji.runKernel(Yr,t)}});var Il=lo({logSigmoid_:function(e){var t=so(e,"x","logSigmoid");return xl((function(e){return{value:wl(Ol(wl(e))),gradFunc:function(t){return $s(t,Fu(wl(e)))}}}))(t)}});var Sl=lo({sub_:function(e,t){var n=so(e,"a","sub"),r=so(t,"b","sub"),a=Ui(n,r),i=Object(y.a)(a,2),o={a:n=i[0],b:r=i[1]};return Ji.runKernel(fa,o)}});var Nl=lo({logSoftmax_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=so(e,"logits","logSoftmax");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank ".concat(n.rank," and axis was ").concat(t));return xl((function(e,n){var r=Pc(e,t,!0),a=Sl(e,r),i=Sl(Ns(a,"float32"),fl(Hc(Yc(a),t,!0)));return n([i]),{value:i,gradFunc:function(e,n){var r=Object(y.a)(n,1)[0],a=Yc(r);return Sl(e,$s(Hc(e,t,!0),a))}}}))(n)}});var jl=lo({logSumExp_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=so(e,"x","logSumExp"),a=_e(t,r.shape),i=Pc(r,a,!0),o=Sl(r,i),s=Yc(o),u=Hc(s,a),c=fl(u),l=Zs(Eu(i,c.shape),c);if(n){var d=Dc(l.shape,a);return Eu(l,d)}return l}});var Tl=lo({logicalAnd_:function(e,t){var n=so(e,"a","logicalAnd","bool"),r=so(t,"b","logicalAnd","bool");kc(n.shape,r.shape);var a={a:n,b:r};return Ji.runKernel(Wn,a)}});var Cl=lo({logicalNot_:function(e){var t={x:so(e,"x","logicalNot","bool")};return Ji.runKernel(Un,t)}});var El=lo({logicalOr_:function(e,t){var n=so(e,"a","logicalOr","bool"),r=so(t,"b","logicalOr","bool");kc(n.shape,r.shape);var a={a:n,b:r};return Ji.runKernel(Vn,a)}});var _l=lo({logicalXor_:function(e,t){var n=so(e,"a","logicalXor","bool"),r=so(t,"b","logicalXor","bool");return kc(n.shape,r.shape),Tl(El(e,t),Cl(Tl(e,t)))}}),Al=2147483648;var Rl=lo({searchSorted_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"left",r=so(e,"sortedSequence","searchSorted"),a=so(t,"values","searchSorted"),i=r.shape[r.shape.length-1],o=a.shape[a.shape.length-1],s=Eu(r,[-1,i]),u=Eu(a,[-1,o]);if(s.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(s.shape[0]!==u.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(xe(u.shape)>=Al)throw new Error("values tensor size must less than ".concat(Al));if(s.shape[1]>=Al)throw new Error("trailing dim_size must less than ".concat(Al," for int32 output type, was ").concat(s.shape[1]));var c={sortedSequence:s,values:u},l={side:n};return Ji.runKernel(Wr,c,l)}});function Dl(e,t){return Rl(e,t,"left")}var Fl=lo({maxPool_:function(e,t,n,r,a){var i=so(e,"x","maxPool"),o=i,s=!1;3===i.rank&&(s=!0,o=Eu(i,[1,i.shape[0],i.shape[1],i.shape[2]])),be(4===o.rank,(function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(o.rank,".")})),be(Nu(n,1),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides ".concat(n," and dilations '").concat(1,"'")})),Cu("maxPool",r,a);var u={x:o},c={filterSize:t,strides:n,pad:r,dimRoundingMode:a},l=Ji.runKernel(Qn,u,c);return s?Eu(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});var Ml=lo({maxPool3d_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[1,1,1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NDHWC",o=so(e,"x","maxPool3d"),s=o,u=!1;4===o.rank&&(u=!0,s=Eu(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),be(5===s.rank,(function(){return"Error in maxPool3d: x must be rank 5 but got rank ".concat(s.rank,".")})),be("NDHWC"===i,(function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ".concat(i)})),Cu("maxPool3d",r,a);var c={x:s},l={filterSize:t,strides:n,pad:r,dimRoundingMode:a,dataFormat:i},d=Ji.runKernel(er,c,l);return u?Eu(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}});var zl=lo({maxPoolWithArgmax_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i={x:so(e,"x","maxPoolWithArgmax")},o={filterSize:t,strides:n,pad:r,includeBatchInIndex:a},s=Ji.runKernel(nr,i,o);return{result:s[0],indexes:s[1]}}});var Ll=lo({maximum_:function(e,t){var n,r,a=so(e,"a","maximum"),i=so(t,"b","maximum");n=Ui(a,i),a=(r=Object(y.a)(n,2))[0],i=r[1],"bool"===a.dtype&&(a=Ns(a,"int32"),i=Ns(i,"int32")),kc(a.shape,i.shape);var o={a:a,b:i};return Ji.runKernel(Jn,o)}});var Pl=lo({mean_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={x:so(e,"x","mean")},a={axis:t,keepDims:n};return Ji.runKernel(rr,r,a)}});function Bl(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32";if($e(e),"complex64"===t){var n=Bl(e,"float32"),r=Bl(e,"float32");return po(n,r)}var a=Je(xe(e),t);return Ji.makeTensor(a,e,t)}function Wl(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32";if($e(e),"complex64"===t){var n=Wl(e,"float32"),r=Bl(e,"float32");return po(n,r)}var a=Ze(xe(e),t);return Ji.makeTensor(a,e,t)}function Ul(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.indexing,a=void 0===r?"xy":r;if("xy"!==a&&"ij"!==a)throw new TypeError("".concat(a," is not a valid third argument to meshgrid"));if(void 0===e)return[];var i=so(e,"x","meshgrid",e instanceof Ti?e.dtype:"float32");if(void 0===t)return[i];var o=so(t,"y","meshgrid",t instanceof Ti?t.dtype:"float32"),s=xe(i.shape),u=xe(o.shape);return"xy"===a?(i=Eu(i,[1,-1]),o=Eu(o,[-1,1]),[Du(Wl([u,1],i.dtype),i),Du(o,Wl([1,s],o.dtype))]):(i=Eu(i,[-1,1]),o=Eu(o,[1,-1]),[Du(i,Wl([1,u],i.dtype)),Du(Wl([s,1],o.dtype),o)])}var Vl=lo({minimum_:function(e,t){var n,r,a=so(e,"a","minimum"),i=so(t,"b","minimum");n=Ui(a,i),a=(r=Object(y.a)(n,2))[0],i=r[1],"bool"===a.dtype&&(a=Ns(a,"int32"),i=Ns(i,"int32")),kc(a.shape,i.shape);var o={a:a,b:i};return Ji.runKernel(ir,o)}});var Gl=lo({mirrorPad_:function(e,t,n){be("reflect"===n||"symmetric"===n,(function(){return"Invalid mode. Mode must be either reflect or symmetric. Got ".concat(n,".")}));var r=so(e,"x","mirrorPad");if(0===r.rank)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");be(t.length===r.rank,(function(){return"Padding doesn't match input. Must be ".concat(r.rank,". Got ").concat(t.length,".")}));for(var a="reflect"===n?1:0,i=function(e){be(2===t[e].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),be(t[e][0]>=0&&t[e][0]<=r.shape[e]-a&&t[e][1]>=0&&t[e][1]<=r.shape[e]-a,(function(){return"Padding in dimension ".concat(e," cannot be greater than or equal to ").concat(r.shape[e]-a," or less than 0 for input of shape ").concat(r.shape)}))},o=0;o<r.rank;o++)i(o);var s={paddings:t,mode:n},u={x:r};return Ji.runKernel(or,u,s)}});var Hl=lo({mod_:function(e,t){var n=so(e,"a","mod"),r=so(t,"b","mod"),a=Ui(n,r),i=Object(y.a)(a,2),o={a:n=i[0],b:r=i[1]};return Ji.runKernel(sr,o)}});var ql=lo({moments_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=_e(t,(e=so(e,"x","moments")).shape),a=Pl(e,r,n),i=a.shape;n||(i=Dc(a.shape,r));var o=Gc(Sl(Ns(e,"float32"),Eu(a,i))),s=Pl(o,r,n);return{mean:a,variance:s}}});var Kl=lo({multiRNNCell_:function(e,t,n,r){for(var a=so(t,"data","multiRNNCell"),i=uo(n,"c","multiRNNCell"),o=uo(r,"h","multiRNNCell"),s=a,u=[],c=0;c<e.length;c++){var l=e[c](s,i[c],o[c]);u.push(l[0]),u.push(l[1]),s=l[1]}for(var d=[],p=[],f=0;f<u.length;f+=2)d.push(u[f]),p.push(u[f+1]);return[d,p]}});var Xl=lo({multinomial_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=so(e,"logits","multinomial"),i=a.size,o=a.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got ".concat(i,"."));if(o>2)throw new Error("Rank of probabilities must be 1 or 2, but is ".concat(o));n=n||Math.random();var s={logits:1===o?Eu(a,[1,-1]):a},u={numSamples:t,seed:n,normalized:r},c=Ji.runKernel(ur,s,u);return 1===o?Eu(c,[c.size]):c}});var Yl=lo({notEqual_:function(e,t){var n,r,a=so(e,"a","notEqual","string_or_numeric"),i=so(t,"b","notEqual","string_or_numeric");n=Ui(a,i),a=(r=Object(y.a)(n,2))[0],i=r[1],kc(a.shape,i.shape);var o={a:a,b:i};return Ji.runKernel(dr,o)}});var Zl=lo({oneHot_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"int32";if(t<2)throw new Error("Error in oneHot: depth must be >=2, but it is ".concat(t));var i={indices:so(e,"indices","oneHot","int32")},o={dtype:a,depth:t,onValue:n,offValue:r};return Ji.runKernel(vr,i,o)}});var Jl=lo({onesLike_:function(e){var t={x:so(e,"x","onesLike")};return Ji.runKernel(mr,t)}});var Ql=lo({outerProduct_:function(e,t){var n=so(e,"v1","outerProduct"),r=so(t,"v2","outerProduct");be(1===n.rank&&1===r.rank,(function(){return"Error in outerProduct: inputs must be rank 1, but got ranks ".concat(n.rank," and ").concat(r.rank,".")}));var a=Eu(n,[-1,1]),i=Eu(r,[1,-1]);return Du(a,i)}});var $l=lo({pad_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=so(e,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var a={paddings:t,constantValue:n},i={x:r};return Ji.runKernel(gr,i,a)}});var ed=lo({pad1d_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return be(2===t.length,(function(){return"Invalid number of paddings. Must be length of 2."})),$l(e,[t],n)}});var td=lo({pad2d_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return be(2===t.length&&2===t[0].length&&2===t[1].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),$l(e,t,n)}});var nd=lo({pad3d_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return be(3===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),$l(e,t,n)}});var rd=lo({pad4d_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return be(4===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length&&2===t[3].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),$l(e,t,n)}});var ad=lo({spaceToBatchND_:function(e,t,n){var r=so(e,"x","spaceToBatchND");be(r.rank>=1+t.length,(function(){return"input rank ".concat(r.rank," should be > than [blockShape] ").concat(t.length)})),be(n.length===t.length,(function(){return"paddings.shape[0] ".concat(n.length," must be equal to [blockShape] ").concat(t.length)})),be(r.shape.reduce((function(e,r,a){return a>0&&a<=t.length?e&&(r+n[a-1][0]+n[a-1][1])%t[a-1]===0:e}),!0),(function(){return"input spatial dimensions ".concat(r.shape.slice(1)," with paddings ").concat(n.toString()," must be divisible by blockShapes ").concat(t.toString())}));var a={x:r},i={blockShape:t,paddings:n};return Ji.runKernel(Qr,a,i)}});var id=lo({pool_:function(e,t,n,r,a,i,o){null==a&&(a=[1,1]),null==i&&(i=1),0===r&&(r="valid");var s=so(e,"x","maxPool"),u=s,c=!1;3===s.rank&&(c=!0,u=Eu(s,[1,s.shape[0],s.shape[1],s.shape[2]])),be(Nu(i,a),(function(){return"Error in pool: Either strides or dilations must be 1. Got strides ".concat(i," and dilations '").concat(a,"'")}));var l,d=hu(u.shape,t,i,a,r),p=[d.dilationHeight,d.dilationWidth];l="same"===r?function(e,t){var n=e.map((function(e,n){return e+(e-1)*(t[n]-1)})).map((function(e){return e-1})),r=n.map((function(e){return Math.floor(e/2)})),a=n.map((function(e,t){return e-r[t]}));return n.map((function(e,t){return[r[t],a[t]]}))}([d.filterHeight,d.filterWidth],p):[[0,0],[0,0]];var f=1===p[0]&&1===p[1],h=function(e,t,n){var r=n.map((function(e){return e[0]})),a=n.map((function(e){return e[1]})),i=e.concat(r,a),o=t.map((function(e,t){return(e-i[t]%e)%e})),s=a.map((function(e,t){return e+o[t]})),u=t.map((function(e,t){return[r[t],s[t]]})),c=t.map((function(e,t){return[0,o[t]]}));return[u,c]}([d.inHeight,d.inWidth],p,l),m=Object(y.a)(h,2),v=m[0],b=m[1],g=f?r:"valid",x=f?u:ad(u,p,v),k=("avg"===n?function(){return _u(x,t,i,g,o)}:function(){return Fl(x,t,i,g,o)})(),w=f?k:Pu(k,p,b);return c?Eu(w,[w.shape[1],w.shape[2],w.shape[3]]):w}});var od=lo({prelu_:function(e,t){var n={x:so(e,"x","prelu"),alpha:so(t,"alpha","prelu")};return Ji.runKernel(kr,n)}});var sd=lo({prod_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=so(e,"x","prod");"bool"===r.dtype&&(r=Ns(r,"int32"));var a={x:r},i={axis:t,keepDims:n};return Ji.runKernel(wr,a,i)}});var ud=lo({raggedGather_:function(e,t,n,r){var a={paramsNestedSplits:e.map((function(e,t){return so(e,"tensors".concat(t),"raggedGather","int32")})),paramsDenseValues:so(t,"paramsDenseValues","raggedGather"),indices:so(n,"indices","raggedGather","int32")},i={outputRaggedRank:r},o=Ji.runKernel(Or,a,i);return{outputNestedSplits:o.slice(0,o.length-1),outputDenseValues:o[o.length-1]}}});var cd=lo({raggedRange_:function(e,t,n){var r=so(e,"starts","raggedRange"),a={starts:r,limits:so(t,"limits","raggedRange",r.dtype),deltas:so(n,"deltas","raggedRange",r.dtype)},i=Ji.runKernel(Ir,a);return{rtNestedSplits:i[0],rtDenseValues:i[1]}}});var ld=lo({raggedTensorToTensor_:function(e,t,n,r,a){var i=so(e,"shape","raggedTensorToTensor","int32"),o=so(t,"values","raggedTensorToTensor"),s={shape:i,values:o,defaultValue:so(n,"defaultValue","raggedTensorToTensor",o.dtype),rowPartitionTensors:r.map((function(e,t){return so(e,"tensors".concat(t),"raggedTensorToTensor","int32")}))},u={rowPartitionTypes:a};return Ji.runKernel(Sr,s,u)}});var dd=lo({rand_:function(e,t,n){$e(e);var r=xe(e),a=null;if(null==n||"float32"===n)a=new Float32Array(r);else if("int32"===n)a=new Int32Array(r);else{if("bool"!==n)throw new Error("Unknown data type ".concat(n));a=new Uint8Array(r)}for(var i=0;i<r;i++)a[i]=t();return Ji.makeTensor(a,e,n)}}),pd=L(Z()),fd={};z(fd,{TEST_EPSILON_FLOAT16:function(){return hd},createVideoElement:function(){return Sd},encodeStrings:function(){return Id},expectArrayBuffersEqual:function(){return Od},expectArraysClose:function(){return md},expectArraysEqual:function(){return yd},expectNumbersClose:function(){return xd},expectPromiseToFail:function(){return gd},expectValuesInRange:function(){return wd},play:function(){return Nd},testEpsilon:function(){return vd}});var hd=.1;function md(e,t,n){return null==n&&(n=vd()),bd(e,t,(function(e,t){return kd(e,t,n)}))}function vd(){return 32===Ji.backend.floatPrecision()?.001:hd}function bd(e,t,n){var r=!0;if((mi(e)||mi(t))&&(r=!1),mi(e)&&mi(t)&&(r=!0),r){var a=e.constructor.name,i=t.constructor.name;if(a!==i)throw new Error("Arrays are of different type. Actual: ".concat(a,". Expected: ").concat(i))}if(Array.isArray(e)&&Array.isArray(t)){var o=io(e),s=io(t);if(!Oe(o,s))throw new Error("Arrays have different shapes. Actual: [".concat(o,"]. Expected: [").concat(s,"]"))}var u=mi(e)?e:vi(e),c=mi(t)?t:vi(t);if(u.length!==c.length)throw new Error("Arrays have different lengths actual: ".concat(u.length," vs expected: ").concat(c.length,".\nActual:   ").concat(u,".\nExpected: ").concat(c,"."));for(var l=0;l<c.length;++l){var d=u[l],p=c[l];if(!n(d,p))throw new Error("Arrays differ: actual[".concat(l,"] = ").concat(d,", expected[").concat(l,"] = ").concat(p,".\nActual:   ").concat(u,".\nExpected: ").concat(c,"."))}"undefined"!=typeof expect&&expect().nothing()}function gd(e,t){e().then((function(){return t.fail()}),(function(){return t()})),"undefined"!=typeof expect&&expect().nothing()}function yd(e,t){var n="string"==typeof t||"number"==typeof t||"boolean"==typeof t?[t]:t;return Be(e)||Be(e[0])||Be(t)||Be(t[0])?bd(e,n,(function(e,t){return e==t})):bd(e,t,(function(e,t){return kd(e,t,0)}))}function xd(e,t,n){if(null==n&&(n=vd()),!kd(e,t,n))throw new Error("Numbers differ: actual === ".concat(e,", expected === ").concat(t));"undefined"!=typeof expect&&expect().nothing()}function kd(e,t,n){return!isFinite(e)&&!isFinite(t)||!(isNaN(e)||isNaN(t)||Math.abs(e-t)>n)}function wd(e,t,n){for(var r=0;r<e.length;r++)if(e[r]<t||e[r]>n)throw new Error("Value out of range:".concat(e[r]," low: ").concat(t,", high: ").concat(n))}function Od(e,t){var n=new Float32Array(e),r=new Float32Array(t);if(n.length!==r.length)throw new Error("Expected ArrayBuffer to be of length ".concat(r.length,", but it was ").concat(n.length));for(var a=0;a<r.length;a++)if(n[a]!==r[a])throw new Error("Expected ArrayBuffer value at ".concat(a," to be ").concat(r[a]," but got ").concat(n[a]," instead"))}function Id(e){for(var t=0;t<e.length;t++){var n=e[t];Array.isArray(n)?Id(n):e[t]=fi(n)}return e}function Sd(e){var t=document.createElement("video");return"playsInline"in t&&(t.playsInline=!0),t.muted=!0,t.loop=!0,t.style.position="fixed",t.style.left="0px",t.style.top="0px",t.preload="auto",t.appendChild(e),new Promise((function(e){t.addEventListener("loadeddata",(function(n){return e(t)})),t.load()}))}function Nd(e){return jd.apply(this,arguments)}function jd(){return(jd=Object(w.a)(k.a.mark((function e(t){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.play();case 2:if(e.t0="requestVideoFrameCallback"in t,!e.t0){e.next=6;break}return e.next=6,new Promise((function(e){t.requestVideoFrameCallback(e)}));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Td=function(){function e(t,n,r,a,i){Object(O.a)(this,e),this.mean=t,this.stdDev=n,this.dtype=r,this.nextVal=NaN,this.truncated=a,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var o=i||Math.random();this.random=pd.alea(o.toString())}return Object(I.a)(e,[{key:"nextValue",value:function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,n,r=!1;!r;){var a=void 0,i=void 0,o=void 0;do{o=(a=2*this.random()-1)*a+(i=2*this.random()-1)*i}while(o>=1||0===o);var s=Math.sqrt(-2*Math.log(o)/o);t=this.mean+this.stdDev*a*s,n=this.mean+this.stdDev*i*s,(!this.truncated||this.isValidTruncated(t))&&(r=!0)}return(!this.truncated||this.isValidTruncated(n))&&(this.nextVal=this.convertValue(n)),this.convertValue(t)}},{key:"convertValue",value:function(e){return null==this.dtype||"float32"===this.dtype?e:Math.round(e)}},{key:"isValidTruncated",value:function(e){return e<=this.upper&&e>=this.lower}}]),e}(),Cd=function(){function e(t,n,r,a){Object(O.a)(this,e),this.alpha=t,this.beta=1/n,this.dtype=r;var i=a||Math.random();this.randu=pd.alea(i.toString()),this.randn=new Td(0,1,r,!1,this.randu()),this.d=t<1?t+2/3:t-1/3,this.c=1/Math.sqrt(9*this.d)}return Object(I.a)(e,[{key:"nextValue",value:function(){for(var e,t,n,r,a,i;;){do{r=this.randn.nextValue(),i=1+this.c*r}while(i<=0);if(i*=i*i,t=1-.331*(e=r*r)*e,n=.5*e+this.d*(1-i+Math.log(i)),(a=this.randu())<t||Math.log(a)<n)break}return i=1/this.beta*this.d*i,this.alpha<1&&(i*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(i)}},{key:"convertValue",value:function(e){return"float32"===this.dtype?e:Math.round(e)}}]),e}(),Ed=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if(Object(O.a)(this,e),this.canReturnFloat=function(){return null==t.dtype||"float32"===t.dtype},this.min=n,this.range=r-n,this.dtype=a,null==i&&(i=Math.random()),"number"==typeof i&&(i=i.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between ".concat(n," - ").concat(r," <= 1 and dtype is not float"));this.random=pd.alea(i)}return Object(I.a)(e,[{key:"convertValue",value:function(e){return this.canReturnFloat()?e:Math.round(e)}},{key:"nextValue",value:function(){return this.convertValue(this.min+this.range*this.random())}}]),e}();var _d=lo({randomGamma_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32",a=arguments.length>4?arguments[4]:void 0;if($e(e),null==n&&(n=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error("Unsupported data type ".concat(r));for(var i=new Cd(t,n,r,a),o=Ss(e,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}});var Ad=lo({randomNormal_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;if($e(e),null!=r&&"bool"===r)throw new Error("Unsupported data type ".concat(r));for(var i=new Td(t,n,r,!1,a),o=Ss(e,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}});var Rd=lo({randomStandardNormal_:function(e,t,n){if(null!=t&&"bool"===t)throw new Error("Unsupported data type ".concat(t));return Ad(e,0,1,t,n)}});var Dd=lo({randomUniform_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32",a=arguments.length>4?arguments[4]:void 0;$e(e);for(var i=Ss(e,r),o=new Ed(t,n,null,a),s=0;s<i.values.length;s++)i.values[s]=o.nextValue();return i.toTensor()}});var Fd=lo({randomUniformInt_:function(e,t,n,r){return Dd(e,t,n,"int32",r)}});function Md(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32";if(0===n)throw new Error("Cannot have a step of zero");var a={start:e,stop:t,step:n,dtype:r};return Ji.runKernel(Nr,{},a)}var zd=lo({real_:function(e){var t={input:so(e,"input","real")};return Ji.runKernel(jr,t)}});var Ld=lo({reciprocal_:function(e){var t={x:so(e,"x","reciprocal")};return Ji.runKernel(Tr,t)}});var Pd=lo({relu_:function(e){var t={x:so(e,"x","relu")};return Ji.runKernel(Cr,t)}});var Bd=lo({relu6_:function(e){var t={x:so(e,"x","relu6")};return Ji.runKernel(Fr,t)}});var Wd=lo({reverse_:function(e,t){var n={x:so(e,"x","reverse")},r={dims:t};return Ji.runKernel(Mr,n,r)}});var Ud=lo({reverse1d_:function(e){var t=so(e,"x","reverse");return be(1===t.rank,(function(){return"Error in reverse1D: x must be rank 1 but got rank ".concat(t.rank,".")})),Wd(t,0)}});var Vd=lo({reverse2d_:function(e,t){var n=so(e,"x","reverse");return be(2===n.rank,(function(){return"Error in reverse2D: x must be rank 2 but got rank ".concat(n.rank,".")})),Wd(n,t)}});var Gd=lo({reverse3d_:function(e,t){var n=so(e,"x","reverse");return be(3===n.rank,(function(){return"Error in reverse3D: x must be rank 3 but got rank ".concat(n.rank,".")})),Wd(n,t)}});var Hd=lo({reverse4d_:function(e,t){var n=so(e,"x","reverse");return be(4===n.rank,(function(){return"Error in reverse4D: x must be rank 4 but got rank ".concat(n.rank,".")})),Wd(n,t)}});var qd=lo({round_:function(e){var t={x:so(e,"x","round")};return Ji.runKernel(zr,t)}});var Kd=lo({rsqrt_:function(e){var t={x:so(e,"x","rsqrt","float32")};return Ji.runKernel(Lr,t)}});var Xd=lo({selu_:function(e){var t={x:so(e,"x","selu")};return Ji.runKernel(Vr,t)}});var Yd=lo({separableConv2d_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"NHWC",s=so(e,"x","separableConv2d"),u=so(t,"depthwiseFilter","separableConv2d"),c=so(n,"pointwiseFilter","separableConv2d"),l=s,d=!1;if(3===s.rank&&(d=!0,l=Eu(s,[1,s.shape[0],s.shape[1],s.shape[2]])),"NCHW"===o)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");be(4===l.rank,(function(){return"Error in separableConv2d: input must be rank 4, but got rank ".concat(l.rank,".")})),be(4===u.rank,(function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank ".concat(u.rank,".")})),be(4===c.rank,(function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank ".concat(u.rank,".")})),be(1===c.shape[0],(function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ".concat(c.shape[0],".")})),be(1===c.shape[1],(function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ".concat(c.shape[1],".")}));var p=u.shape[2],f=u.shape[3];be(c.shape[2]===p*f,(function(){return"Error in separableConv2d: the third dimension of pointwise filter must be ".concat(p*f,", but got ").concat(c.shape[2],".")}));var h=mc(l,u,r,a,o,i),m=nc(h,c,1,"valid",o);return d?Eu(m,[m.shape[1],m.shape[2],m.shape[3]]):m}});function Zd(){return(Zd=Object(w.a)(k.a.mark((function e(t,n){var r,a,i,o,s,u,c,l,d,p,f;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=so(t,"x","setdiff1d"),a=so(n,"y","setdiff1d"),be(r.dtype===a.dtype,(function(){return"x and y should have the same dtype, but got x (".concat(r.dtype,") and y (").concat(a.dtype,").")})),be(1===r.rank,(function(){return"x should be 1D tensor, but got x (".concat(r.shape,").")})),be(1===a.rank,(function(){return"y should be 1D tensor, but got y (".concat(a.shape,").")})),e.next=4,r.data();case 4:return i=e.sent,e.next=7,a.data();case 7:for(o=e.sent,s=new Set(o),u=0,c=0;c<i.length;c++)s.has(i[c])||u++;for(l=new Si([u],r.dtype),d=new Si([u],"int32"),p=0,f=0;p<i.length;p++)s.has(i[p])||(l.values[f]=i[p],d.values[f]=p,f++);return e.abrupt("return",[l.toTensor(),d.toTensor()]);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Jd=function(e,t){return Zd.apply(this,arguments)};var Qd=lo({sign_:function(e){var t={x:so(e,"x","sign")};return Ji.runKernel(Kr,t)}});var $d=lo({sin_:function(e){var t={x:so(e,"x","sin","float32")};return Ji.runKernel(Hr,t)}});var ep=lo({sinh_:function(e){var t={x:so(e,"x","sinh")};return Ji.runKernel(qr,t)}});var tp=lo({slice1d_:function(e,t,n){var r=so(e,"x","slice1d");return be(1===r.rank,(function(){return"slice1d expects a rank-1 tensor, but got a rank-".concat(r.rank," tensor")})),Mu(r,[t],[n])}});var np=lo({slice2d_:function(e,t,n){var r=so(e,"x","slice2d");return be(2===r.rank,(function(){return"slice2d expects a rank-2 tensor, but got a rank-".concat(r.rank," tensor")})),Mu(r,t,n)}});var rp=lo({slice3d_:function(e,t,n){var r=so(e,"x","slice3d");return be(3===r.rank,(function(){return"slice3d expects a rank-3 tensor, but got a rank-".concat(r.rank," tensor")})),Mu(r,t,n)}});var ap=lo({slice4d_:function(e,t,n){var r=so(e,"x","slice4d");return be(4===r.rank,(function(){return"slice4d expects a rank-4 tensor, but got a rank-".concat(r.rank," tensor")})),Mu(r,t,n)}});var ip=lo({softmax_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=so(e,"logits","softmax","float32");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank ".concat(n.rank," and dim was ").concat(t));var r={logits:n},a={dim:t};return Ji.runKernel(ea,r,a)}});var op=lo({fft_:function(e){be("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.fft() must be complex64 but got ".concat(e.dtype,".")}));var t={input:e};return Ji.runKernel(yn,t)}});var sp=lo({ifft_:function(e){be("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.ifft() must be complex64 but got ".concat(e.dtype,".")}));var t={input:e};return Ji.runKernel(En,t)}});var up=lo({irfft_:function(e){var t,n=e.shape[e.shape.length-1],r=e.size/n;if(n<=2){var a=Eu(e,[r,n]);t=sp(a)}else{var i=[r,2*(n-1)],o=Eu(zd(e),[r,n]),s=Eu(al(e),[r,n]),u=Wd(Mu(o,[0,1],[r,n-2]),1),c=$s(Wd(Mu(s,[0,1],[r,n-2]),1),Uc(-1)),l=Ru([o,u],1),d=Ru([s,c],1),p=Eu(po(l,d),[i[0],i[1]]);t=sp(p)}if(t=zd(t),3===e.rank&&0!==e.shape[0]){var f=t,h=e.shape[0];t=Eu(t,[h,t.shape[0]/h,t.shape[1]]),f.dispose()}return t}});var cp=lo({split_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r={x:so(e,"x","split")},a={numOrSizeSplits:t,axis:n};return Ji.runKernel($r,r,a)}});var lp=lo({rfft_:function(e,t){be("float32"===e.dtype,(function(){return"The dtype for rfft() must be real value but got ".concat(e.dtype)}));var n,r=e.shape[e.shape.length-1],a=e.size/r;if(null!=t&&t<r){var i=e.shape.map((function(e){return 0})),o=e.shape.map((function(e){return e}));o[e.shape.length-1]=t,n=Mu(e,i,o),r=t}else if(null!=t&&t>r){var s=e.shape.map((function(e){return e}));s[e.shape.length-1]=t-r,n=Ru([e,Bl(s)],e.shape.length-1),r=t}else n=e;var u=Ic(n),c=Eu(po(n,u),[a,r]),l=op(c),d=Math.floor(r/2)+1,p=zd(l),f=al(l),h=cp(p,[d,r-d],p.shape.length-1),m=cp(f,[d,r-d],f.shape.length-1),v=n.shape.slice();return v[n.shape.length-1]=d,Eu(po(h[0],m[0]),v)}});var dp=lo({squaredDifference_:function(e,t){var n,r,a=so(e,"a","squaredDifference"),i=so(t,"b","squaredDifference");n=Ui(a,i),a=(r=Object(y.a)(n,2))[0],i=r[1],kc(a.shape,i.shape);var o={a:a,b:i};return Ji.runKernel(oa,o,{})}});var pp=lo({squeeze_:function(e,t){var n=so(e,"x","squeeze","string_or_numeric");return Eu(n,Ae(n.shape,t).newShape)}});var fp=lo({stack_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=uo(e,"tensors","stack","string_or_numeric");be(n.length>=1,(function(){return"Pass at least one tensor to tf.stack"})),n.length>0&&be(t<=n[0].rank,(function(){return"Axis must be <= rank of the tensor"}));var r=n,a={axis:t};return Ji.runKernel(br,r,a)}});var hp=lo({step_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n={x:so(e,"x","step")},r={alpha:t};return Ji.runKernel(Sa,n,r)}});var mp=lo({stridedSlice_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,c={x:so(e,"x","stridedSlice","string_or_numeric")},l={begin:t,end:n,strides:r,beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u};return Ji.runKernel(ca,c,l)}});var vp=lo({tan_:function(e){var t={x:so(e,"x","tan","float32")};return Ji.runKernel(ha,t)}});function bp(e,t){ye(e);var n=io(e,t);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return fo(e,null,n,t)}function gp(e,t,n){if(ye(e),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");var r=io(e,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return fo(e,t,r,n)}function yp(e,t,n){if(ye(e),null!=t&&3!==t.length)throw new Error("tensor3d() requires shape to have three numbers");var r=io(e,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return fo(e,t,r,n)}function xp(e,t,n){if(ye(e),null!=t&&4!==t.length)throw new Error("tensor4d() requires shape to have four numbers");var r=io(e,n);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return fo(e,t,r,n)}function kp(e,t,n){if(ye(e),null!=t&&5!==t.length)throw new Error("tensor5d() requires shape to have five numbers");var r=io(e,n);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return fo(e,t,r,n)}function wp(e,t,n){if(ye(e),null!=t&&6!==t.length)throw new Error("tensor6d() requires shape to have six numbers");var r=io(e,n);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return fo(e,t=t||r,r,n)}var Op={};function Ip(e,t,n){var r=t.rank>1?t.shape[t.rank-1]:1,a=t.rank>1?t.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ".concat(n.shape,", indices.shape: ").concat(t.shape,", shape: ").concat(e,", sliceDim: ").concat(r,", and batchDim: ").concat(a,".");if(n.rank<a)throw new Error(i+" update.rank < ".concat(a,". "));if(e.length<r+(n.rank-a))throw new Error(i+" Output shape length < ".concat(r+(n.rank-a)));if(n.rank!==a+e.length-r)throw new Error(i+" update.rank != ".concat(a+e.length-r));for(var o=0;o<a;++o)if(n.shape[o]!==t.shape[o])throw new Error(i+" updates.shape[".concat(o,"] (").concat(n.shape[o],") != indices.shape[").concat(o,"] (").concat(t.shape[o],")."));for(var s=0;s<n.rank-a;++s)if(n.shape[s+a]!==e[s+r])throw new Error(i+" updates.shape[".concat(s+a,"] (").concat(n.shape[s+a],") != shape[").concat(s+a,"] (").concat(e[s+a],")"))}function Sp(e,t,n){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ".concat(t.rank,"."));if(e.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ".concat(e.rank,"."));if("int32"!==t.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: ".concat(t.dtype));if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: ".concat(n));if(0===n.length){if(0===t.size)throw new Error("Indices specified for empty output. indices shape: ".concat(t.shape));if(0===e.size)throw new Error("Updates specified for empty output. updates shape: ".concat(e.shape))}Ip(n,t,e)}function Np(e,t,n){for(var r=t.shape.length,a=r>1?t.shape[r-1]:1,i=n.length,o=1,s=a;s<i;++s)o*=n[s];var u=a<1?1:a;return{sliceRank:a,numUpdates:xe(t.shape)/u,sliceSize:o,strides:[].concat(Object(S.a)(qe(n.slice(0,a))),[1]),outputSize:xe(n)}}z(Op,{calculateShapes:function(){return Np},validateInput:function(){return Sp},validateUpdateShape:function(){return Ip}});var jp=lo({tensorScatterUpdate_:function(e,t,n){var r=so(e,"tensor","tensorScatterupdate"),a=so(t,"indices","tensorScatterupdate","int32"),i=so(n,"updates","tensorScatterupdate");if(Sp(i,a,r.shape),r.dtype!==i.dtype)throw new Error("tensor and updates must have the same dtype, instead they are ".concat(r.dtype," and ").concat(i.dtype,"."));var o={tensor:r,indices:a,updates:i};return Ji.runKernel(Br,o,{})}});var Tp=lo({topk_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=so(e,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var a=r.shape[r.shape.length-1];if(t<0)throw new Error("'k' passed to topk() must be >= 0 but got ".concat(t));if(t>a)throw new Error("'k' passed to topk() must be <= the last dimension (".concat(a,") but got ").concat(t));var i={x:r},o={k:t,sorted:n},s=Ji.runKernel(ba,i,o),u=Object(y.a)(s,2),c=u[0],l=u[1];return{values:c,indices:l}}});var Cp=lo({truncatedNormal_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;if($e(e),null!=r&&"bool"===r)throw new Error("Unsupported data type $ { dtype }");for(var i=new Td(t,n,r,!0,a),o=Ss(e,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}});var Ep=lo({unique_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=so(e,"x","unique","string_or_numeric");be(n.rank>0,(function(){return"The input tensor must be at least 1D"}));var r={x:n},a={axis:t},i=Ji.runKernel(xa,r,a),o=Object(y.a)(i,2),s=o[0],u=o[1];return{values:s,indices:u}}});var _p=lo({unsortedSegmentSum_:function(e,t,n){var r=so(e,"x","unsortedSegmentSum"),a=so(t,"segmentIds","unsortedSegmentSum","int32");be(Ie(n),(function(){return"numSegments must be of dtype int"}));var i={x:r,segmentIds:a},o={numSegments:n};return Ji.runKernel(wa,i,o)}});var Ap=lo({unstack_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=so(e,"x","unstack","string_or_numeric");be(t>=-n.shape.length&&t<n.shape.length,(function(){return"Axis = ".concat(t," is not in [-").concat(n.shape.length,", ").concat(n.shape.length,")")}));var r={value:n},a={axis:t};return Ji.runKernel(ka,r,a)}});function Rp(e,t){return Rl(e,t,"right")}function Dp(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;return Ji.makeVariable(e,t,n,r)}function Fp(e,t){for(var n=[],r=0;r<t.length;r++)t[r]&&n.push(r);for(var a=Ss(e,"int32"),i=Ss([n.length,e.length],"int32"),o=0;o<n.length;o++){var s=a.indexToLoc(n[o]),u=o*e.length;i.values.set(s,u)}return i.toTensor()}function Mp(){return(Mp=Object(w.a)(k.a.mark((function e(t){var n,r,a;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=so(t,"condition","whereAsync","bool"),e.next=3,n.data();case 3:return r=e.sent,a=Fp(n.shape,r),e.abrupt("return",(t!==n&&n.dispose(),a));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var zp=function(e){return Mp.apply(this,arguments)};function Lp(){return(Lp=Object(w.a)(k.a.mark((function e(t,n,r){var a,i,o,s,u,c,l,d,p,f,h,m,v;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a=so(t,"tensor","boolMask"),i=so(n,"mask","boolMask","bool"),o=null==r?0:r,s=i.rank,u=a.shape,be(s>0,(function(){return"mask cannot be scalar"})),ge(u.slice(o,o+s),i.shape,"mask's shape must match the first K dimensions of tensor's shape,"),c=1,l=o;l<o+s;l++)c*=u[l];return d=u.slice(0,o).concat([c],u.slice(o+s)),p=Eu(a,d),f=Eu(i,[-1]),e.next=9,zp(f);case 9:return h=e.sent,m=pp(h,[1]),v=tl(p,m,o),e.abrupt("return",(t!==a&&a.dispose(),n!==i&&i.dispose(),m.dispose(),p.dispose(),f.dispose(),h.dispose(),v));case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Pp=function(e,t,n){return Lp.apply(this,arguments)};var Bp=lo({transpose_:function(e,t,n){var r=so(e,"x","transpose");if(null==t&&(t=r.shape.map((function(e,t){return t})).reverse()),be(r.rank===t.length,(function(){return"Error in transpose: rank of input ".concat(r.rank," must match length of perm ").concat(t,".")})),t.forEach((function(e){be(e>=0&&e<r.rank,(function(){return"All entries in 'perm' must be between 0 and ".concat(r.rank-1," but got ").concat(t)}))})),r.rank<=1)return r.clone();var a={x:r},i={perm:t};return"complex64"===r.dtype?zs((function(){var e=zd(r),t=al(r);return e=Ji.runKernel(ya,{x:e},i),t=Ji.runKernel(ya,{x:t},i),n&&(t=wl(t)),po(e,t)})):Ji.runKernel(ya,a,i)}});var Wp=lo({movingAverage_:function(e,t,n,r){var a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=so(e,"v","movingAverage"),o=so(t,"x","movingAverage"),s=so(n,"decay","movingAverage");Vi(i,o),be(Oe(i.shape,o.shape),(function(){return"Shape mismatch in v and x"}));var u=Uc(1),c=Sl(u,s),l=$s(Sl(o,i),c);if(a){be(null!=r,(function(){return"When using zeroDebias: true, step is required."}));var d=so(r,"step","movingAverage");l=Qs(l,Sl(u,Wc(s,d)))}return Zs(i,l)}});var Up=lo({scatterND_:function(e,t,n){$e(n);var r=so(e,"indices","scatterND","int32"),a=so(t,"updates","scatterND");Sp(a,r,n);var i={indices:r,updates:a},o={shape:n};return Ji.runKernel(Pr,i,o)}});function Vp(e,t,n,r){if("int32"!==e.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was ".concat(e.dtype,"."));if(e.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape ".concat(e.shape,"."));var a=e.rank>0?e.shape[0]:1,i=e.rank>1?e.shape[1]:1;if(n.length!==i)throw new Error("outputShape has incorrect number of elements:, ".concat(n.length,", should be: ").concat(i,"."));var o=t.size;if(0!==t.rank&&(1!==t.rank||o!==a))throw new Error("sparseValues has incorrect shape ".concat(t.shape,", should be [] or [").concat(a,"]"));if(t.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}var Gp=lo({sparseToDense_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;$e(n);var a=so(e,"sparseIndices","sparseToDense","int32"),i=so(t,"sparseValues","sparseToDense","string_or_numeric"),o=so(r,"defaultValue","sparseToDense",i.dtype);Vp(a,i,n,o);var s={sparseIndices:a,sparseValues:i,defaultValue:o},u={outputShape:n};return Ji.runKernel(ia,s,u)}});var Hp=lo({gatherND_:function(e,t){var n=so(t,"indices","gatherND","int32"),r={params:so(e,"x","gatherND","string_or_numeric"),indices:n};return Ji.runKernel(Nn,r)}});var qp=lo({dropout_:function(e,t,n,r){var a=so(e,"x","dropout");if(be("float32"===a.dtype,(function(){return"x has to be a floating point tensor since it's going to be scaled, but got a ".concat(a.dtype," tensor instead.")})),be(t>=0&&t<1,(function(){return"rate must be a float in the range [0, 1), but got ".concat(t,".")})),0===t)return e instanceof Ti?a.clone():a;var i=function(e,t){if(null==t)return e.shape.slice();if(Oe(e.shape,t))return t;if(e.shape.length===t.length){for(var n=[],r=0;r<e.shape.length;r++)null==t[r]&&null!=e.shape[r]?n.push(e.shape[r]):n.push(t[r]);return n}return t}(a,n),o=1-t,s=Qs(el(Zs(Dd(i,0,1,"float32",r),o)),o);return $s(a,s)}});function Kp(e){return Math.floor(Math.pow(2,Math.ceil(Math.log(e)/Math.log(2))))}function Xp(e,t,n){for(var r=1-e%2,a=new Float32Array(e),i=0;i<e;++i){var o=2*Math.PI*i/(e+r-1);a[i]=t-n*Math.cos(o)}return bp(a,"float32")}function Yp(){return(Yp=Object(w.a)(k.a.mark((function e(t,n){var r,a,i,o,s,u,c,l,d,p,f,h,m,v,b,g=arguments;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=g.length>2&&void 0!==g[2]?g[2]:1,a=so(t,"predictions","inTopK"),i=so(n,"targets","inTopK"),be(a.rank>1,(function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got ".concat(a.rank)})),be(a.rank-1===i.rank,(function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank ".concat(a.rank," and targets rank ").concat(i.rank)})),ge(a.shape.slice(0,a.shape.length-1),i.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),o=a.shape[a.shape.length-1],be(r>0&&r<=o,(function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension (".concat(o,"), but got ").concat(r)})),e.next=7,a.data();case 7:return s=e.sent,e.next=10,i.data();case 10:u=e.sent,c=s.length/o,l=o,d=Re("bool",c),p=0;case 15:if(!(p<c)){e.next=30;break}for(f=p*l,h=s.subarray(f,f+l),m=[],v=0;v<h.length;v++)m.push({value:h[v],index:v});m.sort((function(e,t){return t.value-e.value})),d[p]=0,b=0;case 20:if(!(b<r)){e.next=27;break}if(m[b].index!==u[p]){e.next=24;break}return d[p]=1,e.abrupt("break",27);case 24:b++,e.next=20;break;case 27:p++,e.next=15;break;case 30:return e.abrupt("return",(t!==a&&a.dispose(),n!==i&&i.dispose(),ho(d,i.shape,"bool")));case 31:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Zp=function(e,t){return Yp.apply(this,arguments)},Jp={};z(Jp,{conv2d:function(){return rf},depthwiseConv2d:function(){return sf},matMul:function(){return uf}});var Qp=lo({conv2DBackpropFilter_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",o=arguments.length>6?arguments[6]:void 0,s=e;3===e.rank&&(s=Eu(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var u=t;3===u.rank&&(u=Eu(t,[1,t.shape[0],t.shape[1],t.shape[2]])),be(4===s.rank,(function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape ".concat(s.shape,".")})),be(4===u.rank,(function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape ".concat(u.shape,".")})),be(4===n.length,(function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got ".concat(n,".")}));var c="NHWC"===i?s.shape[3]:s.shape[1],l="NHWC"===i?u.shape[3]:u.shape[1];be(c===n[2],(function(){return"Error in conv2dDerFilter: depth of input ".concat(c,") must match input depth in filter (").concat(n[2],".")})),be(l===n[3],(function(){return"Error in conv2dDerFilter: depth of dy (".concat(l,") must match output depth for filter (").concat(n[3],").")})),Cu("conv2dDerFilter",a,o);var d={x:s,dy:u},p={strides:r,pad:a,dataFormat:i,dimRoundingMode:o,filterShape:n};return Ji.runKernel(Vt,d,p)}});function $p(e,t,n){if(null==n||"linear"===n)return e;if("relu"===n)return $s(e,hp(t));throw new Error("Cannot compute gradient for fused activation ".concat(n,"."))}function ef(e,t){var n=t,r=xc(e.shape,t.shape);return r.length>0&&(n=Hc(n,r)),Eu(n,e.shape)}function tf(e,t,n,r){if("linear"===t)return e;if("relu"===t)return Pd(e);if("elu"===t)return Tc(e);if("relu6"===t)return Bd(e);if("prelu"===t)return od(e,n);if("leakyrelu"===t)return ul(e,r);if("sigmoid"===t)return Fu(e);throw new Error("Unknown fused activation ".concat(t,"."))}var nf=function(e,t){return!(e>0)||"linear"===t};var rf=lo({fusedConv2d_:function(e){var t,n,r=e.x,a=e.filter,i=e.strides,o=e.pad,s=e.dataFormat,u=void 0===s?"NHWC":s,c=e.dilations,l=void 0===c?[1,1]:c,d=e.dimRoundingMode,p=e.bias,f=e.activation,h=void 0===f?"linear":f,m=e.preluActivationWeights,v=e.leakyreluAlpha;if(h=h||"linear",!1===nf(Ji.state.gradientDepth,h)){be("NHWC"===u,(function(){return"Error in fused conv2d: got dataFormat of ".concat(u," but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.")}));var b=nc(r,a,i,o,u,l,d);return null!=p&&(b=Zs(b,p)),tf(b,h,m,v)}var g=so(r,"x","conv2d","float32"),x=so(a,"filter","conv2d","float32"),k=g,w=!1;3===g.rank&&(w=!0,k=Eu(g,[1,g.shape[0],g.shape[1],g.shape[2]])),be(4===k.rank,(function(){return"Error in fused conv2d: input must be rank 4, but got rank ".concat(k.rank,".")})),be(4===x.rank,(function(){return"Error in fused conv2d: filter must be rank 4, but got rank ".concat(x.rank,".")})),Cu("fused conv2d",o,d);var O="NHWC"===u?k.shape[3]:k.shape[1];be(x.shape[2]===O,(function(){return"Error in conv2d: depth of input (".concat(O,") must match input depth for filter ").concat(x.shape[2],".")})),be(Nu(i,l),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides ".concat(i," and dilations '").concat(l,"'")}));var I,S,N=vu(k.shape,x.shape,i,l,o,d);if(null!=p&&(t=Ui(I=so(p,"bias","fused conv2d"),g),n=Object(y.a)(t,1),I=n[0],"NHWC"===u?kc(N.outShape,I.shape):(be(I.shape.length<=1,(function(){return"Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-".concat(I.shape.length,".")})),be(0===I.shape.length||I.shape[0]===N.outChannels||1===I.shape[0],(function(){return"Error in fused conv2d: bias shape (".concat(I.shape,") is not compatible with the number of output channels (").concat(N.outChannels,")")})))),null!=m){if(be((b=m.shape).length<=1||3===b.length,(function(){return"Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-".concat(b.length,".")})),1===b.length)be(1===b[0]||b[0]===N.outChannels,(function(){return"Error in fused conv2d: PReLU activation weights (".concat(b,") is not compatible with the number of output channels (").concat(N.outChannels,").")}));else if(3===b.length)try{kc(b,N.outShape)}catch(_){var j="Error in fused conv2d: PReLU activation weights (".concat(b,") is not compatible with the output shape of the conv2d (").concat(N.outShape,").");throw Error(j)}S=so(m,"prelu weights","fused conv2d")}var T=function(e,t){be("NHWC"===u,(function(){return"Error in gradient of fused conv2D: got dataFormat of ".concat(u," but only NHWC is currently supported.")}));var n=Object(y.a)(t,4),r=n[0],a=n[1],s=n[2],c=n[3],d=$p(e,s,h);be(Su(l),(function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '".concat(l,"'")}));var p=[ac(a.shape,d,r,i,o),Qp(a,d,r.shape,i,o)];if(null!=c){var f=ef(c,d);p.push(f)}return p},C={x:k,filter:x,bias:I,preluActivationWeights:S},E={strides:i,pad:o,dataFormat:u,dilations:l,dimRoundingMode:d,activation:h,leakyreluAlpha:v};return null==p?xl((function(e,t,n){var r=Ji.runKernel(Ca,C,E);return n([t,e,r]),w&&(r=Eu(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:T}}))(k,x):xl((function(e,t,n,r){var a=Ji.runKernel(Ca,C,E);return r([t,e,a,n]),w&&(a=Eu(a,[a.shape[1],a.shape[2],a.shape[3]])),{value:a,gradFunc:T}}))(k,x,I)}});var af=lo({depthwiseConv2dNativeBackpropFilter_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=e;3===e.rank&&(s=Eu(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var u=t;3===u.rank&&(u=Eu(t,[1,t.shape[0],t.shape[1],t.shape[2]]));var c={x:s,dy:u},l={strides:r,pad:a,dimRoundingMode:o,dilations:i,filterShape:n};return Ji.runKernel(nn,c,l)}});var of=lo({depthwiseConv2dNativeBackpropInput_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=t,u=!1;3===t.rank&&(u=!0,s=Eu(t,[1,t.shape[0],t.shape[1],t.shape[2]]));var c={dy:s,filter:n},l={strides:r,pad:a,dimRoundingMode:o,dilations:i,inputShape:e},d=Ji.runKernel(rn,c,l);return u?Eu(d,[d.shape[1],d.shape[2],d.shape[3]]):d}});var sf=lo({fusedDepthwiseConv2d_:function(e){var t,n,r=e.x,a=e.filter,i=e.strides,o=e.pad,s=e.dataFormat,u=void 0===s?"NHWC":s,c=e.dilations,l=void 0===c?[1,1]:c,d=e.dimRoundingMode,p=e.bias,f=e.activation,h=void 0===f?"linear":f,m=e.preluActivationWeights,v=e.leakyreluAlpha;if(!1===nf(Ji.state.gradientDepth,h)){var b=mc(r,a,i,o,u,l,d);return null!=p&&(b=Zs(b,p)),tf(b,h,m,v)}var g=so(r,"x","depthwiseConv2d","float32"),x=so(a,"filter","depthwiseConv2d","float32"),k=g,w=!1;3===g.rank&&(w=!0,k=Eu(g,[1,g.shape[0],g.shape[1],g.shape[2]])),be(4===k.rank,(function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank ".concat(k.rank,".")})),be(4===x.rank,(function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank ".concat(x.rank,".")})),be(k.shape[3]===x.shape[2],(function(){return"Error in fused depthwiseConv2d: number of input channels (".concat(k.shape[3],") must match the inChannels dimension in filter ").concat(x.shape[2],".")})),null==l&&(l=[1,1]),be(Nu(i,l),(function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ".concat(i," and dilations '").concat(l,"'")})),Cu("fused depthwiseConv2d",o,d);var O,I,S=vu(k.shape,x.shape,i,l,o,d,!0);null!=p&&(t=Ui(O=so(p,"bias","fused conv2d"),g),n=Object(y.a)(t,1),O=n[0],kc(S.outShape,O.shape)),null!=m&&(I=so(m,"prelu weights","fused depthwiseConv2d"));var N=function(e,t){be(Su(l),(function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '".concat(l,"'")}));var n=Object(y.a)(t,4),r=n[0],a=n[1],s=n[2],u=n[3],c=$p(e,s,h),p=of(a.shape,c,r,i,o,l,d),f=af(a,c,r.shape,i,o,l,d);return null!=u?[p,f,ef(O,c)]:[p,f]},j={x:k,filter:x,bias:O,preluActivationWeights:I},T={strides:i,pad:o,dataFormat:u,dilations:l,dimRoundingMode:d,activation:h,leakyreluAlpha:v};return null==p?xl((function(e,t,n){var r=Ji.runKernel(Ea,j,T);return n([t,e,r]),w&&(r=Eu(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:N}}))(k,x):xl((function(e,t,n,r){var a=Ji.runKernel(Ea,j,T);return r([t,e,a,n]),w&&(a=Eu(a,[a.shape[1],a.shape[2],a.shape[3]])),{value:a,gradFunc:N}}))(k,x,O)}});var uf=lo({fusedMatMul_:function(e){var t,n=e.a,r=e.b,a=e.transposeA,i=void 0!==a&&a,o=e.transposeB,s=void 0!==o&&o,u=e.bias,c=e.activation,l=void 0===c?"linear":c,d=e.preluActivationWeights,p=e.leakyreluAlpha,f=void 0===p?.2:p;if(!1===nf(Ji.state.gradientDepth,l)){var h=Du(n,r,i,s);return null!=u&&(h=Zs(h,u)),tf(h,l,d,f)}var m=so(n,"a","fused matMul"),v=so(r,"b","fused matMul"),b=Ui(m,v),g=Object(y.a)(b,2);m=g[0],v=g[1];var x=i?m.shape[m.rank-2]:m.shape[m.rank-1],k=s?v.shape[v.rank-1]:v.shape[v.rank-2],w=i?m.shape[m.rank-1]:m.shape[m.rank-2],O=s?v.shape[v.rank-2]:v.shape[v.rank-1],I=m.shape.slice(0,-2),S=v.shape.slice(0,-2),N=xe(I),j=xe(S);be(x===k,(function(){return"Error in fused matMul: inner shapes (".concat(x,") and (").concat(k,") of Tensors with shapes ").concat(m.shape," and ").concat(v.shape," and transposeA=").concat(i," and transposeB=").concat(s," must match.")}));var T,C,E=kc(m.shape.slice(0,-2),v.shape.slice(0,-2)).concat([w,O]),_=Eu(m,i?[N,x,w]:[N,w,x]),A=Eu(v,s?[j,O,k]:[j,k,O]);null!=u&&(t=Ui(T=so(u,"bias","fused matMul"),m),T=Object(y.a)(t,1)[0],kc(E,T.shape)),null!=d&&(C=so(d,"prelu weights","fused matMul"));var R=function(e,t){var n,r,a=Object(y.a)(t,4),o=a[0],c=a[1],d=a[2],p=a[3],f=$p(Eu(e,d.shape),d,l);return i||s?!i&&s?(n=Du(f,c,!1,!1),r=Du(f,o,!0,!1)):i&&!s?(n=Du(c,f,!1,!0),r=Du(o,f,!1,!1)):(n=Du(c,f,!0,!0),r=Du(f,o,!0,!0)):(n=Du(f,c,!1,!0),r=Du(o,f,!0,!1)),null!=u?[n,r,ef(p,f)]:[n,r]},D={a:_,b:A,bias:T,preluActivationWeights:C},F={transposeA:i,transposeB:s,activation:l,leakyreluAlpha:f};return null==u?xl((function(e,t,n){var r=Ji.runKernel(Ta,D,F);return n([e,t,r]),{value:Eu(r,E),gradFunc:R}}))(_,A):xl((function(e,t,n,r){var a=Ji.runKernel(Ta,D,F);return r([e,t,a,n]),{value:Eu(a,E),gradFunc:R}}))(_,A,T)}});var cf=lo({hammingWindow_:function(e){return Xp(e,.54,.46)}});var lf=lo({hannWindow_:function(e){return Xp(e,.5,.5)}});var df=lo({frame_:function(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=0,o=[];i+t<=e.size;)o.push(Mu(e,i,t)),i+=n;if(r)for(;i<e.size;){var s=i+t-e.size,u=Ru([Mu(e,i,t-s),Zu([s],a)]);o.push(u),i+=n}return 0===o.length?gp([],[0,t]):Eu(Ru(o),[o.length,t])}});var pf=lo({stft_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:lf;null==r&&(r=Kp(t));var i=df(e,t,n),o=$s(i,a(t));return lp(o,r)}});var ff=lo({cropAndResize_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"bilinear",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=so(e,"image","cropAndResize"),s=so(t,"boxes","cropAndResize","float32"),u=so(n,"boxInd","cropAndResize","int32"),c=s.shape[0];be(4===o.rank,(function(){return"Error in cropAndResize: image must be rank 4,but got rank ".concat(o.rank,".")})),be(2===s.rank&&4===s.shape[1],(function(){return"Error in cropAndResize: boxes must be have size [".concat(c,",4] but had shape ").concat(s.shape,".")})),be(1===u.rank&&u.shape[0]===c,(function(){return"Error in cropAndResize: boxInd must be have size [".concat(c,"] but had shape ").concat(s.shape,".")})),be(2===r.length,(function(){return"Error in cropAndResize: cropSize must be of length 2, but got length ".concat(r.length,".")})),be(r[0]>=1&&r[1]>=1,(function(){return"cropSize must be atleast [1,1], but was ".concat(r)})),be("bilinear"===a||"nearest"===a,(function(){return"method must be bilinear or nearest, but was ".concat(a)}));var l={image:o,boxes:s,boxInd:u},d={method:a,extrapolationValue:i,cropSize:r};return Ji.runKernel(Qt,l,d)}});var hf=lo({flipLeftRight_:function(e){var t=so(e,"image","flipLeftRight","float32");be(4===t.rank,(function(){return"Error in flipLeftRight: image must be rank 4,but got rank ".concat(t.rank,".")}));var n={image:t};return Ji.runKernel(kn,n,{})}});var mf=lo({grayscaleToRGB_:function(e){var t=so(e,"image","grayscaleToRGB"),n=t.rank-1,r=t.shape[n];be(t.rank>=2,(function(){return"Error in grayscaleToRGB: images must be at least rank 2, but got rank ".concat(t.rank,".")})),be(1===r,(function(){return"Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ".concat(r,".")}));var a=new Array(t.rank);return a.fill(1,0,n),a[n]=3,Qc(t,a)}});var vf=lo({rotateWithOffset_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=so(e,"image","rotateWithOffset","float32");be(4===a.rank,(function(){return"Error in rotateWithOffset: image must be rank 4,but got rank ".concat(a.rank,".")}));var i={image:a},o={radians:t,fillValue:n,center:r};return Ji.runKernel(ja,i,o)}});function bf(e,t,n,r,a,i){null==r&&(r=.5),null==a&&(a=Number.NEGATIVE_INFINITY),null==i&&(i=0);var o=e.shape[0];return n=Math.min(n,o),be(0<=r&&r<=1,(function(){return"iouThreshold must be in [0, 1], but was '".concat(r,"'")})),be(2===e.rank,(function(){return"boxes must be a 2D tensor, but was of rank '".concat(e.rank,"'")})),be(4===e.shape[1],(function(){return"boxes must have 4 columns, but 2nd dimension was ".concat(e.shape[1])})),be(1===t.rank,(function(){return"scores must be a 1D tensor"})),be(t.shape[0]===o,(function(){return"scores has incompatible shape with boxes. Expected ".concat(o,", but was ").concat(t.shape[0])})),be(0<=i&&i<=1,(function(){return"softNmsSigma must be in [0, 1], but was '".concat(i,"'")})),{maxOutputSize:n,iouThreshold:r,scoreThreshold:a,softNmsSigma:i}}var gf=lo({nonMaxSuppression_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=so(e,"boxes","nonMaxSuppression","float32"),o=so(t,"scores","nonMaxSuppression","float32"),s=bf(i,o,n,r,a),u={maxOutputSize:n=s.maxOutputSize,iouThreshold:r=s.iouThreshold,scoreThreshold:a=s.scoreThreshold};return Ji.runKernel(pr,{boxes:i,scores:o},u)}});function yf(e,t,n){var r=function(e,t,n){return function(e,t,n){for(var r=0,a=e.length,i=0,o=!1;r<a;){var s=n(t,e[i=r+(a-r>>>1)]);s>0?r=i+1:(a=i,o=!s)}return o?r:-r-1}(e,t,n||xf)}(e,t,n),a=r<0?-(r+1):r;e.splice(a,0,t)}function xf(e,t){return e>t?1:e<t?-1:0}function kf(e,t,n,r,a){return If(e,t,n,r,a,0)}function wf(e,t,n,r,a,i){return If(e,t,n,r,a,0,!1,i,!0)}function Of(e,t,n,r,a,i){return If(e,t,n,r,a,i,!0)}function If(e,t,n,r,a,i){for(var o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]&&arguments[7],u=arguments.length>8&&void 0!==arguments[8]&&arguments[8],c=[],l=0;l<t.length;l++)t[l]>a&&c.push({score:t[l],boxIndex:l,suppressBeginIndex:0});c.sort(jf);for(var d=i>0?-.5/i:0,p=[],f=[];p.length<n&&c.length>0;){var h=c.pop(),m=h.score,v=h.boxIndex,b=h.suppressBeginIndex;if(m<a)break;for(var g=!1,y=p.length-1;y>=b;--y){var x=Sf(e,v,p[y]);if(x>=r){g=!0;break}if(h.score=h.score*Nf(r,d,x),h.score<=a)break}h.suppressBeginIndex=p.length,g||(h.score===m?(p.push(v),f.push(h.score)):h.score>a&&yf(c,h,jf))}var k=p.length,w=n-k;s&&w>0&&(p.push.apply(p,Object(S.a)(new Array(w).fill(0))),f.push.apply(f,Object(S.a)(new Array(w).fill(0))));var O={selectedIndices:p};return o&&(O.selectedScores=f),u&&(O.validOutputs=k),O}function Sf(e,t,n){var r=e.subarray(4*t,4*t+4),a=e.subarray(4*n,4*n+4),i=Math.min(r[0],r[2]),o=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(a[0],a[2]),l=Math.min(a[1],a[3]),d=Math.max(a[0],a[2]),p=Math.max(a[1],a[3]),f=(s-i)*(u-o),h=(d-c)*(p-l);if(f<=0||h<=0)return 0;var m=Math.max(i,c),v=Math.max(o,l),b=Math.min(s,d),g=Math.min(u,p),y=Math.max(b-m,0)*Math.max(g-v,0);return y/(f+h-y)}function Nf(e,t,n){var r=Math.exp(t*n*n);return n<=e?r:0}function jf(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}function Tf(){return(Tf=Object(w.a)(k.a.mark((function e(t,n,r){var a,i,o,s,u,c,l,d,p,f,h=arguments;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=h.length>3&&void 0!==h[3]?h[3]:.5,i=h.length>4&&void 0!==h[4]?h[4]:Number.NEGATIVE_INFINITY,o=so(t,"boxes","nonMaxSuppressionAsync"),s=so(n,"scores","nonMaxSuppressionAsync"),u=bf(o,s,r,a,i),r=u.maxOutputSize,a=u.iouThreshold,i=u.scoreThreshold,e.next=6,Promise.all([o.data(),s.data()]);case 6:return c=e.sent,l=c[0],d=c[1],p=kf(l,d,r,a,i),f=p.selectedIndices,e.abrupt("return",(o!==t&&o.dispose(),s!==n&&s.dispose(),bp(f,"int32")));case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Cf=function(e,t,n){return Tf.apply(this,arguments)};var Ef=lo({nonMaxSuppressionWithScore_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=so(e,"boxes","nonMaxSuppression"),s=so(t,"scores","nonMaxSuppression"),u=bf(o,s,n,r,a,i),c={boxes:o,scores:s},l={maxOutputSize:n=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:a=u.scoreThreshold,softNmsSigma:i=u.softNmsSigma},d=Ji.runKernel(hr,c,l);return{selectedIndices:d[0],selectedScores:d[1]}}});function _f(){return(_f=Object(w.a)(k.a.mark((function e(t,n,r){var a,i,o,s,u,c,l,d,p,f,h,m,v=arguments;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=v.length>3&&void 0!==v[3]?v[3]:.5,i=v.length>4&&void 0!==v[4]?v[4]:Number.NEGATIVE_INFINITY,o=v.length>5&&void 0!==v[5]?v[5]:0,s=so(t,"boxes","nonMaxSuppressionAsync"),u=so(n,"scores","nonMaxSuppressionAsync"),c=bf(s,u,r,a,i,o),r=c.maxOutputSize,a=c.iouThreshold,i=c.scoreThreshold,o=c.softNmsSigma,e.next=7,Promise.all([s.data(),u.data()]);case 7:return l=e.sent,d=l[0],p=l[1],f=Of(d,p,r,a,i,o),h=f.selectedIndices,m=f.selectedScores,e.abrupt("return",(s!==t&&s.dispose(),u!==n&&u.dispose(),{selectedIndices:bp(h,"int32"),selectedScores:bp(m)}));case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Af=function(e,t,n){return _f.apply(this,arguments)};var Rf=lo({nonMaxSuppressionPadded_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=so(e,"boxes","nonMaxSuppression"),s=so(t,"scores","nonMaxSuppression"),u=bf(o,s,n,r,a,null),c=u.maxOutputSize,l=u.iouThreshold,d=u.scoreThreshold,p={boxes:o,scores:s},f={maxOutputSize:c,iouThreshold:l,scoreThreshold:d,padToMaxOutputSize:i},h=Ji.runKernel(fr,p,f);return{selectedIndices:h[0],validOutputs:h[1]}}});function Df(){return(Df=Object(w.a)(k.a.mark((function e(t,n,r){var a,i,o,s,u,c,l,d,p,f,h,m,v,b,g,x,w=arguments;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=w.length>3&&void 0!==w[3]?w[3]:.5,i=w.length>4&&void 0!==w[4]?w[4]:Number.NEGATIVE_INFINITY,o=w.length>5&&void 0!==w[5]&&w[5],s=so(t,"boxes","nonMaxSuppressionAsync"),u=so(n,"scores","nonMaxSuppressionAsync"),c=bf(s,u,r,a,i,null),l=c.maxOutputSize,d=c.iouThreshold,p=c.scoreThreshold,e.next=11,Promise.all([s.data(),u.data()]);case 11:return f=e.sent,h=Object(y.a)(f,2),m=h[0],v=h[1],b=wf(m,v,l,d,p,o),g=b.selectedIndices,x=b.validOutputs,e.abrupt("return",(s!==t&&s.dispose(),u!==n&&u.dispose(),{selectedIndices:bp(g,"int32"),validOutputs:Uc(x,"int32")}));case 19:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ff=function(e,t,n){return Df.apply(this,arguments)};var Mf=lo({resizeBilinear_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=so(e,"images","resizeBilinear");be(3===a.rank||4===a.rank,(function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank ".concat(a.rank,".")})),be(2===t.length,(function(){return"Error in resizeBilinear: new shape must 2D, but got shape ".concat(t,".")})),be(!1===r||!1===n,(function(){return"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."}));var i=a,o=!1;3===a.rank&&(o=!0,i=Eu(a,[1,a.shape[0],a.shape[1],a.shape[2]])),Object(v.a)(t);var s={images:i},u={alignCorners:n,halfPixelCenters:r,size:t},c=Ji.runKernel(Rr,s,u);return o?Eu(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});var zf=lo({resizeNearestNeighbor_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=so(e,"images","resizeNearestNeighbor");be(3===a.rank||4===a.rank,(function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ".concat(a.rank,".")})),be(2===t.length,(function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape ".concat(t,".")})),be("float32"===a.dtype||"int32"===a.dtype,(function(){return"`images` must have `int32` or `float32` as dtype"})),be(!1===r||!1===n,(function(){return"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."}));var i=a,o=!1;3===a.rank&&(o=!0,i=Eu(a,[1,a.shape[0],a.shape[1],a.shape[2]])),Object(v.a)(t);var s={images:i},u={alignCorners:n,halfPixelCenters:r,size:t},c=Ji.runKernel(_r,s,u);return o?Eu(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});function Lf(e,t){for(var n,r,a,i,o,s,u=bp([-1]),c=bp([0]),l=bp([0]),d=0;d<e.size-1;d++){n=Mu(e,0,d+1),r=Mu(e,d+1),o=Qs(Hc(n),t),s=Qs(Hc(r),t);var p=Hc($s(n,Md(0,n.size)));a=Qs(p,Hc(n));var f=Zu(r.shape,n.size),h=Zs(Md(0,r.size),f),m=$s(r,h);i=Qs(Hc(m),Hc(r));var v=Sl(a,i),b=Sl(a,i),g=$s(o,s);l=$s($s(g,v),b);var y=nl(l,c);c=Oc(y,l,c),u=Oc(y,bp([d]),u)}return u}var Pf=lo({threshold_:function(e){var t,n,r,a,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"binary",o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,u=so(e,"image","threshold"),c=.2989,l=.587,d=.114,p=u.shape[0]*u.shape[1],f=$s(bp([s]),255);if(be(3===u.rank,(function(){return"Error in threshold: image must be rank 3,but got rank ".concat(u.rank,".")})),be(3===u.shape[2]||1===u.shape[2],(function(){return"Error in threshold: image color channel must be equal to 3 or 1but got ".concat(u.shape[2],".")})),be("int32"===u.dtype||"float32"===u.dtype,(function(){return"Error in dtype: image dtype must be int32 or float32,but got dtype ".concat(u.dtype,".")})),be("otsu"===i||"binary"===i,(function(){return"Method must be binary or otsu, but was ".concat(i)})),3===u.shape[2]){var h=cp(u,[1,1,1],-1),m=Object(y.a)(h,3);t=m[0],n=m[1],r=m[2];var v=$s(t,c),b=$s(n,l),g=$s(r,d);a=Zs(Zs(v,b),g)}else a=e;if("otsu"===i){var x=Hu(Ns(qd(a),"int32"),ho([]),256);f=Lf(x,p)}var k=o?ll(a,f):nl(a,f);return Ns($s(k,255),"int32")}});var Bf=lo({transform_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"nearest",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"constant",a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5?arguments[5]:void 0,o=so(e,"image","transform","float32"),s=so(t,"transforms","transform","float32");be(4===o.rank,(function(){return"Error in transform: image must be rank 4,but got rank ".concat(o.rank,".")})),be(2===s.rank&&(s.shape[0]===o.shape[0]||1===s.shape[0])&&8===s.shape[1],(function(){return"Error in transform: Input transform should be batch x 8 or 1 x 8"})),be(null==i||2===i.length,(function(){return"Error in transform: outputShape must be [height, width] or null, but got ".concat(i,".")}));var u={image:o,transforms:s},c={interpolation:n,fillMode:r,fillValue:a,outputShape:i};return Ji.runKernel(ga,u,c)}});var Wf=lo({bandPart_:function(e,t,n){var r=so(e,"a","bandPart");be(r.rank>=2,(function(){return"bandPart(): Rank must be at least 2, got ".concat(r.rank,".")}));var a,i,o=r.shape,s=r.shape.slice(-2),u=Object(y.a)(s,2),c=u[0],l=u[1];"number"==typeof t?(be(t%1===0,(function(){return"bandPart(): numLower must be an integer, got ".concat(t,".")})),be(t<=c,(function(){return"bandPart(): numLower (".concat(t,") must not be greater than the number of rows (").concat(c,").")})),a=so(t<0?c:t,"numLower","bandPart")):(be("int32"===t.dtype,(function(){return"bandPart(): numLower's dtype must be an int32."})),a=Oc(cl(t,0),c,Vl(t,c))),"number"==typeof n?(be(n%1===0,(function(){return"bandPart(): numUpper must be an integer, got ".concat(n,".")})),be(n<=l,(function(){return"bandPart(): numUpper (".concat(n,") must not be greater than the number of columns (").concat(l,").")})),i=so(n<0?l:n,"numUpper","bandPart")):(be("int32"===n.dtype,(function(){return"bandPart(): numUpper's dtype must be an int32."})),i=Oc(cl(n,0),l,Vl(n,l)));var d=Eu(Md(0,c,1,"int32"),[-1,1]),p=Md(0,l,1,"int32"),f=Sl(d,p),h=Tl(ll(f,a),rl(f,wl(i))),m=Bl([c,l],r.dtype);return Eu(fp(Ap(Eu(r,[-1,c,l])).map((function(e){return Oc(h,e,m)}))),o)}});var Uf=lo({gramSchmidt_:function(e){var t;Array.isArray(e)?function(){t=!1,be(null!=e&&e.length>0,(function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"}));for(var n=e[0].shape[0],r=function(t){be(e[t].shape[0]===n,(function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: (".concat(e[t].shape[0]," vs. ").concat(n,")")}))},a=1;a<e.length;++a)r(a)}():(t=!0,e=cp(e,e.shape[0],0).map((function(e){return pp(e,[0])}))),be(e.length<=e[0].shape[0],(function(){return"Gram-Schmidt: Number of vectors (".concat(e.length,") exceeds number of dimensions (").concat(e[0].shape[0],").")}));for(var n=[],r=e,a=function(e){n.push(Ji.tidy((function(){var t=r[e];if(e>0)for(var a=0;a<e;++a){var i=$s(Hc($s(n[a],t)),n[a]);t=Sl(t,i)}return Qs(t,Kc(t,"euclidean"))})))},i=0;i<e.length;++i)a(i);return t?fp(n,0):n}});function Vf(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Ji.tidy((function(){be(2===e.shape.length,(function(){return"qr2d() requires a 2D Tensor, but got a ".concat(e.shape.length,"D Tensor.")}));for(var n=e.shape[0],r=e.shape[1],a=$c(n),i=js(e),o=gp([[1]],[1,1]),s=js(o),u=n>=r?r:n,c=function(e){var t,u,c=i,l=s,d=a;t=Ji.tidy((function(){var t=Mu(i,[e,e],[n-e,1]),u=Kc(t),c=Mu(i,[e,e],[1,1]),l=Oc(nl(c,0),gp([[-1]]),gp([[1]])),d=Sl(c,$s(l,u)),p=Qs(t,d);s=1===p.shape[0]?js(o):Ru([o,Mu(p,[1,0],[p.shape[0]-1,p.shape[1]])],0);var f=wl(Qs(Du(l,d),u)),h=Mu(i,[e,0],[n-e,r]),m=$s(f,s),v=Bp(s);if(0===e)i=Sl(h,Du(m,Du(v,h)));else{var b=Sl(h,Du(m,Du(v,h)));i=Ru([Mu(i,[0,0],[e,r]),b],0)}var g=Bp(m),y=Mu(a,[0,e],[n,a.shape[1]-e]);if(0===e)a=Sl(y,Du(Du(y,s),g));else{var x=Sl(y,Du(Du(y,s),g));a=Ru([Mu(a,[0,0],[n,e]),x],1)}return[s,i,a]})),u=Object(y.a)(t,3),s=u[0],i=u[1],a=u[2],Ls([c,l,d])},l=0;l<u;++l)c(l);return!t&&n>r&&(a=Mu(a,[0,0],[n,r]),i=Mu(i,[0,0],[r,r])),[a,i]}))}var Gf,Hf=lo({qr_:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(be(e.rank>=2,(function(){return"qr() requires input tensor to have a rank >= 2, but got rank ".concat(e.rank)})),2===e.rank)return Vf(e,t);var n=e.shape.slice(0,e.shape.length-2).reduce((function(e,t){return e*t})),r=Ap(Eu(e,[n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),a=[],i=[];r.forEach((function(e){var n=Vf(e,t),r=Object(y.a)(n,2),o=r[0],s=r[1];a.push(o),i.push(s)}));var o=Eu(fp(a,0),e.shape),s=Eu(fp(i,0),e.shape);return[o,s]}});!function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(Gf||(Gf={}));var qf=lo({computeWeightedLoss_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Gf.SUM_BY_NONZERO_WEIGHTS,r=so(e,"losses","computeWeightedLoss"),a=null;null!=t&&(a=so(t,"weights","computeWeightedLoss"));var i=null==a?r:$s(r,a);if(n===Gf.NONE)return i;if(n===Gf.SUM)return Hc(i);if(n===Gf.MEAN){if(null==a)return Pl(i);var o=r.size/a.size,s=Qs(Hc(i),Hc(a));return o>1?Qs(s,Uc(o)):s}if(n===Gf.SUM_BY_NONZERO_WEIGHTS){if(null==a)return Qs(Hc(i),Uc(r.size));var u=$s(a,Wl(r.shape)),c=Ns(Hc(Yl(u,Uc(0))),"float32");return Qs(Hc(i),c)}throw Error("Unknown reduction: ".concat(n))}});var Kf=lo({absoluteDifference_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Gf.SUM_BY_NONZERO_WEIGHTS,a=so(e,"labels","absoluteDifference"),i=so(t,"predictions","absoluteDifference"),o=null;null!=n&&(o=so(n,"weights","absoluteDifference")),ge(a.shape,i.shape,"Error in absoluteDifference: ");var s=eu(Sl(a,i));return qf(s,o,r)}});var Xf=lo({cosineDistance_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Gf.SUM_BY_NONZERO_WEIGHTS,i=so(e,"labels","cosineDistance"),o=so(t,"predictions","cosineDistance"),s=null;null!=r&&(s=so(r,"weights","cosineDistance")),ge(i.shape,o.shape,"Error in cosineDistance: ");var u=Uc(1),c=Sl(u,Hc($s(i,o),n,!0));return qf(c,s,a)}});var Yf=lo({hingeLoss_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Gf.SUM_BY_NONZERO_WEIGHTS,a=so(e,"labels","hingeLoss"),i=so(t,"predictions","hingeLoss"),o=null;null!=n&&(o=so(n,"weights","hingeLoss")),ge(a.shape,i.shape,"Error in hingeLoss: ");var s=Uc(1);a=Sl($s(Uc(2),a),s);var u=Pd(Sl(s,$s(a,i)));return qf(u,o,r)}});var Zf=lo({huberLoss_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Gf.SUM_BY_NONZERO_WEIGHTS,i=so(e,"labels","huberLoss"),o=so(t,"predictions","huberLoss"),s=null;null!=n&&(s=so(n,"weights","huberLoss")),ge(i.shape,o.shape,"Error in huberLoss: ");var u=Uc(r),c=eu(Sl(o,i)),l=Vl(c,u),d=Sl(c,l),p=Zs($s(Uc(.5),Gc(l)),$s(u,d));return qf(p,s,a)}});var Jf=lo({logLoss_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e-7,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Gf.SUM_BY_NONZERO_WEIGHTS,i=so(e,"labels","logLoss"),o=so(t,"predictions","logLoss"),s=null;null!=n&&(s=so(n,"weights","logLoss")),ge(i.shape,o.shape,"Error in logLoss: ");var u=Uc(1),c=Uc(r),l=wl($s(i,fl(Zs(o,c)))),d=$s(Sl(u,i),fl(Zs(Sl(u,o),c))),p=Sl(l,d);return qf(p,s,a)}});var Qf=lo({meanSquaredError_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Gf.SUM_BY_NONZERO_WEIGHTS,a=so(e,"labels","meanSquaredError"),i=so(t,"predictions","meanSquaredError"),o=null;null!=n&&(o=so(n,"weights","meanSquaredError")),ge(a.shape,i.shape,"Error in meanSquaredError: ");var s=dp(a,i);return qf(s,o,r)}});function $f(e,t){var n=so(e,"labels","sigmoidCrossEntropyWithLogits"),r=so(t,"logits","sigmoidCrossEntropyWithLogits");ge(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var a=Pd(r),i=$s(r,n),o=hl(Yc(wl(eu(r))));return Zs(Sl(a,i),o)}var eh=lo({sigmoidCrossEntropy_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Gf.SUM_BY_NONZERO_WEIGHTS,i=so(e,"multiClassLabels","sigmoidCrossEntropy"),o=so(t,"logits","sigmoidCrossEntropy"),s=null;if(null!=n&&(s=so(n,"weights","sigmoidCrossEntropy")),ge(i.shape,o.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=Uc(r),c=Uc(1),l=Uc(.5);i=Zs($s(i,Sl(c,u)),$s(l,u))}var d=$f(i,o);return qf(d,s,a)}});function th(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(-1===n&&(n=t.rank-1),n!==t.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ".concat(t.rank," and dim was ").concat(n));return xl((function(e,t,r){var a=jl(t,[n],!0),i=Sl(Ns(t,"float32"),a);r([e,i]);var o=wl($s(i,e));return{value:Hc(o,[n]),gradFunc:function(e,t){var r=Object(y.a)(t,2),a=r[0],i=r[1],o=Dc(e.shape,[n]);return[$s(Eu(e,o),Sl(Ns(a,"float32"),Yc(i))),$s(Eu(e,o),Sl(Yc(i),Ns(a,"float32")))]}}}))(e,t)}var nh=lo({softmaxCrossEntropy_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Gf.SUM_BY_NONZERO_WEIGHTS,i=so(e,"onehotLabels","softmaxCrossEntropy"),o=so(t,"logits","softmaxCrossEntropy"),s=null;if(null!=n&&(s=so(n,"weights","softmaxCrossEntropy")),ge(i.shape,o.shape,"Error in softmaxCrossEntropy: "),r>0){var u=Uc(r),c=Uc(1),l=Uc(i.shape[1]);i=Zs($s(i,Sl(c,u)),Qs(u,l))}var d=th(i,o);return qf(d,s,a)}});var rh=lo({sparseFillEmptyRows_:function(e,t,n,r){var a=so(e,"indices","sparseFillEmptyRows","int32"),i=so(t,"values","sparseFillEmptyRows"),o=so(n,"denseShape","sparseFillEmptyRows","int32"),s=so(r,"defaultValue","sparseFillEmptyRows",i.dtype);if(2!==a.rank)throw new Error("Indices should be Tensor2D but received shape\n        ".concat(a.shape));if(1!==i.rank)throw new Error("Values should be Tensor1D but received shape ".concat(i.shape));if(1!==o.rank)throw new Error("Dense shape should be Tensor1D but received shape ".concat(o.shape));if(0!==s.rank)throw new Error("Default value should be a scalar but received shape ".concat(s.shape));var u={indices:a,values:i,denseShape:o,defaultValue:s},c=Ji.runKernel(ta,u);return{outputIndices:c[0],outputValues:c[1],emptyRowIndicator:c[2],reverseIndexMap:c[3]}}});var ah=lo({sparseReshape_:function(e,t,n){var r=so(e,"inputIndices","sparseReshape","int32"),a=so(t,"inputShape","sparseReshape","int32"),i=so(n,"newShape","sparseReshape","int32");if(2!==r.rank)throw new Error("Input indices should be Tensor2D but received shape\n        ".concat(r.shape));if(1!==a.rank)throw new Error("Input shape should be Tensor1D but received shape ".concat(a.shape));if(1!==i.rank)throw new Error("New shape should be Tensor1D but received shape ".concat(i.shape));var o={inputIndices:r,inputShape:a,newShape:i},s=Ji.runKernel(na,o);return{outputIndices:s[0],outputShape:s[1]}}});var ih=lo({sparseSegmentMean_:function(e,t,n){var r=so(e,"data","sparseSegmentMean"),a=so(t,"indices","sparseSegmentMean","int32"),i=so(n,"segmentIds","sparseSegmentMean","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.rank)throw new Error("Indices should be Tensor1D but received shape\n          ".concat(a.shape));if(1!==i.rank)throw new Error("Segment ids should be Tensor1D but received shape\n          ".concat(i.shape));var o={data:r,indices:a,segmentIds:i};return Ji.runKernel(ra,o)}});var oh=lo({sparseSegmentSum_:function(e,t,n){var r=so(e,"data","sparseSegmentSum"),a=so(t,"indices","sparseSegmentSum","int32"),i=so(n,"segmentIds","sparseSegmentSum","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.rank)throw new Error("Indices should be Tensor1D but received shape\n         ".concat(a.shape));if(1!==i.rank)throw new Error("Segment ids should be Tensor1D but received shape\n         ".concat(i.shape));var o={data:r,indices:a,segmentIds:i};return Ji.runKernel(aa,o)}});var sh=lo({stringNGrams_:function(e,t,n,r,a,i,o,s){var u=so(e,"data","stringNGrams","string");if("string"!==u.dtype)throw new Error("Data must be of datatype string");if(1!==u.shape.length)throw new Error("Data must be a vector, saw: ".concat(u.shape));var c=so(t,"dataSplits","stringNGrams");if("int32"!==c.dtype)throw new Error("Data splits must be of datatype int32");var l={separator:n,nGramWidths:r,leftPad:a,rightPad:i,padWidth:o,preserveShortSequences:s},d={data:u,dataSplits:c},p=Ji.runKernel(la,d,l);return{nGrams:p[0],nGramsSplits:p[1]}}});var uh=lo({stringSplit_:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=so(e,"input","stringSplit","string"),a=so(t,"delimiter","stringSplit","string");if(1!==r.rank)throw new Error("Input should be Tensor1D but received shape ".concat(r.shape));if(0!==a.rank)throw new Error("Delimiter should be a scalar but received shape ".concat(a.shape));var i={skipEmpty:n},o={input:r,delimiter:a},s=Ji.runKernel(da,o,i);return{indices:s[0],values:s[1],shape:s[2]}}});var ch=lo({stringToHashBucketFast_:function(e,t){var n=so(e,"input","stringToHashBucketFast","string"),r={numBuckets:t};if(t<=0)throw new Error("Number of buckets must be at least 1");var a={input:n};return Ji.runKernel(pa,a,r)}});var lh=lo({staticRegexReplace_:function(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=so(e,"input","staticRegexReplace","string"),i={pattern:t,rewrite:n,replaceGlobal:r};return Ji.runKernel(ua,{x:a},i)}}),dh={fft:op,ifft:sp,rfft:lp,irfft:up},ph={hammingWindow:cf,hannWindow:lf,frame:df,stft:pf},fh={flipLeftRight:hf,grayscaleToRGB:mf,resizeNearestNeighbor:zf,resizeBilinear:Mf,rotateWithOffset:vf,cropAndResize:ff,nonMaxSuppression:gf,nonMaxSuppressionAsync:Cf,nonMaxSuppressionWithScore:Ef,nonMaxSuppressionWithScoreAsync:Af,nonMaxSuppressionPadded:Rf,nonMaxSuppressionPaddedAsync:Ff,threshold:Pf,transform:Bf},hh={bandPart:Wf,gramSchmidt:Uf,qr:Hf},mh={absoluteDifference:Kf,computeWeightedLoss:qf,cosineDistance:Xf,hingeLoss:Yf,huberLoss:Zf,logLoss:Jf,meanSquaredError:Qf,sigmoidCrossEntropy:eh,softmaxCrossEntropy:nh},vh={sparseFillEmptyRows:rh,sparseReshape:ah,sparseSegmentMean:ih,sparseSegmentSum:oh},bh={stringNGrams:sh,stringSplit:uh,stringToHashBucketFast:ch,staticRegexReplace:lh},gh={};z(gh,{Serializable:function(){return yh},SerializationMap:function(){return xh},registerClass:function(){return kh}});var yh=function(){function e(){Object(O.a)(this,e)}return Object(I.a)(e,[{key:"getClassName",value:function(){return this.constructor.className}}],[{key:"fromConfig",value:function(e,t){return new e(t)}}]),e}(),xh=function(){function e(){Object(O.a)(this,e),this.classNameMap={}}return Object(I.a)(e,null,[{key:"getMap",value:function(){return null==e.instance&&(e.instance=new e),e.instance}},{key:"register",value:function(t){e.getMap().classNameMap[t.className]=[t,t.fromConfig]}}]),e}();function kh(e){be(null!=e.className,(function(){return"Class being registered does not have the static className property defined."})),be("string"==typeof e.className,(function(){return"className is required to be a string, but got type "+typeof e.className})),be(e.className.length>0,(function(){return"Class being registered has an empty-string as its className, which is disallowed."})),xh.register(e)}var wh=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){return Object(O.a)(this,n),t.apply(this,arguments)}return Object(I.a)(n,[{key:"minimize",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0,r=this.computeGradients(e,n),a=r.value,i=r.grads;if(null!=n){var o=n.map((function(e){return{name:e.name,tensor:i[e.name]}}));this.applyGradients(o)}else this.applyGradients(i);return Ls(i),t?a:(a.dispose(),null)}},{key:"incrementIterations",value:function(){this.iterations_=this.iterations+1}},{key:"computeGradients",value:function(e,t){return yl(e,t)}},{key:"dispose",value:function(){null!=this.iterations_&&Ls(this.iterations_)}},{key:"saveIterations",value:function(){var e=Object(w.a)(k.a.mark((function e(){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(null==this.iterations_&&(this.iterations_=0),{name:"iter",tensor:Uc(this.iterations_,"int32")}));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getWeights",value:function(){var e=Object(w.a)(k.a.mark((function e(){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("getWeights() is not implemented for this optimizer yet.");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=Object(w.a)(k.a.mark((function e(t){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("setWeights() is not implemented for this optimizer class ".concat(this.getClassName()));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"extractIterations",value:function(){var e=Object(w.a)(k.a.mark((function e(t){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t[0].tensor.data();case 2:return this.iterations_=e.sent[0],e.abrupt("return",t.slice(1));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"iterations",get:function(){return null==this.iterations_&&(this.iterations_=0),this.iterations_}}]),n}(yh);Object.defineProperty(wh,Symbol.hasInstance,{value:function(e){return null!=e.minimize&&null!=e.computeGradients&&null!=e.applyGradients}});var Oh=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return Object(O.a)(this,n),(a=t.call(this)).learningRate=e,a.rho=r,a.epsilon=i,a.accumulatedGrads=[],a.accumulatedUpdates=[],null==i&&(a.epsilon=Ji.backend.epsilon()),a}return Object(I.a)(n,null,[{key:"className",get:function(){return"Adadelta"}}]),Object(I.a)(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=Ji.registeredVariables[n];null==t.accumulatedGrads[r]&&(t.accumulatedGrads[r]={originalName:"".concat(n,"/accum_grad"),variable:zs((function(){return Ic(a).variable(!1)}))}),null==t.accumulatedUpdates[r]&&(t.accumulatedUpdates[r]={originalName:"".concat(n,"/accum_var"),variable:zs((function(){return Ic(a).variable(!1)}))});var i=Array.isArray(e)?e[r].tensor:e[n];if(null!=i){var o=t.accumulatedGrads[r].variable,s=t.accumulatedUpdates[r].variable;zs((function(){var e=Zs($s(o,t.rho),$s(Gc(i),1-t.rho)),n=$s(Qs(Vc(Zs(s,t.epsilon)),Vc(Zs(o,t.epsilon))),i),r=Zs($s(s,t.rho),$s(Gc(n),1-t.rho));o.assign(e),s.assign(r);var u=Zs($s(n,-t.learningRate),a);a.assign(u)}))}})),this.incrementIterations()}},{key:"dispose",value:function(){null!=this.accumulatedUpdates&&(Ls(this.accumulatedGrads.map((function(e){return e.variable}))),Ls(this.accumulatedUpdates.map((function(e){return e.variable}))))}},{key:"getWeights",value:function(){var e=Object(w.a)(k.a.mark((function e(){var t;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[].concat(Object(S.a)(this.accumulatedGrads),Object(S.a)(this.accumulatedUpdates)),e.next=3,this.saveIterations();case 3:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(t.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=Object(w.a)(k.a.mark((function e(t){var n;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,n=t.length/2,!1,this.accumulatedGrads=t.slice(0,n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),this.accumulatedUpdates=t.slice(n,2*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.rho,t.epsilon)}}]),n}(wh),Ih=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1;return Object(O.a)(this,n),(r=t.call(this)).learningRate=e,r.initialAccumulatorValue=a,r.accumulatedGrads=[],r}return Object(I.a)(n,null,[{key:"className",get:function(){return"Adagrad"}}]),Object(I.a)(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=Ji.registeredVariables[n];null==t.accumulatedGrads[r]&&(t.accumulatedGrads[r]={originalName:"".concat(n,"/accumulator"),variable:zs((function(){return Zu(a.shape,t.initialAccumulatorValue).variable(!1)}))});var i=Array.isArray(e)?e[r].tensor:e[n];if(null!=i){var o=t.accumulatedGrads[r].variable;zs((function(){var e=Zs(o,Gc(i));o.assign(e);var n=Zs($s(Qs(i,Vc(Zs(e,Ji.backend.epsilon()))),-t.learningRate),a);a.assign(n)}))}})),this.incrementIterations()}},{key:"dispose",value:function(){null!=this.accumulatedGrads&&Ls(this.accumulatedGrads.map((function(e){return e.variable})))}},{key:"getWeights",value:function(){var e=Object(w.a)(k.a.mark((function e(){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.saveIterations();case 2:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(this.accumulatedGrads.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=Object(w.a)(k.a.mark((function e(t){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,!1,this.accumulatedGrads=t.map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}}]),n}(wh),Sh=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e,r,a){var i,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return Object(O.a)(this,n),(i=t.call(this)).learningRate=e,i.beta1=r,i.beta2=a,i.epsilon=o,i.accumulatedFirstMoment=[],i.accumulatedSecondMoment=[],zs((function(){i.accBeta1=Uc(r).variable(),i.accBeta2=Uc(a).variable()})),null==o&&(i.epsilon=Ji.backend.epsilon()),i}return Object(I.a)(n,null,[{key:"className",get:function(){return"Adam"}}]),Object(I.a)(n,[{key:"applyGradients",value:function(e){var t=this,n=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e);zs((function(){var r=Sl(1,t.accBeta1),a=Sl(1,t.accBeta2);n.forEach((function(n,i){var o=Ji.registeredVariables[n];null==t.accumulatedFirstMoment[i]&&(t.accumulatedFirstMoment[i]={originalName:"".concat(n,"/m"),variable:zs((function(){return Ic(o).variable(!1)}))}),null==t.accumulatedSecondMoment[i]&&(t.accumulatedSecondMoment[i]={originalName:"".concat(n,"/v"),variable:zs((function(){return Ic(o).variable(!1)}))});var s=Array.isArray(e)?e[i].tensor:e[n];if(null!=s){var u=t.accumulatedFirstMoment[i].variable,c=t.accumulatedSecondMoment[i].variable,l=Zs($s(u,t.beta1),$s(s,1-t.beta1)),d=Zs($s(c,t.beta2),$s(Gc(s),1-t.beta2)),p=Qs(l,r),f=Qs(d,a);u.assign(l),c.assign(d);var h=Zs($s(Qs(p,Zs(Vc(f),t.epsilon)),-t.learningRate),o);o.assign(h)}})),t.accBeta1.assign($s(t.accBeta1,t.beta1)),t.accBeta2.assign($s(t.accBeta2,t.beta2))})),this.incrementIterations()}},{key:"dispose",value:function(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&Ls(this.accumulatedFirstMoment.map((function(e){return e.variable}))),null!=this.accumulatedSecondMoment&&Ls(this.accumulatedSecondMoment.map((function(e){return e.variable})))}},{key:"getWeights",value:function(){var e=Object(w.a)(k.a.mark((function e(){var t;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[].concat(Object(S.a)(this.accumulatedFirstMoment),Object(S.a)(this.accumulatedSecondMoment)),e.next=3,this.saveIterations();case 3:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(t.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=Object(w.a)(k.a.mark((function e(t){var n,r=this;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,zs((function(){r.accBeta1.assign(Wc(r.beta1,r.iterations_+1)),r.accBeta2.assign(Wc(r.beta2,r.iterations_+1))})),n=t.length/2,!1,this.accumulatedFirstMoment=t.slice(0,n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),this.accumulatedSecondMoment=t.slice(n,2*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}}]),n}(wh),Nh=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e,r,a){var i,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return Object(O.a)(this,n),(i=t.call(this)).learningRate=e,i.beta1=r,i.beta2=a,i.epsilon=o,i.decay=s,i.accumulatedFirstMoment=[],i.accumulatedWeightedInfNorm=[],zs((function(){i.iteration=Uc(0).variable(),i.accBeta1=Uc(r).variable()})),null==o&&(i.epsilon=Ji.backend.epsilon()),i}return Object(I.a)(n,null,[{key:"className",get:function(){return"Adamax"}}]),Object(I.a)(n,[{key:"applyGradients",value:function(e){var t=this,n=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e);zs((function(){var r=Sl(1,t.accBeta1),a=Qs(-t.learningRate,Zs($s(t.iteration,t.decay),1));n.forEach((function(n,i){var o=Ji.registeredVariables[n];null==t.accumulatedFirstMoment[i]&&(t.accumulatedFirstMoment[i]={originalName:"".concat(n,"/m"),variable:Ic(o).variable(!1)}),null==t.accumulatedWeightedInfNorm[i]&&(t.accumulatedWeightedInfNorm[i]={originalName:"".concat(n,"/v"),variable:Ic(o).variable(!1)});var s=Array.isArray(e)?e[i].tensor:e[n];if(null!=s){var u=t.accumulatedFirstMoment[i].variable,c=t.accumulatedWeightedInfNorm[i].variable,l=Zs($s(u,t.beta1),$s(s,1-t.beta1)),d=$s(c,t.beta2),p=eu(s),f=Ll(d,p);u.assign(l),c.assign(f);var h=Zs($s(Qs(a,r),Qs(l,Zs(f,t.epsilon))),o);o.assign(h)}})),t.iteration.assign(Zs(t.iteration,1)),t.accBeta1.assign($s(t.accBeta1,t.beta1))})),this.incrementIterations()}},{key:"dispose",value:function(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&Ls(this.accumulatedFirstMoment.map((function(e){return e.variable}))),null!=this.accumulatedWeightedInfNorm&&Ls(this.accumulatedWeightedInfNorm.map((function(e){return e.variable})))}},{key:"getWeights",value:function(){var e=Object(w.a)(k.a.mark((function e(){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("getWeights() is not implemented for Adamax yet.");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=Object(w.a)(k.a.mark((function e(t){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("setWeights() is not implemented for Adamax yet.");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}}]),n}(wh),jh=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(O.a)(this,n),(r=t.call(this)).learningRate=e,r.setLearningRate(e),r}return Object(I.a)(n,null,[{key:"className",get:function(){return"SGD"}}]),Object(I.a)(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=Array.isArray(e)?e[r].tensor:e[n];if(null!=a){var i=Ji.registeredVariables[n];zs((function(){var e=Zs($s(t.c,a),i);i.assign(e)}))}})),this.incrementIterations()}},{key:"setLearningRate",value:function(e){this.learningRate=e,null!=this.c&&this.c.dispose(),this.c=Ps(Uc(-e))}},{key:"dispose",value:function(){this.c.dispose()}},{key:"getWeights",value:function(){var e=Object(w.a)(k.a.mark((function e(){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.saveIterations();case 2:return e.t0=e.sent,e.abrupt("return",[e.t0]);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=Object(w.a)(k.a.mark((function e(t){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:if(0===(t=e.sent).length){e.next=5;break}throw new Error("SGD optimizer does not have settable weights.");case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate)}}]),n}(wh),Th=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Object(O.a)(this,n),(a=t.call(this,e)).learningRate=e,a.momentum=r,a.useNesterov=i,a.accumulations=[],a.m=Uc(a.momentum),a}return Object(I.a)(n,null,[{key:"className",get:function(){return"Momentum"}}]),Object(I.a)(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=Ji.registeredVariables[n];null==t.accumulations[r]&&(t.accumulations[r]={originalName:"".concat(n,"/momentum"),variable:zs((function(){return Ic(a).variable(!1)}))});var i=t.accumulations[r].variable,o=Array.isArray(e)?e[r].tensor:e[n];null!=o&&zs((function(){var e,n=Zs($s(t.m,i),o);e=t.useNesterov?Zs($s(t.c,Zs(o,$s(n,t.m))),a):Zs($s(t.c,n),a),i.assign(n),a.assign(e)}))})),this.incrementIterations()}},{key:"dispose",value:function(){this.m.dispose(),null!=this.accumulations&&Ls(this.accumulations.map((function(e){return e.variable})))}},{key:"setMomentum",value:function(e){this.momentum=e}},{key:"getWeights",value:function(){var e=Object(w.a)(k.a.mark((function e(){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.saveIterations();case 2:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(this.accumulations.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=Object(w.a)(k.a.mark((function e(t){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,!1,this.accumulations=t.map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}}]),n}(jh),Ch=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(Object(O.a)(this,n),(r=t.call(this)).learningRate=e,r.decay=a,r.momentum=i,r.epsilon=o,r.accumulatedMeanSquares=[],r.accumulatedMoments=[],r.accumulatedMeanGrads=[],r.centered=s,null==o&&(r.epsilon=Ji.backend.epsilon()),null==e)throw new Error("learningRate for RMSPropOptimizer must be defined.");return Object(m.a)(r)}return Object(I.a)(n,null,[{key:"className",get:function(){return"RMSProp"}}]),Object(I.a)(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=Ji.registeredVariables[n];null==t.accumulatedMeanSquares[r]&&(t.accumulatedMeanSquares[r]={originalName:"".concat(n,"/rms"),variable:zs((function(){return Ic(a).variable(!1)}))}),null==t.accumulatedMoments[r]&&(t.accumulatedMoments[r]={originalName:"".concat(n,"/momentum"),variable:zs((function(){return Ic(a).variable(!1)}))}),null==t.accumulatedMeanGrads[r]&&t.centered&&(t.accumulatedMeanGrads[r]={originalName:"".concat(n,"/mg"),variable:zs((function(){return Ic(a).variable(!1)}))});var i=Array.isArray(e)?e[r].tensor:e[n];if(null!=i){var o=t.accumulatedMeanSquares[r].variable,s=t.accumulatedMoments[r].variable;zs((function(){var e=Zs($s(o,t.decay),$s(Gc(i),1-t.decay));if(t.centered){var n=t.accumulatedMeanGrads[r].variable,u=Zs($s(n,t.decay),$s(i,1-t.decay)),c=Qs($s(i,t.learningRate),Vc(Sl(e,Zs(Gc(u),t.epsilon)))),l=Zs($s(s,t.momentum),c);o.assign(e),n.assign(u),s.assign(l);var d=Sl(a,l);a.assign(d)}else{var p=Zs($s(o,t.decay),$s(Gc(i),1-t.decay)),f=Zs($s(s,t.momentum),Qs($s(i,t.learningRate),Vc(Zs(p,t.epsilon))));o.assign(p),s.assign(f);var h=Sl(a,f);a.assign(h)}}))}})),this.incrementIterations()}},{key:"dispose",value:function(){null!=this.accumulatedMeanSquares&&Ls(this.accumulatedMeanSquares.map((function(e){return e.variable}))),null!=this.accumulatedMeanGrads&&this.centered&&Ls(this.accumulatedMeanGrads.map((function(e){return e.variable}))),null!=this.accumulatedMoments&&Ls(this.accumulatedMoments.map((function(e){return e.variable})))}},{key:"getWeights",value:function(){var e=Object(w.a)(k.a.mark((function e(){var t;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[].concat(Object(S.a)(this.accumulatedMeanSquares),Object(S.a)(this.accumulatedMoments)),this.centered&&t.push.apply(t,Object(S.a)(this.accumulatedMeanGrads)),e.next=4,this.saveIterations();case 4:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(t.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=Object(w.a)(k.a.mark((function e(t){var n;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,n=this.centered?t.length/3:t.length/2,!1,this.accumulatedMeanSquares=t.slice(0,n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),this.accumulatedMoments=t.slice(n,2*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),this.centered&&(this.accumulatedMeanGrads=t.slice(2*n,3*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}}]),n}(wh),Eh=[Oh,Ih,Sh,Nh,Th,Ch,jh];var _h={};z(_h,{CompositeArrayBuffer:function(){return vo},browserFiles:function(){return Fh},browserHTTPRequest:function(){return Kh},concatenateArrayBuffers:function(){return So},copyModel:function(){return bs},decodeWeights:function(){return yo},encodeWeights:function(){return bo},fromMemory:function(){return Jh},fromMemorySync:function(){return Qh},getLoadHandlers:function(){return Lo},getModelArtifactsForJSON:function(){return Co},getModelArtifactsForJSONSync:function(){return To},getModelArtifactsInfoForJSON:function(){return _o},getSaveHandlers:function(){return zo},getWeightSpecs:function(){return Ao},http:function(){return qh},isHTTPScheme:function(){return Gh},listModels:function(){return fs},loadWeights:function(){return Ph},moveModel:function(){return ys},registerLoadRouter:function(){return Mo},registerSaveRouter:function(){return Fo},removeModel:function(){return ms},weightsLoaderFactory:function(){return Wh},withSaveHandler:function(){return $h},withSaveHandlerSync:function(){return em}});function Ah(e){return new Promise((function(e){return setTimeout(e)})).then(e)}var Rh=function(){function e(t){if(Object(O.a)(this,e),!st().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(e.URL_SCHEME)&&(t=t.slice(e.URL_SCHEME.length)),(null==t||0===t.length)&&(t="model"),this.modelJsonFileName=t+".json",this.weightDataFileName=t+".weights.bin"}return Object(I.a)(e,[{key:"save",value:function(){var e=Object(w.a)(k.a.mark((function e(t){var n,r,a,i,o,s,u;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"!=typeof document){e.next=2;break}throw new Error("Browser downloads are not supported in this environment since `document` is not present");case 2:if(n=vo.join(t.weightData),r=window.URL.createObjectURL(new Blob([n],{type:"application/octet-stream"})),!(t.modelTopology instanceof ArrayBuffer)){e.next=5;break}throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 5:return a=[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}],i=jo(t,a),o=window.URL.createObjectURL(new Blob([JSON.stringify(i)],{type:"application/json"})),(s=null==this.modelJsonAnchor?document.createElement("a"):this.modelJsonAnchor).download=this.modelJsonFileName,s.href=o,e.next=10,Ah((function(){return s.dispatchEvent(new MouseEvent("click"))}));case 10:if(null==t.weightData){e.next=16;break}return(u=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,u.href=r,e.next=16,Ah((function(){return u.dispatchEvent(new MouseEvent("click"))}));case 16:return e.abrupt("return",{modelArtifactsInfo:_o(t)});case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();Rh.URL_SCHEME="downloads://";var Dh=function(){function e(t){if(Object(O.a)(this,e),null==t||t.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received ".concat(t));this.jsonFile=t[0],this.weightsFiles=t.slice(1)}return Object(I.a)(e,[{key:"load",value:function(){var e=Object(w.a)(k.a.mark((function e(){var t=this;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=new FileReader;r.onload=function(r){var a=JSON.parse(r.target.result),i=a.modelTopology;if(null!=i)if(null!=a.weightsManifest)if(0!==t.weightsFiles.length){var o=Co(a,(function(e){return t.loadWeights(e)}));e(o)}else e({modelTopology:i});else n(new Error("weightManifest field is missing from file ".concat(t.jsonFile.name)));else n(new Error("modelTopology field is missing from file ".concat(t.jsonFile.name)))},r.onerror=function(e){return n("Failed to read model topology and weights manifest JSON from file '".concat(t.jsonFile.name,"'. BrowserFiles supports loading Keras-style tf.Model artifacts only."))},r.readAsText(t.jsonFile)})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"loadWeights",value:function(e){var t,n=this,r=[],a=[],i=Object(N.a)(e);try{for(i.s();!(t=i.n()).done;){var o=t.value;r.push.apply(r,Object(S.a)(o.weights)),a.push.apply(a,Object(S.a)(o.paths))}}catch(c){i.e(c)}finally{i.f()}var s=this.checkManifestAndWeightFiles(e),u=a.map((function(e){return n.loadWeightsFile(e,s[e])}));return Promise.all(u).then((function(e){return[r,e]}))}},{key:"loadWeightsFile",value:function(e,t){return new Promise((function(n,r){var a=new FileReader;a.onload=function(e){var t=e.target.result;n(t)},a.onerror=function(t){return r("Failed to weights data from file of path '".concat(e,"'."))},a.readAsArrayBuffer(t)}))}},{key:"checkManifestAndWeightFiles",value:function(e){var t,n=this,r=[],a=this.weightsFiles.map((function(e){return No(e.name)})),i={},o=Object(N.a)(e);try{for(o.s();!(t=o.n()).done;){t.value.paths.forEach((function(e){var t=No(e);if(-1!==r.indexOf(t))throw new Error("Duplicate file basename found in weights manifest: '".concat(t,"'"));if(r.push(t),-1===a.indexOf(t))throw new Error("Weight file with basename '".concat(t,"' is not provided."));i[e]=n.weightsFiles[a.indexOf(t)]}))}}catch(s){o.e(s)}finally{o.f()}if(r.length!==this.weightsFiles.length)throw new Error("Mismatch in the number of files in weights manifest (".concat(r.length,") and the number of weight files provided (").concat(this.weightsFiles.length,")."));return i}}]),e}();function Fh(e){return new Dh(e)}function Mh(e,t,n,r){var a;be(null!=(a=e)&&Array.isArray(a)&&a.length>0,(function(){return"promises must be a none empty array"})),function(e,t){be(e>=0&&e<=1,(function(){return"Progress fraction must be in range [0, 1], but got startFraction ".concat(e)})),be(t>=0&&t<=1,(function(){return"Progress fraction must be in range [0, 1], but got endFraction ".concat(t)})),be(t>=e,(function(){return"startFraction must be no more than endFraction, but got startFraction ".concat(e," and endFraction ").concat(t)}))}(n=null==n?0:n,r=null==r?1:r);var i=0;return Promise.all(e.map((function(a){return a.then((function(a){var o=n+ ++i/e.length*(r-n);return t(o),a})),a})))}function zh(e,t){return Lh.apply(this,arguments)}function Lh(){return(Lh=Object(w.a)(k.a.mark((function e(t,n){var r,a,i,o,s,u,c;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n&&(n={}),r=null==n.fetchFunc?st().platform.fetch:n.fetchFunc,a=t.map((function(e){return r(e,n.requestInit,{isBinary:!0})})),i=0,o=.5,null!=n.onProgress){e.next=11;break}return e.next=8,Promise.all(a);case 8:e.t0=e.sent,e.next=14;break;case 11:return e.next=13,Mh(a,n.onProgress,i,o);case 13:e.t0=e.sent;case 14:if(s=e.t0.map((function(e){return e.arrayBuffer()})),u=.5,c=1,null!=n.onProgress){e.next=23;break}return e.next=20,Promise.all(s);case 20:e.t1=e.sent,e.next=26;break;case 23:return e.next=25,Mh(s,n.onProgress,u,c);case 25:e.t1=e.sent;case 26:return e.abrupt("return",e.t1);case 27:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ph(e){return Bh.apply(this,arguments)}function Bh(){return(Bh=Object(w.a)(k.a.mark((function e(t){var n,r,a,i=arguments;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:"",r=i.length>2?i[2]:void 0,a=i.length>3?i[3]:void 0,e.abrupt("return",Wh((function(e){return zh(e,{requestInit:a})}))(t,n,r));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Wh(e){return function(){var t=Object(w.a)(k.a.mark((function t(n){var r,a,i,o,s,u,c,l,d,p,f,h,m=arguments;return k.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=m.length>1&&void 0!==m[1]?m[1]:"",a=m.length>2?m[2]:void 0,i=n.map((function(){return!1})),o={},s=null!=a?a.map((function(){return!1})):[],u=[],n.forEach((function(e,t){var n=0;e.weights.forEach((function(e){var r="quantization"in e?e.quantization.dtype:e.dtype,c=mo[r]*xe(e.shape),l=function(){i[t]=!0,null==o[t]&&(o[t]=[]),o[t].push({manifestEntry:e,groupOffset:n,sizeBytes:c})};null!=a?a.forEach((function(t,n){t===e.name&&(l(),s[n]=!0)})):l(),u.push(e.name),n+=c}))})),s.every((function(e){return e}))){t.next=6;break}throw c=a.filter((function(e,t){return!s[t]})),new Error("Could not find weights in manifest with names: ".concat(c.join(", "),". \nManifest JSON has weights with names: ").concat(u.join(", "),"."));case 6:return l=i.reduce((function(e,t,n){return t&&e.push(n),e}),[]),d=[],l.forEach((function(e){n[e].paths.forEach((function(e){var t=r+(r.endsWith("/")?"":"/")+e;d.push(t)}))})),t.next=10,e(d);case 10:return p=t.sent,f={},h=0,t.abrupt("return",(l.forEach((function(e){var t=n[e].paths.length,r=new vo(p.slice(h,h+t));o[e].forEach((function(e){var t=yo(r.slice(e.groupOffset,e.groupOffset+e.sizeBytes),[e.manifestEntry]);for(var n in t)f[n]=t[n]})),h+=t})),f));case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}Do.registerSaveRouter((function(e){return st().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Rh.URL_SCHEME)?function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"model";return new Rh(e)}(e.slice(Rh.URL_SCHEME.length)):null}));var Uh=function(){function e(t,n){if(Object(O.a)(this,e),this.DEFAULT_METHOD="POST",null==n&&(n={}),this.weightPathPrefix=n.weightPathPrefix,this.onProgress=n.onProgress,this.weightUrlConverter=n.weightUrlConverter,null!=n.fetchFunc?(be("function"==typeof n.fetchFunc,(function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"})),this.fetch=n.fetchFunc):this.fetch=st().platform.fetch,be(null!=t&&t.length>0,(function(){return"URL path for http must not be null, undefined or empty."})),Array.isArray(t)&&be(2===t.length,(function(){return"URL paths for http must have a length of 2, (actual length is ".concat(t.length,").")})),this.path=t,null!=n.requestInit&&null!=n.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=n.requestInit||{}}return Object(I.a)(e,[{key:"save",value:function(){var e=Object(w.a)(k.a.mark((function e(t){var n,r,a,i,o;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=2;break}throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");case 2:return(n=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,r=[{paths:["./model.weights.bin"],weights:t.weightSpecs}],a=jo(t,r),n.body.append("model.json",new Blob([JSON.stringify(a)],{type:"application/json"}),"model.json"),null!=t.weightData&&(i=vo.join(t.weightData),n.body.append("model.weights.bin",new Blob([i],{type:"application/octet-stream"}),"model.weights.bin")),e.next=8,this.fetch(this.path,n);case 8:if(!(o=e.sent).ok){e.next=11;break}return e.abrupt("return",{modelArtifactsInfo:_o(t),responses:[o]});case 11:throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status ".concat(o.status,"."));case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=Object(w.a)(k.a.mark((function e(){var t,n,r,a,i,o=this;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetch(this.path,this.requestInit);case 2:if((t=e.sent).ok){e.next=5;break}throw new Error("Request to ".concat(this.path," failed with status code ").concat(t.status,". Please verify this URL points to the model JSON of the model to load."));case 5:return e.prev=5,e.next=8,t.json();case 8:n=e.sent,e.next=15;break;case 11:throw e.prev=11,e.t0=e.catch(5),r="Failed to parse model JSON of response from ".concat(this.path,"."),this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 15:if(a=n.modelTopology,i=n.weightsManifest,null!=a||null!=i){e.next=18;break}throw new Error("The JSON from HTTP path ".concat(this.path," contains neither model topology or manifest for weights."));case 18:return e.abrupt("return",Co(n,(function(e){return o.loadWeights(e)})));case 19:case"end":return e.stop()}}),e,this,[[5,11]])})));return function(){return e.apply(this,arguments)}}()},{key:"loadWeights",value:function(){var e=Object(w.a)(k.a.mark((function e(t){var n,r,a,i,o,s,u,c,l,d,p,f,h,m,v,b;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Array.isArray(this.path)?this.path[1]:this.path,r=Vh(n),a=Object(y.a)(r,2),i=a[0],o=a[1],s=this.weightPathPrefix||i,u=Ao(t),c=[],l=[],d=Object(N.a)(t);try{for(d.s();!(p=d.n()).done;){f=p.value,h=Object(N.a)(f.paths);try{for(h.s();!(m=h.n()).done;)v=m.value,null!=this.weightUrlConverter?l.push(this.weightUrlConverter(v)):c.push(s+v+o)}catch(g){h.e(g)}finally{h.f()}}}catch(g){d.e(g)}finally{d.f()}if(e.t0=this.weightUrlConverter,!e.t0){e.next=13;break}return e.t1=c.push,e.t2=c,e.t3=S.a,e.next=10,Promise.all(l);case 10:e.t4=e.sent,e.t5=(0,e.t3)(e.t4),e.t1.apply.call(e.t1,e.t2,e.t5);case 13:return e.next=15,zh(c,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress});case 15:return b=e.sent,e.abrupt("return",[u,b]);case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();function Vh(e){var t=e.lastIndexOf("/"),n=e.lastIndexOf("?");return[e.substring(0,t)+"/",n>t?e.substring(n):""]}function Gh(e){return null!=e.match(Uh.URL_SCHEME_REGEX)}Uh.URL_SCHEME_REGEX=/^https?:\/\//;var Hh=function(e,t){if("undefined"==typeof fetch&&(null==t||null==t.fetchFunc))return null;return(Array.isArray(e)?e.every((function(e){return Gh(e)})):Gh(e))?qh(e,t):null};function qh(e,t){return new Uh(e,t)}function Kh(e,t){return qh(e,t)}Do.registerSaveRouter(Hh),Do.registerLoadRouter(Hh);var Xh=function(){function e(t){Object(O.a)(this,e),this.modelArtifacts=t}return Object(I.a)(e,[{key:"load",value:function(){return this.modelArtifacts}}]),e}(),Yh=function(){function e(t){Object(O.a)(this,e),this.saveHandler=t}return Object(I.a)(e,[{key:"save",value:function(e){return this.saveHandler(e)}}]),e}(),Zh=function e(t){Object(O.a)(this,e),t.load&&(this.load=function(){return Promise.resolve(t.load())}),t.save&&(this.save=function(e){return Promise.resolve(t.save(e))})};function Jh(e,t,n,r){var a=arguments;return new Zh(Qh.apply(void 0,Object(S.a)(a)))}function Qh(e,t,n,r){return 1===arguments.length?null!=e.modelTopology||null!=e.weightSpecs?new Xh(e):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Xh({modelTopology:e})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Xh({modelTopology:e,weightSpecs:t,weightData:n,trainingConfig:r}))}function $h(e){return new Yh(e)}function em(e){return new Yh(e)}var tm={};z(tm,{confusionMatrix:function(){return nm}});var nm=lo({confusionMatrix_:function(e,t,n){var r=so(e,"labels","confusionMatrix"),a=so(t,"predictions","confusionMatrix");be(null==n||n>0&&Number.isInteger(n),(function(){return"If provided, numClasses must be a positive integer, but got ".concat(n)})),be(1===r.rank,(function(){return"Expected the rank of labels to be 1, but got ".concat(r.rank)})),be(1===a.rank,(function(){return"Expected the rank of predictions to be 1, but got ".concat(a.rank)})),be(r.shape[0]===a.shape[0],(function(){return"Mismatch in the number of examples: ".concat(r.shape[0]," vs. ").concat(a.shape[0],". Labels and predictions should have the same number of elements.")})),be(n>0&&Number.isInteger(n),(function(){return"numClasses is required to be a positive integer, but got ".concat(n)}));var i=Zl(Ns(r,"int32"),n),o=Zl(Ns(a,"int32"),n),s=Bp(i),u=Du(s,o);return Ns(u,"int32")}}),rm={};z(rm,{draw:function(){return fm},fromPixels:function(){return hm},fromPixelsAsync:function(){return um},toPixels:function(){return dm}});var am,im=!1;function om(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;if(t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==e)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n=!1,r=!1,a=!1,i=!1,o=!1,s=!1;if(e.data instanceof Uint8Array)n=!0;else if("undefined"!=typeof ImageData&&e instanceof ImageData)r=!0;else if("undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement)a=!0;else if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement)i=!0;else if(null!=e.getContext)o=!0;else{if(!("undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap))throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ".concat(e.constructor.name));s=!0}if(null!=Fa(Na,Ji.backendName)){var u={pixels:e},c={numChannels:t};return Ji.runKernel(Na,u,c)}var l,d,p=a?[e.videoWidth,e.videoHeight]:[e.width,e.height],f=Object(y.a)(p,2),h=f[0],m=f[1];if(o)l=e.getContext("2d").getImageData(0,0,h,m).data;else if(r||n)l=e.data;else if(i||a||s){if(null==am)if("undefined"==typeof document){if("undefined"==typeof OffscreenCanvas||"undefined"==typeof OffscreenCanvasRenderingContext2D)throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");am=new OffscreenCanvas(1,1).getContext("2d")}else am=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});am.canvas.width=h,am.canvas.height=m,am.drawImage(e,0,0,h,m),l=am.getImageData(0,0,h,m).data}if(4===t)d=new Int32Array(l);else{var v=h*m;d=new Int32Array(v*t);for(var b=0;b<v;b++)for(var g=0;g<t;++g)d[b*t+g]=l[4*b+g]}return yp(d,[m,h,t],"int32")}function sm(e){return"undefined"!=typeof window&&"undefined"!=typeof ImageBitmap&&window.hasOwnProperty("createImageBitmap")&&!(e instanceof ImageBitmap)&&function(e){return null!=e&&0!==e.width&&0!==e.height}(e)&&!function(e){return null!=e&&e.data instanceof Uint8Array}(e)}function um(e){return cm.apply(this,arguments)}function cm(){return(cm=Object(w.a)(k.a.mark((function e(t){var n,r,a,i=arguments;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=i.length>1&&void 0!==i[1]?i[1]:3,r=null,!st().getBool("WRAP_TO_IMAGEBITMAP")||!sm(t)){e.next=15;break}return e.prev=3,e.next=6,createImageBitmap(t,{premultiplyAlpha:"none"});case 6:a=e.sent,e.next=12;break;case 9:e.prev=9,e.t0=e.catch(3),a=null;case 12:r=null!=a&&a.width===t.width&&a.height===t.height?a:t,e.next=16;break;case 15:r=t;case 16:return e.abrupt("return",om(r,n));case 17:case"end":return e.stop()}}),e,null,[[3,9]])})))).apply(this,arguments)}function lm(e){if(2!==e.rank&&3!==e.rank)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank ".concat(e.rank,"."));var t=2===e.rank?1:e.shape[2];if(t>4||2===t)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got ".concat(t));if("float32"!==e.dtype&&"int32"!==e.dtype)throw new Error("Unsupported type for toPixels: ".concat(e.dtype,". Please use float32 or int32 tensors."))}function dm(e,t){return pm.apply(this,arguments)}function pm(){return(pm=Object(w.a)(k.a.mark((function e(t,n){var r,a,i,o,s,u,c,l,d,p,f,h,m,v,b,g,x;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=so(t,"img","toPixels"),t instanceof Ti||(r=Ns(a=r,"int32"),a.dispose()),lm(r),i=r.shape.slice(0,2),o=Object(y.a)(i,2),s=o[0],u=o[1],c=2===r.rank?1:r.shape[2],e.next=10,r.data();case 10:l=e.sent,d="float32"===r.dtype?255:1,p=new Uint8ClampedArray(u*s*4),f=0;case 14:if(!(f<s*u)){e.next=35;break}h=[0,0,0,255],m=0;case 17:if(!(m<c)){e.next=30;break}if(v=l[f*c+m],"float32"!==r.dtype){e.next=24;break}if(!(v<0||v>1)){e.next=22;break}throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ".concat(v,"."));case 22:e.next=26;break;case 24:if("int32"!==r.dtype||!(v<0||v>255)){e.next=26;break}throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ".concat(v,"."));case 26:1===c?(h[0]=v*d,h[1]=v*d,h[2]=v*d):h[m]=v*d;case 27:m++,e.next=17;break;case 30:p[(b=4*f)+0]=Math.round(h[0]),p[b+1]=Math.round(h[1]),p[b+2]=Math.round(h[2]),p[b+3]=Math.round(h[3]);case 32:++f,e.next=14;break;case 35:return null!=n&&(im||(console.warn("tf.browser.toPixels is not efficient to draw tensor on canvas. Please try tf.browser.draw instead."),im=!0),n.width=u,n.height=s,g=n.getContext("2d"),x=new ImageData(p,u,s),g.putImageData(x,0,0)),e.abrupt("return",(r!==t&&r.dispose(),p));case 37:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function fm(e,t,n){var r=so(e,"img","draw");if(!(e instanceof Ti)){var a=r;r=Ns(a,"int32"),a.dispose()}lm(r),function(e){var t=(null==e?void 0:e.alpha)||1;if(t>1||t<0)throw new Error("Alpha value ".concat(t," is suppoed to be in range [0 - 1]."))}(null==n?void 0:n.imageOptions);var i={image:r},o={canvas:t,options:n};Ji.runKernel(cn,i,o)}var hm=lo({fromPixels_:om}),mm={};function vm(e,t){var n=e.shape.length,r=t.shape.length;if(n<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was ".concat(n,"."));if(r<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ".concat(r,"."));if("int32"!==t.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was ".concat(t.dtype,"."));if(t.shape[r-1]>n)throw new Error("index innermost dimension length must be <= tensor rank; saw: ".concat(t.shape[r-1]," vs. ").concat(n));if(0===xe(e.shape))throw new Error("Requested more than 0 entries, but input is empty. Input shape: ".concat(e.shape,"."));for(var a=t.shape,i=a[a.length-1],o=1,s=0;s<a.length-1;++s)o*=a[s];var u=e.shape,c=a.slice();c.pop();for(var l=1,d=i;d<n;++d)l*=u[d],c.push(u[d]);var p=[].concat(Object(S.a)(qe(e.shape).map((function(e){return e/l}))),[1]).slice(0,i);return[c,o,l,p]}z(mm,{prepareAndValidate:function(){return vm}});var bm={};z(bm,{assertParamsValid:function(){return gm},computeFlatOffset:function(){return _m},computeOutShape:function(){return xm},getNormalizedAxes:function(){return Im},isSliceContinous:function(){return Em},maskToAxes:function(){return ym},parseSliceParams:function(){return Am},sliceInfo:function(){return Rm},startForAxis:function(){return Tm},startIndicesWithElidedDims:function(){return Sm},stopForAxis:function(){return Cm},stopIndicesWithElidedDims:function(){return Nm},stridesForAxis:function(){return jm},stridesWithElidedDims:function(){return km}});function gm(e,t,n){var r=e.shape.length;be(r===t.length,(function(){return"Error in slice".concat(r,"D: Length of begin ").concat(t," must match the rank of the array (").concat(r,").")})),be(r===n.length,(function(){return"Error in slice".concat(r,"D: Length of size ").concat(n," must match the rank of the array (").concat(r,").")}));for(var a=function(a){be(t[a]+n[a]<=e.shape[a],(function(){return"Error in slice".concat(r,"D: begin[").concat(a,"] + size[").concat(a,"] (").concat(t[a]+n[a],") would overflow input.shape[").concat(a,"] (").concat(e.shape[a],")")}))},i=0;i<r;++i)a(i)}function ym(e){for(var t=[],n=0;e>0;)1&e&&t.push(n),e/=2,n++;return t}function xm(e,t,n){for(var r=[],a=0;a<e.length;a++)r[a]=Math.ceil((t[a]-e[a])/n[a]);return r}function km(e,t,n,r){for(var a=Object(S.a)(e),i=a.length;i<r.length;i++)a.push(1);for(var o=0;o<n;o++)0===o?a[t]=1:(a.splice(t,0,1),a.pop());return a}function wm(e,t,n){return n<=e?n:n-(t-1)}function Om(e,t){for(var n=[],r=0;r<e;r++)n.push(t+r);return n}function Im(e,t,n,r,a,i,o,s,u){var c=e.length,l=new Array(c),d=new Array(c),p=new Array(c);if(t.length&&n>0){var f=t[0],h=n+1;l=Sm(o,f,h,r,e),d=Nm(s,f,h,a,e),p=km(i,f,h,e)}else for(var m=0;m<c;m++)l[m]=Tm(o,r,i,e,m,u),d[m]=Cm(s,a,i,e,m,u),p[m]=jm(i,m,u);return{begin:l,end:d,strides:p}}function Sm(e,t,n,r,a){for(var i=Object(S.a)(a),o=Om(n,t),s=0;s<i.length;s++)if(o.indexOf(s)>-1)i[s]=0;else{var u=wm(t,n,s),c=r[u];e&1<<u&&(c=0),i[s]=c}return i}function Nm(e,t,n,r,a){for(var i=Object(S.a)(a),o=Om(n,t),s=0;s<i.length;s++)if(o.indexOf(s)>-1)i[s]=Number.MAX_SAFE_INTEGER;else{var u=wm(t,n,s),c=r[u];e&1<<u&&(c=Number.MAX_SAFE_INTEGER),i[s]=c}for(var l=0;l<i.length;l++){var d=a[l];i[l]<0&&(i[l]+=d),i[l]=de(0,i[l],a[l])}return i}function jm(e,t,n){var r=e[t];return(n&1<<t||null==r)&&(r=1),r}function Tm(e,t,n,r,a,i){var o=t[a],s=n[a]||1;(e&1<<a||i&1<<a||null==o)&&(o=s>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var u=r[a];return o<0&&(o+=u),o=de(0,o,u-1)}function Cm(e,t,n,r,a,i){var o=t[a],s=n[a]||1;(e&1<<a||i&1<<a||null==o)&&(o=s>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var u=r[a];return o<0&&(o+=u),o=s>0?de(0,o,u):de(-1,o,u-1)}function Em(e,t,n){for(var r=n.length,a=0;a<n.length;a++)if(n[a]>1){r=a;break}for(var i=r+1;i<n.length;i++)if(t[i]>0||n[i]!==e[i])return!1;return!0}function _m(e,t){for(var n=e.length>0?e[e.length-1]:1,r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}function Am(e,t,n){var r,a,i=e.shape.length;return(r="number"==typeof t?[t].concat(Object(S.a)(new Array(i-1).fill(0))):t.length<i?t.concat(new Array(i-t.length).fill(0)):t.slice()).forEach((function(e){be(-1!==e,(function(){return"slice() does not support negative begin indexing."}))})),a=(a=null==n?new Array(i).fill(-1):"number"==typeof n?[n].concat(Object(S.a)(new Array(i-1).fill(-1))):n.length<i?n.concat(new Array(i-n.length).fill(-1)):n).map((function(t,n){return t>=0?t:(be(-1===t,(function(){return"Negative size values should be exactly -1 but got ".concat(t," for the slice() size at index ").concat(n,".")})),e.shape[n]-r[n])})),[r,a]}function Rm(e,t,n,r,a,i,o,s,u){var c;if(null==r?(c=new Array(t.length)).fill(1):c=r,null!=o&&o&o-1)throw new Error("Multiple ellipses in slice is not allowed.");for(var l=!1,d={dims:c.length,numAddAxisAfterEllipsis:0,begin:t.slice(),end:n.slice(),strides:c.slice(),beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u},p=0;p<d.dims;p++)l&&1<<p&s&&d.numAddAxisAfterEllipsis++,1<<p&o&&(l=!0);l||(d.ellipsisMask|=1<<d.dims,d.dims++);var f={dims:e.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};!function(e,t){t.beginMask=0,t.endMask=0,t.shrinkAxisMask=0;var n=0;t.beginValid=null!=e.begin,t.endValid=null!=e.end,t.begin=new Array(t.dims),t.end=new Array(t.dims),t.strides=new Array(t.dims),t.finalShapeGatherIndices=[],t.finalShapeGatherIndicesSparse=[],t.inputShapeGatherIndicesSparse=new Array(t.dims);for(var r=0;r<e.dims;r++)if(1<<r&e.ellipsisMask)for(var a=Math.min(t.dims-(e.dims-r)+1+e.numAddAxisAfterEllipsis,t.dims);n<a;n++)t.begin[n]=0,t.end[n]=0,t.strides[n]=1,t.beginMask|=1<<n,t.endMask|=1<<n,t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(-1),t.inputShapeGatherIndicesSparse[n]=r;else if(1<<r&e.newAxisMask)t.finalShapeGatherIndices.push(-2),t.finalShapeGatherIndicesSparse.push(-1);else{if(n===t.begin.length)throw Error("Index out of range using input dim ".concat(n,"; input has only ").concat(t.dims," dims, ").concat(t.begin.length,"."));null!=e.begin&&(t.begin[n]=e.begin[r]),null!=e.end&&(t.end[n]=e.end[r]),t.strides[n]=e.strides[r],e.beginMask&1<<r&&(t.beginMask|=1<<n),e.endMask&1<<r&&(t.endMask|=1<<n),e.shrinkAxisMask&1<<r?(t.finalShapeGatherIndices.push(-1),t.finalShapeGatherIndicesSparse.push(-1),t.shrinkAxisMask|=1<<n):(t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(r)),t.inputShapeGatherIndicesSparse[n]=r,n++}}(d,f);for(var h=!0,m=!0,v=!0,b=[],g=[],y=0;y<e.length;++y){if(0===f.strides[y])throw Error("strides[".concat(y,"] must be non-zero"));var x=!!(f.shrinkAxisMask&1<<y),k=e[y];if(-1!==k){var w=[f.beginMask&1<<y,f.endMask&1<<y],O=[f.strides[y]>0?0:-1,f.strides[y]>0?k:k-1];if(x&&f.strides[y]<=0)throw Error("only stride 1 allowed on non-range indexing.");v=v&&1===f.strides[y];var I=!!(f.beginMask&1<<y&&f.endMask&1<<y);if(f.beginValid&&f.endValid){if(x){var S=f.begin[y]<0?k+f.begin[y]:f.begin[y];if(f.begin[y]=S,f.end[y]=f.begin[y]+1,S<0||S>=k)throw Error("slice index ".concat(f.begin[y]," of dimension ").concat(y," out of bounds."))}else f.begin[y]=Dm(f.begin[y],0,f.strides[y],k,w,O),f.end[y]=Dm(f.end[y],1,f.strides[y],k,w,O);var N=1===f.strides[y]&&0===f.begin[y]&&f.end[y]===k;h=h&&N,m=m&&(0===y&&1===f.strides[y]||N)}else h=h&&1===f.strides[y]&&I,m=m&&(0===y&&1===f.strides[y]||I);var j=void 0,T=!1;if(f.beginValid&&f.endValid?(j=f.end[y]-f.begin[y],T=!0):x?(j=1,T=!0):I&&k>=0&&(j=f.strides[y]<0?-k:k,T=!0),T){var C=void 0;C=0===j||j<0!=f.strides[y]<0?0:Math.trunc(j/f.strides[y])+(j%f.strides[y]!==0?1:0),b.push(C)}else b.push(-1)}else b.push(x?1:-1)}for(var E=0;E<f.finalShapeGatherIndices.length;++E){var _=f.finalShapeGatherIndices[E];_>=0?g.push(b[_]):-2===_&&g.push(1)}return{finalShapeSparse:g.filter((function(e,t){return-2!==f.finalShapeGatherIndices[t]})),finalShape:g,isIdentity:h,sliceDim0:m,isSimpleSlice:v,begin:f.begin,end:f.end,strides:f.strides}}function Dm(e,t,n,r,a,i){if(a[t])return n>0?i[t]:i[t+1&1];var o=e<0?r+e:e;return o<i[0]?i[0]:o>i[1]?i[1]:o}var Fm="4.7.0",Mm=function(){function e(){Object(O.a)(this,e)}return Object(I.a)(e,null,[{key:"sgd",value:function(e){return new jh(e)}},{key:"momentum",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return new Th(e,t,n)}},{key:"rmsprop",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return new Ch(e,t,n,r,a)}},{key:"adam",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.001,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.999,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return new Sh(e,t,n,r)}},{key:"adadelta",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.001,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.95,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return new Oh(e,t,n)}},{key:"adamax",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.002,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.999,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return new Nh(e,t,n,r,a)}},{key:"adagrad",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1;return new Ih(e,t)}}]),e}(),zm=Mm,Lm="undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof s?s:function(e){return e()};function Pm(){return new Promise((function(e){return Lm((function(){return e()}))}))}var Bm,Wm={};function Um(e,t){var n=e[0].length;e.forEach((function(e,t){be(e.length===n,(function(){return"Error in concat".concat(n,"D: rank of tensors[").concat(t,"] must be the same as the rank of the rest (").concat(n,")")}))})),be(t>=0&&t<n,(function(){return"Error in concat".concat(n,"D: axis must be between 0 and ").concat(n-1,".")}));var r=e[0];e.forEach((function(e,a){for(var i=0;i<n;i++)be(i===t||e[i]===r[i],(function(){return"Error in concat".concat(n,"D: Shape of tensors[").concat(a,"] (").concat(e,") does not match the shape of the rest (").concat(r,") along the non-concatenated axis ").concat(a,".")}))}))}function Vm(e,t){for(var n=e[0].slice(),r=1;r<e.length;r++)n[t]+=e[r][t];return n}function Gm(e,t,n){var r=new Array;if(null==n&&null==t)return r;if(null==t)for(;r.length<e+n.length;)r.push(-1);else r=t.slice();if(null==n)return r;if(e+n.length!==r.length)throw new Error("rt input.shape and shape=".concat(t," are incompatible: rt input.rank = ").concat(e+n.length,", but shape.rank = ").concat(r.length));for(var a=1;a<n.length;++a){var i=n[a],o=r[r.length-n.length+a],s=r[o];if(i>=0)if(s>=0){if(s!==i)throw new Error("rt input.shape and shape=".concat(t," are incompatible: rt input.shape[").concat(a+e,"] = ").concat(i," but shape[").concat(a+e,"] = ").concat(s))}else r[o]=i}return r}function Hm(e){var t,n={FIRST_DIM_SIZE:Bm.FIRST_DIM_SIZE,VALUE_ROWIDS:Bm.VALUE_ROWIDS,ROW_LENGTHS:Bm.ROW_LENGTHS,ROW_SPLITS:Bm.ROW_SPLITS,ROW_LIMITS:Bm.ROW_LIMITS,ROW_STARTS:Bm.ROW_STARTS},r=[],a=Object(N.a)(e);try{for(a.s();!(t=a.n()).done;){var i=t.value;if(!(i in n))break;r.push(n[i])}}catch(o){a.e(o)}finally{a.f()}return r}function qm(e){return 0===e.length?0:e[0]===Bm.FIRST_DIM_SIZE?e.length-1:e.length}function Km(e,t){if(null!=e&&null!=t){var n=e.length,r=t.length;if(n>=r)throw new Error("defaultValue.shape=".concat(e," and ragged tensor flatValues.shape=").concat(t,", are incompatible: defaultValue.rank = ").concat(n," must be less than ragged tensor input flatValues.rank = ").concat(r,")"));for(var a=0;a<Math.min(n,r-1);++a){var i=e[a],o=t[a+1];if(i>=0&&o>=0&&1!==i&&i!==o)throw new Error("defaultValue.shape=".concat(e,", and ragged tensor input flatValues.shape=").concat(t," are incompatible: defaultValue.shape[").concat(a-e.length,"] = ").concat(i," but ragged tensor input.flatValues.shape[").concat(a-e.length,"] = ").concat(o))}}}z(Wm,{ERF_A1:function(){return iv},ERF_A2:function(){return ov},ERF_A3:function(){return sv},ERF_A4:function(){return uv},ERF_A5:function(){return cv},ERF_P:function(){return av},PARALLELIZE_THRESHOLD:function(){return Xm},RowPartitionType:function(){return Bm},SELU_SCALE:function(){return rv},SELU_SCALEALPHA:function(){return nv},applyActivation:function(){return tf},assertAndGetBroadcastShape:function(){return kc},assertAxesAreInnerMostDims:function(){return Fc},assertParamsConsistent:function(){return Um},assignToTypedArray:function(){return mv},axesAreInnerMostDims:function(){return _c},calculateShapes:function(){return Np},checkEinsumDimSizes:function(){return kv},checkPadOnDimRoundingMode:function(){return Cu},combineLocations:function(){return Ac},combineRaggedTensorToTensorShapes:function(){return Gm},complexWithEvenIndex:function(){return pv},complexWithOddIndex:function(){return fv},computeConv2DInfo:function(){return vu},computeConv3DInfo:function(){return bu},computeDefaultPad:function(){return gu},computeDilation2DInfo:function(){return fu},computeOptimalWindowSize:function(){return Ym},computeOutAndReduceShapes:function(){return Rc},computeOutShape:function(){return Vm},computePool2DInfo:function(){return hu},computePool3DInfo:function(){return mu},convertConv2DDataFormat:function(){return Tu},decodeEinsumEquation:function(){return yv},eitherStridesOrDilationsAreOne:function(){return Nu},expandShapeToKeepDim:function(){return Dc},exponent:function(){return bv},exponents:function(){return vv},fromStringArrayToUint8:function(){return Vv},fromUint8ToStringArray:function(){return Uv},getAxesPermutation:function(){return Mc},getBroadcastDims:function(){return yc},getComplexWithIndex:function(){return hv},getEinsumComputePath:function(){return wv},getEinsumPermutation:function(){return xv},getFusedBiasGradient:function(){return ef},getFusedDyActivation:function(){return $p},getImageCenter:function(){return Zm},getInnerMostAxes:function(){return Lc},getPermuted:function(){return Qm},getRaggedRank:function(){return qm},getReductionAxes:function(){return xc},getReshaped:function(){return Jm},getReshapedPermuted:function(){return $m},getRowPartitionTypesHelper:function(){return Hm},getSliceBeginCoords:function(){return ev},getSliceSize:function(){return tv},getSparseFillEmptyRowsIndicesDenseShapeMismatch:function(){return Nv},getSparseFillEmptyRowsNegativeIndexErrorMessage:function(){return jv},getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:function(){return Tv},getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:function(){return _v},getSparseReshapeInputOutputMismatchErrorMessage:function(){return Rv},getSparseReshapeInputOutputMultipleErrorMessage:function(){return Av},getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:function(){return Cv},getSparseReshapeNegativeOutputDimErrorMessage:function(){return Ev},getSparseSegmentReductionIndicesOutOfRangeErrorMessage:function(){return zv},getSparseSegmentReductionNegativeSegmentIdsErrorMessage:function(){return Dv},getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:function(){return Fv},getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:function(){return Mv},getUndoAxesPermutation:function(){return zc},isIdentityPermutation:function(){return Ov},log:function(){return Aa},mergeRealAndImagArrays:function(){return lv},prepareAndValidate:function(){return vm},prepareSplitSize:function(){return Sv},segment_util:function(){return Lv},shouldFuse:function(){return nf},slice_util:function(){return bm},splitRealAndImagArrays:function(){return dv},stridesOrDilationsArePositive:function(){return ju},tupleValuesAreOne:function(){return Su},upcastType:function(){return Li},validateDefaultValueShape:function(){return Km},validateInput:function(){return Sp},validateUpdateShape:function(){return Ip},warn:function(){return _a}}),function(e){e[e.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",e[e.VALUE_ROWIDS=1]="VALUE_ROWIDS",e[e.ROW_LENGTHS=2]="ROW_LENGTHS",e[e.ROW_SPLITS=3]="ROW_SPLITS",e[e.ROW_LIMITS=4]="ROW_LIMITS",e[e.ROW_STARTS=5]="ROW_STARTS"}(Bm||(Bm={}));var Xm=30;function Ym(e){return e<=Xm?e:He(e,Math.floor(Math.sqrt(e)))}function Zm(e,t,n){return[n*("number"==typeof e?e:e[0]),t*("number"==typeof e?e:e[1])]}function Jm(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=[];if(r)(a=a.concat(t.slice(0))).push(e[0]/n),a=a.concat(e.slice(1));else{a=a.concat(e[0]);for(var i=t.length,o=0;o<i;++o)a=a.concat([e[o+1]/t[o],t[o]]);a=a.concat(e.slice(i+1))}return a}function Qm(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=[];if(n){r.push(t);for(var a=t+1;a<e;++a)a<=2*t?(r.push(a),r.push(a-(t+1))):r.push(a)}else{for(var i=[],o=[],s=1;s<e;++s)s>=2*t+1||s%2===1?o.push(s):i.push(s);r.push.apply(r,i),r.push(0),r.push.apply(r,o)}return r}function $m(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=[];r?a.push(e[0]/n):a.push(e[0]*n);for(var i=1;i<e.length;++i)i<=t.length?r?a.push(t[i-1]*e[i]):a.push(e[i]/t[i-1]):a.push(e[i]);return a}function ev(e,t){for(var n=[0],r=0;r<t;++r)n.push(e[r][0]);return n}function tv(e,t,n){for(var r=e.slice(0,1),a=0;a<n;++a)r.push(e[a+1]-t[a][0]-t[a][1]);return r}var nv=1.7580993408473768,rv=1.0507009873554805,av=.3275911,iv=.254829592,ov=-.284496736,sv=1.421413741,uv=-1.453152027,cv=1.061405429;function lv(e,t){if(e.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:".concat(e.length,", imag: ").concat(t.length,"."));for(var n=new Float32Array(2*e.length),r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}function dv(e){for(var t=new Float32Array(e.length/2),n=new Float32Array(e.length/2),r=0;r<e.length;r+=2)t[r/2]=e[r],n[r/2]=e[r+1];return{real:t,imag:n}}function pv(e){for(var t=Math.ceil(e.length/4),n=new Float32Array(t),r=new Float32Array(t),a=0;a<e.length;a+=4)n[Math.floor(a/4)]=e[a],r[Math.floor(a/4)]=e[a+1];return{real:n,imag:r}}function fv(e){for(var t=Math.floor(e.length/4),n=new Float32Array(t),r=new Float32Array(t),a=2;a<e.length;a+=4)n[Math.floor(a/4)]=e[a],r[Math.floor(a/4)]=e[a+1];return{real:n,imag:r}}function hv(e,t){return{real:e[2*t],imag:e[2*t+1]}}function mv(e,t,n,r){e[2*r]=t,e[2*r+1]=n}function vv(e,t){for(var n=new Float32Array(e/2),r=new Float32Array(e/2),a=0;a<Math.ceil(e/2);a++){var i=(t?2:-2)*Math.PI*(a/e);n[a]=Math.cos(i),r[a]=Math.sin(i)}return{real:n,imag:r}}function bv(e,t,n){var r=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(r),imag:Math.sin(r)}}var gv=/->/g;function yv(e,t){var n=((e=e.replace(/\s/g,"")).length-e.replace(gv,"").length)/"->".length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error('Equation must contain exactly one arrow ("'.concat("->",'").'));var r=e.split("->"),a=Object(y.a)(r,2),i=a[0],o=a[1];be(-1===i.indexOf("..."),(function(){return'The ellipsis notation ("'.concat("...",'") is not supported yet.')}));var s=i.split(","),u=s.length;if(t!==u)throw new Error("Expected ".concat(u," input tensors, received ").concat(t));if(u>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");for(var c=[],l=function(e){var t=o[e];if(!s.some((function(e){return-1!==e.indexOf(t)})))throw new Error("Output subscripts contain the label ".concat(t," not present in the input subscripts."));-1===c.indexOf(t)&&c.push(t)},d=0;d<o.length;++d)l(d);for(var p=0;p<i.length;++p){var f=i[p];-1===c.indexOf(f)&&","!==f&&c.push(f)}for(var h=new Array(s.length),m=0;m<u;++m){if(new Set(s[m].split("")).size!==s[m].length)throw new Error("Found duplicate axes in input component ".concat(s[m],". Support for duplicate axes in input is not implemented yet."));h[m]=[];for(var v=0;v<s[m].length;++v)h[m].push(c.indexOf(s[m][v]))}for(var b=c.length,g=[],x=o.length;x<b;++x)g.push(x);return{allDims:c,summedDims:g,idDims:h}}function xv(e,t){var n=new Array(e);n.fill(-1);for(var r=0;r<t.length;++r)n[t[r]]=r;for(var a=[],i=0;i<e;++i)-1===n[i]&&a.push(i);return{permutationIndices:n=n.filter((function(e){return-1!==e})),expandDims:a}}function kv(e,t,n){for(var r=new Array(e),a=function(e){for(var a=n[e].shape,i=function(n){void 0===r[t[e][n]]?r[t[e][n]]=a[n]:be(r[t[e][n]]===a[n],(function(){return"Expected dimension ".concat(r[t[e][n]]," at axis ").concat(n," of input shaped ").concat(JSON.stringify(a),", but got dimension ").concat(a[n])}))},o=0;o<t[e].length;++o)i(o)},i=0;i<n.length;++i)a(i)}function wv(e,t){var n,r=e,a=[];0===e.length&&r.push(-1),n=e.length+1;for(var i=0;i<n;++i)a.push([]);for(var o=[],s=0;s<r.length;++s){var u,c=Iv(t,r[s]),l=Object(N.a)(c);try{for(l.s();!(u=l.n()).done;){var d=u.value;-1===o.indexOf(d)&&(a[s].push(d),o.push(d))}}catch(p){l.e(p)}finally{l.f()}}return{path:r,steps:a}}function Ov(e){return e.every((function(e,t){return e===t}))}function Iv(e,t){for(var n=[],r=0;r<e.length;++r)(0===e[r].length||-1!==e[r].indexOf(t)||-1===t)&&n.push(r);return n}function Sv(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=[];if("number"==typeof t)be(e.shape[n]%t===0,(function(){return"Number of splits must evenly divide the axis."})),r=new Array(t).fill(e.shape[n]/t);else{var a=t.reduce((function(e,t){return-1===t&&(e+=1),e}),0);be(a<=1,(function(){return"There should be only one negative value in split array."}));var i=t.indexOf(-1);if(-1!==i){var o=t.reduce((function(e,t){return t>0?e+t:e}));t[i]=e.shape[n]-o}be(e.shape[n]===t.reduce((function(e,t){return e+t})),(function(){return"The sum of sizes must match the size of the axis dimension."})),r=t}return r}function Nv(e){return"Received SparseTensor with denseShape[0] = 0 but\n  indices.shape[0] = ".concat(e)}function jv(e,t){return"indices(".concat(e,", 0) is invalid: ").concat(t," < 0")}function Tv(e,t,n){return"indices(".concat(e,", 0) is invalid: ").concat(t," >= ").concat(n)}function Cv(e,t){return"only one output dimension may be -1, not both ".concat(e," and ").concat(t)}function Ev(e,t){return"size ".concat(e," must be non-negative, not ").concat(t)}function _v(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function Av(e,t){var n=xe(e),r=xe(t);return"Input to reshape is a SparseTensor with ".concat(n,"\n  dense values, but the requested shape requires a multiple of ").concat(r,". inputShape=").concat(e," outputShape= ").concat(t)}function Rv(e,t){var n=xe(e),r=xe(t);return"Input to reshape is a tensor with ".concat(n," dense values, but the requested shape has ").concat(r,". inputShape=").concat(e," outputShape=").concat(t)}function Dv(){return"segment ids must be >= 0"}function Fv(){return"segment ids are not increasing"}function Mv(e,t){return"Segment id ".concat(e," out of range [0, ").concat(t,"), possibly because segmentIds input is not sorted.")}function zv(e,t,n){return"Bad: indices[".concat(e,"] == ").concat(t," out of range [0, ").concat(n,")")}var Lv={};function Pv(e,t){var n,r=!1;for(e<=Xm?(n=e,r=!0):n=He(e,Math.floor(Math.sqrt(e)));!r;)n>t||n===e?r=!0:n=He(e,n+1);return n}function Bv(e,t,n){for(var r=[],a=e.length,i=0;i<a;i++)i!==t?r.push(e[i]):r.push(n);return r}function Wv(e,t,n,r){var a=t.shape.length,i=e.shape.length;if(0!==r&&(r<-a||r>a))throw new Error("Expect batchDims in the range of [-".concat(a,", ").concat(a,"], but got ").concat(r));if(r<0&&(r+=a),r>i)throw new Error("batchDims (".concat(r,") must be less than rank(x) (\n    ").concat(i,")."));if(n<r)throw new Error("batchDims (".concat(r,") must be less than or equal to axis (").concat(n,")."));for(var o=0;o<r;++o)if(e.shape[o]!==t.shape[o])throw new Error("x.shape[".concat(o,"]: ").concat(e.shape[o]," should be equal to indices.shape[").concat(o,"]: ").concat(t.shape[o],"."));for(var s=e.shape[n],u=[],c=1,l=1,d=1,p=0;p<r;++p)u.push(e.shape[p]),c*=e.shape[p];for(var f=r;f<n;f++)u.push(e.shape[f]),l*=e.shape[f];for(var h=r;h<a;h++)u.push(t.shape[h]);for(var m=n+1;m<i;m++)u.push(e.shape[m]),d*=e.shape[m];return{batchSize:c,sliceSize:d,outerSize:l,dimSize:s,outputShape:u}}function Uv(e){try{return e.map((function(e){return hi(e)}))}catch(t){throw new Error("Failed to decode encoded string bytes into utf-8, error: ".concat(t))}}function Vv(e){return e.map((function(e){return fi(e)}))}z(Lv,{collectGatherOpShapeInfo:function(){return Wv},computeOutShape:function(){return Bv},segOpComputeOptimalWindowSize:function(){return Pv}});var Gv={};z(Gv,{nonMaxSuppressionV3Impl:function(){return kf},nonMaxSuppressionV4Impl:function(){return wf},nonMaxSuppressionV5Impl:function(){return Of},whereImpl:function(){return Fp}}),function(){for(var e=0,t=Eh;e<t.length;e++){kh(t[e])}}();var Hv={kernelName:pt,inputsToSave:["x"],gradFunc:function(e,t){var n=Object(y.a)(t,1)[0];return{x:function(){return $s(e,hp(Ns(n,"float32"),-1))}}}},qv={kernelName:ft,inputsToSave:["x"],gradFunc:function(e,t){var n=Object(y.a)(t,1)[0];return{x:function(){var t=Gc(Ns(n,"float32")),r=Vc(Sl(Uc(1),t));return wl(Qs(e,r))}}}},Kv={kernelName:ht,inputsToSave:["x"],gradFunc:function(e,t){var n=Object(y.a)(t,1)[0];return{x:function(){var t=Vc(Sl(Gc(Ns(n,"float32")),1));return Qs(e,t)}}}},Xv={kernelName:mt,inputsToSave:["a","b"],gradFunc:function(e,t){var n=Object(y.a)(t,2),r=n[0],a=n[1],i=kc(r.shape,a.shape);return{a:function(){var t=e,n=xc(r.shape,i);return n.length>0&&(t=Hc(t,n)),Eu(t,r.shape)},b:function(){var t=e,n=xc(a.shape,i);return n.length>0&&(t=Hc(t,n)),Eu(t,a.shape)}}}},Yv={kernelName:vt,saveAllInputs:!0,gradFunc:function(e,t){var n={};return t.forEach((function(t,r){n[r]=function(){return e.clone()}})),n}},Zv={kernelName:yt,inputsToSave:["x"],gradFunc:function(e,t){var n=Object(y.a)(t,1)[0];return{x:function(){return Ic(n)}}}},Jv={kernelName:xt,inputsToSave:["x"],gradFunc:function(e,t){var n=Object(y.a)(t,1)[0];return{x:function(){return Ic(n)}}}},Qv={kernelName:kt,inputsToSave:["x"],gradFunc:function(e,t){var n=Object(y.a)(t,1)[0];return{x:function(){return Qs(e,Vc(Sl(Uc(1),Gc(Ns(n,"float32")))))}}}},$v={kernelName:wt,inputsToSave:["x"],gradFunc:function(e,t){var n=Object(y.a)(t,1)[0];return{x:function(){var t=Vc(Zs(Uc(1),Gc(Ns(n,"float32"))));return Qs(e,t)}}}},eb={kernelName:St,inputsToSave:["a","b"],gradFunc:function(e,t){var n=Object(y.a)(t,2),r=n[0],a=n[1],i=kc(r.shape,a.shape);return{a:function(){var t=Zs(Gc(r),Gc(a)),n=$s(e,Qs(a,t)),o=xc(r.shape,i);return o.length>0&&(n=Hc(n,o)),Eu(n,r.shape)},b:function(){var t=Zs(Gc(r),Gc(a)),n=wl($s(e,Qs(r,t))),o=xc(a.shape,i);return o.length>0&&(n=Hc(n,o)),Eu(n,a.shape)}}}},tb={kernelName:Ot,inputsToSave:["x"],gradFunc:function(e,t){var n=Object(y.a)(t,1)[0];return{x:function(){return Qs(e,Zs(Gc(Ns(n,"float32")),1))}}}},nb={kernelName:It,inputsToSave:["x"],gradFunc:function(e,t){var n=Object(y.a)(t,1)[0];return{x:function(){return Qs(e,Sl(Uc(1),Gc(Ns(n,"float32"))))}}}};var rb=lo({avgPool3dGrad_:function(e,t,n,r,a,i){var o=so(e,"dy","avgPool3dGrad"),s=so(t,"input","avgPool3dGrad"),u=o,c=s,l=!1;4===s.rank&&(l=!0,u=Eu(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),c=Eu(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),be(5===u.rank,(function(){return"Error in avgPool3dGrad: dy must be rank 5 but got rank ".concat(u.rank,".")})),be(5===c.rank,(function(){return"Error in avgPool3dGrad: input must be rank 5 but got rank ".concat(c.rank,".")})),Cu("avgPool3dGrad",a,i);var d={dy:u,input:c},p={filterSize:n,strides:r,pad:a,dimRoundingMode:i},f=Ji.runKernel(Ct,d,p);return l?Eu(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}}),ab={kernelName:Tt,inputsToSave:["x"],gradFunc:function(e,t,n){var r=Object(y.a)(t,1)[0],a=n.filterSize,i=n.strides,o=n.pad,s=n.dimRoundingMode;return{x:function(){return rb(e,r,a,i,o,s)}}}};var ib=lo({avgPoolGrad_:function(e,t,n,r,a){var i=so(e,"dy","avgPoolGrad"),o=so(t,"input","avgPoolGrad");be(o.rank===i.rank,(function(){return"Rank of input (".concat(o.rank,") does not match rank of dy (").concat(i.rank,")")}));var s=o,u=i,c=!1;3===o.rank&&(c=!0,s=Eu(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=Eu(i,[1,i.shape[0],i.shape[1],i.shape[2]])),be(4===u.rank,(function(){return"Error in avgPoolGrad: dy must be rank 4 but got rank ".concat(u.rank,".")})),be(4===s.rank,(function(){return"Error in avgPoolGrad: input must be rank 4 but got rank ".concat(s.rank,".")}));var l={dy:u,input:s},d={filterSize:n,strides:r,pad:a},p=Ji.runKernel(jt,l,d);return c?Eu(p,[p.shape[1],p.shape[2],p.shape[3]]):p}}),ob={kernelName:Nt,inputsToSave:["x"],gradFunc:function(e,t,n){var r=Object(y.a)(t,1)[0],a=n.filterSize,i=n.strides,o=n.pad;return{x:function(){return ib(e,r,a,i,o)}}}},sb={kernelName:Et,inputsToSave:["a","b"],gradFunc:function(e,t,n){var r=Object(y.a)(t,2),a=r[0],i=r[1],o=n.transposeA,s=n.transposeB;return o||s?!o&&s?{a:function(){return Du(e,i,!1,!1)},b:function(){return Du(e,a,!0,!1)}}:o&&!s?{a:function(){return Du(i,e,!1,!0)},b:function(){return Du(a,e,!1,!1)}}:{a:function(){return Du(i,e,!0,!0)},b:function(){return Du(e,a,!0,!0)}}:{a:function(){return Du(e,i,!1,!0)},b:function(){return Du(a,e,!0,!1)}}}},ub={kernelName:_t,gradFunc:function(e,t,n){var r=n.blockShape,a=n.crops;return{x:function(){return ad(e,r,a)}}}},cb={kernelName:Dt,gradFunc:function(e,t,n){for(var r=n,a=r.inputShape,i=r.shape,o=Array.from(i),s=a.length-1;s>=0;s--)if(a[s]===i[s])o[s]=1;else if(1!==a[s])throw new Error("broadcastTo(): [".concat(a,"] cannot be broadcast to [").concat(i,"]."));for(var u=[],c=0;c<o.length;c++)o[c]>1&&u.push(c);return{x:function(){return Hc(e,u,!0)}}}},lb={kernelName:Mt,gradFunc:function(e){return{x:function(){return e.clone()}}}},db={kernelName:zt,gradFunc:function(e){return{x:function(){return Ic(e)}}}},pb={kernelName:Lt,inputsToSave:["x"],gradFunc:function(e,t,n){var r=Object(y.a)(t,1)[0],a=n.clipValueMin,i=n.clipValueMax;return{x:function(){return Oc(Tl(rl(r,a),ll(r,i)),e,Ic(e))}}}},fb={kernelName:Bt,inputsToSave:["x"],gradFunc:Hv.gradFunc},hb={kernelName:Wt,saveAllInputs:!0,gradFunc:function(e,t,n){var r=t.map((function(e){return e.shape})),a=_e(n.axis,t[0].shape)[0],i=r.map((function(e){return e[a]}));return cp(e,i,a).map((function(e){return function(){return e}}))}},mb={kernelName:Ut,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=Object(y.a)(t,2),a=r[0],i=r[1],o=n.dilations,s=n.strides,u=n.pad,c=n.dataFormat;return be(Su(o),(function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '".concat(o,"'")})),{x:function(){return ac(a.shape,e,i,s,u,c)},filter:function(){return Qp(a,e,i.shape,s,u,c)}}}},vb={kernelName:Gt,inputsToSave:["dy","filter"],gradFunc:function(e,t,n){var r=Object(y.a)(t,2),a=r[0],i=r[1],o=n.strides,s=n.pad,u=n.dataFormat,c=n.dimRoundingMode;return{dy:function(){return nc(e,i,o,s,u,1,c)},filter:function(){return Qp(e,a,i.shape,o,s,u,c)}}}};var bb=lo({conv3DBackpropFilter_:function(e,t,n,r,a){var i=e;4===e.rank&&(i=Eu(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]));var o=t;4===o.rank&&(o=Eu(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]])),be(5===i.rank,(function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape ".concat(i.shape,".")})),be(5===o.rank,(function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape ".concat(o.shape,".")})),be(5===n.length,(function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got ".concat(n,".")})),be(i.shape[4]===n[3],(function(){return"Error in conv3dDerFilter: depth of input ".concat(i.shape[4],") must match input depth in filter (").concat(n[3],".")})),be(o.shape[4]===n[4],(function(){return"Error in conv3dDerFilter: depth of dy (".concat(o.shape[4],") must match output depth for filter (").concat(n[4],").")}));var s={x:i,dy:o},u={strides:r,pad:a,filterShape:n};return Ji.runKernel(qt,s,u)}}),gb={kernelName:Ht,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=n.dilations,a=n.strides,i=n.pad;be(Su(r),(function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '".concat(r,"'")}));var o=Object(y.a)(t,2),s=o[0],u=o[1];return{x:function(){return sc(s.shape,e,u,a,i)},filter:function(){return bb(s,e,u.shape,a,i)}}}},yb={kernelName:Xt,inputsToSave:["x"],gradFunc:function(e,t){var n=Object(y.a)(t,1)[0];return{x:function(){return $s(wl($d(Ns(n,"float32"))),e)}}}},xb={kernelName:Yt,inputsToSave:["x"],gradFunc:function(e,t){var n=Object(y.a)(t,1)[0];return{x:function(){return $s(ep(Ns(n,"float32")),e)}}}},kb={kernelName:Jt,inputsToSave:["x"],gradFunc:function(e,t,n){var r=Object(y.a)(t,1)[0],a=n.axis,i=n.exclusive,o=n.reverse;return{x:function(){var t=Mc([a],r.rank),n=pc(e,a,i,!o);return null!=t&&(n=Bp(n,t)),n}}}},wb={kernelName:tn,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=n.dilations,a=n.strides,i=n.pad,o=n.dimRoundingMode,s=null==r?[1,1]:r;be(Su(s),(function(){return"Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '".concat(s,"'")}));var u=Object(y.a)(t,2),c=u[0],l=u[1];return be(4===c.rank,(function(){return"Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ".concat(c.rank,".")})),be(4===l.rank,(function(){return"Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ".concat(l.rank,".")})),be(c.shape[3]===l.shape[2],(function(){return"Error in gradient of depthwiseConv2d: number of input channels (".concat(c.shape[3],") must match the inChannels dimension in filter ").concat(l.shape[2],".")})),be(Nu(a,s),(function(){return"Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ".concat(a," and dilations '").concat(s,"'.")})),Cu("depthwiseConv2d",i,o),{x:function(){return of(c.shape,e,l,a,i,s,o)},filter:function(){return af(c,e,l.shape,a,i,s,o)}}}},Ob={kernelName:on,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=Object(y.a)(t,2),a=r[0],i=r[1],o={x:a,filter:i,dy:e},s={x:a,filter:i,dy:e};return{x:function(){return Ji.runKernel(sn,o,n)},filter:function(){return Ji.runKernel(un,s,n)}}}},Ib={kernelName:pn,outputsToSave:[!0],gradFunc:function(e,t){var n={dy:e,y:Object(y.a)(t,1)[0]};return{x:function(){return Ji.runKernel(fn,n)}}}},Sb={kernelName:hn,inputsToSave:["x"],gradFunc:function(e,t){var n=Object(y.a)(t,1)[0],r=$s(Yc(wl(Gc(n))),2/Math.sqrt(Math.PI));return{x:function(){return $s(e,r)}}}},Nb={kernelName:vn,outputsToSave:[!0],gradFunc:function(e,t){var n=Object(y.a)(t,1)[0];return{x:function(){return $s(e,n)}}}},jb={kernelName:bn,inputsToSave:["input"],gradFunc:function(e,t){var n=Object(y.a)(t,1)[0];return{input:function(){return Eu(e,n.shape)}}}},Tb={kernelName:gn,inputsToSave:["x"],gradFunc:function(e,t){var n=Object(y.a)(t,1)[0];return{x:function(){return $s(e,Yc(n))}}}},Cb={kernelName:wn,gradFunc:function(e){return{x:function(){return Ic(e)}}}},Eb={kernelName:On,inputsToSave:["a","b"],gradFunc:function(e,t){var n=Object(y.a)(t,2),r=n[0],a=n[1],i=kc(r.shape,a.shape);return{a:function(){var t=Qs(e,Ns(a,"float32")),n=xc(r.shape,i);return n.length>0?Eu(Hc(t,n),r.shape):t},b:function(){var t=$s(e,Ns(r,"float32")),n=xc(a.shape,i);n.length>0&&(t=Eu(Hc(t,n),a.shape));var o=Gc(a);return wl(Qs(t,Ns(o,"float32")))}}}},_b={kernelName:In,inputsToSave:["x","mean","variance","scale"],gradFunc:function(e,t,n){var r=n.varianceEpsilon,a=Object(y.a)(t,4),i=a[0],o=a[1],s=a[2],u=a[3],c=null==u?Uc(1):u,l=xc(o.shape,i.shape),d=[];if(1===o.rank){for(var p=0;p<i.shape.length-1;++p)d.push(i.shape[p]);d.push(1)}var f=Sl(i,o),h=$s(e,c),m=Kd(Zs(s,Uc(r))),v=$s($s($s(m,m),m),Uc(-.5));return{x:function(){return 1===o.rank?Eu($s($s(e,Qc(Eu(m,[1,1,1,o.shape[0]]),d)),c),i.shape):Eu($s($s(e,m),c),i.shape)},mean:function(){var e=$s($s(m,Uc(-1)),h);return 1===o.rank&&(e=Hc(e,l)),Eu(e,o.shape)},variance:function(){var e=$s($s(v,f),h);return 1===o.rank&&(e=Hc(e,l)),Eu(e,o.shape)},scale:function(){var t=$s(f,m),n=$s(e,t);return 1===o.rank&&(n=Hc(n,l)),Eu(n,o.shape)},offset:function(){var t=e;return 1===o.rank&&(t=Hc(t,l)),Eu(t,o.shape)}}}},Ab={kernelName:Sn,inputsToSave:["x","indices"],gradFunc:function(e,t,n){var r=Object(y.a)(t,2),a=r[0],i=r[1],o=n.axis,s=_e(o,a.shape)[0];return{x:function(){var t=a.shape,n=i.size,r=t.slice(0,s),u=r.length,c=t.slice(o,t.length).slice(1),l=c.length,d=Rb(0,u),p=Rb(u+1,u+1+l),f=Db([r,[n],c]),h=Eu(e,f),m=Eu(i,[n]),v=Db([[u],d,p]),b=Bp(h,v),g=_p(b,m,a.shape[s]),y=zc(v);return g=Bp(g,y)},indices:function(){return i}}}};function Rb(e,t){for(var n=[],r=e;r<t;++r)n.push(r);return n}function Db(e){for(var t=[],n=0;n<e.length;++n)for(var r=0;r<e[n].length;++r)t.push(e[n][r]);return t}var Fb={kernelName:Tn,inputsToSave:["a","b"],gradFunc:function(e,t){var n=Object(y.a)(t,2),r=n[0],a=n[1];return{a:function(){return Ic(r)},b:function(){return Ic(a)}}}},Mb={kernelName:Cn,gradFunc:function(e){return{x:function(){return Ns(e,"float32")}}}},zb={kernelName:An,gradFunc:function(e){return{x:function(){return Ic(e)}}}},Lb={kernelName:Rn,gradFunc:function(e){return{x:function(){return Ic(e)}}}},Pb={kernelName:Dn,gradFunc:function(e){return{x:function(){return Ic(e)}}}},Bb={kernelName:Fn,inputsToSave:["x"],gradFunc:function(e,t,n){var r=Object(y.a)(t,1)[0],a=n.alpha,i=nl(r,0);return{x:function(){return Oc(i,e,$s(e,a))}}}},Wb={kernelName:Bn,inputsToSave:["x"],gradFunc:function(e,t){var n=Object(y.a)(t,1)[0];return{x:function(){return Qs(e,Zs(n,1))}}}},Ub={kernelName:Pn,inputsToSave:["x"],gradFunc:function(e,t){var n=Object(y.a)(t,1)[0];return{x:function(){return Qs(e,Ns(n,"float32"))}}}},Vb={kernelName:Hn,inputsToSave:[],outputsToSave:[!0],gradFunc:function(e,t,n){var r=Object(y.a)(t,1)[0],a=n.axis;return{logits:function(){var t=Yc(r);return Sl(e,$s(Hc(e,a,!0),t))}}}};var Gb=lo({localResponseNormalizationBackprop_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:.5,s={x:e,y:t,dy:n},u={depthRadius:r,bias:a,alpha:i,beta:o};return Ji.runKernel(Xn,s,u)}}),Hb={kernelName:Kn,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=Object(y.a)(t,2),a=r[0],i=r[1],o=n.depthRadius,s=n.bias,u=n.alpha,c=n.beta;return{x:function(){return Gb(a,i,e,o,s,u,c)}}}};function qb(e,t,n,r){return t.rank<n.rank&&(t=Eu(t,Dc(t.shape,r))),e.rank<n.rank&&(e=Eu(e,Dc(e.shape,r))),{x:function(){return $s(e,Ns(wc(n,t),e.dtype))}}}var Kb={kernelName:Zn,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=n.reductionIndices,a=t[0],i=qb(e,t[1],a,_e(r,a.shape));return{x:function(){return i.x()}}}},Xb={kernelName:Jn,inputsToSave:["a","b"],gradFunc:function(e,t){var n=Object(y.a)(t,2),r=n[0],a=n[1];return{a:function(){return $s(e,Ns(rl(r,a),"float32"))},b:function(){return $s(e,Ns(cl(r,a),"float32"))}}}};var Yb=lo({maxPool3dGrad_:function(e,t,n,r,a,i,o){var s=so(e,"dy","maxPool3dGrad"),u=so(t,"input","maxPool3dGrad"),c=so(n,"output","maxPool3dGrad"),l=s,d=u,p=c,f=!1;4===u.rank&&(f=!0,l=Eu(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]]),d=Eu(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]]),p=Eu(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),be(5===l.rank,(function(){return"Error in maxPool3dGrad: dy must be rank 5 but got rank ".concat(l.rank,".")})),be(5===d.rank,(function(){return"Error in maxPool3dGrad: input must be rank 5 but got rank ".concat(d.rank,".")})),be(5===p.rank,(function(){return"Error in maxPool3dGrad: output must be rank 5 but got rank ".concat(p.rank,".")})),Cu("maxPool3dGrad",i,o);var h={dy:l,input:d,output:p},m={filterSize:r,strides:a,pad:i,dimRoundingMode:o},v=Ji.runKernel(tr,h,m);return f?Eu(v,[v.shape[1],v.shape[2],v.shape[3],v.shape[4]]):v}}),Zb={kernelName:er,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=Object(y.a)(t,2),a=r[0],i=r[1],o=n.filterSize,s=n.strides,u=n.pad,c=n.dimRoundingMode;return{x:function(){return Yb(e,a,i,o,s,u,c)}}}};var Jb=lo({maxPoolGrad_:function(e,t,n,r,a,i,o){var s=so(e,"dy","maxPoolGrad"),u=so(t,"input","maxPoolGrad"),c=so(n,"output","maxPoolGrad");be(u.rank===s.rank,(function(){return"Rank of input (".concat(u.rank,") does not match rank of dy (").concat(s.rank,")")})),be(4===s.rank,(function(){return"Error in maxPoolGrad: dy must be rank 4 but got rank ".concat(s.rank,".")})),be(4===u.rank,(function(){return"Error in maxPoolGrad: input must be rank 4 but got rank ".concat(u.rank,".")})),Cu("maxPoolGrad",i,o);var l={dy:s,input:u,output:c},d={filterSize:r,strides:a,pad:i,dimRoundingMode:o};return Ji.runKernel($n,l,d)}}),Qb={kernelName:gr,inputsToSave:["x"],gradFunc:function(e,t,n){var r=t[0],a=n.paddings.map((function(e){return e[0]}));return{x:function(){return Mu(e,a,r.shape)}}}};function $b(e,t,n){var r=e.shape.length,a=r-n.length,i=Wm.getAxesPermutation(n,r),o=e;null!=i&&(o=Bp(e,i));var s=o.shape.slice(),u=s.splice(r-n.length,n.length).reduce((function(e,t){return e*t}),1);s.push(u);var c=function(e,t,n){var r=e.shape.slice();r[n]=1;var a=Eu(t,r),i=dc(e,n,!0,!1),o=dc(e,n,!0,!0),s=$s(i,o);return $s(a,s)}(o.reshape(s),t,a);if(c=c.reshape(o.shape),null!=i){var l=Wm.getUndoAxesPermutation(i);c=Bp(c,l)}return c}var eg={kernelName:Qr,gradFunc:function(e,t,n){var r=n.blockShape,a=n.paddings;return{x:function(){return Pu(e,r,a)}}}},tg={kernelName:$r,gradFunc:function(e,t,n){var r=n.axis;return{x:function(){return Ru(e,r)}}}};for(var ng=0,rg=[Hv,qv,Kv,Xv,Yv,Zv,Jv,Qv,$v,eb,tb,nb,ab,ob,sb,ub,cb,lb,db,pb,fb,hb,vb,mb,gb,yb,xb,kb,wb,Ob,{kernelName:ln,inputsToSave:["a","b"],gradFunc:function(e,t){var n=Object(y.a)(t,2),r=n[0],a=n[1],i=kc(r.shape,a.shape);return{a:function(){var t=Qs(e,Ns(a,"float32")),n=xc(r.shape,i);return n.length>0?Eu(Hc(t,n),r.shape):t},b:function(){var t=$s(e,Ns(r,"float32")),n=xc(a.shape,i);n.length>0&&(t=Eu(Hc(t,n),a.shape));var o=Gc(a);return wl(Qs(t,Ns(o,"float32")))}}}},Ib,Sb,Nb,jb,Tb,Eb,Cb,_b,Ab,Fb,Mb,zb,Lb,Pb,Bb,Wb,Ub,Vb,Hb,Kb,Kb,Xb,Zb,{kernelName:Qn,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=Object(y.a)(t,2),a=r[0],i=r[1],o=n.filterSize,s=n.strides,u=n.pad;return{x:function(){return Jb(e,a,i,o,s,u)}}}},{kernelName:rr,inputsToSave:["x"],gradFunc:function(e,t,n){var r=Object(y.a)(t,1)[0],a=_e(n.axis,r.shape),i=xe(Rc(r.shape,a)[1]);return{x:function(){var t=r.shape.slice();a.forEach((function(e){t[e]=1}));var n=Eu(e,t);return Qs($s(n,Wl(r.shape,"float32")),i)}}}},{kernelName:ar,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=n.axis,a=Object(y.a)(t,2),i=a[0],o=qb(e,a[1],i,_e(r,i.shape));return{x:function(){return o.x()}}}},{kernelName:ir,inputsToSave:["a","b"],gradFunc:function(e,t){var n=Object(y.a)(t,2),r=n[0],a=n[1];return{a:function(){return $s(e,Ns(ll(r,a),"float32"))},b:function(){return $s(e,Ns(nl(r,a),"float32"))}}}},{kernelName:or,inputsToSave:["x"],gradFunc:function(e,t,n){var r=t[0],a=n.paddings.map((function(e){return e[0]}));return{x:function(){return Mu(e,a,r.shape)}}}},{kernelName:sr,inputsToSave:["a","b"],gradFunc:function(e,t){var n=Object(y.a)(t,2),r=n[0],a=n[1],i=kc(r.shape,a.shape);return{a:function(){var t=xc(r.shape,i);return t.length>0?Eu(Hc(e,t),r.shape):e},b:function(){var t=$s(e,wl(el(Qs(r,a)))),n=xc(a.shape,i);return n.length>0?Eu(Hc(t,n),a.shape):t}}}},{kernelName:cr,inputsToSave:["a","b"],gradFunc:function(e,t){var n=Object(y.a)(t,2),r=n[0],a=n[1],i=kc(r.shape,a.shape);return{a:function(){var t=$s(e,Ns(a,"float32")),n=xc(r.shape,i);return n.length>0?Eu(Hc(t,n),r.shape):t},b:function(){var t=$s(e,Ns(r,"float32")),n=xc(a.shape,i);return n.length>0?Eu(Hc(t,n),a.shape):t}}}},{kernelName:lr,gradFunc:function(e){return{x:function(){return wl(e)}}}},{kernelName:vr,inputsToSave:["indices"],gradFunc:function(e,t){var n=t[0];return{indices:function(){return Bl(n.shape,"float32")}}}},{kernelName:mr,gradFunc:function(e){return{x:function(){return Ic(e)}}}},{kernelName:br,saveAllInputs:!0,gradFunc:function(e,t,n){var r=n.axis;return Ap(e,r).map((function(e){return function(){return e}}))}},Qb,Qb,{kernelName:xr,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:function(e,t){var n=Object(y.a)(t,3),r=n[0],a=n[1],i=n[2],o=r,s=a,u=kc(o.shape,s.shape);return{a:function(){var t=Ns(s,"float32"),n=$s(e,$s(t,Wc(o,Sl(t,Uc(1))))),r=xc(o.shape,u);return r.length>0&&(n=Hc(n,r)),Eu(n,o.shape)},b:function(){var t=nl(o,0),n=Oc(t,fl(o),Ic(o)),r=$s(e,$s(i,n)),a=xc(s.shape,u);return a.length>0&&(r=Hc(r,a)),Eu(r,s.shape)}}}},{kernelName:kr,inputsToSave:["x","alpha"],gradFunc:function(e,t){var n=Object(y.a)(t,2),r=n[0],a=n[1],i=nl(r,0);return{x:function(){return Oc(i,e,$s(e,a))},alpha:function(){var t=Oc(i,Ic(e),$s(e,r)),n=xc(a.shape,e.shape);return n.length>0&&(t=Hc(t,n)),Eu(t,a.shape)}}}},{kernelName:wr,inputsToSave:["x"],gradFunc:function(e,t,n){var r=Object(y.a)(t,1)[0],a=n.axis,i=[];return i=null==a?r.shape.map((function(e,t){return t})):"number"==typeof a?[a]:a,{x:function(){return $b(r,e,i)}}}},{kernelName:Tr,inputsToSave:["x"],gradFunc:function(e,t){var n=Object(y.a)(t,1)[0];return{x:function(){return Qs(e,wl(Gc(n)))}}}},{kernelName:Fr,inputsToSave:["x"],gradFunc:function(e,t){var n=Object(y.a)(t,1)[0],r=$s(ll(n,6),hp(n));return{x:function(){return $s(e,Ns(r,"float32"))}}}},{kernelName:Cr,inputsToSave:["x"],gradFunc:function(e,t){var n=Object(y.a)(t,1)[0];return{x:function(){return $s(e,Ns(hp(n),"float32"))}}}},{kernelName:Er,inputsToSave:["x"],gradFunc:function(e,t){var n=Object(y.a)(t,1)[0];return{x:function(){return Eu(e,n.shape)}}}},{kernelName:Rr,inputsToSave:["images"],gradFunc:function(e,t,n){var r={dy:e,images:Object(y.a)(t,1)[0]};return{images:function(){return Ji.runKernel(Dr,r,n)}}}},{kernelName:_r,inputsToSave:["images"],gradFunc:function(e,t,n){var r={dy:e,images:Object(y.a)(t,1)[0]};return{images:function(){return Ji.runKernel(Ar,r,n)}}}},{kernelName:Mr,gradFunc:function(e,t,n){var r=_e(n.dims,e.shape);return{x:function(){return Wd(e,r)}}}},{kernelName:zr,gradFunc:function(e){return{x:function(){return Ic(e)}}}},{kernelName:Lr,inputsToSave:["x"],gradFunc:function(e,t){var n=Object(y.a)(t,1)[0];return{x:function(){return wl(Qs(e,$s(Wc(n,1.5),2)))}}}},{kernelName:Ur,inputsToSave:["condition"],gradFunc:function(e,t){var n=Object(y.a)(t,1)[0];return{condition:function(){return Ns(Ic(n),"float32")},t:function(){return $s(e,Ns(n,e.dtype))},e:function(){return $s(e,Ns(Cl(n),e.dtype))}}}},{kernelName:Vr,inputsToSave:["x"],gradFunc:function(e,t){var n=Object(y.a)(t,1)[0];return{x:function(){var t=nl(n,Uc(0)),r=Uc(nv),a=Uc(rv),i=$s(e,a),o=$s($s(e,r),Yc(Ns(n,"float32")));return Oc(t,i,o)}}}},{kernelName:Xr,outputsToSave:[!0],gradFunc:function(e,t){var n=Object(y.a)(t,1)[0];return{x:function(){return $s(e,$s(n,Sl(Uc(1),n)))}}}},{kernelName:Kr,gradFunc:function(e){return{x:function(){return Ic(e)}}}},{kernelName:Hr,inputsToSave:["x"],gradFunc:function(e,t){var n=Object(y.a)(t,1)[0];return{x:function(){return $s(cc(Ns(n,"float32")),e)}}}},{kernelName:qr,inputsToSave:["x"],gradFunc:function(e,t){var n=Object(y.a)(t,1)[0];return{x:function(){return $s(lc(Ns(n,"float32")),e)}}}},{kernelName:Gr,inputsToSave:["x"],gradFunc:function(e,t,n){for(var r=Object(y.a)(t,1)[0],a=n.begin,i=n.size,o=r.shape,s=Am(r,a,i),u=Object(y.a)(s,2),c=u[0],l=u[1],d=[],p=0;p<e.rank;p++)d.push([c[p],o[p]-c[p]-l[p]]);return{x:function(){return $l(e,d)}}}},{kernelName:ea,outputsToSave:[!0],gradFunc:function(e,t,n){var r=Object(y.a)(t,1)[0],a=n.dim,i=$s(e,r);return{logits:function(){return Sl(i,$s(Hc(i,[a],!0),r))}}}},{kernelName:Yr,inputsToSave:["x"],gradFunc:function(e,t){var n=Object(y.a)(t,1)[0];return{x:function(){return $s(e,Fu(n))}}}},eg,eg,tg,tg,{kernelName:Zr,inputsToSave:["x"],gradFunc:function(e,t){var n=Object(y.a)(t,1)[0];return{x:function(){return Qs(e,$s(Vc(Ns(n,"float32")),2))}}}},{kernelName:oa,inputsToSave:["a","b"],gradFunc:function(e,t){var n=Object(y.a)(t,2),r=n[0],a=n[1],i=Uc(2);return{a:function(){return $s(e,$s(i,Sl(r,a)))},b:function(){return $s(e,$s(i,Sl(a,r)))}}}},{kernelName:sa,inputsToSave:["x"],gradFunc:function(e,t){var n=Object(y.a)(t,1)[0];return{x:function(){return $s(e,$s(Ns(n,"float32"),2))}}}},{kernelName:Sa,gradFunc:function(e){return{x:function(){return Ic(e)}}}},{kernelName:fa,inputsToSave:["a","b"],gradFunc:function(e,t){var n=Object(y.a)(t,2),r=n[0],a=n[1],i=kc(r.shape,a.shape);return{a:function(){var t=e,n=xc(r.shape,i);return n.length>0&&(t=Hc(t,n)),Eu(t,r.shape)},b:function(){var t=e,n=xc(a.shape,i);return n.length>0&&(t=Hc(t,n)),Eu(wl(t),a.shape)}}}},{kernelName:Jr,inputsToSave:["x"],gradFunc:function(e,t,n){var r=Object(y.a)(t,1)[0],a=r.shape.slice();_e(n.axis,r.shape).forEach((function(e){a[e]=1}));var i=Eu(e,a),o=$s(i,Wl(r.shape,"float32"));return{x:function(){return o}}}},{kernelName:ha,inputsToSave:["x"],gradFunc:function(e,t){var n=Object(y.a)(t,1)[0];return{x:function(){return Qs(e,Gc(cc(n)))}}}},{kernelName:ma,outputsToSave:[!0],gradFunc:function(e,t){var n=Object(y.a)(t,1)[0];return{x:function(){return $s(Sl(Uc(1),Gc(n)),e)}}}},{kernelName:va,inputsToSave:["x"],gradFunc:function(e,t,n){var r=Object(y.a)(t,1)[0],a=n.reps;return{x:function(){var t=Ic(r);if(1===r.rank)for(var n=0;n<a[0];++n)t=Zs(t,Mu(e,[n*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(var i=0;i<a[0];++i)for(var o=0;o<a[1];++o)t=Zs(t,Mu(e,[i*r.shape[0],o*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(var s=0;s<a[0];++s)for(var u=0;u<a[1];++u)for(var c=0;c<a[2];++c)t=Zs(t,Mu(e,[s*r.shape[0],u*r.shape[1],c*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(4!==r.rank)throw new Error("Gradient for tile operation is not implemented for rank-".concat(r.rank," tensors yet."));for(var l=0;l<a[0];++l)for(var d=0;d<a[1];++d)for(var p=0;p<a[2];++p)for(var f=0;f<a[3];++f)t=Zs(t,Mu(e,[l*r.shape[0],d*r.shape[1],p*r.shape[2],f*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return t}}}},{kernelName:ya,gradFunc:function(e,t,n){var r=zc(n.perm);return{x:function(){return Bp(e,r)}}}},{kernelName:ka,gradFunc:function(e,t,n){var r=n.axis;return{value:function(){return fp(e,r)}}}},{kernelName:wa,inputsToSave:["segmentIds"],gradFunc:function(e,t){var n=Object(y.a)(t,1)[0];return{x:function(){return function(e,t){for(var n=Ll(t,Ic(t)),r=tl(e,n),a=rl(t,Uc(0,"int32")),i=r.rank-a.rank,o=0;o<i;++o)a=Zc(a,o+1);a=Tl(a,Wl(r.shape,"bool"));var s=Ic(r);return Oc(a,r,s)}(e,n)}}}},{kernelName:Ia,gradFunc:function(e){return{x:function(){return Ic(e)}}}}];ng<rg.length;ng++){Pa(rg[ng])}Ci().prototype.abs=function(){return this.throwIfDisposed(),eu(this)},Ci().prototype.acos=function(){return this.throwIfDisposed(),tu(this)},Ci().prototype.acosh=function(){return this.throwIfDisposed(),nu(this)},Ci().prototype.add=function(e){return this.throwIfDisposed(),Zs(this,e)},Ci().prototype.all=function(e,t){return this.throwIfDisposed(),au(this,e,t)},Ci().prototype.any=function(e,t){return this.throwIfDisposed(),iu(this,e,t)},Ci().prototype.argMax=function(e){return this.throwIfDisposed(),ou(this,e)},Ci().prototype.argMin=function(e){return this.throwIfDisposed(),su(this,e)},Ci().prototype.asScalar=function(){return this.throwIfDisposed(),be(1===this.size,(function(){return"The array must have only 1 element."})),Eu(this,[])},Ci().prototype.asType=function(e){return this.throwIfDisposed(),Ns(this,e)},Ci().prototype.as1D=function(){return this.throwIfDisposed(),Eu(this,[this.size])},Ci().prototype.as2D=function(e,t){return this.throwIfDisposed(),Eu(this,[e,t])},Ci().prototype.as3D=function(e,t,n){return this.throwIfDisposed(),Eu(this,[e,t,n])},Ci().prototype.as4D=function(e,t,n,r){return this.throwIfDisposed(),Eu(this,[e,t,n,r])},Ci().prototype.as5D=function(e,t,n,r,a){return this.throwIfDisposed(),Eu(this,[e,t,n,r,a])},Ci().prototype.asin=function(){return this.throwIfDisposed(),uu(this)},Ci().prototype.asinh=function(){return this.throwIfDisposed(),cu(this)},Ci().prototype.atan=function(){return this.throwIfDisposed(),lu(this)},Ci().prototype.atan2=function(e){return this.throwIfDisposed(),du(this,e)},Ci().prototype.atanh=function(){return this.throwIfDisposed(),pu(this)},Ci().prototype.avgPool=function(e,t,n,r){return this.throwIfDisposed(),_u(this,e,t,n,r)},Ci().prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),Pu(this,e,t)},Ci().prototype.batchNorm=function(e,t,n,r,a){return this.throwIfDisposed(),Wu(this,e,t,n,r,a)},Ci().prototype.broadcastTo=function(e){return this.throwIfDisposed(),Xu(this,e)},Ci().prototype.cast=function(e){return this.throwIfDisposed(),Ns(this,e)},Ci().prototype.ceil=function(){return this.throwIfDisposed(),Yu(this)},Ci().prototype.clipByValue=function(e,t){return this.throwIfDisposed(),Ju(this,e,t)},Ci().prototype.concat=function(e,t){return this.throwIfDisposed(),e instanceof Ti&&(e=[e]),Ru([this].concat(Object(S.a)(e)),t)},Ci().prototype.conv1d=function(e,t,n,r,a,i){return this.throwIfDisposed(),rc(this,e,t,n,r,a,i)},Ci().prototype.conv2dTranspose=function(e,t,n,r,a){return this.throwIfDisposed(),ic(this,e,t,n,r,a)},Ci().prototype.conv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),nc(this,e,t,n,r,a,i)},Ci().prototype.cos=function(){return this.throwIfDisposed(),cc(this)},Ci().prototype.cosh=function(){return this.throwIfDisposed(),lc(this)},Ci().prototype.cumprod=function(e,t,n){return this.throwIfDisposed(),dc(this,e,t,n)},Ci().prototype.cumsum=function(e,t,n){return this.throwIfDisposed(),pc(this,e,t,n)},Ci().prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),hc(this,e,t)},Ci().prototype.depthwiseConv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),mc(this,e,t,n,r,a,i)},Ci().prototype.dilation2d=function(e,t,n,r,a){return this.throwIfDisposed(),bc(this,e,t,n,r,a)},Ci().prototype.divNoNan=function(e){return this.throwIfDisposed(),Sc(this,e)},Ci().prototype.div=function(e){return this.throwIfDisposed(),Qs(this,e)},Ci().prototype.dot=function(e){return this.throwIfDisposed(),Nc(this,e)},Ci().prototype.elu=function(){return this.throwIfDisposed(),Tc(this)},Ci().prototype.equal=function(e){return this.throwIfDisposed(),wc(this,e)},Ci().prototype.erf=function(){return this.throwIfDisposed(),Ec(this)},Ci().prototype.euclideanNorm=function(e,t){return this.throwIfDisposed(),Xc(this,e,t)},Ci().prototype.exp=function(){return this.throwIfDisposed(),Yc(this)},Ci().prototype.expandDims=function(e){return this.throwIfDisposed(),Zc(this,e)},Ci().prototype.expm1=function(){return this.throwIfDisposed(),Jc(this)},Ci().prototype.fft=function(){return this.throwIfDisposed(),op(this)},Ci().prototype.flatten=function(){return this.throwIfDisposed(),Eu(this,[this.size])},Ci().prototype.floor=function(){return this.throwIfDisposed(),el(this)},Ci().prototype.floorDiv=function(e){return this.throwIfDisposed(),Js(this,e)},Ci().prototype.gather=function(e,t,n){return this.throwIfDisposed(),tl(this,e,t,n)},Ci().prototype.greaterEqual=function(e){return this.throwIfDisposed(),rl(this,e)},Ci().prototype.greater=function(e){return this.throwIfDisposed(),nl(this,e)},Ci().prototype.ifft=function(){return this.throwIfDisposed(),sp(this)},Ci().prototype.irfft=function(){return this.throwIfDisposed(),up(this)},Ci().prototype.isFinite=function(){return this.throwIfDisposed(),il(this)},Ci().prototype.isInf=function(){return this.throwIfDisposed(),ol(this)},Ci().prototype.isNaN=function(){return this.throwIfDisposed(),sl(this)},Ci().prototype.leakyRelu=function(e){return this.throwIfDisposed(),ul(this,e)},Ci().prototype.lessEqual=function(e){return this.throwIfDisposed(),ll(this,e)},Ci().prototype.less=function(e){return this.throwIfDisposed(),cl(this,e)},Ci().prototype.localResponseNormalization=function(e,t,n,r){return this.throwIfDisposed(),pl(this,e,t,n,r)},Ci().prototype.logSigmoid=function(){return this.throwIfDisposed(),Il(this)},Ci().prototype.logSoftmax=function(e){return this.throwIfDisposed(),Nl(this,e)},Ci().prototype.logSumExp=function(e,t){return this.throwIfDisposed(),jl(this,e,t)},Ci().prototype.log=function(){return this.throwIfDisposed(),fl(this)},Ci().prototype.log1p=function(){return this.throwIfDisposed(),hl(this)},Ci().prototype.logicalAnd=function(e){return this.throwIfDisposed(),Tl(this,e)},Ci().prototype.logicalNot=function(){return this.throwIfDisposed(),Cl(this)},Ci().prototype.logicalOr=function(e){return this.throwIfDisposed(),El(this,e)},Ci().prototype.logicalXor=function(e){return this.throwIfDisposed(),_l(this,e)},Ci().prototype.matMul=function(e,t,n){return this.throwIfDisposed(),Du(this,e,t,n)},Ci().prototype.maxPool=function(e,t,n,r){return this.throwIfDisposed(),Fl(this,e,t,n,r)},Ci().prototype.max=function(e,t){return this.throwIfDisposed(),Pc(this,e,t)},Ci().prototype.maximum=function(e){return this.throwIfDisposed(),Ll(this,e)},Ci().prototype.mean=function(e,t){return this.throwIfDisposed(),Pl(this,e,t)},Ci().prototype.min=function(e,t){return this.throwIfDisposed(),Bc(this,e,t)},Ci().prototype.minimum=function(e){return this.throwIfDisposed(),Vl(this,e)},Ci().prototype.mirrorPad=function(e,t){return this.throwIfDisposed(),Gl(this,e,t)},Ci().prototype.mod=function(e){return this.throwIfDisposed(),Hl(this,e)},Ci().prototype.mul=function(e){return this.throwIfDisposed(),$s(this,e)},Ci().prototype.neg=function(){return this.throwIfDisposed(),wl(this)},Ci().prototype.norm=function(e,t,n){return this.throwIfDisposed(),Kc(this,e,t,n)},Ci().prototype.notEqual=function(e){return this.throwIfDisposed(),Yl(this,e)},Ci().prototype.oneHot=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.throwIfDisposed(),Zl(this,e,t,n)},Ci().prototype.onesLike=function(){return this.throwIfDisposed(),Jl(this)},Ci().prototype.pad=function(e,t){return this.throwIfDisposed(),$l(this,e,t)},Ci().prototype.pool=function(e,t,n,r,a,i){return this.throwIfDisposed(),id(this,e,t,n,r,a,i)},Ci().prototype.pow=function(e){return this.throwIfDisposed(),Wc(this,e)},Ci().prototype.prelu=function(e){return this.throwIfDisposed(),od(this,e)},Ci().prototype.prod=function(e,t){return this.throwIfDisposed(),sd(this,e,t)},Ci().prototype.reciprocal=function(){return this.throwIfDisposed(),Ld(this)},Ci().prototype.relu=function(){return this.throwIfDisposed(),Pd(this)},Ci().prototype.relu6=function(){return this.throwIfDisposed(),Bd(this)},Ci().prototype.reshapeAs=function(e){return this.throwIfDisposed(),Eu(this,e.shape)},Ci().prototype.reshape=function(e){return this.throwIfDisposed(),Eu(this,e)},Ci().prototype.resizeBilinear=function(e,t,n){return this.throwIfDisposed(),Mf(this,e,t,n)},Ci().prototype.resizeNearestNeighbor=function(e,t,n){return this.throwIfDisposed(),zf(this,e,t,n)},Ci().prototype.reverse=function(e){return this.throwIfDisposed(),Wd(this,e)},Ci().prototype.rfft=function(){return this.throwIfDisposed(),lp(this)},Ci().prototype.round=function(){return this.throwIfDisposed(),qd(this)},Ci().prototype.rsqrt=function(){return this.throwIfDisposed(),Kd(this)},Ci().prototype.selu=function(){return this.throwIfDisposed(),Xd(this)},Ci().prototype.separableConv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),Yd(this,e,t,n,r,a,i)},Ci().prototype.sigmoid=function(){return this.throwIfDisposed(),Fu(this)},Ci().prototype.sign=function(){return this.throwIfDisposed(),Qd(this)},Ci().prototype.sin=function(){return this.throwIfDisposed(),$d(this)},Ci().prototype.sinh=function(){return this.throwIfDisposed(),ep(this)},Ci().prototype.slice=function(e,t){return this.throwIfDisposed(),Mu(this,e,t)},Ci().prototype.softmax=function(e){return this.throwIfDisposed(),ip(this,e)},Ci().prototype.softplus=function(){return this.throwIfDisposed(),Ol(this)},Ci().prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),ad(this,e,t)},Ci().prototype.split=function(e,t){return this.throwIfDisposed(),cp(this,e,t)},Ci().prototype.sqrt=function(){return this.throwIfDisposed(),Vc(this)},Ci().prototype.square=function(){return this.throwIfDisposed(),Gc(this)},Ci().prototype.squaredDifference=function(e){return this.throwIfDisposed(),dp(this,e)},Ci().prototype.squeeze=function(e){return this.throwIfDisposed(),pp(this,e)},Ci().prototype.stack=function(e,t){this.throwIfDisposed();var n=e instanceof Ti?[this,e]:[this].concat(Object(S.a)(e));return fp(n,t)},Ci().prototype.step=function(e){return this.throwIfDisposed(),hp(this,e)},Ci().prototype.stridedSlice=function(e,t,n,r,a,i,o,s){return this.throwIfDisposed(),mp(this,e,t,n,r,a,i,o,s)},Ci().prototype.sub=function(e){return this.throwIfDisposed(),Sl(this,e)},Ci().prototype.sum=function(e,t){return this.throwIfDisposed(),Hc(this,e,t)},Ci().prototype.tan=function(){return this.throwIfDisposed(),vp(this)},Ci().prototype.tanh=function(){return this.throwIfDisposed(),zu(this)},Ci().prototype.tile=function(e){return this.throwIfDisposed(),Qc(this,e)},Ci().prototype.toBool=function(){return this.throwIfDisposed(),Ns(this,"bool")},Ci().prototype.toFloat=function(){return this.throwIfDisposed(),Ns(this,"float32")},Ci().prototype.toInt=function(){return this.throwIfDisposed(),Ns(this,"int32")},Ci().prototype.topk=function(e,t){return this.throwIfDisposed(),Tp(this,e,t)},Ci().prototype.transpose=function(e){return this.throwIfDisposed(),Bp(this,e)},Ci().prototype.unique=function(e){return this.throwIfDisposed(),Ep(this,e)},Ci().prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),_p(this,e,t)},Ci().prototype.unstack=function(e){return this.throwIfDisposed(),Ap(this,e)},Ci().prototype.where=function(e,t){return this.throwIfDisposed(),Oc(e,this,t)},Ci().prototype.zerosLike=function(){return this.throwIfDisposed(),Ic(this)};var ag=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(O.a)(this,n),r=t.call(this,e),Object.setPrototypeOf(Object(f.a)(r),n.prototype),r}return n}(Object(h.a)(Error)),ig=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(O.a)(this,n),r=t.call(this,e),Object.setPrototypeOf(Object(f.a)(r),n.prototype),r}return n}(Object(h.a)(Error)),og=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(O.a)(this,n),r=t.call(this,e),Object.setPrototypeOf(Object(f.a)(r),n.prototype),r}return n}(Object(h.a)(Error)),sg=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(O.a)(this,n),r=t.call(this,e),Object.setPrototypeOf(Object(f.a)(r),n.prototype),r}return n}(Object(h.a)(Error)),ug=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(O.a)(this,n),r=t.call(this,e),Object.setPrototypeOf(Object(f.a)(r),n.prototype),r}return n}(Object(h.a)(Error)),cg=function(){function e(t){Object(O.a)(this,e),this.maxEntries=t||100,this.cache=new Map}return Object(I.a)(e,[{key:"get",value:function(e){var t;return this.cache.has(e)&&(t=this.cache.get(e),this.cache.delete(e),this.cache.set(e,t)),t}},{key:"put",value:function(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){var n=this.cache.keys().next().value;this.cache.delete(n)}this.cache.set(e,t)}},{key:"getMaxEntries",value:function(){return this.maxEntries}},{key:"setMaxEntries",value:function(e){if(e<0)throw new Error("The maxEntries of LRU caches must be at least 0, but got ".concat(e,"."));if(this.maxEntries>e)for(var t=0;t<this.maxEntries-e;t++){var n=this.cache.keys().next().value;this.cache.delete(n)}this.maxEntries=e}}]),e}();function lg(e,t){if(Array.isArray(e)){for(var n=[],r=0;r<t;r++)n=n.concat(e);return n}var a=new Array(t);return a.fill(e),a}function dg(e,t){if(!e)throw new ug(t)}function pg(e,t){var n,r=0,a=Object(N.a)(e);try{for(a.s();!(n=a.n()).done;){n.value===t&&r++}}catch(i){a.e(i)}finally{a.f()}return r}function fg(e){return 1===e.length?e[0]:e}function hg(e){return Array.isArray(e)?e:[e]}function mg(e){var t=e.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return"_"!==t[0]?t:"private"+t}function vg(e){return e.length<=1||-1===e.indexOf("_")?e:e.replace(/[_]+(\w|$)/g,(function(e,t){return t.toUpperCase()}))}var bg={};function gg(e){if(null==e)return null;var t={};return t.className=e.getClassName(),t.config=e.getConfig(),t}function yg(e){if(null!=e&&"object"==typeof e)if(Array.isArray(e))e.forEach((function(e){return yg(e)}));else for(var t=0,n=Object.keys(e);t<n.length;t++){var r=n[t],a=e[r];null!=a&&"object"==typeof a&&(Array.isArray(a)||"ndarray"!==a.type||"number"!=typeof a.value?yg(a):e[r]=a.value)}}function xg(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"object",a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if("string"==typeof e){var i,o=e;if(o in n)i=n[o];else if(o in bg)i=bg[o];else if(null==(i=t[o]))throw new og("Unknown ".concat(r,": ").concat(e,". This may be due to one of the following reasons:\n1. The ").concat(r," is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom ").concat(r," is defined in JavaScript, but is not registered properly with tf.serialization.registerClass()."));return i}var s,u,c,l,d,p,f=e;if(null==f.className||null==f.config)throw new og("".concat(r,": Improper config format: ").concat(JSON.stringify(f),".\n'className' and 'config' must set."));var h,m,v=f.className;if(v in n?(s=n[v],h=(u=Object(y.a)(s,2))[0],m=u[1]):v in bg?(c=bg.className,h=(l=Object(y.a)(c,2))[0],m=l[1]):v in t&&(d=t[v],h=(p=Object(y.a)(d,2))[0],m=p[1]),null==h)throw new og("Unknown ".concat(r,": ").concat(v,". This may be due to one of the following reasons:\n1. The ").concat(r," is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom ").concat(r," is defined in JavaScript, but is not registered properly with tf.serialization.registerClass()."));if(null!=m){for(var b={},g=0,x=Object.keys(bg);g<x.length;g++){var k=x[g];b[k]=bg[k]}for(var w=0,O=Object.keys(n);w<O.length;w++){var I=O[w];b[I]=n[I]}var S=f.config;S.customObjects=b;for(var N=Object.assign({},bg),j=0,T=Object.keys(n);j<T.length;j++){var C=T[j];bg[C]=n[C]}yg(f.config);var E=m(h,f.config,n,a);return bg=Object.assign({},N),E}for(var _=Object.assign({},bg),A=0,R=Object.keys(n);A<R.length;A++){var D=R[A];bg[D]=n[D]}var F=new h(f.config);return bg=Object.assign({},_),F}function kg(e,t){return-1*function(e,t){return e<t?-1:e>t?1:0}(e,t)}function wg(e){if(null==e)return e;var t,n=[],r=Object(N.a)(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;-1===n.indexOf(a)&&n.push(a)}}catch(i){r.e(i)}finally{r.f()}return n}function Og(e){if(null==e)throw new og("Invalid value in obj: ".concat(JSON.stringify(e)));for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function Ig(e,t,n){if(null!=n&&e.indexOf(n)<0)throw new og("".concat(n," is not a valid ").concat(t,".  Valid values are ").concat(e," or null/undefined."))}function Sg(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;return dg(n>=0),dg(r>=n),Array.isArray(e)&&e.length>=n&&e.length<=r&&e.every((function(e){return typeof e===t}))}function Ng(e,t){Array.isArray(e)?(Ga.assert(e.length>0,(function(){return"".concat(t," is unexpectedly an empty array.")})),e.forEach((function(e,n){return Ng(e,"element ".concat(n+1," of ").concat(t))}))):Ga.assert(Number.isInteger(e)&&e>0,(function(){return"Expected ".concat(t," to be a positive integer, but got ").concat(function e(t){return null===t?"null":Array.isArray(t)?"["+t.map((function(t){return e(t)})).join(",")+"]":"string"==typeof t?'"'.concat(t,'"'):"".concat(t)}(e),".")}))}function jg(e){return"relu"===e?"relu":"linear"===e?"linear":"elu"===e?"elu":null}var Tg=0;function Cg(){return Tg++}var Eg={};function _g(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e in Eg||(Eg[e]=0),Eg[e]+=1,e+Eg[e].toString()}var Ag=["channelsFirst","channelsLast"],Rg=["nearest","bilinear"],Dg=["valid","same","causal"],Fg=["max","avg"],Mg=["sum","mul","concat","ave"],zg=new Map;function Lg(e){Ig(Ag,"DataFormat",e)}function Pg(e){Ig(Dg,"PaddingMode",e)}function Bg(e){Ig(Fg,"PoolMode",e)}var Wg=[];function Ug(e,t){Wg.push(e);try{var n=t();return Wg.pop(),n}catch(n){throw Wg.pop(),n}}function Vg(e){if(!Kg(e))throw new Error("Not a valid tensor name: '"+e+"'");return(0===Wg.length?"":Wg.join("/")+"/")+e}function Gg(e){if(!Kg(e))throw new Error("Not a valid tensor name: '"+e+"'");zg.has(e)||zg.set(e,0);var t=zg.get(e);if(zg.set(e,zg.get(e)+1),t>0){var n="".concat(e,"_").concat(t);return zg.set(n,1),n}return e}var Hg,qg=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function Kg(e){return!!e.match(qg)}function Xg(e){return e===parseInt(e.toString(),10)}function Yg(e,t,n){null==t&&(t=0),null==n&&(n=e.length);for(var r=1,a=t;a<n;++a)r*=e[a];return r}function Zg(e){if(0===e.length)return Number.NaN;for(var t=Number.POSITIVE_INFINITY,n=0;n<e.length;n++){var r=e[n];r<t&&(t=r)}return t}function Jg(e){if(0===e.length)return Number.NaN;for(var t=Number.NEGATIVE_INFINITY,n=0;n<e.length;n++){var r=e[n];r>t&&(t=r)}return t}function Qg(e,t){if(t<e)throw new og("end (".concat(t,") < begin (").concat(e,") is forbidden."));for(var n=[],r=e;r<t;++r)n.push(r);return n}function $g(){return null==Hg&&(Hg=Xs().epsilon()),Hg}function ey(e,t){return Ns(e,t)}function ty(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=e.shape.slice();return t<0&&(t=n.length+t+1),n.splice(t,0,1),Eu(e,n)}function ny(e){var t=[Yg(e.shape)];return Eu(e,t)}function ry(e,t,n){return zs((function(){switch(e.rank){case 1:return tp(e,t,n);case 2:return np(e,[t,0],[n,e.shape[1]]);case 3:return rp(e,[t,0,0],[n,e.shape[1],e.shape[2]]);case 4:return ap(e,[t,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3]]);case 5:return Mu(e,[t,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4]]);case 6:return Mu(e,[t,0,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4],e.shape[5]]);default:throw new og("sliceAlongFirstAxis() received an unsupported tensor rank: ".concat(e.rank))}}))}function ay(e,t,n){return zs((function(){switch(e.rank){case 1:return tp(e,t,n);case 2:return np(e,[0,t],[e.shape[0],n]);case 3:return rp(e,[0,0,t],[e.shape[0],e.shape[1],n]);case 4:return ap(e,[0,0,0,t],[e.shape[0],e.shape[1],e.shape[2],n]);default:throw new og("sliceAlongLastAxis() received an unsupported tensor rank: ".concat(e.rank))}}))}function iy(e,t,n,r){return zs((function(){switch(e.rank){case 1:return tp(e,t,n);case 2:switch(r){case 1:return ry(e,t,n);case 2:return ay(e,t,n);default:throw new og("The axis is not within the rank of the tensor ".concat(r))}case 3:switch(r){case 1:return ry(e,t,n);case 2:return rp(e,[0,t,0],[e.shape[0],n,e.shape[2]]);case 3:return ay(e,t,n);default:throw new og("The axis is not within the rank of the tensor ".concat(r))}case 4:switch(r){case 1:return ry(e,t,n);case 2:return ap(e,[0,t,0,0],[e.shape[0],n,e.shape[2],e.shape[3]]);case 3:return ap(e,[0,0,t,0],[e.shape[0],e.shape[1],n,e.shape[3]]);case 4:return ay(e,t,n);default:throw new og("The axis is not within the rank of the tensor ".concat(r))}default:throw new og("sliceAlongLastAxis() received an unsupported tensor rank: ".concat(e.rank))}}))}function oy(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return n<0&&(n=0!==(t=e[0].rank)?t:0),n===e[0].rank&&(n=-1),Ru(e,n)}function sy(e,t){switch(e.rank){case 1:return Qu([e,t]);case 2:return $u([e,t],0);case 3:return ec([e,t],0);case 4:return tc([e,t],0);default:throw new og("concatAlongFirstAxis() received an unsupported tensor rank: ".concat(e.rank))}}function uy(e,t){if(Array.isArray(t)||(t=[t]),e.rank!==t.length)throw new og("The length of input n (".concat(t.length,") does not match the number of dimensions in input x (").concat(e.rank,")"));return Qc(e,t)}function cy(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;return Ad(e,t,n,r,a)}function ly(e,t,n,r){if(e.rank<2||t.rank<2)throw new sg("dot requires both inputs to be rank >= 2 but got x shape = ".concat(e.shape," and y shape = ").concat(t.shape));if(t.rank>=3&&e.shape.slice(-1)[0]!==t.shape.slice(-2)[0])throw new sg("If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ".concat(e.shape," and  y shape = ").concat(t.shape));if(2===e.rank&&2===t.rank)return Jp.matMul({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?fy(e.rank,r,"channelsLast"):null,activation:n});var a=e.shape.slice(),i=a.pop();e=Eu(e,[-1,i]);var o=t.shape.slice(),s=o.pop(),u=o.pop(),c=[].concat(Object(S.a)(o),[s]),l=Array.from({length:t.rank},(function(e,n){return 0===n?t.rank-2:n<=t.rank-2?n-1:n}));t=Eu(Bp(t,l),[u,-1]);var d=[].concat(Object(S.a)(a),Object(S.a)(c));return Eu(Jp.matMul({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?fy(e.rank,r,"channelsLast"):null,activation:n}),d)}function dy(e,t,n){return zs((function(){return t=Array.isArray(t)?bp(t,"int32"):Ns(t,"int32"),tl(e,t,n)}))}function py(e){return $s(e,e)}function fy(e,t,n){var r=t.shape;if(1!==t.rank&&t.rank!==e)throw new og("Unexpected bias dimensions: ".concat(t.rank,"; expected it to be 1 or ").concat(e));if(5===e){if("channelsFirst"===n)return 1===r.length?Eu(t,[1,r[0],1,1,1]):Eu(t,[1,r[3],r[0],r[1],r[2]]);if("channelsLast"===n)return 1===r.length?Eu(t,[1,1,1,1,r[0]]):Eu(t,[1].concat(r))}else if(4===e){if("channelsFirst"===n)return 1===r.length?Eu(t,[1,r[0],1,1]):Eu(t,[1,r[2],r[0],r[1]]);if("channelsLast"===n)return 1===r.length?Eu(t,[1,1,1,r[0]]):Eu(t,[1].concat(r))}else if(3===e){if("channelsFirst"===n)return 1===r.length?Eu(t,[1,r[0],1]):Eu(t,[1,r[1],r[0]]);if("channelsLast"===n)return 1===r.length?Eu(t,[1,1,r[0]]):Eu(t,[1].concat(r))}else if(e<3)return t;throw new og("Unsupported input rank by biasAdd: ".concat(t.rank))}function hy(e,t,n){return zs((function(){return null==n&&(n="channelsLast"),Lg(n),Zs(e,fy(e.rank,t,n))}))}function my(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(1!==t)throw new sg("Support for alpha values other than 1 (".concat(t,") is not implemented yet."));return Tc(e)}function vy(e,t,n,r){return zs((function(){return qp(e,t,n,r)}))}function by(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return n?e():t()}var gy=["fanIn","fanOut","fanAvg"],yy=["normal","uniform","truncatedNormal"];var xy=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){return Object(O.a)(this,n),t.apply(this,arguments)}return Object(I.a)(n,[{key:"fromConfigUsesCustomObjects",value:function(){return!1}},{key:"getConfig",value:function(){return{}}}]),n}(gh.Serializable),ky=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){return Object(O.a)(this,n),t.apply(this,arguments)}return Object(I.a)(n,[{key:"apply",value:function(e,t){return Bl(e,t)}}]),n}(xy);ky.className="Zeros",gh.registerClass(ky);var wy=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){return Object(O.a)(this,n),t.apply(this,arguments)}return Object(I.a)(n,[{key:"apply",value:function(e,t){return Wl(e,t)}}]),n}(xy);wy.className="Ones",gh.registerClass(wy);var Oy=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;if(Object(O.a)(this,n),r=t.call(this),"object"!=typeof e)throw new og("Expected argument of type ConstantConfig but got ".concat(e));if(void 0===e.value)throw new og("config must have value set but got ".concat(e));return r.value=e.value,Object(m.a)(r)}return Object(I.a)(n,[{key:"apply",value:function(e,t){var n=this;return zs((function(){return $s(Uc(n.value),Wl(e,t))}))}},{key:"getConfig",value:function(){return{value:this.value}}}]),n}(xy);Oy.className="Constant",gh.registerClass(Oy);var Iy=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(O.a)(this,n),(r=t.call(this)).DEFAULT_MINVAL=-.05,r.DEFAULT_MAXVAL=.05,r.minval=e.minval||r.DEFAULT_MINVAL,r.maxval=e.maxval||r.DEFAULT_MAXVAL,r.seed=e.seed,r}return Object(I.a)(n,[{key:"apply",value:function(e,t){return Dd(e,this.minval,this.maxval,t,this.seed)}},{key:"getConfig",value:function(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}]),n}(xy);Iy.className="RandomUniform",gh.registerClass(Iy);var Sy=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(O.a)(this,n),(r=t.call(this)).DEFAULT_MEAN=0,r.DEFAULT_STDDEV=.05,r.mean=e.mean||r.DEFAULT_MEAN,r.stddev=e.stddev||r.DEFAULT_STDDEV,r.seed=e.seed,r}return Object(I.a)(n,[{key:"apply",value:function(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new sg("randomNormal does not support dType ".concat(t,"."));return cy(e,this.mean,this.stddev,t,this.seed)}},{key:"getConfig",value:function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}]),n}(xy);Sy.className="RandomNormal",gh.registerClass(Sy);var Ny=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(O.a)(this,n),(r=t.call(this)).DEFAULT_MEAN=0,r.DEFAULT_STDDEV=.05,r.mean=e.mean||r.DEFAULT_MEAN,r.stddev=e.stddev||r.DEFAULT_STDDEV,r.seed=e.seed,r}return Object(I.a)(n,[{key:"apply",value:function(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new sg("truncatedNormal does not support dType ".concat(t,"."));return Cp(e,this.mean,this.stddev,t,this.seed)}},{key:"getConfig",value:function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}]),n}(xy);Ny.className="TruncatedNormal",gh.registerClass(Ny);var jy=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(O.a)(this,n),(r=t.call(this)).gain=null!=e.gain?e.gain:1,r}return Object(I.a)(n,[{key:"apply",value:function(e,t){var n=this;return zs((function(){if(2!==e.length||e[0]!==e[1])throw new og("Identity matrix initializer can only be used for 2D square matrices.");return $s(n.gain,$c(e[0]))}))}},{key:"getConfig",value:function(){return{gain:this.gain}}}]),n}(xy);jy.className="Identity",gh.registerClass(jy);var Ty=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;if(Object(O.a)(this,n),r=t.call(this),e.scale<0)throw new og("scale must be a positive float. Got: ".concat(e.scale));return r.scale=null==e.scale?1:e.scale,r.mode=null==e.mode?"fanIn":e.mode,function(e){Ig(gy,"FanMode",e)}(r.mode),r.distribution=null==e.distribution?"normal":e.distribution,function(e){Ig(yy,"Distribution",e)}(r.distribution),r.seed=e.seed,Object(m.a)(r)}return Object(I.a)(n,[{key:"apply",value:function(e,t){var n=function(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"channelsLast";if(Lg(r),2===e.length)t=e[0],n=e[1];else if(-1!==[3,4,5].indexOf(e.length)){if("channelsFirst"===r){var a=Yg(e,2);t=e[1]*a,n=e[0]*a}else if("channelsLast"===r){var i=Yg(e,0,e.length-2);t=e[e.length-2]*i,n=e[e.length-1]*i}}else{var o=Yg(e);t=Math.sqrt(o),n=Math.sqrt(o)}return[t,n]}(e),r=n[0],a=n[1],i=this.scale;if("fanIn"===this.mode?i/=Math.max(1,r):"fanOut"===this.mode?i/=Math.max(1,a):i/=Math.max(1,(r+a)/2),"normal"===this.distribution){var o=Math.sqrt(i);if("float32"!==(t=t||"float32")&&"int32"!==t)throw new sg("".concat(this.getClassName()," does not support dType ").concat(t,"."));return Cp(e,0,o,t,this.seed)}var s=Math.sqrt(3*i);return Dd(e,-s,s,t,this.seed)}},{key:"getConfig",value:function(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}]),n}(xy);Ty.className="VarianceScaling",gh.registerClass(Ty);var Cy=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){return Object(O.a)(this,n),t.call(this,{scale:1,mode:"fanAvg",distribution:"uniform",seed:null==e?null:e.seed})}return Object(I.a)(n,[{key:"getClassName",value:function(){return Ty.className}}]),n}(Ty);Cy.className="GlorotUniform",gh.registerClass(Cy);var Ey=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){return Object(O.a)(this,n),t.call(this,{scale:1,mode:"fanAvg",distribution:"normal",seed:null==e?null:e.seed})}return Object(I.a)(n,[{key:"getClassName",value:function(){return Ty.className}}]),n}(Ty);Ey.className="GlorotNormal",gh.registerClass(Ey);var _y=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){return Object(O.a)(this,n),t.call(this,{scale:2,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})}return Object(I.a)(n,[{key:"getClassName",value:function(){return Ty.className}}]),n}(Ty);_y.className="HeNormal",gh.registerClass(_y);var Ay=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){return Object(O.a)(this,n),t.call(this,{scale:2,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})}return Object(I.a)(n,[{key:"getClassName",value:function(){return Ty.className}}]),n}(Ty);Ay.className="HeUniform",gh.registerClass(Ay);var Ry=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){return Object(O.a)(this,n),t.call(this,{scale:1,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})}return Object(I.a)(n,[{key:"getClassName",value:function(){return Ty.className}}]),n}(Ty);Ry.className="LeCunNormal",gh.registerClass(Ry);var Dy=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){return Object(O.a)(this,n),t.call(this,{scale:1,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})}return Object(I.a)(n,[{key:"getClassName",value:function(){return Ty.className}}]),n}(Ty);Dy.className="LeCunUniform",gh.registerClass(Dy);var Fy=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(O.a)(this,n),(r=t.call(this)).DEFAULT_GAIN=1,r.ELEMENTS_WARN_SLOW=2e3,r.gain=null==e.gain?r.DEFAULT_GAIN:e.gain,r.seed=e.seed,r}return Object(I.a)(n,[{key:"apply",value:function(e,t){var n=this;return zs((function(){if(e.length<2)throw new sg("Shape must be at least 2D.");if("int32"!==t&&"float32"!==t&&void 0!==t)throw new TypeError("Unsupported data type ".concat(t,"."));t=t;var r=Ga.sizeFromShape(e.slice(0,-1)),a=e[e.length-1],i=r*a;i>n.ELEMENTS_WARN_SLOW&&console.warn("Orthogonal initializer is being called on a matrix with more than ".concat(n.ELEMENTS_WARN_SLOW," (").concat(i,") elements: Slowness may result."));var o=cy([Math.max(a,r),Math.min(a,r)],0,1,t,n.seed),s=hh.qr(o,!1),u=s[0],c=s[1].flatten().stridedSlice([0],[Math.min(a,r)*Math.min(a,r)],[Math.min(a,r)+1]);return u=$s(u,c.sign()),r<a&&(u=u.transpose()),$s(Uc(n.gain),u.reshape(e))}))}},{key:"getConfig",value:function(){return{gain:this.gain,seed:this.seed}}}]),n}(xy);Fy.className="Orthogonal",gh.registerClass(Fy);var My={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function zy(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return xg(e,gh.SerializationMap.getMap().classNameMap,t,"initializer")}function Ly(e){return gg(e)}function Py(e){if("string"==typeof e){var t=e in My?My[e]:e;if("GlorotNormal"===t)return new Ey;if("GlorotUniform"===t)return new Cy;if("HeNormal"===t)return new _y;if("HeUniform"===t)return new Ay;if("LeCunNormal"===t)return new Ry;if("LeCunUniform"===t)return new Dy;var n={};return n.className=t,n.config={},zy(n)}return e instanceof xy?e:zy(e)}function By(e){return Array.isArray(e)&&Array.isArray(e[0])}function Wy(e){return 0===e.length?[]:Array.isArray(e[0])?e:[e]}function Uy(e){var t;if(Array.isArray(e)){if(1!==e.length)throw new og("Expected Tensor length to be 1; got ".concat(e.length));t=e[0]}else t=e;return t}function Vy(e){if(Array.isArray(e)&&Array.isArray(e[0])){if(1===e.length)return(e=e)[0];throw new og("Expected exactly 1 Shape; got ".concat(e.length))}return e}function Gy(e){var t,n=0,r=Object(N.a)(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;0===a.shape.length?n+=1:n+=a.shape.reduce((function(e,t){return e*t}))}}catch(i){r.e(i)}finally{r.f()}return n}var Hy="Variable",qy=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Hy,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;Object(O.a)(this,e),this.dtype=null==n?"float32":n,this.shape=t.shape,this.id=Cg(),r=null==r?Hy:r,this.originalName=Vg(r),this.name=Gg(this.originalName),this.trainable_=a,this.constraint=i,this.val=Dp(t,this.trainable_,this.name,this.dtype)}return Object(I.a)(e,[{key:"read",value:function(){return this.assertNotDisposed(),this.val}},{key:"write",value:function(e){return this.assertNotDisposed(),function(e,t){if(e.shape.toString()!==t.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(e.shape)+" vs. "+JSON.stringify(t.shape))}(this.val,e),this.val.id!==e.id&&(this.val.assign(e),null!=this.constraint&&this.val.assign(this.constraint.apply(this.val))),this}},{key:"dispose",value:function(){this.assertNotDisposed(),this.val.dispose()}},{key:"assertNotDisposed",value:function(){if(this.val.isDisposed)throw new Error("LayersVariable ".concat(this.name," is already disposed."))}},{key:"trainable",get:function(){return this.trainable_},set:function(e){this.trainable_=e,this.val.trainable=e}}]),e}();function Ky(e){return e.map((function(e){return e.read()}))}function Xy(e){e.forEach((function(e){e[0].write(e[1])}))}var Yy=function e(t){Object(O.a)(this,e),this.dtype=t.dtype,this.shape=t.shape,null!=t.shape?this.ndim=t.shape.length:this.ndim=t.ndim,this.maxNDim=t.maxNDim,this.minNDim=t.minNDim,this.axes=t.axes||{}},Zy=function e(t,n,r,a,i,o,s){Object(O.a)(this,e),this.dtype=t,this.shape=n,this.sourceLayer=r,this.inputs=a,this.callArgs=i,this.outputTensorIndex=s,this.id=Cg(),null!=o&&(this.originalName=Vg(o),this.name=Gg(this.originalName)),this.rank=n.length},Jy=0,Qy=function(){function e(t,n){Object(O.a)(this,e),this.callArgs=n,this.id=Jy++,this.outboundLayer=t.outboundLayer,this.inboundLayers=t.inboundLayers,this.nodeIndices=t.nodeIndices,this.tensorIndices=t.tensorIndices,this.inputTensors=t.inputTensors,this.outputTensors=t.outputTensors,this.inputMasks=t.inputMasks,this.outputMasks=t.outputMasks,this.inputShapes=t.inputShapes,this.outputShapes=t.outputShapes;var r,a=Object(N.a)(t.inboundLayers);try{for(a.s();!(r=a.n()).done;){var i=r.value;null!=i&&i.outboundNodes.push(this)}}catch(o){a.e(o)}finally{a.f()}t.outboundLayer.inboundNodes.push(this)}return Object(I.a)(e,[{key:"getConfig",value:function(){var e,t=[],n=Object(N.a)(this.inboundLayers);try{for(n.s();!(e=n.n()).done;){var r=e.value;null!=r?t.push(r.name):t.push(null)}}catch(a){n.e(a)}finally{n.f()}return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:t,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}]),e}(),$y=0,ex=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(O.a)(this,n),(e=t.call(this))._callHook=null,e._addedWeightNames=[],e._stateful=!1,e.id=$y++,e.activityRegularizer=null,e.inputSpec=null,e.supportsMasking=!1,e._trainableWeights=[],e._nonTrainableWeights=[],e._losses=[],e._updates=[],e._built=!1,e.inboundNodes=[],e.outboundNodes=[];var a=r.name;if(!a){var i=e.getClassName();a=mg(i)+"_"+_g(i)}if(e.name=a,e.trainable_=null==r.trainable||r.trainable,null!=r.inputShape||null!=r.batchInputShape){var o;if(null!=r.batchInputShape)o=r.batchInputShape;else if(null!=r.inputShape){var s=null;null!=r.batchSize&&(s=r.batchSize),o=[s].concat(r.inputShape)}e.batchInputShape=o;var u=r.dtype;null==u&&(u=r.inputDType),null==u&&(u="float32"),e.dtype=u}return null!=r.weights?e.initialWeights=r.weights:e.initialWeights=null,e._refCount=null,e.fastWeightInitDuringBuild=!1,e}return Object(I.a)(n,[{key:"getNodeAtIndex",value:function(e,t){if(0===this.inboundNodes.length)throw new ig("The layer has never been called and thus has no defined ".concat(t,"."));if(this.inboundNodes.length<=e)throw new og("Asked to get ".concat(t," at node ").concat(e,", but the layer has only ").concat(this.inboundNodes.length," inbound nodes."));return this.inboundNodes[e]}},{key:"getInputAt",value:function(e){return fg(this.getNodeAtIndex(e,"input").inputTensors)}},{key:"getOutputAt",value:function(e){return fg(this.getNodeAtIndex(e,"output").outputTensors)}},{key:"calculateLosses",value:function(){return this.losses.map((function(e){return e()}))}},{key:"resetStates",value:function(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}},{key:"assertInputCompatibility",value:function(e){if(e=hg(e),null!=this.inputSpec&&0!==this.inputSpec.length){var t=hg(this.inputSpec);if(e.length!==t.length)throw new og("Layer ".concat(this.name," expects ").concat(t.length," inputs, but it received ").concat(e.length," input tensors. Input received: ").concat(e));for(var n=0;n<e.length;n++){var r=e[n],a=t[n];if(null!=a){var i=r.rank;if(null!=a.ndim&&i!==a.ndim)throw new og("Input ".concat(n," is incompatible with layer ").concat(this.name,": expected ndim=").concat(a.ndim,", found ndim=").concat(i));if(null!=a.maxNDim&&i>a.maxNDim)throw new og("Input ".concat(n," is incompatible with layer ").concat(this.name,": expected max_ndim=").concat(a.maxNDim,", found ndim=").concat(i));if(null!=a.minNDim&&i<a.minNDim)throw new og("Input ".concat(n," is incompatible with layer ").concat(this.name,": expected min_ndim=").concat(a.minNDim,", found ndim=").concat(i,"."));if(null!=a.dtype&&r.dtype!==a.dtype)throw new og("Input ".concat(n," is incompatible with layer ").concat(this.name," : expected dtype=").concat(a.dtype,", found dtype=").concat(r.dtype,"."));if(a.axes){var o=r.shape;for(var s in a.axes){var u=Number(s),c=a.axes[s],l=u>=0?o[u]:o[o.length+u];if(null!=c&&-1===[c,null].indexOf(l))throw new og("Input ".concat(n," is incompatible with layer ").concat(this.name,": expected axis ").concat(u," of input shape to have value ").concat(c," but got shape ").concat(o,"."))}}if(null!=a.shape)for(var d=0;d<a.shape.length;++d){var p=a.shape[d],f=r.shape[d];if(null!=p&&null!=f&&p!==f)throw new og("Input ".concat(n," is incompatible with layer ").concat(this.name,": expected shape=").concat(a.shape,", found shape=").concat(r.shape,"."))}}}}}},{key:"call",value:function(e,t){return e}},{key:"invokeCallHook",value:function(e,t){null!=this._callHook&&this._callHook(e,t)}},{key:"setCallHook",value:function(e){this._callHook=e}},{key:"clearCallHook",value:function(){this._callHook=null}},{key:"apply",value:function(e,t){var n=this;t=t||{},this.assertNotDisposed();var r,a=hg(e),i=!0,o=Object(N.a)(a);try{for(o.s();!(r=o.n()).done;){if(!(r.value instanceof Zy)){i=!1;break}}}catch(l){o.e(l)}finally{o.f()}var s,u=!0,c=Object(N.a)(a);try{for(c.s();!(s=c.n()).done;){if(s.value instanceof Zy){u=!1;break}}}catch(l){c.e(l)}finally{c.f()}if(i===u)throw new og("Arguments to apply() must be all SymbolicTensors or all Tensors");return Ug(this.name,(function(){if(!n.built){n.assertInputCompatibility(e);var r,i=[],o=Object(N.a)(hg(e));try{for(o.s();!(r=o.n()).done;){var s=r.value;i.push(s.shape)}}catch(l){o.e(l)}finally{o.f()}n.build(fg(i)),n.built=!0,n.initialWeights&&n.setWeights(n.initialWeights),null===n._refCount&&u&&(n._refCount=1)}if(n.assertInputCompatibility(e),u){var c,d=n.call(e,t),p=hg(d),f=[],h=Object(N.a)(p);try{for(h.s();!(c=h.n()).done;){var m=c.value;-1!==a.indexOf(m)&&(m=m.clone()),f.push(m)}}catch(l){h.e(l)}finally{h.f()}if(d=fg(f),null!=n.activityRegularizer)throw new sg("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return d}var v,b=function(e){e=hg(e);var t,n=[],r=Object(N.a)(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;n.push(a.shape)}}catch(l){r.e(l)}finally{r.f()}return fg(n)}(e),g=n.computeOutputShape(b);if(n.warnOnIncompatibleInputShape(Array.isArray(e)?b[0]:b),v=null!=g&&g.length>0&&Array.isArray(g[0])?g.map((function(r,a){return new Zy("float32",r,n,hg(e),t,n.name,a)})):new Zy("float32",g,n,hg(e),t,n.name),n.addInboundNode(e,v,null,null,b,g,t),n._refCount++,null!=n.activityRegularizer)throw new sg("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return v}))}},{key:"warnOnIncompatibleInputShape",value:function(e){if(null!=this.batchInputShape)if(e.length!==this.batchInputShape.length)console.warn("The rank of the input tensor provided (shape: ".concat(JSON.stringify(e),") does not match that of the batchInputShape (").concat(JSON.stringify(this.batchInputShape),") of the layer ").concat(this.name));else{var t=!1;this.batchInputShape.forEach((function(n,r){null!=n&&null!=e[r]&&e[r]!==n&&(t=!0)})),t&&console.warn("The shape of the input tensor (".concat(JSON.stringify(e),") does not match the expectation of layer ").concat(this.name,": ").concat(JSON.stringify(this.batchInputShape)))}}},{key:"countParams",value:function(){if(!this.built)throw new ig("You tried to call countParams() on ".concat(this.name,", but the layer is not built yet. Build it first by calling build(batchInputShape)."));return Gy(this.weights)}},{key:"build",value:function(e){this.built=!0}},{key:"getWeights",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return Ky(e?this.trainableWeights:this.weights)}},{key:"setWeights",value:function(e){var t=this;zs((function(){var n=t.weights;if(n.length!==e.length)throw new og('You called setWeights(weights) on layer "'.concat(t.name,'" with a weight list of length ').concat(e.length,", but the layer was expecting ").concat(n.length," weights. Provided weights: ").concat(e,"..."));if(0!==n.length){for(var r=[],a=Ky(n),i=0;i<a.length;++i){var o=a[i],s=n[i],u=e[i];if(!Ga.arraysEqual(o.shape,u.shape))throw new og("Layer weight shape ".concat(o.shape," not compatible with provided weight shape ").concat(u.shape));r.push([s,u])}Xy(r)}}))}},{key:"addWeight",value:function(e,t,n,r,a,i,o,s){if(-1!==this._addedWeightNames.indexOf(e))throw new og("Duplicate weight name ".concat(e," for layer ").concat(this.name));this._addedWeightNames.push(e),null==n&&(n="float32"),this.fastWeightInitDuringBuild&&(r=null!=s?s():Py("zeros"));var u=r.apply(t,n),c=new qy(u,n,e,i,o);return u.dispose(),null!=a&&this.addLoss((function(){return a.apply(c.read())})),null==i&&(i=!0),i?this._trainableWeights.push(c):this._nonTrainableWeights.push(c),c}},{key:"setFastWeightInitDuringBuild",value:function(e){this.fastWeightInitDuringBuild=e}},{key:"addLoss",value:function(e){var t;null==e||Array.isArray(e)&&0===e.length||(e=hg(e),void 0!==this._losses&&null!==this._losses&&(t=this.losses).push.apply(t,Object(S.a)(e)))}},{key:"computeOutputShape",value:function(e){return e}},{key:"computeMask",value:function(e,t){var n=this;if(!this.supportsMasking){if(null!=t){if(!Array.isArray(t))throw new TypeError("Layer ".concat(this.name," does not support masking, but was passed an inputMask."));t.forEach((function(e){if(null!=e)throw new TypeError("Layer ".concat(n.name," does not support masking, but was passed an inputMask."))}))}return null}return t}},{key:"addInboundNode",value:function(e,t,n,r,a,i){var o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=hg(e);t=hg(t),n=hg(n),r=hg(r),a=Wy(a),i=Wy(i);var u,c=[],l=[],d=[],p=Object(N.a)(s);try{for(p.s();!(u=p.n()).done;){var f=u.value;c.push(f.sourceLayer),l.push(f.nodeIndex),d.push(f.tensorIndex)}}catch(m){p.e(m)}finally{p.f()}new Qy({outboundLayer:this,inboundLayers:c,nodeIndices:l,tensorIndices:d,inputTensors:s,outputTensors:t,inputMasks:n,outputMasks:r,inputShapes:a,outputShapes:i},o);for(var h=0;h<t.length;h++)t[h].sourceLayer=this,t[h].nodeIndex=this.inboundNodes.length-1,t[h].tensorIndex=h}},{key:"getConfig",value:function(){var e={name:this.name,trainable:this.trainable};return null!=this.batchInputShape&&(e.batchInputShape=this.batchInputShape),null!=this.dtype&&(e.dtype=this.dtype),e}},{key:"disposeWeights",value:function(){return this.weights.forEach((function(e){return e.dispose()})),this.weights.length}},{key:"assertNotDisposed",value:function(){if(0===this._refCount)throw new Error("Layer '".concat(this.name,"' is already disposed."))}},{key:"dispose",value:function(){if(!this.built)throw new Error("Cannot dispose Layer ".concat(this.name," because it has not been built yet."));if(null===this._refCount)throw new Error("Cannot dispose Layer ".concat(this.name," because it has not been used yet."));this.assertNotDisposed();var e=0;return 0===--this._refCount&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}},{key:"input",get:function(){if(this.inboundNodes.length>1)throw new ag("Layer ".concat(this.name,' has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use `getInputAt(nodeIndex)` instead.'));if(0===this.inboundNodes.length)throw new ag("Layer ".concat(this.name," is not connected, no input to return."));return fg(this.getNodeAtIndex(0,"input").inputTensors)}},{key:"output",get:function(){if(0===this.inboundNodes.length)throw new ag("Layer ".concat(this.name," has no inbound nodes."));if(this.inboundNodes.length>1)throw new ag("Layer ".concat(this.name,' has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use `getOutputAt(nodeIndex)` instead.'));return fg(this.getNodeAtIndex(0,"output").outputTensors)}},{key:"losses",get:function(){return this._losses}},{key:"updates",get:function(){return this._updates}},{key:"built",get:function(){return this._built},set:function(e){this._built=e}},{key:"trainable",get:function(){return this.trainable_},set:function(e){this._trainableWeights.forEach((function(t){return t.trainable=e})),this.trainable_=e}},{key:"trainableWeights",get:function(){return this.trainable_?this._trainableWeights.filter((function(e){return e.trainable})):[]},set:function(e){this._trainableWeights=e}},{key:"nonTrainableWeights",get:function(){return this.trainable?this._trainableWeights.filter((function(e){return!e.trainable})).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)},set:function(e){this._nonTrainableWeights=e}},{key:"weights",get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)}},{key:"stateful",get:function(){return this._stateful}},{key:"outputShape",get:function(){if(null==this.inboundNodes||0===this.inboundNodes.length)throw new ag("The layer ".concat(this.name," has never been called and thus has no defined output shape."));var e,t=[],n=Object(N.a)(this.inboundNodes);try{for(n.s();!(e=n.n()).done;){var r=e.value,a=JSON.stringify(r.outputShapes);-1===t.indexOf(a)&&t.push(a)}}catch(o){n.e(o)}finally{n.f()}if(1===t.length){var i=this.inboundNodes[0].outputShapes;return Array.isArray(i)&&Array.isArray(i[0])&&1===i.length?i[0]:i}throw new ag("The layer ".concat(this.name,' has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.'))}}],[{key:"nodeKey",value:function(e,t){return e.name+"_ib-"+t.toString()}}]),n}(gh.Serializable);var tx=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;if(Object(O.a)(this,n),r=t.call(this,{dtype:e.dtype,name:null!=e.name?e.name:_g("input").toString()}),null==e.batchSize&&(e.batchSize=null),null==e.sparse&&(e.sparse=!1),r.trainable=!1,r.built=!0,r.sparse=e.sparse,null!=e.inputShape&&null!=e.batchInputShape)throw new og("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");var a=e.batchInputShape;if(null==a){if(null==e.inputShape)throw new og("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");a=[e.batchSize].concat(e.inputShape)}else if(null!=e.batchSize)throw new og("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");var i=e.dtype||"float32";r.batchInputShape=a,r.dtype=i,r.inputSpec=[{shape:a}];var o=new Zy(r.dtype,r.batchInputShape,Object(f.a)(r),[],{},r.name);return o.nodeIndex=0,o.tensorIndex=0,new Qy({outboundLayer:Object(f.a)(r),inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[o],outputTensors:[o],inputMasks:[null],outputMasks:[null],inputShapes:[a],outputShapes:[a]}),Object(m.a)(r)}return Object(I.a)(n,[{key:"apply",value:function(e,t){throw new og("Cannot pass any input to an InputLayer's apply() method. InputLayer name: ".concat(this.name))}},{key:"dispose",value:function(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}},{key:"getConfig",value:function(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}]),n}(ex);function nx(e){if(null==e.batchShape&&null==e.shape)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(null!=e.batchShape&&null!=e.shape)throw new og("Please provide either a `shape` or `batchShape` argument to Input, but not both.");var t=e.batchShape;null!=e.shape&&null==t&&(t=[null].concat(e.shape));var n=e.dtype;return null==n&&(n="float32"),new tx({batchInputShape:t,name:e.name,dtype:n,sparse:e.sparse}).inboundNodes[0].outputTensors[0]}tx.className="InputLayer",gh.registerClass(tx);var rx=function(){function e(t){if(Object(O.a)(this,e),this.id2Value={},this.id2Mask={},this.name2Id={},t instanceof e)for(var n in t.id2Value)this.id2Value[n]=t.id2Value[n],n in t.id2Mask&&(this.id2Mask[n]=t.id2Mask[n]);else{if(null==t)return;var r,a=Object(N.a)(t);try{for(a.s();!(r=a.n()).done;){var i=r.value;this.add(i.key,i.value)}}catch(o){a.e(o)}finally{a.f()}}}return Object(I.a)(e,[{key:"add",value:function(e,t,n){if(null!=this.id2Value[e.id])throw new og("Duplicate key: name=".concat(e.name,", id=").concat(e.id));return this.id2Value[e.id]=function(e,t){if(null==e.dtype||e.dtype===t.dtype)return t;try{return Ns(t,e.dtype)}catch(n){throw new og("The dtype of the feed (".concat(t.dtype,") can not be cast to the dtype of the key '").concat(e.name,"' (").concat(e.dtype,")."))}}(e,t),this.name2Id[e.name]=e.id,null!=n&&(this.id2Mask[e.id]=n),this}},{key:"addFeed",value:function(e){this.add(e.key,e.value)}},{key:"hasKey",value:function(e){return null!=this.id2Value[e.id]}},{key:"names",value:function(){return Object.keys(this.name2Id)}},{key:"getValue",value:function(e){if(e instanceof Zy){if(null==this.id2Value[e.id])throw new og("Nonexistent key: ".concat(e.name));return this.id2Value[e.id]}var t=this.name2Id[e];if(null==t)throw new og("Feed dict has no SymbolicTensor name: ".concat(e));return this.id2Value[t]}},{key:"getMask",value:function(e){if(e instanceof Zy){if(null==this.id2Value[e.id])throw new og("Nonexistent key: ".concat(e.name));return this.id2Mask[e.id]}var t=this.name2Id[e];if(null==t)throw new og("Feed dict has no SymbolicTensor name: ".concat(e));return this.id2Mask[t]}},{key:"disposeMasks",value:function(){null!=this.id2Mask&&Ls(this.id2Mask)}}]),e}(),ax=new cg,ix=new cg;function ox(e,t,n,r){var a,i=null!=n&&n.training,o=Array.isArray(e),s=o?e:[e],u=s.map((function(e){return e.name})),c=[],l=t.names(),d=Object(N.a)(u);try{for(d.s();!(a=d.n()).done;){var p=a.value;-1!==l.indexOf(p)?c.push(t.getValue(p)):c.push(null)}}catch(L){d.e(L)}finally{d.f()}null!=r&&(r.maxNumTensors=-1/0,r.minNumTensors=1/0);var f,h=u.join(",")+"|"+t.names().sort().join(","),m=ax.get(h);if(null==m){var v=function(e,t){Ga.assert(null!=e&&e.length>0,(function(){return"Expected at least one fetch, got none"}));var n=[],r={};if(1===e.length){var a=ux(e[0],t);n=a.sorted,r=a.recipientMap}else{var i,o=new Set,s=Object(N.a)(e);try{for(s.s();!(i=s.n()).done;){var u,c=ux(i.value,t),l=c.sorted,d=c.recipientMap,p=Object(N.a)(l);try{for(p.s();!(u=p.n()).done;){var f=u.value;o.has(f.name)||(n.push(f),o.add(f.name))}}catch(L){p.e(L)}finally{p.f()}var h=function(e){null==r[e]&&(r[e]=new Set),d[e].forEach((function(t){return r[e].add(t)}))};for(var m in d)h(m)}}catch(L){s.e(L)}finally{s.f()}}return{sorted:n,recipientCounts:sx(r)}}(s,t);m=v.sorted,f=v.recipientCounts,ax.put(h,m),ix.put(h,f)}f={},i||Object.assign(f,ix.get(h));for(var b=new rx(t),g=0;g<m.length;++g){if(null!=r){var y=Fs().numTensors;y>r.maxNumTensors&&(r.maxNumTensors=y),y<r.minNumTensors&&(r.minNumTensors=y)}var x=m[g],k=x.sourceLayer;if(!(k instanceof tx)){var w,O=[],I=[],S=[],j=!1,T=Object(N.a)(x.inputs);try{for(T.s();!(w=T.n()).done;){var C=w.value,E=b.getValue(C),_=b.getMask(C);O.push(E),I.push(_),null!=_&&(j=!0),i||(f[C.name]--,0===f[C.name]&&!t.hasKey(C)&&-1===u.indexOf(C.name)&&!E.isDisposed&&!0!==C.sourceLayer.stateful&&S.push(E))}}catch(L){T.e(L)}finally{T.f()}j&&((n=n||{}).mask=I[0]);var A=hg(k.apply(O,n)),R=null;k.supportsMasking&&(R=k.computeMask(O,I));for(var D=cx(x),F=Array.isArray(D)?D:[D],M=0;M<F.length;++M){b.hasKey(F[M])||b.add(F[M],A[M],Array.isArray(R)?R[0]:R);var z=u.indexOf(F[M].name);-1!==z&&(c[z]=A[M])}i||Ls(S)}}return b.disposeMasks(),o?c:c[0]}function sx(e){var t={};for(var n in e)t[n]=e[n].size;return t}function ux(e,t){var n,r=new Set,a=[],i={},o=Object(N.a)(t.names());try{for(o.s();!(n=o.n()).done;){var s=n.value;r.add(s)}}catch(m){o.e(m)}finally{o.f()}var u=[],c=[];for(u.push(e);u.length>0;){var l=u[u.length-1];if(r.has(l.name))u.pop();else{var d=c[c.length-1]===u.length-1;if(0===l.inputs.length||d)u.pop(),a.push(l),r.add(l.name),d&&c.pop();else{c.push(u.length-1);var p,f=Object(N.a)(l.inputs);try{for(f.s();!(p=f.n()).done;){var h=p.value;null==i[h.name]&&(i[h.name]=new Set),i[h.name].add(l.name),!r.has(h.name)&&u.push(h)}}catch(m){f.e(m)}finally{f.f()}}}}return{sorted:a,recipientMap:i}}function cx(e){var t;if(1===e.sourceLayer.inboundNodes.length)t=e.sourceLayer.output;else{for(var n=null,r=0;r<e.sourceLayer.inboundNodes.length;++r){var a,i=Object(N.a)(e.sourceLayer.inboundNodes[r].outputTensors);try{for(i.s();!(a=i.n()).done;){if(a.value.id===e.id){n=r;break}}}catch(o){i.e(o)}finally{i.f()}}t=e.sourceLayer.getOutputAt(n)}return t}st().registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",(function(){return 100}),(function(e){null!=ax&&ax.setMaxEntries(e),null!=ix&&ix.setMaxEntries(e)}));var lx={};function dx(e,t){return zs((function(){return Vc(Hc($s(e,e),t,!0))}))}z(lx,{maxNorm:function(){return kx},minMaxNorm:function(){return Ix},nonNeg:function(){return Ox},unitNorm:function(){return wx}});var px=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){return Object(O.a)(this,n),t.apply(this,arguments)}return Object(I.a)(n,[{key:"getConfig",value:function(){return{}}}]),n}(gh.Serializable),fx=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(O.a)(this,n),(r=t.call(this)).defaultMaxValue=2,r.defaultAxis=0,r.maxValue=null!=e.maxValue?e.maxValue:r.defaultMaxValue,r.axis=null!=e.axis?e.axis:r.defaultAxis,r}return Object(I.a)(n,[{key:"apply",value:function(e){var t=this;return zs((function(){var n=dx(e,t.axis),r=Ju(n,0,t.maxValue);return $s(e,Qs(r,Zs($g(),n)))}))}},{key:"getConfig",value:function(){return{maxValue:this.maxValue,axis:this.axis}}}]),n}(px);fx.className="MaxNorm",gh.registerClass(fx);var hx=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(O.a)(this,n),(r=t.call(this)).defaultAxis=0,r.axis=null!=e.axis?e.axis:r.defaultAxis,r}return Object(I.a)(n,[{key:"apply",value:function(e){var t=this;return zs((function(){return Qs(e,Zs($g(),dx(e,t.axis)))}))}},{key:"getConfig",value:function(){return{axis:this.axis}}}]),n}(px);hx.className="UnitNorm",gh.registerClass(hx);var mx=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){return Object(O.a)(this,n),t.apply(this,arguments)}return Object(I.a)(n,[{key:"apply",value:function(e){return Pd(e)}}]),n}(px);mx.className="NonNeg",gh.registerClass(mx);var vx=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(O.a)(this,n),(r=t.call(this)).defaultMinValue=0,r.defaultMaxValue=1,r.defaultRate=1,r.defaultAxis=0,r.minValue=null!=e.minValue?e.minValue:r.defaultMinValue,r.maxValue=null!=e.maxValue?e.maxValue:r.defaultMaxValue,r.rate=null!=e.rate?e.rate:r.defaultRate,r.axis=null!=e.axis?e.axis:r.defaultAxis,r}return Object(I.a)(n,[{key:"apply",value:function(e){var t=this;return zs((function(){var n=dx(e,t.axis),r=Zs($s(t.rate,Ju(n,t.minValue,t.maxValue)),$s(1-t.rate,n));return $s(e,Qs(r,Zs($g(),n)))}))}},{key:"getConfig",value:function(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}]),n}(px);vx.className="MinMaxNorm",gh.registerClass(vx);var bx={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function gx(e){return gg(e)}function yx(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return xg(e,gh.SerializationMap.getMap().classNameMap,t,"constraint")}function xx(e){return null==e?null:"string"==typeof e?yx({className:e in bx?bx[e]:e,config:{}}):e instanceof px?e:yx(e)}function kx(e){return new fx(e)}function wx(e){return new hx(e)}function Ox(){return new mx}function Ix(e){return new vx(e)}var Sx={};function Nx(){return new ky}function jx(){return new wy}function Tx(e){return new Oy(e)}function Cx(e){return new Iy(e)}function Ex(e){return new Sy(e)}function _x(e){return new Ny(e)}function Ax(e){return new jy(e)}function Rx(e){return new Ty(e)}function Dx(e){return new Cy(e)}function Fx(e){return new Ey(e)}function Mx(e){return new _y(e)}function zx(e){return new Ay(e)}function Lx(e){return new Ry(e)}function Px(e){return new Dy(e)}function Bx(e){return new Fy(e)}z(Sx,{constant:function(){return Tx},glorotNormal:function(){return Fx},glorotUniform:function(){return Dx},heNormal:function(){return Mx},heUniform:function(){return zx},identity:function(){return Ax},leCunNormal:function(){return Lx},leCunUniform:function(){return Px},ones:function(){return jx},orthogonal:function(){return Bx},randomNormal:function(){return Ex},randomUniform:function(){return Cx},truncatedNormal:function(){return _x},varianceScaling:function(){return Rx},zeros:function(){return Nx}});var Wx,Ux={};function Vx(e){return Gx.apply(this,arguments)}function Gx(){return(Gx=Object(w.a)(k.a.mark((function e(t){var n,r,a,i,o,s,u,c;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t){e.next=2;break}return e.abrupt("return");case 2:for(i in n=[],r=[],a=[],t)"number"!=typeof(o=t[i])&&(s=o,n.push(s.data()),r.push(i),a.push(s));if(!(n.length>0)){e.next=10;break}return e.next=7,Promise.all(n);case 7:for(u=e.sent,c=0;c<u.length;++c)t[r[c]]=u[c][0];Ls(a);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Hx(e){if(null!=e)for(var t in e){var n=e[t];"number"!=typeof n&&n.dispose()}}z(Ux,{Layer:function(){return ex},RNN:function(){return gO},RNNCell:function(){return yO},activation:function(){return QI},add:function(){return sS},alphaDropout:function(){return JS},average:function(){return uS},averagePooling1d:function(){return bS},averagePooling2d:function(){return xS},averagePooling3d:function(){return OS},avgPool1d:function(){return gS},avgPool2d:function(){return kS},avgPool3d:function(){return IS},avgPooling1d:function(){return yS},avgPooling2d:function(){return wS},avgPooling3d:function(){return SS},batchNormalization:function(){return hS},bidirectional:function(){return VS},categoryEncoding:function(){return nN},centerCrop:function(){return eN},concatenate:function(){return cS},conv1d:function(){return VI},conv2d:function(){return GI},conv2dTranspose:function(){return HI},conv3d:function(){return qI},conv3dTranspose:function(){return KI},convLstm2d:function(){return PS},convLstm2dCell:function(){return BS},cropping2D:function(){return YI},dense:function(){return $I},depthwiseConv2d:function(){return JI},dot:function(){return fS},dropout:function(){return eS},elu:function(){return zI},embedding:function(){return oS},flatten:function(){return nS},gaussianDropout:function(){return ZS},gaussianNoise:function(){return YS},globalAveragePooling1d:function(){return NS},globalAveragePooling2d:function(){return jS},globalMaxPool1d:function(){return HS},globalMaxPool2d:function(){return qS},globalMaxPooling1d:function(){return TS},globalMaxPooling2d:function(){return CS},gru:function(){return RS},gruCell:function(){return DS},input:function(){return yw},inputLayer:function(){return MI},layerNormalization:function(){return mS},leakyReLU:function(){return PI},lstm:function(){return FS},lstmCell:function(){return MS},masking:function(){return QS},maxPool1d:function(){return KS},maxPool2d:function(){return XS},maxPooling1d:function(){return ES},maxPooling2d:function(){return _S},maxPooling3d:function(){return AS},maximum:function(){return lS},minimum:function(){return dS},multiply:function(){return pS},permute:function(){return iS},prelu:function(){return BI},randomWidth:function(){return rN},reLU:function(){return LI},repeatVector:function(){return rS},rescaling:function(){return $S},reshape:function(){return aS},resizing:function(){return tN},rnn:function(){return WS},separableConv2d:function(){return XI},simpleRNN:function(){return zS},simpleRNNCell:function(){return LS},softmax:function(){return WI},spatialDropout1d:function(){return tS},stackedRNNCells:function(){return US},thresholdedReLU:function(){return UI},timeDistributed:function(){return GS},upSampling2d:function(){return ZI},zeroPadding2d:function(){return vS}}),function(e){e[e.SILENT=0]="SILENT",e[e.VERBOSE=1]="VERBOSE"}(Wx||(Wx={}));var qx=function(){function e(){Object(O.a)(this,e),this.validationData=null}return Object(I.a)(e,[{key:"setParams",value:function(e){this.params=e}},{key:"onEpochBegin",value:function(){var e=Object(w.a)(k.a.mark((function e(t,n){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=Object(w.a)(k.a.mark((function e(t,n){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchBegin",value:function(){var e=Object(w.a)(k.a.mark((function e(t,n){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchEnd",value:function(){var e=Object(w.a)(k.a.mark((function e(t,n){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onTrainBegin",value:function(){var e=Object(w.a)(k.a.mark((function e(t){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"onTrainEnd",value:function(){var e=Object(w.a)(k.a.mark((function e(t){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"setModel",value:function(e){}}]),e}(),Kx=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;Object(O.a)(this,e),null==t&&(t=[]),this.callbacks=t,this.queueLength=n}return Object(I.a)(e,[{key:"append",value:function(e){this.callbacks.push(e)}},{key:"setParams",value:function(e){var t,n=Object(N.a)(this.callbacks);try{for(n.s();!(t=n.n()).done;){t.value.setParams(e)}}catch(r){n.e(r)}finally{n.f()}}},{key:"setModel",value:function(e){var t,n=Object(N.a)(this.callbacks);try{for(n.s();!(t=n.n()).done;){t.value.setModel(e)}}catch(r){n.e(r)}finally{n.f()}}},{key:"onEpochBegin",value:function(){var e=Object(w.a)(k.a.mark((function e(t,n){var r,a,i;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=Object(N.a)(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onEpochBegin(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=Object(w.a)(k.a.mark((function e(t,n){var r,a,i;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=Object(N.a)(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onEpochEnd(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchBegin",value:function(){var e=Object(w.a)(k.a.mark((function e(t,n){var r,a,i;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=Object(N.a)(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onBatchBegin(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchEnd",value:function(){var e=Object(w.a)(k.a.mark((function e(t,n){var r,a,i;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=Object(N.a)(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onBatchEnd(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onTrainBegin",value:function(){var e=Object(w.a)(k.a.mark((function e(t){var n,r,a;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==t&&(t={}),n=Object(N.a)(this.callbacks),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=10;break}return a=r.value,e.next=8,a.onTrainBegin(t);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),n.e(e.t0);case 15:return e.prev=15,n.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t){return e.apply(this,arguments)}}()},{key:"onTrainEnd",value:function(){var e=Object(w.a)(k.a.mark((function e(t){var n,r,a;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==t&&(t={}),n=Object(N.a)(this.callbacks),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=10;break}return a=r.value,e.next=8,a.onTrainEnd(t);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),n.e(e.t0);case 15:return e.prev=15,n.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t){return e.apply(this,arguments)}}()}]),e}(),Xx=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){return Object(O.a)(this,n),t.call(this)}return Object(I.a)(n,[{key:"onEpochBegin",value:function(){var e=Object(w.a)(k.a.mark((function e(t){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.seen=0,this.totals={};case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onBatchEnd",value:function(){var e=Object(w.a)(k.a.mark((function e(t,n){var r,a,i,o=this;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(i in null==n&&(n={}),r=null==n.size?0:n.size,this.seen+=r,a=function(e){var t=n[e];if("number"==typeof t)o.totals.hasOwnProperty(e)||(o.totals[e]=0),o.totals[e]=o.totals[e]+t*r;else{var a;e in o.totals?a=o.totals[e]:o.totals[e]=0;var i=zs((function(){return Zs(o.totals[e],$s(t,r))}));o.totals[e]=i,null!=a&&a.dispose()}},n)a(i);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=Object(w.a)(k.a.mark((function e(t,n){var r,a,i,o=this;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=n){r=Object(N.a)(this.params.metrics);try{for(i=function(){var e=a.value;null!=o.totals[e]&&("number"==typeof o.totals[e]?n[e]=o.totals[e]/o.seen:zs((function(){var t=$s(Qs(1,o.seen),o.totals[e]);n[e]=t,o.totals[e].dispose(),Ps(n[e])})))},r.s();!(a=r.n()).done;)i()}catch(t){r.e(t)}finally{r.f()}}case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(qx),Yx=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){return Object(O.a)(this,n),t.apply(this,arguments)}return Object(I.a)(n,[{key:"onTrainBegin",value:function(){var e=Object(w.a)(k.a.mark((function e(t){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.epoch=[],this.history={};case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=Object(w.a)(k.a.mark((function e(t,n){var r;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r in null==n&&(n={}),this.epoch.push(t),n)null==this.history[r]&&(this.history[r]=[]),this.history[r].push(n[r]);case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"syncData",value:function(){var e=Object(w.a)(k.a.mark((function e(){var t,n,r,a,i,o,s,u,c;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a in t=[],n=[],r=[],this.history)for(i=this.history[a],o=0;o<i.length;++o)"number"!=typeof i[o]&&(s=i[o],t.push(s.data()),n.push(a),r.push(o));return e.next=4,Promise.all(t);case 4:for(u=e.sent,c=0;c<u.length;++c)this.history[n[c]][r[c]].dispose(),this.history[n[c]][r[c]]=u[c][0];case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(qx),Zx=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e,r){var a;if(Object(O.a)(this,n),(a=t.call(this)).currentEpoch=0,a.nowFunc=e.nowFunc,a.nextFrameFunc=e.nextFrameFunc||Pm,a.yieldEvery=r||"auto","auto"===a.yieldEvery&&(a.yieldEvery=125),"never"===a.yieldEvery&&null!=e.onYield)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");return Ga.isNumber(a.yieldEvery)&&(a.maybeWait=function(e,t,n){var r,a=null!=n?n():Ga.now();return function(){var i=null!=n?n():Ga.now();return i-a<t||(a=i,r=e.apply(void 0,arguments)),r}}(a.maybeWait.bind(Object(f.a)(a)),a.yieldEvery,a.nowFunc)),a.trainBegin=e.onTrainBegin,a.trainEnd=e.onTrainEnd,a.epochBegin=e.onEpochBegin,a.epochEnd=e.onEpochEnd,a.batchBegin=e.onBatchBegin,a.batchEnd=e.onBatchEnd,a.yield=e.onYield,Object(m.a)(a)}return Object(I.a)(n,[{key:"maybeWait",value:function(){var e=Object(w.a)(k.a.mark((function e(t,n,r){var a;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=[],e.t0=null!=this.yield,!e.t0){e.next=6;break}return e.next=5,Vx(r);case 5:a.push(this.yield(t,n,r));case 6:return a.push(this.nextFrameFunc()),e.next=9,Promise.all(a);case 9:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"onEpochBegin",value:function(){var e=Object(w.a)(k.a.mark((function e(t,n){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.currentEpoch=t,e.t0=null!=this.epochBegin,!e.t0){e.next=7;break}return e.next=5,Vx(n);case 5:return e.next=7,this.epochBegin(t,n);case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=Object(w.a)(k.a.mark((function e(t,n){var r;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=[],e.t0=null!=this.epochEnd,!e.t0){e.next=6;break}return e.next=5,Vx(n);case 5:r.push(this.epochEnd(t,n));case 6:return"epoch"===this.yieldEvery&&r.push(this.nextFrameFunc()),e.next=9,Promise.all(r);case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchBegin",value:function(){var e=Object(w.a)(k.a.mark((function e(t,n){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=null!=this.batchBegin,!e.t0){e.next=6;break}return e.next=4,Vx(n);case 4:return e.next=6,this.batchBegin(t,n);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchEnd",value:function(){var e=Object(w.a)(k.a.mark((function e(t,n){var r;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=[],e.t0=null!=this.batchEnd,!e.t0){e.next=6;break}return e.next=5,Vx(n);case 5:r.push(this.batchEnd(t,n));case 6:return"batch"===this.yieldEvery?r.push(this.nextFrameFunc()):Ga.isNumber(this.yieldEvery)&&r.push(this.maybeWait(this.currentEpoch,t,n)),e.next=9,Promise.all(r);case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onTrainBegin",value:function(){var e=Object(w.a)(k.a.mark((function e(t){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=null!=this.trainBegin,!e.t0){e.next=6;break}return e.next=4,Vx(t);case 4:return e.next=6,this.trainBegin(t);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onTrainEnd",value:function(){var e=Object(w.a)(k.a.mark((function e(t){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=null!=this.trainEnd,!e.t0){e.next=6;break}return e.next=4,Vx(t);case 4:return e.next=6,this.trainEnd(t);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(qx);function Jx(e,t){return null==e&&(e={}),e instanceof qx?[e]:Array.isArray(e)&&e[0]instanceof qx?e:hg(e).map((function(e){return new Zx(e,t)}))}var Qx=function(){function e(){Object(O.a)(this,e)}return Object(I.a)(e,null,[{key:"registerCallbackConstructor",value:function(t,n){Ga.assert(t>=0&&Number.isInteger(t),(function(){return"Verbosity level is expected to be an integer >= 0, but got ".concat(t)})),e.checkForDuplicate(n),null==e.constructors[t]&&(e.constructors[t]=[]),e.constructors[t].push(n)}},{key:"checkForDuplicate",value:function(t){for(var n in e.constructors)e.constructors[+n].forEach((function(e){if(e===t)throw new og("Duplicate callback constructor.")}))}},{key:"clear",value:function(){e.constructors={}}},{key:"createCallbacks",value:function(t){var n=[];for(var r in e.constructors){var a=+r;t>=a&&n.push.apply(n,Object(S.a)(e.constructors[a]))}return n.map((function(e){return new e}))}}]),e}();function $x(e,t,n,r,a,i,o,s,u){var c=new Yx,l=[new Xx].concat(Object(S.a)(Qx.createCallbacks(t)));null!=e&&l.push.apply(l,Object(S.a)(e)),l.push(c);var d=new Kx(l);return d.setParams({epochs:n,initialEpoch:r,samples:a,steps:i,batchSize:o,verbose:t,doValidation:s,metrics:u}),{callbackList:d,history:c}}function ek(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return xg(e,gh.SerializationMap.getMap().classNameMap,t,"layer",n)}function tk(e,t){return zs((function(){"float32"!==e.dtype&&(e=Ns(e,"float32"));var n=Hc(py(e),t,!0),r=Zu(n.shape,$g()),a=Vc(Ll(n,r));return Qs(e,a)}))}function nk(e,t){return zs((function(){return Pl(py(Sl(t,e)),-1)}))}function rk(e,t){return zs((function(){return Pl(eu(Sl(t,e)),-1)}))}function ak(e,t){return zs((function(){var n=Sl(e,t),r=Ju(eu(e),$g(),Number.MAX_VALUE),a=eu(Qs(n,r));return $s(100,Pl(a,-1))}))}function ik(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return zs((function(){if(n)t=ip(t);else{var r=Hc(t,t.shape.length-1,!0);t=Qs(t,r)}return t=Ju(t,$g(),1-$g()),wl(Hc($s(Ns(e,"float32"),fl(t)),t.shape.length-1))}))}function ok(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return zs((function(){var r=Ns(el(ny(e)),"int32"),a=(t=Ju(t,$g(),1-$g())).shape;return ik(Eu(Zl(r,a[a.length-1]),a),t,n)}))}function sk(e,t){return zs((function(){var n;return n=Ju(t,$g(),1-$g()),n=fl(Qs(n,Sl(1,n))),Pl(function(e,t){if(!Ga.arraysEqual(e.shape,t.shape))throw new og("logits and labels must have the same shape, but got shapes ".concat(JSON.stringify(e.shape)," and ").concat(JSON.stringify(t.shape)));return zs((function(){var n=Pd(t),r=wl(eu(t));return Zs(Sl(n,$s(t,e)),hl(Yc(r)))}))}(e,n),-1)}))}function uk(e,t){return zs((function(){var n=tk(e,-1),r=tk(t,-1),a=$s(n,r);return wl(Hc(a,-1))}))}Qx.constructors={};var ck={meanSquaredError:nk,meanAbsoluteError:rk,meanAbsolutePercentageError:ak,meanSquaredLogarithmicError:function(e,t){return zs((function(){var n=Ju(t,$g(),Number.MAX_VALUE),r=fl(Zs(1,n)),a=Ju(e,$g(),Number.MAX_VALUE),i=fl(Zs(1,a));return Pl(py(Sl(r,i)),-1)}))},squaredHinge:function(e,t){return zs((function(){var n=Ll(0,Sl(1,$s(e,t)));return Pl(py(n),-1)}))},hinge:function(e,t){return zs((function(){var n=Ll(0,Sl(1,$s(e,t)));return Pl(n,-1)}))},categoricalHinge:function(e,t){return zs((function(){var n=Hc($s(e,t),-1),r=Pc($s(Sl(1,e),t),-1);return Ll(0,Zs(1,Sl(r,n)))}))},logcosh:function(e,t){return zs((function(){var n=Math.log(2),r=Sl(t,e),a=Sl(Zs(r,Ol($s(-2,r))),n);return Pl(a,-1)}))},categoricalCrossentropy:ik,sparseCategoricalCrossentropy:ok,binaryCrossentropy:sk,kullbackLeiblerDivergence:function(e,t){return zs((function(){var n=Ju(e,$g(),1),r=Ju(t,$g(),1);return Hc($s(e,fl(Qs(n,r))),-1)}))},poisson:function(e,t){return zs((function(){var n=fl(Zs($g(),t));return Pl(Sl(t,$s(e,n)),-1)}))},cosineProximity:uk};function lk(e){if("string"==typeof e){if(e in ck)return ck[e];var t="Unknown loss ".concat(e);throw e.toLowerCase().includes("softmaxcrossentropy")&&(t="Unknown loss ".concat(e,'. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy')),new og(t)}return e}function dk(e,t){return zs((function(){var n=$s(.5,Jl(t)),r=ey(nl(t,n),e.dtype);return Pl(wc(e,r),-1)}))}function pk(e,t){return zs((function(){return ey(wc(ou(e,-1),ou(t,-1)),"float32")}))}function fk(e,t){return zs((function(){return Ns(Hc(Tl(wc(e,1),wc(t,1))),"float32")}))}function hk(e,t){return zs((function(){var n=fk(e,t),r=function(e,t){return zs((function(){return Ns(Hc(Tl(wc(e,0),wc(t,1))),"float32")}))}(e,t),a=Zs(n,r);return Ns(Oc(nl(a,0),Qs(n,a),0),"float32")}))}function mk(e,t){return zs((function(){var n=fk(e,t),r=function(e,t){return zs((function(){return Ns(Hc(Tl(wc(e,1),wc(t,0))),"float32")}))}(e,t),a=Zs(n,r);return Ns(Oc(nl(a,0),Qs(n,a),0),"float32")}))}function vk(e,t){return sk(e,t)}function bk(e,t){return e.rank===t.rank&&(e=pp(e,[e.rank-1])),(t=ou(t,-1)).dtype!==e.dtype&&(t=Ns(t,e.dtype)),Ns(wc(e,t),"float32")}var gk=ik,yk=ok,xk={binaryAccuracy:dk,categoricalAccuracy:pk,precision:hk,categoricalCrossentropy:gk,sparseCategoricalCrossentropy:yk,mse:nk,MSE:nk,mae:rk,MAE:rk,mape:ak,MAPE:ak,cosine:uk};function kk(e){if("string"==typeof e&&e in xk)return xk[e];if("string"!=typeof e&&null!=e)return e;throw new og("Unknown metric ".concat(e))}function wk(e){if(dg(null!==e,"Unknown LossOrMetricFn ".concat(e)),"string"==typeof e)return e;for(var t,n=0,r=Object.keys(ck);n<r.length;n++){var a=r[n];if(ck[a]===e){t=a;break}}if(void 0!==t)return t;for(var i=0,o=Object.keys(xk);i<o.length;i++){var s=o[i];if(xk[s]===e){t=s;break}}return void 0!==t?t:e.name}function Ok(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==e||"object"!=typeof e||Object.getPrototypeOf(e)!==Object.prototype||!Ik(e))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){var r=JSON.stringify(e);r.length>1048576&&console.warn('User-defined metadata of model "'.concat(t,'" is too large in size (length=').concat(r.length," when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= 1048576."))}}function Ik(e){if(null===e)return!0;if("object"==typeof e){if(Object.getPrototypeOf(e)===Object.prototype){for(var t=0,n=Object.keys(e);t<n.length;t++){var r=n[t];if("string"!=typeof r||!Ik(e[r]))return!1}return!0}if(Array.isArray(e)){var a,i=Object(N.a)(e);try{for(i.s();!(a=i.n()).done;){if(!Ik(a.value))return!1}}catch(s){i.e(s)}finally{i.f()}return!0}return!1}var o=typeof e;return"string"===o||"number"===o||"boolean"===o}function Sk(e,t,n){var r,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:console.log,i=jk(e),o=["Layer (type)","Input Shape","Output shape","Param #"];if(i?(t=t||90,n=n||[.32,.61,.89,1]):(t=t||115,n=n||[.24,.48,.7,.8,1]),n[n.length-1]<=1&&(n=n.map((function(e){return Math.floor(t*e)}))),!i)for(var s in o.push("Receives inputs"),r=[],e.nodesByDepth){var u;(u=r).push.apply(u,Object(S.a)(e.nodesByDepth[s]))}a("_".repeat(t)),Tk(o,n,a),a("=".repeat(t));for(var c=e.layers,l=0;l<c.length;++l)i?Ck(c[l],n,a):Ek(c[l],n,r,a),a((l===c.length-1?"=":"_").repeat(t));e.checkTrainableWeightsConsistency();var d=Nk(e),p=Gy(e.nonTrainableWeights);a("Total params: ".concat(d+p)),a("Trainable params: ".concat(d)),a("Non-trainable params: ".concat(p)),a("_".repeat(t))}function Nk(e){return null!=e.collectedTrainableWeights?Gy(e.collectedTrainableWeights):Gy(e.trainableWeights)}function jk(e){var t=!0,n=[],r=[];for(var a in e.nodesByDepth)n.push(e.nodesByDepth[a]);for(var i=0,o=n;i<o.length;i++){var s=o[i];if(s.length>1||1===s.length&&s[0].inboundLayers.length>1){t=!1;break}r.push.apply(r,Object(S.a)(s))}if(t){var u,c=Object(N.a)(e.layers);try{for(c.s();!(u=c.n()).done;){var l,d=u.value,p=!1,f=Object(N.a)(d.inboundNodes);try{for(f.s();!(l=f.n()).done;){var h=l.value;if(-1!==r.indexOf(h)){if(p){t=!1;break}p=!0}}}catch(m){f.e(m)}finally{f.f()}if(!t)break}}catch(m){c.e(m)}finally{c.f()}}return t}function Tk(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log,r="",a=0;a<e.length;++a)a>0&&(r=r.slice(0,r.length-1)+" "),r=(r+=e[a]).slice(0,t[a]),r+=" ".repeat(t[a]-r.length);n(r)}function Ck(e,t,n){var r,a;try{a=e.inboundNodes.map((function(e){return JSON.stringify(e.inputShapes)})).join(",")}catch(s){a="multiple"}try{r=JSON.stringify(e.outputShape)}catch(s){r="multiple"}var i=e.name,o=e.getClassName();Tk(["".concat(i," (").concat(o,")"),a,r,e.countParams().toString()],t,n)}function Ek(e,t,n,r){var a,i;try{i=e.inboundNodes.map((function(e){return JSON.stringify(e.inputShapes)})).join(",")}catch(b){i="multiple"}try{a=JSON.stringify(e.outputShape)}catch(b){a="multiple"}var o,s=[],u=Object(N.a)(e.inboundNodes);try{for(u.s();!(o=u.n()).done;){var c=o.value;if(!(null!=n&&n.length>0&&-1===n.indexOf(c)))for(var l=0;l<c.inboundLayers.length;++l){var d=c.inboundLayers[l].name,p=c.nodeIndices[l],f=c.tensorIndices[l];s.push("".concat(d,"[").concat(p,"][").concat(f,"]"))}}}catch(g){u.e(g)}finally{u.f()}var h=e.name,m=e.getClassName(),v=0===s.length?"":s[0];Tk(["".concat(h," (").concat(m,")"),i,a,e.countParams().toString(),v],t,r);for(var b=1;b<s.length;++b)Tk(["","","","",s[b]],t,r)}function _k(e,t,n){return("inboundNodes"===e||"outputLayers"===e||"inputLayers"===e)&&0===t&&"string"==typeof n}function Ak(e,t){if(null===e)return null;if("string"==typeof e)return vg(e);if("number"==typeof e||"boolean"==typeof e)return e;if(e instanceof Array){for(var n=[],r=e.length,a=0;a<r;++a){var i=e[a];_k(t,a,i)?n.push(i):n.push(Ak(i,t))}return n}for(var o={},s=0,u=Object.keys(e);s<u.length;s++){var c=u[s],l=e[c];if("name"===c&&"string"==typeof l)o[c]=l;else{var d=vg(c);o[d]=Ak(l,d)}}return o}function Rk(e,t){if(null==e)return null;if("string"==typeof e)return mg(e);if("number"==typeof e||"boolean"==typeof e)return e;if(e instanceof Array){for(var n=[],r=e.length,a=0;a<r;++a){var i=e[a];_k(t,a,i)?n.push(i):n.push(Rk(i,t))}return n}for(var o={},s=0,u=Object.keys(e);s<u.length;s++){var c=u[s],l=e[c],d=mg(c);o[d]="name"!==c&&"className"!==c||"string"!=typeof l?Rk(l,c):l}return o}var Dk="4.7.0";function Fk(e,t){return function(e,t,n){var r=t.length;if(null==e||Array.isArray(e)&&0===e.length)return t.map((function(e){return null}));if(1===r)return Array.isArray(e)&&1===e.length?e:"object"==typeof e&&t[0]in e?[e[t[0]]]:[e];if(Array.isArray(e)){if(e.length!==r)throw new Error("Provided ".concat(n," is an array of ").concat(e.length," element(s), but the model has ").concat(r," outputs. Make sure a set of weights is provided for each model output."));return e}if("object"==typeof e&&Object.keys(e).length>0&&"object"==typeof e[Object.keys(e)[0]]){var a=[];return t.forEach((function(t){t in e?a.push(e[t]):a.push(null)})),a}throw new Error("The model has multiple (".concat(r,") outputs, so ").concat(n," must be either an array with ").concat(r," elements or an object with ").concat(t," keys. Provided ").concat(n," not understood: ").concat(JSON.stringify(e)))}(e,t,"classWeight")}function Mk(e,t,n,r){return zk.apply(this,arguments)}function zk(){return(zk=Object(w.a)(k.a.mark((function e(t,n,r,a){var i,o,s;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n&&null==a){e.next=2;break}throw new Error("Support sampleWeight is not implemented yet");case 2:if(null==r){e.next=14;break}return i=zs((function(){if(1===t.shape.length)return js(t);if(2===t.shape.length){if(t.shape[1]>1)return ou(t,1);if(1===t.shape[1])return Eu(t,[t.shape[0]]);throw new Error("Encountered unexpected last-dimension size (".concat(t.shape[1],") during handling of class weights. The size is expected to be >= 1."))}throw new Error("Unexpected rank of target (y) tensor (".concat(t.rank,") during handling of class weights. The rank is expected to be 1 or 2."))})),e.t0=Array,e.next=7,i.data();case 7:return e.t1=e.sent,o=e.t0.from.call(e.t0,e.t1),Ls(i),s=[],e.abrupt("return",(o.forEach((function(e){if(null==r[e])throw new Error("classWeight must contain all classes in the training data. The class ".concat(e," exists in the data but not in classWeight"));s.push(r[e])})),bp(s,"float32")));case 14:return e.abrupt("return",null);case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Lk(e,t){return $s(e,t)}function Pk(e,t){var n,r,a=t;n=a.xs,r=a.ys,Ga.assert(null!=n&&null!=r,(function(){return"A Dataset iterator for fitDataset() is expected to generate objects of the form `{xs: xVal, ys: yVal}`, where the two values may be `tf.Tensor`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ".concat(t)}));var i=Bk("input",e.inputNames,n),o=Bk("output",e.outputNames,r),s=i[0].shape[0];Ga.assert(i.length===e.inputs.length,(function(){return"LayersModel has ".concat(e.inputs.length," inputs, but the dataset provides ").concat(i.length," inputs.  (Expected input keys: ").concat(JSON.stringify(e.inputNames),")")})),Ga.assert(o.length===e.outputs.length,(function(){return"LayersModel has ".concat(e.outputs.length," outputs, but the dataset provides ").concat(o.length," outputs.  (Expected output keys: ").concat(JSON.stringify(e.outputNames),")")}));for(var u=function(t){Ga.assert(i[t].shape[0]===s,(function(){return"Batch size mismatch: input ".concat(e.inputNames[t]," has ").concat(i[t].shape[0],"; expected  ").concat(s," based on input ").concat(e.inputNames[0],".")}))},c=0;c<i.length;c++)u(c);for(var l=function(t){Ga.assert(o[t].shape[0]===s,(function(){return"Batch size mismatch: output ".concat(e.outputNames[t]," has ").concat(o[t].shape[0],"; expected  ").concat(s," based on input ").concat(e.inputNames[0],".")}))},d=0;d<o.length;d++)l(d);return{xs:i,ys:o}}function Bk(e,t,n){if(n instanceof Ti)return[n];if(Array.isArray(n))return Ga.assert(n.length===t.length,(function(){return"Received an array of ".concat(n.length," Tensors, but expected ").concat(t.length," to match the ").concat(e," keys ").concat(t,".")})),n;var r,a=[],i=Object(N.a)(t);try{for(i.s();!(r=i.n()).done;){var o=r.value;if(null==n[o])throw new og("The feature data generated by the dataset lacks the required ".concat(e," key '").concat(o,"'."));a.push(n[o])}}catch(s){i.e(s)}finally{i.f()}return a}function Wk(e){if(3===e.length)throw new sg("Validation with sample weights is not implemented yet.");return{xs:e[0],ys:e[1]}}function Uk(e,t,n){return Vk.apply(this,arguments)}function Vk(){return(Vk=Object(w.a)(k.a.mark((function e(t,n,r){var a,i,o,s,u,c,l,d,p,f,h,m,v,b,g,y,x,w,O,I,S,N,j,T,C,E,_,A,R,D,F,M,z;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=null!=r.batchesPerEpoch,Ga.assert(null!=t.optimizer,(function(){return"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."})),Ga.assert(null!=r,(function(){return"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."})),Ga.assert(null!=r.epochs&&r.epochs>0&&Number.isInteger(r.epochs),(function(){return"For fitDataset(), config.epochs is expected to be a positive integer, but got ".concat(r.epochs)})),Ga.assert(!a||r.batchesPerEpoch>0&&Number.isInteger(r.batchesPerEpoch),(function(){return"For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ".concat(r.batchesPerEpoch)})),Ga.assert(null==r.validationSplit,(function(){return"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."})),!t.isTraining){e.next=3;break}throw new Error("Cannot start training because another fit() call is ongoing.");case 3:return t.isTraining=!0,e.prev=4,(i=null!=r.validationData)&&(Hk(r.validationData)?Ga.assert(null==r.validationBatches||r.validationBatches>0&&Number.isInteger(r.validationBatches),(function(){return"For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ".concat(r.validationBatches)})):(u=Wk(r.validationData),o=u.xs,s=u.ys)),c=t.makeTrainFunction(),l=t.getDedupedMetricsNames(),d=i?l.slice().concat(l.map((function(e){return"val_"+e}))):l.slice(),p=Jx(r.callbacks,r.yieldEvery),f=null==r.verbose?1:r.verbose,h=$x(p,f,r.epochs,null,null,Gk(n,r),null,i,d),m=h.callbackList,v=h.history,m.setModel(t),t.history=v,e.next=14,m.onTrainBegin();case 14:return t.stopTraining_=!1,b=null==r.initialEpoch?0:r.initialEpoch,e.next=18,n.iterator();case 18:g=e.sent;case 19:if(!(b<r.epochs)){e.next=88;break}return y={},e.next=23,m.onEpochBegin(b);case 23:if(x=0,w=0,e.t0=a,e.t0){e.next=29;break}return e.next=28,n.iterator();case 28:g=e.sent;case 29:if(a&&!(x<r.batchesPerEpoch)){e.next=81;break}return e.next=32,g.next();case 32:if(O=e.sent,!a||!O.done){e.next=36;break}return console.warn("You provided `batchesPerEpoch` as ".concat(r.batchesPerEpoch,", but your dataset iterator ran out of data after ").concat(x," batches; interrupting training. Make sure that your dataset can generate at least `batchesPerEpoch * epochs` batches (in this case, ").concat(r.batchesPerEpoch*r.epochs," batches). You may need to use the repeat() function when building your dataset.")),e.abrupt("break",81);case 36:if(null==O.value){e.next=63;break}return I=Pk(t,O.value),S=I.xs,N=I.ys,(j={}).batch=w,j.size=S[0].shape[0],e.next=42,m.onBatchBegin(w,j);case 42:if(T=[],null==r.classWeight){e.next=55;break}C=Fk(r.classWeight,t.outputNames),E=0;case 46:if(!(E<C.length)){e.next=55;break}return e.t1=T,e.next=50,Mk(N[E],null,C[E]);case 50:e.t2=e.sent,e.t1.push.call(e.t1,e.t2);case 52:++E,e.next=46;break;case 55:for(_=S.concat(N).concat(T),A=c(_),Ls(_),R=0;R<l.length;++R)D=l[R],F=A[R],j[D]=F,Ps(F);return e.next=60,m.onBatchEnd(w,j);case 60:Hx(j),w++,x++;case 63:if(!(a?x>=r.batchesPerEpoch:O.done)){e.next=77;break}if(!i){e.next=76;break}if(M=void 0,!Hk(r.validationData)){e.next=74;break}return e.t3=hg,e.next=70,t.evaluateDataset(r.validationData,{batches:r.validationBatches});case 70:e.t4=e.sent,M=(0,e.t3)(e.t4),e.next=75;break;case 74:M=hg(t.evaluate(o,s,{batchSize:null==r.validationBatchSize?32:r.validationBatchSize,verbose:0}));case 75:for(z=0;z<t.metricsNames.length;++z)y["val_".concat(t.metricsNames[z])]=M[z];case 76:return e.abrupt("break",81);case 77:if(!t.stopTraining_){e.next=79;break}return e.abrupt("break",81);case 79:e.next=29;break;case 81:return e.next=83,m.onEpochEnd(b,y);case 83:if(b++,!t.stopTraining_){e.next=86;break}return e.abrupt("break",88);case 86:e.next=19;break;case 88:return e.next=90,m.onTrainEnd();case 90:return e.next=92,t.history.syncData();case 92:return e.abrupt("return",t.history);case 93:return e.prev=93,t.isTraining=!1,e.finish(93);case 96:case"end":return e.stop()}}),e,null,[[4,,93,96]])})))).apply(this,arguments)}function Gk(e,t){var n=null;return null!=t.batchesPerEpoch?n=t.batchesPerEpoch:Number.isFinite(e.size)&&(n=e.size),n}function Hk(e){return"function"==typeof e.iterator}function qk(e){return"function"==typeof e.next}function Kk(e,t,n){return Xk.apply(this,arguments)}function Xk(){return(Xk=Object(w.a)(k.a.mark((function e(t,n,r){var a,i,o,s,u,c,l,d,p;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=null!=(r=r||{}).batches,i=t.testFunction,o=[],!(r.verbose>0)){e.next=4;break}throw new sg("Verbose mode is not implemented yet.");case 4:if(Ga.assert(!a||r.batches>0&&Number.isInteger(r.batches),(function(){return"Test loop expects `batches` to be a positive integer, but received ".concat(JSON.stringify(r.batches))})),!qk(n)){e.next=9;break}e.t0=n,e.next=12;break;case 9:return e.next=11,n.iterator();case 11:e.t0=e.sent;case 12:s=e.t0,u=0,c=0,l=k.a.mark((function e(){var n;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.next();case 2:if(n=e.sent,o=zs((function(){return n.value&&function(){var e=Pk(t,n.value),r=e.xs,a=e.ys,s=r.concat(a),l=zs((function(){return i(s)}));if(Ls(s),0===c)for(var d=0;d<l.length;++d)o.push(Uc(0));for(var p=s[0].shape[0],f=function(e){var t=l[e],n=o[e];o[e]=zs((function(){return Zs(o[e],$s(p,t))})),c>0&&Ls(n)},h=0;h<l.length;++h)f(h);Ls(l),u+=p,++c}(),o})),!n.done){e.next=6;break}return a&&console.warn("Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least `batches` batches (in this case, ".concat(r.batches," batches). You may need to use the repeat() function when building your dataset.")),e.abrupt("return","break");case 6:case"end":return e.stop()}}),e)}));case 16:if(a&&!(c<r.batches)){e.next=23;break}return e.delegateYield(l(),"t1",18);case 18:if("break"!==e.t1){e.next=21;break}return e.abrupt("break",23);case 21:e.next=16;break;case 23:for(d=0;d<o.length;++d)p=o[d],o[d]=Qs(o[d],u),Ls(p);return e.abrupt("return",fg(o));case 25:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Yk(e){Ga.assert(e>0&&Number.isInteger(e),(function(){return"batchSize is required to be a positive integer, but got ".concat(e)}))}function Zk(e,t,n){return null==e?[null]:Array.isArray(e)?e.map((function(e){return ry(e,t,n-t)})):ry(e,t,n-t)}function Jk(e,t){return zs((function(){return null==e?null:Array.isArray(e)?e.map((function(e){return Jk(e,t)})):dy(e,"int32"===t.dtype?t:Ns(t,"int32"))}))}function Qk(e,t){for(var n=[],r=0,a=null;r<e;)(a=r+t)>=e&&(a=e),n.push([r,a]),r=a;return n}function $k(e){var t=[];e instanceof Ti&&(e=[e]);for(var n=0;n<e.length;++n){var r=e[n];if(1===r.rank)t.push(ty(r,1));else{if(0===r.rank)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");t.push(r)}}return t}function ew(e,t){if(null!=e){var n=[];if(t instanceof Ti)n.push(t.id);else if(Array.isArray(t))t.forEach((function(e){return n.push(e.id)}));else if(null!=t)for(var r in t){var a=t[r];n.push(a.id)}var i=[];if(e instanceof Ti)-1===n.indexOf(e.id)&&i.push(e);else if(Array.isArray(e))e.forEach((function(e){-1===n.indexOf(e.id)&&i.push(e)}));else if(null!=e)for(var o in e){var s=e[o];-1===n.indexOf(s.id)&&i.push(s)}i.forEach((function(e){e.isDisposed||e.dispose()}))}}function tw(e){return Array.isArray(e)}function nw(e){return!function(e){return e instanceof Ti}(e)&&!tw(e)}function rw(e,t,n){var r,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";if(null==t||0===t.length){if(null!=e){var o=!1;if(tw(e)&&e.length>0)o=!0;else if(nw(e)){for(var s in e)if(e.hasOwnProperty(s)){o=!0;break}}else o=!0;if(o)throw new og("Error when checking model ".concat(i," expected no data, but got ").concat(e))}return[]}if(null==e)return t.map((function(e){return null}));if(nw(e)){e=e,r=[];var u,c=Object(N.a)(t);try{for(c.s();!(u=c.n()).done;){var l=u.value;if(null==e[l])throw new og('No data provided for "'.concat(l,'". Need data for each key in: ').concat(t));r.push(e[l])}}catch(v){c.e(v)}finally{c.f()}}else if(tw(e)){if((e=e).length!==t.length)throw new og("Error when checking model ".concat(i,": the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ").concat(t.length," Tensor(s), but instead got the following list of Tensor(s): ").concat(e));r=e}else{if(e=e,t.length>1)throw new og("The model ".concat(i," expects ").concat(t.length," Tensor(s), but only received one Tensor. Found: Tensor with shape ").concat(e.shape));r=[e]}if(r=$k(r),null!=n)for(var d=0;d<t.length;++d)if(null!=n[d]){var p=r[d];if(p.shape.length!==n[d].length)throw new og("Error when checking ".concat(i,": expected ").concat(t[d]," to have ").concat(n[d].length," dimension(s). but got array with shape ").concat(p.shape));for(var f=0;f<n[d].length;++f)if(0!==f||a){var h=p.shape[f],m=n[d][f];if(null!=m&&m>=0&&h!==m)throw new og("".concat(i," expected a batch of elements where each example has shape [").concat(n[d].slice(1,n[d].length),"] (i.e.,tensor shape [*,").concat(n[d].slice(1,n[d].length),"]) but the ").concat(i," received an input with ").concat(p.shape[0]," examples, each with shape [").concat(p.shape.slice(1,p.shape.length),"] (tensor shape [").concat(p.shape,"])"))}}return r}function aw(e,t,n){var r=wg(e.map((function(e){return e.shape[0]})));r.sort();var a=wg(t.map((function(e){return e.shape[0]})));if(a.sort(),r.length>1)throw new og("All input Tensors (x) should have the same number of samples. Got array shapes: ".concat(JSON.stringify(e.map((function(e){return e.shape})))));if(a.length>1)throw new og("All target Tensors (y) should have the same number of samples. Got array shapes: ".concat(JSON.stringify(t.map((function(e){return e.shape})))));if(r.length>0&&a.length>0&&!Ga.arraysEqual(r,a))throw new og("Input Tensors should have the same number of samples as target Tensors. Found ".concat(r[0]," input sample(s) and ").concat(a[0]," target sample(s)."))}function iw(e,t,n){for(var r=[nk,sk,ik],a=0;a<e.length;++a){var i=e[a],o=t[a],s=n[a];if(null!=o){if(o===ik&&1===i.shape[i.shape.length-1])throw new og("You are passing a target array of shape ".concat(i.shape," while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes]."));if(-1!==r.indexOf(o))for(var u=i.shape.slice(1),c=s.slice(1),l=0;l<u.length;++l){var d=u[l],p=c[l];if(null!=p&&d!==p)throw new og("A target Tensor with shape ".concat(i.shape," was passed for an output of shape ").concat(s,", while using a loss function that expects targets to have the same shape as the output."))}}}}function ow(e,t,n){var r,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";if(Array.isArray(e)){if(e.length!==t.length)throw new og("Error when checking model ".concat(i,": the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ").concat(t.length," Tensor(s), but instead got ").concat(e.length," Tensors(s)."));r=e}else{if(t.length>1)throw new og("The model expects ".concat(t.length," ").concat(i," Tensors, but only received one Tensor. Found: array with shape ").concat(JSON.stringify(e.shape),"."));r=[e]}if(null!=n)for(var o=0;o<t.length;++o)if(null!=n[o]){var s=r[o];if(s.shape.length!==n[o].length)throw new og("Error when checking ".concat(i,": expected ").concat(t[o]," to have ").concat(n[o].length," dimension(s), but got array with shape ").concat(JSON.stringify(s.shape)));for(var u=0;u<n[o].length;++u)if(0!==u||a){var c=s.shape[u],l=n[o][u];if(null!=l&&l!==c)throw new og("Error when checking ".concat(i,": expected ").concat(t[o]," to have shape ").concat(JSON.stringify(n[o])," but got array with shape ").concat(JSON.stringify(s.shape),"."))}}}var sw=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(O.a)(this,n),(r=t.call(this,e)).isTraining=!1,r}return Object(I.a)(n,[{key:"summary",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log;if(!this.built)throw new og("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");Sk(this,e,t,n)}},{key:"compile",value:function(e){var t=this;if(null==e.loss&&(e.loss=[]),this.loss=e.loss,"string"==typeof e.optimizer)this.optimizer_=function(e){var t={Adagrad:function(){return zm.adagrad(.01)},Adadelta:function(){return zm.adadelta(1,.95,$g())},Adam:function(){return zm.adam(.001,.9,.999,$g())},Adamax:function(){return zm.adamax(.002,.9,.999,$g(),0)},RMSProp:function(){return zm.rmsprop(.001,.9,0,$g())},SGD:function(){return zm.sgd(.01)}};if(t.adagrad=t.Adagrad,t.adadelta=t.Adadelta,t.adam=t.Adam,t.adamax=t.Adamax,t.rmsprop=t.RMSProp,t.sgd=t.SGD,e in t)return t[e]();throw new og("Unknown Optimizer ".concat(e))}(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof wh))throw new og("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}var n=[];if(Array.isArray(e.loss)||"string"==typeof e.loss||"function"==typeof e.loss)if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new og("When passing an Array as loss, it should have one entry per model output. The model has ".concat(this.outputs.length," output(s), but you passed loss=").concat(e.loss,"."));n=e.loss.map((function(e){return lk(e)}))}else{var r=lk(e.loss);this.outputs.forEach((function(e){n.push(r)}))}else{for(var a in e.loss=e.loss,e.loss)if(-1===this.outputNames.indexOf(a))throw new og('Unknown entry in loss dictionary: "'.concat(a,'". Only expected the following keys: ').concat(this.outputNames));var i,o=Object(N.a)(this.outputNames);try{for(o.s();!(i=o.n()).done;){var s=i.value;null==e.loss[s]&&console.warn('Output "'.concat(s,'" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ').concat(s," during training")),n.push(lk(e.loss[s]))}}catch(h){o.e(h)}finally{o.f()}}this.lossFunctions=n,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(var u=0;u<this.outputs.length;++u){var c=this.internalOutputShapes[u],l=this.outputNames[u];this.feedOutputNames.push(l),this.feedOutputShapes.push(c),this.feedLossFns.push(this.lossFunctions[u])}var d=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],Ug("loss",(function(){for(var e=0;e<t.outputs.length;++e)if(-1===d.indexOf(e)){var n=t.lossFunctions[e];t.outputs.length>1&&(t.metricsTensors.push([n,e]),t.metricsNames.push(t.outputNames[e]+"_loss"))}}));var p=function(e,t){if(null==e||Array.isArray(e)&&0===e.length)return t.map((function(e){return[]}));var n;if("string"==typeof e||"function"==typeof e)n=[e];else{if(!Array.isArray(e)&&"object"!=typeof e)throw new TypeError("Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ".concat(e));n=e}if(Array.isArray(n))return t.map((function(e){return n}));var r,a=[],i=Object(N.a)(t);try{for(i.s();!(r=i.n()).done;){var o=r.value,s=n.hasOwnProperty(o)?n[o]:[];Array.isArray(s)||(s=[s]),a.push(s)}}catch(h){i.e(h)}finally{i.f()}return a}(e.metrics,this.outputNames),f=function(e,n,r){t.outputNames.length>1&&(n=t.outputNames[e]+"_"+n),t.metricsNames.push(n),t.metricsTensors.push([r,e])};Ug("metric",(function(){for(var e=function(e){if(-1!==d.indexOf(e))return"continue";!function(n){var r,a,i,o,s=Object(N.a)(n);try{for(s.s();!(o=s.n()).done;){var u=o.value;if("string"==typeof u&&-1!==["accuracy","acc","crossentropy","ce"].indexOf(u)){var c=t.internalOutputShapes[e];1===c[c.length-1]||t.lossFunctions[e]===sk?-1!==["accuracy","acc"].indexOf(u)?a=dk:-1!==["crossentropy","ce"].indexOf(u)&&(a=vk):t.lossFunctions[e]===ok?-1!==["accuracy","acc"].indexOf(u)?a=bk:-1!==["crossentropy","ce"].indexOf(u)&&(a=yk):-1!==["accuracy","acc"].indexOf(u)?a=pk:-1!==["crossentropy","ce"].indexOf(u)&&(a=gk);var l=void 0;-1!==["accuracy","acc"].indexOf(u)?l="acc":-1!==["crossentropy","ce"].indexOf(u)&&(l="ce"),i=a,r=""+l}else i=kk(u),r=""+wk(u);var d=void 0;Ug(r,(function(){d=i})),f(e,r,d)}}catch(h){s.e(h)}finally{s.f()}}(p[e])},n=0;n<t.outputs.length;++n)e(n)})),this.collectedTrainableWeights=this.trainableWeights}},{key:"checkTrainableWeightsConsistency",value:function(){null!=this.collectedTrainableWeights&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}},{key:"evaluate",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=null==n.batchSize?32:n.batchSize;Yk(r);var a=!0,i=this.standardizeUserDataXY(e,t,a,r);try{var o=i[0].concat(i[1]);this.makeTestFunction();var s=this.testFunction,u=this.testLoop(s,o,r,n.verbose,n.steps);return fg(u)}finally{ew(i[0],e),ew(i[1],t)}}},{key:"evaluateDataset",value:function(){var e=Object(w.a)(k.a.mark((function e(t,n){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.makeTestFunction(),Kk(this,t,n)));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"checkNumSamples",value:function(e,t,n){var r,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"steps";if(null!=n){if(r=null,null!=t)throw new og("If ".concat(a," is set, batchSize must be null or undefined.Got batchSize = ").concat(t))}else{if(null==e)throw new og("Either the input data should have a defined shape, or ".concat(a," shoud be specified."));r=Array.isArray(e)?e[0].shape[0]:e.shape[0]}return r}},{key:"execute",value:function(e,t){if(Array.isArray(t)&&0===t.length)throw new og("`outputs` is an empty Array, which is not allowed.");var n=Array.isArray(t),r=n?t:[t],a=this.retrieveSymbolicTensors(r),i=new rx;if(e instanceof Ti&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new og("The number of inputs provided (".concat(e.length,") does not match the number of inputs of this model (").concat(this.inputs.length,")."));for(var o=0;o<this.inputs.length;++o)i.add(this.inputs[o],e[o])}else{var s,u=Object(N.a)(this.inputs);try{for(u.s();!(s=u.n()).done;){var c=s.value,l=e[c.name];if(null==l)throw new og("No value is provided for the model's input ".concat(c.name));i.add(c,l)}}catch(p){u.e(p)}finally{u.f()}}var d=ox(a,i);return n?d:d[0]}},{key:"retrieveSymbolicTensors",value:function(e){var t,n=lg(null,e.length),r=e.length,a=Object(N.a)(this.layers);try{for(a.s();!(t=a.n()).done;){for(var i=t.value,o=Array.isArray(i.output)?i.output:[i.output],s=o.map((function(e){return e.name})),u=0;u<e.length;++u){var c=s.indexOf(e[u]);if(-1!==c&&(n[u]=o[c],r--),0===r)break}if(0===r)break}}catch(d){a.e(d)}finally{a.f()}if(r>0){var l=[];throw n.forEach((function(t,n){null==t&&l.push(e[n])})),new og("Cannot find SymbolicTensors for output name(s): ".concat(JSON.stringify(l)))}return n}},{key:"predictLoop",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return zs((function(){var a=t.checkNumSamples(e);if(r)throw new sg("Verbose predictLoop() is not implemented yet.");for(var i=Qk(a,n),o=t.outputs.map((function(e){return[]})),s=function(n){zs((function(){var r=i[n][0],a=i[n][1],o=Zk(e,r,a),s=[];if(Array.isArray(o))for(var u=0;u<o.length;++u)s.push({key:t.inputs[u],value:o[u]});else s.push({key:t.inputs[0],value:o});var c=new rx(s);return ox(t.outputs,c)})).forEach((function(e,t){return o[t].push(e)}))},u=0;u<i.length;++u)s(u);return fg(o.map((function(e){return Ru(e,0)})))}))}},{key:"predict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=$k(e);ow(n,this.inputNames,this.feedInputShapes,!1);try{var r=null==t.batchSize?32:t.batchSize;return Yk(r),this.predictLoop(n,r)}finally{ew(n,e)}}},{key:"predictOnBatch",value:function(e){ow(e,this.inputNames,this.feedInputShapes,!0);var t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)}},{key:"standardizeUserDataXY",value:function(e,t){var n=arguments.length>3?arguments[3]:void 0;if(null==this.optimizer_)throw new ig("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");for(var r=[],a=0;a<this.feedOutputShapes.length;++a){var i=this.feedOutputShapes[a];this.feedLossFns[a]===ok?r.push(i.slice(0,i.length-1).concat([1])):r.push(i)}if(aw(e=rw(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=rw(t,this.feedOutputNames,r,!1,"target")),iw(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&null!=n&&n>0&&e[0].shape[0]%n!==0)throw new og("In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ".concat(n,". Found: ").concat(e[0].shape[0]," sample(s)."));return[e,t]}},{key:"standardizeUserData",value:function(){var e=Object(w.a)(k.a.mark((function e(t,n,r,a){var i,o,s,u,c,l,d,p,f,h=arguments;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=!(h.length>4&&void 0!==h[4])||h[4],o=h.length>5?h[5]:void 0,s=this.standardizeUserDataXY(t,n,i,o),u=Object(y.a)(s,2),c=u[0],l=u[1],null==r){e.next=5;break}throw new Error("sample weight is not supported yet.");case 5:if(d=null,null==a){e.next=19;break}p=Fk(a,this.outputNames),d=[],f=0;case 10:if(!(f<p.length)){e.next=19;break}return e.t0=d,e.next=14,Mk(l[f],null,p[f]);case 14:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 16:++f,e.next=10;break;case 19:return e.abrupt("return",[c,l,d]);case 20:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"testLoop",value:function(e,t,n){var r=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4?arguments[4]:void 0;return zs((function(){var o=r.checkNumSamples(t,n,i,"steps"),s=[];if(a>0)throw new sg("Verbose mode is not implemented yet.");if(null!=i)throw new sg("steps mode in testLoop() is not implemented yet");for(var u=Qk(o,n),c=bp(Qg(0,o)),l=0;l<u.length;++l){var d=u[l][0],p=u[l][1],f=ry(c,d,p-d),h=Jk(t,f),m=e(h);if(0===l)for(var v=0;v<m.length;++v)s.push(Uc(0));for(var b=0;b<m.length;++b){var g=m[b];s[b]=Zs(s[b],$s(p-d,g))}}for(var y=0;y<s.length;++y)s[y]=Qs(s[y],o);return s}))}},{key:"getDedupedMetricsNames",value:function(){for(var e=this.metricsNames,t=[],n=0;n<e.length;++n){var r=e[n],a=r;if(pg(e,r)>1){var i=pg(e.slice(0,n),r);a+="_".concat(i)}t.push(a)}return t}},{key:"makeTrainFunction",value:function(){var e=this;return function(t){var n=[],r=t.slice(0,e.inputs.length),a=t.slice(e.inputs.length,e.inputs.length+e.outputs.length),i=t.slice(e.inputs.length+e.outputs.length,e.inputs.length+2*e.outputs.length),o=[],s=e.collectedTrainableWeights.map((function(e){return e.read()}));return[e.optimizer_.minimize((function(){for(var t=[],s=0;s<e.inputs.length;++s)t.push({key:e.inputs[s],value:r[s]});for(var u,c=new rx(t),l=ox(e.outputs,c,{training:!0}),d=0;d<e.lossFunctions.length;++d){var p=(0,e.lossFunctions[d])(a[d],l[d]);null!=i[d]&&(p=Lk(p,i[d]));var f=Pl(p);n.push(f),u=0===d?p:Zs(u,p)}for(var h=0;h<e.metricsTensors.length;++h){var m=void 0;if(e.outputs.length>1&&h<e.outputs.length)m=n[h];else{var v=e.metricsTensors[h][0],b=e.metricsTensors[h][1];m=Pl(v(a[b],l[b]))}Ps(m),o.push(m)}return u=Pl(u),e.calculateLosses().forEach((function(e){u=Zs(u,e)})),u}),!0,s)].concat(o)}}},{key:"makeTestFunction",value:function(){var e=this;this.testFunction=function(t){return zs((function(){for(var n,r=[],a=t.slice(0,e.inputs.length),i=t.slice(e.inputs.length,e.inputs.length+e.outputs.length),o=[],s=0;s<e.inputs.length;++s)o.push({key:e.inputs[s],value:a[s]});for(var u=new rx(o),c=ox(e.outputs,u),l=0;l<e.lossFunctions.length;++l){var d=e.lossFunctions[l],p=Pl(d(i[l],c[l]));n=0===l?p:Zs(n,p),r.push(n)}for(var f=0;f<e.metricsTensors.length;++f){var h=e.metricsTensors[f][0],m=e.metricsTensors[f][1],v=Pl(h(i[m],c[m]));r.push(v)}return r}))}}},{key:"fit",value:function(){var e=Object(w.a)(k.a.mark((function e(t,n){var r,a,i,o,s,u,c,l,d,p,f,h,m,v,b,g,y,x,w,O,I,S,N,j,T,C=arguments;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=C.length>2&&void 0!==C[2]?C[2]:{},!this.isTraining){e.next=3;break}throw new Error("Cannot start training because another fit() call is ongoing.");case 3:return this.isTraining=!0,e.prev=4,Yk(f=null==r.batchSize?32:r.batchSize),h=!1,e.next=10,this.standardizeUserData(t,n,r.sampleWeight,r.classWeight,h,f);case 10:if(m=e.sent,a=m[0],i=m[1],p=m[2],v=!1,!(null!=r.validationData&&r.validationData.length>0)){e.next=26;break}if(v=!0,2!==r.validationData.length){e.next=18;break}u=r.validationData[0],c=r.validationData[1],e.next=19;break;case 18:throw 3===r.validationData.length?new sg("validationData including sample weights is not supported yet."):new og("When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ".concat(r.validationData," is invalid."));case 19:return g=!0,e.next=22,this.standardizeUserData(u,c,null,null,g,f);case 22:y=e.sent,l=y[0],d=y[1],b=l.concat(d),e.next=27;break;case 26:null!=r.validationSplit&&r.validationSplit>0&&r.validationSplit<1?(v=!0,x=Math.floor(a[0].shape[0]*(1-r.validationSplit)),w=a[0].shape[0],l=Zk(a,x,w),o=a,a=Zk(a,0,x),d=Zk(i,x,w),s=i,i=Zk(i,0,x),b=l.concat(d)):null!=r.validationSteps&&(v=!0);case 27:return O=a.concat(i).concat(p),this.checkTrainableWeightsConsistency(),I=this.makeTrainFunction(),S=this.getDedupedMetricsNames(),v?(this.makeTestFunction(),N=this.testFunction,j=S.slice().concat(S.map((function(e){return"val_"+e})))):(N=null,b=[],j=S.slice()),T=Jx(r.callbacks,r.yieldEvery),e.next=34,this.fitLoop(I,O,S,f,r.epochs,r.verbose,T,N,b,r.shuffle,j,r.initialEpoch,null,null);case 34:return e.abrupt("return",e.sent);case 35:return e.prev=35,this.isTraining=!1,ew(a,t),ew(i,n),ew(o,t),ew(s,n),ew(l,u),ew(d,c),null!=p&&Ls(p),e.finish(35);case 38:case"end":return e.stop()}}),e,this,[[4,,35,38]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"fitLoop",value:function(){var e=Object(w.a)(k.a.mark((function e(t,n,r,a,i,o,s,u,c,l,d,p,f,h){var m,v,b,g,y,x,w,O,I=this;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==a&&(a=32),null==i&&(i=1),null==l&&(l=!0),null==p&&(p=0),m=!1,null!=u&&null!=c&&(m=!0),null==h||(m=!0,null!=f)){e.next=4;break}throw new og("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");case 4:return null!=(v=this.checkNumSamples(n,a,f,"steps_per_epoch"))&&(b=Qg(0,v)),null==o&&(o=1),g=$x(s,o,i,p,v,f,a,m,d),y=g.callbackList,x=g.history,y.setModel(this),this.history=x,e.next=11,y.onTrainBegin();case 11:this.stopTraining_=!1,w=k.a.mark((function e(i){var o;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.onEpochBegin(i);case 2:if(o={},null==f){e.next=5;break}throw new sg("stepsPerEpoch mode is not implemented yet.");case 5:return e.delegateYield(k.a.mark((function e(){var i,s,d,p;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("batch"!==l){e.next=2;break}throw new sg("batch shuffling is not implemneted yet");case 2:l&&Ga.shuffle(b),i=bp(b),s=Qk(v,a),d=k.a.mark((function e(l){var d;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d={},e.next=3,y.onBatchBegin(l,d);case 3:return zs((function(){var e=s[l][0],p=s[l][1],f=ry(i,e,p-e);d.batch=l,d.size=p-e;for(var h=Jk(n,f),v=t(h),b=0;b<r.length;++b){var g=r[b],y=v[b];d[g]=y,Ps(y)}if(l===s.length-1&&m)for(var x=I.testLoop(u,c,a),k=0;k<r.length;++k){var w=r[k],O=x[k];Ps(O),o["val_"+w]=O}})),e.next=6,y.onBatchEnd(l,d);case 6:if(Hx(d),!I.stopTraining_){e.next=9;break}return e.abrupt("return","break");case 9:case"end":return e.stop()}}),e)})),p=0;case 6:if(!(p<s.length)){e.next=14;break}return e.delegateYield(d(p),"t0",8);case 8:if("break"!==e.t0){e.next=11;break}return e.abrupt("break",14);case 11:++p,e.next=6;break;case 14:i.dispose();case 15:case"end":return e.stop()}}),e)}))(),"t0",6);case 6:return e.next=8,y.onEpochEnd(i,o);case 8:if(!I.stopTraining_){e.next=10;break}return e.abrupt("return","break");case 10:case"end":return e.stop()}}),e)})),O=p;case 14:if(!(O<i)){e.next=22;break}return e.delegateYield(w(O),"t0",16);case 16:if("break"!==e.t0){e.next=19;break}return e.abrupt("break",22);case 19:++O,e.next=14;break;case 22:return e.next=24,y.onTrainEnd();case 24:return e.next=26,this.history.syncData();case 26:return e.abrupt("return",this.history);case 27:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a,i,o,s,u,c,l,d,p,f,h){return e.apply(this,arguments)}}()},{key:"fitDataset",value:function(){var e=Object(w.a)(k.a.mark((function e(t,n){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Uk(this,t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"trainOnBatch",value:function(){var e=Object(w.a)(k.a.mark((function e(t,n){var r,a,i,o,s,u,c,l,d;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.standardizeUserData(t,n);case 2:r=e.sent,a=r[0],i=r[1],o=this.makeTrainFunction()(a.concat(i)),s=[],u=Object(N.a)(o),e.prev=8,u.s();case 10:if((c=u.n()).done){e.next=18;break}return l=c.value,e.next=14,l.data();case 14:d=e.sent,s.push(d[0]);case 16:e.next=10;break;case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(8),u.e(e.t0);case 23:return e.prev=23,u.f(),e.finish(23);case 26:return e.abrupt("return",(Ls(o),ew(r[0],t),ew(r[1],n),fg(s)));case 27:case"end":return e.stop()}}),e,this,[[8,20,23,26]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getNamedWeights",value:function(e){for(var t=[],n=null!=e&&e.trainableOnly,r=n?this.trainableWeights:this.weights,a=this.getWeights(n),i=0;i<r.length;++i)n&&!r[i].trainable||t.push({name:r[i].originalName,tensor:a[i]});return t}},{key:"dispose",value:function(){var e=Object(d.a)(Object(p.a)(n.prototype),"dispose",this).call(this);if(0===e.refCountAfterDispose&&null!=this.optimizer&&this.isOptimizerOwned){var t=Fs().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=t-Fs().numTensors}return e}},{key:"getLossIdentifiers",value:function(){var e;if("string"==typeof this.loss)e=mg(this.loss);else if(Array.isArray(this.loss)){var t,n=Object(N.a)(this.loss);try{for(n.s();!(t=n.n()).done;){if("string"!=typeof t.value)throw new Error("Serialization of non-string loss is not supported.")}}catch(u){n.e(u)}finally{n.f()}e=this.loss.map((function(e){return mg(e)}))}else{var r=Object.keys(this.loss);e={};for(var a=this.loss,i=0,o=r;i<o.length;i++){var s=o[i];if("string"!=typeof a[s])throw new Error("Serialization of non-string loss is not supported.");e[s]=mg(a[s])}}return e}},{key:"getMetricIdentifiers",value:function(){if("string"==typeof this.metrics||"function"==typeof this.metrics)return[mg(wk(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map((function(e){return mg(wk(e))}));var e={};for(var t in this.metrics)e[t]=mg(wk(this.metrics[t]));return e}},{key:"getTrainingConfig",value:function(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}},{key:"loadTrainingConfig",value:function(e){if(null!=e.weighted_metrics)throw new Error("Loading weight_metrics is not supported yet.");if(null!=e.loss_weights)throw new Error("Loading loss_weights is not supported yet.");if(null!=e.sample_weight_mode)throw new Error("Loading sample_weight_mode is not supported yet.");var t,n,r=ek(Ak(e.optimizer_config));if("string"==typeof e.loss)t=vg(e.loss);else if(Array.isArray(e.loss))t=e.loss.map((function(e){return vg(e)}));else if(null!=e.loss)for(var a in t={},e.loss)t[a]=vg(e.loss[a]);if(Array.isArray(e.metrics))n=e.metrics.map((function(e){return vg(e)}));else if(null!=e.metrics)for(var i in n={},e.metrics)n[i]=vg(e.metrics[i]);this.compile({loss:t,metrics:n,optimizer:r})}},{key:"save",value:function(){var e=Object(w.a)(k.a.mark((function e(t,n){var r,a,i,o,s,u,c,l;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t){e.next=7;break}if(0!==(r=_h.getSaveHandlers(t)).length){e.next=4;break}throw new og("Cannot find any save handlers for URL '".concat(t,"'"));case 4:if(!(r.length>1)){e.next=6;break}throw new og("Found more than one (".concat(r.length,") save handlers for URL '").concat(t,"'"));case 6:t=r[0];case 7:if(null!=t.save){e.next=9;break}throw new og("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");case 9:return e.next=11,_h.encodeWeights(this.getNamedWeights(n));case 11:if(a=e.sent,!1,null,i={modelTopology:this.toJSON(null,!1),format:"layers-model",generatedBy:"TensorFlow.js tfjs-layers v".concat(Dk),convertedBy:null},null==n||!n.includeOptimizer||null==this.optimizer){e.next=29;break}return i.trainingConfig=this.getTrainingConfig(),s="optimizer",e.t0=_h,e.next=21,this.optimizer.getWeights();case 21:return e.t1=e.sent,e.t2=s,e.next=25,e.t0.encodeWeights.call(e.t0,e.t1,e.t2);case 25:u=e.sent,c=u.data,l=u.specs,(o=a.specs).push.apply(o,Object(S.a)(l)),a.data=_h.concatenateArrayBuffers([a.data,c]);case 29:return e.abrupt("return",(null!=this.userDefinedMetadata&&(Ok(this.userDefinedMetadata,this.name,!0),i.userDefinedMetadata=this.userDefinedMetadata),i.weightData=a.data,i.weightSpecs=a.specs,t.save(i)));case 30:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"setUserDefinedMetadata",value:function(e){Ok(e,this.name),this.userDefinedMetadata=e}},{key:"getUserDefinedMetadata",value:function(){return this.userDefinedMetadata}},{key:"stopTraining",set:function(e){this.stopTraining_=e},get:function(){return this.stopTraining_}},{key:"optimizer",get:function(){return this.optimizer_},set:function(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}}]),n}(function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;if(Object(O.a)(this,n),(r=t.call(this,{})).containerNodes=new Set,r.name=e.name,null==r.name){var a=r.getClassName().toLowerCase();r.name=_g(a)}if(r.supportsMasking=!1,r.trainable_=!0,Array.isArray(e.inputs)?r.inputs=e.inputs.slice():r.inputs=[e.inputs],Array.isArray(e.outputs)?r.outputs=e.outputs.slice():r.outputs=[e.outputs],wg(r.inputs).length!==r.inputs.length)throw new og("The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ".concat(r.inputs.map((function(e){return e.name}))));wg(r.outputs).length!==r.outputs.length&&console.warn("The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ".concat(r.outputs.map((function(e){return e.name})))),r.inputLayers=[],r.inputLayersNodeIndices=[],r.inputLayersTensorIndices=[],r.outputLayers=[],r.outputLayersNodeIndices=[],r.outputLayersTensorIndices=[],r.layers=[],r.internalContainerRefs=[];var i,o=Object(N.a)(r.outputs);try{for(o.s();!(i=o.n()).done;){var s=i.value,u=s.sourceLayer,c=s.nodeIndex,l=s.tensorIndex;r.outputLayers.push(u),r.outputLayersNodeIndices.push(c),r.outputLayersTensorIndices.push(l)}}catch(Ne){o.e(Ne)}finally{o.f()}var d,p=Object(N.a)(r.inputs);try{for(p.s();!(d=p.n()).done;){var h=d.value,v=h.sourceLayer,b=h.nodeIndex,g=h.tensorIndex;dg(0===b,"input layer has >1 nodes"),dg(0===g,"input layer has >1 tensors"),r.inputLayers.push(v),r.inputLayersNodeIndices.push(b),r.inputLayersTensorIndices.push(g)}}catch(Ne){p.e(Ne)}finally{p.f()}r.inputNames=[],r.outputNames=[],r.feedInputShapes=[],r.feedInputNames=[],r.feedOutputNames=[];for(var y=0;y<r.inputLayers.length;y++){var x=r.inputLayers[y];if(!(x instanceof tx))throw new TypeError("Input layers to a LayersModel must be InputLayer objects. Received inputs: ".concat(e.inputs,". Input ").concat(y," (0-based) originates from layer type ").concat(x.getClassName(),"."));r.inputNames.push(x.name),r.feedInputShapes.push(x.batchInputShape),r.feedInputNames.push(x.name)}var k,w=Object(N.a)(r.outputLayers);try{for(w.s();!(k=w.n()).done;){var I=k.value;r.outputNames.push(I.name)}}catch(Ne){w.e(Ne)}finally{w.f()}r.internalInputShapes=r.inputs.map((function(e){return e.shape})),r.internalOutputShapes=r.outputs.map((function(e){return e.shape}));var S,j={},T={},C={},E={},_={},A=[],R=function e(t,a,i,o,s,u){(null==o||null==s||null==u)&&(o=t.sourceLayer,s=t.nodeIndex,u=t.tensorIndex);var c=o.inboundNodes[s];if(-1!==i.indexOf(c))throw new ig("The tensor ".concat(t.name,' at layer "').concat(o.name,'" is part of a cycle.'));if(-1===a.indexOf(c)){r.containerNodes.add(n.nodeKey(o,s)),o.id in _||(_[o.id]=Object.keys(_).length),-1===i.indexOf(c)&&i.push(c);for(var l=c.inboundLayers.length,d=0;d<l;d++){e(c.inputTensors[d],a,i,c.inboundLayers[d],c.nodeIndices[d],c.tensorIndices[d])}for(a.push(c);i.indexOf(c)>=0;)i.splice(i.indexOf(c),1);A.push(c)}},D=[],F=[],M=Object(N.a)(r.outputs);try{for(M.s();!(S=M.n()).done;){R(S.value,D,F)}}catch(Ne){M.e(Ne)}finally{M.f()}var z,L=A.slice().reverse(),P=Object(N.a)(L);try{for(P.s();!(z=P.n()).done;){var B=z.value;T[B.id]=B,B.id in j||(j[B.id]=0);var W=j[B.id],U=null==C[B.outboundLayer.id]?0:C[B.outboundLayer.id];W=Math.max(W,U),C[B.outboundLayer.id]=W,E[B.outboundLayer.id]=B.outboundLayer,j[B.id]=W;for(var V=0;V<B.inboundLayers.length;V++){var G=B.inboundLayers[V],H=B.nodeIndices[V],q=G.inboundNodes[H],K=null==j[q.id]?0:j[q.id];j[q.id]=Math.max(W+1,K),T[q.id]=q}}}catch(Ne){P.e(Ne)}finally{P.f()}var X={};for(var Y in j){var Z=j[Y];Z in X||(X[Z]=[]),X[Z].push(T[Y])}var J={};for(var Q in C){var $=C[Q];$ in J||(J[$]=[]),J[$].push(E[Q])}var ee=Object.keys(J).map((function(e){return parseInt(e,10)})).sort(kg);r.layers=[];var te,ne=Object(N.a)(ee);try{for(ne.s();!(te=ne.n()).done;){var re=J[te.value];re.sort((function(e,t){var n=_[e.id],r=_[t.id];return n<r?-1:n>r?1:0}));var ae,ie=Object(N.a)(re);try{for(ie.s();!(ae=ie.n()).done;){var oe=ae.value;oe instanceof n&&r.internalContainerRefs.push(oe),r.layers.push(oe)}}catch(Ne){ie.e(Ne)}finally{ie.f()}}}catch(Ne){ne.e(Ne)}finally{ne.f()}r.layersByDepth=J,ee=Object.keys(X).map((function(e){return parseInt(e,10)})).sort(kg);var se,ue=r.inputs.slice(),ce=[],le=Object(N.a)(ee);try{for(le.s();!(se=le.n()).done;){var de,pe=se.value,fe=Object(N.a)(X[pe]);try{for(fe.s();!(de=fe.n()).done;){var he=de.value,me=he.outboundLayer;if(null!=me){var ve,be=Object(N.a)(he.inputTensors);try{for(be.s();!(ve=be.n()).done;){var ge=ve.value;if(-1===ue.indexOf(ge))throw new ig("Graph disconnected: cannot obtain value for tensor ".concat(ge,' at layer "').concat(me.name,'". The following previous layers were accessed without issue: ').concat(ce))}}catch(Ne){be.e(Ne)}finally{be.f()}var ye,xe=Object(N.a)(he.outputTensors);try{for(xe.s();!(ye=xe.n()).done;){var ke=ye.value;ue.push(ke)}}catch(Ne){xe.e(Ne)}finally{xe.f()}ce.push(me.name)}}}catch(Ne){fe.e(Ne)}finally{fe.f()}}}catch(Ne){le.e(Ne)}finally{le.f()}r.nodesByDepth=X;var we,Oe=r.layers.map((function(e){return e.name})),Ie=Object(N.a)(Oe);try{var Se=function(){var e=we.value,t=Oe.filter((function(t){return t===e})).length;if(1!==t)throw new ig('The name "'.concat(e,'" is used ').concat(t," times in the model. All layer names should be unique. Layer names: ")+JSON.stringify(Oe))};for(Ie.s();!(we=Ie.n()).done;)Se()}catch(Ne){Ie.e(Ne)}finally{Ie.f()}return r.outboundNodes=[],r.inboundNodes=[],new Qy({outboundLayer:Object(f.a)(r),inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:r.inputs,outputTensors:r.outputs,inputMasks:r.inputs.map((function(e){return null})),outputMasks:r.outputs.map((function(e){return null})),inputShapes:r.inputs.map((function(e){return e.shape})),outputShapes:r.outputs.map((function(e){return e.shape}))}),r.built=!0,r._refCount=1,Object(m.a)(r)}return Object(I.a)(n,[{key:"assertNotDisposed",value:function(){if(0===this._refCount)throw new Error("Container '".concat(this.name,"' is already disposed."))}},{key:"dispose",value:function(){this.assertNotDisposed();var e={refCountAfterDispose:null,numDisposedVariables:0};if(0===--this._refCount){var t,n=Object(N.a)(this.layers);try{for(n.s();!(t=n.n()).done;){var r=t.value;e.numDisposedVariables+=r.dispose().numDisposedVariables}}catch(s){n.e(s)}finally{n.f()}var a,i=Object(N.a)(this.internalContainerRefs);try{for(i.s();!(a=i.n()).done;){var o=a.value;e.numDisposedVariables+=o.dispose().numDisposedVariables}}catch(s){i.e(s)}finally{i.f()}}return e.refCountAfterDispose=this._refCount,e}},{key:"loadWeights",value:function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r={},a=0,i=Object(N.a)(this.layers);try{for(i.s();!(t=i.n()).done;){var o,s=t.value,u=Object(N.a)(s.weights);try{for(u.s();!(o=u.n()).done;){var c=o.value;if(null!=r[c.originalName])throw new og("Duplicate weight name: ".concat(c.originalName));r[c.originalName]=c,a++}}catch(v){u.e(v)}finally{u.f()}}}catch(v){i.e(v)}finally{i.f()}var l=[];for(var d in e){var p=d;if(null==r[d]){var f=d.split("/");p=f.slice(0,-2).concat([f[f.length-1]]).join("/")}if(null!=r[p])l.push([r[p],e[d]]);else if(n)throw new og("Provided weight data has no target variable: ".concat(d));delete r[p]}if(n){var h=[];for(var m in r)h.push(m);if(h.length>0)throw new og("".concat(h.length," of ").concat(a," weights are not set: ").concat(h))}Xy(l)}},{key:"updatedConfig",value:function(){var e=this.getConfig(),t={};return t.className=this.getClassName(),t.config=e,t.kerasVersion="tfjs-layers ".concat(Dk),t.backend="TensorFlow.js",t}},{key:"toJSON",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=Rk(this.updatedConfig());return t?JSON.stringify(n):n}},{key:"call",value:function(e,t){var n=this;return zs((function(){e=hg(e);for(var r=new rx,a=0;a<n.inputs.length;++a)r.add(n.inputs[a],e[a]);return ox(n.outputs,r,t)}))}},{key:"computeMask",value:function(e,t){var n=this;return zs((function(){var r;return e=hg(e),r=null==t?lg(null,e.length):hg(t),n.runInternalGraph(e,r)[1]}))}},{key:"computeOutputShape",value:function(e){var t=Wy(e);if(t.length!==this.inputLayers.length)throw new og("Invalid inputShape argument ".concat(e,": model has ").concat(this.inputLayers.length," tensor inputs."));for(var n={},r=0;r<t.length;r++){var a=this.inputLayers[r],i=t[r];n[a.name+"_0_0"]=i}var o=Object.keys(this.nodesByDepth).map((function(e){return parseInt(e,10)})).sort(kg);if(o.length>1){var s,u=Object(N.a)(o);try{for(u.s();!(s=u.n()).done;){var c,l=s.value,d=this.nodesByDepth[l],p=Object(N.a)(d);try{for(p.s();!(c=p.n()).done;){var f=c.value,h=f.outboundLayer;if(-1===this.inputLayers.map((function(e){return e.id})).indexOf(h.id)){for(var m=[],v=0;v<f.inboundLayers.length;v++){var b=f.inboundLayers[v],g=f.nodeIndices[v],y=f.tensorIndices[v],x=n["".concat(b.name,"_").concat(g,"_").concat(y)];m.push(x)}for(var k=Wy(h.computeOutputShape(fg(m))),w=h.inboundNodes.indexOf(f),O=0;O<k.length;O++){n["".concat(h.name,"_").concat(w,"_").concat(O)]=k[O]}}}}catch(D){p.e(D)}finally{p.f()}}}catch(D){u.e(D)}finally{u.f()}}for(var I=[],S=[],j=0;j<this.outputLayers.length;j++){var T=this.outputLayers[j],C=this.outputLayersNodeIndices[j],E=this.outputLayersTensorIndices[j],_="".concat(T.name,"_").concat(C,"_").concat(E);S.push(_)}for(var A=0;A<S.length;A++){var R=S[A];dg(R in n),I.push(n[R])}return fg(I)}},{key:"runInternalGraph",value:function(e,t){null==t&&(t=lg(null,e.length));for(var n={},r=0;r<this.inputs.length;++r){var a=this.inputs[r],i=e[r],o=t[r];n[a.id]=[i,o]}var s,u=Object.keys(this.nodesByDepth).map((function(e){return parseInt(e,10)})).sort(kg),c=Object(N.a)(u);try{for(c.s();!(s=c.n()).done;){var l,d=s.value,p=this.nodesByDepth[d],f=Object(N.a)(p);try{for(f.s();!(l=f.n()).done;){var h,m=l.value,v=m.outboundLayer,b=m.inputTensors,g=m.outputTensors,x=new Array,k=Object(N.a)(b);try{for(k.s();!(h=k.n()).done;){var w=h.value;w.id in n&&x.push(n[w.id])}}catch(H){k.e(H)}finally{k.f()}if(x.length===b.length){var O={},I=void 0,S=void 0,j=void 0,T=void 0;if(null!=m.callArgs&&(O=m.callArgs),1===x.length){var C=Object(y.a)(x[0],2),E=C[0],_=C[1];null==O.mask&&(O.mask=_),j=hg(v.call(E,O)),T=hg(v.computeMask(E,_)),I=[E],S=[_]}else I=x.map((function(e){return e[0]})),S=x.map((function(e){return e[1]})),null==O.mask&&(O.mask=S),j=hg(v.call(I,O)),T=hg(v.computeMask(I,S));if(v.activityRegularizer)throw new sg("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(var A=0;A<g.length;++A){var R=g[A],D=j[A],F=T[A];n[R.id]=[D,F]}}}}catch(H){f.e(H)}finally{f.f()}}}catch(H){c.e(H)}finally{c.f()}var M,z=[],L=[],P=[],B=Object(N.a)(this.outputs);try{for(B.s();!(M=B.n()).done;){var W=M.value;dg(W.id in n,"Could not compute output ".concat(W.name," : ").concat(W.id));var U=Object(y.a)(n[W.id],2),V=U[0],G=U[1];P.push(V.shape),z.push(V),L.push(G)}}catch(H){B.e(H)}finally{B.f()}return[z,L,P]}},{key:"buildNodeConversionMap",value:function(e){var t,r,a={},i=Object(N.a)(this.layers);try{for(i.s();!(r=i.n()).done;){var o=r.value;t=o instanceof n?1:0;for(var s=0;s<o.inboundNodes.length;s++){var u=n.nodeKey(o,s);this.containerNodes.has(u)&&(a[u]=t,t+=1)}}}catch(c){i.e(c)}finally{i.f()}return a}},{key:"getLayer",value:function(e,t){if(null!=t)return this.findLayer(t);if(null==e)throw new og("Provide either a layer name or layer index");if("number"==typeof e)return this.findLayer(e);var n,r=Object(N.a)(this.layers);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(a.name===e)return a}}catch(i){r.e(i)}finally{r.f()}throw new og("No such layer: ".concat(e))}},{key:"findLayer",value:function(e){if(this.layers.length<=e)throw new og("Was asked to retrieve layer at index ".concat(e,", but model only has ").concat(this.layers.length," layer(s)."));return this.layers[e]}},{key:"calculateLosses",value:function(){var e=this;return zs((function(){var t,r=[],a=Object(N.a)(e.layers);try{for(a.s();!(t=a.n()).done;)for(var i=t.value,o=0;o<i.inboundNodes.length;++o){var s=n.nodeKey(i,o);e.containerNodes.has(s)&&r.push.apply(r,Object(S.a)(i.calculateLosses()))}}catch(u){a.e(u)}finally{a.f()}return r}))}},{key:"getConfig",value:function(){var e,t={name:this.name},r=this.buildNodeConversionMap(this.layers),a=[],i=Object(N.a)(this.layers);try{for(i.s();!(e=i.n()).done;){for(var o=e.value,s=o.getClassName(),u=o.getConfig(),c=[],l=0;l<o.inboundNodes.length;l++){var d=o.inboundNodes[l],p=n.nodeKey(o,l),f={};if(this.containerNodes.has(p)){if(d.callArgs)try{JSON.stringify(d.callArgs),f=d.callArgs}catch(M){console.warn("Layer ".concat(o.name," was passed non-serializable keyword arguments: ").concat(d.callArgs,". They will not be included in the serialized model (and thus will be missing at deserialization time).")),f={}}if(d.inboundLayers.length>0){for(var h=[],m=0;m<d.inboundLayers.length;m++){var v=d.inboundLayers[m],b=d.nodeIndices[m],g=d.tensorIndices[m],y=r[n.nodeKey(v,b)];null==y&&(y=0),h.push([v.name,y,g,f])}c.push(h)}}}var x={};x.name=o.name,x.className=s,x.config=u,x.inboundNodes=c,a.push(x)}}catch(z){i.e(z)}finally{i.f()}t.layers=a;for(var k=[],w=0;w<this.inputLayers.length;w++){var O=this.inputLayers[w],I=this.inputLayersNodeIndices[w],S=n.nodeKey(O,I);if(this.containerNodes.has(S)){var j=r[S];null==j&&(j=0);var T=this.inputLayersTensorIndices[w];k.push([O.name,j,T])}}t.inputLayers=k;for(var C=[],E=0;E<this.outputLayers.length;E++){var _=this.outputLayers[E],A=this.outputLayersNodeIndices[E],R=n.nodeKey(_,A);if(this.containerNodes.has(R)){var D=r[R];null==D&&(D=0);var F=this.outputLayersTensorIndices[E];C.push([_.name,D,F])}}return t.outputLayers=C,t}},{key:"resetStates",value:function(){var e=this;zs((function(){e.layers.forEach((function(e){e.stateful&&e.resetStates()}))}))}},{key:"trainable",get:function(){return this.trainable_},set:function(e){this.layers.forEach((function(t){t._trainableWeights.forEach((function(t){return t.trainable=e}))})),this.trainable_=e}},{key:"trainableWeights",get:function(){if(this._trainableWeights.length>0)throw new og("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];var e,t=[],n=Object(N.a)(this.layers);try{for(n.s();!(e=n.n()).done;){var r=e.value;t=t.concat(r.trainableWeights)}}catch(a){n.e(a)}finally{n.f()}return t}},{key:"nonTrainableWeights",get:function(){var e,t=[],n=Object(N.a)(this.layers);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,Object(S.a)(r.nonTrainableWeights))}}catch(u){n.e(u)}finally{n.f()}if(!this.trainable){var a,i=[],o=Object(N.a)(this.layers);try{for(o.s();!(a=o.n()).done;){var s=a.value;i.push.apply(i,Object(S.a)(s.trainableWeights))}}catch(u){o.e(u)}finally{o.f()}return i.concat(t)}return t}},{key:"weights",get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)}},{key:"stateful",get:function(){if(this._stateful)throw new og("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");var e,t=Object(N.a)(this.layers);try{for(t.s();!(e=t.n()).done;){if(e.value.stateful)return!0}}catch(n){t.e(n)}finally{t.f()}return!1}}],[{key:"fromConfig",value:function(e,t){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r={},a={};function i(e,t){e.name in a?a[e.name].push(t):a[e.name]=[t]}function o(e,t){var n,a,o=[],s=Object(N.a)(t);try{for(s.s();!(a=s.n()).done;){var u=a.value,c=u[0],l=u[1],d=u[2];if(n=null==u[3]?{}:u[3],!(c in r))return void i(e,t);var p=r[c];if(p.inboundNodes.length<=l)return void i(e,t);var f=p.inboundNodes[l];o.push(f.outputTensors[d])}}catch(h){s.e(h)}finally{s.f()}o.length>0&&e.apply(fg(o),n)}function s(e){var a=e.name,o=ek(e,null!=t.customObjects?t.customObjects:{});o.setFastWeightInitDuringBuild(n),r[a]=o,e.inboundNodes.forEach((function(e){if(!(e instanceof Array))throw new og("Corrupted configuration, expected array for nodeData: ".concat(e));i(o,e)}))}var u,c=t.name,l=t.layers,d=Object(N.a)(l);try{for(d.s();!(u=d.n()).done;){var p=u.value;s(p)}}catch(B){d.e(B)}finally{d.f()}for(;!Og(a);){var f,h=Object(N.a)(l);try{for(h.s();!(f=h.n()).done;){var m=f.value,v=r[m.name];if(v.name in a){var b=a[v.name];delete a[v.name];var g,y=Object(N.a)(b);try{for(y.s();!(g=y.n()).done;){var x=g.value;o(v,x)}}catch(B){y.e(B)}finally{y.f()}}}}catch(B){h.e(B)}finally{h.f()}}var k,w=[],O=[],I=t.inputLayers,S=Object(N.a)(I);try{for(S.s();!(k=S.n()).done;){var j=k.value,T=j[0],C=j[1],E=j[2];dg(T in r);var _=r[T].inboundNodes[C].outputTensors;w.push(_[E])}}catch(B){S.e(B)}finally{S.f()}var A,R=t.outputLayers,D=Object(N.a)(R);try{for(D.s();!(A=D.n()).done;){var F=A.value,M=F[0],z=F[1],L=F[2];dg(M in r);var P=r[M].inboundNodes[z].outputTensors;O.push(P[L])}}catch(B){D.e(B)}finally{D.f()}return new e({inputs:w,outputs:O,name:c})}}]),n}(ex));sw.className="Model",gh.registerClass(sw);var uw=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){return Object(O.a)(this,n),t.apply(this,arguments)}return n}(sw);function cw(e,t){return lw.apply(this,arguments)}function lw(){return(lw=Object(w.a)(k.a.mark((function e(t,n){var r,a,i,o,s,u,c,l;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("modelTopology"in t||(t={modelTopology:t}),null!=(r=(t=t).modelTopology).model_config&&(r=r.model_config),a=Ak(r),i=ek(a,n),null==t.weightsManifest){e.next=12;break}return e.next=7,_h.loadWeights(t.weightsManifest,t.pathPrefix,i.weights.map((function(e){return e.originalName})));case 7:o=e.sent,s={},u=Object(N.a)(i.weights);try{for(u.s();!(c=u.n()).done;)l=c.value,s[l.originalName]=o[l.originalName]}catch(d){u.e(d)}finally{u.f()}i.loadWeights(s),Ls(o);case 12:return e.abrupt("return",i);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function dw(e,t){return pw.apply(this,arguments)}function pw(){return(pw=Object(w.a)(k.a.mark((function e(t,n){var r;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n&&(n={}),"string"!=typeof t){e.next=9;break}if(0!==(r=_h.getLoadHandlers(t,n)).length){e.next=6;break}r.push(_h.browserHTTPRequest(t,n)),e.next=8;break;case 6:if(!(r.length>1)){e.next=8;break}throw new og("Found more than one (".concat(r.length,") load handlers for URL '").concat(t,"'"));case 8:t=r[0];case 9:return e.abrupt("return",fw(t,void 0,n));case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function fw(e,t,n){return hw.apply(this,arguments)}function hw(){return(hw=Object(w.a)(k.a.mark((function e(t,n,r){var a,i,o,s,u,c,l,d,p;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==r&&(r={}),null!=t.load){e.next=2;break}throw new og("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");case 2:return e.next=4,t.load();case 4:if(a=e.sent,null!=(i=a.modelTopology).model_config&&(i=i.model_config),o=null==r.strict||r.strict,s=null!=a.weightData&&null!=a.weightSpecs&&o,u=ek(Ak(i),n,s),null!=(c=a.trainingConfig)&&u.loadTrainingConfig(c),null!=a.userDefinedMetadata&&u.setUserDefinedMetadata(a.userDefinedMetadata),null==a.weightData){e.next=19;break}if(null!=a.weightSpecs){e.next=11;break}throw new og("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");case 11:if(l=mw(a.weightData,a.weightSpecs),d=l.modelWeights,p=l.optimizerWeights,u.loadWeights(d,o),e.t0=null!=u.optimizer&&p.length>0,!e.t0){e.next=17;break}return e.next=17,u.optimizer.setWeights(p);case 17:Ls(d),Ls(p.map((function(e){return e.tensor})));case 19:return e.abrupt("return",u);case 20:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function mw(e,t){var n=_h.decodeWeights(e,t),r={},a=[];return t.forEach((function(e){"optimizer"===e.group?a.push({name:e.name,tensor:n[e.name]}):r[e.name]=n[e.name]})),{modelWeights:r,optimizerWeights:a}}uw.className="Functional",gh.registerClass(uw);var vw=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;if(Object(O.a)(this,n),e=e||{},(r=t.call(this,{inputs:[],outputs:[]})).trainable=!0,r.built=!1,r.name=null!=e.name?e.name:_g("sequential_"),null!=e.layers){var a,i=Object(N.a)(e.layers);try{for(i.s();!(a=i.n()).done;){var o=a.value;r.add(o)}}catch(s){i.e(s)}finally{i.f()}}return Object(m.a)(r)}return Object(I.a)(n,[{key:"checkShape",value:function(e){if(e.inboundNodes[0].outputTensors[0].shape.some((function(e){return e<0})))throw new og("Negative dimension size caused by adding layer ".concat(e.name," with input shape [").concat(e.inboundNodes[0].inputTensors[0].shape,"]"))}},{key:"add",value:function(e){var t,r=e instanceof n||e instanceof sw;if(r){if(1!==(t=e).outputs.length)throw new og("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(1!==t.inputs.length)throw new og("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(0===this.outputs.length){if(0===e.inboundNodes.length){if(null==e.batchInputShape)throw new og("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");var a=nx({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(a)}if(r)this.outputs=t.outputs,this.inputs=t.inputs;else{if(1!==e.inboundNodes.length)throw new og("A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ".concat(e.name," which has ").concat(e.inboundNodes.length," pre-existing inbound connections."));if(1!==e.inboundNodes[0].outputTensors.length)throw new og("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=function e(t,n,r){if((null==n||null!=r&&r>0)&&(n=t.sourceLayer,r=t.nodeIndex),0===n.inboundNodes.length)return[t];var a=n.inboundNodes[r];if(0===a.inboundLayers.length)return a.inputTensors;for(var i=[],o=0;o<a.inboundLayers.length;o++){var s,u=e(a.inputTensors[o],a.inboundLayers[o],a.nodeIndices[o]),c=Object(N.a)(u);try{for(c.s();!(s=c.n()).done;){var l=s.value;-1===i.indexOf(l)&&i.push(l)}}catch(d){c.e(d)}finally{c.f()}}return i}(this.outputs[0])}this.inboundNodes=[],new Qy({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:lg(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map((function(e){return e.shape})),outputShapes:this.outputs[0].shape})}else{var i=e.apply(this.outputs[0]);if(Array.isArray(i))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[i],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}},{key:"pop",value:function(){if(0===this.layers.length)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),0===this.layers.length)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{var e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}},{key:"call",value:function(e,t){return null==this.model&&this.build(),this.model.call(e,t)}},{key:"build",value:function(e){if(Vy(e),0===this.inputs.length||0===this.outputs.length)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new sw({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}},{key:"countParams",value:function(){return this.built||this.build(),Object(d.a)(Object(p.a)(n.prototype),"countParams",this).call(this)}},{key:"summary",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log;this.built||this.build(),Object(d.a)(Object(p.a)(n.prototype),"summary",this).call(this,e,t,r)}},{key:"setWeights",value:function(e){null==this.model&&this.build(),this.model.setWeights(e)}},{key:"evaluate",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!this.built)throw new ig("The model needs to be compiled before being used.");return this.model.evaluate(e,t,n)}},{key:"evaluateDataset",value:function(){var e=Object(w.a)(k.a.mark((function e(t,n){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.built){e.next=2;break}throw new ig("The model needs to be compiled before being used.");case 2:return e.abrupt("return",this.model.evaluateDataset(t,n));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"predict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return null==this.model&&this.build(),this.model.predict(e,t)}},{key:"predictOnBatch",value:function(e){return null==this.model&&this.build(),this.model.predictOnBatch(e)}},{key:"compile",value:function(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}},{key:"fit",value:function(){var e=Object(w.a)(k.a.mark((function e(t,n){var r,a=arguments;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a.length>2&&void 0!==a[2]?a[2]:{},this.built){e.next=3;break}throw new ig("The model needs to be compiled before being used.");case 3:return e.abrupt("return",this.model.fit(t,n,r));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"fitDataset",value:function(){var e=Object(w.a)(k.a.mark((function e(t,n){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.built){e.next=2;break}throw new ig("The model needs to be compiled before being used.");case 2:return e.abrupt("return",this.model.fitDataset(t,n));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"trainOnBatch",value:function(){var e=Object(w.a)(k.a.mark((function e(t,n){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.model.trainOnBatch(t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){var e,t=[],n=Object(N.a)(this.layers);try{for(n.s();!(e=n.n()).done;){var r=e.value,a={};a.className=r.getClassName(),a.config=r.getConfig(),t.push(a)}}catch(i){n.e(i)}finally{n.f()}return{name:this.name,layers:t}}},{key:"optimizer",get:function(){return null==this.model?void 0:this.model.optimizer},set:function(e){this.model.optimizer=e}},{key:"stopTraining",set:function(e){if(null==this.model)throw new og("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e},get:function(){if(null==this.model)throw new og("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}}],[{key:"fromConfig",value:function(e,t){var r,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i={};if(t instanceof Array){if(null==t[0].className||"Merge"===t[0].className)throw new og("Legacy serialization format not supported yet.");r=t}else Ga.assert(null!=t.layers,(function(){return"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."})),r=t.layers,delete t.layers,i=t;var o=new e(i);if(!(o instanceof n))throw new sg("Sequential.fromConfig called on non-Sequential input: ".concat(o));var s,u=Object(N.a)(r);try{for(u.s();!(s=u.n()).done;){var c=s.value,l=ek(c,void 0,a);a&&l.setFastWeightInitDuringBuild(!0),o.add(l)}}catch(d){u.e(d)}finally{u.f()}return o}}]),n}(sw);function bw(e){return new sw(e)}function gw(e){return new vw(e)}function yw(e){return nx(e)}function xw(e,t){Qx.registerCallbackConstructor(e,t)}vw.className="Sequential",gh.registerClass(vw);var kw=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){return Object(O.a)(this,n),t.apply(this,arguments)}return Object(I.a)(n,[{key:"getConfig",value:function(){return{}}}]),n}(gh.Serializable),ww=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){return Object(O.a)(this,n),t.apply(this,arguments)}return Object(I.a)(n,[{key:"apply",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return my(e,t)}}]),n}(kw);ww.className="elu",gh.registerClass(ww);var Ow=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){return Object(O.a)(this,n),t.apply(this,arguments)}return Object(I.a)(n,[{key:"apply",value:function(e){return Xd(e)}}]),n}(kw);Ow.className="selu",gh.registerClass(Ow);var Iw=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){return Object(O.a)(this,n),t.apply(this,arguments)}return Object(I.a)(n,[{key:"apply",value:function(e){return Pd(e)}}]),n}(kw);Iw.className="relu",gh.registerClass(Iw);var Sw=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){return Object(O.a)(this,n),t.apply(this,arguments)}return Object(I.a)(n,[{key:"apply",value:function(e){return zs((function(){return Vl(6,Pd(e))}))}}]),n}(kw);Sw.className="relu6",gh.registerClass(Sw);var Nw=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){return Object(O.a)(this,n),t.apply(this,arguments)}return Object(I.a)(n,[{key:"apply",value:function(e){return e}}]),n}(kw);Nw.className="linear",gh.registerClass(Nw);var jw=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){return Object(O.a)(this,n),t.apply(this,arguments)}return Object(I.a)(n,[{key:"apply",value:function(e){return Fu(e)}}]),n}(kw);jw.className="sigmoid",gh.registerClass(jw);var Tw=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){return Object(O.a)(this,n),t.apply(this,arguments)}return Object(I.a)(n,[{key:"apply",value:function(e){return function(e){return zs((function(){var t=Zs(.5,$s(.2,e));return Ju(t,0,1)}))}(e)}}]),n}(kw);Tw.className="hardSigmoid",gh.registerClass(Tw);var Cw=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){return Object(O.a)(this,n),t.apply(this,arguments)}return Object(I.a)(n,[{key:"apply",value:function(e){return Ol(e)}}]),n}(kw);Cw.className="softplus",gh.registerClass(Cw);var Ew=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){return Object(O.a)(this,n),t.apply(this,arguments)}return Object(I.a)(n,[{key:"apply",value:function(e){return function(e){return zs((function(){return Qs(e,Zs(eu(e),1))}))}(e)}}]),n}(kw);Ew.className="softsign",gh.registerClass(Ew);var _w=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){return Object(O.a)(this,n),t.apply(this,arguments)}return Object(I.a)(n,[{key:"apply",value:function(e){return zu(e)}}]),n}(kw);_w.className="tanh",gh.registerClass(_w);var Aw=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){return Object(O.a)(this,n),t.apply(this,arguments)}return Object(I.a)(n,[{key:"apply",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return ip(e,t)}}]),n}(kw);Aw.className="softmax",gh.registerClass(Aw);var Rw=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){return Object(O.a)(this,n),t.apply(this,arguments)}return Object(I.a)(n,[{key:"apply",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return Nl(e,t)}}]),n}(kw);Rw.className="logSoftmax",gh.registerClass(Rw);var Dw=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){return Object(O.a)(this,n),t.apply(this,arguments)}return Object(I.a)(n,[{key:"apply",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return zs((function(){return $s(Fu($s(e,t)),e)}))}}]),n}(kw);Dw.className="swish",gh.registerClass(Dw);var Fw=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){return Object(O.a)(this,n),t.apply(this,arguments)}return Object(I.a)(n,[{key:"apply",value:function(e){return zs((function(){return $s(e,zu(Ol(e)))}))}}]),n}(kw);function Mw(e){return e.getClassName()}function zw(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return xg(e,gh.SerializationMap.getMap().classNameMap,t,"activation")}function Lw(e){if(null==e){var t={className:"linear",config:{}};return zw(t)}if("string"==typeof e){var n={};return n.className=e,n.config={},zw(n)}return e instanceof kw?e:zw(e)}function Pw(e){if(null!=e&&"object"!=typeof e)throw new Error("Argument to L1L2 regularizer's constructor is expected to be an object, but received: ".concat(e))}Fw.className="mish",gh.registerClass(Fw);var Bw=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){return Object(O.a)(this,n),t.apply(this,arguments)}return n}(gh.Serializable),Ww=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(O.a)(this,n),r=t.call(this),Pw(e),r.l1=null==e||null==e.l1?.01:e.l1,r.l2=null==e||null==e.l2?.01:e.l2,r.hasL1=0!==r.l1,r.hasL2=0!==r.l2,r}return Object(I.a)(n,[{key:"apply",value:function(e){var t=this;return zs((function(){var n=Bl([1]);return t.hasL1&&(n=Zs(n,Hc($s(t.l1,eu(e))))),t.hasL2&&(n=Zs(n,Hc($s(t.l2,py(e))))),Eu(n,[])}))}},{key:"getConfig",value:function(){return{l1:this.l1,l2:this.l2}}}],[{key:"fromConfig",value:function(e,t){return new e({l1:t.l1,l2:t.l2})}}]),n}(Bw);Ww.className="L1L2",gh.registerClass(Ww);var Uw={l1l2:"L1L2"};function Vw(e){return gg(e)}function Gw(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return xg(e,gh.SerializationMap.getMap().classNameMap,t,"regularizer")}function Hw(e){return null==e?null:"string"==typeof e?Gw({className:e in Uw?Uw[e]:e,config:{}}):e instanceof Bw?e:Gw(e)}var qw=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(O.a)(this,n),(r=t.call(this,null==e?{}:e)).supportsMasking=!0,null!=e&&(r.maxValue=e.maxValue),r}return Object(I.a)(n,[{key:"call",value:function(e,t){e=Uy(e);var n=Pd(e);return null!=this.maxValue&&(n=Ju(n,0,this.maxValue)),n}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={maxValue:this.maxValue},t=Object(d.a)(Object(p.a)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(ex);qw.className="ReLU",gh.registerClass(qw);var Kw=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(O.a)(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_ALPHA=.3,null==e&&(e={}),r.alpha=null==e.alpha?r.DEFAULT_ALPHA:e.alpha,r}return Object(I.a)(n,[{key:"call",value:function(e,t){var n=Uy(e);return ul(n,this.alpha)}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={alpha:this.alpha},t=Object(d.a)(Object(p.a)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(ex);Kw.className="LeakyReLU",gh.registerClass(Kw);var Xw=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;if(Object(O.a)(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_ALPHA_INITIALIZER="zeros",null==e&&(e={}),r.supportsMasking=!0,r.alphaInitializer=Py(e.alphaInitializer||r.DEFAULT_ALPHA_INITIALIZER),r.alphaRegularizer=Hw(e.alphaRegularizer),r.alphaConstraint=xx(e.alphaConstraint),null==e.sharedAxes)r.sharedAxes=null;else if(Array.isArray(e.sharedAxes))r.sharedAxes=e.sharedAxes;else{if("number"!=typeof e.sharedAxes)throw new og("Expected sharedAxes to be a number or an array of numbers, but got ".concat(e.sharedAxes));r.sharedAxes=[e.sharedAxes]}return Object(m.a)(r)}return Object(I.a)(n,[{key:"build",value:function(e){var t=(e=Vy(e)).slice(1);if(null!=this.sharedAxes){var n,r=Object(N.a)(this.sharedAxes);try{for(r.s();!(n=r.n()).done;){t[n.value-1]=1}}catch(o){r.e(o)}finally{r.f()}}this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);var a={};if(null!=this.sharedAxes)for(var i=1;i<e.length;++i)a[i]=e[i];this.inputSpec=[new Yy({ndim:e.length,axes:a})],this.built=!0}},{key:"call",value:function(e,t){return e=Uy(e),od(e,this.alpha.read())}},{key:"getConfig",value:function(){var e={alphaInitializer:Ly(this.alphaInitializer),alphaRegularizer:Vw(this.alphaRegularizer),alphaConstraint:gx(this.alphaConstraint),sharedAxes:this.sharedAxes},t=Object(d.a)(Object(p.a)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(ex);Xw.className="PReLU",gh.registerClass(Xw);var Yw=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;if(Object(O.a)(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_ALPHA=1,null==e&&(e={}),null!=e.alpha&&e.alpha!==r.DEFAULT_ALPHA)throw new sg("Non-default alpha value (".concat(e.alpha,") is not supported by the ELU layer yet."));return r.alpha=null==e.alpha?r.DEFAULT_ALPHA:e.alpha,Object(m.a)(r)}return Object(I.a)(n,[{key:"call",value:function(e,t){var n=Uy(e);return Tc(n)}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={alpha:this.alpha},t=Object(d.a)(Object(p.a)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(ex);Yw.className="ELU",gh.registerClass(Yw);var Zw=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(O.a)(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_THETA=1,null==e&&(e={}),r.theta=null==e.theta?r.DEFAULT_THETA:e.theta,r}return Object(I.a)(n,[{key:"call",value:function(e,t){var n=Uy(e);return $s(n,Ns(nl(n,this.theta),"float32"))}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={theta:this.theta},t=Object(d.a)(Object(p.a)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(ex);Zw.className="ThresholdedReLU",gh.registerClass(Zw);var Jw=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(O.a)(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_AXIS=1,null==e&&(e={}),r.softmax=(new Aw).apply,r.axis=null==e.axis?r.DEFAULT_AXIS:e.axis,r}return Object(I.a)(n,[{key:"call",value:function(e,t){var n=Uy(e);return this.softmax(n,this.axis)}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={axis:this.axis},t=Object(d.a)(Object(p.a)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(ex);function Qw(e,t,n){if("number"==typeof e)return lg(e,t);if(e.length!==t)throw new og("The ".concat(n," argument must be an integer or tuple of ").concat(t," integers. Received: ").concat(e.length," elements."));for(var r=0;r<t;++r){var a=e[r];if(!Xg(a))throw new og("The ".concat(n," argument must be an integer or tuple of ").concat(t," integers. Received: ").concat(JSON.stringify(e)," including a non-integer number ").concat(a))}return e}function $w(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;if(null==e)return e;var i,o=t+(t-1)*(a-1);return i="same"===n?e:e-o+1,Math.floor((i+r-1)/r)}function eO(e,t,n,r){if(null==e)return null;if("valid"===r)e=e*t+Jg([n-t,0]);else{if("same"!==r)throw new og("Unsupport padding mode: ".concat(r,"."));e*=t}return e}function tO(e,t){return zs((function(){return Lg(t),"channelsFirst"===t?Bp(e,[0,2,3,1]):e}))}function nO(e,t){return zs((function(){return Lg(t),"channelsFirst"===t?Bp(e,[0,2,3,4,1]):e}))}function rO(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;return zs((function(){if(null==i&&(i="channelsLast"),Lg(i),3!==e.rank&&4!==e.rank)throw new og("conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ".concat(e.rank,"."));if(3!==t.rank&&4!==t.rank)throw new og("conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ".concat(e.rank,"."));var u=tO(e,i);if("causal"===a)throw new sg("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return u=Jp.conv2d({x:u,filter:t,strides:r,pad:"same"===a?"same":"valid",dilations:o,dataFormat:"NHWC",bias:n,activation:s}),"channelsFirst"===i&&(u=Bp(u,[0,3,1,2])),u}))}Jw.className="Softmax",gh.registerClass(Jw);var aO=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e,r){var a;if(Object(O.a)(this,n),(a=t.call(this,r)).bias=null,a.DEFAULT_KERNEL_INITIALIZER="glorotNormal",a.DEFAULT_BIAS_INITIALIZER="zeros",n.verifyArgs(r),a.rank=e,Ng(a.rank,"rank"),1!==a.rank&&2!==a.rank&&3!==a.rank)throw new sg("Convolution layer for rank other than 1, 2, or 3 (".concat(a.rank,") is not implemented yet."));if(a.kernelSize=Qw(r.kernelSize,e,"kernelSize"),a.strides=Qw(null==r.strides?1:r.strides,e,"strides"),a.padding=null==r.padding?"valid":r.padding,Pg(a.padding),a.dataFormat=null==r.dataFormat?"channelsLast":r.dataFormat,Lg(a.dataFormat),a.activation=Lw(r.activation),a.useBias=null==r.useBias||r.useBias,a.biasInitializer=Py(r.biasInitializer||a.DEFAULT_BIAS_INITIALIZER),a.biasConstraint=xx(r.biasConstraint),a.biasRegularizer=Hw(r.biasRegularizer),a.activityRegularizer=Hw(r.activityRegularizer),a.dilationRate=Qw(null==r.dilationRate?1:r.dilationRate,e,"dilationRate"),1===a.rank&&Array.isArray(a.dilationRate)&&1!==a.dilationRate.length)throw new og("dilationRate must be a number or an array of a single number for 1D convolution, but received ".concat(JSON.stringify(a.dilationRate)));if(2===a.rank){if("number"==typeof a.dilationRate)a.dilationRate=[a.dilationRate,a.dilationRate];else if(2!==a.dilationRate.length)throw new og("dilationRate must be a number or array of two numbers for 2D convolution, but received ".concat(JSON.stringify(a.dilationRate)))}else if(3===a.rank)if("number"==typeof a.dilationRate)a.dilationRate=[a.dilationRate,a.dilationRate,a.dilationRate];else if(3!==a.dilationRate.length)throw new og("dilationRate must be a number or array of three numbers for 3D convolution, but received ".concat(JSON.stringify(a.dilationRate)));return Object(m.a)(a)}return Object(I.a)(n,[{key:"getConfig",value:function(){var e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:Mw(this.activation),useBias:this.useBias,biasInitializer:Ly(this.biasInitializer),biasRegularizer:Vw(this.biasRegularizer),activityRegularizer:Vw(this.activityRegularizer),biasConstraint:gx(this.biasConstraint)},t=Object(d.a)(Object(p.a)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}],[{key:"verifyArgs",value:function(e){if(dg("kernelSize"in e,"required key 'kernelSize' not in config"),"number"!=typeof e.kernelSize&&!Sg(e.kernelSize,"number",1,3))throw new og("BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(ex),iO=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e,r){var a;return Object(O.a)(this,n),(a=t.call(this,e,r)).kernel=null,n.verifyArgs(r),a.filters=r.filters,Ng(a.filters,"filters"),a.kernelInitializer=Py(r.kernelInitializer||a.DEFAULT_KERNEL_INITIALIZER),a.kernelConstraint=xx(r.kernelConstraint),a.kernelRegularizer=Hw(r.kernelRegularizer),a}return Object(I.a)(n,[{key:"build",value:function(e){e=Vy(e);var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new og("The channel dimension of the input should be defined. Found ".concat(e[t]));var n=e[t],r=this.kernelSize.concat([n,this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:Object(l.a)({},t,n)}],this.built=!0}},{key:"call",value:function(e,t){var n=this;return zs((function(){e=Uy(e);var t,r=null==n.bias?null:n.bias.read(),a=jg(n.activation.getClassName());if(null!=a&&2===n.rank)t=rO(e,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate,a);else{if(1===n.rank)t=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;return zs((function(){if(null==i&&(i="channelsLast"),Lg(i),3!==e.shape.length)throw new og("The input of a conv1dWithBias operation should be 3, but is ".concat(e.shape.length," instead."));if(3!==t.shape.length)throw new og("The kernel for a conv1dWithBias operation should be 3, but is ".concat(t.shape.length," instead"));if(null!=n&&1!==n.shape.length)throw new og("The bias for a conv1dWithBias operation should be 1, but is ".concat(t.shape.length," instead"));if("channelsFirst"===i&&(e=Bp(e,[0,2,1])),"causal"===a)throw new sg("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");var s=rc(e,t,r,"same"===a?"same":"valid","NWC",o);return null!=n&&(s=hy(s,n)),s}))}(e,n.kernel.read(),r,n.strides[0],n.padding,n.dataFormat,n.dilationRate[0]);else if(2===n.rank)t=rO(e,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate);else{if(3!==n.rank)throw new sg("convolutions greater than 3D are not implemented yet.");t=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0;return zs((function(){if(null==i&&(i="channelsLast"),Lg(i),4!==e.rank&&5!==e.rank)throw new og("conv3dWithBias expects input to be of rank 4 or 5, but received ".concat(e.rank,"."));if(4!==t.rank&&5!==t.rank)throw new og("conv3dWithBias expects kernel to be of rank 4 or 5, but received ".concat(e.rank,"."));var s=nO(e,i);if("causal"===a)throw new sg("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return s=oc(s,t,r,"same"===a?"same":"valid","NDHWC",o),null!=n&&(s=hy(s,n)),"channelsFirst"===i&&(s=Bp(s,[0,4,1,2,3])),s}))}(e,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate)}null!=n.activation&&(t=n.activation.apply(t))}return t}))}},{key:"computeOutputShape",value:function(e){e=Vy(e);for(var t=[],n="channelsLast"===this.dataFormat?e.slice(1,e.length-1):e.slice(2),r=0;r<n.length;++r){var a=$w(n[r],this.kernelSize[r],this.padding,this.strides[r],"number"==typeof this.dilationRate?this.dilationRate:this.dilationRate[r]);t.push(a)}var i=[e[0]];return"channelsLast"===this.dataFormat?(i=i.concat(t)).push(this.filters):(i.push(this.filters),i=i.concat(t)),i}},{key:"getConfig",value:function(){var e={filters:this.filters,kernelInitializer:Ly(this.kernelInitializer),kernelRegularizer:Vw(this.kernelRegularizer),kernelConstraint:gx(this.kernelConstraint)},t=Object(d.a)(Object(p.a)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}],[{key:"verifyArgs",value:function(e){if(!("filters"in e)||"number"!=typeof e.filters||e.filters<1)throw new og("Convolution layer expected config.filters to be a 'number' > 0 but got ".concat(JSON.stringify(e.filters)))}}]),n}(aO),oO=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(O.a)(this,n),r=t.call(this,2,e),n.verifyArgs(e),r}return Object(I.a)(n,[{key:"getConfig",value:function(){var e=Object(d.a)(Object(p.a)(n.prototype),"getConfig",this).call(this);return delete e.rank,e}}],[{key:"verifyArgs",value:function(e){if("number"!=typeof e.kernelSize&&!Sg(e.kernelSize,"number",1,2))throw new og("Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(iO);oO.className="Conv2D",gh.registerClass(oO);var sO=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(O.a)(this,n),r=t.call(this,3,e),n.verifyArgs(e),r}return Object(I.a)(n,[{key:"getConfig",value:function(){var e=Object(d.a)(Object(p.a)(n.prototype),"getConfig",this).call(this);return delete e.rank,e}}],[{key:"verifyArgs",value:function(e){if("number"!=typeof e.kernelSize&&(!Array.isArray(e.kernelSize)||1!==e.kernelSize.length&&3!==e.kernelSize.length))throw new og("Conv3D expects config.kernelSize to be number or [number, number, number], but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(iO);sO.className="Conv3D",gh.registerClass(sO);var uO=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;if(Object(O.a)(this,n),(r=t.call(this,e)).inputSpec=[new Yy({ndim:4})],"same"!==r.padding&&"valid"!==r.padding)throw new og("Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ".concat(r.padding));return Object(m.a)(r)}return Object(I.a)(n,[{key:"build",value:function(e){if(4!==(e=Vy(e)).length)throw new og("Input should have rank 4; Received input shape: "+JSON.stringify(e));var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new og("The channel dimension of the inputs should be defined. Found `None`.");var n=e[t],r=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Yy({ndim:4,axes:Object(l.a)({},t,n)})],this.built=!0}},{key:"call",value:function(e,t){var n=this;return zs((function(){var t=Uy(e);if(4!==t.shape.length)throw new og("Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-".concat(t.shape.length));var r,a,i=t.shape,o=i[0];"channelsFirst"===n.dataFormat?(r=2,a=3):(r=1,a=2);var s=i[r],u=i[a],c=n.kernelSize[0],l=n.kernelSize[1],d=n.strides[0],p=n.strides[1],f=[o,eO(s,d,c,n.padding),eO(u,p,l,n.padding),n.filters];"channelsLast"!==n.dataFormat&&(t=Bp(t,[0,2,3,1]));var h=ic(t,n.kernel.read(),f,n.strides,n.padding);return"channelsLast"!==n.dataFormat&&(h=Bp(h,[0,3,1,2])),null!=n.bias&&(h=hy(h,n.bias.read(),n.dataFormat)),null!=n.activation&&(h=n.activation.apply(h)),h}))}},{key:"computeOutputShape",value:function(e){var t,n,r,a=(e=Vy(e)).slice();"channelsFirst"===this.dataFormat?(t=1,n=2,r=3):(t=3,n=1,r=2);var i=this.kernelSize[0],o=this.kernelSize[1],s=this.strides[0],u=this.strides[1];return a[t]=this.filters,a[n]=eO(a[n],s,i,this.padding),a[r]=eO(a[r],u,o,this.padding),a}},{key:"getConfig",value:function(){var e=Object(d.a)(Object(p.a)(n.prototype),"getConfig",this).call(this);return delete e.dilationRate,e}}]),n}(oO);uO.className="Conv2DTranspose",gh.registerClass(uO);var cO=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;if(Object(O.a)(this,n),(r=t.call(this,e)).inputSpec=[new Yy({ndim:5})],"same"!==r.padding&&"valid"!==r.padding)throw new og("Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ".concat(r.padding));return Object(m.a)(r)}return Object(I.a)(n,[{key:"build",value:function(e){if(5!==(e=Vy(e)).length)throw new og("Input should have rank 5; Received input shape: "+JSON.stringify(e));var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new og("The channel dimension of the inputs should be defined. Found `None`.");var n=e[t],r=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Yy({ndim:5,axes:Object(l.a)({},t,n)})],this.built=!0}},{key:"call",value:function(e,t){var n=this;return zs((function(){var t=Uy(e);if(5!==t.shape.length)throw new og("Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-".concat(t.shape.length));var r,a,i,o=t.shape,s=o[0];"channelsFirst"===n.dataFormat?(i=2,r=3,a=4):(i=1,r=2,a=3);var u=o[i],c=o[r],l=o[a],d=n.kernelSize[0],p=n.kernelSize[1],f=n.kernelSize[2],h=n.strides[0],m=n.strides[1],v=n.strides[2],b=[s,eO(u,h,d,n.padding),eO(c,m,p,n.padding),eO(l,v,f,n.padding),n.filters];"channelsLast"!==n.dataFormat&&(t=Bp(t,[0,2,3,4,1]));var g=uc(t,n.kernel.read(),b,n.strides,n.padding);return"channelsLast"!==n.dataFormat&&(g=Bp(g,[0,4,1,2,3])),null!==n.bias&&(g=hy(g,n.bias.read(),n.dataFormat)),null!==n.activation&&(g=n.activation.apply(g)),g}))}},{key:"computeOutputShape",value:function(e){var t,n,r,a,i=(e=Vy(e)).slice();"channelsFirst"===this.dataFormat?(t=1,n=2,r=3,a=4):(t=4,n=1,r=2,a=3);var o=this.kernelSize[0],s=this.kernelSize[1],u=this.kernelSize[2],c=this.strides[0],l=this.strides[1],d=this.strides[2];return i[t]=this.filters,i[n]=eO(i[n],c,o,this.padding),i[r]=eO(i[r],l,s,this.padding),i[a]=eO(i[a],d,u,this.padding),i}},{key:"getConfig",value:function(){var e=Object(d.a)(Object(p.a)(n.prototype),"getConfig",this).call(this);return delete e.dilationRate,e}}]),n}(sO);cO.className="Conv3DTranspose",gh.registerClass(cO);var lO=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e,r){var a;if(Object(O.a)(this,n),(a=t.call(this,e,r)).DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",a.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",a.depthwiseKernel=null,a.pointwiseKernel=null,null==r.filters)throw new og("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(null!=r.kernelInitializer||null!=r.kernelRegularizer||null!=r.kernelConstraint)throw new og("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(null!=r.padding&&"same"!==r.padding&&"valid"!==r.padding)throw new og("SeparableConv".concat(a.rank,"D supports only padding modes: 'same' and 'valid', but received ").concat(JSON.stringify(r.padding)));return a.depthMultiplier=null==r.depthMultiplier?1:r.depthMultiplier,a.depthwiseInitializer=Py(r.depthwiseInitializer||a.DEFAULT_DEPTHWISE_INITIALIZER),a.depthwiseRegularizer=Hw(r.depthwiseRegularizer),a.depthwiseConstraint=xx(r.depthwiseConstraint),a.pointwiseInitializer=Py(r.depthwiseInitializer||a.DEFAULT_POINTWISE_INITIALIZER),a.pointwiseRegularizer=Hw(r.pointwiseRegularizer),a.pointwiseConstraint=xx(r.pointwiseConstraint),Object(m.a)(a)}return Object(I.a)(n,[{key:"build",value:function(e){if((e=Vy(e)).length<this.rank+2)throw new og("Inputs to SeparableConv".concat(this.rank,"D should have rank ").concat(this.rank+2,", but received input shape: ").concat(JSON.stringify(e)));var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t]||e[t]<0)throw new og("The channel dimension of the inputs should be defined, but found ".concat(JSON.stringify(e[t])));for(var n=e[t],r=this.kernelSize.concat([n,this.depthMultiplier]),a=[],i=0;i<this.rank;++i)a.push(1);a.push(n*this.depthMultiplier,this.filters);this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",a,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,!0,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.inputSpec=[new Yy({ndim:this.rank+2,axes:Object(l.a)({},t,n)})],this.built=!0}},{key:"call",value:function(e,t){var n=this;return zs((function(){var t;if(e=Uy(e),1===n.rank)throw new sg("1D separable convolution is not implemented yet.");return 2===n.rank&&("channelsFirst"===n.dataFormat&&(e=Bp(e,[0,2,3,1])),t=Yd(e,n.depthwiseKernel.read(),n.pointwiseKernel.read(),n.strides,n.padding,n.dilationRate,"NHWC")),n.useBias&&(t=hy(t,n.bias.read(),n.dataFormat)),null!=n.activation&&(t=n.activation.apply(t)),"channelsFirst"===n.dataFormat&&(t=Bp(t,[0,3,1,2])),t}))}},{key:"getConfig",value:function(){var e=Object(d.a)(Object(p.a)(n.prototype),"getConfig",this).call(this);return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=Ly(this.depthwiseInitializer),e.pointwiseInitializer=Ly(this.pointwiseInitializer),e.depthwiseRegularizer=Vw(this.depthwiseRegularizer),e.pointwiseRegularizer=Vw(this.pointwiseRegularizer),e.depthwiseConstraint=gx(this.depthwiseConstraint),e.pointwiseConstraint=gx(this.pointwiseConstraint),e}}]),n}(iO);lO.className="SeparableConv";var dO=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){return Object(O.a)(this,n),t.call(this,2,e)}return n}(lO);dO.className="SeparableConv2D",gh.registerClass(dO);var pO=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(O.a)(this,n),r=t.call(this,1,e),n.verifyArgs(e),r.inputSpec=[{ndim:3}],r}return Object(I.a)(n,[{key:"getConfig",value:function(){var e=Object(d.a)(Object(p.a)(n.prototype),"getConfig",this).call(this);return delete e.rank,delete e.dataFormat,e}}],[{key:"verifyArgs",value:function(e){if("number"!=typeof e.kernelSize&&!Sg(e.kernelSize,"number",1,1))throw new og("Conv1D expects config.kernelSize to be number or number[] with length 1, but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(iO);pO.className="Conv1D",gh.registerClass(pO);var fO=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(O.a)(this,n),r=t.call(this,e),"number"==typeof e.cropping?r.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:"number"==typeof e.cropping[0]?r.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:r.cropping=e.cropping,r.dataFormat=void 0===e.dataFormat?"channelsLast":e.dataFormat,r.inputSpec=[{ndim:4}],r}return Object(I.a)(n,[{key:"computeOutputShape",value:function(e){return"channelsFirst"===this.dataFormat?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}},{key:"call",value:function(e,t){var n=this;return zs((function(){if(e=Uy(e),"channelsLast"===n.dataFormat){var t=iy(e,n.cropping[0][0],e.shape[1]-n.cropping[0][0]-n.cropping[0][1],2);return iy(t,n.cropping[1][0],e.shape[2]-n.cropping[1][1]-n.cropping[1][0],3)}var r=iy(e,n.cropping[0][0],e.shape[2]-n.cropping[0][0]-n.cropping[0][1],3);return iy(r,n.cropping[1][0],e.shape[3]-n.cropping[1][1]-n.cropping[1][0],4)}))}},{key:"getConfig",value:function(){var e={cropping:this.cropping,dataFormat:this.dataFormat},t=Object(d.a)(Object(p.a)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(ex);fO.className="Cropping2D",gh.registerClass(fO);var hO=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(O.a)(this,n),(r=t.call(this,e)).DEFAULT_SIZE=[2,2],r.inputSpec=[{ndim:4}],r.size=null==e.size?r.DEFAULT_SIZE:e.size,r.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,Lg(r.dataFormat),r.interpolation=null==e.interpolation?"nearest":e.interpolation,function(e){Ig(Rg,"InterpolationFormat",e)}(r.interpolation),r}return Object(I.a)(n,[{key:"computeOutputShape",value:function(e){if("channelsFirst"===this.dataFormat){var t=null==e[2]?null:this.size[0]*e[2],n=null==e[3]?null:this.size[1]*e[3];return[e[0],e[1],t,n]}var r=null==e[1]?null:this.size[0]*e[1],a=null==e[2]?null:this.size[1]*e[2];return[e[0],r,a,e[3]]}},{key:"call",value:function(e,t){var n=this;return zs((function(){var t=Uy(e),r=t.shape;if("channelsFirst"===n.dataFormat){t=Bp(t,[0,2,3,1]);var a=n.size[0]*r[2],i=n.size[1]*r[3],o="nearest"===n.interpolation?fh.resizeNearestNeighbor(t,[a,i]):fh.resizeBilinear(t,[a,i]);return Bp(o,[0,3,1,2])}var s=n.size[0]*r[1],u=n.size[1]*r[2];return"nearest"===n.interpolation?fh.resizeNearestNeighbor(t,[s,u]):fh.resizeBilinear(t,[s,u])}))}},{key:"getConfig",value:function(){var e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},t=Object(d.a)(Object(p.a)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(ex);hO.className="UpSampling2D",gh.registerClass(hO);var mO=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(O.a)(this,n),(r=t.call(this,2,e)).depthwiseKernel=null,r.depthMultiplier=null==e.depthMultiplier?1:e.depthMultiplier,r.depthwiseInitializer=Py(e.depthwiseInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.depthwiseConstraint=xx(e.depthwiseConstraint),r.depthwiseRegularizer=Hw(e.depthwiseRegularizer),r}return Object(I.a)(n,[{key:"build",value:function(e){if((e=Vy(e)).length<4)throw new og("Inputs to DepthwiseConv2D should have rank 4. Received input shape: ".concat(JSON.stringify(e),"."));var t="channelsFirst"===this.dataFormat?1:3;if(null==e[t]||e[t]<0)throw new og("The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (".concat(e[t],")."));var n=e[t],r=[this.kernelSize[0],this.kernelSize[1],n,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[n*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}},{key:"call",value:function(e,t){var n=this;return zs((function(){var t=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[1,1],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"valid",a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0;return zs((function(){null==a&&(a="channelsLast"),Lg(a);var o=tO(e,a);if(4!==e.rank)throw new og("Input for depthwiseConv2d is required to be 4-D, but is instead ".concat(e.rank,"-D"));if(4!==t.rank)throw new og("depthwiseKernel is required to be 4-D, but is instead ".concat(t.rank,"-D"));return o=mc(o,t,n,"same"===r?"same":"valid","NHWC",i),"channelsFirst"===a&&(o=Bp(o,[0,3,1,2])),o}))}(e=Uy(e),n.depthwiseKernel.read(),n.strides,n.padding,n.dataFormat,null);return n.useBias&&(t=hy(t,n.bias.read(),n.dataFormat)),null!=n.activation&&(t=n.activation.apply(t)),t}))}},{key:"computeOutputShape",value:function(e){e=Vy(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],r="channelsFirst"===this.dataFormat?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,a=$w(t,this.kernelSize[0],this.padding,this.strides[0]),i=$w(n,this.kernelSize[1],this.padding,this.strides[1]);return"channelsFirst"===this.dataFormat?[e[0],r,a,i]:[e[0],a,i,r]}},{key:"getConfig",value:function(){var e=Object(d.a)(Object(p.a)(n.prototype),"getConfig",this).call(this);return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=Ly(this.depthwiseInitializer),e.depthwiseRegularizer=Vw(this.depthwiseRegularizer),e.depthwiseConstraint=gx(this.depthwiseRegularizer),e}}]),n}(aO);function vO(e,t,n,r){if(Array.isArray(e)){if(null!=t||null!=n)throw new og("When inputs is an array, neither initialState or constants should be provided");null!=r&&(n=e.slice(e.length-r,e.length),e=e.slice(0,e.length-r)),e.length>1&&(t=e.slice(1,e.length)),e=e[0]}function a(e){return null==e||Array.isArray(e)?e:[e]}return{inputs:e,initialState:t=a(t),constants:n=a(n)}}function bO(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]&&arguments[7];return zs((function(){var u=t.shape.length;if(u<3)throw new og("Input should be at least 3D, but is ".concat(u,"D."));var c=[1,0].concat(Qg(2,u));if(t=Bp(t,c),null!=i)throw new sg("The rnn() functoin of the deeplearn.js backend does not support constants yet.");o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),null!=a&&((a=Ns(Ns(a,"bool"),"float32")).rank===u-1&&(a=Zc(a,-1)),a=Bp(a,c)),r&&(t=Wd(t,0),null!=a&&(a=Wd(a,0)));var l,d,p=[],f=n,h=t.shape[0],m=Ap(t);null!=a&&(d=Ap(a));for(var v,b=function(t){var n=m[t],r=zs((function(){return e(n,f)}));if(null==a)l=r[0],f=r[1];else{var i=zs((function(){var e=d[t],n=Sl(Jl(e),e);return{output:Zs($s(r[0],e),$s(f[0],n)),newStates:f.map((function(t,a){return Zs($s(r[1][a],e),$s(t,n))}))}}));l=i.output,f=i.newStates}s&&p.push(l)},g=0;g<h;++g)b(g);return s&&(v=fp(p,1)),[l,v,f]}))}mO.className="DepthwiseConv2D",gh.registerClass(mO);var gO=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r,a;if(Object(O.a)(this,n),r=t.call(this,e),null==e.cell)throw new og("cell property is missing for the constructor of RNN.");if(null==(a=Array.isArray(e.cell)?new NO({cells:e.cell}):e.cell).stateSize)throw new og("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");return r.cell=a,r.returnSequences=null!=e.returnSequences&&e.returnSequences,r.returnState=null!=e.returnState&&e.returnState,r.goBackwards=null!=e.goBackwards&&e.goBackwards,r._stateful=null!=e.stateful&&e.stateful,r.unroll=null!=e.unroll&&e.unroll,r.supportsMasking=!0,r.inputSpec=[new Yy({ndim:3})],r.stateSpec=null,r.states_=null,r.numConstants=null,r.keptStates=[],r}return Object(I.a)(n,[{key:"getStates",value:function(){return null==this.states_?Qg(0,Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1).map((function(e){return null})):this.states_}},{key:"setStates",value:function(e){this.states_=e}},{key:"computeOutputShape",value:function(e){By(e)&&(e=e[0]),e=e;var t=this.cell.stateSize;Array.isArray(t)||(t=[t]);var n,r=t[0];if(n=this.returnSequences?[e[0],e[1],r]:[e[0],r],this.returnState){var a,i=[],o=Object(N.a)(t);try{for(o.s();!(a=o.n()).done;){var s=a.value;i.push([e[0],s])}}catch(u){o.e(u)}finally{o.f()}return[n].concat(i)}return n}},{key:"computeMask",value:function(e,t){var n=this;return zs((function(){Array.isArray(t)&&(t=t[0]);var e=n.returnSequences?t:null;if(n.returnState){var r=n.states.map((function(e){return null}));return[e].concat(r)}return e}))}},{key:"build",value:function(e){if(null!=this.numConstants)throw new sg("Constants support is not implemented in RNN yet.");By(e)&&(e=e[0]),e=e;var t=this.stateful?e[0]:null,n=e.slice(2);this.inputSpec[0]=new Yy({shape:[t,null].concat(Object(S.a)(n))});var r,a=[e[0]].concat(e.slice(2));if(this.cell.build(a),r=Array.isArray(this.cell.stateSize)?this.cell.stateSize:[this.cell.stateSize],null!=this.stateSpec){if(!Ga.arraysEqual(this.stateSpec.map((function(e){return e.shape[e.shape.length-1]})),r))throw new og("An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=".concat(this.stateSpec,"; However cell.stateSize is ").concat(this.cell.stateSize))}else this.stateSpec=r.map((function(e){return new Yy({shape:[null,e]})}));this.stateful&&this.resetStates()}},{key:"resetStates",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];zs((function(){if(!t.stateful)throw new ag("Cannot call resetStates() on an RNN Layer that is not stateful.");var r=t.inputSpec[0].shape[0];if(null==r)throw new og("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==t.states_)Array.isArray(t.cell.stateSize)?t.states_=t.cell.stateSize.map((function(e){return Bl([r,e])})):t.states_=[Bl([r,t.cell.stateSize])];else if(null==e)Ls(t.states_),null!=t.keptStates&&(Ls(t.keptStates),t.keptStates=[]),Array.isArray(t.cell.stateSize)?t.states_=t.cell.stateSize.map((function(e){return Bl([r,e])})):t.states_[0]=Bl([r,t.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==t.states_.length)throw new og("Layer ".concat(t.name," expects ").concat(t.states_.length," state(s), but it received ").concat(e.length," state value(s). Input received: ").concat(e));!0===n?t.keptStates.push(t.states_.slice()):Ls(t.states_);for(var a=0;a<t.states_.length;++a){var i=e[a],o=Array.isArray(t.cell.stateSize)?t.cell.stateSize[a]:t.cell.stateSize,s=[r,o];if(!Ga.arraysEqual(i.shape,s))throw new og("State ".concat(a," is incompatible with layer ").concat(t.name,": expected shape=").concat(s,", received shape=").concat(i.shape));t.states_[a]=i}}t.states_=t.states_.map((function(e){return Ps(e.clone())}))}))}},{key:"apply",value:function(e,t){var r=null==t?null:t.initialState,a=null==t?null:t.constants;null==t&&(t={});var i=vO(e,r,a,this.numConstants);e=i.inputs,r=i.initialState,a=i.constants;var o=[],s=[];if(null!=r){t.initialState=r,o=o.concat(r),this.stateSpec=[];var u,c=Object(N.a)(r);try{for(c.s();!(u=c.n()).done;){var l=u.value;this.stateSpec.push(new Yy({shape:l.shape}))}}catch(b){c.e(b)}finally{c.f()}s=s.concat(this.stateSpec)}if(null!=a&&(t.constants=a,o=o.concat(a),this.numConstants=a.length),o[0]instanceof Zy){var f=[e].concat(o),h=this.inputSpec.concat(s),m=this.inputSpec;this.inputSpec=h;var v=Object(d.a)(Object(p.a)(n.prototype),"apply",this).call(this,f,t);return this.inputSpec=m,v}return Object(d.a)(Object(p.a)(n.prototype),"apply",this).call(this,e,t)}},{key:"call",value:function(e,t){var n=this;return zs((function(){var r=null==t?null:t.mask,a=null==t?null:t.training,i=null==t?null:t.initialState;e=Uy(e),null==i&&(i=n.stateful?n.states_:n.getInitialState(e));var o=Array.isArray(n.cell.stateSize)?n.cell.stateSize.length:1;if(i.length!==o)throw new og("RNN Layer has ".concat(o," state(s) but was passed ").concat(i.length," initial state(s)."));n.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");var s={training:a},u=bO((function(e,t){var r=n.cell.call([e].concat(t),s);return[r[0],r.slice(1)]}),e,i,n.goBackwards,r,null,n.unroll,n.returnSequences),c=u[0],l=u[1],d=u[2];n.stateful&&n.resetStates(d,a);var p=n.returnSequences?l:c;return n.returnState?[p].concat(d):p}))}},{key:"getInitialState",value:function(e){var t=this;return zs((function(){var n=Bl(e.shape);return n=ty(n=Hc(n,[1,2])),Array.isArray(t.cell.stateSize)?t.cell.stateSize.map((function(e){return e>1?uy(n,[1,e]):n})):t.cell.stateSize>1?[uy(n,[1,t.cell.stateSize])]:[n]}))}},{key:"setFastWeightInitDuringBuild",value:function(e){Object(d.a)(Object(p.a)(n.prototype),"setFastWeightInitDuringBuild",this).call(this,e),null!=this.cell&&this.cell.setFastWeightInitDuringBuild(e)}},{key:"getConfig",value:function(){var e=Object(d.a)(Object(p.a)(n.prototype),"getConfig",this).call(this),t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};null!=this.numConstants&&(t.numConstants=this.numConstants);var r=this.cell.getConfig();return this.getClassName()===n.className&&(t.cell={className:this.cell.getClassName(),config:r}),Object.assign(Object.assign(Object.assign({},r),e),t)}},{key:"states",get:function(){if(null==this.states_){for(var e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,t=[],n=0;n<e;++n)t.push(null);return t}return this.states_},set:function(e){this.states_=e}},{key:"trainableWeights",get:function(){return this.trainable?this.cell.trainableWeights:[]}},{key:"nonTrainableWeights",get:function(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}}],[{key:"fromConfig",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=t.cell,a=ek(r,n);return new e(Object.assign(t,{cell:a}))}}]),n}(ex);gO.className="RNN",gh.registerClass(gO);var yO=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){return Object(O.a)(this,n),t.apply(this,arguments)}return n}(ex),xO=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(O.a)(this,n),(r=t.call(this,e)).DEFAULT_ACTIVATION="tanh",r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_RECURRENT_INITIALIZER="orthogonal",r.DEFAULT_BIAS_INITIALIZER="zeros",r.units=e.units,Ng(r.units,"units"),r.activation=Lw(null==e.activation?r.DEFAULT_ACTIVATION:e.activation),r.useBias=null==e.useBias||e.useBias,r.kernelInitializer=Py(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.recurrentInitializer=Py(e.recurrentInitializer||r.DEFAULT_RECURRENT_INITIALIZER),r.biasInitializer=Py(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.kernelRegularizer=Hw(e.kernelRegularizer),r.recurrentRegularizer=Hw(e.recurrentRegularizer),r.biasRegularizer=Hw(e.biasRegularizer),r.kernelConstraint=xx(e.kernelConstraint),r.recurrentConstraint=xx(e.recurrentConstraint),r.biasConstraint=xx(e.biasConstraint),r.dropout=Zg([1,Jg([0,null==e.dropout?0:e.dropout])]),r.recurrentDropout=Zg([1,Jg([0,null==e.recurrentDropout?0:e.recurrentDropout])]),r.dropoutFunc=e.dropoutFunc,r.stateSize=r.units,r.dropoutMask=null,r.recurrentDropoutMask=null,r}return Object(I.a)(n,[{key:"build",value:function(e){e=Vy(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}},{key:"call",value:function(e,t){var n=this;return zs((function(){if(2!==(e=e).length)throw new og("SimpleRNNCell expects 2 input Tensors, got ".concat(e.length,"."));var r=e[1];e=e[0];var a=null!=t.training&&t.training;0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=jO({ones:function(){return Jl(e)},rate:n.dropout,training:a,dropoutFunc:n.dropoutFunc})),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=jO({ones:function(){return Jl(r)},rate:n.recurrentDropout,training:a,dropoutFunc:n.dropoutFunc}));var i,o=n.dropoutMask,s=n.recurrentDropoutMask;i=ly(null!=o?$s(e,o):e,n.kernel.read()),null!=n.bias&&(i=hy(i,n.bias.read())),null!=s&&(r=$s(r,s));var u=Zs(i,ly(r,n.recurrentKernel.read()));return null!=n.activation&&(u=n.activation.apply(u)),[u,u]}))}},{key:"getConfig",value:function(){var e=Object(d.a)(Object(p.a)(n.prototype),"getConfig",this).call(this),t={units:this.units,activation:Mw(this.activation),useBias:this.useBias,kernelInitializer:Ly(this.kernelInitializer),recurrentInitializer:Ly(this.recurrentInitializer),biasInitializer:Ly(this.biasInitializer),kernelRegularizer:Vw(this.kernelRegularizer),recurrentRegularizer:Vw(this.recurrentRegularizer),biasRegularizer:Vw(this.biasRegularizer),activityRegularizer:Vw(this.activityRegularizer),kernelConstraint:gx(this.kernelConstraint),recurrentConstraint:gx(this.recurrentConstraint),biasConstraint:gx(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},e),t)}}]),n}(yO);xO.className="SimpleRNNCell",gh.registerClass(xO);var kO=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){return Object(O.a)(this,n),e.cell=new xO(e),t.call(this,e)}return Object(I.a)(n,[{key:"call",value:function(e,t){var r=this;return zs((function(){null!=r.cell.dropoutMask&&(Ls(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(Ls(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null);var a=null==t?null:t.mask,i=null==t?null:t.training,o=null==t?null:t.initialState;return Object(d.a)(Object(p.a)(n.prototype),"call",r).call(r,e,{mask:a,training:i,initialState:o})}))}}],[{key:"fromConfig",value:function(e,t){return new e(t)}}]),n}(gO);kO.className="SimpleRNN",gh.registerClass(kO);var wO=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;if(Object(O.a)(this,n),(r=t.call(this,e)).DEFAULT_ACTIVATION="tanh",r.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_RECURRENT_INITIALIZER="orthogonal",r.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new og("GRUCell does not support reset_after parameter set to true.");return r.units=e.units,Ng(r.units,"units"),r.activation=Lw(void 0===e.activation?r.DEFAULT_ACTIVATION:e.activation),r.recurrentActivation=Lw(void 0===e.recurrentActivation?r.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),r.useBias=null==e.useBias||e.useBias,r.kernelInitializer=Py(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.recurrentInitializer=Py(e.recurrentInitializer||r.DEFAULT_RECURRENT_INITIALIZER),r.biasInitializer=Py(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.kernelRegularizer=Hw(e.kernelRegularizer),r.recurrentRegularizer=Hw(e.recurrentRegularizer),r.biasRegularizer=Hw(e.biasRegularizer),r.kernelConstraint=xx(e.kernelConstraint),r.recurrentConstraint=xx(e.recurrentConstraint),r.biasConstraint=xx(e.biasConstraint),r.dropout=Zg([1,Jg([0,null==e.dropout?0:e.dropout])]),r.recurrentDropout=Zg([1,Jg([0,null==e.recurrentDropout?0:e.recurrentDropout])]),r.dropoutFunc=e.dropoutFunc,r.implementation=e.implementation,r.stateSize=r.units,r.dropoutMask=null,r.recurrentDropoutMask=null,Object(m.a)(r)}return Object(I.a)(n,[{key:"build",value:function(e){var t=(e=Vy(e))[e.length-1];this.kernel=this.addWeight("kernel",[t,3*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,3*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[3*this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}},{key:"call",value:function(e,t){var n=this;return zs((function(){if(2!==(e=e).length)throw new og("GRUCell expects 2 input Tensors (inputs, h, c), got ".concat(e.length,"."));var r=null!=t.training&&t.training,a=e[1];e=e[0],0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=jO({ones:function(){return Jl(e)},rate:n.dropout,training:r,count:3,dropoutFunc:n.dropoutFunc})),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=jO({ones:function(){return Jl(a)},rate:n.recurrentDropout,training:r,count:3,dropoutFunc:n.dropoutFunc}));var i,o,s,u=n.dropoutMask,c=n.recurrentDropoutMask;0<n.dropout&&n.dropout<1&&(e=$s(e,u[0]));var l=ly(e,n.kernel.read());n.useBias&&(l=hy(l,n.bias.read())),0<n.recurrentDropout&&n.recurrentDropout<1&&(a=$s(a,c[0]));var d=n.recurrentKernel.read(),p=cp(d,[2*n.units,n.units],d.rank-1),f=Object(y.a)(p,2),h=f[0],m=f[1],v=ly(a,h),b=cp(l,3,l.rank-1),g=Object(y.a)(b,3),x=g[0],k=g[1],w=g[2],O=cp(v,2,v.rank-1),I=Object(y.a)(O,2),S=I[0],N=I[1];i=n.recurrentActivation.apply(Zs(x,S)),o=n.recurrentActivation.apply(Zs(k,N));var j=ly($s(o,a),m);s=n.activation.apply(Zs(w,j));var T=Zs($s(i,a),$s(Zs(1,wl(i)),s));return[T,T]}))}},{key:"getConfig",value:function(){var e=Object(d.a)(Object(p.a)(n.prototype),"getConfig",this).call(this),t={units:this.units,activation:Mw(this.activation),recurrentActivation:Mw(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Ly(this.kernelInitializer),recurrentInitializer:Ly(this.recurrentInitializer),biasInitializer:Ly(this.biasInitializer),kernelRegularizer:Vw(this.kernelRegularizer),recurrentRegularizer:Vw(this.recurrentRegularizer),biasRegularizer:Vw(this.biasRegularizer),activityRegularizer:Vw(this.activityRegularizer),kernelConstraint:gx(this.kernelConstraint),recurrentConstraint:gx(this.recurrentConstraint),biasConstraint:gx(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},e),t)}}]),n}(yO);wO.className="GRUCell",gh.registerClass(wO);var OO=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){return Object(O.a)(this,n),0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new wO(e),t.call(this,e)}return Object(I.a)(n,[{key:"call",value:function(e,t){var r=this;return zs((function(){null!=r.cell.dropoutMask&&(Ls(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(Ls(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null);var a=null==t?null:t.mask,i=null==t?null:t.training,o=null==t?null:t.initialState;return Object(d.a)(Object(p.a)(n.prototype),"call",r).call(r,e,{mask:a,training:i,initialState:o})}))}}],[{key:"fromConfig",value:function(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)}}]),n}(gO);OO.className="GRU",gh.registerClass(OO);var IO=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(O.a)(this,n),(r=t.call(this,e)).DEFAULT_ACTIVATION="tanh",r.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_RECURRENT_INITIALIZER="orthogonal",r.DEFAULT_BIAS_INITIALIZER="zeros",r.units=e.units,Ng(r.units,"units"),r.activation=Lw(void 0===e.activation?r.DEFAULT_ACTIVATION:e.activation),r.recurrentActivation=Lw(void 0===e.recurrentActivation?r.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),r.useBias=null==e.useBias||e.useBias,r.kernelInitializer=Py(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.recurrentInitializer=Py(e.recurrentInitializer||r.DEFAULT_RECURRENT_INITIALIZER),r.biasInitializer=Py(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.unitForgetBias=e.unitForgetBias,r.kernelRegularizer=Hw(e.kernelRegularizer),r.recurrentRegularizer=Hw(e.recurrentRegularizer),r.biasRegularizer=Hw(e.biasRegularizer),r.kernelConstraint=xx(e.kernelConstraint),r.recurrentConstraint=xx(e.recurrentConstraint),r.biasConstraint=xx(e.biasConstraint),r.dropout=Zg([1,Jg([0,null==e.dropout?0:e.dropout])]),r.recurrentDropout=Zg([1,Jg([0,null==e.recurrentDropout?0:e.recurrentDropout])]),r.dropoutFunc=e.dropoutFunc,r.implementation=e.implementation,r.stateSize=[r.units,r.units],r.dropoutMask=null,r.recurrentDropoutMask=null,r}return Object(I.a)(n,[{key:"build",value:function(e){var t,n,r=(e=Vy(e))[e.length-1];if(this.kernel=this.addWeight("kernel",[r,4*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,4*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){if(this.unitForgetBias){var a=this.biasInitializer,i=this.units;n=new((t=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){return Object(O.a)(this,n),t.apply(this,arguments)}return Object(I.a)(n,[{key:"apply",value:function(e,t){var n=a.apply([i]),r=(new wy).apply([i]),o=a.apply([2*i]);return sy(sy(n,r),o)}}]),n}(xy)).className="CustomInit",t)}else n=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.units],null,n,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}},{key:"call",value:function(e,t){var n=this;return zs((function(){var r=null!=t.training&&t.training;if(3!==(e=e).length)throw new og("LSTMCell expects 3 input Tensors (inputs, h, c), got ".concat(e.length,"."));var a=e[1],i=e[2];e=e[0],0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=jO({ones:function(){return Jl(e)},rate:n.dropout,training:r,count:4,dropoutFunc:n.dropoutFunc})),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=jO({ones:function(){return Jl(a)},rate:n.recurrentDropout,training:r,count:4,dropoutFunc:n.dropoutFunc}));var o,s,u,c,l=n.dropoutMask,d=n.recurrentDropoutMask;0<n.dropout&&n.dropout<1&&(e=$s(e,l[0]));var p=ly(e,n.kernel.read());0<n.recurrentDropout&&n.recurrentDropout<1&&(a=$s(a,d[0])),p=Zs(p,ly(a,n.recurrentKernel.read())),n.useBias&&(p=hy(p,n.bias.read()));var f=cp(p,4,p.rank-1),h=Object(y.a)(f,4),m=h[0],v=h[1],b=h[2],g=h[3];o=n.recurrentActivation.apply(m),s=n.recurrentActivation.apply(v),u=Zs($s(s,i),$s(o,n.activation.apply(b))),c=n.recurrentActivation.apply(g);var x=$s(c,n.activation.apply(u));return[x,x,u]}))}},{key:"getConfig",value:function(){var e=Object(d.a)(Object(p.a)(n.prototype),"getConfig",this).call(this),t={units:this.units,activation:Mw(this.activation),recurrentActivation:Mw(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Ly(this.kernelInitializer),recurrentInitializer:Ly(this.recurrentInitializer),biasInitializer:Ly(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:Vw(this.kernelRegularizer),recurrentRegularizer:Vw(this.recurrentRegularizer),biasRegularizer:Vw(this.biasRegularizer),activityRegularizer:Vw(this.activityRegularizer),kernelConstraint:gx(this.kernelConstraint),recurrentConstraint:gx(this.recurrentConstraint),biasConstraint:gx(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},e),t)}}]),n}(yO);IO.className="LSTMCell",gh.registerClass(IO);var SO=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){return Object(O.a)(this,n),0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new IO(e),t.call(this,e)}return Object(I.a)(n,[{key:"call",value:function(e,t){var r=this;return zs((function(){null!=r.cell.dropoutMask&&(Ls(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(Ls(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null);var a=null==t?null:t.mask,i=null==t?null:t.training,o=null==t?null:t.initialState;return Object(d.a)(Object(p.a)(n.prototype),"call",r).call(r,e,{mask:a,training:i,initialState:o})}))}}],[{key:"fromConfig",value:function(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)}}]),n}(gO);SO.className="LSTM",gh.registerClass(SO);var NO=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(O.a)(this,n),(r=t.call(this,e)).cells=e.cells,r}return Object(I.a)(n,[{key:"call",value:function(e,t){var n=this;return zs((function(){var r,a=(e=e).slice(1),i=[],o=Object(N.a)(n.cells.slice().reverse());try{for(o.s();!(r=o.n()).done;){var s=r.value;Array.isArray(s.stateSize)?i.push(a.splice(0,s.stateSize.length)):i.push(a.splice(0,1))}}catch(v){o.e(v)}finally{o.f()}i.reverse();for(var u,c=[],l=0;l<n.cells.length;++l){var d=n.cells[l];a=i[l],u=0===l?[e[0]].concat(a):[u[0]].concat(a),u=d.call(u,t),c.push(u.slice(1))}a=[];var p,f=Object(N.a)(c.slice().reverse());try{for(f.s();!(p=f.n()).done;){var h,m=p.value;(h=a).push.apply(h,Object(S.a)(m))}}catch(v){f.e(v)}finally{f.f()}return[u[0]].concat(a)}))}},{key:"build",value:function(e){var t;By(e)&&(e=e[0]),e=e,this.cells.forEach((function(n,r){Ug("RNNCell_".concat(r),(function(){n.build(e),t=Array.isArray(n.stateSize)?n.stateSize[0]:n.stateSize,e=[e[0],t]}))})),this.built=!0}},{key:"getConfig",value:function(){var e=Object(d.a)(Object(p.a)(n.prototype),"getConfig",this).call(this),t={cells:this.cells.map((function(e){return{className:e.getClassName(),config:e.getConfig()}}))};return Object.assign(Object.assign({},e),t)}},{key:"getWeights",value:function(){var e,t=[],n=Object(N.a)(this.cells);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,Object(S.a)(r.weights))}}catch(a){n.e(a)}finally{n.f()}return Ky(t)}},{key:"setWeights",value:function(e){var t,n=[],r=Object(N.a)(this.cells);try{for(r.s();!(t=r.n()).done;)for(var a=t.value,i=a.weights.length,o=e.splice(i),s=0;s<a.weights.length;++s)n.push([a.weights[s],o[s]])}catch(u){r.e(u)}finally{r.f()}Xy(n)}},{key:"stateSize",get:function(){var e,t=[],n=Object(N.a)(this.cells.slice().reverse());try{for(n.s();!(e=n.n()).done;){var r=e.value;Array.isArray(r.stateSize)?t.push.apply(t,Object(S.a)(r.stateSize)):t.push(r.stateSize)}}catch(a){n.e(a)}finally{n.f()}return t}},{key:"trainableWeights",get:function(){if(!this.trainable)return[];var e,t=[],n=Object(N.a)(this.cells);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,Object(S.a)(r.trainableWeights))}}catch(a){n.e(a)}finally{n.f()}return t}},{key:"nonTrainableWeights",get:function(){var e,t=[],n=Object(N.a)(this.cells);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,Object(S.a)(r.nonTrainableWeights))}}catch(u){n.e(u)}finally{n.f()}if(!this.trainable){var a,i=[],o=Object(N.a)(this.cells);try{for(o.s();!(a=o.n()).done;){var s=a.value;i.push.apply(i,Object(S.a)(s.trainableWeights))}}catch(u){o.e(u)}finally{o.f()}return i.concat(t)}return t}}],[{key:"fromConfig",value:function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=[],i=Object(N.a)(t.cells);try{for(i.s();!(n=i.n()).done;){var o=n.value;a.push(ek(o,r))}}catch(s){i.e(s)}finally{i.f()}return new e({cells:a})}}]),n}(yO);function jO(e){var t=e.ones,n=e.rate,r=e.training,a=void 0!==r&&r,i=e.count,o=void 0===i?1:i,s=e.dropoutFunc,u=function(){return null!=s?s(t(),n):vy(t(),n)},c=function(){return by(u,t,a)};return!o||o<=1?Ps(c().clone()):Array(o).fill(void 0).map(c).map((function(e){return Ps(e.clone())}))}NO.className="StackedRNNCells",gh.registerClass(NO);var TO=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;if(Object(O.a)(this,n),e.unroll)throw new sg("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new sg("It is not possible at the moment to stack convolutional cells.");return(r=t.call(this,e)).inputSpec=[new Yy({ndim:5})],r}return Object(I.a)(n,[{key:"call",value:function(e,t){var r=this;return zs((function(){if(null!=r.cell.dropoutMask&&(Ls(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(Ls(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null),t&&t.constants)throw new og("ConvRNN2D cell does not support constants");var a=null==t?null:t.mask,i=null==t?null:t.training,o=null==t?null:t.initialState;return Object(d.a)(Object(p.a)(n.prototype),"call",r).call(r,e,{mask:a,training:i,initialState:o})}))}},{key:"computeOutputShape",value:function(e){var t=this.computeSingleOutputShape(e);return this.returnSequences||(t=[t[0]].concat(Object(S.a)(t.slice(2)))),this.returnState&&(t=[t].concat(Object(S.a)(Array(2).fill([e[0]].concat(Object(S.a)(t.slice(-3))))))),t}},{key:"getInitialState",value:function(e){var t=this;return zs((function(){var n=t.cell.stateSize,r=e.shape,a=t.computeSingleOutputShape(r),i=Bl([a[0]].concat(Object(S.a)(a.slice(2))));return Array.isArray(n)?Array(n.length).fill(i):[i]}))}},{key:"resetStates",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];zs((function(){if(!t.stateful)throw new ag("Cannot call resetStates() on an RNN Layer that is not stateful.");var r=t.inputSpec[0].shape,a=t.computeSingleOutputShape(r),i=[a[0]].concat(Object(S.a)(a.slice(2)));if(null==r[0])throw new og("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==t.getStates())Array.isArray(t.cell.stateSize)?t.states_=t.cell.stateSize.map((function(){return Bl(i)})):t.states_=[Bl(i)];else if(null==e)Ls(t.states_),null!=t.keptStates&&(Ls(t.keptStates),t.keptStates=[]),Array.isArray(t.cell.stateSize)?t.states_=t.cell.stateSize.map((function(){return Bl(i)})):t.states_[0]=Bl(i);else{if(Array.isArray(e)||(e=[e]),e.length!==t.states_.length)throw new og("Layer ".concat(t.name," expects ").concat(t.states_.length," state(s), but it received ").concat(e.length," state value(s). Input received: ").concat(e));n?t.keptStates.push(t.states_.slice()):Ls(t.states_);for(var o=0;o<t.states_.length;++o){var s=e[o],u=i;if(!Ga.arraysEqual(s.shape,u))throw new og("State ".concat(o," is incompatible with layer ").concat(t.name,": expected shape=").concat(u,", received shape=").concat(s.shape));t.states_[o]=s}}t.states_=t.states_.map((function(e){return Ps(e.clone())}))}))}},{key:"computeSingleOutputShape",value:function(e){var t=this.cell,n=t.dataFormat,r=t.filters,a=t.kernelSize,i=t.padding,o=t.strides,s=t.dilationRate,u="channelsFirst"===n,c=e[u?3:2],l=e[u?4:3],d=$w(c,a[0],i,o[0],s[0]),p=$w(l,a[1],i,o[1],s[1]);return[].concat(Object(S.a)(e.slice(0,2)),Object(S.a)(u?[r,d,p]:[d,p,r]))}}]),n}(gO);TO.className="ConvRNN2D";var CO=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;Object(O.a)(this,n);var a=e.filters,i=e.kernelSize,o=e.strides,s=e.padding,u=e.dataFormat,c=e.dilationRate;return(r=t.call(this,Object.assign(Object.assign({},e),{units:a}))).filters=a,Ng(r.filters,"filters"),r.kernelSize=Qw(i,2,"kernelSize"),r.kernelSize.forEach((function(e){return Ng(e,"kernelSize")})),r.strides=Qw(o||1,2,"strides"),r.strides.forEach((function(e){return Ng(e,"strides")})),r.padding=s||"valid",Pg(r.padding),r.dataFormat=u||"channelsLast",Lg(r.dataFormat),r.dilationRate=Qw(c||1,2,"dilationRate"),r.dilationRate.forEach((function(e){return Ng(e,"dilationRate")})),r}return Object(I.a)(n,[{key:"build",value:function(e){var t;e=Vy(e);var n="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[n])throw new og("The channel dimension of the input should be defined. Found ".concat(e[n]));var r=e[n],a=this.kernelSize.concat([r,4*this.filters]);this.kernel=this.addWeight("kernel",a,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);var i=this.kernelSize.concat([this.filters,4*this.filters]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",i,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){var o;if(this.unitForgetBias){var s=this.biasInitializer,u=this.filters;o=new((t=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){return Object(O.a)(this,n),t.apply(this,arguments)}return Object(I.a)(n,[{key:"apply",value:function(e,t){return oy([s.apply([u]),Wl([u]),s.apply([2*u])])}}]),n}(xy)).className="CustomInit",t)}else o=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.filters],null,o,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}},{key:"call",value:function(e,t){var n=this;return zs((function(){if(3!==e.length)throw new og("ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ".concat(e.length,"."));var r=t.training||!1,a=e[0],i=e[1],o=e[2];0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=jO({ones:function(){return Jl(a)},rate:n.dropout,training:r,count:4,dropoutFunc:n.dropoutFunc}));var s=n.dropoutMask,u=function(e,t,n){return t&&t[n]?$s(t[n],e):e},c=u(a,s,0),l=u(a,s,1),d=u(a,s,2),p=u(a,s,3);0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=jO({ones:function(){return Jl(i)},rate:n.recurrentDropout,training:r,count:4,dropoutFunc:n.dropoutFunc}));var f=n.recurrentDropoutMask,h=u(i,f,0),m=u(i,f,1),v=u(i,f,2),b=u(i,f,3),g=cp(n.kernel.read(),4,3),x=Object(y.a)(g,4),k=x[0],w=x[1],O=x[2],I=x[3],S=n.useBias?cp(n.bias.read(),4):[null,null,null,null],N=Object(y.a)(S,4),j=N[0],T=N[1],C=N[2],E=N[3];c=n.inputConv(c,k,j,n.padding),l=n.inputConv(l,w,T,n.padding),d=n.inputConv(d,O,C,n.padding),p=n.inputConv(p,I,E,n.padding);var _=cp(n.recurrentKernel.read(),4,3),A=Object(y.a)(_,4),R=A[0],D=A[1],F=A[2],M=A[3];h=n.recurrentConv(h,R),m=n.recurrentConv(m,D),v=n.recurrentConv(v,F),b=n.recurrentConv(b,M);var z=n.recurrentActivation.apply(Zs(c,h)),L=n.recurrentActivation.apply(Zs(l,m)),P=Zs($s(L,o),$s(z,n.activation.apply(Zs(d,v)))),B=$s(n.recurrentActivation.apply(Zs(p,b)),n.activation.apply(P));return[B,B,P]}))}},{key:"getConfig",value:function(){var e=Object(d.a)(Object(p.a)(n.prototype),"getConfig",this).call(this),t=(e.units,function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n}(e,["units"])),r={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},t),r)}},{key:"inputConv",value:function(e,t,n,r){var a=nc(e,t,this.strides,r||"valid","channelsFirst"===this.dataFormat?"NCHW":"NHWC",this.dilationRate);return n?hy(a,n,this.dataFormat):a}},{key:"recurrentConv",value:function(e,t){return nc(e,t,1,"same","channelsFirst"===this.dataFormat?"NCHW":"NHWC")}}]),n}(IO);CO.className="ConvLSTM2DCell",gh.registerClass(CO);var EO=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){Object(O.a)(this,n);var r=new CO(e);return t.call(this,Object.assign(Object.assign({},e),{cell:r}))}return Object(I.a)(n,null,[{key:"fromConfig",value:function(e,t){return new e(t)}}]),n}(TO);EO.className="ConvLSTM2D",gh.registerClass(EO);var _O=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(O.a)(this,n),(r=t.call(this,e)).rate=Math.max(Math.min(e.rate,1),0),r.noiseShape=e.noiseShape,r.seed=e.seed,r.supportsMasking=!0,r}return Object(I.a)(n,[{key:"getNoiseShape",value:function(e){if(null==this.noiseShape)return this.noiseShape;for(var t=e.shape,n=[],r=0;r<this.noiseShape.length;++r)n.push(null==this.noiseShape[r]?t[r]:this.noiseShape[r]);return n}},{key:"call",value:function(e,t){var n=this;return zs((function(){n.invokeCallHook(e,t);var r=Uy(e);if(0<n.rate&&n.rate<1){var a=null!=t.training&&t.training,i=n.getNoiseShape(r);return by((function(){return vy(r,n.rate,i,n.seed)}),(function(){return r}),a)}return e}))}},{key:"getConfig",value:function(){var e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},t=Object(d.a)(Object(p.a)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"dispose",value:function(){return Object(d.a)(Object(p.a)(n.prototype),"dispose",this).call(this)}}]),n}(ex);_O.className="Dropout",gh.registerClass(_O);var AO=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(O.a)(this,n),(r=t.call(this,e)).inputSpec=[{ndim:3}],r}return Object(I.a)(n,[{key:"getNoiseShape",value:function(e){var t=e.shape;return[t[0],1,t[2]]}}]),n}(_O);AO.className="SpatialDropout1D",gh.registerClass(AO);var RO=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;if(Object(O.a)(this,n),(r=t.call(this,e)).activation=null,r.useBias=!0,r.kernel=null,r.bias=null,r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_BIAS_INITIALIZER="zeros",null==e.batchInputShape&&null==e.inputShape&&null!=e.inputDim){var a=null;null!=e.batchSize&&(a=e.batchSize),r.batchInputShape=[a,e.inputDim]}return r.units=e.units,Ng(r.units,"units"),r.activation=Lw(e.activation),null!=e.useBias&&(r.useBias=e.useBias),r.kernelInitializer=Py(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.biasInitializer=Py(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.kernelConstraint=xx(e.kernelConstraint),r.biasConstraint=xx(e.biasConstraint),r.kernelRegularizer=Hw(e.kernelRegularizer),r.biasRegularizer=Hw(e.biasRegularizer),r.activityRegularizer=Hw(e.activityRegularizer),r.supportsMasking=!0,r.inputSpec=[{minNDim:2}],Object(m.a)(r)}return Object(I.a)(n,[{key:"build",value:function(e){var t=(e=Vy(e))[e.length-1];null==this.kernel&&(this.kernel=this.addWeight("kernel",[t,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:Object(l.a)({},-1,t)}],this.built=!0}},{key:"computeOutputShape",value:function(e){var t=(e=Vy(e)).slice();return t[t.length-1]=this.units,t}},{key:"call",value:function(e,t){var n=this;return zs((function(){n.invokeCallHook(e,t);var r,a=Uy(e),i=jg(n.activation.getClassName());return null!=i?r=ly(a,n.kernel.read(),i,n.bias?n.bias.read():null):(r=ly(a,n.kernel.read()),null!=n.bias&&(r=hy(r,n.bias.read())),null!=n.activation&&(r=n.activation.apply(r))),r}))}},{key:"getConfig",value:function(){var e={units:this.units,activation:Mw(this.activation),useBias:this.useBias,kernelInitializer:Ly(this.kernelInitializer),biasInitializer:Ly(this.biasInitializer),kernelRegularizer:Vw(this.kernelRegularizer),biasRegularizer:Vw(this.biasRegularizer),activityRegularizer:Vw(this.activityRegularizer),kernelConstraint:gx(this.kernelConstraint),biasConstraint:gx(this.biasConstraint)},t=Object(d.a)(Object(p.a)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(ex);RO.className="Dense",gh.registerClass(RO);var DO=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(O.a)(this,n),e=e||{},(r=t.call(this,e)).inputSpec=[{minNDim:3}],r.dataFormat=e.dataFormat,r}return Object(I.a)(n,[{key:"computeOutputShape",value:function(e){e=Vy(e);var t,n=Object(N.a)(e.slice(1));try{for(n.s();!(t=n.n()).done;){if(null==t.value)throw new og('The shape of the input to "Flatten" is not fully defined (got '.concat(e.slice(1),'). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.'))}}catch(r){n.e(r)}finally{n.f()}return[e[0],Yg(e,1)]}},{key:"call",value:function(e,t){var n=this;return zs((function(){n.invokeCallHook(e,t);var r=Uy(e);if("channelsFirst"===n.dataFormat&&r.rank>1){for(var a=[0],i=2;i<r.rank;++i)a.push(i);a.push(1),r=Bp(r,a)}return function(e){if(e.rank<=1)throw new og("batchFlatten requires a minimum rank of 2. Got rank: ".concat(e.rank,"."));var t=[e.shape[0],Yg(e.shape,1)];return Eu(e,t)}(r)}))}},{key:"getConfig",value:function(){var e={};null!=this.dataFormat&&(e.dataFormat=this.dataFormat);var t=Object(d.a)(Object(p.a)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(ex);DO.className="Flatten",gh.registerClass(DO);var FO=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(O.a)(this,n),(r=t.call(this,e)).supportsMasking=!0,r.activation=Lw(e.activation),r}return Object(I.a)(n,[{key:"call",value:function(e,t){var n=this;return zs((function(){n.invokeCallHook(e,t);var r=Uy(e);return n.activation.apply(r)}))}},{key:"getConfig",value:function(){var e={activation:Mw(this.activation)},t=Object(d.a)(Object(p.a)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(ex);FO.className="Activation",gh.registerClass(FO);var MO=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(O.a)(this,n),(r=t.call(this,e)).n=e.n,r.inputSpec=[{ndim:2}],r}return Object(I.a)(n,[{key:"computeOutputShape",value:function(e){return[e[0],this.n,e[1]]}},{key:"call",value:function(e,t){var n=this;return zs((function(){return function(e,t){return zs((function(){if(2!==e.shape.length)throw new og("repeat() expects a rank-2 tensor, but received a rank-".concat(e.shape.length," tensor."));return uy(ty(e,1),[1,t,1])}))}(e=Uy(e),n.n)}))}},{key:"getConfig",value:function(){var e={n:this.n},t=Object(d.a)(Object(p.a)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(ex);MO.className="RepeatVector",gh.registerClass(MO);var zO=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;Object(O.a)(this,n),(r=t.call(this,e)).targetShape=e.targetShape;for(var a=0;a<r.targetShape.length;++a)r.isUnknown(r.targetShape[a])&&(r.targetShape[a]=null);return r}return Object(I.a)(n,[{key:"isUnknown",value:function(e){return e<0||null==e}},{key:"fixUnknownDimension",value:function(e,t){for(var n="Total size of new array must be unchanged.",r=t.slice(),a=1,i=null,o=0;o<r.length;++o){var s=r[o];if(this.isUnknown(s)){if(null!==i)throw new og("Can only specifiy one unknown dimension.");i=o}else a*=s}var u=Yg(e);if(null!==i){if(0===a||u%a!==0)throw new og(n);r[i]=u/a}else if(u!==a)throw new og(n);return r}},{key:"computeOutputShape",value:function(e){for(var t=!1,n=0;n<e.length;++n)if(this.isUnknown(e[n])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}},{key:"call",value:function(e,t){var n=this;return zs((function(){n.invokeCallHook(e,t);var r=Uy(e),a=r.shape,i=a.slice(0,1).concat(n.fixUnknownDimension(a.slice(1),n.targetShape));return Eu(r,i)}))}},{key:"getConfig",value:function(){var e={targetShape:this.targetShape},t=Object(d.a)(Object(p.a)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(ex);zO.className="Reshape",gh.registerClass(zO);var LO=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;if(Object(O.a)(this,n),r=t.call(this,e),null==e.dims)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error("Permute constructor requires `dims` to be an Array, but received ".concat(e.dims," instead."));var a=Qg(1,e.dims.length+1);if(!Ga.arraysEqual(e.dims.slice().sort(),a))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");return r.dims=e.dims,r.dimsIncludingBatch=[0].concat(r.dims),r.inputSpec=[new Yy({ndim:r.dims.length+1})],Object(m.a)(r)}return Object(I.a)(n,[{key:"computeOutputShape",value:function(e){var t=(e=Vy(e)).slice();return this.dims.forEach((function(n,r){t[r+1]=e[n]})),t}},{key:"call",value:function(e,t){return Bp(Uy(e),this.dimsIncludingBatch)}},{key:"getConfig",value:function(){var e={dims:this.dims},t=Object(d.a)(Object(p.a)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(ex);LO.className="Permute",gh.registerClass(LO);var PO=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(O.a)(this,n),(r=t.call(this,null==e?{}:e)).supportsMasking=!0,r.maskValue=null!=e?null==e.maskValue?0:e.maskValue:0,r}return Object(I.a)(n,[{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=Object(d.a)(Object(p.a)(n.prototype),"getConfig",this).call(this),t={maskValue:this.maskValue};return Object.assign(t,e),t}},{key:"computeMask",value:function(e,t){var n=Uy(e);return iu(Yl(n,this.maskValue),-1)}},{key:"call",value:function(e,t){var n=this;return zs((function(){n.invokeCallHook(e,t);var r=Uy(e),a=iu(Yl(r,n.maskValue),-1,!0);return $s(r,Ns(a,r.dtype))}))}}]),n}(ex);PO.className="Masking",gh.registerClass(PO);var BO=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;if(Object(O.a)(this,n),(r=t.call(this,e)).embeddings=null,r.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",null==e.batchInputShape&&null==e.inputShape){var a=null;null!=e.batchSize&&(a=e.batchSize),null==e.inputLength?r.batchInputShape=[a,null]:r.batchInputShape=[a].concat(hg(e.inputLength))}return r.inputDim=e.inputDim,Ng(r.inputDim,"inputDim"),r.outputDim=e.outputDim,Ng(r.outputDim,"outputDim"),r.embeddingsInitializer=Py(e.embeddingsInitializer||r.DEFAULT_EMBEDDINGS_INITIALIZER),r.embeddingsRegularizer=Hw(e.embeddingsRegularizer),r.activityRegularizer=Hw(e.activityRegularizer),r.embeddingsConstraint=xx(e.embeddingsConstraint),r.maskZero=e.maskZero,r.supportsMasking=e.maskZero,r.inputLength=e.inputLength,Object(m.a)(r)}return Object(I.a)(n,[{key:"build",value:function(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}},{key:"warnOnIncompatibleInputShape",value:function(e){}},{key:"computeMask",value:function(e,t){var n=this;return zs((function(){return n.maskZero?(e=Uy(e),Yl(e,Ic(e))):null}))}},{key:"computeOutputShape",value:function(e){if(e=Vy(e),null==this.inputLength)return[].concat(Object(S.a)(e),[this.outputDim]);var t=hg(this.inputLength);if(t.length!==e.length-1)throw new og('"inputLength" is '.concat(this.inputLength,", but received input shape has shape ").concat(e));for(var n=0,r=0;r<t.length;++r){var a=t[r],i=e[r+1];if(null!=a&&null!=i&&a!==i)throw new og('"inputLength" is '.concat(this.inputLength,", but received input shape has shape ").concat(e));null==a&&(t[n]=i),n++}return[e[0]].concat(Object(S.a)(t),[this.outputDim])}},{key:"call",value:function(e,t){var n=this;return zs((function(){n.invokeCallHook(e,t);var r=Uy(e);"int32"!==r.dtype&&(r=ey(r,"int32"));var a=dy(n.embeddings.read(),Eu(r,[r.size]));return Eu(a,Vy(n.computeOutputShape(r.shape)))}))}},{key:"getConfig",value:function(){var e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:Ly(this.embeddingsInitializer),embeddingsRegularizer:Vw(this.embeddingsRegularizer),activityRegularizer:Vw(this.activityRegularizer),embeddingsConstraint:gx(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},t=Object(d.a)(Object(p.a)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(ex);BO.className="Embedding",gh.registerClass(BO);var WO=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(O.a)(this,n),(r=t.call(this,e||{})).supportsMasking=!0,r}return Object(I.a)(n,[{key:"mergeFunction",value:function(e){throw new sg}},{key:"computeElementwiseOpOutputShape",value:function(e,t){if(null==e||null==t)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(0===t.length)return e;for(var n=e.slice(0,e.length-t.length),r=0;r<t.length;++r){var a=e[e.length-t.length+r],i=t[r];if(null==a||null==i||a<0||i<0)n.push(null);else if(1===a)n.push(i);else if(1===i)n.push(a);else{if(a!==i)throw new og("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));n.push(a)}}return n}},{key:"build",value:function(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[Vy(e)]),(e=e).length<2)throw new og("A merge layer should be called on an Array of at least 2 inputs. Got ".concat(e.length," input(s)."));var t,n=[],r=Object(N.a)(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;null!=a&&null!==a[0]&&n.push(a[0])}}catch(c){r.e(c)}finally{r.f()}if((n=wg(n)).length>1)throw new og("Can not merge tensors with different batch sizes. Got tensors with shapes: ".concat(JSON.stringify(e),"."));for(var i=null==e[0]?null:e[0].slice(1),o=1;o<e.length;++o){var s=null==e[o]?null:e[o].slice(1);i=this.computeElementwiseOpOutputShape(i,s)}var u=e.map((function(e){return e.length}));-1===e.indexOf(null)&&1===wg(u).length?this.reshapeRequired=!1:this.reshapeRequired=!0}},{key:"call",value:function(e,t){var n=this;return zs((function(){if(e=e,n.reshapeRequired){var t=[],r=e.map((function(e){return e.rank}));if(-1===r.indexOf(null)){var a,i=Jg(r),o=Object(N.a)(e);try{for(o.s();!(a=o.n()).done;){for(var s=a.value,u=s.rank,c=0;c<i-u;++c)s=ty(s,1);t.push(s)}}catch(j){o.e(j)}finally{o.f()}return n.mergeFunction(t)}var l,d=!1,p=Object(N.a)(e);try{for(p.s();!(l=p.n()).done;){var f=l.value,h=f.rank;if(null==h){var m=f.shape,v=m[0],b=m.slice(1).concat([v]),g=Eu(f,[v].concat(Yg(m.slice(1))));g=Bp(g,[1,0]),g=Eu(g,b),t.push(g),d=!0}else if(h>1){var y=Qg(1,h).concat([0]);t.push(Bp(f,y)),d=!0}else t.push(f)}}catch(j){p.e(j)}finally{p.f()}var x=n.mergeFunction(t),k=x.rank;if(d)if(null==k){var w=x.shape,O=w[w.length-1],I=[O].concat(w.slice(0,w.length-1));x=Eu(Bp(Eu(x,[-1,O]),[1,0]),I)}else if(k>1){var S=[k-1].concat(Qg(0,k-1));x=Bp(x,S)}return x}return n.mergeFunction(e)}))}},{key:"computeOutputShape",value:function(e){var t;t=null==(e=e)[0]?null:e[0].slice(1);for(var n=1;n<e.length;++n){var r=null==e[n]?null:e[n].slice(1);t=this.computeElementwiseOpOutputShape(t,r)}var a,i=[],o=Object(N.a)(e);try{for(o.s();!(a=o.n()).done;){var s=a.value;null!=s&&null!==s[0]&&i.push(s[0])}}catch(u){o.e(u)}finally{o.f()}return t=1===(i=wg(i)).length?i.concat(t):[null].concat(t)}},{key:"computeMask",value:function(e,t){return zs((function(){if(null==t)return null;if(!Array.isArray(t))throw new og("`mask` should be an Array");if(!Array.isArray(e))throw new og("`inputs` should be an Array");if(t.length!==e.length)throw new og("The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (".concat(e.length," vs ").concat(t.length,")"));if(t.every((function(e){return null==e})))return null;for(var n=(t=t.map((function(e){return null==e?e:Zc(e,0)})))[0],r=1;r<t.length-1;++r)n=Tl(n,t[r]);return n}))}}]),n}(ex),UO=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){return Object(O.a)(this,n),t.call(this,e)}return Object(I.a)(n,[{key:"mergeFunction",value:function(e){return zs((function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=Zs(t,e[n]);return t}))}}]),n}(WO);UO.className="Add",gh.registerClass(UO);var VO=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){return Object(O.a)(this,n),t.call(this,e)}return Object(I.a)(n,[{key:"mergeFunction",value:function(e){return zs((function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=$s(t,e[n]);return t}))}}]),n}(WO);VO.className="Multiply",gh.registerClass(VO);var GO=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){return Object(O.a)(this,n),t.call(this,e)}return Object(I.a)(n,[{key:"mergeFunction",value:function(e){return zs((function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=Zs(t,e[n]);return $s(1/e.length,t)}))}}]),n}(WO);GO.className="Average",gh.registerClass(GO);var HO=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){return Object(O.a)(this,n),t.call(this,e)}return Object(I.a)(n,[{key:"mergeFunction",value:function(e){return zs((function(){for(var t=e[0],n=1;n<e.length;++n)t=Ll(t,e[n]);return t}))}}]),n}(WO);HO.className="Maximum",gh.registerClass(HO);var qO=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){return Object(O.a)(this,n),t.call(this,e)}return Object(I.a)(n,[{key:"mergeFunction",value:function(e){return zs((function(){for(var t=e[0],n=1;n<e.length;++n)t=Vl(t,e[n]);return t}))}}]),n}(WO);qO.className="Minimum",gh.registerClass(qO);var KO=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(O.a)(this,n),(r=t.call(this,e)).DEFAULT_AXIS=-1,null==e&&(e={}),r.axis=null==e.axis?r.DEFAULT_AXIS:e.axis,r.supportsMasking=!0,r.reshapeRequired=!1,r}return Object(I.a)(n,[{key:"build",value:function(e){if(!Array.isArray(e)||!Array.isArray(e[0])||1===e.length)throw new og("A `Concatenate` layer should be called on a list of at least 2 inputs");e=e;var t,n=!0,r=Object(N.a)(e);try{for(r.s();!(t=r.n()).done;){if(null!=t.value){n=!1;break}}}catch(d){r.e(d)}finally{r.f()}if(!n){for(var a=[],i=0;i<e.length;++i){var o=e[i].slice();o.splice(this.axis,1);var s,u=!1,c=Object(N.a)(a);try{for(c.s();!(s=c.n()).done;){var l=s.value;if(Ga.arraysEqual(l,o)){u=!0;break}}}catch(d){c.e(d)}finally{c.f()}u||a.push(o)}if(a.length>1)throw new og("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}}},{key:"mergeFunction",value:function(e){var t=this;return zs((function(){return oy(e,t.axis)}))}},{key:"computeOutputShape",value:function(e){if(!Array.isArray(e)||!Array.isArray(e[0]))throw new og("A `Concatenate` layer should be called on a list of inputs.");var t,n=e,r=n[0].slice(),a=this.axis<0?r.length+this.axis:this.axis,i=Object(N.a)(n.slice(1));try{for(i.s();!(t=i.n()).done;){var o=t.value;if(null==r[a]||null==o[a]){r[a]=null;break}r[a]+=o[a]}}catch(s){i.e(s)}finally{i.f()}return r}},{key:"computeMask",value:function(e,t){var n=this;if(null==t)return null;if(!Array.isArray(t))throw new og("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new og("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new og("Mismatch in the length of mask (".concat(t.length,") and the legnth of inputs (").concat(e.length,")"));return zs((function(){var r=!0;if(t.forEach((function(e){null==e||(r=!1)})),r)return null;for(var a=[],i=0;i<e.length;++i)null==t[i]?a.push(Ns(Jl(e[i]),"bool")):t[i].rank<e[i].rank?a.push(Zc(t[i],-1)):a.push(t[i]);var o=Ru(a,n.axis);return au(o,-1,!1)}))}},{key:"getConfig",value:function(){var e={axis:this.axis},t=Object(d.a)(Object(p.a)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(WO);function XO(e,t){for(;e<0;)e+=t;return e}KO.className="Concatenate",gh.registerClass(KO);var YO=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(O.a)(this,n),(r=t.call(this,e)).axes=e.axes,r.normalize=null!=e.normalize&&e.normalize,r.supportsMasking=!0,r.reshapeRequired=!1,r}return Object(I.a)(n,[{key:"build",value:function(e){Ga.assert(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),(function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."}));var t=e[0],n=e[1];if(t.length>3||n.length>3)throw new sg("Dot layer does not support tensors of 4D or higher rank yet.");var r=this.interpretAxes(t,n);if(t[r[0]]!==n[r[1]])throw new og("Dimension incompatibility: ".concat(t[r[0]]," !== ").concat(n[r[1]]))}},{key:"mergeFunction",value:function(e){if(2!==e.length)throw new og("A `Dot` layer must be called on exactly 2 inputs, but received ".concat(e.length," input(s)."));var t,n=e[0],r=e[1];return t=Array.isArray(this.axes)?this.axes.map((function(t,n){return XO(t,e[n].shape.length)})):[XO(this.axes,n.shape.length),XO(this.axes,r.shape.length)],this.normalize&&(n=tk(n,t[0]),r=tk(r,t[1])),function(e,t,n){if(e.shape.length>3||t.shape.length>3)throw new sg("batchDot is not implemented for tensors of 4D or higher rank yet");if(Ga.assert(e.shape.length>=2,(function(){return"batchDot requires the rank of x to be >= 2, but got ".concat(e.shape.length)})),Ga.assert(e.shape.length>=2,(function(){return"batchDot requires the rank of y to be >= 2, but got ".concat(t.shape.length)})),"number"==typeof n&&(n=[n,n]),"complex64"===e.dtype||"complex64"===t.dtype)throw new sg("batchDot is not implemented for complex64-type Tensors yet.");var r=e.shape.length,a=t.shape.length;null==n&&(n=[r-1,a-2]);var i=n;return zs((function(){var n,o;if(r>a){n=r-a;for(var s=[],u=0;u<n;++u)s.push(1);t=Eu(t,t.shape.concat(s))}else if(a>r){n=a-r;for(var c=[],l=0;l<n;++l)c.push(1);e=Eu(e,e.shape.concat(c))}else n=0;if(2===e.shape.length&&2===t.shape.length)o=i[0]===i[1]?Hc($s(e,t),i[0]):Hc($s(Bp(e,[1,0]),t),i[1]);else{var d=i[0]!==e.shape.length-1,p=i[1]===t.shape.length-1;o=Du(e,t,d,p)}if(n>0){for(var f,h=[],m=f=r>a?r+a-3:r-1;m<f+n;++m)h.push(m);o=pp(o,h)}return 1===o.shape.length&&(o=Zc(o,1)),o}))}(n,r,t)}},{key:"interpretAxes",value:function(e,t){return Array.isArray(this.axes)?this.axes:[XO(this.axes,e.length),XO(this.axes,t.length)]}},{key:"computeOutputShape",value:function(e){Ga.assert(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),(function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."}));var t=e[0].slice(),n=e[1].slice();if(t.length>3||n.length>3)throw new sg("Dot layer does not support tensors of 4D or higher rank yet.");var r=this.interpretAxes(t,n);t.splice(r[0],1),n.splice(r[1],1),n.splice(0,1);var a=t.concat(n);return 1===a.length&&a.push(1),a}},{key:"computeMask",value:function(e,t){return null}},{key:"getConfig",value:function(){var e={axes:this.axes,normalize:this.normalize},t=Object(d.a)(Object(p.a)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(WO);YO.className="Dot",gh.registerClass(YO);var ZO=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(O.a)(this,n),(r=t.call(this,e)).supportsMasking=!0,r.stddev=e.stddev,r}return Object(I.a)(n,[{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=Object(d.a)(Object(p.a)(n.prototype),"getConfig",this).call(this),t={stddev:this.stddev};return Object.assign(t,e),t}},{key:"call",value:function(e,t){var n=this;return zs((function(){n.invokeCallHook(e,t);var r=Uy(e);return by((function(){return Zs(cy(r.shape,0,n.stddev),r)}),(function(){return r}),t.training||!1)}))}}]),n}(ex);ZO.className="GaussianNoise",gh.registerClass(ZO);var JO=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(O.a)(this,n),(r=t.call(this,e)).supportsMasking=!0,r.rate=e.rate,r}return Object(I.a)(n,[{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=Object(d.a)(Object(p.a)(n.prototype),"getConfig",this).call(this),t={rate:this.rate};return Object.assign(t,e),t}},{key:"call",value:function(e,t){var n=this;return zs((function(){n.invokeCallHook(e,t);var r=Uy(e);return n.rate>0&&n.rate<1?by((function(){var e=Math.sqrt(n.rate/(1-n.rate));return $s(r,cy(r.shape,1,e))}),(function(){return r}),t.training||!1):r}))}}]),n}(ex);JO.className="GaussianDropout",gh.registerClass(JO);var QO=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(O.a)(this,n),(r=t.call(this,e)).supportsMasking=!0,r.rate=e.rate,r.noiseShape=e.noiseShape,r}return Object(I.a)(n,[{key:"_getNoiseShape",value:function(e){return this.noiseShape||Uy(e).shape}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=Object(d.a)(Object(p.a)(n.prototype),"getConfig",this).call(this),t={rate:this.rate};return Object.assign(t,e),t}},{key:"call",value:function(e,t){var n=this;return zs((function(){if(n.rate<1&&n.rate>0){var r=n._getNoiseShape(e);return by((function(){var t=Uy(e),a=-1.7580993408473766,i=rl(Dd(r),n.rate);i=ey(i,"float32");var o=Math.pow((1-n.rate)*(1+n.rate*Math.pow(a,2)),-.5),s=-o*a*n.rate,u=Zs($s(t,i),$s(Zs(i,-1),a));return Zs($s(u,o),s)}),(function(){return Uy(e)}),t.training||!1)}return e}))}}]),n}(ex);function $O(e,t,n,r,a){var i,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.001;if(2===e.rank)i=Uu(e,t,n,r,a,o);else if(3===e.rank)i=Vu(e,t,n,r,a,o);else{if(4!==e.rank)throw new sg("batchNormalization is not implemented for array of rank ".concat(e.rank," yet"));i=Gu(e,t,n,r,a,o)}return i}function eI(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return zs((function(){var i=ql(e,r),o=i.mean,s=i.variance;return[$O(e,o,s,n,t,a),o,s]}))}function tI(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return zs((function(){var i,o=ql(e,r),s=o.mean,u=o.variance,c=[],l=Object(N.a)(Qg(0,e.rank));try{for(l.s();!(i=l.n()).done;){var d=i.value;-1!==r.indexOf(d)?c.push(1):c.push(e.shape[d])}}catch(v){l.e(v)}finally{l.f()}var p=Eu(s,c),f=Eu(u,c),h=null==t?null:Eu(t,c),m=null==n?null:Eu(n,c);return[$O(e,p,f,m,h,a),s,u]}))}QO.className="AlphaDropout",gh.registerClass(QO);var nI=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(O.a)(this,n),null==e&&(e={}),(r=t.call(this,e)).supportsMasking=!0,r.axis=null==e.axis?-1:e.axis,r.momentum=null==e.momentum?.99:e.momentum,r.epsilon=null==e.epsilon?.001:e.epsilon,r.center=null==e.center||e.center,r.scale=null==e.scale||e.scale,r.betaInitializer=Py(e.betaInitializer||"zeros"),r.gammaInitializer=Py(e.gammaInitializer||"ones"),r.movingMeanInitializer=Py(e.movingMeanInitializer||"zeros"),r.movingVarianceInitializer=Py(e.movingVarianceInitializer||"ones"),r.betaConstraint=xx(e.betaConstraint),r.gammaConstraint=xx(e.gammaConstraint),r.betaRegularizer=Hw(e.betaRegularizer),r.gammaRegularizer=Hw(e.gammaRegularizer),r}return Object(I.a)(n,[{key:"build",value:function(e){e=Vy(e);var t=this.axis>=0?this.axis:this.axis+e.length,n=e[t];if(null==n)throw new og("Axis ".concat(t," of input tensor should have a defined dimension but the layer received an input with shape ").concat(JSON.stringify(e),"."));this.inputSpec=[new Yy({ndim:e.length,axes:Object(l.a)({},t,n)})];var r=[n];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}},{key:"call",value:function(e,t){var n=this;return zs((function(){var r=null!=t.training&&t.training,a=Uy(e),i=a.shape,o=i.length,s=Qg(0,o),u=n.axis>=0?n.axis:n.axis+o;s.splice(u,1);var c=lg(1,o);c[u]=i[u];var l=s.slice();l.sort();var d=!Ga.arraysEqual(l,Qg(0,o).slice(0,o-1));if(!r)return function(){if(d){var e=Eu(n.movingMean.read(),c),t=Eu(n.movingVariance.read(),c),r=n.center?Eu(n.beta.read(),c):null,i=n.scale?Eu(n.gamma.read(),c):null;return $O(a,e,t,r,i,n.epsilon)}return $O(a,n.movingMean.read(),n.movingVariance.read(),null==n.beta?null:n.beta.read(),null==n.gamma?null:n.gamma.read(),n.epsilon)}();var p=function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return Ga.arraysEqual(r.slice().sort(),Qg(0,e.rank-1))?eI(e,t,n,r,a):tI(e,t,n,r,a)}(a,n.gamma.read(),n.beta.read(),s,n.epsilon),f=Object(y.a)(p,3),h=f[0],m=f[1],v=f[2],b=function(e,t,n){zs((function(){var r=1-n,a=e.read(),i=$s(Sl(a,t),r);e.write(Sl(a,i))}))};return b(n.movingMean,m,n.momentum),b(n.movingVariance,v,n.momentum),h}))}},{key:"getConfig",value:function(){var e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Ly(this.betaInitializer),gammaInitializer:Ly(this.gammaInitializer),movingMeanInitializer:Ly(this.movingMeanInitializer),movingVarianceInitializer:Ly(this.movingVarianceInitializer),betaRegularizer:Vw(this.betaRegularizer),gammaRegularizer:Vw(this.gammaRegularizer),betaConstraint:gx(this.betaConstraint),gammaConstraint:gx(this.gammaConstraint)},t=Object(d.a)(Object(p.a)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(ex);nI.className="BatchNormalization",gh.registerClass(nI);var rI=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;if(Object(O.a)(this,n),null==e&&(e={}),(r=t.call(this,e)).axis=null==e.axis?-1:e.axis,"number"==typeof r.axis){if(!Number.isInteger(r.axis))throw new Error("Expected axis to be an integer, but received ".concat(r.axis))}else{if(!Array.isArray(r.axis))throw new Error("Expected axis to be an integer or an array of integers, but received ".concat(JSON.stringify(r.axis)));var a,i=Object(N.a)(r.axis);try{for(i.s();!(a=i.n()).done;){var o=a.value;if(!Number.isInteger(o))throw new Error("Expected axis to be an array of integers, but received ".concat(JSON.stringify(r.axis)))}}catch(s){i.e(s)}finally{i.f()}}return r.epsilon=null==e.epsilon?.001:e.epsilon,r.center=null==e.center||e.center,r.scale=null==e.scale||e.scale,r.betaInitializer=Py(e.betaInitializer||"zeros"),r.gammaInitializer=Py(e.gammaInitializer||"ones"),r.betaRegularizer=Hw(e.betaRegularizer),r.gammaRegularizer=Hw(e.gammaRegularizer),r.supportsMasking=!0,Object(m.a)(r)}return Object(I.a)(n,[{key:"build",value:function(e){var t=(e=Vy(e)).length;"number"==typeof this.axis&&(this.axis=[this.axis]);for(var n=0;n<this.axis.length;++n)this.axis[n]<0&&(this.axis[n]+=t);var r,a=Object(N.a)(this.axis);try{for(a.s();!(r=a.n()).done;){var i=r.value;if(i<0||i>=t)throw new Error("Invalid axis: ".concat(i))}}catch(s){a.e(s)}finally{a.f()}if(this.axis.length!==wg(this.axis).length)throw new Error("Found duplicate axes in: ".concat(this.axis));var o=this.axis.map((function(t){return e[t]}));this.scale?this.gamma=this.addWeight("gamma",o,"float32",this.gammaInitializer,this.gammaRegularizer,!0):this.gamma=null,this.center?this.beta=this.addWeight("beta",o,"float32",this.betaInitializer,this.betaRegularizer,!0):this.beta=null,this.built=!0}},{key:"call",value:function(e,t){var n=this,r=Uy(e),a=r.shape,i=a.length;return zs((function(){var e,t=ql(r,n.axis,!0),o=t.mean,s=t.variance,u=lg(1,i),c=Object(N.a)(n.axis);try{for(c.s();!(e=c.n()).done;){var l=e.value;u[l]=a[l]}}catch(b){c.e(b)}finally{c.f()}for(var d=function(e){return null!=e&&e.shape.length!==i?Eu(e,u):e},p=n.scale?d(n.gamma.read()):null,f=n.center?d(n.beta.read()):null,h=[],m=[],v=0;v<i;++v)-1!==n.axis.indexOf(v)?(h.push(a[v]),m.push(1)):(h.push(1),m.push(a[v]));return o=Qc(o,h),s=Qc(s,h),null!=p&&(p=Qc(p,m)),null!=f&&(f=Qc(f,m)),$O(r,o,s,f,p,n.epsilon)}))}},{key:"getConfig",value:function(){var e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Ly(this.betaInitializer),gammaInitializer:Ly(this.gammaInitializer),betaRegularizer:Vw(this.betaRegularizer),gammaRegularizer:Vw(this.gammaRegularizer)},t=Object(d.a)(Object(p.a)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(ex);rI.className="LayerNormalization",gh.registerClass(rI);var aI=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;if(Object(O.a)(this,n),null==e&&(e={}),(r=t.call(this,e)).dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,null==e.padding)r.padding=[[1,1],[1,1]];else if("number"==typeof e.padding)r.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,2!==e.padding.length)throw new og("ZeroPadding2D expects padding to be a length-2 array, but received a length-".concat(e.padding.length," array."));var a,i;if("number"==typeof e.padding[0])a=[e.padding[0],e.padding[0]],i=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,2!==e.padding[0].length)throw new og("ZeroPadding2D expects height padding to be a length-2 array, but received a length-".concat(e.padding[0].length," array."));if(a=e.padding[0],2!==e.padding[1].length)throw new og("ZeroPadding2D expects width padding to be a length-2 array, but received a length-".concat(e.padding[1].length," array."));i=e.padding[1]}r.padding=[a,i]}return r.inputSpec=[new Yy({ndim:4})],Object(m.a)(r)}return Object(I.a)(n,[{key:"computeOutputShape",value:function(e){var t,n;return e=Vy(e),"channelsFirst"===this.dataFormat?(t=null!=e[2]&&e[2]>=0?e[2]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[3]&&e[3]>=0?e[3]+this.padding[1][0]+this.padding[1][1]:null,[e[0],e[1],t,n]):(t=null!=e[1]&&e[1]>=0?e[1]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[2]&&e[2]>=0?e[2]+this.padding[1][0]+this.padding[1][1]:null,[e[0],t,n,e[3]])}},{key:"call",value:function(e,t){var n=this;return zs((function(){return function(e,t,n){return zs((function(){if(4!==e.rank)throw new og("temporalPadding expects input tensor to be 4-D, but received a ".concat(e.rank,"-D tensor."));if(null==t&&(t=[[1,1],[1,1]]),2!==t.length||2!==t[0].length||2!==t[1].length)throw new og("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(null==n&&(n="channelsLast"),"channelsLast"!==n&&"channelsFirst"!==n)throw new og("Unknown data format: ".concat(n,". Supported data formats are 'channelsLast' and 'channelsFirst."));var r;return r="channelsFirst"===n?[[0,0],[0,0],t[0],t[1]]:[[0,0],t[0],t[1],[0,0]],$l(e,r)}))}(Uy(e),n.padding,n.dataFormat)}))}},{key:"getConfig",value:function(){var e={padding:this.padding,dataFormat:this.dataFormat},t=Object(d.a)(Object(p.a)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(ex);function iI(e,t,n,r,a,i){return zs((function(){Lg(a),Bg(i),Pg(r),null==n&&(n=[1,1]),null==r&&(r="valid"),null==a&&(a="channelsLast"),null==i&&(i="max"),e=tO(e,a);var o,s="same"===r?"same":"valid";return o="max"===i?Fl(e,t,n,s):_u(e,t,n,s),"channelsFirst"===a&&(o=Bp(o,[0,3,1,2])),o}))}function oI(e,t,n,r,a,i){return zs((function(){Lg(a),Bg(i),Pg(r),null==n&&(n=[1,1,1]),null==r&&(r="valid"),null==a&&(a="channelsLast"),null==i&&(i="max"),e=nO(e,a);var o,s="same"===r?"same":"valid";return o="max"===i?Ml(e,t,n,s):Au(e,t,n,s),"channelsFirst"===a&&(o=Bp(o,[0,4,1,2,3])),o}))}aI.className="ZeroPadding2D",gh.registerClass(aI);var sI=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;if(Object(O.a)(this,n),null==e.poolSize&&(e.poolSize=2),r=t.call(this,e),"number"==typeof e.poolSize)r.poolSize=[e.poolSize];else{if(!Array.isArray(e.poolSize)||1!==e.poolSize.length||"number"!=typeof e.poolSize[0])throw new og("poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ".concat(JSON.stringify(e.poolSize)));r.poolSize=e.poolSize}if(Ng(r.poolSize,"poolSize"),null==e.strides)r.strides=r.poolSize;else if("number"==typeof e.strides)r.strides=[e.strides];else{if(!Array.isArray(e.strides)||1!==e.strides.length||"number"!=typeof e.strides[0])throw new og("strides for 1D convolutional layer must be a number or an Array of a single number, but received ".concat(JSON.stringify(e.strides)));r.strides=e.strides}return Ng(r.strides,"strides"),r.padding=null==e.padding?"valid":e.padding,Pg(r.padding),r.inputSpec=[new Yy({ndim:3})],Object(m.a)(r)}return Object(I.a)(n,[{key:"computeOutputShape",value:function(e){var t=$w((e=Vy(e))[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]}},{key:"call",value:function(e,t){var n=this;return zs((function(){n.invokeCallHook(e,t),e=ty(Uy(e),2);var r=n.poolingFunction(Uy(e),[n.poolSize[0],1],[n.strides[0],1],n.padding,"channelsLast");return pp(r,[2])}))}},{key:"getConfig",value:function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},t=Object(d.a)(Object(p.a)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(ex),uI=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){return Object(O.a)(this,n),t.call(this,e)}return Object(I.a)(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return Lg(a),Pg(r),iI(e,t,n,r,a,"max")}}]),n}(sI);uI.className="MaxPooling1D",gh.registerClass(uI);var cI=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){return Object(O.a)(this,n),t.call(this,e)}return Object(I.a)(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return Lg(a),Pg(r),iI(e,t,n,r,a,"avg")}}]),n}(sI);cI.className="AveragePooling1D",gh.registerClass(cI);var lI=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;if(Object(O.a)(this,n),null==e.poolSize&&(e.poolSize=[2,2]),(r=t.call(this,e)).poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],null==e.strides)r.strides=r.poolSize;else if(Array.isArray(e.strides)){if(2!==e.strides.length)throw new og("If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ".concat(e.strides.length,"."));r.strides=e.strides}else r.strides=[e.strides,e.strides];return Ng(r.poolSize,"poolSize"),Ng(r.strides,"strides"),r.padding=null==e.padding?"valid":e.padding,r.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,Lg(r.dataFormat),Pg(r.padding),r.inputSpec=[new Yy({ndim:4})],Object(m.a)(r)}return Object(I.a)(n,[{key:"computeOutputShape",value:function(e){e=Vy(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2];return t=$w(t,this.poolSize[0],this.padding,this.strides[0]),n=$w(n,this.poolSize[1],this.padding,this.strides[1]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n]:[e[0],t,n,e[3]]}},{key:"call",value:function(e,t){var n=this;return zs((function(){return n.invokeCallHook(e,t),n.poolingFunction(Uy(e),n.poolSize,n.strides,n.padding,n.dataFormat)}))}},{key:"getConfig",value:function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=Object(d.a)(Object(p.a)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(ex),dI=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){return Object(O.a)(this,n),t.call(this,e)}return Object(I.a)(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return Lg(a),Pg(r),iI(e,t,n,r,a,"max")}}]),n}(lI);dI.className="MaxPooling2D",gh.registerClass(dI);var pI=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){return Object(O.a)(this,n),t.call(this,e)}return Object(I.a)(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return Lg(a),Pg(r),iI(e,t,n,r,a,"avg")}}]),n}(lI);pI.className="AveragePooling2D",gh.registerClass(pI);var fI=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;if(Object(O.a)(this,n),null==e.poolSize&&(e.poolSize=[2,2,2]),(r=t.call(this,e)).poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],null==e.strides)r.strides=r.poolSize;else if(Array.isArray(e.strides)){if(3!==e.strides.length)throw new og("If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ".concat(e.strides.length,"."));r.strides=e.strides}else r.strides=[e.strides,e.strides,e.strides];return Ng(r.poolSize,"poolSize"),Ng(r.strides,"strides"),r.padding=null==e.padding?"valid":e.padding,r.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,Lg(r.dataFormat),Pg(r.padding),r.inputSpec=[new Yy({ndim:5})],Object(m.a)(r)}return Object(I.a)(n,[{key:"computeOutputShape",value:function(e){e=Vy(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],r="channelsFirst"===this.dataFormat?e[4]:e[3];return t=$w(t,this.poolSize[0],this.padding,this.strides[0]),n=$w(n,this.poolSize[1],this.padding,this.strides[1]),r=$w(r,this.poolSize[2],this.padding,this.strides[2]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n,r]:[e[0],t,n,r,e[4]]}},{key:"call",value:function(e,t){var n=this;return zs((function(){return n.invokeCallHook(e,t),n.poolingFunction(Uy(e),n.poolSize,n.strides,n.padding,n.dataFormat)}))}},{key:"getConfig",value:function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=Object(d.a)(Object(p.a)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(ex),hI=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){return Object(O.a)(this,n),t.call(this,e)}return Object(I.a)(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return Lg(a),Pg(r),oI(e,t,n,r,a,"max")}}]),n}(fI);hI.className="MaxPooling3D",gh.registerClass(hI);var mI=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){return Object(O.a)(this,n),t.call(this,e)}return Object(I.a)(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return Lg(a),Pg(r),oI(e,t,n,r,a,"avg")}}]),n}(fI);mI.className="AveragePooling3D",gh.registerClass(mI);var vI=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(O.a)(this,n),(r=t.call(this,e)).inputSpec=[new Yy({ndim:3})],r}return Object(I.a)(n,[{key:"computeOutputShape",value:function(e){return[e[0],e[2]]}},{key:"call",value:function(e,t){throw new sg}}]),n}(ex),bI=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){return Object(O.a)(this,n),t.call(this,e||{})}return Object(I.a)(n,[{key:"call",value:function(e,t){return zs((function(){var t=Uy(e);return Pl(t,1)}))}}]),n}(vI);bI.className="GlobalAveragePooling1D",gh.registerClass(bI);var gI=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){return Object(O.a)(this,n),t.call(this,e||{})}return Object(I.a)(n,[{key:"call",value:function(e,t){return zs((function(){var t=Uy(e);return Pc(t,1)}))}}]),n}(vI);gI.className="GlobalMaxPooling1D",gh.registerClass(gI);var yI=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(O.a)(this,n),(r=t.call(this,e)).dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,Lg(r.dataFormat),r.inputSpec=[new Yy({ndim:4})],r}return Object(I.a)(n,[{key:"computeOutputShape",value:function(e){return e=e,"channelsLast"===this.dataFormat?[e[0],e[3]]:[e[0],e[1]]}},{key:"call",value:function(e,t){throw new sg}},{key:"getConfig",value:function(){var e={dataFormat:this.dataFormat},t=Object(d.a)(Object(p.a)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(ex),xI=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){return Object(O.a)(this,n),t.apply(this,arguments)}return Object(I.a)(n,[{key:"call",value:function(e,t){var n=this;return zs((function(){var t=Uy(e);return"channelsLast"===n.dataFormat?Pl(t,[1,2]):Pl(t,[2,3])}))}}]),n}(yI);xI.className="GlobalAveragePooling2D",gh.registerClass(xI);var kI=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){return Object(O.a)(this,n),t.apply(this,arguments)}return Object(I.a)(n,[{key:"call",value:function(e,t){var n=this;return zs((function(){var t=Uy(e);return"channelsLast"===n.dataFormat?Pc(t,[1,2]):Pc(t,[2,3])}))}}]),n}(yI);kI.className="GlobalMaxPooling2D",gh.registerClass(kI);var wI=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(O.a)(this,n),(r=t.call(this,e)).layer=e.layer,r}return Object(I.a)(n,[{key:"build",value:function(e){this.built=!0}},{key:"getWeights",value:function(){return this.layer.getWeights()}},{key:"setWeights",value:function(e){this.layer.setWeights(e)}},{key:"getConfig",value:function(){var e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},t=Object(d.a)(Object(p.a)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"setFastWeightInitDuringBuild",value:function(e){Object(d.a)(Object(p.a)(n.prototype),"setFastWeightInitDuringBuild",this).call(this,e),null!=this.layer&&this.layer.setFastWeightInitDuringBuild(e)}},{key:"trainable",get:function(){return null!=this.layer&&this.layer.trainable},set:function(e){null!=this.layer&&(this.layer.trainable=e)}},{key:"trainableWeights",get:function(){return this.layer.trainableWeights}},{key:"nonTrainableWeights",get:function(){return this.layer.nonTrainableWeights}},{key:"updates",get:function(){return this.layer._updates}},{key:"losses",get:function(){return this.layer.losses}}],[{key:"fromConfig",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=t.layer,a=ek(r,n);delete t.layer;var i={layer:a};return Object.assign(i,t),new e(i)}}]),n}(ex),OI=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(O.a)(this,n),(r=t.call(this,e)).supportsMasking=!0,r}return Object(I.a)(n,[{key:"build",value:function(e){if((e=Vy(e)).length<3)throw new og("TimeDistributed layer expects an input shape >= 3D, but received input shape ".concat(JSON.stringify(e)));this.inputSpec=[{shape:e}];var t=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(t),this.layer.built=!0),Object(d.a)(Object(p.a)(n.prototype),"build",this).call(this,e)}},{key:"computeOutputShape",value:function(e){var t=[(e=Vy(e))[0]].concat(e.slice(2)),n=this.layer.computeOutputShape(t),r=e[1];return[n[0],r].concat(n.slice(1))}},{key:"call",value:function(e,t){var n=this;return zs((function(){return bO((function(e,r){return[Uy(n.layer.call(e,t)),[]]}),e=Uy(e),[],!1,null,null,!1,!0)[1]}))}}]),n}(wI);OI.className="TimeDistributed",gh.registerClass(OI);var II=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;Object(O.a)(this,n),r=t.call(this,e);var a=e.layer.getConfig(),i={};i.className=e.layer.getClassName(),i.config=a,r.forwardLayer=ek(i),a.goBackwards=!0!==a.goBackwards;var o={};if(o.className=e.layer.getClassName(),o.config=a,r.backwardLayer=ek(o),r.forwardLayer.name="forward_"+r.forwardLayer.name,r.backwardLayer.name="backward_"+r.backwardLayer.name,r.mergeMode=void 0===e.mergeMode?"concat":e.mergeMode,function(e){Ig(Mg,"BidirectionalMergeMode",e)}(r.mergeMode),e.weights)throw new sg("weights support is not implemented for Bidirectional layer yet.");return r._stateful=e.layer.stateful,r.returnSequences=e.layer.returnSequences,r.returnState=e.layer.returnState,r.supportsMasking=!0,r._trainable=!0,r.inputSpec=e.layer.inputSpec,r.numConstants=null,r}return Object(I.a)(n,[{key:"getWeights",value:function(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}},{key:"setWeights",value:function(e){var t=e.length,n=Math.floor(t/2);this.forwardLayer.setWeights(e.slice(0,n)),this.backwardLayer.setWeights(e.slice(n))}},{key:"computeOutputShape",value:function(e){var t,n,r,a=this.forwardLayer.computeOutputShape(e);return Array.isArray(a)&&Array.isArray(a[0])||(a=[a]),a=a,this.returnState&&(r=a.slice(1)),t=t=a[0],"concat"===this.mergeMode?(t[t.length-1]*=2,n=[t]):n=null==this.mergeMode?[t,t.slice()]:[t],this.returnState?null==this.mergeMode?n.concat(r).concat(r.slice()):[t].concat(r).concat(r.slice()):fg(n)}},{key:"apply",value:function(e,t){var r=null==t?null:t.initialState,a=null==t?null:t.constants;null==t&&(t={});var i=vO(e,r,a,this.numConstants);if(e=i.inputs,r=i.initialState,a=i.constants,Array.isArray(e)&&(r=e.slice(1),e=e[0]),(null==r||0===r.length)&&null==a)return Object(d.a)(Object(p.a)(n.prototype),"apply",this).call(this,e,t);var o=[],s=[];if(null!=r){var u=r.length;if(u%2>0)throw new og("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");t.initialState=r,o.push.apply(o,Object(S.a)(r));var c=r.map((function(e){return new Yy({shape:e.shape})}));this.forwardLayer.stateSpec=c.slice(0,u/2),this.backwardLayer.stateSpec=c.slice(u/2),s.push.apply(s,Object(S.a)(c))}if(null!=a)throw new sg("Support for constants in Bidirectional layers is not implemented yet.");for(var l=o[0]instanceof Zy,f=0,h=o;f<h.length;f++){if(h[f]instanceof Zy!==l)throw new og("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors")}if(l){var m=[e].concat(o),v=this.inputSpec.concat(s),b=this.inputSpec;this.inputSpec=v;var g=Object(d.a)(Object(p.a)(n.prototype),"apply",this).call(this,m,t);return this.inputSpec=b,g}return Object(d.a)(Object(p.a)(n.prototype),"apply",this).call(this,e,t)}},{key:"call",value:function(e,t){var n=this;return zs((function(){var r,a,i,o,s=t.initialState;if(null==s)r=n.forwardLayer.call(e,t),a=n.backwardLayer.call(e,t);else{var u=s.slice(0,s.length/2),c=s.slice(s.length/2);r=n.forwardLayer.call(e,Object.assign(t,{initialState:u})),a=n.backwardLayer.call(e,Object.assign(t,{initialState:c}))}return n.returnState&&(Array.isArray(r)&&(i=r.slice(1).concat(a.slice(1))),r=r[0],a=a[0]),n.returnSequences&&(a=Wd(a,1)),"concat"===n.mergeMode?o=oy([r,a]):"sum"===n.mergeMode?o=Zs(r,a):"ave"===n.mergeMode?o=$s(.5,Zs(r,a)):"mul"===n.mergeMode?o=$s(r,a):null==n.mergeMode&&(o=[r,a]),n.returnState?null==n.mergeMode?o.concat(i):[o].concat(i):o}))}},{key:"resetStates",value:function(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}},{key:"build",value:function(e){var t=this;Ug(this.forwardLayer.name,(function(){t.forwardLayer.build(e)})),Ug(this.backwardLayer.name,(function(){t.backwardLayer.build(e)})),this.built=!0}},{key:"computeMask",value:function(e,t){var n;if(Array.isArray(t)&&(t=t[0]),n=this.returnSequences?null==this.mergeMode?[t,t]:t:null==this.mergeMode?[null,null]:null,this.returnState){var r=this.forwardLayer.states.map((function(e){return null}));return Array.isArray(n)?n.concat(r).concat(r):[n].concat(r).concat(r)}return n}},{key:"setFastWeightInitDuringBuild",value:function(e){Object(d.a)(Object(p.a)(n.prototype),"setFastWeightInitDuringBuild",this).call(this,e),null!=this.forwardLayer&&this.forwardLayer.setFastWeightInitDuringBuild(e),null!=this.backwardLayer&&this.backwardLayer.setFastWeightInitDuringBuild(e)}},{key:"getConfig",value:function(){var e={mergeMode:this.mergeMode},t=Object(d.a)(Object(p.a)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"trainable",get:function(){return this._trainable},set:function(e){this._trainable=e,null!=this.forwardLayer&&(this.forwardLayer.trainable=e),null!=this.backwardLayer&&(this.backwardLayer.trainable=e)}},{key:"trainableWeights",get:function(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}},{key:"nonTrainableWeights",get:function(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}}],[{key:"fromConfig",value:function(e,t){var n=ek(t.layer);if(delete t.layer,null!=t.numConstants)throw new sg("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");var r=t;return r.layer=n,new e(r)}}]),n}(wI);II.className="Bidirectional",gh.registerClass(II);var SI=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(O.a)(this,n),(r=t.call(this,e)).scale=e.scale,e.offset?r.offset=e.offset:r.offset=0,r}return Object(I.a)(n,[{key:"getConfig",value:function(){var e={scale:this.scale,offset:this.offset},t=Object(d.a)(Object(p.a)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"call",value:function(e,t){var n=this;return zs((function(){return"float32"!==(e=Uy(e)).dtype&&(e=ey(e,"float32")),Zs($s(e,n.scale),n.offset)}))}}]),n}(ex);SI.className="Rescaling",gh.registerClass(SI);var NI=fh.resizeBilinear,jI=fh.cropAndResize,TI=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(O.a)(this,n),(r=t.call(this,e)).height=e.height,r.width=e.width,r}return Object(I.a)(n,[{key:"centerCrop",value:function(e,t,n,r,a,i,o,s){return zs((function(){var u,c=!1,l=[t/i,n/o,(r+t)/i,(a+n)/o],d=[];3===e.rank?(c=!0,u=fp([e])):u=e;for(var p=0;p<u.shape[0];p++)d.push(l);var f=ho(d,[d.length,4]),h=Md(0,d.length,1,"int32"),m=jI(u,f,h,[r,a],"nearest");return ey(c?Uy(Ap(m)):m,s)}))}},{key:"upsize",value:function(e,t,n,r){return zs((function(){return ey(NI(e,[t,n]),r)}))}},{key:"call",value:function(e,t){var n=this;return zs((function(){var t=Uy(e),r=t.dtype,a=t.shape,i=a[a.length-3],o=a[a.length-2],s=0;i!==n.height&&(s=Math.floor((i-n.height)/2));var u=0;return o!==n.width&&(0===(u=Math.floor((o-n.width)/2))&&(u=1)),s>=0&&u>=0?n.centerCrop(t,s,u,n.height,n.width,i,o,r):n.upsize(e,n.height,n.width,r)}))}},{key:"getConfig",value:function(){var e={height:this.height,width:this.width},t=Object(d.a)(Object(p.a)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"computeOutputShape",value:function(e){var t=(e=Vy(e)).length-3,n=e.length-2;return e[t]=this.height,e[n]=this.width,e}}]),n}(ex);TI.className="CenterCrop",gh.registerClass(TI);var CI=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(O.a)(this,n),(r=t.call(this,e)).numTokens=e.numTokens,e.outputMode?r.outputMode=e.outputMode:r.outputMode="multiHot",r}return Object(I.a)(n,[{key:"getConfig",value:function(){var e={numTokens:this.numTokens,outputMode:this.outputMode},t=Object(d.a)(Object(p.a)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"computeOutputShape",value:function(e){return null==(e=Vy(e))?[this.numTokens]:"oneHot"===this.outputMode&&1!==e[e.length-1]?(e.push(this.numTokens),e):(e[e.length-1]=this.numTokens,e)}},{key:"call",value:function(e,t){var n=this;return zs((function(){var r;if("int32"!==(e=Uy(e)).dtype&&(e=ey(e,"int32")),"undefined"!=typeof t.countWeights){if("count"!==n.outputMode)throw new og("countWeights is not used when outputMode !== count.\n              Received countWeights=".concat(t.countWeights));r=Uy(t.countWeights)}var a=Pc(e),i=Bc(e),o=nl(n.numTokens,a).bufferSync().get(0),s=rl(i,0).bufferSync().get(0);if(!o||!s)throw new og("Input values must be between 0 < values <= numTokens with numTokens=".concat(n.numTokens));return function(e,t,n,r){var a=Uy(e);if("int32"!==a.dtype&&(a=ey(a,"int32")),"int"===t)return a;var i=a.shape;if(0===a.rank&&(a=Zc(a,-1)),"oneHot"===t&&1!==a.shape[a.shape.length-1]&&(a=Zc(a,-1)),a.rank>2)throw new og("When outputMode is not int, maximum output rank is 2 Received outputMode ".concat(t," and input shape ").concat(i," which would result in output rank ").concat(a.rank,"."));var o,s=["multiHot","oneHot"].includes(t),u=a;if(o=fc(u,"undefined"!=typeof r&&"count"===t?r:[],n,s),"tfIdf"!==t)return o;if(r)return $s(o,r);throw new og("When outputMode is 'tfIdf', weights must be provided.")}(e,n.outputMode,n.numTokens,r)}))}}]),n}(ex);CI.className="CategoryEncoding",gh.registerClass(CI);var EI=new Set(["bilinear","nearest"]),_I=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;if(Object(O.a)(this,n),(r=t.call(this,e)).height=e.height,r.width=e.width,e.interpolation){if(!EI.has(e.interpolation))throw new og("Invalid interpolation parameter: ".concat(e.interpolation," is not implemented"));r.interpolation=e.interpolation}else r.interpolation="bilinear";return r.cropToAspectRatio=!!e.cropToAspectRatio,Object(m.a)(r)}return Object(I.a)(n,[{key:"computeOutputShape",value:function(e){var t=(e=Vy(e))[2];return[this.height,this.width,t]}},{key:"getConfig",value:function(){var e={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},t=Object(d.a)(Object(p.a)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"call",value:function(e,t){var n=this;return zs((function(){var t=[n.height,n.width];if("bilinear"===n.interpolation)return fh.resizeBilinear(e,t,!n.cropToAspectRatio);if("nearest"===n.interpolation)return fh.resizeNearestNeighbor(e,t,!n.cropToAspectRatio);throw new Error("Interpolation is ".concat(n.interpolation," but only ").concat(Object(S.a)(EI)," are supported"))}))}}]),n}(ex);_I.className="Resizing",gh.registerClass(_I);var AI=function(){function e(t){Object(O.a)(this,e),this.seed=t}return Object(I.a)(e,[{key:"next",value:function(){if(void 0!==this.seed)return this.seed++}}]),e}();AI.className="RandomSeed";var RI=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(O.a)(this,n),(r=t.call(this,e)).randomGenerator=new AI(e.seed),r}return Object(I.a)(n,[{key:"getConfig",value:function(){var e={seed:this.randomGenerator.seed},t=Object(d.a)(Object(p.a)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(ex);RI.className="BaseRandomLayer";var DI=new Set(["bilinear","nearest"]),FI=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;Object(O.a)(this,n),r=t.call(this,e);var a=e.factor,i=e.interpolation,o=void 0===i?"bilinear":i;if(r.factor=a,Array.isArray(r.factor)&&2===r.factor.length)r.widthLower=r.factor[0],r.widthUpper=r.factor[1];else{if(Array.isArray(r.factor)||!(r.factor>0))throw new og("Invalid factor: ".concat(r.factor,". Must be positive number or tuple of 2 numbers"));r.widthLower=-r.factor,r.widthUpper=r.factor}if(r.widthLower<-1||r.widthUpper<-1)throw new og("factor must have values larger than -1. Got: ".concat(r.factor));if(r.widthUpper<r.widthLower)throw new og("factor cannot have upper bound less than lower bound.\n        Got upper bound: ".concat(r.widthUpper,".\n        Got lower bound: ").concat(r.widthLower,"\n      "));if(o){if(!DI.has(o))throw new og("Invalid interpolation parameter: ".concat(o," is not implemented"));r.interpolation=o}return r}return Object(I.a)(n,[{key:"getConfig",value:function(){var e={factor:this.factor,interpolation:this.interpolation},t=Object(d.a)(Object(p.a)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"computeOutputShape",value:function(e){var t=(e=Vy(e))[2];return[this.imgHeight,-1,t]}},{key:"call",value:function(e,t){var n=this;return zs((function(){var t=Uy(e);n.imgHeight=t.shape[t.shape.length-3];var r=t.shape[t.shape.length-2];n.widthFactor=Dd([1],1+n.widthLower,1+n.widthUpper,"float32",n.randomGenerator.next());var a=n.widthFactor.dataSync()[0]*r;a=Math.round(a);var i=[n.imgHeight,a];switch(n.interpolation){case"bilinear":return fh.resizeBilinear(e,i);case"nearest":return fh.resizeNearestNeighbor(e,i);default:throw new Error("Interpolation is ".concat(n.interpolation,"\n          but only ").concat(Object(S.a)(DI)," are supported"))}}))}}]),n}(RI);function MI(e){return new tx(e)}function zI(e){return new Yw(e)}function LI(e){return new qw(e)}function PI(e){return new Kw(e)}function BI(e){return new Xw(e)}function WI(e){return new Jw(e)}function UI(e){return new Zw(e)}function VI(e){return new pO(e)}function GI(e){return new oO(e)}function HI(e){return new uO(e)}function qI(e){return new sO(e)}function KI(e){return new cO(e)}function XI(e){return new dO(e)}function YI(e){return new fO(e)}function ZI(e){return new hO(e)}function JI(e){return new mO(e)}function QI(e){return new FO(e)}function $I(e){return new RO(e)}function eS(e){return new _O(e)}function tS(e){return new AO(e)}function nS(e){return new DO(e)}function rS(e){return new MO(e)}function aS(e){return new zO(e)}function iS(e){return new LO(e)}function oS(e){return new BO(e)}function sS(e){return new UO(e)}function uS(e){return new GO(e)}function cS(e){return new KO(e)}function lS(e){return new HO(e)}function dS(e){return new qO(e)}function pS(e){return new VO(e)}function fS(e){return new YO(e)}function hS(e){return new nI(e)}function mS(e){return new rI(e)}function vS(e){return new aI(e)}function bS(e){return new cI(e)}function gS(e){return bS(e)}function yS(e){return bS(e)}function xS(e){return new pI(e)}function kS(e){return xS(e)}function wS(e){return xS(e)}function OS(e){return new mI(e)}function IS(e){return OS(e)}function SS(e){return OS(e)}function NS(e){return new bI(e)}function jS(e){return new xI(e)}function TS(e){return new gI(e)}function CS(e){return new kI(e)}function ES(e){return new uI(e)}function _S(e){return new dI(e)}function AS(e){return new hI(e)}function RS(e){return new OO(e)}function DS(e){return new wO(e)}function FS(e){return new SO(e)}function MS(e){return new IO(e)}function zS(e){return new kO(e)}function LS(e){return new xO(e)}function PS(e){return new EO(e)}function BS(e){return new CO(e)}function WS(e){return new gO(e)}function US(e){return new NO(e)}function VS(e){return new II(e)}function GS(e){return new OI(e)}FI.className="RandomWidth",gh.registerClass(FI);var HS=TS,qS=CS,KS=ES,XS=_S;function YS(e){return new ZO(e)}function ZS(e){return new JO(e)}function JS(e){return new QO(e)}function QS(e){return new PO(e)}function $S(e){return new SI(e)}function eN(e){return new TI(e)}function tN(e){return new _I(e)}function nN(e){return new CI(e)}function rN(e){return new FI(e)}var aN={};function iN(e,t){return dk(e,t)}function oN(e,t){return vk(e,t)}function sN(e,t){return bk(e,t)}function uN(e,t){return pk(e,t)}function cN(e,t){return gk(e,t)}function lN(e,t){return hk(e,t)}function dN(e,t){return mk(e,t)}function pN(e,t){return uk(e,t)}function fN(e,t){return rk(e,t)}function hN(e,t){return ak(e,t)}function mN(e,t){return ak(e,t)}function vN(e,t){return ak(e,t)}function bN(e,t){return nk(e,t)}function gN(e,t){return nk(e,t)}function yN(e,t){return nk(e,t)}z(aN,{MAPE:function(){return mN},MSE:function(){return gN},binaryAccuracy:function(){return iN},binaryCrossentropy:function(){return oN},categoricalAccuracy:function(){return uN},categoricalCrossentropy:function(){return cN},cosineProximity:function(){return pN},mape:function(){return vN},meanAbsoluteError:function(){return fN},meanAbsolutePercentageError:function(){return hN},meanSquaredError:function(){return bN},mse:function(){return yN},precision:function(){return lN},recall:function(){return dN},sparseCategoricalAccuracy:function(){return sN}});var xN={};z(xN,{modelFromJSON:function(){return cw}});var kN={};function wN(e){return new Ww(e)}function ON(e){return function(e){return Pw(e),new Ww({l1:null!=e?e.l1:null,l2:0})}(e)}function IN(e){return function(e){return Pw(e),new Ww({l2:null!=e?e.l2:null,l1:0})}(e)}z(kN,{l1:function(){return ON},l1l2:function(){return wN},l2:function(){return IN}});var SN=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){var e;return Object(O.a)(this,n),(e=t.apply(this,arguments)).model=null,e}return Object(I.a)(n,[{key:"setModel",value:function(e){if(!(e instanceof sw))throw new Error("model must be a LayersModel, not some other Container");this.model=e}}]),n}(qx);function NN(e,t){return e<t}function jN(e,t){return e>t}var TN=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;if(Object(O.a)(this,n),r=t.call(this),null==e&&(e={}),e.restoreBestWeights)throw new sg("restoreBestWeights = True is not implemented in EarlyStopping yet.");return r.monitor=e.monitor||"val_loss",r.minDelta=Math.abs(e.minDelta||0),r.patience=e.patience||0,r.verbose=e.verbose||0,r.mode=e.mode||"auto",r.baseline=e.baseline,-1===["auto","min","max"].indexOf(r.mode)&&(console.warn("EarlyStopping mode '".concat(r.mode,"' is invalid. Falling back to mode 'auto'.")),r.mode="auto"),"min"===r.mode?r.monitorFunc=NN:"max"===r.mode||-1!==r.monitor.indexOf("acc")?r.monitorFunc=jN:r.monitorFunc=NN,r.monitorFunc===NN&&(r.minDelta*=-1),Object(m.a)(r)}return Object(I.a)(n,[{key:"onTrainBegin",value:function(){var e=Object(w.a)(k.a.mark((function e(t){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.wait=0,this.stoppedEpoch=0,null!=this.baseline?this.best=this.baseline:this.best=this.monitorFunc===NN?1/0:-1/0;case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=Object(w.a)(k.a.mark((function e(t,n){var r;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Vx(n);case 2:null!=(r=this.getMonitorValue(n))&&(this.monitorFunc(r-this.minDelta,this.best)?(this.best=r,this.wait=0):(this.wait++,this.wait>=this.patience&&(this.stoppedEpoch=t,this.model.stopTraining=!0)));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onTrainEnd",value:function(){var e=Object(w.a)(k.a.mark((function e(t){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.stoppedEpoch>0&&this.verbose&&console.log("Epoch ".concat(this.stoppedEpoch,": early stopping."));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getMonitorValue",value:function(e){null==e&&(e={});var t=e[this.monitor];return null==t&&console.warn("Metric for EarlyStopping ".concat(this.monitor," is not available. Available metrics are: ").concat(Object.keys(e))),t}}]),n}(SN);var CN,EN,_N={earlyStopping:function(e){return new TN(e)}};st().registerFlag("KEEP_INTERMEDIATE_TENSORS",(function(){return!1}),(function(e){e&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")})),function(e){e[e.DT_INVALID=0]="DT_INVALID",e[e.DT_FLOAT=1]="DT_FLOAT",e[e.DT_DOUBLE=2]="DT_DOUBLE",e[e.DT_INT32=3]="DT_INT32",e[e.DT_UINT8=4]="DT_UINT8",e[e.DT_INT16=5]="DT_INT16",e[e.DT_INT8=6]="DT_INT8",e[e.DT_STRING=7]="DT_STRING",e[e.DT_COMPLEX64=8]="DT_COMPLEX64",e[e.DT_INT64=9]="DT_INT64",e[e.DT_BOOL=10]="DT_BOOL",e[e.DT_QINT8=11]="DT_QINT8",e[e.DT_QUINT8=12]="DT_QUINT8",e[e.DT_QINT32=13]="DT_QINT32",e[e.DT_BFLOAT16=14]="DT_BFLOAT16",e[e.DT_QINT16=15]="DT_QINT16",e[e.DT_QUINT16=16]="DT_QUINT16",e[e.DT_UINT16=17]="DT_UINT16",e[e.DT_COMPLEX128=18]="DT_COMPLEX128",e[e.DT_HALF=19]="DT_HALF",e[e.DT_RESOURCE=20]="DT_RESOURCE",e[e.DT_VARIANT=21]="DT_VARIANT",e[e.DT_UINT32=22]="DT_UINT32",e[e.DT_UINT64=23]="DT_UINT64",e[e.DT_FLOAT_REF=101]="DT_FLOAT_REF",e[e.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",e[e.DT_INT32_REF=103]="DT_INT32_REF",e[e.DT_UINT8_REF=104]="DT_UINT8_REF",e[e.DT_INT16_REF=105]="DT_INT16_REF",e[e.DT_INT8_REF=106]="DT_INT8_REF",e[e.DT_STRING_REF=107]="DT_STRING_REF",e[e.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",e[e.DT_INT64_REF=109]="DT_INT64_REF",e[e.DT_BOOL_REF=110]="DT_BOOL_REF",e[e.DT_QINT8_REF=111]="DT_QINT8_REF",e[e.DT_QUINT8_REF=112]="DT_QUINT8_REF",e[e.DT_QINT32_REF=113]="DT_QINT32_REF",e[e.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",e[e.DT_QINT16_REF=115]="DT_QINT16_REF",e[e.DT_QUINT16_REF=116]="DT_QUINT16_REF",e[e.DT_UINT16_REF=117]="DT_UINT16_REF",e[e.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",e[e.DT_HALF_REF=119]="DT_HALF_REF",e[e.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",e[e.DT_VARIANT_REF=121]="DT_VARIANT_REF",e[e.DT_UINT32_REF=122]="DT_UINT32_REF",e[e.DT_UINT64_REF=123]="DT_UINT64_REF"}(CN||(CN={})),function(e){var t;(t=e.CheckpointFormatVersion||(e.CheckpointFormatVersion={}))[t.LEGACY=0]="LEGACY",t[t.V1=1]="V1",t[t.V2=2]="V2"}(EN||(EN={}));var AN={};function RN(e,t){var n={tfOpName:e,category:"custom",inputs:[],attrs:[],customExecutor:t};AN[e]=n}function DN(e){return AN[e]}function FN(e){delete AN[e]}function MN(e,t,n,r,a){var i=t.inputParams[e];if(i&&void 0!==i.inputIndexStart){var o=i.inputIndexStart,s=0===i.inputIndexEnd?void 0:void 0===i.inputIndexEnd?o+1:i.inputIndexEnd,u=o<0?t.inputNames.length+o:o;if("tensor"===i.type)return zN(t.inputNames[u],n,r,a);if("tensors"===i.type){var c=t.inputs.slice(o,s);return t.inputNames.slice(o,s).filter((function(e,t){var n;return"NoOp"!==(null===(n=c[t])||void 0===n?void 0:n.op)})).map((function(e){return zN(e,n,r,a)}))}var l=zN(t.inputNames[u],n,r,a),d=l.dataSync();return"number"===i.type?d[0]:Ga.toNestedArray(l.shape,d)}var p=t.attrParams[e];return p&&p.value}function zN(e,t,n,r){var a=WN(e,n),i=Object(y.a)(a,2),o=i[0],s=i[1];if(null!=r){var u=r.getHashTableHandleByName(o);if(null!=u)return u}var c=n.currentContextIds.find((function(e){return!!t[BN(o,e)]}));return void 0!==c?t[BN(o,c)][s]:void 0}function LN(e,t,n){return t[BN(e,n.currentContextId)]}function PN(e,t){var n=WN(e,t),r=Object(y.a)(n,3),a=r[0],i=r[1],o=r[2];return[BN(a,t&&t.currentContextId),i,o]}function BN(e,t){return t?"".concat(e,"-").concat(t):e}function WN(e,t){if(""===e)return["",0,void 0];var n=null!=t&&null!=t.parseNodeNameCache;if(n){var r=t.parseNodeNameCache.get(e);if(null!=r)return r}var a,i=e.split(":");if(1===i.length)a=[e,0,void 0];else{var o=i[0],s=3===i.length?i[1]:void 0;a=[o,Number(i[i.length-1]),s]}return n&&t.parseNodeNameCache.set(e,a),a}function UN(e,t,n){var r=MN("pad",e,t,n);if("explicit"===r){r=MN("explicitPaddings",e,t,n);for(var a=[[0,0],[0,0],[0,0],[0,0]],i=0;i<4;i++)a[i][0]=r[2*i],a[i][1]=r[2*i+1];return a}return r}function VN(e){return e.kept?e:js(e)}var GN={};z(GN,{json:function(){return HN}});var HN=[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],qN={};z(qN,{json:function(){return KN}});var KN=[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsNan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsFinite",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsInf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],XN={};z(XN,{json:function(){return YN}});var YN=[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcatV2",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListLength",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}]},{tfOpName:"TensorListResize",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"size",type:"number"}]}],ZN={};z(ZN,{json:function(){return JN}});var JN=[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}],QN={};z(QN,{json:function(){return $N}});var $N=[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomStandardNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniformInt",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number"},{tfName:"maxval",name:"maxval",type:"number"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}],ej={};z(ej,{json:function(){return tj}});var tj=[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],nj={};z(nj,{json:function(){return rj}});var rj=[{tfOpName:"LowerBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"UpperBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}],aj={};z(aj,{json:function(){return ij}});var ij=[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}],oj={};z(oj,{json:function(){return sj}});var sj=[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableSize",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"LookupTableSizeV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"InitializeTable",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]},{tfOpName:"InitializeTableV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]}],uj={};z(uj,{json:function(){return cj}});var cj=[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]},{tfOpName:"ImageProjectiveTransformV3",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"transforms",type:"tensor"},{start:2,name:"outputShape",type:"number[]"},{start:3,name:"fillValue",type:"number"}],attrs:[{tfName:"interpolation",name:"interpolation",type:"string"},{tfName:"fill_mode",name:"fillMode",type:"string"}]}],lj={};z(lj,{json:function(){return dj}});var dj=[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BitwiseAnd",category:"logical",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}]}],pj={};z(pj,{json:function(){return fj}});var fj=[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Einsum",category:"matrices",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"equation",name:"equation",type:"string"},{tfName:"N",name:"n",type:"number",defaultValue:2},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"MatrixBandPart",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"numLower",type:"tensor"},{start:1,name:"numUpper",type:"tensor"}]}],hj={};z(hj,{json:function(){return mj}});var mj=[{tfOpName:"EuclideanNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",defaultValue:!1}]},{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]}],vj={};z(vj,{json:function(){return bj}});var bj=[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cumprod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}],gj={};z(gj,{json:function(){return yj}});var yj=[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]},{tfOpName:"TensorScatterUpdate",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"values",type:"tensor"}]}],xj={};z(xj,{json:function(){return kj}});var kj=[{tfOpName:"SparseFillEmptyRows",category:"sparse",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"denseShape",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}]},{tfOpName:"SparseReshape",category:"sparse",inputs:[{start:0,name:"inputIndices",type:"tensor"},{start:1,name:"inputShape",type:"tensor"},{start:2,name:"newShape",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SparseSegmentMean",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]},{tfOpName:"SparseSegmentSum",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]}],wj={};z(wj,{json:function(){return Oj}});var Oj=[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}],Ij={};z(Ij,{json:function(){return Sj}});var Sj=[{tfOpName:"StaticRegexReplace",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"pattern",name:"pattern",type:"string"},{tfName:"rewrite",name:"rewrite",type:"string"},{tfName:"replace_global",name:"replaceGlobal",type:"bool"}]},{tfOpName:"StringNGrams",category:"string",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"dataSplits",type:"tensor"}],attrs:[{tfName:"separator",name:"separator",type:"string"},{tfName:"ngram_widths",name:"nGramWidths",type:"number[]"},{tfName:"left_pad",name:"leftPad",type:"string"},{tfName:"right_pad",name:"rightPad",type:"string"},{tfName:"pad_width",name:"padWidth",type:"number"},{tfName:"preserve_short_sequences",name:"preserveShortSequences",type:"bool"}],outputs:["ngrams","ngrams_splits"]},{tfOpName:"StringSplit",category:"string",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"delimiter",type:"tensor"}],attrs:[{tfName:"skip_empty",name:"skipEmpty",type:"bool"}],outputs:["indices","values","shape"]},{tfOpName:"StringToHashBucketFast",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"num_buckets",name:"numBuckets",type:"number"}]}],Nj={};z(Nj,{json:function(){return jj}});var jj=[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"EnsureShape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]},{tfOpName:"BroadcastArgs",category:"transformation",inputs:[{start:0,name:"s0",type:"tensor"},{start:1,name:"s1",type:"tensor"}],attrs:[]}],Tj=function(){function e(){var t;Object(O.a)(this,e);var n=[GN,qN,XN,ZN,QN,ej,nj,aj,oj,uj,lj,pj,hj,vj,gj,xj,wj,Ij,Nj],r=(t=[]).concat.apply(t,Object(S.a)(n.map((function(e){return e.json}))));this.opMappers=r.reduce((function(e,t){return e[t.tfOpName]=t,e}),{})}return Object(I.a)(e,null,[{key:"Instance",get:function(){return this._instance||(this._instance=new this)}}]),Object(I.a)(e,[{key:"transformGraph",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.node,a=[],i=[],o=[],s=r.reduce((function(e,n){return e[n.name]=t.mapNode(n),n.op.startsWith("Placeholder")?a.push(e[n.name]):"Const"===n.op?i.push(e[n.name]):(null==n.input||0===n.input.length)&&o.push(e[n.name]),e}),{}),u=[],c=[],l={},d={};null!=n&&(l=this.mapSignatureEntries(n.inputs),d=this.mapSignatureEntries(n.outputs));var p=Object.keys(s);p.forEach((function(e){var t=s[e];t.inputNames.forEach((function(e,n){var r=PN(e),a=Object(y.a)(r,3),i=a[0],o=a[2],u=s[i];if(null!=u.outputs){var c=u.outputs.indexOf(o);if(-1!==c){var l="".concat(i,":").concat(c);t.inputNames[n]=l}}t.inputs.push(u),u.children.push(t)}))})),0===Object.keys(d).length?p.forEach((function(e){var t=s[e];0===t.children.length&&c.push(t)})):Object.keys(d).forEach((function(e){var t=PN(e),n=Object(y.a)(t,1)[0],r=s[n];null!=r&&(r.signatureKey=d[e],c.push(r))})),Object.keys(l).length>0?Object.keys(l).forEach((function(e){var t=PN(e),n=Object(y.a)(t,1)[0],r=s[n];r&&(r.signatureKey=l[e],u.push(r))})):u=a;var f={};null!=e.library&&null!=e.library.function&&(f=e.library.function.reduce((function(e,n){return e[n.signature.name]=t.mapFunction(n),e}),{}));var h={nodes:s,inputs:u,outputs:c,weights:i,placeholders:a,signature:n,functions:f};return o.length>0&&(h.initNodes=o),h}},{key:"mapSignatureEntries",value:function(e){return Object.keys(e||{}).reduce((function(t,n){return t[e[n].name]=n,t}),{})}},{key:"mapNode",value:function(e){var t=DN(e.op)||this.opMappers[e.op]||{};null==e.attr&&(e.attr={});var n={name:e.name,op:e.op,category:t.category,inputNames:(e.input||[]).map((function(e){return e.startsWith("^")?e.slice(1):e})),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:e.attr,outputs:t.outputs};return null!=t.inputs&&(n.inputParams=t.inputs.reduce((function(e,t){return e[t.name]={type:t.type,inputIndexStart:t.start,inputIndexEnd:t.end},e}),{})),null!=t.attrs&&(n.attrParams=t.attrs.reduce((function(t,n){var r,a=n.type;switch(n.type){case"string":void 0===(r=Ej(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=Ej(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"string[]":void 0===(r=Bj(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=Bj(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"number":void 0===(r=Aj(e.attr,n.tfName,n.defaultValue||0))&&n.tfDeprecatedName&&(r=Aj(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"number[]":void 0===(r=Pj(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=Pj(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool":void 0===(r=_j(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=_j(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool[]":void 0===(r=Uj(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=Uj(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape":void 0===(r=Lj(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=Lj(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape[]":void 0===(r=Wj(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=Wj(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype":void 0===(r=Fj(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=Fj(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype[]":void 0===(r=Mj(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=Mj(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"func":void 0===(r=Dj(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=Dj(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error("Unsupported param type: ".concat(n.type," for op: ").concat(e.op))}return t[n.name]={value:r,type:a},t}),{})),n}},{key:"mapFunction",value:function(e){var t=this,n=e.nodeDef,r=[],a={};null!=n&&(a=n.reduce((function(e,n){return e[n.name]=t.mapNode(n),"Const"===n.op&&r.push(e[n.name]),e}),{}));var i=[],o=[];e.signature.inputArg.forEach((function(e){var t=PN(e.name),n=Object(y.a)(t,1)[0],r={name:n,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:Rj(e.type),type:"dtype"}},children:[]};r.signatureKey=e.name,i.push(r),a[n]=r})),Object.keys(a).forEach((function(e){var t=a[e];t.inputNames.forEach((function(e,n){var r=PN(e),i=Object(y.a)(r,3),o=i[0],s=i[2],u=a[o];if(null!=u.outputs){var c=u.outputs.indexOf(s);if(-1!==c){var l="".concat(o,":").concat(c);t.inputNames[n]=l}}t.inputs.push(u),u.children.push(t)}))}));var s=e.ret;e.signature.outputArg.forEach((function(e){var t=PN(s[e.name]),n=Object(y.a)(t,2),r=n[0],i=n[1],u=a[r];null!=u&&(u.defaultOutput=i,o.push(u))}));var u=this.mapArgsToSignature(e);return{nodes:a,inputs:i,outputs:o,weights:r,placeholders:[],signature:u}}},{key:"mapArgsToSignature",value:function(e){var t=this;return{methodName:e.signature.name,inputs:e.signature.inputArg.reduce((function(e,n){return e[n.name]=t.mapArgToTensorInfo(n),e}),{}),outputs:e.signature.outputArg.reduce((function(n,r){return n[r.name]=t.mapArgToTensorInfo(r,e.ret),n}),{})}}},{key:"mapArgToTensorInfo",value:function(e,t){var n=e.name;return null!=t&&(n=t[n]),{name:n,dtype:e.type}}}]),e}();function Cj(e,t){var n=Array.isArray(e)?String.fromCharCode.apply(null,e):function(e){var t=st().global;if("undefined"!=typeof t.atob)return t.atob(e);if("undefined"!=typeof o)return new o(e,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}(e);return t?n:n.toLowerCase()}function Ej(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e[t];return null!=a?Cj(a.s,r):n}function _j(e,t,n){var r=e[t];return r?r.b:n}function Aj(e,t,n){var r=e[t]||{},a=null!=r.i?r.i:null!=r.f?r.f:n;return"number"==typeof a?a:parseInt(a,10)}function Rj(e){switch("string"==typeof e&&(e=CN[e]),e){case CN.DT_FLOAT:case CN.DT_HALF:return"float32";case CN.DT_INT32:case CN.DT_INT64:case CN.DT_INT8:case CN.DT_UINT8:return"int32";case CN.DT_BOOL:return"bool";case CN.DT_DOUBLE:return"float32";case CN.DT_STRING:return"string";default:return null}}function Dj(e,t,n){var r=e[t];return r&&r.func?r.func.name:n}function Fj(e,t,n){var r=e[t];return r&&r.type?Rj(r.type):n}function Mj(e,t,n){var r=e[t];return r&&r.list&&r.list.type?r.list.type.map((function(e){return Rj(e)})):n}function zj(e){if(!e.unknownRank)return null!=e.dim?e.dim.map((function(e){return"number"==typeof e.size?e.size:parseInt(e.size,10)})):[]}function Lj(e,t,n){var r=e[t];return r&&r.shape?zj(r.shape):n}function Pj(e,t,n){var r=e[t];return r?((r.list.f&&r.list.f.length?r.list.f:r.list.i)||[]).map((function(e){return"number"==typeof e?e:parseInt(e,10)})):n}function Bj(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e[t];return a&&a.list&&a.list.s?a.list.s.map((function(e){return Cj(e,r)})):n}function Wj(e,t,n){var r=e[t];return r&&r.list&&r.list.shape?r.list.shape.map((function(e){return zj(e)})):n}function Uj(e,t,n){var r=e[t];return r&&r.list&&r.list.b?r.list.b:n}var Vj=function(){function e(t,n,r){var a=this;Object(O.a)(this,e),this.node=t,this.tensorMap=n,this.context=r,this.inputs=[],this.attrs={},this.inputs=t.inputNames.map((function(e){return a.getInput(e)})),null!=t.rawAttrs&&(this.attrs=Object.keys(t.rawAttrs).reduce((function(e,t){return e[t]=a.getAttr(t),e}),{}))}return Object(I.a)(e,[{key:"getInput",value:function(e){return zN(e,this.tensorMap,this.context)}},{key:"getAttr",value:function(e,t){var n=this.node.rawAttrs[e];if(null!=n.tensor)return zN(e,this.tensorMap,this.context);if(null!=n.i||null!=n.f)return Aj(this.node.rawAttrs,e,t);if(null!=n.s)return Ej(this.node.rawAttrs,e,t);if(null!=n.b)return _j(this.node.rawAttrs,e,t);if(null!=n.shape)return Lj(this.node.rawAttrs,e,t);if(null!=n.type)return Fj(this.node.rawAttrs,e,t);if(null!=n.list){if(null!=n.list.i||null!=n.list.f)return Pj(this.node.rawAttrs,e,t);if(null!=n.list.s)return Bj(this.node.rawAttrs,e,t);if(null!=n.list.shape)return Wj(this.node.rawAttrs,e,t);if(null!=n.list.b)return Uj(this.node.rawAttrs,e,t);if(null!=n.list.type)return Mj(this.node.rawAttrs,e,t)}return t}}]),e}(),Gj={};z(Gj,{OP_SCOPE_SUFFIX:function(){return co},abs:function(){return eu},acos:function(){return tu},acosh:function(){return nu},add:function(){return Zs},addN:function(){return ru},all:function(){return au},any:function(){return iu},argMax:function(){return ou},argMin:function(){return su},asin:function(){return uu},asinh:function(){return cu},atan:function(){return lu},atan2:function(){return du},atanh:function(){return pu},avgPool:function(){return _u},avgPool3d:function(){return Au},basicLSTMCell:function(){return Lu},batchNorm:function(){return Wu},batchNorm2d:function(){return Uu},batchNorm3d:function(){return Vu},batchNorm4d:function(){return Gu},batchToSpaceND:function(){return Pu},bincount:function(){return Hu},bitwiseAnd:function(){return qu},booleanMaskAsync:function(){return Pp},broadcastArgs:function(){return Ku},broadcastTo:function(){return Xu},buffer:function(){return Ss},cast:function(){return Ns},ceil:function(){return Yu},clipByValue:function(){return Ju},clone:function(){return js},complex:function(){return po},concat:function(){return Ru},concat1d:function(){return Qu},concat2d:function(){return $u},concat3d:function(){return ec},concat4d:function(){return tc},conv1d:function(){return rc},conv2d:function(){return nc},conv2dTranspose:function(){return ic},conv3d:function(){return oc},conv3dTranspose:function(){return uc},cos:function(){return cc},cosh:function(){return lc},cosineWindow:function(){return Xp},cumprod:function(){return dc},cumsum:function(){return pc},denseBincount:function(){return fc},depthToSpace:function(){return hc},depthwiseConv2d:function(){return mc},diag:function(){return vc},dilation2d:function(){return bc},div:function(){return Qs},divNoNan:function(){return Sc},dot:function(){return Nc},dropout:function(){return qp},einsum:function(){return jc},elu:function(){return Tc},enclosingPowerOfTwo:function(){return Kp},ensureShape:function(){return Cc},equal:function(){return wc},erf:function(){return Ec},euclideanNorm:function(){return Xc},exp:function(){return Yc},expandDims:function(){return Zc},expm1:function(){return Jc},eye:function(){return $c},fft:function(){return op},fill:function(){return Zu},floor:function(){return el},floorDiv:function(){return Js},fused:function(){return Jp},gather:function(){return tl},gatherND:function(){return Hp},greater:function(){return nl},greaterEqual:function(){return rl},ifft:function(){return sp},imag:function(){return al},image:function(){return fh},inTopKAsync:function(){return Zp},irfft:function(){return up},isFinite:function(){return il},isInf:function(){return ol},isNaN:function(){return sl},leakyRelu:function(){return ul},less:function(){return cl},lessEqual:function(){return ll},linalg:function(){return hh},linspace:function(){return dl},localResponseNormalization:function(){return pl},log:function(){return fl},log1p:function(){return hl},logSigmoid:function(){return Il},logSoftmax:function(){return Nl},logSumExp:function(){return jl},logicalAnd:function(){return Tl},logicalNot:function(){return Cl},logicalOr:function(){return El},logicalXor:function(){return _l},losses:function(){return mh},lowerBound:function(){return Dl},matMul:function(){return Du},max:function(){return Pc},maxPool:function(){return Fl},maxPool3d:function(){return Ml},maxPoolWithArgmax:function(){return zl},maximum:function(){return Ll},mean:function(){return Pl},meshgrid:function(){return Ul},min:function(){return Bc},minimum:function(){return Vl},mirrorPad:function(){return Gl},mod:function(){return Hl},moments:function(){return ql},movingAverage:function(){return Wp},mul:function(){return $s},multiRNNCell:function(){return Kl},multinomial:function(){return Xl},neg:function(){return wl},norm:function(){return Kc},notEqual:function(){return Yl},oneHot:function(){return Zl},ones:function(){return Wl},onesLike:function(){return Jl},op:function(){return lo},outerProduct:function(){return Ql},pad:function(){return $l},pad1d:function(){return ed},pad2d:function(){return td},pad3d:function(){return nd},pad4d:function(){return rd},pool:function(){return id},pow:function(){return Wc},prelu:function(){return od},print:function(){return Ts},prod:function(){return sd},raggedGather:function(){return ud},raggedRange:function(){return cd},raggedTensorToTensor:function(){return ld},rand:function(){return dd},randomGamma:function(){return _d},randomNormal:function(){return Ad},randomStandardNormal:function(){return Rd},randomUniform:function(){return Dd},randomUniformInt:function(){return Fd},range:function(){return Md},real:function(){return zd},reciprocal:function(){return Ld},relu:function(){return Pd},relu6:function(){return Bd},reshape:function(){return Eu},reverse:function(){return Wd},reverse1d:function(){return Ud},reverse2d:function(){return Vd},reverse3d:function(){return Gd},reverse4d:function(){return Hd},rfft:function(){return lp},round:function(){return qd},rsqrt:function(){return Kd},scalar:function(){return Uc},scatterND:function(){return Up},searchSorted:function(){return Rl},selu:function(){return Xd},separableConv2d:function(){return Yd},setdiff1dAsync:function(){return Jd},sigmoid:function(){return Fu},sign:function(){return Qd},signal:function(){return ph},sin:function(){return $d},sinh:function(){return ep},slice:function(){return Mu},slice1d:function(){return tp},slice2d:function(){return np},slice3d:function(){return rp},slice4d:function(){return ap},softmax:function(){return ip},softplus:function(){return Ol},spaceToBatchND:function(){return ad},sparse:function(){return vh},sparseToDense:function(){return Gp},spectral:function(){return dh},split:function(){return cp},sqrt:function(){return Vc},square:function(){return Gc},squaredDifference:function(){return dp},squeeze:function(){return pp},stack:function(){return fp},step:function(){return hp},stridedSlice:function(){return mp},string:function(){return bh},sub:function(){return Sl},sum:function(){return Hc},tan:function(){return vp},tanh:function(){return zu},tensor:function(){return ho},tensor1d:function(){return bp},tensor2d:function(){return gp},tensor3d:function(){return yp},tensor4d:function(){return xp},tensor5d:function(){return kp},tensor6d:function(){return wp},tensorScatterUpdate:function(){return jp},tile:function(){return Qc},topk:function(){return Tp},transpose:function(){return Bp},truncatedNormal:function(){return Cp},unique:function(){return Ep},unsortedSegmentSum:function(){return _p},unstack:function(){return Ap},upperBound:function(){return Rp},variable:function(){return Dp},where:function(){return Oc},whereAsync:function(){return zp},zeros:function(){return Bl},zerosLike:function(){return Ic}});var Hj=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Gj;switch(e.op){case"BiasAdd":case"AddV2":case"Add":return[r.add(MN("a",e,t,n),MN("b",e,t,n))];case"AddN":return[r.addN(MN("tensors",e,t,n))];case"FloorMod":case"Mod":return[r.mod(MN("a",e,t,n),MN("b",e,t,n))];case"Mul":return[r.mul(MN("a",e,t,n),MN("b",e,t,n))];case"RealDiv":case"Div":return[r.div(MN("a",e,t,n),MN("b",e,t,n))];case"DivNoNan":return[r.divNoNan(MN("a",e,t,n),MN("b",e,t,n))];case"FloorDiv":return[r.floorDiv(MN("a",e,t,n),MN("b",e,t,n))];case"Sub":return[r.sub(MN("a",e,t,n),MN("b",e,t,n))];case"Minimum":return[r.minimum(MN("a",e,t,n),MN("b",e,t,n))];case"Maximum":return[r.maximum(MN("a",e,t,n),MN("b",e,t,n))];case"Pow":return[r.pow(MN("a",e,t,n),MN("b",e,t,n))];case"SquaredDifference":return[r.squaredDifference(MN("a",e,t,n),MN("b",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},qj=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Gj;switch(e.op){case"Abs":case"ComplexAbs":return[r.abs(MN("x",e,t,n))];case"Acos":return[r.acos(MN("x",e,t,n))];case"Acosh":return[r.acosh(MN("x",e,t,n))];case"Asin":return[r.asin(MN("x",e,t,n))];case"Asinh":return[r.asinh(MN("x",e,t,n))];case"Atan":return[r.atan(MN("x",e,t,n))];case"Atan2":return[r.atan2(MN("x",e,t,n),MN("y",e,t,n))];case"Atanh":return[r.atanh(MN("x",e,t,n))];case"Ceil":return[r.ceil(MN("x",e,t,n))];case"Complex":return[r.complex(MN("real",e,t,n),MN("imag",e,t,n))];case"Cos":return[r.cos(MN("x",e,t,n))];case"Cosh":return[r.cosh(MN("x",e,t,n))];case"Elu":return[r.elu(MN("x",e,t,n))];case"Erf":return[r.erf(MN("x",e,t,n))];case"Exp":return[r.exp(MN("x",e,t,n))];case"Expm1":return[r.expm1(MN("x",e,t,n))];case"Floor":return[r.floor(MN("x",e,t,n))];case"Log":return[r.log(MN("x",e,t,n))];case"Log1p":return[r.log1p(MN("x",e,t,n))];case"Imag":return[r.imag(MN("x",e,t,n))];case"Neg":return[r.neg(MN("x",e,t,n))];case"Reciprocal":return[r.reciprocal(MN("x",e,t,n))];case"Real":return[r.real(MN("x",e,t,n))];case"Relu":return[r.relu(MN("x",e,t,n))];case"Round":return[r.round(MN("x",e,t,n))];case"Selu":return[r.selu(MN("x",e,t,n))];case"Sigmoid":return[r.sigmoid(MN("x",e,t,n))];case"Sin":return[r.sin(MN("x",e,t,n))];case"Sign":return[r.sign(MN("x",e,t,n))];case"Sinh":return[r.sinh(MN("x",e,t,n))];case"Softplus":return[r.softplus(MN("x",e,t,n))];case"Sqrt":return[r.sqrt(MN("x",e,t,n))];case"Square":return[r.square(MN("x",e,t,n))];case"Tanh":return[r.tanh(MN("x",e,t,n))];case"Tan":return[r.tan(MN("x",e,t,n))];case"ClipByValue":return[r.clipByValue(MN("x",e,t,n),MN("clipValueMin",e,t,n),MN("clipValueMax",e,t,n))];case"Relu6":return[r.relu6(MN("x",e,t,n))];case"Rsqrt":return[r.rsqrt(zN(e.inputNames[0],t,n))];case"LeakyRelu":return[r.leakyRelu(MN("x",e,t,n),MN("alpha",e,t,n))];case"Prelu":return[r.prelu(MN("x",e,t,n),MN("alpha",e,t,n))];case"IsNan":return[r.isNaN(zN(e.inputNames[0],t,n))];case"IsInf":return[r.isInf(zN(e.inputNames[0],t,n))];case"IsFinite":return[r.isFinite(zN(e.inputNames[0],t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}};function Kj(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if("number"!=typeof e&&"number"!=typeof t){Ga.assert(e.length===t.length,(function(){return n+" Shapes ".concat(e," and ").concat(t," must match")}));for(var r=0;r<e.length;r++){var a=e[r],i=t[r];Ga.assert(a<0||i<0||a===i,(function(){return n+" Shapes ".concat(e," and ").concat(t," must match")}))}}}function Xj(e){return!("number"==typeof e||e.some((function(e){return e<0})))}function Yj(e,t,n){var r=Zj(e,n),a=!Xj(r);if(a&&0===t.length)throw new Error("Tried to calculate elements of an empty list with non-fully-defined elementShape: ".concat(r));if(a&&t.forEach((function(e){r=Zj(e.shape,r)})),!Xj(r))throw new Error("Non-fully-defined elementShape: ".concat(r));return r}function Zj(e,t){if("number"==typeof e)return t;if("number"==typeof t)return e;if(e.length!==t.length)throw new Error("Incompatible ranks during merge: ".concat(e," vs. ").concat(t));for(var n=[],r=0;r<e.length;++r){var a=e[r],i=t[r];if(a>=0&&i>=0&&a!==i)throw new Error("Incompatible shape during merge: ".concat(e," vs. ").concat(t));n[r]=a>=0?a:i}return n}var Jj=function(){function e(t,n,r,a,i,o,s){Object(O.a)(this,e),this.name=t,this.dtype=n,this.maxSize=r,this.elementShape=a,this.identicalElementShapes=i,this.dynamicSize=o,this.clearAfterRead=s,this.tensors=[],this.closed_=!1,this.idTensor=Uc(0),Ps(this.idTensor)}return Object(I.a)(e,[{key:"clearAndClose",value:function(e){this.tensors.forEach((function(t){(null==e||!e.has(t.tensor.id))&&t.tensor.dispose()})),this.tensors=[],this.closed_=!0,this.idTensor.dispose()}},{key:"size",value:function(){return this.tensors.length}},{key:"read",value:function(e){if(this.closed_)throw new Error("TensorArray ".concat(this.name," has already been closed."));if(e<0||e>=this.size())throw new Error("Tried to read from index ".concat(e,", but array size is: ").concat(this.size()));var t=this.tensors[e];if(t.cleared)throw new Error("TensorArray ".concat(this.name,": Could not read index ").concat(e," twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?)."));return this.clearAfterRead&&(t.cleared=!0),t.read=!0,t.tensor}},{key:"readMany",value:function(e){var t=this;return e.map((function(e){return t.read(e)}))}},{key:"write",value:function(e,t){if(this.closed_)throw new Error("TensorArray ".concat(this.name," has already been closed."));if(e<0||!this.dynamicSize&&e>=this.maxSize)throw new Error("Tried to write to index ".concat(e,", but array is not resizeable and size is: ").concat(this.maxSize));var n=this.tensors[e]||{};if(t.dtype!==this.dtype)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,",\n          because the value dtype is ").concat(t.dtype,", but TensorArray dtype is ").concat(this.dtype,"."));if(0===this.size()&&(null==this.elementShape||0===this.elementShape.length)&&(this.elementShape=t.shape),Kj(this.elementShape,t.shape,"TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,".")),n.read)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,", because it has already been read."));if(n.written)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,", because it has already been written."));n.tensor=t,Ps(t),n.written=!0,this.tensors[e]=n}},{key:"writeMany",value:function(e,t){var n=this;if(e.length!==t.length)throw new Error("TensorArray ".concat(this.name,": could not write multiple tensors,because the index size: ").concat(e.length," is not the same as tensors size: ").concat(t.length,"."));e.forEach((function(e,r){return n.write(e,t[r])}))}},{key:"gather",value:function(e,t){if(t&&t!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but gather requested dtype ").concat(t));if(e)e=e.slice(0,this.size());else{e=[];for(var n=0;n<this.size();n++)e.push(n)}if(0===e.length)return ho([],[0].concat(this.elementShape));var r=this.readMany(e);return Kj(this.elementShape,r[0].shape,"TensorArray shape mismatch: "),fp(r,0)}},{key:"concat",value:function(e){if(e&&e!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but concat requested dtype ").concat(e));if(0===this.size())return ho([],[0].concat(this.elementShape));for(var t=[],n=0;n<this.size();n++)t.push(n);var r=this.readMany(t);return Kj(this.elementShape,r[0].shape,"TensorArray shape mismatch: tensor array shape (".concat(this.elementShape,") vs first tensor shape (").concat(r[0].shape,")")),Ru(r,0)}},{key:"scatter",value:function(e,t){if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but tensor has dtype ").concat(t.dtype));if(e.length!==t.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: ".concat(e.length," vs. ").concat(t.shape[0]));var n=Math.max.apply(Math,Object(S.a)(e));if(!this.dynamicSize&&n>=this.maxSize)throw new Error("Max index must be < array size (".concat(n,"  vs. ").concat(this.maxSize,")"));this.writeMany(e,Ap(t,0))}},{key:"split",value:function(e,t){var n=this;if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but tensor has dtype ").concat(t.dtype));var r=0,a=e.map((function(e){return r+=e}));if(r!==t.shape[0])throw new Error("Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ".concat(r,", and tensor's shape is: ").concat(t.shape));if(!this.dynamicSize&&e.length!==this.maxSize)throw new Error("TensorArray's size is not equal to the size of lengths (".concat(this.maxSize," vs. ").concat(e.length,"), and the TensorArray is not marked as dynamically resizeable"));var i=0===r?0:t.size/r,o=[];zs((function(){t=Eu(t,[1,r,i]);for(var s=0;s<e.length;++s){var u=[0,0===s?0:a[s-1],0],c=[1,e[s],i];o[s]=Eu(Mu(t,u,c),n.elementShape)}return o}));for(var s=[],u=0;u<e.length;u++)s[u]=u;this.writeMany(s,o)}},{key:"id",get:function(){return this.idTensor.id}},{key:"closed",get:function(){return this.closed_}}]),e}(),Qj=function(){function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1;Object(O.a)(this,e),this.tensors=t,this.elementShape=n,this.elementDtype=r,null!=t&&t.forEach((function(e){if(r!==e.dtype)throw new Error("Invalid data types; op elements ".concat(r,", but list elements ").concat(e.dtype));Kj(n,e.shape,"TensorList shape mismatch: "),Ps(e)})),this.idTensor=Uc(0),this.maxNumElements=a,Ps(this.idTensor)}return Object(I.a)(e,[{key:"id",get:function(){return this.idTensor.id}}]),Object(I.a)(e,[{key:"copy",value:function(){return new e(Object(S.a)(this.tensors),this.elementShape,this.elementDtype)}},{key:"clearAndClose",value:function(e){this.tensors.forEach((function(t){(null==e||!e.has(t.id))&&t.dispose()})),this.tensors.length=0,this.idTensor.dispose()}},{key:"size",value:function(){return this.tensors.length}},{key:"stack",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));if(-1!==r&&this.tensors.length!==r)throw new Error("Operation expected a list with ".concat(r," elements but got a list with ").concat(this.tensors.length," elements."));Kj(e,this.elementShape,"TensorList shape mismatch: ");var a=Yj(this.elementShape,this.tensors,e);return zs((function(){var e=n.tensors.map((function(e){return Eu(e,a)}));return fp(e,0)}))}},{key:"popBack",value:function(e,t){if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));if(0===this.size())throw new Error("Trying to pop from an empty list.");var n=Yj(this.elementShape,this.tensors,e),r=this.tensors.pop();return r.kept=!1,Kj(r.shape,e,"TensorList shape mismatch: "),Eu(r,n)}},{key:"pushBack",value:function(e){if(e.dtype!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(e.dtype,", but list elements ").concat(this.elementDtype));if(Kj(e.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");Ps(e),this.tensors.push(e)}},{key:"resize",value:function(t){if(t<0)throw new Error("TensorListResize expects size to be non-negative. Got: ".concat(t));if(-1!==this.maxNumElements&&t>this.maxNumElements)throw new Error("TensorListResize input size ".concat(t," is greater maxNumElement ").concat(this.maxNumElements,"."));var n=new e([],this.elementShape,this.elementDtype,this.maxNumElements);n.tensors.length=t;for(var r=0;r<Math.min(this.tensors.length,t);++r)n.tensors[r]=this.tensors[r];return n}},{key:"getItem",value:function(e,t,n){if(n!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(n,", but list elements ").concat(this.elementDtype));if(e<0||e>this.tensors.length)throw new Error("Trying to access element ".concat(e," in a list with ").concat(this.tensors.length," elements."));if(null==this.tensors[e])throw new Error("element at index ".concat(e," is null."));Kj(this.tensors[e].shape,t,"TensorList shape mismatch: ");var r=Yj(this.elementShape,this.tensors,t);return Eu(this.tensors[e],r)}},{key:"setItem",value:function(e,t){if(t.dtype!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t.dtype,", but list elements ").concat(this.elementDtype));if(e<0||-1!==this.maxNumElements&&e>=this.maxNumElements)throw new Error("Trying to set element ".concat(e," in a list with max ").concat(this.maxNumElements," elements."));Kj(this.elementShape,t.shape,"TensorList shape mismatch: "),Ps(t),null!=this.tensors[e]&&(this.tensors[e].kept=!1),this.tensors[e]=t}},{key:"gather",value:function(e,t,n){var r=this;if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));Kj(this.elementShape,n,"TensorList shape mismatch: "),e=e.slice(0,this.size());var a=Yj(this.elementShape,this.tensors,n);return 0===e.length?ho([],[0].concat(a)):zs((function(){var t=e.map((function(e){return Eu(r.tensors[e],a)}));return fp(t,0)}))}},{key:"concat",value:function(e,t){var n=this;if(e&&e!==this.elementDtype)throw new Error("TensorList dtype is ".concat(this.elementDtype," but concat requested dtype ").concat(e));Kj(this.elementShape,t,"TensorList shape mismatch: ");var r=Yj(this.elementShape,this.tensors,t);return 0===this.size()?ho([],[0].concat(r)):zs((function(){var e=n.tensors.map((function(e){return Eu(e,r)}));return Ru(e,0)}))}}]),e}();function $j(e,t,n){var r=e.dtype;if(e.shape.length<1)throw new Error("Tensor must be at least a vector, but saw shape: ".concat(e.shape));if(e.dtype!==n)throw new Error("Invalid data types; op elements ".concat(e.dtype,", but list elements ").concat(n));Kj(e.shape.slice(1),t,"TensorList shape mismatch: ");var a=Ap(e);return new Qj(a,t,r)}function eT(e,t,n,r){return new Qj([],e,t,r)}function tT(e,t,n,r){if(t.length!==e.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: ".concat(t.length," vs. ").concat(e.shape[0]));var a=Math.max.apply(Math,Object(S.a)(t));if(null!=r&&-1!==r&&a>=r)throw new Error("Max index must be < array size (".concat(a,"  vs. ").concat(r,")"));var i=new Qj([],n,e.dtype,r),o=Ap(e,0);return t.forEach((function(e,t){i.setItem(e,o[t])})),i}function nT(e,t,n){var r=0,a=t.map((function(e){return r+=e}));if(r!==e.shape[0])throw new Error("Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ".concat(r,", and tensor's shape is: ").concat(e.shape));for(var i=Zj(e.shape.slice(1),n),o=0===r?0:e.size/r,s=zs((function(){var n=[];e=Eu(e,[1,r,o]);for(var s=0;s<t.length;++s){var u=[0,0===s?0:a[s-1],0],c=[1,t[s],o];n[s]=Eu(Mu(e,u,c),i)}return e.dispose(),n})),u=new Qj([],n,e.dtype,t.length),c=0;c<s.length;c++)u.setItem(c,s[c]);return u}var rT=function(){var e=Object(w.a)(k.a.mark((function e(t,n,r){var a,i,o,s,u,c,l,d,p,f,h,m,v,b,g,y,x,w,O,I,S,N,j,T,C,E,_,A,R,D,F,M,z,L,P,B,W,U,V,G,H,q,K,X,Y,Z,J,Q,$,ee,te,ne,re,ae,ie,oe,se,ue,ce,le,de,pe,fe,he,me,ve,be,ge,ye,xe,ke,we,Oe,Ie,Se,Ne,je,Te,Ce,Ee,_e,Ae,Re,De,Fe,Me,ze,Le,Pe,Be,We,Ue,Ve,Ge,He,qe;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.op,e.next="If"===e.t0||"StatelessIf"===e.t0?3:"While"===e.t0||"StatelessWhile"===e.t0?12:"LoopCond"===e.t0?16:"Switch"===e.t0?18:"Merge"===e.t0?28:"Enter"===e.t0?33:"Exit"===e.t0?35:"NextIteration"===e.t0?37:"TensorArrayV3"===e.t0?39:"TensorArrayWriteV3"===e.t0?41:"TensorArrayReadV3"===e.t0?43:"TensorArrayGatherV3"===e.t0?45:"TensorArrayScatterV3"===e.t0?47:"TensorArrayConcatV3"===e.t0?49:"TensorArraySplitV3"===e.t0?51:"TensorArraySizeV3"===e.t0?53:"TensorArrayCloseV3"===e.t0?55:"TensorListSetItem"===e.t0?57:"TensorListGetItem"===e.t0?59:"TensorListScatterV2"===e.t0||"TensorListScatter"===e.t0?61:"TensorListReserve"===e.t0||"EmptyTensorList"===e.t0?63:"TensorListGather"===e.t0?67:"TensorListStack"===e.t0?69:"TensorListFromTensor"===e.t0?71:"TensorListConcat"===e.t0||"TensorListConcatV2"===e.t0?73:"TensorListPushBack"===e.t0?75:"TensorListPopBack"===e.t0?77:"TensorListSplit"===e.t0?79:"TensorListLength"===e.t0?81:"TensorListResize"===e.t0?83:85;break;case 3:return a=MN("thenBranch",t,n,r),i=MN("elseBranch",t,n,r),o=MN("cond",t,n,r),s=MN("args",t,n,r),e.next=6,o.data();case 6:if(!e.sent[0]){e.next=10;break}e.t1=r.functionMap[a].executeFunctionAsync(s,r.tensorArrayMap,r.tensorListMap),e.next=11;break;case 10:e.t1=r.functionMap[i].executeFunctionAsync(s,r.tensorArrayMap,r.tensorListMap);case 11:return e.abrupt("return",e.t1);case 12:return e.delegateYield(k.a.mark((function e(){var a,i,o,s,u,c,l,d;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=MN("body",t,n,r),i=MN("cond",t,n,r),o=MN("args",t,n,r),e.next=5,r.functionMap[i].executeFunctionAsync(o,r.tensorArrayMap,r.tensorListMap);case 5:return s=e.sent,u=o.map((function(e){return e.id})),e.next=9,s[0].data();case 9:c=e.sent,s.forEach((function(e){!e.kept&&-1===u.indexOf(e.id)&&e.dispose()})),l=o,d=k.a.mark((function e(){var t,n,o;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=l,e.next=3,r.functionMap[a].executeFunctionAsync(l,r.tensorArrayMap,r.tensorListMap);case 3:return l=e.sent,n=l.map((function(e){return e.id})),t.forEach((function(e){!e.kept&&-1===u.indexOf(e.id)&&-1===n.indexOf(e.id)&&e.dispose()})),e.next=8,r.functionMap[i].executeFunctionAsync(l,r.tensorArrayMap,r.tensorListMap);case 8:return o=e.sent,e.next=11,o[0].data();case 11:c=e.sent,o.forEach((function(e){!e.kept&&-1===u.indexOf(e.id)&&-1===n.indexOf(e.id)&&e.dispose()}));case 13:case"end":return e.stop()}}),e)}));case 13:if(!c[0]){e.next=17;break}return e.delegateYield(d(),"t0",15);case 15:e.next=13;break;case 17:return e.abrupt("return",{v:l});case 18:case"end":return e.stop()}}),e)}))(),"t2",13);case 13:if("object"!==typeof(u=e.t2)){e.next=16;break}return e.abrupt("return",u.v);case 16:return c=MN("pred",t,n,r),e.abrupt("return",[VN(c)]);case 18:return l=MN("pred",t,n,r),(d=MN("data",t,n,r)).kept||(d=VN(d)),e.next=22,l.data();case 22:if(!e.sent[0]){e.next=26;break}e.t3=[void 0,d],e.next=27;break;case 26:e.t3=[d,void 0];case 27:return e.abrupt("return",e.t3);case 28:if(!(p=t.inputNames.find((function(e){return void 0!==zN(e,n,r)})))){e.next=32;break}return f=zN(p,n,r),e.abrupt("return",[VN(f)]);case 32:return e.abrupt("return");case 33:return h=MN("frameName",t,n,r),m=MN("tensor",t,n,r),e.abrupt("return",(r.enterFrame(h),[VN(m)]));case 35:return v=MN("tensor",t,n,r),e.abrupt("return",(r.exitFrame(),[VN(v)]));case 37:return b=MN("tensor",t,n,r),e.abrupt("return",(r.nextIteration(),[VN(b)]));case 39:return g=MN("size",t,n,r),y=MN("dtype",t,n,r),x=MN("elementShape",t,n,r),w=MN("dynamicSize",t,n,r),O=MN("clearAfterRead",t,n,r),I=MN("identicalElementShapes",t,n,r),S=MN("name",t,n,r),N=new Jj(S,y,g,x,I,w,O),e.abrupt("return",(r.addTensorArray(N),[N.idTensor,Uc(1)]));case 41:return j=MN("tensorArrayId",t,n,r),T=MN("index",t,n,r),C=MN("tensor",t,n,r),E=r.getTensorArray(j.id),e.abrupt("return",(E.write(T,C),[E.idTensor]));case 43:return _=MN("tensorArrayId",t,n,r),A=MN("index",t,n,r),e.abrupt("return",[r.getTensorArray(_.id).read(A)]);case 45:return R=MN("tensorArrayId",t,n,r),D=MN("indices",t,n,r),F=MN("dtype",t,n,r),e.abrupt("return",[r.getTensorArray(R.id).gather(D,F)]);case 47:return M=MN("tensorArrayId",t,n,r),z=MN("indices",t,n,r),L=MN("tensor",t,n,r),P=r.getTensorArray(M.id),e.abrupt("return",(P.scatter(z,L),[P.idTensor]));case 49:return B=MN("tensorArrayId",t,n,r),W=r.getTensorArray(B.id),U=MN("dtype",t,n,r),e.abrupt("return",[W.concat(U)]);case 51:return V=MN("tensorArrayId",t,n,r),G=MN("tensor",t,n,r),H=MN("lengths",t,n,r),q=r.getTensorArray(V.id),e.abrupt("return",(q.split(H,G),[q.idTensor]));case 53:return K=MN("tensorArrayId",t,n,r),X=r.getTensorArray(K.id),e.abrupt("return",[Uc(X.size(),"int32")]);case 55:return Y=MN("tensorArrayId",t,n,r),Z=r.getTensorArray(Y.id),e.abrupt("return",(Z.clearAndClose(),[Z.idTensor]));case 57:return J=MN("tensorListId",t,n,r),Q=MN("index",t,n,r),$=MN("tensor",t,n,r),ee=r.getTensorList(J.id),e.abrupt("return",(ee.setItem(Q,$),[ee.idTensor]));case 59:return te=MN("tensorListId",t,n,r),ne=MN("index",t,n,r),re=MN("elementShape",t,n,r),ae=MN("elementDType",t,n,r),e.abrupt("return",[r.getTensorList(te.id).getItem(ne,re,ae)]);case 61:return ie=MN("indices",t,n,r),oe=MN("tensor",t,n,r),se=MN("elementShape",t,n,r),ue=MN("numElements",t,n,r),ce=tT(oe,ie,se,ue),e.abrupt("return",(r.addTensorList(ce),[ce.idTensor]));case 63:return le=MN("elementShape",t,n,r),de=MN("elementDType",t,n,r),pe="TensorListReserve"===t.op?"numElements":"maxNumElements",fe=MN(pe,t,n,r),he="TensorListReserve"===t.op?-1:fe,me=eT(le,de,0,he),e.abrupt("return",(r.addTensorList(me),[me.idTensor]));case 67:return ve=MN("tensorListId",t,n,r),be=MN("indices",t,n,r),ge=MN("elementShape",t,n,r),ye=MN("elementDType",t,n,r),e.abrupt("return",[r.getTensorList(ve.id).gather(be,ye,ge)]);case 69:return xe=MN("tensorListId",t,n,r),ke=MN("elementShape",t,n,r),we=MN("elementDType",t,n,r),Oe=MN("numElements",t,n,r),e.abrupt("return",[r.getTensorList(xe.id).stack(ke,we,Oe)]);case 71:return Ie=MN("tensor",t,n,r),Se=MN("elementShape",t,n,r),Ne=MN("elementDType",t,n,r),je=$j(Ie,Se,Ne),e.abrupt("return",(r.addTensorList(je),[je.idTensor]));case 73:return Te=MN("tensorListId",t,n,r),Ce=r.getTensorList(Te.id),Ee=MN("dtype",t,n,r),_e=MN("elementShape",t,n,r),e.abrupt("return",[Ce.concat(Ee,_e)]);case 75:return Ae=MN("tensorListId",t,n,r),Re=MN("tensor",t,n,r),De=r.getTensorList(Ae.id),e.abrupt("return",(De.pushBack(Re),[De.idTensor]));case 77:return Fe=MN("tensorListId",t,n,r),Me=MN("elementShape",t,n,r),ze=MN("elementDType",t,n,r),e.abrupt("return",[r.getTensorList(Fe.id).popBack(Me,ze)]);case 79:return Le=MN("tensor",t,n,r),Pe=MN("elementShape",t,n,r),Be=MN("lengths",t,n,r),We=nT(Le,Be,Pe),e.abrupt("return",(r.addTensorList(We),[We.idTensor]));case 81:return Ue=MN("tensorListId",t,n,r),Ve=r.getTensorList(Ue.id),e.abrupt("return",[Uc(Ve.size(),"int32")]);case 83:return Ge=MN("tensorListId",t,n,r),He=MN("size",t,n,r),qe=r.getTensorList(Ge.id).resize(He),e.abrupt("return",(r.addTensorList(qe),[qe.idTensor]));case 85:throw TypeError("Node type ".concat(t.op," is not implemented"));case 86:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}();function aT(e,t,n){var r=MN("fusedOps",e,t,n),a=Object(y.a)(r,2),i=a[0],o=a[1],s="biasadd"===i,u=!s,c="prelu"===o,l="fusedbatchnorm"===i,d=MN("numArgs",e,t,n);if(s){if(c&&2!==d)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!c&&s&&1!==d)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(l)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported");var p=MN("strides",e,t,n),f=UN(e,t,n),h=MN("dataFormat",e,t,n).toUpperCase(),m=MN("dilations",e,t,n),v=MN("args",e,t,n),b=Object(y.a)(v,2),g=b[0],x=b[1];return u&&(x=g,g=void 0),{stride:p,pad:f,dataFormat:h,dilations:m,biasArg:g,preluArg:x,activationFunc:o,leakyreluAlpha:MN("leakyreluAlpha",e,t,n)}}var iT=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Gj;switch(e.op){case"Conv1D":var a=MN("stride",e,t,n),i=MN("pad",e,t,n),o=MN("dataFormat",e,t,n).toUpperCase(),s=MN("dilation",e,t,n);return[r.conv1d(MN("x",e,t,n),MN("filter",e,t,n),a,i,o,s)];case"Conv2D":var u=MN("strides",e,t,n),c=UN(e,t,n),l=MN("dataFormat",e,t,n).toUpperCase(),d=MN("dilations",e,t,n);return[r.conv2d(MN("x",e,t,n),MN("filter",e,t,n),[u[1],u[2]],c,l,[d[1],d[2]])];case"_FusedConv2D":var p=aT(e,t,n),f=p.stride,h=p.pad,m=p.dataFormat,v=p.dilations,b=p.biasArg,g=p.preluArg,y=p.activationFunc,x=p.leakyreluAlpha;return[r.fused.conv2d({x:MN("x",e,t,n),filter:MN("filter",e,t,n),strides:[f[1],f[2]],pad:h,dataFormat:m,dilations:[v[1],v[2]],bias:b,activation:y,preluActivationWeights:g,leakyreluAlpha:x})];case"FusedDepthwiseConv2dNative":var k=aT(e,t,n),w=k.stride,O=k.pad,I=k.dataFormat,S=k.dilations,N=k.biasArg,j=k.preluArg,T=k.activationFunc,C=k.leakyreluAlpha;return[r.fused.depthwiseConv2d({x:MN("x",e,t,n),filter:MN("filter",e,t,n),strides:[w[1],w[2]],pad:O,dataFormat:I,dilations:[S[1],S[2]],bias:N,activation:T,preluActivationWeights:j,leakyreluAlpha:C})];case"Conv2DBackpropInput":case"Conv2dTranspose":var E=MN("outputShape",e,t,n),_=MN("strides",e,t,n),A=UN(e,t,n);return[r.conv2dTranspose(MN("x",e,t,n),MN("filter",e,t,n),E,[_[1],_[2]],A)];case"DepthwiseConv2dNative":case"DepthwiseConv2d":var R=MN("strides",e,t,n),D=UN(e,t,n),F=MN("dilations",e,t,n),M=MN("dataFormat",e,t,n).toUpperCase();return[r.depthwiseConv2d(MN("input",e,t,n),MN("filter",e,t,n),[R[1],R[2]],D,M,[F[1],F[2]])];case"Conv3D":var z=MN("strides",e,t,n),L=MN("pad",e,t,n),P=MN("dataFormat",e,t,n).toUpperCase(),B=MN("dilations",e,t,n);return[r.conv3d(MN("x",e,t,n),MN("filter",e,t,n),[z[1],z[2],z[3]],L,P,[B[1],B[2],B[3]])];case"AvgPool":var W=MN("strides",e,t,n),U=MN("pad",e,t,n),V=MN("kernelSize",e,t,n);return[r.avgPool(MN("x",e,t,n),[V[1],V[2]],[W[1],W[2]],U)];case"MaxPool":var G=MN("strides",e,t,n),H=MN("pad",e,t,n),q=MN("kernelSize",e,t,n);return[r.maxPool(MN("x",e,t,n),[q[1],q[2]],[G[1],G[2]],H)];case"MaxPoolWithArgmax":var K=MN("strides",e,t,n),X=MN("pad",e,t,n),Y=MN("kernelSize",e,t,n),Z=MN("includeBatchInIndex",e,t,n),J=r.maxPoolWithArgmax(MN("x",e,t,n),[Y[1],Y[2]],[K[1],K[2]],X,Z),Q=J.result,$=J.indexes;return[Q,$];case"AvgPool3D":var ee=MN("strides",e,t,n),te=MN("pad",e,t,n),ne=MN("kernelSize",e,t,n);return[r.avgPool3d(MN("x",e,t,n),[ne[1],ne[2],ne[3]],[ee[1],ee[2],ee[3]],te)];case"MaxPool3D":var re=MN("strides",e,t,n),ae=MN("pad",e,t,n),ie=MN("kernelSize",e,t,n);return[r.maxPool3d(MN("x",e,t,n),[ie[1],ie[2],ie[3]],[re[1],re[2],re[3]],ae)];case"Dilation2D":var oe=MN("strides",e,t,n),se=MN("pad",e,t,n),ue=MN("dilations",e,t,n),ce=oe[1],le=oe[2],de=ue[1],pe=ue[2];return[r.dilation2d(MN("x",e,t,n),MN("filter",e,t,n),[ce,le],se,[de,pe],"NHWC")];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},oT=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Gj;switch(e.op){case"Fill":var a=MN("shape",e,t,n),i=MN("dtype",e,t,n),o=MN("value",e,t,n);return[r.fill(a,o,i)];case"LinSpace":var s=MN("start",e,t,n),u=MN("stop",e,t,n),c=MN("num",e,t,n);return[r.linspace(s,u,c)];case"Multinomial":var l=MN("logits",e,t,n),d=MN("numSamples",e,t,n),p=MN("seed",e,t,n);return[r.multinomial(l,d,p)];case"OneHot":var f=MN("indices",e,t,n),h=MN("depth",e,t,n),m=MN("onValue",e,t,n),v=MN("offValue",e,t,n),b=MN("dtype",e,t,n);return[r.oneHot(f,h,m,v,b)];case"Ones":return[r.ones(MN("shape",e,t,n),MN("dtype",e,t,n))];case"OnesLike":return[r.onesLike(MN("x",e,t,n))];case"RandomStandardNormal":return[r.randomStandardNormal(MN("shape",e,t,n),MN("dtype",e,t,n),MN("seed",e,t,n))];case"RandomUniform":return[r.randomUniform(MN("shape",e,t,n),MN("minval",e,t,n),MN("maxval",e,t,n),MN("dtype",e,t,n))];case"RandomUniformInt":return[r.randomUniformInt(MN("shape",e,t,n),MN("minval",e,t,n),MN("maxval",e,t,n),MN("seed",e,t,n))];case"Range":var g=MN("start",e,t,n),y=MN("stop",e,t,n),x=MN("step",e,t,n);return[r.range(g,y,x,MN("dtype",e,t,n))];case"TruncatedNormal":var k=MN("shape",e,t,n),w=MN("mean",e,t,n),O=MN("stdDev",e,t,n),I=MN("seed",e,t,n);return[r.truncatedNormal(k,w,O,MN("dtype",e,t,n),I)];case"Zeros":return[r.zeros(MN("shape",e,t,n),MN("dtype",e,t,n))];case"ZerosLike":return[r.zerosLike(MN("x",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}};function sT(e,t,n){return{boxes:MN("boxes",e,t,n),scores:MN("scores",e,t,n),maxOutputSize:MN("maxOutputSize",e,t,n),iouThreshold:MN("iouThreshold",e,t,n),scoreThreshold:MN("scoreThreshold",e,t,n),softNmsSigma:MN("softNmsSigma",e,t,n)}}var uT=function(){var e=Object(w.a)(k.a.mark((function e(t,n,r,a){var i,o,s,u,c,l,d,p,f,h,m,v,b,g,y,x,w,O,I,S,N,j,T,C,E,_=arguments;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=_.length>4&&void 0!==_[4]?_[4]:Gj,e.t0=t.op,e.next="NonMaxSuppressionV5"===e.t0?4:"NonMaxSuppressionV4"===e.t0?15:"NonMaxSuppressionV3"===e.t0||"NonMaxSuppressionV2"===e.t0?26:"Where"===e.t0?31:"ListDiff"===e.t0?37:38;break;case 4:return o=sT(t,n,r),s=o.boxes,u=o.scores,c=o.maxOutputSize,l=o.iouThreshold,d=o.scoreThreshold,p=o.softNmsSigma,e.next=13,i.image.nonMaxSuppressionWithScoreAsync(s,u,c,l,d,p);case 13:return f=e.sent,e.abrupt("return",[f.selectedIndices,f.selectedScores]);case 15:return h=sT(t,n,r),m=h.boxes,v=h.scores,b=h.maxOutputSize,g=h.iouThreshold,y=h.scoreThreshold,x=MN("padToMaxOutputSize",t,n,r),e.next=24,i.image.nonMaxSuppressionPaddedAsync(m,v,b,g,y,x);case 24:return w=e.sent,e.abrupt("return",[w.selectedIndices,w.validOutputs]);case 26:return O=sT(t,n,r),I=O.boxes,S=O.scores,N=O.maxOutputSize,j=O.iouThreshold,T=O.scoreThreshold,e.next=29,i.image.nonMaxSuppressionAsync(I,S,N,j,T);case 29:return e.t1=e.sent,e.abrupt("return",[e.t1]);case 31:return C=i.cast(MN("condition",t,n,r),"bool"),e.next=34,i.whereAsync(C);case 34:return e.t2=e.sent,E=[e.t2],e.abrupt("return",(C.dispose(),E));case 37:return e.abrupt("return",i.setdiff1dAsync(MN("x",t,n,r),MN("y",t,n,r)));case 38:throw TypeError("Node type ".concat(t.op," is not implemented"));case 39:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}(),cT=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Gj;switch(e.op){case"LowerBound":var a=MN("sortedSequence",e,t,n),i=MN("values",e,t,n);return[r.lowerBound(a,i)];case"TopKV2":var o=MN("x",e,t,n),s=MN("k",e,t,n),u=MN("sorted",e,t,n),c=r.topk(o,s,u);return[c.values,c.indices];case"UpperBound":var l=MN("sortedSequence",e,t,n),d=MN("values",e,t,n);return[r.upperBound(l,d)];case"Unique":var p=MN("x",e,t,n),f=r.unique(p);return[f.values,f.indices];case"UniqueV2":var h=MN("x",e,t,n),m=MN("axis",e,t,n),v=r.unique(h,m);return[v.values,v.indices];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},lT=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Gj;switch(e.op){case"Const":return t[e.name];case"PlaceholderWithDefault":var a=MN("default",e,t,n);return[zN(e.name,t,n)||a];case"Placeholder":return[zN(e.name,t,n)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":var i=MN("x",e,t,n);return[VN(i)];case"IdentityN":return MN("x",e,t,n).map((function(e){return VN(e)}));case"Snapshot":var o=MN("x",e,t,n);return[VN(o)];case"Shape":return[r.tensor1d(MN("x",e,t,n).shape,"int32")];case"ShapeN":return MN("x",e,t,n).map((function(e){return r.tensor1d(e.shape)}));case"Size":return[r.scalar(MN("x",e,t,n).size,"int32")];case"Rank":return[r.scalar(MN("x",e,t,n).rank,"int32")];case"NoOp":return[r.scalar(1)];case"Print":var s=MN("x",e,t,n),u=MN("data",e,t,n),c=MN("message",e,t,n),l=MN("summarize",e,t,n);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(c);for(var d=0;d<u.length;d++)console.log(Array.prototype.slice.call(u[d].dataSync()).slice(0,l));return[s];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},dT=function(){function e(t,n){Object(O.a)(this,e),this.keyDType=t,this.valueDType=n,this.handle=Uc(0),this.tensorMap=new Map,Ps(this.handle)}return Object(I.a)(e,[{key:"id",get:function(){return this.handle.id}}]),Object(I.a)(e,[{key:"clearAndClose",value:function(){this.tensorMap.forEach((function(e){return e.dispose()})),this.tensorMap.clear(),this.handle.dispose()}},{key:"size",value:function(){return this.tensorMap.size}},{key:"tensorSize",value:function(){return Uc(this.size(),"int32")}},{key:"import",value:function(){var e=Object(w.a)(k.a.mark((function e(t,n){var r,a=this;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkKeyAndValueTensor(t,n),e.next=3,t.data();case 3:return r=e.sent,e.abrupt("return",(this.tensorMap.forEach((function(e){return e.dispose()})),this.tensorMap.clear(),zs((function(){var e=Ap(n),t=r.length,i=e.length;Ga.assert(t===i,(function(){return"The number of elements doesn't match, keys has ".concat(t," elements, the values has ").concat(i," elements.")}));for(var o=0;o<t;o++){var s=r[o],u=e[o];Ps(u),a.tensorMap.set(s,u)}return a.handle}))));case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"find",value:function(){var e=Object(w.a)(k.a.mark((function e(t,n){var r,a=this;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkKeyAndValueTensor(t,n),e.next=3,t.data();case 3:return r=e.sent,e.abrupt("return",zs((function(){for(var e=[],t=0;t<r.length;t++){var i=r[t],o=a.findWithDefault(i,n);e.push(o)}return fp(e)})));case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"findWithDefault",value:function(e,t){var n=this.tensorMap.get(e);return null!=n?n:t}},{key:"checkKeyAndValueTensor",value:function(e,t){if(e.dtype!==this.keyDType)throw new Error("Expect key dtype ".concat(this.keyDType,", but got ").concat(e.dtype));if(t.dtype!==this.valueDType)throw new Error("Expect value dtype ".concat(this.valueDType,", but got ").concat(t.dtype))}}]),e}(),pT=function(){var e=Object(w.a)(k.a.mark((function e(t,n,r,a){var i,o,s,u,c,l,d,p,f,h,m;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.op,e.next="HashTable"===e.t0||"HashTableV2"===e.t0?3:"InitializeTable"===e.t0||"InitializeTableV2"===e.t0||"LookupTableImport"===e.t0||"LookupTableImportV2"===e.t0?8:"LookupTableFind"===e.t0||"LookupTableFindV2"===e.t0?13:"LookupTableSize"===e.t0||"LookupTableSizeV2"===e.t0?18:20;break;case 3:if(null==(i=a.getHashTableHandleByName(t.name))){e.next=6;break}return e.abrupt("return",[i]);case 6:return o=MN("keyDType",t,n,r),s=MN("valueDType",t,n,r),u=new dT(o,s),e.abrupt("return",(a.addHashTable(t.name,u),[u.handle]));case 8:return c=MN("tableHandle",t,n,r,a),l=MN("keys",t,n,r),d=MN("values",t,n,r),e.next=11,a.getHashTableById(c.id).import(l,d);case 11:return e.t1=e.sent,e.abrupt("return",[e.t1]);case 13:return p=MN("tableHandle",t,n,r,a),f=MN("keys",t,n,r),h=MN("defaultValue",t,n,r),e.next=16,a.getHashTableById(p.id).find(f,h);case 16:return e.t2=e.sent,e.abrupt("return",[e.t2]);case 18:return m=MN("tableHandle",t,n,r,a),e.abrupt("return",[a.getHashTableById(m.id).tensorSize()]);case 20:throw TypeError("Node type ".concat(t.op," is not implemented"));case 21:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}(),fT=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Gj;switch(e.op){case"ResizeBilinear":var a=MN("images",e,t,n),i=MN("size",e,t,n),o=MN("alignCorners",e,t,n),s=MN("halfPixelCenters",e,t,n);return[r.image.resizeBilinear(a,[i[0],i[1]],o,s)];case"ResizeNearestNeighbor":var u=MN("images",e,t,n),c=MN("size",e,t,n),l=MN("alignCorners",e,t,n),d=MN("halfPixelCenters",e,t,n);return[r.image.resizeNearestNeighbor(u,[c[0],c[1]],l,d)];case"CropAndResize":var p=MN("image",e,t,n),f=MN("boxes",e,t,n),h=MN("boxInd",e,t,n),m=MN("cropSize",e,t,n),v=MN("method",e,t,n),b=MN("extrapolationValue",e,t,n);return[r.image.cropAndResize(p,f,h,m,v,b)];case"ImageProjectiveTransformV3":var g=MN("images",e,t,n),y=MN("transforms",e,t,n),x=MN("outputShape",e,t,n),k=MN("fillValue",e,t,n),w=MN("interpolation",e,t,n),O=MN("fillMode",e,t,n);return[r.image.transform(g,y,w.toLowerCase(),O.toLowerCase(),k,x)];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},hT=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Gj;switch(e.op){case"Equal":return[r.equal(MN("a",e,t,n),MN("b",e,t,n))];case"NotEqual":return[r.notEqual(MN("a",e,t,n),MN("b",e,t,n))];case"Greater":return[r.greater(MN("a",e,t,n),MN("b",e,t,n))];case"GreaterEqual":return[r.greaterEqual(MN("a",e,t,n),MN("b",e,t,n))];case"Less":return[r.less(MN("a",e,t,n),MN("b",e,t,n))];case"LessEqual":return[r.lessEqual(MN("a",e,t,n),MN("b",e,t,n))];case"LogicalAnd":return[r.logicalAnd(MN("a",e,t,n),MN("b",e,t,n))];case"LogicalNot":return[r.logicalNot(MN("a",e,t,n))];case"LogicalOr":return[r.logicalOr(MN("a",e,t,n),MN("b",e,t,n))];case"Select":case"SelectV2":return[r.where(MN("condition",e,t,n),MN("a",e,t,n),MN("b",e,t,n))];case"BitwiseAnd":return[r.bitwiseAnd(MN("a",e,t,n),MN("b",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},mT=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Gj;switch(e.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[r.matMul(MN("a",e,t,n),MN("b",e,t,n),MN("transposeA",e,t,n),MN("transposeB",e,t,n))];case"Einsum":return[r.einsum.apply(r,[MN("equation",e,t,n)].concat(Object(S.a)(MN("tensors",e,t,n))))];case"Transpose":return[r.transpose(MN("x",e,t,n),MN("perm",e,t,n))];case"_FusedMatMul":var a=MN("fusedOps",e,t,n),i=Object(y.a)(a,2),o=i[0],s=i[1],u="biasadd"===o,c="prelu"===s,l=MN("numArgs",e,t,n),d=MN("leakyreluAlpha",e,t,n);if(u){if(c&&2!==l)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!c&&1!==l)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}var p=MN("args",e,t,n),f=Object(y.a)(p,2),h=f[0],m=f[1];return[r.fused.matMul({a:MN("a",e,t,n),b:MN("b",e,t,n),transposeA:MN("transposeA",e,t,n),transposeB:MN("transposeB",e,t,n),bias:h,activation:s,preluActivationWeights:m,leakyreluAlpha:d})];case"MatrixBandPart":return[r.linalg.bandPart(MN("a",e,t,n),MN("numLower",e,t,n),MN("numUpper",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},vT=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Gj;switch(e.op){case"EuclideanNorm":return[r.euclideanNorm(MN("x",e,t,n),MN("axis",e,t,n),MN("keepDims",e,t,n))];case"FusedBatchNorm":case"FusedBatchNormV2":case"FusedBatchNormV3":return[r.batchNorm(MN("x",e,t,n),MN("mean",e,t,n),MN("variance",e,t,n),MN("offset",e,t,n),MN("scale",e,t,n),MN("epsilon",e,t,n))];case"LRN":return[r.localResponseNormalization(MN("x",e,t,n),MN("radius",e,t,n),MN("bias",e,t,n),MN("alpha",e,t,n),MN("beta",e,t,n))];case"Softmax":return[r.softmax(MN("x",e,t,n))];case"LogSoftmax":return[r.logSoftmax(MN("x",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},bT=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Gj;switch(e.op){case"RaggedGather":var a=r.raggedGather(MN("paramsNestedSplits",e,t,n),MN("paramsDenseValues",e,t,n),MN("indices",e,t,n),MN("outputRaggedRank",e,t,n)),i=a.outputNestedSplits,o=a.outputDenseValues;return i.concat(o);case"RaggedRange":var s=r.raggedRange(MN("starts",e,t,n),MN("limits",e,t,n),MN("splits",e,t,n)),u=s.rtNestedSplits,c=s.rtDenseValues;return[u,c];case"RaggedTensorToTensor":return[r.raggedTensorToTensor(MN("shape",e,t,n),MN("values",e,t,n),MN("defaultValue",e,t,n),MN("rowPartitionTensors",e,t,n),MN("rowPartitionTypes",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},gT=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Gj;switch(e.op){case"Max":var a=MN("axis",e,t,n),i=MN("keepDims",e,t,n);return[r.max(MN("x",e,t,n),a,i)];case"Mean":var o=MN("axis",e,t,n),s=MN("keepDims",e,t,n);return[r.mean(MN("x",e,t,n),o,s)];case"Min":var u=MN("axis",e,t,n),c=MN("keepDims",e,t,n);return[r.min(MN("x",e,t,n),u,c)];case"Sum":var l=MN("axis",e,t,n),d=MN("keepDims",e,t,n);return[r.sum(MN("x",e,t,n),l,d)];case"All":var p=MN("axis",e,t,n),f=MN("keepDims",e,t,n);return[r.all(MN("x",e,t,n),p,f)];case"Any":var h=MN("axis",e,t,n),m=MN("keepDims",e,t,n);return[r.any(MN("x",e,t,n),h,m)];case"ArgMax":var v=MN("axis",e,t,n);return[r.argMax(MN("x",e,t,n),v)];case"ArgMin":var b=MN("axis",e,t,n);return[r.argMin(MN("x",e,t,n),b)];case"Prod":var g=MN("axis",e,t,n),y=MN("keepDims",e,t,n);return[r.prod(MN("x",e,t,n),g,y)];case"Cumprod":var x=MN("axis",e,t,n),k=MN("exclusive",e,t,n),w=MN("reverse",e,t,n);return[r.cumprod(MN("x",e,t,n),x,k,w)];case"Cumsum":var O=MN("axis",e,t,n),I=MN("exclusive",e,t,n),S=MN("reverse",e,t,n);return[r.cumsum(MN("x",e,t,n),O,I,S)];case"Bincount":var N=MN("x",e,t,n),j=MN("weights",e,t,n),T=MN("size",e,t,n);return[r.bincount(N,j,T)];case"DenseBincount":var C=MN("x",e,t,n),E=MN("weights",e,t,n),_=MN("size",e,t,n),A=MN("binaryOutput",e,t,n);return[r.denseBincount(C,E,_,A)];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},yT=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Gj;switch(e.op){case"ConcatV2":case"Concat":var a=MN("n",e,t,n),i=MN("axis",e,t,n),o=MN("tensors",e,t,n);return o=o.slice(0,a),[r.concat(o,i)];case"Gather":var s=MN("x",e,t,n),u=MN("indices",e,t,n);return[r.gather(s,r.cast(u,"int32"),0)];case"GatherV2":var c=MN("axis",e,t,n),l=MN("batchDims",e,t,n),d=MN("x",e,t,n),p=MN("indices",e,t,n);return[r.gather(d,r.cast(p,"int32"),c,l)];case"Reverse":for(var f=MN("dims",e,t,n),h=[],m=0;m<f.length;m++)f[m]&&h.push(m);var v=MN("x",e,t,n);return[r.reverse(v,h)];case"ReverseV2":var b=MN("axis",e,t,n),g=MN("x",e,t,n);return[r.reverse(g,b)];case"Slice":var y=MN("begin",e,t,n),x=MN("size",e,t,n);return[r.slice(MN("x",e,t,n),y,x)];case"StridedSlice":var k=MN("begin",e,t,n),w=MN("end",e,t,n),O=MN("strides",e,t,n),I=MN("beginMask",e,t,n),S=MN("endMask",e,t,n),N=MN("ellipsisMask",e,t,n),j=MN("newAxisMask",e,t,n),T=MN("shrinkAxisMask",e,t,n),C=MN("x",e,t,n);return[r.stridedSlice(C,k,w,O,I,S,N,j,T)];case"Pack":return zs((function(){var a=MN("axis",e,t,n),i=MN("tensors",e,t,n),o=i[0].shape,s=r.squeeze(i[0]).shape,u=i.map((function(e){var t=Ga.arraysEqual(e.shape,o);if(!t&&!Ga.arraysEqual(r.squeeze(e).shape,s))throw new Error("the input tensors shape does not match");return t?e:r.reshape(e,o)}));return[r.stack(u,a)]}));case"Unpack":var E=MN("axis",e,t,n),_=MN("tensor",e,t,n);return r.unstack(_,E);case"Tile":var A=MN("reps",e,t,n);return[r.tile(MN("x",e,t,n),A)];case"Split":case"SplitV":var R=MN("axis",e,t,n),D=MN("numOrSizeSplits",e,t,n),F=MN("x",e,t,n);return r.split(F,D,R);case"ScatterNd":var M=MN("indices",e,t,n),z=MN("values",e,t,n),L=MN("shape",e,t,n);return[r.scatterND(M,z,L)];case"GatherNd":var P=MN("x",e,t,n),B=MN("indices",e,t,n);return[r.gatherND(P,B)];case"SparseToDense":var W=MN("sparseIndices",e,t,n),U=MN("outputShape",e,t,n),V=MN("sparseValues",e,t,n),G=MN("defaultValue",e,t,n);return[r.sparseToDense(W,V,U,V.dtype===G.dtype?G:r.cast(G,V.dtype))];case"TensorScatterUpdate":var H=MN("indices",e,t,n),q=MN("values",e,t,n),K=MN("tensor",e,t,n);return[r.tensorScatterUpdate(K,H,q)];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},xT=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Gj;switch(e.op){case"SparseFillEmptyRows":var a=r.sparse.sparseFillEmptyRows(MN("indices",e,t,n),MN("values",e,t,n),MN("denseShape",e,t,n),MN("defaultValue",e,t,n)),i=a.outputIndices,o=a.outputValues,s=a.emptyRowIndicator,u=a.reverseIndexMap;return[i,o,s,u];case"SparseReshape":var c=r.sparse.sparseReshape(MN("inputIndices",e,t,n),MN("inputShape",e,t,n),MN("newShape",e,t,n)),l=c.outputIndices,d=c.outputShape;return[l,d];case"SparseSegmentMean":return[r.sparse.sparseSegmentMean(MN("data",e,t,n),MN("indices",e,t,n),MN("segmentIds",e,t,n))];case"SparseSegmentSum":return[r.sparse.sparseSegmentSum(MN("data",e,t,n),MN("indices",e,t,n),MN("segmentIds",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},kT=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Gj;switch(e.op){case"FFT":return[r.fft(MN("x",e,t,n))];case"IFFT":return[r.ifft(MN("x",e,t,n))];case"RFFT":return[r.rfft(MN("x",e,t,n))];case"IRFFT":return[r.irfft(MN("x",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},wT=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Gj;switch(e.op){case"StaticRegexReplace":return[r.string.staticRegexReplace(MN("input",e,t,n),MN("pattern",e,t,n),MN("rewrite",e,t,n),MN("replaceGlobal",e,t,n))];case"StringNGrams":var a=r.string.stringNGrams(MN("data",e,t,n),MN("dataSplits",e,t,n),MN("separator",e,t,n),MN("nGramWidths",e,t,n),MN("leftPad",e,t,n),MN("rightPad",e,t,n),MN("padWidth",e,t,n),MN("preserveShortSequences",e,t,n)),i=a.nGrams,o=a.nGramsSplits;return[i,o];case"StringSplit":var s=r.string.stringSplit(MN("input",e,t,n),MN("delimiter",e,t,n),MN("skipEmpty",e,t,n)),u=s.indices,c=s.values,l=s.shape;return[u,c,l];case"StringToHashBucketFast":return[r.string.stringToHashBucketFast(MN("input",e,t,n),MN("numBuckets",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},OT=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Gj;switch(e.op){case"Cast":return[r.cast(MN("x",e,t,n),MN("dtype",e,t,n))];case"ExpandDims":var a=MN("axis",e,t,n);return[r.expandDims(MN("x",e,t,n),a)];case"Squeeze":var i=MN("axis",e,t,n);return[r.squeeze(MN("x",e,t,n),i)];case"Reshape":return[r.reshape(MN("x",e,t,n),MN("shape",e,t,n))];case"EnsureShape":return[r.ensureShape(MN("x",e,t,n),MN("shape",e,t,n))];case"MirrorPad":return[r.mirrorPad(MN("x",e,t,n),MN("padding",e,t,n),MN("mode",e,t,n))];case"PadV2":case"Pad":return[r.pad(MN("x",e,t,n),MN("padding",e,t,n),MN("constantValue",e,t,n))];case"SpaceToBatchND":var o=MN("blockShape",e,t,n),s=MN("paddings",e,t,n);return[r.spaceToBatchND(MN("x",e,t,n),o,s)];case"BatchToSpaceND":var u=MN("blockShape",e,t,n),c=MN("crops",e,t,n);return[r.batchToSpaceND(MN("x",e,t,n),u,c)];case"DepthToSpace":var l=MN("blockSize",e,t,n),d=MN("dataFormat",e,t,n).toUpperCase();return[r.depthToSpace(MN("x",e,t,n),l,d)];case"BroadcastTo":return[r.broadcastTo(MN("x",e,t,n),MN("shape",e,t,n))];case"BroadcastArgs":return[r.broadcastArgs(MN("s0",e,t,n),MN("s1",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}};function IT(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:zs,i=function(e,t,n){switch(e.category){case"arithmetic":return a((function(){return Hj(e,t,n)}));case"basic_math":return a((function(){return qj(e,t,n)}));case"control":return rT(e,t,n);case"convolution":return a((function(){return iT(e,t,n)}));case"creation":return a((function(){return oT(e,t,n)}));case"dynamic":return uT(e,t,n);case"evaluation":return a((function(){return cT(e,t,n)}));case"image":return a((function(){return fT(e,t,n)}));case"graph":return a((function(){return lT(e,t,n)}));case"logical":return a((function(){return hT(e,t,n)}));case"matrices":return a((function(){return mT(e,t,n)}));case"normalization":return a((function(){return vT(e,t,n)}));case"ragged":return a((function(){return bT(e,t,n)}));case"reduction":return a((function(){return gT(e,t,n)}));case"slice_join":return a((function(){return yT(e,t,n)}));case"sparse":return a((function(){return xT(e,t,n)}));case"spectral":return a((function(){return kT(e,t,n)}));case"string":return a((function(){return wT(e,t,n)}));case"transformation":return a((function(){return OT(e,t,n)}));case"hash_table":return pT(e,t,n,r);case"custom":var i=DN(e.op);if(i&&i.customExecutor)return i.customExecutor(new Vj(e,t,n));throw TypeError("Custom op ".concat(e.op," is not registered."));default:throw TypeError("Unknown op '".concat(e.op,"'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()"))}}(e,t,n);return Ga.isPromise(i)?i.then((function(e){return[].concat(e)})):[].concat(i)}var ST=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=arguments.length>4?arguments[4]:void 0;Object(O.a)(this,e),this.weightMap=t,this.tensorArrayMap=n,this.tensorListMap=r,this.functionMap=a,this.parseNodeNameCache=i,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}return Object(I.a)(e,[{key:"newFrame",value:function(e,t){return{id:e,frameName:t,iterationId:0}}},{key:"generateCurrentContextIds",value:function(){for(var e=[],t=0;t<this.contexts.length-1;t++){var n=this.contexts.slice(0,this.contexts.length-t);e.push(this.contextIdforContexts(n))}e.push(""),this._currentContextIds=e}},{key:"contextIdforContexts",value:function(e){return e?e.map((function(e){return 0===e.id&&0===e.iterationId?"":"".concat(e.frameName,"-").concat(e.iterationId)})).join("/"):""}},{key:"enterFrame",value:function(e){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,e)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))}},{key:"exitFrame",value:function(){if(!(this.contexts&&this.contexts.length>1))throw new Error("Cannot exit frame, the context is empty");this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift()}},{key:"nextIteration",value:function(){if(!(this.contexts&&this.contexts.length>0))throw new Error("Cannot increase frame iteration, the context is empty");this.contexts=this.contexts.slice(),this.lastId++;var e=Object.assign({},this.contexts[this.contexts.length-1]);e.iterationId+=1,e.id=this.lastId,this.contexts.splice(-1,1,e),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}},{key:"getWeight",value:function(e){return this.weightMap[e]}},{key:"addTensorArray",value:function(e){this.tensorArrayMap[e.id]=e}},{key:"getTensorArray",value:function(e){return this.tensorArrayMap[e]}},{key:"addTensorList",value:function(e){this.tensorListMap[e.id]=e}},{key:"getTensorList",value:function(e){return this.tensorListMap[e]}},{key:"dispose",value:function(e){for(var t in this.tensorArrayMap)this.tensorArrayMap[t].clearAndClose(e);for(var n in this.tensorListMap)this.tensorListMap[n].clearAndClose(e)}},{key:"currentContext",set:function(e){this.contexts!==e&&(this.contexts=e,this.generateCurrentContextIds())},get:function(){return this.contexts}},{key:"currentContextId",get:function(){return this._currentContextIds[0]}},{key:"currentContextIds",get:function(){return this._currentContextIds}}]),e}();function NT(e,t,n,r){var a=new Set,i=[],o=null,s=null,u=new Set,c=new Set(Object.keys(e).map((function(e){return WN(e)[0]})));r=r||[];for(var l=new Set(r.map((function(e){return WN(e.name)[0]}))),d=Object(S.a)(t);d.length>0;){var p=d.pop();if((AT(p)||RT(p)||DT(p))&&null==o&&(s=(o=p).children.map((function(e){return e.name})).filter((function(e){return a.has(e)}))),a.add(p.name),null==n[p.name]&&!c.has(p.name)&&!l.has(p.name)){if(0===p.inputs.length){i.push(p.name);continue}p.inputs.forEach((function(e){u.has(e.name)||(u.add(e.name),d.push(e))}))}}return{inputs:e,outputs:t,usedNodes:a,missingInputs:i,dynamicNode:o,syncInputs:s}}function jT(e,t){var n=t.usedNodes,r=t.inputs,a=Object.keys(r).map((function(e){return WN(e)[0]})).map((function(t){return e.nodes[t]})),i=e.initNodes||[],o=function(e){return n.has("string"==typeof e?e:e.name)};function s(e){return Object(S.a)(new Map(e.map((function(e){return[e.name,e]}))).values())}var u,c=s([].concat(Object(S.a)(a),Object(S.a)(e.weights),Object(S.a)(i))).filter(o),l=s([].concat(Object(S.a)(c),Object(S.a)(Object.values(e.nodes)))).filter(o),d=new Map(l.map((function(e){return[e.name,e]}))),p={},f=Object(N.a)(l);try{for(f.s();!(u=f.n()).done;){var h=u.value;p[h.name]=p[h.name]||0;var m,v=Object(N.a)(h.children);try{for(v.s();!(m=v.n()).done;){var b=m.value;o(b)||(p[b.name]=Number.POSITIVE_INFINITY),p[b.name]=(p[b.name]||0)+1}}catch(C){v.e(C)}finally{v.f()}}}catch(C){f.e(C)}finally{f.f()}for(var g=Object.entries(p).filter((function(e){return 0===Object(y.a)(e,2)[1]})).map((function(e){return Object(y.a)(e,1)[0]})),x=Object(S.a)(g);g.length>0;){var k,w=g.pop(),O=d.get(w),I=Object(N.a)(O.children.filter(o));try{for(I.s();!(k=I.n()).done;){var j=k.value;0===--p[j.name]&&(x.push(j.name),g.push(j.name))}}catch(C){I.e(C)}finally{I.f()}}var T=function(e,t){for(var n=new Map(e.map((function(e){return[e.name,e]}))),r=t.map((function(e){return e.name})),a=new Set(r);r.length>0;){var i,o=r.pop(),s=n.get(o),u=Object(N.a)(s.children);try{for(u.s();!(i=u.n()).done;){var c=i.value;!n.has(c.name)||a.has(c.name)||(a.add(c.name),r.push(c.name))}}catch(C){u.e(C)}finally{u.f()}}return e.filter((function(e){return a.has(e.name)}))}(x.map((function(e){return d.get(e)})),c);return function(e,t){var n,r=new Map(e.map((function(e,t){return[e.name,t]}))),a=new Set(t.map((function(e){return e.name}))),i=function(e){return a.has("string"==typeof e?e:e.name)},o=new Set(e.map((function(e){return e.name}))),s=function(e){return o.has("string"==typeof e?e:e.name)},u=Object(N.a)(e);try{for(u.s();!(n=u.n()).done;){var c,l=n.value,d=Object(N.a)(l.children.filter(s));try{for(d.s();!(c=d.n()).done;){var p=c.value;if(!r.has(p.name))throw new TT("Child ".concat(p.name," of node ").concat(l.name," is unreachable."));if(r.get(l.name)>r.get(p.name))throw new TT("Node ".concat(l.name," is scheduled to run after its child ").concat(p.name,"."))}}catch(C){d.e(C)}finally{d.f()}if(!i(l)){var f,h=Object(N.a)(l.inputs);try{for(h.s();!(f=h.n()).done;){var m=f.value;if(!r.has(m.name))throw new TT("Input ".concat(m.name," of node ").concat(l.name," is unreachable."));if(r.get(m.name)>r.get(l.name))throw new TT("Node ".concat(l.name," is scheduled to run before its input ").concat(m.name,"."))}}catch(C){h.e(C)}finally{h.f()}}}}catch(C){u.e(C)}finally{u.f()}}(T,c),T}var TT=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){return Object(O.a)(this,n),t.call(this,"NodesExecutionOrderError: ".concat(e))}return n}(Object(h.a)(Error));var CT=new Set(["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"]),ET=new Set(["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"]),_T=new Set(["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"]);function AT(e){return CT.has(e.op)}function RT(e){return ET.has(e.op)}function DT(e){return _T.has(e.op)}var FT=function(){function e(t,n){var r=this;Object(O.a)(this,e),this.graph=t,this.parent=n,this.compiledMap=new Map,this.parseNodeNameCache=new Map,this._weightMap={},this.SEPARATOR=",",this._functions={},this._functionExecutorMap={},this.keepIntermediateTensors=!1,this._outputs=t.outputs,this._inputs=t.inputs,this._initNodes=t.initNodes,this._signature=t.signature,this._functions=t.functions,null!=t.functions&&Object.keys(t.functions).forEach((function(n){r._functionExecutorMap[n]=new e(t.functions[n],r)}))}return Object(I.a)(e,[{key:"weightIds",get:function(){return this.parent?this.parent.weightIds:this._weightIds}},{key:"functionExecutorMap",get:function(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap}},{key:"weightMap",get:function(){return this.parent?this.parent.weightMap:this._weightMap},set:function(e){var t,n=Object.keys(e).map((function(t){return e[t].map((function(e){return e.id}))}));this._weightIds=(t=[]).concat.apply(t,Object(S.a)(n)),this._weightMap=e}},{key:"resourceManager",set:function(e){this._resourceManager=e}},{key:"inputs",get:function(){return this._inputs.map((function(e){return{name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}}))}},{key:"outputs",get:function(){return this._outputs.map((function(e){return{name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}}))}},{key:"inputNodes",get:function(){return this._inputs.map((function(e){return e.signatureKey||e.name}))}},{key:"outputNodes",get:function(){return this._outputs.map((function(e){var t=e.signatureKey||e.name;return e.defaultOutput?"".concat(t,":").concat(e.defaultOutput):t}))}},{key:"functions",get:function(){var e=this;return Object.keys(this._functions).reduce((function(t,n){return t[n]=e._functions[n].signature,t}),{})}}]),Object(I.a)(e,[{key:"getCompilationKey",value:function(e,t){var n=e.map((function(e){return e.name})).sort(),r=t.map((function(e){return e.name})).sort();return n.join(this.SEPARATOR)+"--"+r.join(this.SEPARATOR)}},{key:"compile",value:function(e,t){var n=NT(e,t,this.weightMap,this._initNodes),r=n.missingInputs,a=n.dynamicNode,i=n.syncInputs;if(null!=a)throw new Error("This execution contains the node '".concat(a.name,"', which has the dynamic op '").concat(a.op,"'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs [").concat(i,"]"));if(r.length>0){var o=t.map((function(e){return e.name})),s=Object.keys(e);throw new Error("Cannot compute the outputs [".concat(o,"] from the provided inputs [").concat(s,"]. Missing the following inputs: [").concat(r,"]"))}var u=jT(this.graph,n),c=function(e){for(var t=new Map(e.map((function(e,t){return[e.name,t]}))),n=Number.MAX_SAFE_INTEGER,r=e.map((function(e,t){return AT(e)?n:t})),a=function(e){var n=r[t.get(e.name)];return null==n?-1:n},i=e.map((function(e,t){return e.children.map(a).reduce((function(e,t){return Math.max(e,t)}),r[t])})),o=new Map,s=0;s<e.length;++s){var u=i[s];if(u!==n){var c=e[s],l=e[u];o.has(l.name)||o.set(l.name,[]),o.get(l.name).push(c)}}return o}(u);return{orderedNodes:u,nodeLiveUntilMap:c}}},{key:"cloneAndKeepTensor",value:function(e){if(null==e)return null;var t=e.clone();return Ps(t),t}},{key:"cloneTensorList",value:function(e){var t=this;return e?e.map((function(e){return t.cloneAndKeepTensor(e)})):null}},{key:"cloneTensorMap",value:function(e){var t=this;return Object.fromEntries(Object.entries(e).map((function(e){var n=Object(y.a)(e,2),r=n[0],a=n[1];return[r,t.cloneTensorList(a)]})))}},{key:"execute",value:function(e,t){var n=this;this.disposeIntermediateTensors(),e=this.mapInputs(e);var r=Object.keys(e).sort();this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t);var a=r.map((function(e){return n.graph.nodes[WN(e)[0]]})),i=t.map((function(e){return WN(e)[0]})),o=new Set(i),s=i.map((function(e){return n.graph.nodes[e]}));0===s.length&&(s=this._outputs);var u=this.getCompilationKey(a,s),c=this.compiledMap.get(u);null==c&&(c=this.compile(e,s),this.compiledMap.set(u,c));try{this.keepIntermediateTensors=st().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(p){this.keepIntermediateTensors=!1,console.warn(p.message)}var l={},d={};return zs((function(){var r=new ST(n.weightMap,l,d,n.functionExecutorMap,n.parseNodeNameCache),a=Object.assign({},n.weightMap);n.keepIntermediateTensors&&(n.clonedTensorsMap=n.cloneTensorMap(n.weightMap)),Object.keys(e).forEach((function(t){var i=WN(t,r),o=Object(y.a)(i,2),s=o[0],u=[];u[o[1]]=e[t],a[s]=u,n.keepIntermediateTensors&&(n.clonedTensorsMap[s]=n.cloneTensorList(u))}));var i,s=n.getFrozenTensorIds(a),u=c,p=u.orderedNodes,f=u.nodeLiveUntilMap,h=Object(N.a)(p);try{for(h.s();!(i=h.n()).done;){var m=i.value;if(!a[m.name]){var v=IT(m,a,r,n._resourceManager);if(Ga.isPromise(v))throw new Error("The execution of the op '".concat(m.op,"' returned a promise. Please use model.executeAsync() instead."));a[m.name]=v,n.keepIntermediateTensors&&(n.clonedTensorsMap[m.name]=n.cloneTensorList(v)),n.checkTensorForDisposalWithNodeLiveUntilInfo(m,a,r,s,o,f.get(m.name))}}}catch(b){h.e(b)}finally{h.f()}return null==n.parent&&r.dispose(s),t.map((function(e){return zN(e,a,r)}))}))}},{key:"getFrozenTensorIds",value:function(e){var t=[].concat.apply([],Object.keys(e).map((function(t){return e[t]})).map((function(e){return e.map((function(e){return e.id}))})));return new Set(t)}},{key:"checkTensorForDisposal",value:function(e,t,n,r,a,i,o){if(!AT(t)&&!i.has(e)){var s,u=Object(N.a)(n[e]);try{for(u.s();!(s=u.n()).done;){var c=s.value;null!=c&&(o[c.id]=(o[c.id]||0)+t.children.length)}}catch(g){u.e(g)}finally{u.f()}var l,d=Object(N.a)(t.inputs);try{for(d.s();!(l=d.n()).done;){var p=l.value;if(!AT(p)){var f=LN(p.name,n,r);if(null!=f){var h,m=Object(N.a)(f);try{for(m.s();!(h=m.n()).done;){var v=h.value;if(v&&!v.kept&&!a.has(v.id)){var b=o[v.id];1===b?(v.dispose(),delete o[v.id]):null!=b&&o[v.id]--}}}catch(g){m.e(g)}finally{m.f()}}}}}catch(g){d.e(g)}finally{d.f()}}}},{key:"checkTensorForDisposalWithNodeLiveUntilInfo",value:function(e,t,n,r,a,i){if(!AT(e)&&null!=i){var o,s=Object(N.a)(i);try{for(s.s();!(o=s.n()).done;){var u=o.value;if(!AT(f=u)&&!a.has(f.name)){var c,l=LN(u.name,t,n),d=Object(N.a)(l);try{for(d.s();!(c=d.n()).done;){var p=c.value;!p||p.kept||r.has(p.id)||p.dispose()}}catch(h){d.e(h)}finally{d.f()}}}}catch(h){s.e(h)}finally{s.f()}}var f}},{key:"executeAsync",value:function(){var e=Object(w.a)(k.a.mark((function e(t,n){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._executeAsync(t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"disposeIntermediateTensors",value:function(){this.clonedTensorsMap&&(Object.values(this.clonedTensorsMap).forEach((function(e){var t,n=Object(N.a)(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;r&&!r.isDisposed&&r.dispose()}}catch(a){n.e(a)}finally{n.f()}})),this.clonedTensorsMap=null)}},{key:"getIntermediateTensors",value:function(){return this.clonedTensorsMap}},{key:"_executeAsync",value:function(){var e=Object(w.a)(k.a.mark((function e(t,n){var r,a,i,o,s,u,c,l,d,p=arguments;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=p.length>2&&void 0!==p[2]&&p[2],a=p.length>3&&void 0!==p[3]?p[3]:{},i=p.length>4&&void 0!==p[4]?p[4]:{},this.disposeIntermediateTensors(),r||(t=this.mapInputs(t),this.checkInputs(t),this.checkInputShapeAndType(t),n=this.mapOutputs(n),this.checkOutputs(n));try{this.keepIntermediateTensors=st().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(f){this.keepIntermediateTensors=!1,console.warn(f.message)}return o=new ST(this.weightMap,a,i,this.functionExecutorMap,this.parseNodeNameCache),this.keepIntermediateTensors&&(this.clonedTensorsMap=this.cloneTensorMap(this.weightMap)),e.next=9,this.executeWithControlFlow(t,o,n,r);case 9:return s=e.sent,u=n.map((function(e){return zN(e,s,o)})),c=u.map((function(e){return e.id})),l=Object.keys(t).map((function(e){return t[e].id})),d=new Set([].concat(Object(S.a)(c),Object(S.a)(l),Object(S.a)(this.weightIds))),e.abrupt("return",(Object.values(s).forEach((function(e){e.forEach((function(e){e&&!e.isDisposed&&!d.has(e.id)&&e.dispose()}))})),null==this.parent&&o.dispose(d),u));case 15:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"executeFunctionAsync",value:function(){var e=Object(w.a)(k.a.mark((function e(t,n,r){var a,i=this;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.reduce((function(e,t,n){return e[i.inputs[n].name]=t,e}),{}),e.abrupt("return",this._executeAsync(a,this.outputNodes,!0,n,r));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"executeWithControlFlow",value:function(){var e=Object(w.a)(k.a.mark((function e(t,n,r,a){var i,o,s,u,c,l,d,p,f,h,m,v,b,g,x,w,O,I,N=this;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=Object.keys(t),o=i.map((function(e){return N.graph.nodes[WN(e)[0]]})),s=r.map((function(e){return WN(e)[0]})),u=new Set(s),0===(c=s.map((function(e){return N.graph.nodes[e]}))).length&&(c=this._outputs),l=NT(t,c,this.weightMap,this._initNodes),d=l.usedNodes,p=l.missingInputs,f=l.dynamicNode,h=l.syncInputs,m=[].concat(Object(S.a)(o),Object(S.a)(this.graph.weights),Object(S.a)(this._initNodes||[])).map((function(e){return{node:e,contexts:n.currentContext}})),v=Object.assign({},this.weightMap),Object.keys(t).forEach((function(e){var n=WN(e),r=Object(y.a)(n,2),a=r[0],i=[];i[r[1]]=t[e],v[a]=i})),b={},g=this.getFrozenTensorIds(v),x={};case 5:if(!(m.length>0)){e.next=11;break}return w=this.processStack(o,m,n,v,x,g,u,b,d),e.next=9,Promise.all(w);case 9:e.next=5;break;case 11:if(null==f&&!a&&console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead."),!((O=c.filter((function(e){return!AT(e)&&!zN(e.name,v,n)})).map((function(e){return e.name}))).length>0)){e.next=16;break}throw I="",null!=f&&(I="Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs [".concat(h,"]")),new Error("Cannot compute the outputs [".concat(O,"] from the provided inputs [").concat(i,"]. Consider providing the following inputs: [").concat(p,"]. ").concat(I));case 16:return e.abrupt("return",v);case 17:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"processStack",value:function(e,t,n,r,a,i,o,s,u){for(var c=this,l=[],d=function(){var e,d,p=t.pop();n.currentContext=p.contexts;var f="";if("Enter"===p.node.op&&MN("isConstant",p.node,r,n)&&(e=PN(p.node.name,n),d=Object(y.a)(e,1),f=d[0]),null==r[p.node.name]){var h,m,v=IT(p.node,r,n,c._resourceManager);f||(h=PN(p.node.name,n),m=Object(y.a)(h,1),f=m[0]);var b=n.currentContext;Ga.isPromise(v)?l.push(v.then((function(e){return r[f]=e,c.keepIntermediateTensors&&(c.clonedTensorsMap[f]=c.cloneTensorList(e)),n.currentContext=b,c.checkTensorForDisposal(f,p.node,r,n,i,o,s),c.processChildNodes(p.node,t,n,r,a,u),e}))):(r[f]=v,c.keepIntermediateTensors&&(c.clonedTensorsMap[f]=c.cloneTensorList(v)),c.checkTensorForDisposal(f,p.node,r,n,i,o,s),c.processChildNodes(p.node,t,n,r,a,u))}else c.processChildNodes(p.node,t,n,r,a,u)};t.length>0;)d();return l}},{key:"processChildNodes",value:function(e,t,n,r,a,i){e.children.forEach((function(e){var o=PN(e.name,n),s=Object(y.a)(o,1)[0];a[s]||!i.has(e.name)||("Merge"===e.op?e.inputNames.some((function(e){return!!zN(e,r,n)}))&&(a[s]=!0,t.push({contexts:n.currentContext,node:e})):e.inputNames.every((function(e){return!!zN(e,r,n)}))&&(a[s]=!0,t.push({contexts:n.currentContext,node:e})))}))}},{key:"dispose",value:function(){var e=this;Object.keys(this.weightMap).forEach((function(t){return e.weightMap[t].forEach((function(e){return e.dispose()}))}))}},{key:"checkInputShapeAndType",value:function(e){var t=this;Object.keys(e).forEach((function(n){var r=e[n],a=WN(n),i=Object(y.a)(a,1)[0],o=t.graph.nodes[i];if(o.attrParams.shape&&o.attrParams.shape.value){var s=o.attrParams.shape.value,u=s.length===r.shape.length&&r.shape.every((function(e,t){return-1===s[t]||s[t]===e}));Ga.assert(u,(function(){return"The shape of dict['".concat(o.name,"'] provided in model.execute(dict) must be [").concat(s,"], but was [").concat(r.shape,"]")}))}o.attrParams.dtype&&o.attrParams.dtype.value&&Ga.assert(r.dtype===o.attrParams.dtype.value,(function(){return"The dtype of dict['".concat(o.name,"'] provided in model.execute(dict) must be ").concat(o.attrParams.dtype.value,", but was ").concat(r.dtype)}))}))}},{key:"mapInputs",value:function(e){var t,n,r={};for(var a in e){var i=null===(n=null===(t=this._signature)||void 0===t?void 0:t.inputs)||void 0===n?void 0:n[a];null!=i?r[i.name]=e[a]:r[a]=e[a]}return r}},{key:"checkInputs",value:function(e){var t=this,n=Object.keys(e).filter((function(e){var n=WN(e),r=Object(y.a)(n,1)[0];return null==t.graph.nodes[r]}));if(n.length>0)throw new Error("The dict provided in model.execute(dict) has keys: [".concat(n,"] that are not part of graph"))}},{key:"mapOutputs",value:function(e){var t=this;return e.map((function(e){var n,r,a=null===(r=null===(n=t._signature)||void 0===n?void 0:n.outputs)||void 0===r?void 0:r[e];return null!=a?a.name:e}),{})}},{key:"checkOutputs",value:function(e){var t=this;e.forEach((function(e){var n=WN(e),r=Object(y.a)(n,1)[0];if(!t.graph.nodes[r])throw new Error("The output '".concat(e,"' is not found in the graph"))}))}}]),e}(),MT=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(O.a)(this,e),this.hashTableNameToHandle=t,this.hashTableMap=n}return Object(I.a)(e,[{key:"addHashTable",value:function(e,t){this.hashTableNameToHandle[e]=t.handle,this.hashTableMap[t.id]=t}},{key:"getHashTableHandleByName",value:function(e){return this.hashTableNameToHandle[e]}},{key:"getHashTableById",value:function(e){return this.hashTableMap[e]}},{key:"dispose",value:function(){for(var e in this.hashTableMap)this.hashTableMap[e].clearAndClose(),delete this.hashTableMap[e];for(var t in this.hashTableNameToHandle)this.hashTableNameToHandle[t].dispose(),delete this.hashTableNameToHandle[t]}}]),e}(),zT=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:_h;Object(O.a)(this,e),this.modelUrl=t,this.loadOptions=n,this.version="n/a",this.io=r,null==n&&(this.loadOptions={}),this.resourceManager=new MT}return Object(I.a)(e,[{key:"modelVersion",get:function(){return this.version}},{key:"inputNodes",get:function(){return this.executor.inputNodes}},{key:"outputNodes",get:function(){return this.executor.outputNodes}},{key:"inputs",get:function(){return this.executor.inputs}},{key:"outputs",get:function(){return this.executor.outputs}},{key:"weights",get:function(){return this.executor.weightMap}},{key:"metadata",get:function(){return this.artifacts.userDefinedMetadata}},{key:"modelSignature",get:function(){return this.signature}},{key:"modelStructuredOutputKeys",get:function(){return this.structuredOutputKeys}}]),Object(I.a)(e,[{key:"findIOHandler",value:function(){var e=this.modelUrl;if(null!=e.load)this.handler=e;else if(null!=this.loadOptions.requestInit)this.handler=this.io.browserHTTPRequest(e,this.loadOptions);else{var t=this.io.getLoadHandlers(e,this.loadOptions);if(0===t.length)t.push(this.io.browserHTTPRequest(e,this.loadOptions));else if(t.length>1)throw new Error("Found more than one (".concat(t.length,") load handlers for URL '").concat([e],"'"));this.handler=t[0]}}},{key:"load",value:function(){var e=this;if(this.findIOHandler(),null==this.handler.load)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");var t=this.handler.load();return Ga.isPromise(t)?t.then((function(t){return e.loadSync(t)})):this.loadSync(t)}},{key:"loadSync",value:function(e){this.artifacts=e;var t=this.artifacts.modelTopology,n=this.artifacts.signature;if(null!=this.artifacts.userDefinedMetadata){var r=this.artifacts.userDefinedMetadata;null!=r.signature&&(n=r.signature),null!=r.structuredOutputKeys&&(this.structuredOutputKeys=r.structuredOutputKeys)}this.signature=n,this.version="".concat(t.versions.producer,".").concat(t.versions.minConsumer);var a=this.io.decodeWeights(this.artifacts.weightData,this.artifacts.weightSpecs);if(this.executor=new FT(Tj.Instance.transformGraph(t,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(a),this.executor.resourceManager=this.resourceManager,null!=e.modelInitializer&&null!=e.modelInitializer.node){var i=Tj.Instance.transformGraph(e.modelInitializer);this.initializer=new FT(i),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializerSignature=e.initializerSignature}return!0}},{key:"save",value:function(){var e=Object(w.a)(k.a.mark((function e(t,n){var r;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t){e.next=7;break}if(0!==(r=this.io.getSaveHandlers(t)).length){e.next=4;break}throw new Error("Cannot find any save handlers for URL '".concat(t,"'"));case 4:if(!(r.length>1)){e.next=6;break}throw new Error("Found more than one (".concat(r.length,") save handlers for URL '").concat(t,"'"));case 6:t=r[0];case 7:if(null!=t.save){e.next=9;break}throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");case 9:return e.abrupt("return",t.save(this.artifacts));case 10:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"addStructuredOutputNames",value:function(e){var t=this;if(this.structuredOutputKeys){var n={};return(e instanceof Ti?[e]:e).forEach((function(e,r){return n[t.structuredOutputKeys[r]]=e})),n}return e}},{key:"predict",value:function(e,t){var n=this.execute(e,this.outputNodes);return this.addStructuredOutputNames(n)}},{key:"predictAsync",value:function(){var e=Object(w.a)(k.a.mark((function e(t,n){var r;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.executeAsync(t,this.outputNodes);case 2:return r=e.sent,e.abrupt("return",this.addStructuredOutputNames(r));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"normalizeInputs",value:function(e){var t,n=this;if(!(e instanceof Ti)&&!Array.isArray(e)){var r=null===(t=this.signature)||void 0===t?void 0:t.inputs;if(null!=r)for(var a in r){var i=r[a];null!=i.resourceId&&(e[a]=this.resourceIdToCapturedInput[i.resourceId])}return e}e=Array.isArray(e)?e:[e];var o=Object.keys(this.resourceIdToCapturedInput).length;if(e.length+o!==this.inputNodes.length)throw new Error("Input tensor count mismatch, the graph model has ".concat(this.inputNodes.length-o," non-resource placeholders, while there are ").concat(e.length," input tensors provided."));var s=0;return this.inputNodes.reduce((function(t,r){var a,i,o,u=null===(o=null===(i=null===(a=n.signature)||void 0===a?void 0:a.inputs)||void 0===i?void 0:i[r])||void 0===o?void 0:o.resourceId;return t[r]=null!=u?n.resourceIdToCapturedInput[u]:e[s++],t}),{})}},{key:"normalizeOutputs",value:function(e){return e=e||this.outputNodes,Array.isArray(e)?e:[e]}},{key:"executeInitializerGraph",value:function(){return null==this.initializer?[]:null==this.initializerSignature?this.initializer.execute({},[]):this.initializer.execute({},Object.keys(this.initializerSignature.outputs))}},{key:"executeInitializerGraphAsync",value:function(){var e=Object(w.a)(k.a.mark((function e(){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null==this.initializer?[]:null==this.initializerSignature?this.initializer.executeAsync({},[]):this.initializer.executeAsync({},Object.keys(this.initializerSignature.outputs)));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setResourceIdToCapturedInput",value:function(e){if(this.resourceIdToCapturedInput={},this.initializerSignature)for(var t=this.initializerSignature.outputs,n=Object.keys(t),r=0;r<n.length;r++){var a=t[n[r]];this.resourceIdToCapturedInput[a.resourceId]=e[r]}}},{key:"execute",value:function(e,t){null==this.resourceIdToCapturedInput&&this.setResourceIdToCapturedInput(this.executeInitializerGraph()),e=this.normalizeInputs(e),t=this.normalizeOutputs(t);var n=this.executor.execute(e,t);return n.length>1?n:n[0]}},{key:"executeAsync",value:function(){var e=Object(w.a)(k.a.mark((function e(t,n){var r;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=null==this.resourceIdToCapturedInput,!e.t0){e.next=7;break}return e.t1=this,e.next=5,this.executeInitializerGraphAsync();case 5:e.t2=e.sent,e.t1.setResourceIdToCapturedInput.call(e.t1,e.t2);case 7:return t=this.normalizeInputs(t),n=this.normalizeOutputs(n),e.next=11,this.executor.executeAsync(t,n);case 11:return r=e.sent,e.abrupt("return",r.length>1?r:r[0]);case 13:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getIntermediateTensors",value:function(){return this.executor.getIntermediateTensors()}},{key:"disposeIntermediateTensors",value:function(){this.executor.disposeIntermediateTensors()}},{key:"convertTensorMapToTensorsMap",value:function(e){return Object.keys(e).reduce((function(t,n){return t[n]=[e[n]],t}),{})}},{key:"dispose",value:function(){this.executor.dispose(),this.initializer&&(this.initializer.dispose(),this.resourceIdToCapturedInput&&Ls(this.resourceIdToCapturedInput)),this.resourceManager.dispose()}}]),e}();function LT(e){return PT.apply(this,arguments)}function PT(){return(PT=Object(w.a)(k.a.mark((function e(t){var n,r,a,i=arguments;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=i.length>1&&void 0!==i[1]?i[1]:{},r=i.length>2&&void 0!==i[2]?i[2]:_h,null!=t){e.next=4;break}throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");case 4:return null==n&&(n={}),n.fromTFHub&&"string"==typeof t&&(t=WT(t)),a=new zT(t,n,r),e.next=8,a.load();case 8:return e.abrupt("return",a);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function BT(e){if(null==e)throw new Error("modelUrl in loadGraphModelSync() cannot be null. Please provide model artifacts or an IOHandler that loads the model");var t;if(e instanceof Array){var n=Object(y.a)(e,2),r=n[0],a=n[1];if(!r)throw new Error("modelJSON must be the first element of the array");if(!a||!(a instanceof ArrayBuffer))throw new Error("An ArrayBuffer of weights must be the second element of the array");if(!("modelTopology"in r))throw new Error("Model JSON is missing 'modelTopology'");if(!("weightsManifest"in r))throw new Error("Model JSON is missing 'weightsManifest'");var i=_h.getWeightSpecs(r.weightsManifest),o=_h.getModelArtifactsForJSONSync(r,i,a);t=_h.fromMemorySync(o)}else if("load"in e)t=e;else{if(!("modelTopology"in e&&"weightSpecs"in e&&"weightData"in e))throw new Error("Unknown model format");t=_h.fromMemorySync(e)}var s=new zT(t);return s.load(),s}function WT(e){return e.endsWith("/")||(e+="/"),"".concat(e).concat("model.json").concat("?tfjs-format=file")}var UT="4.7.0",VT={};z(VT,{CSVDataset:function(){return LC},Dataset:function(){return SC},FileDataSource:function(){return $C},TextLineDataset:function(){return _C},URLDataSource:function(){return eE},array:function(){return jC},csv:function(){return tE},func:function(){return nE},generator:function(){return rE},microphone:function(){return oE},version_data:function(){return uE},webcam:function(){return aE},zip:function(){return TC}});var GT=L(Z()),HT=L(Z());function qT(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Map,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Set;if(null==e)return null;if("function"==typeof Blob&&e instanceof Blob)return e.slice();if(r.has(e))throw new Error("Circular references are not supported.");if(n.has(e))return n.get(e);var a=t(e);if(a.recurse&&null!==a.value)throw new Error("A deep map function may not return both a value and recurse=true.");if(a.recurse){if(QT(e)){var i=Array.isArray(e)?[]:{};for(var o in r.add(e),e){var s=e[o],u=qT(s,t,n,r);i[o]=u}return r.delete(e),e.__proto__&&(i.__proto__=e.__proto__),i}throw new Error("Can't recurse into non-iterable type: ".concat(e))}return n.set(e,a.value),a.value}function KT(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:YT;return XT(e,t)}function XT(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Set,r=e[0];if(n.has(r))throw new Error("Circular references are not supported.");var a=t(e);if(a.recurse&&null!==a.value)throw new Error("A deep zip function may not return both a value and recurse=true.");if(a.recurse){if(QT(r)){var i=Array.isArray(r)?[]:{};n.add(r);var o=function(r){var a=XT(e.map((function(e){return e[r]})),t,n);i[r]=a};for(var s in r)o(s);return n.delete(r),i}throw new Error("Can't recurse into non-iterable type: ".concat(r))}return a.value}function YT(e){return null===e?null:QT(e[0])?{value:null,recurse:!0}:{value:e,recurse:!1}}function ZT(e,t){return JT.apply(this,arguments)}function JT(){return(JT=Object(w.a)(k.a.mark((function e(t,n){var r,a,i,o,s,u;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=new Map,qT(t,n,r),a=0,i=Array.from(r.keys());case 3:if(!(a<i.length)){e.next=14;break}if(o=i[a],s=r.get(o),!Ga.isPromise(s)){e.next=11;break}return e.next=9,s;case 9:u=e.sent,r.set(o,u);case 11:a++,e.next=3;break;case 14:return e.abrupt("return",qT(t,n,r));case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function QT(e){var t=!1;st().get("IS_BROWSER")?t=e instanceof TextDecoder:t=e instanceof J().StringDecoder;return null!=e&&!ArrayBuffer.isView(e)&&(Array.isArray(e)||"object"==typeof e&&!(e instanceof Ti)&&!(e instanceof Promise)&&!t)}function $T(e){return function(e,t){return qT(e,t)}(e,eC)}function eC(e){return e instanceof Ti?{value:e.clone(),recurse:!1}:QT(e)?{value:null,recurse:!0}:{value:e,recurse:!1}}var tC=function(){function e(t){if(Object(O.a)(this,e),this.capacity=t,this.begin=0,this.end=0,null==t)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(t<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(t),this.doubledCapacity=2*t}return Object(I.a)(e,[{key:"wrap",value:function(e){for(;e<0;)e+=this.doubledCapacity;return e%this.doubledCapacity}},{key:"get",value:function(e){if(e<0)throw new RangeError("Can't get item at a negative index.");return this.data[e%this.capacity]}},{key:"set",value:function(e,t){if(e<0)throw new RangeError("Can't set item at a negative index.");this.data[e%this.capacity]=t}},{key:"length",value:function(){var e=this.end-this.begin;return e<0&&(e=this.doubledCapacity+e),e}},{key:"isFull",value:function(){return this.length()===this.capacity}},{key:"isEmpty",value:function(){return 0===this.length()}},{key:"push",value:function(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,e),this.end=this.wrap(this.end+1)}},{key:"pushAll",value:function(e){var t,n=Object(N.a)(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.push(r)}}catch(a){n.e(a)}finally{n.f()}}},{key:"pop",value:function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);var e=this.get(this.end);return this.set(this.end,void 0),e}},{key:"unshift",value:function(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,e)}},{key:"shift",value:function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var e=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),e}},{key:"shuffleExcise",value:function(e){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var t=this.wrap(this.begin+e),n=this.get(t);return this.set(t,this.pop()),n}}]),e}(),nC=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){return Object(O.a)(this,n),t.call(this,n.INITIAL_CAPACITY)}return Object(I.a)(n,[{key:"isFull",value:function(){return!1}},{key:"push",value:function(e){Object(d.a)(Object(p.a)(n.prototype),"isFull",this).call(this)&&this.expand(),Object(d.a)(Object(p.a)(n.prototype),"push",this).call(this,e)}},{key:"unshift",value:function(e){Object(d.a)(Object(p.a)(n.prototype),"isFull",this).call(this)&&this.expand(),Object(d.a)(Object(p.a)(n.prototype),"unshift",this).call(this,e)}},{key:"expand",value:function(){for(var e=2*this.capacity,t=new Array(e),n=this.length(),r=0;r<n;r++)t[r]=this.get(this.wrap(this.begin+r));this.data=t,this.capacity=e,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=n}}]),n}(tC);function rC(e){return new cC(e)}function aC(e){return new lC(e)}function iC(e,t){return new kC(e,t)}function oC(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:sC.FAIL;return new wC(e,t)}nC.INITIAL_CAPACITY=32;var sC,uC=function(){function e(){Object(O.a)(this,e)}return Object(I.a)(e,[{key:"toArray",value:function(){var e=Object(w.a)(k.a.mark((function e(){var t,n;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.next=3,this.next();case 3:n=e.sent;case 4:if(n.done){e.next=11;break}return t.push(n.value),e.next=8,this.next();case 8:n=e.sent;case 9:e.next=4;break;case 11:return e.abrupt("return",t);case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"toArrayForTest",value:function(){var e=Object(w.a)(k.a.mark((function e(){var t,n,r;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.prefetch(100),n=[],e.next=4,t.next();case 4:r=e.sent;case 5:if(r.done){e.next=12;break}return n.push(r.value),e.next=9,t.next();case 9:r=e.sent;case 10:e.next=5;break;case 12:return e.abrupt("return",n);case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"resolveFully",value:function(){var e=Object(w.a)(k.a.mark((function e(){var t;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.next();case 2:t=e.sent;case 3:if(t.done){e.next=9;break}return e.next=6,this.next();case 6:t=e.sent;case 7:e.next=3;break;case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"resolveWhile",value:function(){var e=Object(w.a)(k.a.mark((function e(t){var n,r;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.next();case 2:n=e.sent,r=t(n.value);case 4:if(n.done||!r){e.next=11;break}return e.next=7,this.next();case 7:n=e.sent,r=t(n.value);case 9:e.next=4;break;case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleErrors",value:function(e){return new bC(this,e)}},{key:"filter",value:function(e){return new mC(this,e)}},{key:"map",value:function(e){return new vC(this,e)}},{key:"mapAsync",value:function(e){return new gC(this,e)}},{key:"serialMapAsync",value:function(e){return new gC(this,e).serial()}},{key:"flatmap",value:function(e){return new xC(this,e)}},{key:"forEachAsync",value:function(){var e=Object(w.a)(k.a.mark((function e(t){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.map(t).resolveFully());case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"serialForEach",value:function(){var e=Object(w.a)(k.a.mark((function e(t){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.serialMapAsync(t).resolveWhile((function(e){return!0===e})));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"rowMajorBatch",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new hC(this,e,t)}},{key:"columnMajorBatch",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:YT;return this.rowMajorBatch(e,t).map((function(e){return KT(e,n)}))}},{key:"concatenate",value:function(e,t){return new kC(rC([this,e]),t)}},{key:"take",value:function(e){return e<0||null==e?this:new fC(this,e)}},{key:"skip",value:function(e){return e<0||null==e?this:new pC(this,e)}},{key:"prefetch",value:function(e){return new OC(this,e)}},{key:"shuffle",value:function(e,t){return new IC(this,e,t)}},{key:"serial",value:function(){return new dC(this)}}]),e}(),cC=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(O.a)(this,n),(r=t.call(this)).items=e,r.trav=0,r}return Object(I.a)(n,[{key:"summary",value:function(){return"Array of ".concat(this.items.length," items")}},{key:"next",value:function(){var e=Object(w.a)(k.a.mark((function e(){var t;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.trav>=this.items.length)){e.next=2;break}return e.abrupt("return",{value:null,done:!0});case 2:return t=this.items[this.trav],e.abrupt("return",(this.trav++,{value:$T(t),done:!1}));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(uC),lC=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(O.a)(this,n),(r=t.call(this)).nextFn=e,r}return Object(I.a)(n,[{key:"summary",value:function(){return"Function call"}},{key:"next",value:function(){var e=Object(w.a)(k.a.mark((function e(){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.abrupt("return",this.nextFn());case 4:throw e.prev=4,e.t0=e.catch(0),e.t0.message="Error thrown while iterating through a dataset: ".concat(e.t0.message),e.t0;case 7:case"end":return e.stop()}}),e,this,[[0,4]])})));return function(){return e.apply(this,arguments)}}()}]),n}(uC),dC=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(O.a)(this,n),(r=t.call(this)).upstream=e,r.lastRead=Promise.resolve({value:null,done:!1}),r}return Object(I.a)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Serial")}},{key:"next",value:function(){var e=Object(w.a)(k.a.mark((function e(){var t=this;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.lastRead.then((function(){return t.serialNext()})),this.lastRead));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=Object(w.a)(k.a.mark((function e(){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.upstream.next());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(uC),pC=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e,r){var a;return Object(O.a)(this,n),(a=t.call(this)).upstream=e,a.maxCount=r,a.count=0,a.lastRead=Promise.resolve({value:null,done:!1}),a}return Object(I.a)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Skip")}},{key:"next",value:function(){var e=Object(w.a)(k.a.mark((function e(){var t=this;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.lastRead.then((function(){return t.serialNext()})),this.lastRead));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=Object(w.a)(k.a.mark((function e(){var t;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.count++<this.maxCount)){e.next=9;break}return e.next=3,this.upstream.next();case 3:if(!(t=e.sent).done){e.next=6;break}return e.abrupt("return",t);case 6:Ls(t.value);case 7:e.next=0;break;case 9:return e.abrupt("return",this.upstream.next());case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(uC),fC=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e,r){var a;return Object(O.a)(this,n),(a=t.call(this)).upstream=e,a.maxCount=r,a.count=0,a}return Object(I.a)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Take")}},{key:"next",value:function(){var e=Object(w.a)(k.a.mark((function e(){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.count++>=this.maxCount?{value:null,done:!0}:this.upstream.next());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(uC),hC=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e,r){var a,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return Object(O.a)(this,n),(a=t.call(this)).upstream=e,a.batchSize=r,a.enableSmallLastBatch=i,a.lastRead=Promise.resolve({value:null,done:!1}),a}return Object(I.a)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> RowMajorBatch")}},{key:"next",value:function(){var e=Object(w.a)(k.a.mark((function e(){var t=this;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.lastRead.then((function(){return t.serialNext()})),this.lastRead));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=Object(w.a)(k.a.mark((function e(){var t,n;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[];case 1:if(!(t.length<this.batchSize)){e.next=10;break}return e.next=4,this.upstream.next();case 4:if(!(n=e.sent).done){e.next=7;break}return e.abrupt("return",this.enableSmallLastBatch&&t.length>0?{value:t,done:!1}:{value:null,done:!0});case 7:t.push(n.value);case 8:e.next=1;break;case 10:return e.abrupt("return",{value:t,done:!1});case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(uC),mC=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e,r){var a;return Object(O.a)(this,n),(a=t.call(this)).upstream=e,a.predicate=r,a.lastRead=Promise.resolve({value:null,done:!1}),a}return Object(I.a)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Filter")}},{key:"next",value:function(){var e=Object(w.a)(k.a.mark((function e(){var t=this;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.lastRead.then((function(){return t.serialNext()})),this.lastRead));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=Object(w.a)(k.a.mark((function e(){var t;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done&&!this.predicate(t.value)){e.next=5;break}return e.abrupt("return",t);case 5:Ls(t.value);case 6:e.next=0;break;case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(uC),vC=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e,r){var a;return Object(O.a)(this,n),(a=t.call(this)).upstream=e,a.transform=r,a}return Object(I.a)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Map")}},{key:"next",value:function(){var e=Object(w.a)(k.a.mark((function e(){var t,n,r,a,i,o,s;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=5;break}return e.abrupt("return",{value:null,done:!0});case 5:n=Mi.getTensorsInContainer(t.value),r=this.transform(t.value),a=Mi.getTensorsInContainer(r),i=Object(N.a)(n);try{for(i.s();!(o=i.n()).done;)s=o.value,Mi.isTensorInList(s,a)||s.dispose()}catch(u){i.e(u)}finally{i.f()}return e.abrupt("return",{value:r,done:!1});case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(uC),bC=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e,r){var a;return Object(O.a)(this,n),(a=t.call(this)).upstream=e,a.handler=r,a.count=0,a.lastRead=Promise.resolve({value:null,done:!1}),a}return Object(I.a)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> handleErrors")}},{key:"next",value:function(){var e=Object(w.a)(k.a.mark((function e(){var t=this;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.lastRead.then((function(){return t.serialNext()})),this.lastRead));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=Object(w.a)(k.a.mark((function e(){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.upstream.next();case 3:return e.abrupt("return",e.sent);case 6:if(e.prev=6,e.t0=e.catch(0),this.handler(e.t0)){e.next=10;break}return e.abrupt("return",{value:null,done:!0});case 10:e.next=0;break;case 12:case"end":return e.stop()}}),e,this,[[0,6]])})));return function(){return e.apply(this,arguments)}}()}]),n}(uC),gC=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e,r){var a;return Object(O.a)(this,n),(a=t.call(this)).upstream=e,a.transform=r,a}return Object(I.a)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> AsyncMap")}},{key:"next",value:function(){var e=Object(w.a)(k.a.mark((function e(){var t,n,r,a,i,o,s;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=5;break}return e.abrupt("return",{value:null,done:!0});case 5:return n=Mi.getTensorsInContainer(t.value),e.next=8,this.transform(t.value);case 8:r=e.sent,a=Mi.getTensorsInContainer(r),i=Object(N.a)(n);try{for(i.s();!(o=i.n()).done;)s=o.value,Mi.isTensorInList(s,a)||s.dispose()}catch(u){i.e(u)}finally{i.f()}return e.abrupt("return",{value:r,done:!1});case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(uC),yC=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){var e;return Object(O.a)(this,n),(e=t.call(this)).outputQueue=new nC,e.lastRead=Promise.resolve({value:null,done:!1}),e}return Object(I.a)(n,[{key:"next",value:function(){var e=Object(w.a)(k.a.mark((function e(){var t=this;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.lastRead.then((function(){return t.serialNext()})),this.lastRead));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=Object(w.a)(k.a.mark((function e(){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.outputQueue.length()){e.next=7;break}return e.next=3,this.pump();case 3:if(e.sent){e.next=5;break}return e.abrupt("return",{value:null,done:!0});case 5:e.next=0;break;case 7:return e.abrupt("return",{value:this.outputQueue.shift(),done:!1});case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(uC),xC=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e,r){var a;return Object(O.a)(this,n),(a=t.call(this)).upstream=e,a.transform=r,a}return Object(I.a)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Flatmap")}},{key:"pump",value:function(){var e=Object(w.a)(k.a.mark((function e(){var t,n,r,a,i,o,s;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=5;break}return e.abrupt("return",!1);case 5:n=Mi.getTensorsInContainer(t.value),r=this.transform(t.value),a=Mi.getTensorsInContainer(r),this.outputQueue.pushAll(r),i=Object(N.a)(n);try{for(i.s();!(o=i.n()).done;)s=o.value,Mi.isTensorInList(s,a)||s.dispose()}catch(u){i.e(u)}finally{i.f()}return e.abrupt("return",!0);case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(yC),kC=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e,r){var a;return Object(O.a)(this,n),(a=t.call(this)).baseErrorHandler=r,a.lastRead=null,a.iterator=null,a.moreIterators=e,a}return Object(I.a)(n,[{key:"summary",value:function(){return"TODO: fill in upstream of chained summaries -> Chained"}},{key:"next",value:function(){var e=Object(w.a)(k.a.mark((function e(){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.readFromChain(this.lastRead),this.lastRead));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"readFromChain",value:function(){var e=Object(w.a)(k.a.mark((function e(t){var n,r;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t;case 2:if(null!=this.iterator){e.next=9;break}return e.next=5,this.moreIterators.next();case 5:if(!(n=e.sent).done){e.next=8;break}return e.abrupt("return",{value:null,done:!0});case 8:this.iterator=n.value,null!=this.baseErrorHandler&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler));case 9:return e.next=11,this.iterator.next();case 11:return r=e.sent,e.abrupt("return",r.done?(this.iterator=null,this.readFromChain(t)):r);case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(uC);!function(e){e[e.FAIL=0]="FAIL",e[e.SHORTEST=1]="SHORTEST",e[e.LONGEST=2]="LONGEST"}(sC||(sC={}));var wC=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:sC.FAIL;return Object(O.a)(this,n),(r=t.call(this)).iterators=e,r.mismatchMode=a,r.count=0,r.currentPromise=null,r}return Object(I.a)(n,[{key:"summary",value:function(){return"{TODO: fill in upstream of zip summaries} -> Zip"}},{key:"nextState",value:function(){var e=Object(w.a)(k.a.mark((function e(t){var n,r,a,i;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=function(e){return e instanceof uC?{value:e.next().then((function(e){return n++,e.done&&r++,e.value})),recurse:!1}:{value:null,recurse:!0}},e.next=3,t;case 3:return n=0,r=0,e.next=6,ZT(this.iterators,a);case 6:if(i=e.sent,n!==r){e.next=9;break}return e.abrupt("return",{value:null,done:!0});case 9:if(!(r>0)){e.next=15;break}e.t0=this.mismatchMode,e.next=e.t0===sC.FAIL?13:e.t0===sC.SHORTEST?14:(e.t0,sC.LONGEST,15);break;case 13:throw new Error("Zipped streams should have the same length. Mismatched at element ".concat(this.count,"."));case 14:return e.abrupt("return",{value:null,done:!0});case 15:return e.abrupt("return",(this.count++,{value:i,done:!1}));case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"next",value:function(){var e=Object(w.a)(k.a.mark((function e(){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.currentPromise=this.nextState(this.currentPromise),this.currentPromise));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(uC),OC=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e,r){var a;return Object(O.a)(this,n),(a=t.call(this)).upstream=e,a.bufferSize=r,a.buffer=new tC(r),a}return Object(I.a)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Prefetch")}},{key:"refill",value:function(){for(;!this.buffer.isFull();){var e=this.upstream.next();this.buffer.push(e)}}},{key:"next",value:function(){return this.refill(),this.buffer.shift()}}]),n}(uC),IC=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e,r,a){var i;return Object(O.a)(this,n),(i=t.call(this,e,r)).upstream=e,i.windowSize=r,i.upstreamExhausted=!1,i.random=HT.alea(a||Ga.now().toString()),i.lastRead=Promise.resolve({value:null,done:!1}),i}return Object(I.a)(n,[{key:"next",value:function(){var e=Object(w.a)(k.a.mark((function e(){var t=this;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.lastRead.then((function(){return t.serialNext()})),this.lastRead));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"randomInt",value:function(e){return Math.floor(this.random()*e)}},{key:"chooseIndex",value:function(){return this.randomInt(this.buffer.length())}},{key:"serialNext",value:function(){var e=Object(w.a)(k.a.mark((function e(){var t,n;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.upstreamExhausted||this.refill();case 1:if(this.buffer.isEmpty()){e.next=13;break}return t=this.chooseIndex(),e.next=5,this.buffer.shuffleExcise(t);case 5:if(!(n=e.sent).done){e.next=10;break}this.upstreamExhausted=!0,e.next=11;break;case 10:return e.abrupt("return",(this.refill(),n));case 11:e.next=1;break;case 13:return e.abrupt("return",{value:null,done:!0});case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(OC),SC=function(){function e(){Object(O.a)(this,e),this.size=null}return Object(I.a)(e,[{key:"batch",value:function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this;return Ga.assert(e>0,(function(){return"batchSize needs to be positive, but it is\n      ".concat(e)})),t=this.size===1/0||null==this.size?this.size:n?Math.ceil(this.size/e):Math.floor(this.size/e),NC(Object(w.a)(k.a.mark((function t(){return k.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.iterator();case 2:return t.abrupt("return",t.sent.columnMajorBatch(e,n,CC));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"concatenate",value:function(e){var t,n=this;return t=this.size===1/0||e.size===1/0?1/0:null!=this.size&&null!=e.size?this.size+e.size:null,NC(Object(w.a)(k.a.mark((function t(){return k.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.t0=t.sent,t.next=5,e.iterator();case 5:return t.t1=t.sent,t.abrupt("return",t.t0.concatenate.call(t.t0,t.t1));case 7:case"end":return t.stop()}}),t)}))),t)}},{key:"filter",value:function(e){var t,n=this;return t=this.size===1/0?1/0:null,NC(Object(w.a)(k.a.mark((function t(){return k.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.abrupt("return",t.sent.filter((function(t){return zs((function(){return e(t)}))})));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"forEachAsync",value:function(){var e=Object(w.a)(k.a.mark((function e(t){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.iterator();case 2:return e.abrupt("return",e.sent.forEachAsync(t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"map",value:function(e){var t=this;return NC(Object(w.a)(k.a.mark((function n(){return k.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.iterator();case 2:return n.abrupt("return",n.sent.map((function(t){return zs((function(){return e(t)}))})));case 3:case"end":return n.stop()}}),n)}))),this.size)}},{key:"mapAsync",value:function(e){var t=this;return NC(Object(w.a)(k.a.mark((function n(){return k.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.iterator();case 2:return n.abrupt("return",n.sent.mapAsync(e));case 3:case"end":return n.stop()}}),n)}))),this.size)}},{key:"prefetch",value:function(e){if(null==e)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");var t=this;return NC(Object(w.a)(k.a.mark((function n(){return k.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.iterator();case 2:return n.abrupt("return",n.sent.prefetch(e));case 3:case"end":return n.stop()}}),n)}))),this.size)}},{key:"repeat",value:function(e){var t,n=this;return t=null!=this.size&&e>0?this.size*e:0===e?0:null!=this.size&&(void 0===e||e<0)?1/0:null,NC(Object(w.a)(k.a.mark((function t(){var r;return k.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=aC(Object(w.a)(k.a.mark((function e(){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.iterator();case 2:return e.t0=e.sent,e.t1=!1,e.abrupt("return",{value:e.t0,done:e.t1});case 5:case"end":return e.stop()}}),e)})))),t.abrupt("return",iC(r.take(e)));case 2:case"end":return t.stop()}}),t)}))),t)}},{key:"skip",value:function(e){var t,n=this;return t=null!=this.size&&e>=0&&this.size>=e?this.size-e:null!=this.size&&(this.size<e||void 0===e||e<0)?0:null,NC(Object(w.a)(k.a.mark((function t(){return k.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.abrupt("return",t.sent.skip(e));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"shuffle",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(null==e||e<0)throw null==this.size?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError("`Dataset.shuffle()` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for `tf.Tensor`s), consider setting bufferSize to the dataset size (".concat(this.size," elements)"));var r=this,a=GT.alea(t||Ga.now().toString());return NC(Object(w.a)(k.a.mark((function t(){var i;return k.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=a.int32(),n&&(i+=a.int32()),t.next=4,r.iterator();case 4:return t.abrupt("return",t.sent.shuffle(e,i.toString()));case 5:case"end":return t.stop()}}),t)}))),this.size)}},{key:"take",value:function(e){var t,n=this;return t=null!=this.size&&this.size>e?e:null!=this.size&&this.size<=e?this.size:null,NC(Object(w.a)(k.a.mark((function t(){return k.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.abrupt("return",t.sent.take(e));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"toArray",value:function(){var e=Object(w.a)(k.a.mark((function e(){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.size!==1/0){e.next=2;break}throw new Error("Can not convert infinite data stream to array.");case 2:return e.next=4,this.iterator();case 4:return e.abrupt("return",e.sent.toArray());case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"toArrayForTest",value:function(){var e=Object(w.a)(k.a.mark((function e(){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.size!==1/0){e.next=2;break}throw new Error("Can not convert infinite data stream to array.");case 2:return e.next=4,this.iterator();case 4:return e.abrupt("return",e.sent.toArrayForTest());case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}();function NC(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new(function(n){Object(b.a)(a,n);var r=Object(g.a)(a);function a(){var e;return Object(O.a)(this,a),(e=r.apply(this,arguments)).size=t,e}return Object(I.a)(a,[{key:"iterator",value:function(){var t=Object(w.a)(k.a.mark((function t(){return k.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e());case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()}]),a}(SC))}function jC(e){return NC(Object(w.a)(k.a.mark((function t(){return k.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",rC(e));case 1:case"end":return t.stop()}}),t)}))),e.length)}function TC(e){if(!QT(e))throw new Error("The argument to zip() must be an object or array.");var t;if(Array.isArray(e))for(var n=0;n<e.length;n++)t=null==t?e[n].size:Math.min(t,e[n].size);else if(e instanceof Object)for(var r in e)t=null==t?e[r].size:Math.min(t,e[r].size);return NC(Object(w.a)(k.a.mark((function t(){var n;return k.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,ZT(e,(function(e){if(e instanceof SC)return{value:e.iterator(),recurse:!1};if(QT(e))return{value:null,recurse:!0};throw new Error("Leaves of the structure passed to zip() must be Datasets, not primitives.")}));case 2:return n=t.sent,t.abrupt("return",oC(n,sC.SHORTEST));case 4:case"end":return t.stop()}}),t)}))),t)}function CC(e){return null===e?null:function(e){return null==e||function(e){return null===e||"object"!=typeof e&&"function"!=typeof e}(e)||Array.isArray(e)||"object"==typeof e&&e instanceof Ti||Ga.isTypedArray(e)}(e[0])?{value:EC(e),recurse:!1}:{value:null,recurse:!0}}function EC(e){if(0===e.length)throw new Error("Can't make a batch of zero elements.");return e[0]instanceof Ti?fp(e):ho(e)}SC.MAX_BUFFER_SIZE=1e4;var _C=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(O.a)(this,n),(r=t.call(this)).input=e,r}return Object(I.a)(n,[{key:"iterator",value:function(){var e=Object(w.a)(k.a.mark((function e(){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.input.iterator();case 2:return e.abrupt("return",e.sent.decodeUTF8().split("\n").map((function(e){return e.endsWith("\r")&&(e=e.slice(0,-1)),e})));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(SC),AC='"',RC=Symbol("out"),DC=Symbol("field"),FC=Symbol("quote"),MC=Symbol("quoteafterquote"),zC=Symbol("quoteinquote"),LC=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e,r){var a;return Object(O.a)(this,n),(a=t.call(this)).input=e,a.hasHeader=!0,a.fullColumnNames=null,a.columnNamesValidated=!1,a.columnConfigs=null,a.configuredColumnsOnly=!1,a.delimiter=",",a.delimWhitespace=!1,a.base=new _C(e),r||(r={}),a.hasHeader=!1!==r.hasHeader,a.fullColumnNames=r.columnNames,a.columnConfigs=r.columnConfigs,a.configuredColumnsOnly=r.configuredColumnsOnly,r.delimWhitespace?(Ga.assert(null==r.delimiter,(function(){return"Delimiter should not be provided when delimWhitespace is true."})),a.delimWhitespace=!0,a.delimiter=" "):a.delimiter=r.delimiter?r.delimiter:",",a}return Object(I.a)(n,[{key:"columnNames",value:function(){var e=Object(w.a)(k.a.mark((function e(){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.columnNamesValidated,e.t0){e.next=4;break}return e.next=4,this.setColumnNames();case 4:return e.abrupt("return",this.configuredColumnsOnly?Object.keys(this.columnConfigs):this.fullColumnNames);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setColumnNames",value:function(){var e=Object(w.a)(k.a.mark((function e(){var t,n,r,a,i,o,s=this;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.maybeReadHeaderLine();case 2:if(t=e.sent,this.fullColumnNames||t){e.next=5;break}throw new Error("Column names must be provided if there is no header line.");case 5:if(this.fullColumnNames&&t&&Ga.assert(t.length===this.fullColumnNames.length,(function(){return"The length of provided columnNames ("+s.fullColumnNames.length.toString()+") does not match the length of the header line read from file ("+t.length.toString()+")."})),this.fullColumnNames||(this.fullColumnNames=t),n=this.fullColumnNames.reduce((function(e,t){return e[t]=e[t]+1||1,e}),{}),r=Object.keys(n).filter((function(e){return n[e]>1})),Ga.assert(0===r.length,(function(){return"Duplicate column names found: "+r.toString()})),!this.columnConfigs){e.next=16;break}a=0,i=Object.keys(this.columnConfigs);case 9:if(!(a<i.length)){e.next=16;break}if(o=i[a],-1!==this.fullColumnNames.indexOf(o)){e.next=13;break}throw new Error('The key "'+o+'" provided in columnConfigs does not match any of the column names ('+this.fullColumnNames.toString()+").");case 13:a++,e.next=9;break;case 16:this.columnNamesValidated=!0;case 17:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"maybeReadHeaderLine",value:function(){var e=Object(w.a)(k.a.mark((function e(){var t,n;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.hasHeader){e.next=12;break}return e.next=3,this.base.iterator();case 3:return e.next=5,e.sent.next();case 5:if(!(t=e.sent).done){e.next=8;break}throw new Error("No data was found for CSV parsing.");case 8:return n=t.value,e.abrupt("return",this.parseRow(n,!1));case 12:return e.abrupt("return",null);case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),Object(I.a)(n,[{key:"iterator",value:function(){var e=Object(w.a)(k.a.mark((function e(){var t,n=this;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.columnNamesValidated,e.t0){e.next=4;break}return e.next=4,this.setColumnNames();case 4:return e.next=6,this.base.iterator();case 6:return t=e.sent,e.abrupt("return",(this.hasHeader&&(t=t.skip(1)),t.map((function(e){return n.makeDataElement(e)}))));case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"makeDataElement",value:function(e){for(var t=this.parseRow(e),n={},r={},a=0;a<this.fullColumnNames.length;a++){var i=this.fullColumnNames[a],o=this.columnConfigs?this.columnConfigs[i]:null;if(!this.configuredColumnsOnly||o){var s=t[a],u=null;if(""===s)if(o&&void 0!==o.default)u=o.default;else{if(o&&(o.required||o.isLabel))throw new Error("Required column ".concat(i," is empty in this line: ").concat(e));u=void 0}else{var c=Number(s);if(isNaN(c))u=o&&"bool"===o.dtype?this.getBoolean(s):s;else if(o&&o.dtype)switch(o.dtype){case"float32":u=c;break;case"int32":u=Math.floor(c);break;case"bool":u=this.getBoolean(s);break;default:u=c}else u=c}o&&o.isLabel?r[i]=u:n[i]=u}}return 0===Object.keys(r).length?n:{xs:n,ys:r}}},{key:"getBoolean",value:function(e){return"1"===e||"true"===e.toLowerCase()?1:0}},{key:"parseRow",value:function(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=[],r=0,a=e.length,i=RC,o=0;o<a;o++)switch(i){case RC:switch(e.charAt(o)){case AC:r=o+1,i=FC;break;case this.delimiter:if(r=o+1," "===this.delimiter&&this.delimWhitespace)break;n.push(""),i=RC;break;default:i=DC,r=o}break;case DC:switch(e.charAt(o)){case this.delimiter:n.push(e.substring(r,o)),i=RC,r=o+1}break;case FC:switch(e.charAt(o)){case AC:i=MC}break;case MC:switch(e.charAt(o)){case this.delimiter:n.push(e.substring(r,o-1)),i=RC,r=o+1;break;case AC:i=FC;break;default:i=zC}break;case zC:switch(e.charAt(o)){case AC:i=FC}}if(i===MC?n.push(e.substring(r,a-1)):n.push(e.substring(r)),t&&n.length!==this.fullColumnNames.length)throw new Error("Invalid row in csv file. Should have ".concat(this.fullColumnNames.length," elements in a row, but got ").concat(n));return n}}]),n}(SC),PC=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;Object(O.a)(this,n),(r=t.call(this)).microphoneConfig=e,r.isClosed=!1,r.fftSize=e.fftSize||1024;var a=Math.log2(r.fftSize);if(r.fftSize<0||a<4||a>14||!Number.isInteger(a))throw new Error("Invalid fftSize: it must be a power of 2 between 2 to 4 and 2 to 14, but got ".concat(r.fftSize));if(r.numFrames=e.numFramesPerSpectrogram||43,r.sampleRateHz=e.sampleRateHz,r.columnTruncateLength=e.columnTruncateLength||r.fftSize,r.audioTrackConstraints=e.audioTrackConstraints,r.smoothingTimeConstant=e.smoothingTimeConstant||0,r.includeSpectrogram=!1!==e.includeSpectrogram,r.includeWaveform=!0===e.includeWaveform,!r.includeSpectrogram&&!r.includeWaveform)throw new Error("Both includeSpectrogram and includeWaveform are false. At least one type of data should be returned.");return r}return Object(I.a)(n,[{key:"summary",value:function(){return"microphone"}},{key:"start",value:function(){var e=Object(w.a)(k.a.mark((function e(){var t,n;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.getUserMedia({audio:null==this.audioTrackConstraints||this.audioTrackConstraints,video:!1});case 3:this.stream=e.sent,e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(0),new Error("Error thrown while initializing video stream: ".concat(e.t0.message));case 9:if(this.stream){e.next=11;break}throw new Error("Could not obtain audio from microphone.");case 11:if(t=window.AudioContext||window.webkitAudioContext,this.audioContext=new t,this.sampleRateHz){e.next=16;break}this.sampleRateHz=this.audioContext.sampleRate,e.next=18;break;case 16:if(this.audioContext.sampleRate===this.sampleRateHz){e.next=18;break}throw new Error("Mismatch in sampling rate: Expected: ".concat(this.sampleRateHz,"; Actual: ").concat(this.audioContext.sampleRate));case 18:n=this.audioContext.createMediaStreamSource(this.stream),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=2*this.fftSize,this.analyser.smoothingTimeConstant=this.smoothingTimeConstant,n.connect(this.analyser),this.freqData=new Float32Array(this.fftSize),this.timeData=new Float32Array(this.fftSize);case 20:case"end":return e.stop()}}),e,this,[[0,6]])})));return function(){return e.apply(this,arguments)}}()},{key:"next",value:function(){var e=Object(w.a)(k.a.mark((function e(){var t,n,r,a,i;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isClosed){e.next=2;break}return e.abrupt("return",{value:null,done:!0});case 2:return e.next=4,this.getAudioData();case 4:return r=e.sent,this.includeSpectrogram&&(a=this.flattenQueue(r.freqDataQueue),t=this.getTensorFromAudioDataArray(a,[this.numFrames,this.columnTruncateLength,1])),this.includeWaveform&&(i=this.flattenQueue(r.timeDataQueue),n=this.getTensorFromAudioDataArray(i,[this.numFrames*this.fftSize,1])),e.abrupt("return",{value:{spectrogram:t,waveform:n},done:!1});case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"capture",value:function(){var e=Object(w.a)(k.a.mark((function e(){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.next();case 2:return e.abrupt("return",e.sent.value);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getAudioData",value:function(){var e=Object(w.a)(k.a.mark((function e(){var t,n,r,a=this;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],n=[],r=0,e.abrupt("return",new Promise((function(e){var i=setInterval((function(){a.includeSpectrogram&&(a.analyser.getFloatFrequencyData(a.freqData),a.freqData[0]===-1/0&&e({freqDataQueue:t,timeDataQueue:n}),t.push(a.freqData.slice(0,a.columnTruncateLength))),a.includeWaveform&&(a.analyser.getFloatTimeDomainData(a.timeData),n.push(a.timeData.slice())),++r===a.numFrames&&(clearInterval(i),e({freqDataQueue:t,timeDataQueue:n}))}),a.fftSize/a.sampleRateHz*1e3)})));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"stop",value:function(){this.isClosed||(this.isClosed=!0,this.analyser.disconnect(),this.audioContext.close(),null!=this.stream&&this.stream.getTracks().length>0&&this.stream.getTracks()[0].stop())}},{key:"toArray",value:function(){throw new Error("Can not convert infinite audio stream to array.")}},{key:"getSampleRate",value:function(){return this.sampleRateHz}},{key:"flattenQueue",value:function(e){var t=e[0].length,n=new Float32Array(e.length*t);return e.forEach((function(e,r){return n.set(e,r*t)})),n}},{key:"getTensorFromAudioDataArray",value:function(e,t){var n=new Float32Array(Ga.sizeFromShape(t));return n.set(e,n.length-e.length),ho(n,t)}}],[{key:"create",value:function(){var e=Object(w.a)(k.a.mark((function e(){var t,r,a=arguments;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.length>0&&void 0!==a[0]?a[0]:{},st().get("IS_BROWSER")){e.next=3;break}throw new Error("microphone API is only supported in browser environment.");case 3:return r=new n(t),e.next=6,r.start();case 6:return e.abrupt("return",r);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),n}(uC),BC=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e,r){var a;if(Object(O.a)(this,n),(a=t.call(this)).webcamVideoElement=e,a.webcamConfig=r,a.isClosed=!0,a.resize=!1,a.needToResize())if(a.resize=!0,a.cropSize=[a.webcamConfig.resizeHeight,a.webcamConfig.resizeWidth],a.cropBoxInd=bp([0],"int32"),a.webcamConfig.centerCrop){var i=1*a.webcamConfig.resizeWidth/a.webcamVideoElement.width,o=1*a.webcamConfig.resizeHeight/a.webcamVideoElement.height,s=(1-i)/2,u=(1-o)/2,c=s+i,l=o+u;a.cropBox=gp([u,s,l,c],[1,4])}else a.cropBox=gp([0,0,1,1],[1,4]);return Object(m.a)(a)}return Object(I.a)(n,[{key:"summary",value:function(){return"webcam"}},{key:"start",value:function(){var e=Object(w.a)(k.a.mark((function e(){var t=this;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.webcamConfig.facingMode&&Ga.assert("user"===this.webcamConfig.facingMode||"environment"===this.webcamConfig.facingMode,(function(){return"Invalid webcam facing mode: ".concat(t.webcamConfig.facingMode,". Please provide 'user' or 'environment'")})),e.prev=1,e.next=4,navigator.mediaDevices.getUserMedia({video:{deviceId:this.webcamConfig.deviceId,facingMode:this.webcamConfig.facingMode?this.webcamConfig.facingMode:"user",width:this.webcamVideoElement.width,height:this.webcamVideoElement.height}});case 4:this.stream=e.sent,e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(1),e.t0.message="Error thrown while initializing video stream: ".concat(e.t0.message),e.t0;case 10:if(this.stream){e.next=12;break}throw new Error("Could not obtain video from webcam.");case 12:try{this.webcamVideoElement.srcObject=this.stream}catch(U1){console.log(U1),this.webcamVideoElement.src=window.URL.createObjectURL(this.stream)}return e.abrupt("return",(this.webcamVideoElement.play(),this.isClosed=!1,new Promise((function(e){t.webcamVideoElement.onloadedmetadata=function(){e()}}))));case 14:case"end":return e.stop()}}),e,this,[[1,7]])})));return function(){return e.apply(this,arguments)}}()},{key:"next",value:function(){var e=Object(w.a)(k.a.mark((function e(){var t;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isClosed){e.next=2;break}return e.abrupt("return",{value:null,done:!0});case 2:e.prev=2,t=rm.fromPixels(this.webcamVideoElement),e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(2),new Error("Error thrown converting video to pixels: ".concat(JSON.stringify(e.t0)));case 9:if(!this.resize){e.next=22;break}return e.prev=10,e.abrupt("return",{value:this.cropAndResizeFrame(t),done:!1});case 14:throw e.prev=14,e.t1=e.catch(10),new Error("Error thrown cropping the video: ".concat(e.t1.message));case 17:return e.prev=17,t.dispose(),e.finish(17);case 20:e.next=23;break;case 22:return e.abrupt("return",{value:t,done:!1});case 23:case"end":return e.stop()}}),e,this,[[2,6],[10,14,17,20]])})));return function(){return e.apply(this,arguments)}}()},{key:"needToResize",value:function(){return!(!this.webcamConfig.resizeWidth||!this.webcamConfig.resizeHeight||this.webcamVideoElement.width===this.webcamConfig.resizeWidth&&this.webcamVideoElement.height===this.webcamConfig.resizeHeight)}},{key:"cropAndResizeFrame",value:function(e){var t=this;return zs((function(){var n,r=Zc(Ns(e,"float32"),0),a=(n=fh.cropAndResize(r,t.cropBox,t.cropBoxInd,t.cropSize,"bilinear")).shape;return Eu(n,a.slice(1))}))}},{key:"capture",value:function(){var e=Object(w.a)(k.a.mark((function e(){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.next();case 2:return e.abrupt("return",e.sent.value);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"stop",value:function(){this.stream.getTracks().forEach((function(e){return e.stop()}));try{this.webcamVideoElement.srcObject=null}catch(U1){console.log(U1),this.webcamVideoElement.src=null}this.isClosed=!0}},{key:"toArray",value:function(){throw new Error("Can not convert infinite video stream to array.")}}],[{key:"create",value:function(){var e=Object(w.a)(k.a.mark((function e(t){var r,a,i=arguments;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=i.length>1&&void 0!==i[1]?i[1]:{},st().get("IS_BROWSER")){e.next=3;break}throw new Error("tf.data.webcam is only supported in browser environment.");case 3:if(t){e.next=7;break}if(t=document.createElement("video"),r.resizeWidth&&r.resizeHeight){e.next=6;break}throw new Error("Please provide webcam video element, or resizeWidth and resizeHeight to create a hidden video element.");case 6:t.width=r.resizeWidth,t.height=r.resizeHeight;case 7:return a=new n(t,r),e.next=10,a.start();case 10:return e.abrupt("return",a);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),n}(uC),WC=function e(){Object(O.a)(this,e)},UC=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){return Object(O.a)(this,n),t.apply(this,arguments)}return Object(I.a)(n,[{key:"split",value:function(e){return new VC(this,e)}}]),n}(uC),VC=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e,r){var a;return Object(O.a)(this,n),(a=t.call(this)).upstream=e,a.impl=new GC(e,r),a}return Object(I.a)(n,[{key:"summary",value:function(){return this.impl.summary()}},{key:"next",value:function(){var e=Object(w.a)(k.a.mark((function e(){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.impl.next());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(UC),GC=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e,r){var a;return Object(O.a)(this,n),(a=t.call(this)).upstream=e,a.separator=r,a.carryover="",a}return Object(I.a)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Split('").concat(this.separator,"')")}},{key:"pump",value:function(){var e=Object(w.a)(k.a.mark((function e(){var t,n,r,a,i;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=5;break}return e.abrupt("return",""!==this.carryover&&(this.outputQueue.push(this.carryover),this.carryover="",!0));case 5:(n=t.value.split(this.separator))[0]=this.carryover+n[0],r=Object(N.a)(n.slice(0,-1));try{for(r.s();!(a=r.n()).done;)i=a.value,this.outputQueue.push(i)}catch(o){r.e(o)}finally{r.f()}return e.abrupt("return",(this.carryover=n[n.length-1],!0));case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(yC),HC=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){return Object(O.a)(this,n),t.apply(this,arguments)}return Object(I.a)(n,[{key:"decodeUTF8",value:function(){return new qC(this)}}]),n}(uC),qC=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(O.a)(this,n),(r=t.call(this)).upstream=e,r.impl=new KC(e),r}return Object(I.a)(n,[{key:"summary",value:function(){return this.impl.summary()}},{key:"next",value:function(){var e=Object(w.a)(k.a.mark((function e(){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.impl.next());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(UC),KC=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;if(Object(O.a)(this,n),(r=t.call(this)).upstream=e,st().get("IS_BROWSER"))r.decoder=new TextDecoder("utf-8");else{var a=J().StringDecoder;r.decoder=new a("utf8")}return Object(m.a)(r)}return Object(I.a)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Utf8")}},{key:"pump",value:function(){var e=Object(w.a)(k.a.mark((function e(){var t,n,r;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=5;break}return e.abrupt("return",!1);case 5:return n=t.value,e.abrupt("return",(r=st().get("IS_BROWSER")?this.decoder.decode(n,{stream:!0}):this.decoder.write(o.from(n.buffer)),this.outputQueue.push(r),!0));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(yC),XC=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(O.a)(this,n),(r=t.call(this)).file=e,r.options=a,Ga.assert(e instanceof Uint8Array||!!st().get("IS_BROWSER")&&(e instanceof File||e instanceof Blob),(function(){return"FileChunkIterator only supports File, Blob and Uint8Array right now."})),r.offset=a.offset||0,r.chunkSize=a.chunkSize||1048576,r}return Object(I.a)(n,[{key:"summary",value:function(){return"FileChunks ".concat(this.file)}},{key:"next",value:function(){var e=Object(w.a)(k.a.mark((function e(){var t=this;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.offset>=(this.file instanceof Uint8Array?this.file.byteLength:this.file.size))){e.next=4;break}e.t0={value:null,done:!0},e.next=9;break;case 4:return e.next=6,new Promise((function(e,n){var r=t.offset+t.chunkSize;if(t.file instanceof Uint8Array)e(new Uint8Array(t.file.slice(t.offset,r)));else{var a=new FileReader;a.onload=function(t){var r=a.result;if(r instanceof ArrayBuffer&&(r=new Uint8Array(r)),!(r instanceof Uint8Array))return n(new TypeError("FileReader returned unknown type."));e(r)},a.onabort=function(e){return n(new Error("Aborted"))},a.onerror=function(e){return n(new Error(e.type))};var i=t.file.slice(t.offset,r);a.readAsArrayBuffer(i)}t.offset=r}));case 6:e.t1=e.sent,e.t2=!1,e.t0={value:e.t1,done:e.t2};case 9:return e.abrupt("return",e.t0);case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(HC);function YC(e){return ZC.apply(this,arguments)}function ZC(){return(ZC=Object(w.a)(k.a.mark((function e(t){var n,r,a,i,o,s,u=arguments;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=u.length>1&&void 0!==u[1]?u[1]:{},r=u.length>2?u[2]:void 0,"string"==typeof t?a=t:(a=t.url,i=JC(t)),e.next=5,(r||Ga.fetch)(a,i);case 5:if(!(o=e.sent).ok){e.next=15;break}return e.t0=Uint8Array,e.next=10,o.arrayBuffer();case 10:return e.t1=e.sent,s=new e.t0(e.t1),e.abrupt("return",new XC(s,n));case 15:throw new Error(o.statusText);case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var JC=function(e){return{method:e.method,headers:e.headers,body:e.body,mode:e.mode,credentials:e.credentials,cache:e.cache,redirect:e.redirect,referrer:e.referrer,integrity:e.integrity}};function QC(e){return"string"==typeof e&&"file://"===e.slice(0,7)}var $C=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(O.a)(this,n),(r=t.call(this)).input=e,r.options=a,r}return Object(I.a)(n,[{key:"iterator",value:function(){var e=Object(w.a)(k.a.mark((function e(){var t;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return QC(this.input)&&st().get("IS_NODE")&&(t=Q(),this.input=t.readFileSync(this.input.slice(7))),e.abrupt("return",new XC(this.input,this.options));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(WC),eE=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(O.a)(this,n),(r=t.call(this)).url=e,r.fileOptions=a,r}return Object(I.a)(n,[{key:"iterator",value:function(){var e=Object(w.a)(k.a.mark((function e(){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",QC(this.url)?new $C(this.url,this.fileOptions).iterator():YC(this.url,this.fileOptions));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(WC);function tE(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new LC(new eE(e),t)}function nE(e){var t=aC(e);return NC(Object(w.a)(k.a.mark((function e(){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t);case 1:case"end":return e.stop()}}),e)}))))}function rE(e){return NC(Object(w.a)(k.a.mark((function t(){var n;return k.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e();case 2:return n=t.sent,t.abrupt("return",aC((function(){return n.next()})));case 4:case"end":return t.stop()}}),t)}))))}function aE(e,t){return iE.apply(this,arguments)}function iE(){return(iE=Object(w.a)(k.a.mark((function e(t,n){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",BC.create(t,n));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function oE(e){return sE.apply(this,arguments)}function sE(){return(sE=Object(w.a)(k.a.mark((function e(t){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",PC.create(t));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var uE="4.7.0";function cE(e,t){Array.isArray(e)||(e=[e]),e.forEach((function(e){null!=e&&Ga.assert("complex64"!==e.dtype,(function(){return"".concat(t," does not support complex64 tensors in the CPU backend.")}))}))}var lE=Gv.whereImpl,dE=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){var e;return Object(O.a)(this,n),(e=t.call(this)).blockSize=48,e.firstUse=!0,e.data=new oe(Object(f.a)(e),Ds()),e}return Object(I.a)(n,[{key:"nextDataId",value:function(){return n.nextDataId++}}]),Object(I.a)(n,[{key:"write",value:function(e,t,n){this.firstUse&&(this.firstUse=!1,st().get("IS_NODE")&&Wm.warn("\n============================\nHi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. \n============================"));var r={id:this.nextDataId()};return this.data.set(r,{values:e,dtype:n,refCount:1}),r}},{key:"makeTensorInfo",value:function(e,t,n){var r;if("string"===t&&null!=n&&n.length>0&&Ga.isString(n[0])){var a=n.map((function(e){return Ga.encodeString(e)}));r=this.write(a,e,t)}else r=this.write(n,e,t);return{dataId:r,shape:e,dtype:t}}},{key:"refCount",value:function(e){return this.data.has(e)?this.data.get(e).refCount:0}},{key:"incRef",value:function(e){this.data.get(e).refCount++}},{key:"decRef",value:function(e){this.data.has(e)&&this.data.get(e).refCount--}},{key:"move",value:function(e,t,n,r,a){this.data.set(e,{values:t,dtype:r,refCount:a})}},{key:"numDataIds",value:function(){return this.data.numDataIds()}},{key:"read",value:function(){var e=Object(w.a)(k.a.mark((function e(t){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.readSync(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"readSync",value:function(e){var t=this.data.get(e),n=t.dtype,r=t.complexTensorInfos;if("complex64"===n){var a=this.readSync(r.real.dataId),i=this.readSync(r.imag.dataId);return Wm.mergeRealAndImagArrays(a,i)}return Ga.convertBackendValuesAndArrayBuffer(this.data.get(e).values,n)}},{key:"bufferSync",value:function(e){var t=this.readSync(e.dataId);if("string"===e.dtype)try{var n=t.map((function(e){return Ga.decodeString(e)}));return Ss(e.shape,e.dtype,n)}catch(w0){throw new Error("Failed to decode encoded string bytes into utf-8")}return Ss(e.shape,e.dtype,t)}},{key:"makeOutput",value:function(e,t,n){return Ds().makeTensorFromTensorInfo(this.makeTensorInfo(t,n,e),this)}},{key:"disposeData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.data.has(e)){if(this.data.get(e).refCount--,!t&&this.data.get(e).refCount>0)return!1;var n=this.data.get(e),r=n.complexTensorInfos;null!=r&&(this.disposeData(r.real.dataId,!0),this.disposeData(r.imag.dataId,!0)),this.data.delete(e)}return!0}},{key:"disposeIntermediateTensorInfo",value:function(e){this.disposeData(e.dataId)}},{key:"time",value:function(){var e=Object(w.a)(k.a.mark((function e(t){var n;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Ga.now(),e.abrupt("return",(t(),{kernelMs:Ga.now()-n}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"memory",value:function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}},{key:"where",value:function(e){cE([e],"where");var t=this.readSync(e.dataId);return lE(e.shape,t)}},{key:"dispose",value:function(){}},{key:"floatPrecision",value:function(){return 32}},{key:"epsilon",value:function(){return Object(d.a)(Object(p.a)(n.prototype),"epsilon",this).call(this)}}]),n}(se);dE.nextDataId=0;var pE={};function fE(e){for(var t=new Float32Array(e.length),n=0;n<e.length;++n)t[n]=Math.abs(e[n]);return t}z(pE,{addImpl:function(){return TE},bincountImpl:function(){return AE},bincountReduceImpl:function(){return RE},bitwiseAndImpl:function(){return DE},castImpl:function(){return OE},ceilImpl:function(){return BE},concatImpl:function(){return VE},equalImpl:function(){return GE},expImpl:function(){return KE},expm1Impl:function(){return ZE},floorDivImpl:function(){return n_},floorImpl:function(){return $E},gatherNdImpl:function(){return i_},gatherV2Impl:function(){return o_},greaterEqualImpl:function(){return l_},greaterImpl:function(){return s_},lessEqualImpl:function(){return v_},lessImpl:function(){return f_},linSpaceImpl:function(){return y_},logImpl:function(){return x_},maxImpl:function(){return O_},maximumImpl:function(){return I_},minimumImpl:function(){return j_},multiplyImpl:function(){return E_},negImpl:function(){return D_},notEqualImpl:function(){return M_},prodImpl:function(){return U_},raggedGatherImpl:function(){return K_},raggedRangeImpl:function(){return Y_},raggedTensorToTensorImpl:function(){return eA},rangeImpl:function(){return tA},rsqrtImpl:function(){return nA},scatterImpl:function(){return iA},sigmoidImpl:function(){return oA},simpleAbsImpl:function(){return fE},sliceImpl:function(){return cA},sparseFillEmptyRowsImpl:function(){return pA},sparseReshapeImpl:function(){return fA},sparseSegmentReductionImpl:function(){return hA},sqrtImpl:function(){return mA},squaredDifferenceImpl:function(){return gA},staticRegexReplaceImpl:function(){return kA},stridedSliceImpl:function(){return IA},stringNGramsImpl:function(){return NA},stringSplitImpl:function(){return TA},stringToHashBucketFastImpl:function(){return CA},subImpl:function(){return EA},tileImpl:function(){return DA},topKImpl:function(){return MA},transposeImpl:function(){return P_},uniqueImpl:function(){return zA}});var hE={kernelName:pt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs.x,n=e.backend;cE(t,"abs");var r=new Float32Array(Ga.sizeFromShape(t.shape));return r=fE(n.data.get(t.dataId).values),n.makeOutput(r,t.shape,t.dtype)}};function mE(e){return function(t,n,r,a,i){var o=Wm.assertAndGetBroadcastShape(t,n),s=o.length,u=Ga.computeStrides(o),c=Ga.sizeFromShape(o),l=Ga.getTypedArrayFromDType(i,c),d=t.length,p=n.length,f=Ga.computeStrides(t),h=Ga.computeStrides(n),m=Wm.getBroadcastDims(t,o),v=Wm.getBroadcastDims(n,o);if(m.length+v.length===0)for(var b=0;b<l.length;++b)l[b]=e(r[b%r.length],a[b%a.length]);else for(var g=function(t){var n=Ga.indexToLoc(t,s,u),i=n.slice(-d);m.forEach((function(e){return i[e]=0}));var o=Ga.locToIndex(i,d,f),c=n.slice(-p);v.forEach((function(e){return c[e]=0}));var b=Ga.locToIndex(c,p,h);l[t]=e(r[o],a[b])},y=0;y<l.length;++y)g(y);return[l,o]}}function vE(e){var t=e.inputs,n=e.backend,r=t.real,a=t.imag,i=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,s=n.makeTensorInfo(r.shape,"complex64");return n.data.get(s.dataId).complexTensorInfos={real:n.makeTensorInfo(r.shape,"float32",i),imag:n.makeTensorInfo(a.shape,"float32",o)},s}var bE={kernelName:Pt,backendName:"cpu",kernelFunc:vE};function gE(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"float32";if("complex64"===n){var r=gE(e,t,"float32"),a=gE(e,t,"float32");return vE({inputs:{real:r,imag:a},backend:e})}var i=Ga.makeZerosTypedArray(Ga.sizeFromShape(t),n);return e.makeTensorInfo(t,n,i)}function yE(e){var t=e.inputs,n=e.backend,r=t.x;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var xE={kernelName:Cn,backendName:"cpu",kernelFunc:yE};function kE(e){var t=e.inputs,n=e.backend,r=t.input,a=n.data.get(r.dataId).complexTensorInfos.real,i=n.data.get(a.dataId).values;return n.makeTensorInfo(a.shape,a.dtype,i)}var wE={kernelName:jr,backendName:"cpu",kernelFunc:kE};function OE(e,t,n,r){if("int32"===r)return[t,"int32",Int32Array.from(e)];if("bool"===r){var a=Ga.toTypedArray([0],n),i=mE((function(e,t){return e!==t?1:0}))(t,[],e,a,"bool"),o=Object(y.a)(i,2),s=o[0];return[o[1],"bool",s]}throw new Error("Error in Cast: failed to cast ".concat(n," to ").concat(r))}function IE(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.dtype;if("complex64"===i){if("complex64"===a.dtype)return yE({inputs:{x:a},backend:n});var o=gE(n,a.shape,a.dtype),s=IE({inputs:{x:a},backend:n,attrs:{dtype:"float32"}}),u=vE({inputs:{real:s,imag:o},backend:n});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}if("complex64"===a.dtype){var c=kE({inputs:{input:a},backend:n}),l=IE({inputs:{x:c},backend:n,attrs:{dtype:i}});return n.disposeIntermediateTensorInfo(c),l}if(!Ga.hasEncodingLoss(a.dtype,i)){var d=yE({inputs:{x:a},backend:n});return{dataId:d.dataId,shape:d.shape,dtype:i}}var p=OE(n.data.get(a.dataId).values,a.shape,a.dtype,i),f=Object(y.a)(p,3),h=f[0],m=f[1],v=f[2];return n.makeTensorInfo(h,m,v)}var SE={kernelName:Mt,backendName:"cpu",kernelFunc:IE};function NE(e,t,n,r){return null==n?function(n){var a=n.inputs,i=n.backend,o=a.a,s=a.b,u=i;cE([o,s],e);var c=u.data.get(o.dataId).values,l=u.data.get(s.dataId).values,d="string"===o.dtype?Wm.fromUint8ToStringArray(c):c,p="string"===o.dtype?Wm.fromUint8ToStringArray(l):l,f=r||o.dtype,h=t(o.shape,s.shape,d,p,f),m=Object(y.a)(h,2),v=m[0],b=m[1];return u.makeTensorInfo(b,f,v)}:function(e){var a=e.inputs,i=e.backend,o=a.a,s=a.b,u=i;if("complex64"===o.dtype||"complex64"===s.dtype){var c=IE({inputs:{x:o},backend:u,attrs:{dtype:"complex64"}}),l=u.data.get(c.dataId),d=l.complexTensorInfos.real,p=l.complexTensorInfos.imag,f=u.data.get(d.dataId).values,h=u.data.get(p.dataId).values,m=IE({inputs:{x:s},backend:u,attrs:{dtype:"complex64"}}),v=u.data.get(m.dataId),b=v.complexTensorInfos.real,g=v.complexTensorInfos.imag,x=u.data.get(b.dataId).values,k=u.data.get(g.dataId).values,w=n(o.shape,s.shape,f,h,x,k),O=Object(y.a)(w,3),I=O[0],S=O[1],N=O[2],j=u.makeTensorInfo(N,"float32",I),T=u.makeTensorInfo(N,"float32",S),C=vE({inputs:{real:j,imag:T},backend:u});return u.disposeIntermediateTensorInfo(c),u.disposeIntermediateTensorInfo(m),u.disposeIntermediateTensorInfo(j),u.disposeIntermediateTensorInfo(T),C}var E=u.data.get(o.dataId).values,_=u.data.get(s.dataId).values,A=r||o.dtype,R=t(o.shape,s.shape,E,_,A),D=Object(y.a)(R,2),F=D[0],M=D[1];return u.makeTensorInfo(M,A,F)}}function jE(e){return function(t,n,r,a,i,o){var s=Wm.assertAndGetBroadcastShape(t,n),u=Ga.sizeFromShape(s),c=s.length,l=Ga.computeStrides(s),d=Ga.getTypedArrayFromDType("float32",u),p=Ga.getTypedArrayFromDType("float32",u),f=Wm.getBroadcastDims(t,s),h=Wm.getBroadcastDims(n,s),m=Wm.mergeRealAndImagArrays(r,a),v=Wm.mergeRealAndImagArrays(i,o),b=t.length,g=Ga.computeStrides(t),y=n.length,x=Ga.computeStrides(n);if(f.length+h.length===0)for(var k=0;k<d.length;k++){var w=k%m.length,O=k%v.length,I=e(m[2*w],m[2*w+1],v[2*O],v[2*O+1]);d[k]=I.real,p[k]=I.imag}else for(var S=function(t){var n=Ga.indexToLoc(t,c,l),r=n.slice(-b);f.forEach((function(e){return r[e]=0}));var a=Ga.locToIndex(r,b,g),i=n.slice(-y);h.forEach((function(e){return i[e]=0}));var o=Ga.locToIndex(i,y,x),s=e(m[2*a],m[2*a+1],v[2*o],v[2*o+1]);d[t]=s.real,p[t]=s.imag},N=0;N<d.length;N++)S(N);return[d,p,s]}}var TE=mE((function(e,t){return e+t})),CE=jE((function(e,t,n,r){return{real:e+n,imag:t+r}})),EE=NE(mt,TE,CE),_E={kernelName:mt,backendName:"cpu",kernelFunc:EE};function AE(e,t,n,r,a){for(var i=Ga.sizeFromShape(r),o=Ga.makeZerosTypedArray(a,n),s=0;s<e.length;s++){var u=e[s];if(u<0)throw new Error("Input x must be non-negative!");u>=a||(o[u]+=i>0?t[s]:1)}return o}function RE(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e.shape[0],i=e.shape[1],o=Ss([a,n],t.dtype),s=0;s<a;s++)for(var u=0;u<i;u++){var c=e.get(s,u);if(c<0)throw new Error("Input x must be non-negative!");c>=n||(r?o.set(1,s,c):t.size>0?o.set(o.get(s,c)+t.get(s,u),s,c):o.set(o.get(s,c)+1,s,c))}return o}var DE=mE((function(e,t){return e&t})),FE=NE(Rt,DE),ME={kernelName:Rt,backendName:"cpu",kernelFunc:FE};function zE(e){return function(t,n,r){for(var a=Ga.getArrayFromDType(n,t.length),i=0;i<t.length;++i)a[i]=e(t[i],r);return a}}function LE(e,t,n){return PE(e,zE(t),n)}function PE(e,t,n){return function(r){var a=r.inputs,i=r.attrs,o=r.backend,s=a.x;cE(s,e);var u,c=o,l=c.data.get(s.dataId).values;if("string"===s.dtype){if(!Array.isArray(l))throw new Error("String tensor's value was not an instance of Array");u=Wm.fromUint8ToStringArray(l)}else u=l;var d=n||s.dtype,p=t(u,d,i);return c.makeTensorInfo(s.shape,d,p)}}var BE=zE((function(e){return Math.ceil(e)})),WE=PE(zt,BE),UE={kernelName:zt,backendName:"cpu",kernelFunc:WE};function VE(e,t,n,r){var a=Ga.getArrayFromDType(n,Ga.sizeFromShape(t));if(r&&"string"!==n){var i=0;e.forEach((function(e){var t=Ga.sizeFromShape(e.shape);a.set(e.vals,i),i+=t}))}else{var o=0;e.forEach((function(e){for(var r="string"===n?Wm.fromUint8ToStringArray(e.vals):e.vals,i=0,s=0;s<e.shape[0];++s)for(var u=s*t[1]+o,c=0;c<e.shape[1];++c)a[u+c]=r[i++];o+=e.shape[1]}))}return a}var GE=mE((function(e,t){return e===t?1:0})),HE=NE(mn,GE,null,"bool"),qE={kernelName:mn,backendName:"cpu",kernelFunc:HE},KE=zE((function(e){return Math.exp(e)})),XE=PE(vn,KE,"float32"),YE={kernelName:vn,backendName:"cpu",kernelFunc:XE},ZE=zE((function(e){return Math.expm1(e)})),JE=PE(gn,ZE),QE={kernelName:gn,backendName:"cpu",kernelFunc:JE},$E=zE((function(e){return Math.floor(e)})),e_=PE(wn,$E),t_={kernelName:wn,backendName:"cpu",kernelFunc:e_},n_=mE((function(e,t){return Math.floor(e/t)})),r_=NE(On,n_,null,"int32"),a_={kernelName:On,backendName:"cpu",kernelFunc:r_};function i_(e,t,n,r,a,i,o,s,u){for(var c=Ss([r,i],n),l=0;l<r;l++){for(var d=[],p=0,f=0;f<a;f++){var h=e[l*a+f];p+=h*o[f],d.push(h)}if(p<0||p>=u/i)throw new Error("Invalid indices: ".concat(d," does not index into ").concat(s));for(var m=0;m<i;m++)c.values[l*i+m]=t.get.apply(t,Object(S.a)(t.indexToLoc(p*i+m)))}return c}function o_(e,t,n){for(var r=Ss(n,e.dtype),a=0;a<r.size;++a){var i=r.indexToLoc(a).slice(),o=i[0],s=i[2],u=t.locToIndex([o,s]);i[2]=t.values[u];var c=e.locToIndex(i);0<=c&&c<e.values.length&&(r.values[a]=e.values[c])}return r}var s_=mE((function(e,t){return e>t?1:0})),u_=NE(jn,s_,null,"bool"),c_={kernelName:jn,backendName:"cpu",kernelFunc:u_},l_=mE((function(e,t){return e>=t?1:0})),d_=NE(Tn,l_,null,"bool"),p_={kernelName:Tn,backendName:"cpu",kernelFunc:d_},f_=mE((function(e,t){return e<t?1:0})),h_=NE(Mn,f_,null,"bool"),m_={kernelName:Mn,backendName:"cpu",kernelFunc:h_},v_=mE((function(e,t){return e<=t?1:0})),b_=NE(zn,v_,null,"bool"),g_={kernelName:zn,backendName:"cpu",kernelFunc:b_};function y_(e,t,n){var r=(t-e)/(n-1),a=Ga.makeZerosTypedArray(n,"float32");a[0]=e;for(var i=1;i<a.length;i++)a[i]=a[i-1]+r;return a}var x_=zE((function(e){return Math.log(e)})),k_=PE(Pn,x_),w_={kernelName:Pn,backendName:"cpu",kernelFunc:k_};function O_(e,t,n,r){for(var a=Ga.getTypedArrayFromDType(r,Ga.sizeFromShape(n)),i=0;i<a.length;++i){for(var o=i*t,s=e[o],u=0;u<t;++u){var c=e[o+u];(Number.isNaN(c)||c>s)&&(s=c)}a[i]=s}return a}var I_=mE((function(e,t){return Math.max(e,t)})),S_=NE(Jn,I_),N_={kernelName:Jn,backendName:"cpu",kernelFunc:S_},j_=mE((function(e,t){return Math.min(e,t)})),T_=NE(ir,j_),C_={kernelName:ir,backendName:"cpu",kernelFunc:T_},E_=mE((function(e,t){return e*t})),__=jE((function(e,t,n,r){return{real:e*n-t*r,imag:e*r+t*n}})),A_=NE(cr,E_,__),R_={kernelName:cr,backendName:"cpu",kernelFunc:A_};function D_(e,t,n){var r=Ga.createScalarValue(-1,n);return E_([],t,r,e,n)}var F_={kernelName:lr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x;cE(r,"neg");var a=D_(n.data.get(r.dataId).values,r.shape,r.dtype),i=Object(y.a)(a,2),o=i[0],s=i[1];return n.makeTensorInfo(s,r.dtype,o)}},M_=mE((function(e,t){return e!==t?1:0})),z_=NE(dr,M_,null,"bool"),L_={kernelName:dr,backendName:"cpu",kernelFunc:z_};function P_(e,t,n,r,a){for(var i=t.length,o=Ga.sizeFromShape(t),s=Ga.computeStrides(t),u=Ga.computeStrides(a),c=Ga.getTypedArrayFromDType(n,Ga.sizeFromShape(a)),l=0;l<o;++l){for(var d=Ga.indexToLoc(l,i,s),p=new Array(d.length),f=0;f<p.length;f++)p[f]=d[r[f]];c[Ga.locToIndex(p,i,u)]=e[l]}return c}function B_(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.perm;cE(a,"transpose");for(var o=a.shape.length,s=new Array(o),u=0;u<s.length;u++)s[u]=a.shape[i[u]];var c=P_(r.data.get(a.dataId).values,a.shape,a.dtype,i,s);return{dataId:r.write(c,s,a.dtype),shape:s,dtype:a.dtype}}var W_={kernelName:ya,backendName:"cpu",kernelFunc:B_};function U_(e,t,n,r){for(var a=Wm.computeOutAndReduceShapes(e,r),i=Object(y.a)(a,2),o=i[0],s=i[1],u=Li(t,"int32"),c=Ga.makeZerosTypedArray(Ga.sizeFromShape(o),u),l=Ga.sizeFromShape(s),d=0;d<c.length;++d){for(var p=d*l,f=1,h=0;h<l;++h)f*=n[p+h];c[d]=f}return{outVals:c,outShape:o,outDtype:u}}var V_={kernelName:wr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims;cE(a,"prod");var s=a.shape.length,u=Ga.parseAxisParam(i,a.shape),c=Wm.getAxesPermutation(u,s),l=u,d=a,p=[];null!=c&&(d=B_({inputs:{x:a},backend:n,attrs:{perm:c}}),p.push(d),l=Wm.getInnerMostAxes(l.length,s));var f=n.data.get(d.dataId).values,h=U_(d.shape,d.dtype,f,l),m=h.outVals,v=h.outShape,b=h.outDtype,g=v;return o&&(g=Wm.expandShapeToKeepDim(v,u)),p.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(g,b,m)}};function G_(e,t,n,r){var a=[],i=0,o=t.length-1+n.length,s=new Array(o).fill(null).map((function(){return[0]}));!function(e,t){for(var n=0;n<e.length;++n){var r=e[n],a=n===e.length-1?t:e[n+1].length;if(0===r.length)throw new Error("Ragged splits may not be empty");if(r[0]<0)throw new Error("Ragged splits must be non-negative");if(r[r.length-1]>a)throw new Error("Ragged splits must not point past values");for(var i=1;i<r.length;++i)if(r[i-1]>r[i])throw new Error("Ragged splits must be sorted in ascending order")}}(n,r);for(var u=1,c=0;c<t.length-1;++c){u*=t[c];for(var l=t[c+1],d=1;d<u+1;++d)s[c].push(d*l)}for(var p=0;p<e.length;++p){for(var f=e[p],h=e[p]+1,m=0;m<n.length;++m){var v=n[m],b=m+t.length-1;if(b>=0)for(var g=s[b],y=g[g.length-1]-v[f],x=f;x<h;++x)s[b].push(v[x+1]+y);f=v[f],h=v[h]}h!==f&&(a.push([f,h]),i+=h-f)}return{outSplits:s,valueSlices:a,numValues:i}}function H_(e,t){for(var n=e.slice(0,t);n.length<t;)n.push(1);for(var r=t;r<e.length;r++)n[t-1]*=e[r];return n}function q_(e,t,n,r,a){var i=t.slice();i[0]=a;var o=Ga.getArrayFromDType(n,Ga.sizeFromShape(i)),s=e.length;return function(e,t,n,r,a,i){var o,s=H_(t,2)[1],u=H_(i,2)[1],c=0,l=Object(N.a)(n);try{for(l.s();!(o=l.n()).done;)for(var d=o.value,p=d[0];p<d[1];++p){for(var f=0;f<r;++f)a[c*u+f]=e[p*s+f];++c}}catch(h){l.e(h)}finally{l.f()}}(e,t,r,0===s?0:s/t[0],o,i),[o,i]}function K_(e,t,n,r,a,i,o,s){if(0===e.length)throw new Error("paramsNestedSplits must be non empty");if(0===t[0].length)throw new Error("Split tensors must not be scalars");if(function(e,t,n){e.forEach((function(e,r){if(e<0||e>=n){var a=Ga.indexToLoc(r,t.length,Ga.computeStrides(t)).join(",");throw new Error("indices[".concat(a,"] = ").concat(e," is not in [0, ").concat(n,")"))}}))}(i,o,t[0][0]-1),0===r.length)throw new Error("params.rank must be nonzero");var u=G_(i,o,e,r[0]),c=u.outSplits,l=u.valueSlices,d=u.numValues,p=function(e){for(var t=[],n=function(n){var r=e[n].length,a=Ga.getArrayFromDType("int32",r);t.push(a),e[n].forEach((function(e,t){return a[t]=e}))},r=0;r<e.length;++r)n(r);return t}(c),f=q_(n,r,a,l,d);return[p,f[0],f[1]]}var X_=2147483647;function Y_(e,t,n,r,a,i,o){if(t.length>1)throw new Error("starts must be a scalar or vector");if(a.length>1)throw new Error("limits must be a scalar or vector");if(o.length>1)throw new Error("deltas must be a scalar or vector");var s=0===t.length,u=0===a.length,c=0===o.length,l=[];s||l.push(t[0]),u||l.push(a[0]),c||l.push(o[0]);for(var d=1;d<l.length;++d)if(l[d]!==l[d-1])throw new Error("starts, limits, and deltas must have the same shape");var p=0===l.length?1:l[0],f=Ga.getArrayFromDType("int32",p+1);f[0]=0;for(var h=0;h<p;++h){var m=s?e[0]:e[h],v=u?r[0]:r[h],b=c?i[0]:i[h];if(0===b)throw new Error("Requires delta != 0");var g=void 0;if(b>0&&v<m||b<0&&v>m)g=0;else if((g=Math.ceil(Math.abs((v-m)/b)))>X_)throw new Error("Requires ((limit - start) / delta) <= ".concat(X_));f[h+1]=f[h]+g}for(var y=f[p],x=Ga.getArrayFromDType(n,y),k=0,w=0;w<p;++w)for(var O=f[w+1]-f[w],I=s?e[0]:e[w],S=c?i[0]:i[w],N=0;N<O;++N)x[k++]=I,I+=S;return[f,x]}var Z_=Wm.RowPartitionType,J_=function(){function e(t,n,r,a,i,o,s,u,c,l){Object(O.a)(this,e),this.shape=t,this.shapeShape=n,this.values=r,this.valuesShape=a,this.valuesDType=i,this.defaultValue=o,this.defaultValueShape=s,this.rowPartitionValues=u,this.rowPartitionValuesShapes=c,this.rowPartitionTypes=Wm.getRowPartitionTypesHelper(l),this.raggedRank=Wm.getRaggedRank(this.rowPartitionTypes)}return Object(I.a)(e,[{key:"getRowPartitionTypeByDimension",value:function(e){return this.rowPartitionTypes[0]===Z_.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}},{key:"getRowPartitionTensor",value:function(e){return this.rowPartitionTypes[0]===Z_.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}},{key:"getMaxWidth",value:function(t){var n=this.getRowPartitionTensor(t-1);switch(this.getRowPartitionTypeByDimension(t-1)){case Z_.VALUE_ROWIDS:return e.getMaxWidthValueRowID(n);case Z_.ROW_SPLITS:return e.getMaxWidthRowSplit(n);default:throw new Error("Cannot handle partition type ".concat(Z_[this.getRowPartitionTypeByDimension(t-1)]))}}},{key:"tensorShapeFromTensor",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(0===t.length){if(-1===e[0])return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return $_(e,n)}},{key:"calculateOutputSize",value:function(e){var t=this.valuesShape,n=this.defaultValueShape;Wm.validateDefaultValueShape(n,t);var r=this.tensorShapeFromTensor(this.shape,this.shapeShape),a=Wm.combineRaggedTensorToTensorShapes(this.raggedRank,r,t);a[0]<0&&(a[0]=e);for(var i=1;i<=this.raggedRank;++i)a[i]<0&&(a[i]=this.getMaxWidth(i));return a}},{key:"calculateFirstParentOutputIndex",value:function(e,t,n){for(var r=Math.min(e,n),a=[],i=0,o=0;o<r;++o,i+=t)a.push(i);for(var s=r;s<e;++s)a.push(-1);return Ga.assert(a.length===e,(function(){return"Final length of result must be equal to firstDimension."})),a}},{key:"calculateOutputIndexRowSplit",value:function(e,t,n,r){for(var a=e.length,i=[],o=0;o<a-1;++o){var s=e[o+1]-e[o],u=Math.min(r,s),c=t[o];-1===c&&(u=0);for(var l=0;l<u;++l)i.push(c),c+=n;for(var d=0;d<s-u;++d)i.push(-1)}if(a>0&&i.length!==e[a-1])throw new Error("Invalid row split size.");return i}},{key:"calculateOutputIndexValueRowID",value:function(e,t,n,r){var a=e.length,i=[];if(0===a)return[];var o=0,s=e[0];if(s>=t.length)throw new Error("Got currentValueRowId=".concat(s,", which is not less than ").concat(t.length));var u=t[s];i.push(u);for(var c=1;c<a;++c){var l=e[c];if(l===s)u>=0&&(++o<r?u+=n:u=-1);else{if(o=0,s=l,l>=t.length)throw new Error("Got nextValueRowId=".concat(l," which is not less than ").concat(t.length));u=t[l]}i.push(u)}if(i.length!==e.length)throw new Error("Invalid row ids.");return i}},{key:"calculateOutputIndex",value:function(e,t,n,r){var a=this.getRowPartitionTensor(e),i=this.getRowPartitionTypeByDimension(e);switch(i){case Z_.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(a,t,n,r);case Z_.ROW_SPLITS:if(a.length-1>t.length)throw new Error("Row partition size is greater than output size: ".concat(a.length-1," > ").concat(t.length));return this.calculateOutputIndexRowSplit(a,t,n,r);default:throw new Error("Unsupported partition type: ".concat(Z_[i]))}}},{key:"getFirstDimensionSize",value:function(){var e=this.rowPartitionValues[0];if(0===this.rowPartitionTypes.length)throw new Error("No row_partition_types given.");var t=this.rowPartitionTypes[0];switch(t){case Z_.FIRST_DIM_SIZE:return e[0];case Z_.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case Z_.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error("Cannot handle type ".concat(Z_[t]))}}},{key:"compute",value:function(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");var e=this.getFirstDimensionSize(),t=this.calculateOutputSize(e),n=new Array(this.raggedRank+1);n[n.length-1]=1;for(var r=n.length-2;r>=0;--r)n[r]=n[r+1]*t[r+1];var a=$_(t,!1),i=Ga.getArrayFromDType(this.valuesDType,Ga.sizeFromShape(a));if(n[0]*t[0]>0){for(var o=this.calculateFirstParentOutputIndex(e,n[0],t[0]),s=1;s<=this.raggedRank;++s)o=this.calculateOutputIndex(s-1,o,n[s],t[s]);this.setOutput(this.raggedRank,o,i,a)}return[a,i]}},{key:"setOutput",value:function(e,t,n,r){if(0!==n.length){var a=this.values,i=n,o=r.slice();o=o.slice(e+1);var s=Ga.sizeFromShape(o),u=t.length,c=this.defaultValue;if(c.length!==s&&1!==c.length){var l=this.defaultValueShape;zs((function(){var e=Eu(c,l);c=Xu(e,o).dataSync()}))}for(var d=0,p=0,f=0,h=0;h<=u;++h){var m=h<u?t[h]:-1;if(m!==f){if(p<f){var v=a.subarray(d*s);Q_(i.subarray(p*s),v,(f-p)*s)}if(h>=u){var b=n.length;m=Math.floor(b/s)}if(m>f)if(1===this.defaultValue.length)i.subarray(f*s,m*s).fill(this.defaultValue[0]),f=m;else for(;m>f;){Q_(i.slice(f*s),c,s),++f}m<0?(d=h+1,p=f):(d=h,f=(p=f)+1)}else++f}}}}],[{key:"getMaxWidthRowSplit",value:function(e){var t=e.length;if(0===t||1===t)return 0;for(var n=0,r=0;r<t-1;++r){var a=e[r+1]-e[r];a>n&&(n=a)}return n}},{key:"getMaxWidthValueRowID",value:function(e){var t=e.length;if(0===t)return 0;for(var n=0,r=e[0],a=0,i=1;i<t;++i){var o=e[i];o!==r&&(r=o,a=Math.max(i-n,a),n=i)}return Math.max(t-n,a)}}]),e}();function Q_(e,t,n){for(var r=0;r<n;r++)e[r]=t[r]}function $_(e,t){var n,r=[],a=Object(N.a)(e);try{for(a.s();!(n=a.n()).done;){var i=n.value;if(i<0){if(!t)throw new Error("Dimension ".concat(i," must be >= 0"));if(i<-1)throw new Error("Dimension ".concat(i," must be >= -1"));i=-1}r.push(i)}}catch(o){a.e(o)}finally{a.f()}return r}function eA(e,t,n,r,a,i,o,s,u,c){return new J_(e,t,n,r,a,i,o,s,u,c).compute()}function tA(e,t,n,r){if(e===t||e<t&&n<0||t<e&&n>1)return Ga.makeZerosTypedArray(0,r);var a=Math.abs(Math.ceil((t-e)/n)),i=Ga.makeZerosTypedArray(a,r);t<e&&1===n&&(n=-1),i[0]=e;for(var o=1;o<i.length;o++)i[o]=i[o-1]+n;return i}var nA=zE((function(e){return 1/Math.sqrt(e)})),rA=PE(Lr,nA),aA={kernelName:Lr,backendName:"cpu",kernelFunc:rA};function iA(e,t,n,r,a,i,o,s,u,c){var l=[r/a,a],d=e.values,p=t.values;if(0===r)return Ss(n,t.dtype);var f=u instanceof Si?u:Ss(l,t.dtype);"string"==typeof u||"number"==typeof u?f.values.fill(u):"boolean"==typeof u&&f.values.fill(+u);for(var h=0;h<i;h++){for(var m=[],v=0,b=0;b<o;b++){var g=d[h*o+b];m.push(g),v+=g*s[b]}if(v<0||v>=r/a)throw new Error("Invalid indices: ".concat(m," does not index into ").concat(n));for(var y=0;y<a;y++)c?f.values[v*a+y]+=p[h*a+y]:f.values[v*a+y]=0===t.rank?p[0]:p[h*a+y]}return f}var oA=zE((function(e){return 1/(1+Math.exp(-e))})),sA=LE(Xr,(function(e){return 1/(1+Math.exp(-e))})),uA={kernelName:Xr,backendName:"cpu",kernelFunc:sA};function cA(e,t,n,r,a){var i=bm.isSliceContinous(r,t,n),o=Ga.sizeFromShape(n),s=Ga.computeStrides(r);if(i){var u=bm.computeFlatOffset(t,s);return"string"===a?e.slice(u,u+o):e.subarray(u,u+o)}for(var c=Ss(r,a,"string"===a?Wm.fromUint8ToStringArray(e):e),l=Ss(n,a),d=0;d<l.size;++d){var p=l.indexToLoc(d),f=p.map((function(e,n){return e+t[n]}));l.set.apply(l,[c.get.apply(c,Object(S.a)(f))].concat(Object(S.a)(p)))}return"string"===a?Wm.fromStringArrayToUint8(l.values):l.values}function lA(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.begin,o=r.size;cE(a,"slice");var s=bm.parseSliceParams(a,i,o),u=Object(y.a)(s,2),c=u[0],l=u[1];bm.assertParamsValid(a,c,l);var d=cA(n.data.get(a.dataId).values,c,l,a.shape,a.dtype);return n.makeTensorInfo(l,a.dtype,d)}var dA={kernelName:Gr,backendName:"cpu",kernelFunc:lA};function pA(e,t,n,r,a,i,o){var s=t[0],u=i[0],c=new Array(u),l=new Array(s),d=t[1];if(0===u){if(0!==s)throw new Error(Wm.getSparseFillEmptyRowsIndicesDenseShapeMismatch(s));return[Ga.getArrayFromDType(n,0),[0,d],Ga.getArrayFromDType(a,0),c,l]}for(var p=!0,f=0,h=new Array(u).fill(0),m=0;m<s;++m){var v=e[m*d];if(v<0)throw new Error(Wm.getSparseFillEmptyRowsNegativeIndexErrorMessage(m,v));if(v>=u)throw new Error(Wm.getSparseFillEmptyRowsOutOfRangeIndexErrorMessage(m,v,u));++h[v],p=p&&v>=f,f=v}for(var b=!0,g=0;g<u;++g){var y=0===h[g];c[g]=y,b=b&&!y,h[g]=Math.max(h[g],1),g>0&&(h[g]+=h[g-1])}if(b&&p){for(var x=e,k=r,w=0;w<s;++w)l[w]=w;return[x,[s,d],k,c,l]}for(var O=h[u-1],I=Ga.getArrayFromDType(n,O*d),S=Ga.getArrayFromDType(a,O),N=new Array(u).fill(0),j=0;j<s;++j){var T=e[j*d],C=N[T],E=(0===T?0:h[T-1])+C;N[T]++;for(var _=0;_<d;++_)I[E*d+_]=e[j*d+_];S[E]=r[j],l[j]=E}for(var A=0;A<u;++A)if(0===N[A]){var R=0===A?0:h[A-1];I[R*d+0]=A;for(var D=1;D<d;++D)I[R*d+D]=0;S[R]=o}return[I,[O,d],S,c,l]}function fA(e,t,n,r,a){for(var i=Ga.sizeFromShape(r),o=t[0],s=a.length,u=[],c=1,l=-1,d=0;d<s;++d){var p=a[d];if(-1===p){if(-1!==l)throw new Error(Wm.getSparseReshapeMultipleNegativeOneOutputDimErrorMessage(l,d));l=d,u.push(1)}else{if(p<0)throw new Error(Wm.getSparseReshapeNegativeOutputDimErrorMessage(d,p));c*=p,u.push(p)}}if(-1!==l){if(c<=0)throw new Error(Wm.getSparseReshapeEmptyTensorZeroOutputDimErrorMessage());var f=Math.trunc(i/c);if(c*f!==i)throw new Error(Wm.getSparseReshapeInputOutputMultipleErrorMessage(r,u));u[l]=f}if(Ga.sizeFromShape(u)!==i)throw new Error(Wm.getSparseReshapeInputOutputMismatchErrorMessage(r,u));var h=r.length,m=[];if(h>0){m[h-1]=1;for(var v=h-2;v>=0;--v)m[v]=m[v+1]*r[v+1]}var b=[];if(s>0){b[s-1]=1;for(var g=s-2;g>=0;--g)b[g]=b[g+1]*u[g+1]}for(var y=Ga.getArrayFromDType(n,o*s),x=0;x<o;++x){for(var k=0,w=0;w<h;++w)k+=e[x*h+w]*m[w];for(var O=0;O<s;++O)y[x*s+O]=Math.trunc(k/b[O]),k%=b[O]}return[y,[o,s],u]}function hA(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=r.length,u=[t[0],e.length/t[0]],c=u[1],l=s>0?a[s-1]+1:0;if(l<0)throw new Error(Wm.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());var d=t.slice();d[0]=l;var p=d.reduce((function(e,t){return e*t}),1),f=Ga.getArrayFromDType(n,p);if(0===s)return l>0&&f.fill(o),[f,d];if(l<=0)throw new Error(Wm.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());for(var h=0,m=1,v=0,b=a[h];;){var g=0;if(m<s){if(b===(g=a[m])){++m;continue}if(b>=g)throw new Error(Wm.getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage())}if(b<0||b>=l)throw new Error(Wm.getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage(b,l));b>v&&f.fill(o,v*c,b*c);for(var y=h;y<m;++y){var x=r[y];if(x<0||x>=u[0])throw new Error(Wm.getSparseSegmentReductionIndicesOutOfRangeErrorMessage(y,r[y],u[0]));for(var k=0;k<c;k++)f[b*c+k]+=e[x*c+k]}if(i)for(var w=0;w<c;w++)f[b*c+w]/=m-h;if(h=m,v=b+1,b=g,++m>s)break}return v<l&&f.fill(o,v*c,l*c),[f,d]}var mA=zE((function(e){return Math.sqrt(e)})),vA=LE(Zr,(function(e){return Math.sqrt(e)})),bA={kernelName:Zr,backendName:"cpu",kernelFunc:vA},gA=mE((function(e,t){var n=e-t;return n*n})),yA=NE(oa,gA),xA={kernelName:oa,backendName:"cpu",kernelFunc:yA},kA=zE((function(e,t){var n=t.pattern,r=t.replaceGlobal,a=t.rewrite;return e.replace(new RegExp(n,r?"g":""),a)})),wA=PE(ua,kA),OA={kernelName:ua,backendName:"cpu",kernelFunc:wA};function IA(e,t,n,r){for(var a=Ss(e,t.dtype),i=0;i<a.size;i++){for(var o=a.indexToLoc(i),s=new Array(o.length),u=0;u<s.length;u++)s[u]=o[u]*n[u]+r[u];a.set.apply(a,[t.get.apply(t,s)].concat(Object(S.a)(o)))}return a}var SA=function(){function e(t,n,r,a,i,o){Object(O.a)(this,e),this.separator=Ga.encodeString(t),this.nGramWidths=n,this.leftPad=Ga.encodeString(r),this.rightPad=Ga.encodeString(a),this.padWidth=i,this.preserveShort=o}return Object(I.a)(e,[{key:"getPadWidth",value:function(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}},{key:"getNumNGrams",value:function(e,t){var n=this.getPadWidth(t);return Math.max(0,e+2*n-t+1)}},{key:"createNGrams",value:function(e,t,n,r,a,i){for(var o=this,s=function(s){var u=o.getPadWidth(i),c=Math.max(0,u-s),l=Math.max(0,u-(a-(s+1))),d=i-(c+l),p=t+(c>0?0:s-u),f=0;f+=c*o.leftPad.length;for(var h=0;h<d;++h)f+=e[p+h].length;f+=l*o.rightPad.length,f+=(c+l+d-1)*o.separator.length,n[r+s]=new Uint8Array(f);for(var m=n[r+s],v=0,b=function(e){return e.forEach((function(e){return m[v++]=e}))},g=0;g<c;++g)b(o.leftPad),b(o.separator);for(var y=0;y<d-1;++y)b(e[p+y]),b(o.separator);if(d>0){b(e[p+d-1]);for(var x=0;x<l;++x)b(o.separator),b(o.rightPad)}else{for(var k=0;k<l-1;++k)b(o.rightPad),b(o.separator);b(o.rightPad)}},u=0;u<a;++u)s(u)}},{key:"compute",value:function(e,t){var n=this,r=e.length,a=t.length;if(a>0){var i=t[0];if(0!==i)throw new Error("First split value must be 0, got ".concat(i));for(var o=1;o<a;++o){var s=t[o]>=i;if(!(s=s&&t[o]<=r))throw new Error("Invalid split value ".concat(t[o],", must be in [").concat(i,", ").concat(r,"]"));i=t[o]}if(i!==r)throw new Error("Last split value must be data size. Expected ".concat(r,", got ").concat(i))}var u=a-1,c=Ga.getArrayFromDType("int32",a);if(0===r||0===a){for(var l=new Array(r),d=0;d<=u;++d)c[d]=0;return[l,c]}c[0]=0;for(var p=function(e){var r=t[e]-t[e-1],a=0;n.nGramWidths.forEach((function(e){a+=n.getNumNGrams(r,e)})),n.preserveShort&&r>0&&0===a&&(a=1),c[e]=c[e-1]+a},f=1;f<=u;++f)p(f);for(var h=new Array(c[u]),m=function(r){var a=t[r],i=c[r];if(n.nGramWidths.forEach((function(o){var s=t[r+1]-t[r],u=n.getNumNGrams(s,o);n.createNGrams(e,a,h,i,u,o),i+=u})),n.preserveShort&&i===c[r]){var o=t[r+1]-t[r];if(0===o)return"continue";var s=o+2*n.padWidth;n.createNGrams(e,a,h,i,1,s)}},v=0;v<u;++v)m(v);return[h,c]}}]),e}();function NA(e,t,n,r,a,i,o,s){return new SA(n,r,a,i,o,s).compute(e,t)}function jA(e,t,n,r){if(e.length)if(0!==t.length)if(1!==t.length){for(var a=0,i=0;i<e.length+1;i++)if(i===e.length||-1!==t.indexOf(e[i])){var o=e.subarray(a,i);(!n||0!==o.length)&&r.push(o),a=i+1}}else{for(var s=t[0],u=e.indexOf(s);-1!==u;){var c=e.subarray(0,u);(!n||0!==c.length)&&r.push(c),u=(e=e.subarray(u+1)).indexOf(s)}(!n||0!==e.length)&&r.push(e)}else for(var l=0;l<e.length;++l)r.push(e.subarray(l,l+1))}function TA(e,t,n){for(var r=e.length,a=[],i=0,o=0,s=new Array(r),u=0;u<r;++u){var c=a.length;jA(e[u],t,n,a);var l=a.length-c;s[u]=l,i+=l,o=Math.max(o,l)}for(var d=Ga.getArrayFromDType("int32",2*i),p=new Array(i),f=[r,o],h=0,m=0;m<r;++m)for(var v=0;v<s[m];++v)d[2*h]=m,d[2*h+1]=v,p[h]=a[h],++h;return[d,p,f]}function CA(e,t){for(var n=Ga.getArrayFromDType("int32",e.length),r=0;r<e.length;++r)n[r]=Ga.fingerPrint64(e[r]).modulo(t).getLowBitsUnsigned();return n}var EA=mE((function(e,t){return e-t})),_A=jE((function(e,t,n,r){return{real:e-n,imag:t-r}})),AA=NE(fa,EA,_A),RA={kernelName:fa,backendName:"cpu",kernelFunc:AA};function DA(e,t){for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[r]*t[r];for(var a=Ss(n,e.dtype),i=0;i<a.values.length;++i){for(var o=a.indexToLoc(i),s=new Array(e.rank),u=0;u<s.length;u++)s[u]=o[u]%e.shape[u];var c=e.locToIndex(s);a.values[i]=e.values[c]}return a}var FA=function(e,t){var n=t.value-e.value;return 0===n?e.index-t.index:n};function MA(e,t,n,r,a){for(var i=t[t.length-1],o=e.length/i,s=i,u=Ga.getTypedArrayFromDType(n,o*r),c=Ga.getTypedArrayFromDType("int32",o*r),l=function(t){var n=t*s,i=e.subarray(n,n+s),o=new Array(i.length);i.forEach((function(e,t){return o[t]={value:e,index:t}})),r<o.length&&(function e(t,n){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.length-1;a>r;){if(a-r>600){var i=a-r+1,o=n-r+1,s=Math.log(i),u=.5*Math.exp(2*s/3),c=.5*Math.sqrt(s*u*(i-u)/i)*Math.sign(o-i/2),l=Math.max(r,Math.floor(n-o*u/i+c)),d=Math.min(a,Math.floor(n+(i-o)*u/i+c));e(t,n,l,d)}var p=t[n],f=r,h=a;for(Ga.swap(t,r,n),FA(t[a],p)>0&&Ga.swap(t,r,a);f<h;){for(Ga.swap(t,f,h),f++,h--;FA(t[f],p)<0;)f+=1;for(;FA(t[h],p)>0;)h-=1}0===FA(t[r],p)?Ga.swap(t,r,h):(h+=1,Ga.swap(t,h,a)),h<=n&&(r=h+1),n<=h&&(a=h-1)}}(o,r),o=o.slice(0,r)),a&&o.sort(FA);for(var l=t*r,d=u.subarray(l,l+r),p=c.subarray(l,l+r),f=0;f<r;f++)d[f]=o[f].value,p[f]=o[f].index},d=0;d<o;d++)l(d);var p=t.slice();return p[p.length-1]=r,[Ss(p,n,u),Ss(p,"int32",c)]}function zA(e,t,n,r){for(var a=Ga.parseAxisParam(t,n)[0],i=[1,n[0],1],o=0;o<a;o++)i[0]*=n[o];i[1]=n[a];for(var s=a+1;s<n.length;s++)i[2]*=n[s];for(var u=new Map,c=new Int32Array(n[a]),l=new Si(i,r,e),d=[],p=1===i[0]&&1===i[2],f=0;f<n[a];f++){var h=void 0;if(p)h=e[f].toString();else{for(var m=[],v=0;v<i[0];v++)for(var b=0;b<i[2];b++)m.push(l.get(v,f,b));h=m.join(",")}var g=u.get(h);if(null!=g)c[f]=g;else{var y=u.size;u.set(h,y),c[f]=y,d.push(f)}}var x=i.slice();x[1]=u.size;var k=new Si(x,r);d.forEach((function(e,t){for(var n=0;n<i[0];n++)for(var r=0;r<i[2];r++)k.set(l.get(n,e,r),n,t,r)}));var w=n.slice();return w[a]=x[1],{outputValues:k.values,outputShape:w,indices:c}}var LA="4.7.0";Ks("cpu",(function(){return new dE}),1);var PA=LE(pn,(function(e){return e>=0?e:Math.exp(e)-1})),BA={kernelName:pn,backendName:"cpu",kernelFunc:PA};function WA(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.alpha;cE([a],"leakyRelu");for(var o=Ga.sizeFromShape(a.shape),s=n.data.get(a.dataId).values,u=Ga.getTypedArrayFromDType("float32",o),c=0;c<s.length;c++)u[c]=s[c]<0?i*s[c]:s[c];return n.makeTensorInfo(a.shape,"float32",u)}var UA={kernelName:Fn,backendName:"cpu",kernelFunc:WA},VA=mE((function(e,t){return e<0?t*e:e}));function GA(e){var t=e.inputs,n=e.backend,r=t.x,a=t.alpha;cE([r,a],"prelu");var i=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,s=VA(r.shape,a.shape,i,o,"float32"),u=Object(y.a)(s,2),c=u[0],l=u[1];return n.makeTensorInfo(l,"float32",c)}var HA={kernelName:kr,backendName:"cpu",kernelFunc:GA},qA=LE(Cr,(function(e){return Math.max(0,e)})),KA={kernelName:Cr,backendName:"cpu",kernelFunc:qA},XA=LE(Fr,(function(e){return Math.min(Math.max(0,e),6)})),YA={kernelName:Fr,backendName:"cpu",kernelFunc:XA};function ZA(e,t,n,r,a){if("linear"===n)return yE({inputs:{x:t},backend:e});if("relu"===n)return qA({inputs:{x:t},backend:e});if("elu"===n)return PA({inputs:{x:t},backend:e});if("relu6"===n)return XA({inputs:{x:t},backend:e});if("prelu"===n)return GA({inputs:{x:t,alpha:r},backend:e});if("leakyrelu"===n)return WA({inputs:{x:t},backend:e,attrs:{alpha:a}});if("sigmoid"===n)return sA({inputs:{x:t},backend:e});throw new Error("Activation ".concat(n," has not been implemented for the CPU backend."))}function JA(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.shape,o=Ga.sizeFromShape(a.shape),s=Ga.inferFromImplicitShape(i,o),u=Ga.sizeFromShape(s);Ga.assert(o===u,(function(){return"The new shape (".concat(s,") has ").concat(u," elements and the old shape (").concat(a.shape,") has ").concat(o," elements. The new shape and old shape must have the same number of elements.")})),n.incRef(a.dataId);var c=n.data.get(a.dataId);if(null!=c.complexTensorInfos){var l=c.complexTensorInfos.real,d=c.complexTensorInfos.imag;l.shape=s,d.shape=s}return{dataId:a.dataId,shape:s,dtype:a.dtype}}var QA={kernelName:Er,backendName:"cpu",kernelFunc:JA};function $A(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.a,i=t.b,o=r.transposeA,s=r.transposeB;cE([a,i],"matMul");var u=a.shape.length,c=i.shape.length,l=o?a.shape[u-2]:a.shape[u-1],d=s?i.shape[c-1]:i.shape[c-2],p=o?a.shape[u-1]:a.shape[u-2],f=s?i.shape[c-2]:i.shape[c-1],h=a.shape.slice(0,-2),m=i.shape.slice(0,-2),v=Ga.sizeFromShape(h),b=Ga.sizeFromShape(m),g=gc.assertAndGetBroadcastShape(a.shape.slice(0,-2),i.shape.slice(0,-2)).concat([p,f]);Ga.assert(l===d,(function(){return"Error in matMul: inner shapes (".concat(l,") and (").concat(d,") of Tensors with shapes ").concat(a.shape," and ").concat(i.shape," and transposeA=").concat(o," and transposeB=").concat(s," must match.")}));for(var x=s?[b,f,d]:[b,d,f],k=JA({inputs:{x:a},backend:n,attrs:{shape:o?[v,l,p]:[v,p,l]}}),w=JA({inputs:{x:i},backend:n,attrs:{shape:x}}),O=o?k.shape[1]:k.shape[2],I=o?k.shape[2]:k.shape[1],S=s?w.shape[1]:w.shape[2],N=Math.max(v,b),j=n.data.get(k.dataId).values,T=n.data.get(w.dataId).values,C=Ga.computeStrides(k.shape),E=Ga.computeStrides(w.shape),_=o?[C[0],1,C[1]]:[C[0],C[1],1],A=Object(y.a)(_,3),R=A[0],D=A[1],F=A[2],M=s?[1,E[1],E[0]]:[E[1],1,E[0]],z=Object(y.a)(M,3),L=z[0],P=z[1],B=z[2],W=I*S,U=Ss([N,I,S],k.dtype),V=U.values,G=n.blockSize,H=0;H<N;H++)for(var q=H%v,K=H%b,X=0;X<I;X+=G)for(var Y=Math.min(X+G,I),Z=0;Z<S;Z+=G)for(var J=Math.min(Z+G,S),Q=0;Q<O;Q+=G)for(var $=Math.min(Q+G,O),ee=X;ee<Y;ee++)for(var te=Z;te<J;te++){for(var ne=0,re=Q;re<$;re++){ne+=j[q*R+ee*D+re*F]*T[re*L+te*P+K*B]}V[H*W+(ee*S+te)]+=ne}return n.disposeIntermediateTensorInfo(k),n.disposeIntermediateTensorInfo(w),n.makeTensorInfo(g,U.dtype,U.values)}var eR={kernelName:Et,backendName:"cpu",kernelFunc:$A};var tR={kernelName:Ta,backendName:"cpu",kernelFunc:function(e){var t,n,r,a=e.inputs,i=e.backend,o=e.attrs,s=a.a,u=a.b,c=a.bias,l=a.preluActivationWeights,d=o.transposeA,p=o.transposeB,f=o.activation,h=o.leakyreluAlpha,m=[];t=$A({inputs:{a:s,b:u},attrs:{transposeA:d,transposeB:p},backend:i}),c&&(n=EE({inputs:{a:t,b:c},backend:i}),m.push(t),t=n),f&&(r=ZA(i,t,f,l,h),m.push(t),t=r);for(var v=0,b=m;v<b.length;v++){var g=b[v];i.disposeIntermediateTensorInfo(g)}return t}},nR=LE(ft,(function(e){return Math.acos(e)})),rR={kernelName:ft,backendName:"cpu",kernelFunc:nR},aR=LE(ht,(function(e){return Math.acosh(e)})),iR={kernelName:ht,backendName:"cpu",kernelFunc:aR};var oR={kernelName:vt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t;cE(t,"addN");for(var a=r.map((function(e){return n.data.get(e.dataId).values})),i=Ss(r[0].shape,r[0].dtype),o=i.values,s=0;s<r.length;s++)for(var u=a[s],c=0;c<o.length;c++)o[c]+=u[c];return n.makeTensorInfo(i.shape,i.dtype,i.values)}};var sR={kernelName:bt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims;cE(a,"all");var s=Ga.parseAxisParam(i,a.shape),u=s,c=Wm.getAxesPermutation(u,a.shape.length),l=a;null!=c&&(l=B_({inputs:{x:a},backend:n,attrs:{perm:c}}),u=Wm.getInnerMostAxes(u.length,a.shape.length)),Wm.assertAxesAreInnerMostDims("all",u,l.shape.length);for(var d=Wm.computeOutAndReduceShapes(l.shape,u),p=Object(y.a)(d,2),f=p[0],h=p[1],m=Ga.sizeFromShape(h),v=Ga.makeZerosTypedArray(Ga.sizeFromShape(f),l.dtype),b=n.data.get(l.dataId).values,g=0;g<v.length;++g){for(var x=g*m,k=b[x],w=0;w<m;++w){var O=b[x+w];k=k&&O}v[g]=k}null!=c&&n.disposeIntermediateTensorInfo(l);var I=n.makeTensorInfo(f,l.dtype,v);if(o){var S=JA({inputs:{x:I},backend:n,attrs:{shape:Wm.expandShapeToKeepDim(f,s)}});return n.disposeIntermediateTensorInfo(I),S}return I}};var uR={kernelName:gt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims;cE(a,"any");var s=Ga.parseAxisParam(i,a.shape),u=s,c=Wm.getAxesPermutation(u,a.shape.length),l=a;null!=c&&(l=B_({inputs:{x:a},backend:n,attrs:{perm:c}}),u=Wm.getInnerMostAxes(u.length,a.shape.length)),Wm.assertAxesAreInnerMostDims("any",u,l.shape.length);for(var d=Wm.computeOutAndReduceShapes(l.shape,u),p=Object(y.a)(d,2),f=p[0],h=p[1],m=Ga.sizeFromShape(h),v=Ga.makeZerosTypedArray(Ga.sizeFromShape(f),l.dtype),b=n.data.get(l.dataId).values,g=0;g<v.length;++g){for(var x=g*m,k=b[x],w=0;w<m;++w){var O=b[x+w];k=k||O}v[g]=k}null!=c&&n.disposeIntermediateTensorInfo(l);var I=n.makeTensorInfo(f,l.dtype,v);if(o){var S=JA({inputs:{x:I},backend:n,attrs:{shape:Wm.expandShapeToKeepDim(f,s)}});return n.disposeIntermediateTensorInfo(I),S}return I}};var cR={kernelName:yt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis;cE(a,"argMax");var o=Ga.parseAxisParam(i,a.shape),s=Wm.getAxesPermutation(o,a.shape.length),u=a,c=[];null!=s&&(u=B_({inputs:{x:a},backend:n,attrs:{perm:s}}),c.push(u),o=Wm.getInnerMostAxes(o.length,u.shape.length)),o=[o[0]],Wm.assertAxesAreInnerMostDims("argMax",o,u.shape.length);for(var l=Wm.computeOutAndReduceShapes(u.shape,o),d=Object(y.a)(l,2),p=d[0],f=d[1],h=Ga.sizeFromShape(p),m=Ga.makeZerosTypedArray(h,"int32"),v=Ga.sizeFromShape(f),b=n.data.get(u.dataId).values,g=0;g<m.length;++g){for(var x=g*v,k=b[x],w=0,O=0;O<v;++O){var I=b[x+O];I>k&&(k=I,w=O)}m[g]=w}return c.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(p,"int32",m)}};var lR={kernelName:xt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis;cE(a,"argMin");var o=Ga.parseAxisParam(i,a.shape),s=Wm.getAxesPermutation(o,a.shape.length),u=a,c=[];null!=s&&(u=B_({inputs:{x:a},backend:n,attrs:{perm:s}}),c.push(u),o=Wm.getInnerMostAxes(o.length,u.shape.length)),o=[o[0]],Wm.assertAxesAreInnerMostDims("argMin",o,u.shape.length);for(var l=Wm.computeOutAndReduceShapes(u.shape,o),d=Object(y.a)(l,2),p=d[0],f=d[1],h=Ga.sizeFromShape(p),m=Ga.makeZerosTypedArray(h,"int32"),v=Ga.sizeFromShape(f),b=n.data.get(u.dataId).values,g=0;g<m.length;++g){for(var x=g*v,k=b[x],w=0,O=0;O<v;++O){var I=b[x+O];I<k&&(k=I,w=O)}m[g]=w}return c.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(p,"int32",m)}},dR=LE(kt,(function(e){return Math.asin(e)})),pR={kernelName:kt,backendName:"cpu",kernelFunc:dR},fR=LE(wt,(function(e){return Math.asinh(e)})),hR={kernelName:wt,backendName:"cpu",kernelFunc:fR},mR=LE(Ot,(function(e){return Math.atan(e)})),vR={kernelName:Ot,backendName:"cpu",kernelFunc:mR},bR=mE((function(e,t){return Math.atan2(e,t)})),gR=NE(St,bR),yR={kernelName:St,backendName:"cpu",kernelFunc:gR},xR=LE(It,(function(e){return Math.atanh(e)})),kR={kernelName:It,backendName:"cpu",kernelFunc:xR};function wR(e,t,n,r,a,i){for(var o=a.strideHeight,s=a.strideWidth,u=a.dilationHeight,c=a.dilationWidth,l=a.effectiveFilterHeight,d=a.effectiveFilterWidth,p=a.padInfo.top,f=a.padInfo.left,h="max"===i?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=Ss(a.outShape,n),v=m.values,b=a.outShape[1]*a.outShape[2]*a.outShape[3],g=a.outShape[2]*a.outShape[3],y=a.outShape[3],x=0;x<a.batchSize;++x)for(var k=x*b,w=x*r[0],O=0;O<a.inChannels;++O)for(var I=0;I<a.outHeight;++I)for(var S=I*o-p,N=Math.max(0,S),j=Math.min(a.inHeight,l+S),T=k+I*g,C=0;C<a.outWidth;++C){for(var E=C*s-f,_=Math.max(0,E),A=Math.min(a.inWidth,d+E),R=h,D=0,F=0,M=N;M<j;M+=u){for(var z=w+M*r[1],L=_;L<A;L+=c){var P=e[z+L*r[2]+O];"max"===i&&P>R?R=P:"avg"===i&&(D+=P,F++)}if(isNaN(R))break}v[T+C*y+O]="avg"===i?D/F:R}return m}function OR(e,t,n,r){for(var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=Ss(r.outShape,"int32"),s=r.strideHeight,u=r.strideWidth,c=r.dilationHeight,l=r.dilationWidth,d=r.effectiveFilterHeight,p=r.effectiveFilterWidth,f=r.padInfo.top,h=r.padInfo.left,m=Ss(t,n,e),v=0;v<r.batchSize;++v)for(var b=0;b<r.inChannels;++b)for(var g=0;g<r.outHeight;++g){for(var y=g*s-f,x=y;x<0;)x+=c;for(var k=Math.min(r.inHeight,d+y),w=0;w<r.outWidth;++w){for(var O=w*u-h,I=O;I<0;)I+=l;for(var S=Math.min(r.inWidth,p+O),N=Number.NEGATIVE_INFINITY,j=-1,T=x;T<k;T+=c)for(var C=T-y,E=I;E<S;E+=l){var _=E-O,A=m.get(v,T,E,b);A>N&&(N=A,j=a?i?((v*r.inHeight+T)*r.inWidth+E)*r.inChannels+b:(T*r.inWidth+E)*r.inChannels+b:C*p+_)}o.set(j,v,g,w,b)}}return o}function IR(e,t,n,r,a,i){for(var o=a.strideDepth,s=a.strideHeight,u=a.strideWidth,c=a.dilationDepth,l=a.dilationHeight,d=a.dilationWidth,p=a.effectiveFilterDepth,f=a.effectiveFilterHeight,h=a.effectiveFilterWidth,m=a.padInfo.front,v=a.padInfo.top,b=a.padInfo.left,g="max"===i?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,y=Ss(a.outShape,n),x=y.values,k=a.outShape[1]*a.outShape[2]*a.outShape[3]*a.outShape[4],w=a.outShape[2]*a.outShape[3]*a.outShape[4],O=a.outShape[3]*a.outShape[4],I=a.outShape[4],S=0;S<a.batchSize;++S)for(var N=S*k,j=S*r[0],T=0;T<a.inChannels;++T)for(var C=0;C<a.outDepth;++C){for(var E=C*o-m,_=E;_<0;)_+=c;for(var A=Math.min(a.inDepth,p+E),R=N+C*w,D=0;D<a.outHeight;++D){for(var F=D*s-v,M=F;M<0;)M+=l;for(var z=Math.min(a.inHeight,f+F),L=R+D*O,P=0;P<a.outWidth;++P){for(var B=P*u-b,W=B;W<0;)W+=d;for(var U=Math.min(a.inWidth,h+B),V=L+P*I,G=g,H=0,q=0,K=_;K<A;K+=c){for(var X=j+K*r[1],Y=M;Y<z;Y+=l){for(var Z=X+Y*r[2],J=W;J<U;J+=d){var Q=e[Z+J*r[3]+T];if("max"===i&&Q>G?G=Q:"avg"===i&&(H+=Q,q++),isNaN(G))break}if(isNaN(G))break}if(isNaN(G))break}x[V+T]="avg"===i?H/Math.max(q,1):G}}}return y}var SR={kernelName:Nt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;cE(a,"avgPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode;Ga.assert(Wm.eitherStridesOrDilationsAreOne(o,1),(function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides ".concat(o," and dilations '").concat(1,"'")}));var c,l=Wm.computePool2DInfo(a.shape,i,o,1,s,u);if(1===l.filterWidth&&1===l.filterHeight&&Ga.arraysEqual(l.inShape,l.outShape))c=yE({inputs:{x:a},backend:n});else{var d=n.data.get(a.dataId).values,p=Ga.computeStrides(a.shape),f=wR(d,a.shape,a.dtype,p,l,"avg");c=n.makeTensorInfo(l.outShape,a.dtype,f.values)}return c}};var NR={kernelName:Tt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=r.dataFormat;cE(a,"avgPool3d");var l=Wm.computePool3DInfo(a.shape,i,o,1,s,u,c),d=IR(n.data.get(a.dataId).values,a.shape,a.dtype,Ga.computeStrides(a.shape),l,"avg");return n.makeTensorInfo(d.shape,"float32",d.values)}};var jR={kernelName:Ct,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode;cE([a,i],"avgPool3DGrad");for(var l=Wm.computePool3DInfo(i.shape,o,s,1,u,c),d=l.strideDepth,p=l.strideHeight,f=l.strideWidth,h=l.filterDepth,m=l.filterHeight,v=l.filterWidth,b=l.dilationDepth,g=l.dilationHeight,y=l.dilationWidth,x=l.effectiveFilterDepth,k=l.effectiveFilterHeight,w=l.effectiveFilterWidth,O=x-1-l.padInfo.front,I=w-1-l.padInfo.left,S=k-1-l.padInfo.top,N=Ss(i.shape,"float32"),j=1/(h*m*v),T=n.bufferSync(a),C=0;C<l.batchSize;++C)for(var E=0;E<l.inChannels;++E)for(var _=0;_<l.inDepth;++_)for(var A=0;A<l.inHeight;++A)for(var R=0;R<l.inWidth;++R){for(var D=_-O,F=A-S,M=R-I,z=0,L=0;L<x;L+=b){var P=(D+L)/d;if(!(P<0||P>=l.outDepth||Math.floor(P)!==P))for(var B=0;B<k;B+=g){var W=(F+B)/p;if(!(W<0||W>=l.outHeight||Math.floor(W)!==W))for(var U=0;U<w;U+=y){var V=(M+U)/f;if(!(V<0||V>=l.outWidth||Math.floor(V)!==V))z+=T.get(C,P,W,V,E)}}}N.set(z*j,C,_,A,R,E)}return n.makeTensorInfo(N.shape,N.dtype,N.values)}};var TR={kernelName:jt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;cE([a,i],"avgPoolGrad");for(var s=r.filterSize,u=r.strides,c=r.pad,l=Wm.computePool2DInfo(o.shape,s,u,1,c),d=l.strideHeight,p=l.strideWidth,f=l.filterHeight,h=l.filterWidth,m=l.dilationHeight,v=l.dilationWidth,b=l.effectiveFilterHeight,g=l.effectiveFilterWidth,y=g-1-l.padInfo.left,x=b-1-l.padInfo.top,k=Ss(o.shape,"float32"),w=1/(f*h),O=n.data.get(a.dataId).values,I=Ss(a.shape,"float32",O),S=0;S<l.batchSize;++S)for(var N=0;N<l.inChannels;++N)for(var j=0;j<l.inHeight;++j)for(var T=0;T<l.inWidth;++T){for(var C=j-x,E=T-y,_=0,A=0;A<b;A+=m){var R=(C+A)/d;if(!(R<0||R>=l.outHeight||Math.floor(R)!==R))for(var D=0;D<g;D+=v){var F=(E+D)/p;if(!(F<0||F>=l.outWidth||Math.floor(F)!==F))_+=I.get(S,R,F,N)}}k.set(_*w,S,j,T,N)}return n.makeTensorInfo(k.shape,k.dtype,k.values)}};var CR={kernelName:In,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.scale,o=t.offset,s=t.mean,u=t.variance;Ga.assert(s.shape.length===u.shape.length,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),Ga.assert(null==o||s.shape.length===o.shape.length,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),Ga.assert(null==i||s.shape.length===i.shape.length,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."})),cE([a,s,u,i,o],"batchNorm");var c=r.varianceEpsilon;null==c&&(c=.001);for(var l=n.data.get(a.dataId).values,d=n.data.get(s.dataId).values,p=n.data.get(u.dataId).values,f=i?n.data.get(i.dataId).values:new Float32Array([1]),h=o?n.data.get(o.dataId).values:new Float32Array([0]),m=new Float32Array(l.length),v=h.length,b=f.length,g=p.length,y=d.length,x=0,k=0,w=0,O=0,I=0;I<l.length;++I)m[I]=h[x++]+(l[I]-d[k++])*f[w++]/Math.sqrt(p[O++]+c),x>=v&&(x=0),k>=y&&(k=0),w>=b&&(w=0),O>=g&&(O=0);return n.makeTensorInfo(a.shape,a.dtype,m)}};var ER={kernelName:_t,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.crops;cE([a],"batchToSpaceND");var s=i.reduce((function(e,t){return e*t})),u=Wm.getReshaped(a.shape,i,s),c=Wm.getPermuted(u.length,i.length),l=Wm.getReshapedPermuted(a.shape,i,s),d=Wm.getSliceBeginCoords(o,i.length),p=Wm.getSliceSize(l,o,i.length),f=JA({inputs:{x:a},backend:n,attrs:{shape:u}}),h=B_({inputs:{x:f},backend:n,attrs:{perm:c}}),m=JA({inputs:{x:h},backend:n,attrs:{shape:l}}),v=lA({inputs:{x:m},backend:n,attrs:{begin:d,size:p}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(m),v}};var _R={kernelName:At,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=AE(n.data.get(a.dataId).values,n.data.get(i.dataId).values,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,s)}};var AR={kernelName:Ft,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.s0,a=t.s1,i=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,s=Wm.assertAndGetBroadcastShape(Array.from(i),Array.from(o));return n.makeTensorInfo([s.length],"int32",Int32Array.from(s))}},RR=LE(Lt,(function(e,t){var n=t;return e>n.clipValueMax?n.clipValueMax:e<n.clipValueMin?n.clipValueMin:e})),DR={kernelName:Lt,backendName:"cpu",kernelFunc:RR},FR={kernelName:Bt,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs.x,n=e.backend,r=new Float32Array(Ga.sizeFromShape(t.shape)),a=n.data.get(t.dataId),i=a.complexTensorInfos.real,o=a.complexTensorInfos.imag,s=n.data.get(i.dataId).values,u=n.data.get(o.dataId).values,c=0;c<s.length;c++){var l=s[c],d=u[c];r[c]=Math.hypot(l,d)}return n.makeOutput(r,t.shape,"float32")}};function MR(e){var t=e.inputs,n=e.backend,r=t.input,a=n.data.get(r.dataId).complexTensorInfos.imag,i=n.data.get(a.dataId).values;return n.makeTensorInfo(a.shape,a.dtype,i)}var zR={kernelName:_n,backendName:"cpu",kernelFunc:MR};function LR(e){var t=e.inputs,n=e.backend,r=e.attrs.axis,a=Ga.parseAxisParam(r,t[0].shape)[0],i=t.map((function(e){return e.shape}));Wm.assertParamsConsistent(i,a);var o=Wm.computeOutShape(t.map((function(e){return e.shape})),a);if(0===Ga.sizeFromShape(o))return n.makeTensorInfo(o,t[0].dtype,[]);var s=t.filter((function(e){return Ga.sizeFromShape(e.shape)>0}));if(1===s.length)return yE({inputs:{x:s[0]},backend:n});if("complex64"===s[0].dtype){var u=s.map((function(e){return kE({inputs:{input:e},backend:n})})),c=s.map((function(e){return MR({inputs:{input:e},backend:n})})),l=LR({inputs:u,backend:n,attrs:{axis:a}}),d=LR({inputs:c,backend:n,attrs:{axis:a}}),p=vE({inputs:{real:l,imag:d},backend:n});return u.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),c.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(d),p}var f=s.map((function(e){var t=[-1,Ga.sizeFromShape(e.shape.slice(a))];return JA({inputs:{x:e},backend:n,attrs:{shape:t}})})),h=f.map((function(e){return{vals:n.data.get(e.dataId).values,shape:e.shape}}));o=Wm.computeOutShape(f.map((function(e){return e.shape})),1);var m=1===f[0].shape[0],v=VE(h,o,t[0].dtype,m),b=Wm.computeOutShape(s.map((function(e){return e.shape})),a),g=n.makeTensorInfo(b,t[0].dtype,v);return f.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),g}var PR={kernelName:Wt,backendName:"cpu",kernelFunc:LR};function BR(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dilations,l=r.dimRoundingMode;cE([a,i],"conv2d");for(var d=Wm.convertConv2DDataFormat(u),p=Wm.computeConv2DInfo(a.shape,i.shape,o,c,s,l,!1,d),f=p.filterHeight,h=p.filterWidth,m=p.dilationHeight,v=p.dilationWidth,b=p.padInfo.left,g=p.padInfo.top,y="channelsLast"===p.dataFormat,x=new Si(p.outShape,a.dtype),k=Ga.computeStrides(a.shape),w=Ga.computeStrides(i.shape),O=k[0],I=y?k[1]:k[2],S=y?k[2]:1,N=y?1:k[1],j=x.strides[0],T=y?x.strides[1]:x.strides[2],C=y?x.strides[2]:1,E=y?1:x.strides[1],_=n.data.get(a.dataId).values,A=n.data.get(i.dataId).values,R=x.values,D=0;D<p.batchSize;++D)for(var F=D*O,M=D*j,z=0;z<p.outHeight;++z)for(var L=M+z*T,P=z*p.strideHeight-g,B=0;B<f;++B){var W=P+B*m;if(!(W<0||W>=p.inHeight))for(var U=B*w[0],V=F+W*I,G=0;G<p.outWidth;++G)for(var H=L+G*C,q=G*p.strideWidth-b,K=0;K<h;++K){var X=q+K*v;if(!(X<0||X>=p.inWidth))for(var Y=V+X*S,Z=U+K*w[1],J=0;J<p.inChannels;++J){for(var Q=_[Y+J*N],$=0;$<p.outChannels;++$)R[H+$*E]+=Q*A[Z+$];Z+=p.outChannels}}}return n.makeTensorInfo(x.shape,x.dtype,R)}var WR={kernelName:Ut,backendName:"cpu",kernelFunc:BR};var UR={kernelName:Vt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dimRoundingMode,l=r.filterShape;cE([a,i],"conv2dBackpropFilter");for(var d=Wm.convertConv2DDataFormat(u),p=Wm.computeConv2DInfo(a.shape,l,o,1,s,c,!1,d),f=p.strideHeight,h=p.strideWidth,m=p.filterHeight,v=p.filterWidth,b="channelsLast"===p.dataFormat,g=new Si(p.filterShape,"float32"),y=p.padInfo.left,x=p.padInfo.top,k=n.data.get(a.dataId).values,w=n.data.get(i.dataId).values,O=new Si(a.shape,a.dtype,k),I=new Si(i.shape,i.dtype,w),S=0;S<m;++S)for(var N=Math.max(0,Math.ceil((x-S)/f)),j=Math.min(p.outHeight,(p.inHeight+x-S)/f),T=0;T<v;++T)for(var C=Math.max(0,Math.ceil((y-T)/h)),E=Math.min(p.outWidth,(p.inWidth+y-T)/h),_=0;_<p.inChannels;++_)for(var A=0;A<p.outChannels;++A){for(var R=0,D=0;D<p.batchSize;++D)for(var F=N;F<j;++F)for(var M=S+F*f-x,z=C;z<E;++z){var L=T+z*h-y;R+=b?O.get(D,M,L,_)*I.get(D,F,z,A):O.get(D,_,M,L)*I.get(D,A,F,z)}g.set(R,S,T,_,A)}return n.makeTensorInfo(g.shape,g.dtype,g.values)}};var VR={kernelName:Gt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.inputShape,s=r.strides,u=r.pad,c=r.dataFormat,l=r.dimRoundingMode;cE([a,i],"conv2dBackpropInput");var d=Ga.computeStrides(i.shape),p=Ga.computeStrides(a.shape),f=Wm.convertConv2DDataFormat(c),h=Wm.computeConv2DInfo(o,i.shape,s,1,u,l,!1,f),m=new Si(h.inShape,"float32"),v=m.values,b=n.data.get(a.dataId).values,g=n.data.get(i.dataId).values,x=Object(y.a)(d,3),k=x[0],w=x[1],O=x[2],I=h.batchSize,S=h.filterHeight,N=h.filterWidth,j=h.inChannels,T=h.inHeight,C=h.inWidth,E=h.outChannels,_=h.outHeight,A=h.outWidth,R=h.strideHeight,D=h.strideWidth;f=h.dataFormat;for(var F=S-1-h.padInfo.top,M=N-1-h.padInfo.left,z="channelsLast"===f,L=m.strides[0],P=z?m.strides[1]:m.strides[2],B=z?m.strides[2]:1,W=z?1:m.strides[1],U=p[0],V=z?p[1]:p[2],G=z?p[2]:1,H=z?1:p[1],q=0;q<I;++q)for(var K=0;K<j;++K)for(var X=0;X<T;++X)for(var Y=X-F,Z=Math.max(0,Math.ceil(Y/R)),J=Math.min(_,(S+Y)/R),Q=0;Q<C;++Q){for(var $=Q-M,ee=Math.max(0,Math.ceil($/D)),te=Math.min(A,(N+$)/D),ne=0,re=Z;re<J;++re)for(var ae=re*R-Y,ie=ee;ie<te;++ie)for(var oe=U*q+V*re+G*ie,se=k*(S-1-ae)+w*(N-1-(ie*D-$))+O*K,ue=0;ue<E;++ue){ne+=b[oe+H*ue]*g[se+ue]}v[L*q+P*X+B*Q+W*K]=ne}return n.makeTensorInfo(m.shape,m.dtype,m.values)}};var GR={kernelName:Ht,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations;cE([a,i],"conv3d");for(var c=Wm.computeConv3DInfo(a.shape,i.shape,o,u,s),l=c.filterDepth,d=c.filterHeight,p=c.filterWidth,f=c.dilationDepth,h=c.dilationHeight,m=c.dilationWidth,v=c.padInfo,b=v.front,g=v.left,y=v.top,x=new Si(c.outShape,a.dtype),k=n.data.get(a.dataId).values,w=n.data.get(i.dataId).values,O=x.values,I=Ga.computeStrides(a.shape),S=Ga.computeStrides(i.shape),N=0;N<c.batchSize;++N)for(var j=N*I[0],T=N*x.strides[0],C=0;C<c.outDepth;++C)for(var E=T+C*x.strides[1],_=C*c.strideDepth-b,A=0;A<l;++A){var R=_+A*f;if(!(R<0||R>=c.inDepth))for(var D=A*S[0],F=j+R*I[1],M=0;M<c.outHeight;++M)for(var z=E+M*x.strides[2],L=M*c.strideHeight-y,P=0;P<d;++P){var B=L+P*h;if(!(B<0||B>=c.inHeight))for(var W=D+P*S[1],U=F+B*I[2],V=0;V<c.outWidth;++V)for(var G=z+V*c.outChannels,H=V*c.strideWidth-g,q=0;q<p;++q){var K=H+q*m;if(!(K<0||K>=c.inWidth))for(var X=W+q*S[2],Y=U+K*c.inChannels,Z=X,J=0;J<c.inChannels;++J){for(var Q=k[Y+J],$=0;$<c.outChannels;++$)O[G+$]+=Q*w[Z+$];Z+=c.outChannels}}}}return n.makeTensorInfo(x.shape,x.dtype,x.values)}};var HR={kernelName:qt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.pad,u=r.filterShape;cE([a,i],"conv3dBackpropFilterV2");for(var c=Ga.computeStrides(a.shape),l=Ga.computeStrides(i.shape),d=Wm.computeConv3DInfo(a.shape,u,o,1,s),p=d.strideDepth,f=d.strideHeight,h=d.strideWidth,m=d.filterDepth,v=d.filterHeight,b=d.filterWidth,g=new Si(d.filterShape,"float32"),x=g.values,k=Object(y.a)(g.strides,4),w=k[0],O=k[1],I=k[2],S=k[3],N=n.data.get(i.dataId).values,j=Object(y.a)(l,4),T=j[0],C=j[1],E=j[2],_=j[3],A=n.data.get(a.dataId).values,R=Object(y.a)(c,4),D=R[0],F=R[1],M=R[2],z=R[3],L=d.padInfo.front,P=d.padInfo.left,B=d.padInfo.top,W=0;W<m;++W)for(var U=Math.max(0,Math.ceil((L-W)/p)),V=Math.min(d.outDepth,(d.inDepth+L-W)/p),G=W*w,H=0;H<v;++H)for(var q=Math.max(0,Math.ceil((B-H)/f)),K=Math.min(d.outHeight,(d.inHeight+B-H)/f),X=H*O+G,Y=0;Y<b;++Y)for(var Z=Math.max(0,Math.ceil((P-Y)/h)),J=Math.min(d.outWidth,(d.inWidth+P-Y)/h),Q=Y*I+X,$=0;$<d.inChannels;++$)for(var ee=$*S+Q,te=0;te<d.outChannels;++te){for(var ne=0,re=0;re<d.batchSize;++re)for(var ae=re*D,ie=re*T,oe=U;oe<V;++oe)for(var se=(W+oe*p-L)*F+ae,ue=oe*C+ie,ce=q;ce<K;++ce)for(var le=(H+ce*f-B)*M+se,de=ce*E+ue,pe=Z;pe<J;++pe){var fe=pe*_+de;ne+=A[(Y+pe*h-P)*z+le+$]*N[fe+te]}x[ee+te]=ne}return n.makeTensorInfo(g.shape,g.dtype,g.values)}};var qR={kernelName:Kt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.pad,s=r.strides,u=r.inputShape;cE([a],"conv3dBackpropInputV2");for(var c=Ga.computeStrides(a.shape),l=Ga.computeStrides(i.shape),d=Wm.computeConv3DInfo(u,i.shape,s,1,o),p=new Si(d.inShape,"float32"),f=p.values,h=Object(y.a)(p.strides,4),m=h[0],v=h[1],b=h[2],g=h[3],x=n.data.get(a.dataId).values,k=Object(y.a)(c,4),w=k[0],O=k[1],I=k[2],S=k[3],N=n.data.get(i.dataId).values,j=Object(y.a)(l,4),T=j[0],C=j[1],E=j[2],_=j[3],A=d.batchSize,R=d.filterDepth,D=d.filterHeight,F=d.filterWidth,M=d.inChannels,z=d.inDepth,L=d.inHeight,P=d.inWidth,B=d.outChannels,W=d.outDepth,U=d.outHeight,V=d.outWidth,G=d.strideDepth,H=d.strideHeight,q=d.strideWidth,K=R-1-d.padInfo.front,X=D-1-d.padInfo.top,Y=F-1-d.padInfo.left,Z=0;Z<A;++Z)for(var J=0;J<M;++J)for(var Q=0;Q<z;++Q)for(var $=Q-K,ee=Math.max(0,Math.ceil($/G)),te=Math.min(W,(R+$)/G),ne=0;ne<L;++ne)for(var re=ne-X,ae=Math.max(0,Math.ceil(re/H)),ie=Math.min(U,(D+re)/H),oe=0;oe<P;++oe){for(var se=oe-Y,ue=Math.max(0,Math.ceil(se/q)),ce=Math.min(V,(F+se)/q),le=0,de=ee;de<te;++de)for(var pe=de*G-$,fe=ae;fe<ie;++fe)for(var he=fe*H-re,me=ue;me<ce;++me)for(var ve=w*Z+O*de+I*fe+S*me,be=T*(R-1-pe)+C*(D-1-he)+E*(F-1-(me*q-se))+_*J,ge=0;ge<B;++ge){le+=x[ve+ge]*N[be+ge]}f[m*Z+v*Q+b*ne+g*oe+J]=le}return n.makeTensorInfo(p.shape,p.dtype,p.values)}},KR=LE(Xt,(function(e){return Math.cos(e)})),XR={kernelName:Xt,backendName:"cpu",kernelFunc:KR},YR=LE(Yt,(function(e){return Math.cosh(e)})),ZR={kernelName:Yt,backendName:"cpu",kernelFunc:YR};var JR={kernelName:Qt,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.backend,r=e.attrs,a=t.image,i=t.boxes,o=t.boxInd,s=r.cropSize,u=r.method,c=r.extrapolationValue,l=Object(y.a)(a.shape,4),d=l[0],p=l[1],f=l[2],h=l[3],m=i.shape[0],v=Object(y.a)(s,2),b=v[0],g=v[1],x=Ss([m,b,g,h],"float32"),k=n.data.get(i.dataId).values,w=n.data.get(o.dataId).values,O=n.data.get(a.dataId).values,I=Ga.computeStrides(a.shape),S=Ga.computeStrides(x.shape),N=0;N<m;N++){var j=4*N,T=k[j],C=k[j+1],E=k[j+2],_=k[j+3],A=w[N];if(!(A>=d))for(var R=b>1?(E-T)*(p-1)/(b-1):0,D=g>1?(_-C)*(f-1)/(g-1):0,F=0;F<b;F++){var M=b>1?T*(p-1)+F*R:.5*(T+E)*(p-1);if(M<0||M>p-1)for(var z=0;z<g;z++)for(var L=0;L<h;L++){var P=L+z*S[2]+F*S[1]+N*S[0];x.values[P]=c}else if("bilinear"===u)for(var B=Math.floor(M),W=Math.ceil(M),U=M-B,V=0;V<g;V++){var G=g>1?C*(f-1)+V*D:.5*(C+_)*(f-1);if(G<0||G>f-1)for(var H=0;H<h;H++){var q=H+V*S[2]+F*S[1]+N*S[0];x.values[q]=c}else for(var K=Math.floor(G),X=Math.ceil(G),Y=G-K,Z=0;Z<h;Z++){var J=Z+K*I[2]+B*I[1]+A*I[0],Q=O[J],$=O[J=Z+X*I[2]+B*I[1]+A*I[0]],ee=O[J=Z+K*I[2]+W*I[1]+A*I[0]],te=Q+($-Q)*Y,ne=ee+(O[J=Z+X*I[2]+W*I[1]+A*I[0]]-ee)*Y;J=Z+V*S[2]+F*S[1]+N*S[0],x.values[J]=te+(ne-te)*U}}else for(var re=0;re<g;++re){var ae=g>1?C*(f-1)+re*D:.5*(C+_)*(f-1);if(ae<0||ae>f-1)for(var ie=0;ie<h;ie++){var oe=ie+re*S[2]+F*S[1]+N*S[0];x.values[oe]=c}else for(var se=Math.round(ae),ue=Math.round(M),ce=0;ce<h;ce++){var le=ce+se*I[2]+ue*I[1]+A*I[0],de=ce+re*S[2]+F*S[1]+N*S[0];x.values[de]=O[le]}}}}return n.makeTensorInfo(x.shape,x.dtype,x.values)}};var QR={kernelName:Zt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse;cE(a,"cumprod");var u=Wm.getAxesPermutation([i],a.shape.length),c=a;null!=u&&(c=B_({inputs:{x:a},backend:n,attrs:{perm:u}}));var l=Wm.getInnerMostAxes(1,a.shape.length)[0];if(l!==c.shape.length-1)throw new Error("backend.cumprod in CPU expects an inner-most axis=".concat(c.shape.length-1," but got axis=").concat(l));for(var d=Li(c.dtype,"int32"),p=Ga.makeOnesTypedArray(Ga.sizeFromShape(c.shape),d),f=n.data.get(c.dataId).values,h=c.shape[c.shape.length-1],m=s?function(e,t){return e+h-t-1}:function(e,t){return e+t},v=0;v<f.length;v+=h)for(var b=0;b<h;b++){var g=m(v,b);if(0===b)p[g]=o?1:f[g];else{var y=m(v,b-1);p[g]=o?f[y]*p[y]:f[g]*p[y]}}var x=n.makeTensorInfo(c.shape,d,p);if(null!=u){var k=B_({inputs:{x:x},backend:n,attrs:{perm:Wm.getUndoAxesPermutation(u)}});return n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(c),k}return x}};var $R={kernelName:Jt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse;cE(a,"cumsum");var u=Wm.getAxesPermutation([i],a.shape.length),c=a;null!=u&&(c=B_({inputs:{x:a},backend:n,attrs:{perm:u}}));var l=Wm.getInnerMostAxes(1,a.shape.length)[0];if(l!==c.shape.length-1)throw new Error("backend.cumsum in CPU expects an inner-most axis=".concat(c.shape.length-1," but got axis=").concat(l));for(var d=Li(c.dtype,"int32"),p=Ga.makeZerosTypedArray(Ga.sizeFromShape(c.shape),d),f=n.data.get(c.dataId).values,h=c.shape[c.shape.length-1],m=s?function(e,t){return e+h-t-1}:function(e,t){return e+t},v=0;v<f.length;v+=h)for(var b=0;b<h;b++){var g=m(v,b);if(0===b)p[g]=o?0:f[g];else{var y=m(v,b-1);p[g]=o?f[y]+p[y]:f[g]+p[y]}}var x=n.makeTensorInfo(c.shape,d,p);if(null!=u){var k=B_({inputs:{x:x},backend:n,attrs:{perm:Wm.getUndoAxesPermutation(u)}});return n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(c),k}return x}};var eD={kernelName:$t,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=r.binaryOutput;if(1===a.shape.length){var u=AE(n.data.get(a.dataId).values,n.data.get(i.dataId).values,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,u)}if(2===a.shape.length){var c=RE(n.bufferSync(a),n.bufferSync(i),o,s);return n.makeTensorInfo(c.shape,i.dtype,c.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank".concat(a.shape.length,"."))}};var tD={kernelName:en,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockSize,o=r.dataFormat;Ga.assert("NHWC"===o,(function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got ".concat(o)}));for(var s=a.shape[0],u=a.shape[1],c=a.shape[2],l=a.shape[3],d=u*i,p=c*i,f=l/(i*i),h=n.data.get(a.dataId).values,m=new Float32Array(s*d*p*f),v=0,b=0;b<s;++b)for(var g=0;g<d;++g)for(var y=Math.floor(g/i),x=g%i,k=0;k<p;++k)for(var w=Math.floor(k/i),O=(x*i+k%i)*f,I=0;I<f;++I){var S=I+O+l*(w+c*(y+u*b));m[v++]=h[S]}return n.makeTensorInfo([s,d,p,f],a.dtype,m)}};function nD(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations,c=r.dimRoundingMode;cE([a,i],"depthwiseConv2DNative");var l=Ga.computeStrides(a.shape),d=Ga.computeStrides(i.shape),p=u;null==p&&(p=[1,1]),Ga.assert(Wm.eitherStridesOrDilationsAreOne(o,p),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ".concat(o," and dilations '").concat(p,"'")}));for(var f=Wm.computeConv2DInfo(a.shape,i.shape,o,p,s,c,!0),h=f.filterHeight,m=f.filterWidth,v=f.dilationHeight,b=f.dilationWidth,g=f.padInfo,y=g.left,x=g.top,k=f.outChannels/f.inChannels,w=new Si(f.outShape,a.dtype),O=n.data.get(a.dataId).values,I=n.data.get(i.dataId).values,S=w.values,N=0;N<f.batchSize;++N)for(var j=N*l[0],T=N*w.strides[0],C=0;C<f.outHeight;++C)for(var E=T+C*w.strides[1],_=C*f.strideHeight-x,A=0;A<h;++A){var R=_+A*v;if(!(R<0||R>=f.inHeight))for(var D=A*d[0],F=j+R*l[1],M=0;M<f.outWidth;++M)for(var z=E+M*w.strides[2],L=M*f.strideWidth-y,P=0;P<m;++P){var B=L+P*b;if(!(B<0||B>=f.inWidth))for(var W=D+P*d[1],U=F+B*f.inChannels,V=z,G=W,H=0;H<f.inChannels;++H){for(var q=O[U+H],K=0;K<k;++K)S[V+K]+=q*I[G+K];V+=k,G+=k}}}return n.makeTensorInfo(w.shape,w.dtype,w.values)}var rD={kernelName:tn,backendName:"cpu",kernelFunc:nD};var aD={kernelName:nn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,l=r.filterShape;cE([a,i],"depthwiseConv2dNativeBackpropFilter");for(var d=Wm.computeConv2DInfo(a.shape,l,o,s,u,c,!0),p=d.strideHeight,f=d.strideWidth,h=d.filterHeight,m=d.filterWidth,v=new Si(d.filterShape,"float32"),b=d.padInfo.left,g=d.padInfo.top,y=d.outChannels/d.inChannels,x=n.data.get(a.dataId).values,k=new Si(a.shape,a.dtype,x),w=n.data.get(i.dataId).values,O=new Si(i.shape,i.dtype,w),I=0;I<h;++I)for(var S=Math.max(0,Math.ceil((g-I)/p)),N=Math.min(d.outHeight,(d.inHeight+g-I)/p),j=0;j<m;++j)for(var T=Math.max(0,Math.ceil((b-j)/f)),C=Math.min(d.outWidth,(d.inWidth+b-j)/f),E=0;E<d.outChannels;++E){for(var _=Math.trunc(E/y),A=E%y,R=0,D=0;D<d.batchSize;++D)for(var F=S;F<N;++F)for(var M=I+F*p-g,z=T;z<C;++z){var L=j+z*f-b;R+=k.get(D,M,L,_)*O.get(D,F,z,E)}v.set(R,I,j,_,A)}return n.makeTensorInfo(v.shape,v.dtype,v.values)}};var iD={kernelName:rn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,l=r.inputShape;cE([a,i],"depthwiseConv2DNativeBackpropInput");for(var d=Ga.computeStrides(a.shape),p=Ga.computeStrides(i.shape),f=Wm.computeConv2DInfo(l,i.shape,o,s,u,c,!0),h=new Si(f.inShape,"float32"),m=h.values,v=Object(y.a)(h.strides,3),b=v[0],g=v[1],x=v[2],k=n.data.get(a.dataId).values,w=Object(y.a)(d,3),O=w[0],I=w[1],S=w[2],N=n.data.get(i.dataId).values,j=Object(y.a)(p,3),T=j[0],C=j[1],E=j[2],_=f.batchSize,A=f.filterHeight,R=f.filterWidth,D=f.inChannels,F=f.inHeight,M=f.inWidth,z=f.outChannels,L=f.outHeight,P=f.outWidth,B=f.strideHeight,W=f.strideWidth,U=A-1-f.padInfo.top,V=R-1-f.padInfo.left,G=z/D,H=0;H<_;++H)for(var q=0;q<D;++q)for(var K=0;K<F;++K)for(var X=K-U,Y=Math.max(0,Math.ceil(X/B)),Z=Math.min(L,(A+X)/B),J=0;J<M;++J){for(var Q=J-V,$=Math.max(0,Math.ceil(Q/W)),ee=Math.min(P,(R+Q)/W),te=0,ne=Y;ne<Z;++ne)for(var re=ne*B-X,ae=$;ae<ee;++ae)for(var ie=O*H+I*ne+S*ae,oe=T*(A-1-re)+C*(R-1-(ae*W-Q))+E*q,se=0;se<G;++se){te+=k[ie+(q*G+se)]*N[oe+se]}m[b*H+g*K+x*J+q]=te}return n.makeTensorInfo(h.shape,h.dtype,h.values)}};var oD={kernelName:an,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.backend,r=t.x,a=Ga.sizeFromShape(r.shape),i=n.data.get(r.dataId).values,o=Ss([a,a],r.dtype),s=o.values,u=0;u<i.length;u++)s[u*a+u]=i[u];var c=[].concat(Object(S.a)(r.shape),Object(S.a)(r.shape));return n.makeTensorInfo(c,o.dtype,o.values)}},sD={kernelName:on,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations,c=n,l=c.data.get(a.dataId).values,d=a.shape.length,p=c.data.get(i.dataId).values,f=i.shape.length,h=Wm.computeDilation2DInfo(a.shape,i.shape,o,s,"NHWC",u),m=h.batchSize,v=h.inHeight,b=h.inWidth,g=h.inChannels,y=h.outHeight,x=h.outWidth,k=h.padInfo,w=h.strideHeight,O=h.strideWidth,I=h.filterHeight,S=h.filterWidth,N=h.dilationHeight,j=h.dilationWidth,T=h.outShape,C=Ga.sizeFromShape(T),E=T.length,_=Ga.getArrayFromDType(a.dtype,C),A=0;A<m;++A)for(var R=0;R<y;++R)for(var D=R*w-k.top,F=0;F<x;++F)for(var M=F*O-k.left,z=0;z<g;++z){for(var L=Number.MIN_SAFE_INTEGER,P=0;P<I;++P){var B=D+P*N;if(B>=0&&B<v)for(var W=0;W<S;++W){var U=M+W*j;if(U>=0&&U<b){var V=Ga.locToIndex([A,B,U,z],d,Ga.computeStrides(a.shape)),G=Ga.locToIndex([P,W,z],f,Ga.computeStrides(i.shape)),H=l[V]+p[G];H>L&&(L=H)}}}_[Ga.locToIndex([A,R,F,z],E,Ga.computeStrides(T))]=L}return{dataId:c.write(Ga.toTypedArray(_,a.dtype),T,a.dtype),shape:T,dtype:a.dtype}}},uD={kernelName:un,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.dy,s=r.strides,u=r.pad,c=r.dilations,l=n,d=Ga.toNestedArray(a.shape,l.data.get(a.dataId).values),p=Ga.toNestedArray(i.shape,l.data.get(i.dataId).values),f=Wm.computeDilation2DInfo(a.shape,i.shape,s,u,"NHWC",c),h=f.batchSize,m=f.inHeight,v=f.inWidth,b=f.inChannels,g=f.outHeight,y=f.outWidth,x=f.padInfo,k=f.strideHeight,w=f.strideWidth,O=f.filterHeight,I=f.filterWidth,S=f.dilationHeight,N=f.dilationWidth,j=f.outShape;Ga.assert(o.rank===j.length,(function(){return"Error in ".concat(un,", dy must have the same rank as output ").concat(j.length,", but got ").concat(o.rank)}));for(var T=Ga.toNestedArray(j,l.data.get(o.dataId).values),C=Ga.makeZerosNestedTypedArray(i.shape,i.dtype),E=0;E<h;++E)for(var _=0;_<g;++_)for(var A=_*k-x.top,R=0;R<y;++R)for(var D=R*w-x.left,F=0;F<b;++F){for(var M=Number.MIN_SAFE_INTEGER,z=0,L=0,P=0;P<O;++P){var B=A+P*S;if(B>=0&&B<m)for(var W=0;W<I;++W){var U=D+W*N;if(U>=0&&U<v){var V=d[E][B][U][F]+p[P][W][F];V>M&&(M=V,z=P,L=W)}}}C[z][L][F]+=T[E][_][R][F]}return{dataId:l.write(Ga.toTypedArray(C,a.dtype),i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}},cD={kernelName:sn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.dy,s=r.strides,u=r.pad,c=r.dilations,l=n,d=Ga.toNestedArray(a.shape,l.data.get(a.dataId).values),p=Ga.toNestedArray(i.shape,l.data.get(i.dataId).values),f=Wm.computeDilation2DInfo(a.shape,i.shape,s,u,"NHWC",c),h=f.batchSize,m=f.inHeight,v=f.inWidth,b=f.inChannels,g=f.outHeight,y=f.outWidth,x=f.padInfo,k=f.strideHeight,w=f.strideWidth,O=f.filterHeight,I=f.filterWidth,S=f.dilationHeight,N=f.dilationWidth,j=f.outShape;Ga.assert(o.rank===j.length,(function(){return"Error in ".concat(sn,", dy must have the same rank as output ").concat(j.length,", but got ").concat(o.rank)}));for(var T=Ga.toNestedArray(j,l.data.get(o.dataId).values),C=Ga.makeZerosNestedTypedArray(a.shape,a.dtype),E=0;E<h;++E)for(var _=0;_<g;++_)for(var A=_*k-x.top,R=0;R<y;++R)for(var D=R*w-x.left,F=0;F<b;++F){for(var M=Number.MIN_SAFE_INTEGER,z=A<0?0:A,L=D<0?0:D,P=0;P<O;++P){var B=A+P*S;if(B>=0&&B<m)for(var W=0;W<I;++W){var U=D+W*N;if(U>=0&&U<v){var V=d[E][B][U][F]+p[P][W][F];V>M&&(M=V,z=B,L=U)}}}C[E][z][L][F]+=T[E][_][R][F]}return{dataId:l.write(Ga.toTypedArray(C,a.dtype),a.shape,a.dtype),shape:a.shape,dtype:a.dtype}}};var lD={kernelName:cn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.image,i=r.canvas,o=r.options||{},s=o.contextOptions,u=o.imageOptions,c=(null==u?void 0:u.alpha)||1,l=(null==s?void 0:s.contextType)||"2d";if("2d"!==l)throw new Error("Context type ".concat(s.contextType," is not supported by the CPU backend."));var d=i.getContext(l,(null==s?void 0:s.contextAttributes)||{});if(null==d)throw new Error("Could not get the context with ".concat(l," type."));for(var p=a.shape.slice(0,2),f=Object(y.a)(p,2),h=f[0],m=f[1],v=2===a.shape.length?1:a.shape[2],b=n.data.get(a.dataId).values,g="float32"===a.dtype?255:1,x=new Uint8ClampedArray(m*h*4),k=0;k<h*m;++k){for(var w=[0,0,0,255*c],O=0;O<v;O++){var I=b[k*v+O];if("float32"===a.dtype){if(I<0||I>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ".concat(I,"."))}else if("int32"===a.dtype&&(I<0||I>255))throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ".concat(I,"."));1===v?(w[0]=I*g,w[1]=I*g,w[2]=I*g):w[O]=I*g}var S=4*k;x[S+0]=Math.round(w[0]),x[S+1]=Math.round(w[1]),x[S+2]=Math.round(w[2]),x[S+3]=Math.round(w[3])}i.width=m,i.height=h;var N=new ImageData(x,m,h);return d.putImageData(N,0,0),a}};function dD(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.axis,s=a.keepDims;cE(i,"sum");var u=(t="bool"===i.dtype?IE({inputs:{x:i},backend:r,attrs:{dtype:"int32"}}):yE({inputs:{x:i},backend:r})).shape.length,c=Ga.parseAxisParam(o,t.shape),l=Wm.getAxesPermutation(c,u),d=c,p=t;null!=l&&(p=B_({inputs:{x:t},backend:r,attrs:{perm:l}}),d=Wm.getInnerMostAxes(d.length,u)),Wm.assertAxesAreInnerMostDims("sum",d,p.shape.length);for(var f=Wm.computeOutAndReduceShapes(p.shape,d),h=Object(y.a)(f,2),m=h[0],v=h[1],b=gE(r,m,Wm.upcastType(p.dtype,"int32")),g=Ga.sizeFromShape(v),x=r.data.get(b.dataId).values,k=r.data.get(p.dataId).values,w=0;w<x.length;++w){for(var O=w*g,I=0,S=0;S<g;++S)I+=k[O+S];x[w]=I}if(s){var N=b;b=JA({inputs:{x:b},backend:r,attrs:{shape:Wm.expandShapeToKeepDim(b.shape,c)}}),r.disposeIntermediateTensorInfo(N)}return r.disposeIntermediateTensorInfo(t),null!=l&&r.disposeIntermediateTensorInfo(p),b}var pD={kernelName:Jr,backendName:"cpu",kernelFunc:dD};var fD={kernelName:dn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.equation,a=t,i=Wm.decodeEinsumEquation(r,a.length),o=i.allDims,s=i.summedDims,u=i.idDims;Wm.checkEinsumDimSizes(o.length,u,a);for(var c=Wm.getEinsumComputePath(s,u),l=c.path,d=c.steps,p=d.length,f=null,h=o.length,m=[],v=0;v<p;++v){var b,g=Object(N.a)(d[v]);try{for(g.s();!(b=g.n()).done;){var y=b.value,x=Wm.getEinsumPermutation(h,u[y]),k=x.permutationIndices,w=x.expandDims,O=void 0;Wm.isIdentityPermutation(k)?O=a[y]:(O=B_({inputs:{x:a[y]},backend:n,attrs:{perm:k}}),m.push(O));for(var I=O.shape.slice(),S=0;S<w.length;++S)I.splice(w[S],0,1);Ga.arraysEqual(O.shape,I)||(O=JA({inputs:{x:O},backend:n,attrs:{shape:I}}),m.push(O)),null===f?f=O:(f=A_({inputs:{a:O,b:f},backend:n}),m.push(f))}}catch(E){g.e(E)}finally{g.f()}v<p-1&&(l[v]>=0&&(f=dD({inputs:{x:f},backend:n,attrs:{axis:l[v]-(o.length-h),keepDims:!1}}),m.push(f)),h--)}for(var j=0,T=m;j<T.length;j++){var C=T[j];C!==f&&n.disposeIntermediateTensorInfo(C)}return f}};var hD={kernelName:fn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.dy,a=t.y;cE([r,a],"eluGrad");for(var i=new Float32Array(Ga.sizeFromShape(a.shape)),o=n.data.get(a.dataId).values,s=n.data.get(r.dataId).values,u=0;u<o.length;++u){var c=o[u];i[u]=c>=0?s[u]:s[u]*(c+1)}return n.makeTensorInfo(a.shape,"float32",i)}},mD=Wm.ERF_P,vD=Wm.ERF_A1,bD=Wm.ERF_A2,gD=Wm.ERF_A3,yD=Wm.ERF_A4,xD=Wm.ERF_A5,kD=LE(hn,(function(e){var t=Math.sign(e),n=Math.abs(e),r=1/(1+mD*n);return t*(1-((((xD*r+yD)*r+gD)*r+bD)*r+vD)*r*Math.exp(-n*n))})),wD={kernelName:hn,backendName:"cpu",kernelFunc:kD};function OD(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.input,i=r.dim,o=a.shape.length,s=a.shape.slice(),u=i;return i<0&&(Ga.assert(-(o+1)<=i,(function(){return"Axis must be in the interval [".concat(-(o+1),", ").concat(o,"]")})),u=o+i+1),s.splice(u,0,1),JA({inputs:{x:a},backend:n,attrs:{shape:s}})}var ID={kernelName:bn,backendName:"cpu",kernelFunc:OD},SD=mE((function(e,t){return e/t})),ND=NE(ln,SD),jD={kernelName:ln,backendName:"cpu",kernelFunc:ND};function TD(e,t,n){for(var r=e.shape,a=r[0],i=r[1],o=n.data.get(e.dataId),s=o.complexTensorInfos.real,u=o.complexTensorInfos.imag,c=[a,i],l=Ga.sizeFromShape(c),d=Ga.getTypedArrayFromDType("float32",l),p=Ga.getTypedArrayFromDType("float32",l),f=0;f<a;f++){for(var h=lA({inputs:{x:s},backend:n,attrs:{begin:[f,0],size:[1,i]}}),m=lA({inputs:{x:u},backend:n,attrs:{begin:[f,0],size:[1,i]}}),v=vE({inputs:{real:h,imag:m},backend:n}),b=CD(v,t,n),g=b.real,y=b.imag,x=Wm.mergeRealAndImagArrays(g,y),k=0;k<i;k++){var w=Wm.getComplexWithIndex(x,k);d[f*i+k]=w.real,p[f*i+k]=w.imag}n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(v)}var O=n.makeTensorInfo(c,"float32",d),I=n.makeTensorInfo(c,"float32",p),S=vE({inputs:{real:O,imag:I},backend:n});return n.disposeIntermediateTensorInfo(O),n.disposeIntermediateTensorInfo(I),S}function CD(e,t,n){var r=Ga.sizeFromShape(e.shape),a=n.data.get(e.dataId),i=n.data.get(a.complexTensorInfos.real.dataId).values,o=n.data.get(a.complexTensorInfos.imag.dataId).values;if(function(e){return 0===(e&e-1)}(r)){var s=function e(t,n,r,a,i){if(1===r)return{real:t,imag:n};var o=Wm.mergeRealAndImagArrays(t,n),s=r/2,u=Wm.complexWithEvenIndex(o),c=u.real,l=u.imag,d=[c.length],p=i.makeTensorInfo(d,"float32",c),f=i.makeTensorInfo(d,"float32",l),h=vE({inputs:{real:p,imag:f},backend:i}),m=Wm.complexWithOddIndex(o),v=m.real,b=m.imag,g=[v.length],y=i.makeTensorInfo(g,"float32",v),x=i.makeTensorInfo(g,"float32",b),k=vE({inputs:{real:y,imag:x},backend:i}),w=e(c,l,s,a,i),O=w.real,I=w.imag,S=[O.length],N=i.makeTensorInfo(S,"float32",O),j=i.makeTensorInfo(S,"float32",I),T=vE({inputs:{real:N,imag:j},backend:i}),C=e(v,b,s,a,i),E=C.real,_=C.imag,A=[E.length],R=i.makeTensorInfo(A,"float32",E),D=i.makeTensorInfo(A,"float32",_),F=vE({inputs:{real:R,imag:D},backend:i}),M=Wm.exponents(r,a),z=[M.real.length],L=i.makeTensorInfo(z,"float32",M.real),P=i.makeTensorInfo(z,"float32",M.imag),B=vE({inputs:{real:L,imag:P},backend:i}),W=A_({inputs:{a:B,b:F},backend:i}),U=EE({inputs:{a:T,b:W},backend:i}),V=AA({inputs:{a:T,b:W},backend:i}),G=kE({inputs:{input:U},backend:i}),H=kE({inputs:{input:V},backend:i}),q=MR({inputs:{input:U},backend:i}),K=MR({inputs:{input:V},backend:i}),X=LR({inputs:[G,H],backend:i,attrs:{axis:0}}),Y=LR({inputs:[q,K],backend:i,attrs:{axis:0}}),Z=i.data.get(X.dataId).values,J=i.data.get(Y.dataId).values;return i.disposeIntermediateTensorInfo(p),i.disposeIntermediateTensorInfo(f),i.disposeIntermediateTensorInfo(h),i.disposeIntermediateTensorInfo(y),i.disposeIntermediateTensorInfo(x),i.disposeIntermediateTensorInfo(k),i.disposeIntermediateTensorInfo(N),i.disposeIntermediateTensorInfo(j),i.disposeIntermediateTensorInfo(T),i.disposeIntermediateTensorInfo(R),i.disposeIntermediateTensorInfo(D),i.disposeIntermediateTensorInfo(F),i.disposeIntermediateTensorInfo(L),i.disposeIntermediateTensorInfo(P),i.disposeIntermediateTensorInfo(B),i.disposeIntermediateTensorInfo(W),i.disposeIntermediateTensorInfo(U),i.disposeIntermediateTensorInfo(V),i.disposeIntermediateTensorInfo(G),i.disposeIntermediateTensorInfo(q),i.disposeIntermediateTensorInfo(H),i.disposeIntermediateTensorInfo(K),i.disposeIntermediateTensorInfo(X),i.disposeIntermediateTensorInfo(Y),{real:Z,imag:J}}(i,o,r,t,n),u=[e.shape[0],e.shape[1]];if(t){var c=n.makeTensorInfo(u,"float32",s.real),l=n.makeTensorInfo(u,"float32",s.imag),d=n.makeTensorInfo([],"float32",Ga.createScalarValue(r,"float32")),p=yE({inputs:{x:d},backend:n}),f=jD.kernelFunc({inputs:{a:c,b:d},backend:n}),h=jD.kernelFunc({inputs:{a:l,b:p},backend:n}),m=n.data.get(f.dataId).values,v=n.data.get(h.dataId).values;return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(h),{real:m,imag:v}}return s}var b=function(e,t,n){for(var r=new Float32Array(2*t),a=0;a<t;a++){for(var i=0,o=0,s=0;s<t;s++){var u=Wm.exponent(a*s,t,n),c=Wm.getComplexWithIndex(e,s);i+=c.real*u.real-c.imag*u.imag,o+=c.real*u.imag+c.imag*u.real}n&&(i/=t,o/=t),Wm.assignToTypedArray(r,i,o,a)}return r}(Wm.mergeRealAndImagArrays(i,o),r,t);return Wm.splitRealAndImagArrays(b)}var ED={kernelName:yn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.input,a=Ga.sizeFromShape(r.shape),i=r.shape[r.shape.length-1],o=JA({inputs:{x:r},backend:n,attrs:{shape:[a/i,i]}}),s=TD(o,!1,n),u=JA({inputs:{x:s},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}};function _D(e){var t=e.backend,n=e.attrs,r=n.shape,a=n.value,i=n.dtype||Ga.inferDtype(a),o=Ga.getArrayFromDType(i,Ga.sizeFromShape(r));return function(e,t,n){e.fill(t)}(o,a),t.makeTensorInfo(r,i,o)}var AD={kernelName:xn,backendName:"cpu",kernelFunc:_D};var RD={kernelName:kn,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=(e.attrs,e.backend),r=t.image,a=n,i=Ga.getTypedArrayFromDType(r.dtype,Ga.sizeFromShape(r.shape)),o=Object(y.a)(r.shape,4),s=o[0],u=o[1],c=o[2],l=o[3],d=a.data.get(r.dataId).values,p=0;p<s;p++)for(var f=p*c*u*l,h=0;h<u;h++)for(var m=h*(c*l),v=0;v<c;v++)for(var b=v*l,g=0;g<l;g++){var x=Math.round(c-v-1),k=f+m+b+g,w=d[k];if(x>=0&&x<c)w=d[f+m+x*l+g];i[k]=w}return{dataId:a.write(i,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};var DD={kernelName:Ca,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.bias,s=t.preluActivationWeights,u=r.strides,c=r.pad,l=r.dataFormat,d=r.dilations,p=r.dimRoundingMode,f=r.activation,h=r.leakyreluAlpha,m=BR({inputs:{x:a,filter:i},backend:n,attrs:{strides:u,pad:c,dataFormat:l,dilations:d,dimRoundingMode:p}});if(o){var v=m;if("NCHW"===l&&1===o.shape.length&&1!==o.shape[0]){var b=JA({inputs:{x:o},backend:n,attrs:{shape:[o.shape[0],1,1]}});m=EE({inputs:{a:m,b:b},backend:n}),n.disposeIntermediateTensorInfo(b)}else m=EE({inputs:{a:m,b:o},backend:n});n.disposeIntermediateTensorInfo(v)}if(f){var g=m;if("NCHW"===l&&"prelu"===f&&1===s.shape.length&&1!==s.shape[0]){var y=JA({inputs:{x:s},backend:n,attrs:{shape:[s.shape[0],1,1]}});m=ZA(n,m,f,y,h),n.disposeIntermediateTensorInfo(y)}else m=ZA(n,m,f,s,h);n.disposeIntermediateTensorInfo(g)}return m}};var FD={kernelName:Ea,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.bias,s=t.preluActivationWeights,u=r.strides,c=r.pad,l=r.dataFormat,d=r.dilations,p=r.dimRoundingMode,f=r.activation,h=r.leakyreluAlpha,m=nD({inputs:{x:a,filter:i},backend:n,attrs:{strides:u,pad:c,dataFormat:l,dilations:d,dimRoundingMode:p}});if(o){var v=m;m=EE({inputs:{a:m,b:o},backend:n}),n.disposeIntermediateTensorInfo(v)}if(f){var b=m;m=ZA(n,m,f,s,h),n.disposeIntermediateTensorInfo(b)}return m}};var MD={kernelName:Nn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.params,a=t.indices,i=Ga.sizeFromShape(r.shape),o=a.shape,s=o[o.length-1],u=Wm.prepareAndValidate(r,a),c=Object(y.a)(u,4),l=c[0],d=c[1],p=c[2],f=c[3];if(0===d)return n.makeTensorInfo(l,r.dtype,[]);var h=i_(n.data.get(a.dataId).values,n.bufferSync(r),r.dtype,d,s,p,f,r.shape,i);return n.makeTensorInfo(l,r.dtype,h.values)}};var zD={kernelName:Sn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.indices,o=r.axis,s=r.batchDims;cE([a,i],"gatherV2");for(var u=Ga.parseAxisParam(o,a.shape)[0],c=n.data.get(i.dataId).values,l=a.shape[u],d=function(e){var t=c[e];Ga.assert(t<=l-1&&t>=0,(function(){return"GatherV2: the index value ".concat(t," is not in [0, ").concat(l-1,"]")}))},p=0;p<c.length;++p)d(p);var f=s;null==s&&(f=0);var h=Ga.sizeFromShape(i.shape),m=Wm.segment_util.collectGatherOpShapeInfo(a,i,u,f),v=JA({inputs:{x:a},backend:n,attrs:{shape:[m.batchSize,m.outerSize,m.dimSize,m.sliceSize]}}),b=JA({inputs:{x:i},backend:n,attrs:{shape:[m.batchSize,h/m.batchSize]}}),g=[m.batchSize,m.outerSize,h/m.batchSize,m.sliceSize],y=n.bufferSync(b),x=o_(n.bufferSync(v),y,g);return n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(b),n.makeTensorInfo(m.outputShape,x.dtype,x.values)}};var LD={kernelName:En,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.input,a=Ga.sizeFromShape(r.shape),i=r.shape[r.shape.length-1],o=JA({inputs:{x:r},backend:n,attrs:{shape:[a/i,i]}}),s=TD(o,!0,n),u=JA({inputs:{x:s},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}},PD=LE(An,(function(e){return Number.isFinite(e)?1:0}),"bool"),BD={kernelName:An,backendName:"cpu",kernelFunc:PD},WD=LE(Rn,(function(e){return Math.abs(e)===1/0?1:0}),"bool"),UD={kernelName:Rn,backendName:"cpu",kernelFunc:WD},VD=LE(Dn,(function(e){return Number.isNaN(e)?1:0}),"bool"),GD={kernelName:Dn,backendName:"cpu",kernelFunc:VD};var HD={kernelName:Ln,backendName:"cpu",kernelFunc:function(e){var t=e.backend,n=e.attrs,r=y_(n.start,n.stop,n.num);return t.makeTensorInfo([r.length],"float32",r)}},qD=LE(Bn,(function(e){return Math.log1p(e)})),KD={kernelName:Bn,backendName:"cpu",kernelFunc:qD},XD=mE((function(e,t){return e&&t})),YD=NE(Wn,XD,null,"bool"),ZD={kernelName:Wn,backendName:"cpu",kernelFunc:YD},JD=LE(Un,(function(e){return e?0:1}),"bool"),QD={kernelName:Un,backendName:"cpu",kernelFunc:JD},$D=mE((function(e,t){return e||t})),eF=NE(Vn,$D,null,"bool"),tF={kernelName:Vn,backendName:"cpu",kernelFunc:eF};var nF={kernelName:Kn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.depthRadius,o=r.bias,s=r.alpha,u=r.beta;cE(a,"LRN");var c=a.shape[3],l=c-1,d=n.data.get(a.dataId).values,p=Ga.sizeFromShape(a.shape),f=new Float32Array(p);function h(e){for(var t=e%c,n=e-t+Math.max(0,t-i),r=e-t+Math.min(t+i,l),a=0;n<=r;n++){var o=d[n];a+=o*o}return a}for(var m=0;m<p;m++){var v=h(m),b=d[m]*Math.pow(o+s*v,-u);f[m]=b}return n.makeTensorInfo(a.shape,a.dtype,f)}};var rF={kernelName:Xn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.y,o=t.dy,s=r.depthRadius,u=r.bias,c=r.alpha,l=r.beta;cE(o,"LRNGrad");for(var d=Ga.sizeFromShape(o.shape),p=o.shape[3],f=n.data.get(o.dataId).values,h=n.data.get(a.dataId).values,m=n.data.get(i.dataId).values,v=new Float32Array(d),b=d,g=0;g<b;g++){for(var y=g%p,x=g-y+Math.max(0,y-s),k=g-y+Math.min(p,y+s+1),w=0,O=x;O<k;O++)w+=Math.pow(h[O],2);w=c*w+u;for(var I=x;I<k;I++){var S=-2*c*l*h[I]*m[g]/w;g===I&&(S+=Math.pow(w,-l)),S*=f[g],v[I]+=S}}return n.makeTensorInfo(o.shape,a.dtype,v)}};function aF(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.reductionIndices,o=r.keepDims,s=n,u=a.shape,c=u.length,l=Ga.parseAxisParam(i,u),d=l,p=Wm.getAxesPermutation(d,c),f=s.data.get(a.dataId).values;if(null!=p){for(var h=new Array(c),m=0;m<h.length;m++)h[m]=u[p[m]];f=P_(f,u,a.dtype,p,h),d=Wm.getInnerMostAxes(d.length,c),u=h}cE(a,"max"),Wm.assertAxesAreInnerMostDims("max",d,c);var v=Wm.computeOutAndReduceShapes(u,d),b=Object(y.a)(v,2),g=b[0],x=b[1],k=O_(f,Ga.sizeFromShape(x),g,a.dtype),w=s.write(k,g,a.dtype),O=g;return o&&(O=Wm.expandShapeToKeepDim(g,l)),{dataId:w,shape:O,dtype:a.dtype}}var iF={kernelName:Zn,backendName:"cpu",kernelFunc:aF};var oF={kernelName:Qn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;cE(a,"maxPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode;Ga.assert(Wm.eitherStridesOrDilationsAreOne(o,1),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides ".concat(o," and dilations '").concat(1,"'")}));var c,l=Wm.computePool2DInfo(a.shape,i,o,1,s,u);if(1===l.filterWidth&&1===l.filterHeight&&Ga.arraysEqual(l.inShape,l.outShape))c=yE({inputs:{x:a},backend:n});else{var d=n.data.get(a.dataId).values,p=Ga.computeStrides(a.shape),f=wR(d,a.shape,a.dtype,p,l,"max");c=n.makeTensorInfo(l.outShape,a.dtype,f.values)}return c}};var sF={kernelName:er,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=r.dataFormat;cE(a,"maxPool3d");var l=Wm.computePool3DInfo(a.shape,i,o,1,s,u,c),d=IR(n.data.get(a.dataId).values,a.shape,a.dtype,Ga.computeStrides(a.shape),l,"max");return n.makeTensorInfo(d.shape,"float32",d.values)}};var uF={kernelName:tr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode;cE([a,i],"maxPool3DGrad");for(var l=Wm.computePool3DInfo(i.shape,o,s,1,u,c),d=function(e,t){for(var n=Ss(t.outShape,"int32"),r=t.strideDepth,a=t.strideHeight,i=t.strideWidth,o=t.dilationDepth,s=t.dilationHeight,u=t.dilationWidth,c=t.effectiveFilterDepth,l=t.effectiveFilterHeight,d=t.effectiveFilterWidth,p=t.padInfo.front,f=t.padInfo.top,h=t.padInfo.left,m=0;m<t.batchSize;++m)for(var v=0;v<t.inChannels;++v)for(var b=0;b<t.outDepth;++b){for(var g=b*r-p,y=g;y<0;)y+=o;for(var x=Math.min(t.inDepth,c+g),k=0;k<t.outHeight;++k){for(var w=k*a-f,O=w;O<0;)O+=s;for(var I=Math.min(t.inHeight,l+w),S=0;S<t.outWidth;++S){for(var N=S*i-h,j=N;j<0;)j+=u;for(var T=Math.min(t.inWidth,d+N),C=Number.NEGATIVE_INFINITY,E=-1,_=y;_<x;_+=o)for(var A=_-g,R=O;R<I;R+=s)for(var D=R-w,F=j;F<T;F+=u){var M=F-N,z=e.get(m,_,R,F,v);z>=C&&(C=z,E=A*l*d+D*l+M)}n.set(E,m,b,k,S,v)}}}return n}(n.bufferSync(i),l),p=l.strideDepth,f=l.strideHeight,h=l.strideWidth,m=l.dilationDepth,v=l.dilationHeight,b=l.dilationWidth,g=l.effectiveFilterDepth,y=l.effectiveFilterHeight,x=l.effectiveFilterWidth,k=g-1-l.padInfo.front,w=x-1-l.padInfo.left,O=y-1-l.padInfo.top,I=Ss(i.shape,"float32"),S=n.bufferSync(a),N=0;N<l.batchSize;++N)for(var j=0;j<l.inChannels;++j)for(var T=0;T<l.inDepth;++T)for(var C=0;C<l.inHeight;++C)for(var E=0;E<l.inWidth;++E){for(var _=T-k,A=C-O,R=E-w,D=0,F=0;F<g;F+=m){var M=(_+F)/p;if(!(M<0||M>=l.outDepth||Math.floor(M)!==M))for(var z=0;z<y;z+=v){var L=(A+z)/f;if(!(L<0||L>=l.outHeight||Math.floor(L)!==L))for(var P=0;P<x;P+=b){var B=(R+P)/h;if(!(B<0||B>=l.outWidth||Math.floor(B)!==B)){var W=g*y*x-1-d.get(N,M,L,B,j)===F*y*x+z*x+P?1:0;if(0!==W)D+=S.get(N,M,L,B,j)*W}}}}I.set(D,N,T,C,E,j)}return n.makeTensorInfo(I.shape,I.dtype,I.values)}};var cF={kernelName:$n,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;cE([i,t.output],"maxPoolGrad");for(var s=r.filterSize,u=r.strides,c=r.pad,l=r.dimRoundingMode,d=Wm.computePool2DInfo(o.shape,s,u,1,c,l),p=n.data.get(o.dataId).values,f=Ss(d.outShape,o.dtype,OR(p,o.shape,o.dtype,d).values),h=d.strideHeight,m=d.strideWidth,v=d.dilationHeight,b=d.dilationWidth,g=d.effectiveFilterHeight,y=d.effectiveFilterWidth,x=y-1-d.padInfo.left,k=g-1-d.padInfo.top,w=Ss(o.shape,"float32"),O=n.data.get(a.dataId).values,I=Ss(a.shape,"float32",O),S=0;S<d.batchSize;++S)for(var N=0;N<d.inChannels;++N)for(var j=0;j<d.inHeight;++j)for(var T=0;T<d.inWidth;++T){for(var C=j-k,E=T-x,_=0,A=0;A<g;A+=v){var R=(C+A)/h;if(!(R<0||R>=d.outHeight||Math.floor(R)!==R))for(var D=0;D<y;D+=b){var F=(E+D)/m;if(!(F<0||F>=d.outWidth||Math.floor(F)!==F)){var M=g*y-1-f.get(S,R,F,N)===A*y+D?1:0;if(0!==M)_+=I.get(S,R,F,N)*M}}}w.set(_,S,j,T,N)}return n.makeTensorInfo(w.shape,w.dtype,w.values)}};var lF={kernelName:nr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.filterSize,o=n.strides,s=n.pad,u=n.includeBatchInIndex,c=r;cE(a,"MaxPoolWithArgmax");var l=c.data.get(a.dataId).values,d=Wm.computePool2DInfo(a.shape,i,o,[1,1],s),p=function(e,t,n,r,a){var i=wR(e,0,n,Ga.computeStrides(t),a,"max"),o=OR(e,t,n,a,!0,r);return[i.values,o.values]}(l,a.shape,a.dtype,u,d),f=Object(y.a)(p,2),h=f[0],m=f[1],v=c.write(h,d.outShape,a.dtype),b=c.write(m,d.outShape,a.dtype);return[{dataId:v,shape:d.outShape,dtype:a.dtype},{dataId:b,shape:d.outShape,dtype:"int32"}]}};var dF={kernelName:rr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims,s=Ga.parseAxisParam(i,a.shape),u=Wm.computeOutAndReduceShapes(a.shape,s)[1],c=Ga.sizeFromShape(u),l=[],d=n.makeTensorInfo([],"float32",new Float32Array([c]));l.push(d);var p=IE({inputs:{x:a},backend:n,attrs:{dtype:"float32"}});l.push(p);var f=ND({inputs:{a:p,b:d},backend:n});l.push(f);var h=dD({inputs:{x:f},backend:n,attrs:{axis:i,keepDims:o}});return l.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),h}};var pF={kernelName:ar,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims;cE(a,"min");var s=Ga.parseAxisParam(i,a.shape),u=s,c=Wm.getAxesPermutation(u,a.shape.length),l=a;null!=c&&(l=B_({inputs:{x:a},backend:n,attrs:{perm:c}}),u=Wm.getInnerMostAxes(u.length,a.shape.length)),Wm.assertAxesAreInnerMostDims("min",u,l.shape.length);for(var d=Wm.computeOutAndReduceShapes(l.shape,u),p=Object(y.a)(d,2),f=p[0],h=p[1],m=Ga.sizeFromShape(h),v=Ga.makeZerosTypedArray(Ga.sizeFromShape(f),l.dtype),b=n.data.get(l.dataId).values,g=0;g<v.length;++g){for(var x=g*m,k=b[x],w=0;w<m;++w){var O=b[x+w];(Number.isNaN(O)||O<k)&&(k=O)}v[g]=k}null!=c&&n.disposeIntermediateTensorInfo(l);var I=n.makeTensorInfo(f,l.dtype,v);if(o){var S=JA({inputs:{x:I},backend:n,attrs:{shape:Wm.expandShapeToKeepDim(f,s)}});return n.disposeIntermediateTensorInfo(I),S}return I}};var fF={kernelName:or,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.paddings,o=r.mode;cE(a,"mirrorPad");for(var s=i.map((function(e,t){return e[0]+a.shape[t]+e[1]})),u=i.map((function(e){return e[0]})),c=i.map((function(e,t){return e[0]+a.shape[t]})),l="reflect"===o?0:1,d=n.data.get(a.dataId).values,p=a.shape.length,f=Ga.computeStrides(a.shape),h=Ga.sizeFromShape(s),m=s.length,v=Ga.computeStrides(s),b=Ga.getTypedArrayFromDType(a.dtype,h),g=0;g<h;g++){for(var y=Ga.indexToLoc(g,m,v),x=0;x<m;x++)y[x]<u[x]?y[x]=2*u[x]-y[x]-l:y[x]>=c[x]&&(y[x]=2*(c[x]-1)-y[x]+l);y=y.map((function(e,t){return e-u[t]}));var k=Ga.locToIndex(y,p,f);b[g]=d[k]}return{dataId:n.write(b,s,a.dtype),shape:s,dtype:a.dtype}}},hF=mE((function(e,t){var n=e%t;return e<0&&t<0||e>=0&&t>=0?n:(n+t)%t})),mF=NE(sr,hF),vF={kernelName:sr,backendName:"cpu",kernelFunc:mF},bF=L(Z());function gF(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,i=r.dim,o=a.shape.length,s=i;if(-1===s&&(s=o-1),s!==o-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank ".concat(o," and dim was ").concat(s));var u=Ga.parseAxisParam([s],a.shape),c=aF({inputs:{x:a},backend:n,attrs:{reductionIndices:u,keepDims:!1}}),l=Wm.expandShapeToKeepDim(c.shape,u),d=JA({inputs:{x:c},backend:n,attrs:{shape:l}}),p=AA({inputs:{a:a,b:d},backend:n}),f=XE({inputs:{x:p},backend:n}),h=dD({inputs:{x:f},backend:n,attrs:{axis:u,keepDims:!1}}),m=JA({inputs:{x:h},backend:n,attrs:{shape:l}}),v=ND({inputs:{a:f,b:m},backend:n});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(m),v}var yF={kernelName:ea,backendName:"cpu",kernelFunc:gF};var xF={kernelName:ur,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,i=r.numSamples,o=r.seed,s=r.normalized;cE(a,"multinomial");for(var u=s?a:gF({inputs:{logits:a},backend:n,attrs:{dim:-1}}),c=u.shape[0],l=u.shape[1],d=n.data.get(u.dataId).values,p=[c,i],f=Ga.makeZerosTypedArray(Ga.sizeFromShape(p),"int32"),h=0;h<c;++h){var m=h*l,v=new Float32Array(l-1);v[0]=d[m];for(var b=1;b<v.length;++b)v[b]=v[b-1]+d[m+b];for(var g=bF.alea(o.toString()),y=h*i,x=0;x<i;++x){var k=g();f[y+x]=v.length;for(var w=0;w<v.length;w++)if(k<v[w]){f[y+x]=w;break}}}return s||n.disposeIntermediateTensorInfo(u),n.makeTensorInfo(p,"int32",f)}},kF=Gv.nonMaxSuppressionV3Impl;var wF={kernelName:pr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold;cE(a,"NonMaxSuppression");var c=n.data.get(a.dataId).values,l=n.data.get(i.dataId).values,d=kF(c,l,o,s,u).selectedIndices;return n.makeTensorInfo([d.length],"int32",new Int32Array(d))}},OF=Gv.nonMaxSuppressionV4Impl;var IF={kernelName:fr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.padToMaxOutputSize;cE(a,"NonMaxSuppressionPadded");var l=n.data.get(a.dataId).values,d=n.data.get(i.dataId).values,p=OF(l,d,o,s,u,c),f=p.selectedIndices,h=p.validOutputs;return[n.makeTensorInfo([f.length],"int32",new Int32Array(f)),n.makeTensorInfo([],"int32",new Int32Array([h]))]}},SF=Gv.nonMaxSuppressionV5Impl;var NF={kernelName:hr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.softNmsSigma;cE(a,"NonMaxSuppressionWithScore");var l=n.data.get(a.dataId).values,d=n.data.get(i.dataId).values,p=SF(l,d,o,s,u,c),f=p.selectedIndices,h=p.selectedScores;return[n.makeTensorInfo([f.length],"int32",new Int32Array(f)),n.makeTensorInfo([h.length],"float32",new Float32Array(h))]}};var jF={kernelName:vr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=r.dtype,o=r.depth,s=r.onValue,u=r.offValue;cE(a,"oneHot");var c=Ga.sizeFromShape(a.shape),l=new Float32Array(c*o);l.fill(u);for(var d=n.data.get(a.dataId).values,p=0;p<c;++p)d[p]>=0&&d[p]<o&&(l[p*o+d[p]]=s);return n.makeTensorInfo([].concat(Object(S.a)(a.shape),[o]),i,l)}};function TF(e){var t=e.inputs,n=e.backend,r=t.x;if("string"===r.dtype)throw new Error("zerosLike is not supported for string tensors");if("complex64"===r.dtype){var a=kE({inputs:{input:r},backend:n}),i=TF({inputs:{x:a},backend:n}),o=MR({inputs:{input:r},backend:n}),s=TF({inputs:{x:o},backend:n}),u=vE({inputs:{real:i,imag:s},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}return _D({backend:n,attrs:{shape:r.shape,value:0,dtype:r.dtype}})}var CF={kernelName:Ia,backendName:"cpu",kernelFunc:TF};var EF={kernelName:mr,backendName:"cpu",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=n.x;if("string"===a.dtype)throw new Error("onesLike is not supported for string tensors");if("complex64"===a.dtype){var i=kE({inputs:{input:a},backend:r}),o=e({inputs:{x:i},backend:r}),s=MR({inputs:{input:a},backend:r}),u=TF({inputs:{x:s},backend:r}),c=vE({inputs:{real:o,imag:u},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(u),c}return _D({backend:r,attrs:{shape:a.shape,value:1,dtype:a.dtype}})}};function _F(e){var t=e.inputs,n=e.backend,r=e.attrs.axis;if(1===t.length)return OD({inputs:{input:t[0]},backend:n,attrs:{dim:r}});var a=t[0].shape,i=t[0].dtype;t.forEach((function(e){Ga.assertShapesMatch(a,e.shape,"All tensors passed to stack must have matching shapes"),Ga.assert(i===e.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var o=[],s=LR({inputs:t.map((function(e){var t=OD({inputs:{input:e},backend:n,attrs:{dim:r}});return o.push(t),t})),backend:n,attrs:{axis:r}});return o.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),s}var AF={kernelName:br,backendName:"cpu",kernelFunc:_F};var RF={kernelName:gr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.paddings,o=r.constantValue;cE(a,"pad");var s=i.map((function(e,t){return e[0]+a.shape[t]+e[1]})),u=i.map((function(e){return e[0]})),c=n.data.get(a.dataId).values,l=Ga.sizeFromShape(a.shape),d=a.shape.length,p=Ga.computeStrides(a.shape),f=Ga.sizeFromShape(s),h=s.length,m=Ga.computeStrides(s),v=Ga.getTypedArrayFromDType(a.dtype,f);0!==o&&v.fill(o);for(var b=0;b<l;b++){var g=Ga.indexToLoc(b,d,p).map((function(e,t){return e+u[t]}));v[Ga.locToIndex(g,h,m)]=c[b]}return{dataId:n.write(v,s,a.dtype),shape:s,dtype:a.dtype}}},DF=mE((function(e,t){return Math.pow(e,t)})),FF=NE(xr,DF),MF={kernelName:xr,backendName:"cpu",kernelFunc:FF};var zF={kernelName:Or,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.paramsNestedSplits,i=t.paramsDenseValues,o=t.indices,s=(r.outputRaggedRank,a.map((function(e){return n.data.get(e.dataId).values}))),u=a.map((function(e){return e.shape})),c=n.data.get(i.dataId).values,l=n.data.get(o.dataId).values,d=K_(s,u,c,i.shape,i.dtype,l,o.shape),p=Object(y.a)(d,3),f=p[0],h=p[1],m=p[2],v=f.map((function(e){return n.makeTensorInfo([e.length],"int32",e)})),b=n.makeTensorInfo(m,i.dtype,h);return v.concat([b])}};var LF={kernelName:Ir,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.starts,a=t.limits,i=t.deltas,o=n.data.get(r.dataId).values,s=n.data.get(a.dataId).values,u=n.data.get(i.dataId).values,c=Y_(o,r.shape,r.dtype,s,a.shape,u,i.shape),l=Object(y.a)(c,2),d=l[0],p=l[1];return[n.makeTensorInfo([d.length],"int32",d),n.makeTensorInfo([p.length],r.dtype,p)]}};var PF={kernelName:Sr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.shape,i=t.values,o=t.defaultValue,s=t.rowPartitionTensors,u=r.rowPartitionTypes,c=n.data.get(a.dataId).values,l=n.data.get(i.dataId).values,d=n.data.get(o.dataId).values,p=s.map((function(e){return n.data.get(e.dataId).values})),f=s.map((function(e){return e.shape})),h=eA(c,a.shape,l,i.shape,i.dtype,d,o.shape,p,f,u),m=Object(y.a)(h,2),v=m[0],b=m[1];return n.makeTensorInfo(v,i.dtype,b)}};var BF={kernelName:Nr,backendName:"cpu",kernelFunc:function(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,i=n.dtype,o=tA(r,a,n.step,i);return t.makeTensorInfo([o.length],i,o)}},WF=LE(Tr,(function(e){return 1/e})),UF={kernelName:Tr,backendName:"cpu",kernelFunc:WF};var VF={kernelName:Rr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=r.alignCorners,o=r.halfPixelCenters,s=r.size;cE(a,"resizeBilinear");for(var u=Ga.computeStrides(a.shape),c=Object(y.a)(s,2),l=c[0],d=c[1],p=Object(y.a)(a.shape,4),f=p[0],h=p[1],m=p[2],v=p[3],b=n.data.get(a.dataId).values,g=new Float32Array(Ga.sizeFromShape([f,l,d,v])),x=[i&&l>1?h-1:h,i&&d>1?m-1:m],k=[i&&l>1?l-1:l,i&&d>1?d-1:d],w=0,O=x[0]/k[0],I=x[1]/k[1],S=0;S<f;S++)for(var N=0;N<l;N++){var j=void 0;j=o?O*(N+.5)-.5:O*N;for(var T=Math.max(0,Math.floor(j)),C=j-T,E=Math.min(h-1,Math.ceil(j)),_=S*u[0]+T*u[1],A=S*u[0]+E*u[1],R=0;R<d;R++){var D=void 0;D=o?I*(R+.5)-.5:I*R;for(var F=Math.max(0,Math.floor(D)),M=D-F,z=Math.min(m-1,Math.ceil(D)),L=_+F*u[2],P=A+F*u[2],B=_+z*u[2],W=A+z*u[2],U=0;U<v;U++){var V=b[L+U],G=b[P+U],H=V+(b[B+U]-V)*M,q=H+(G+(b[W+U]-G)*M-H)*C;g[w++]=q}}}return n.makeTensorInfo([f,l,d,v],"float32",g)}};var GF={kernelName:Dr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=t.dy,o=r.alignCorners;cE([i,a],"resizeBilinearGrad");for(var s=Ga.computeStrides(a.shape),u=Object(y.a)(a.shape,4),c=u[0],l=u[1],d=u[2],p=u[3],f=Object(y.a)(i.shape,3),h=f[1],m=f[2],v=new Float32Array(c*l*d*p),b=[o&&h>1?l-1:l,o&&m>1?d-1:d],g=[o&&h>1?h-1:h,o&&m>1?m-1:m],x=b[0]/g[0],k=b[1]/g[1],w=n.data.get(i.dataId).values,O=0,I=0;I<c;I++)for(var S=I*s[0],N=0;N<h;N++)for(var j=N*x,T=Math.floor(j),C=Math.min(Math.ceil(j),l-1),E=S+T*s[1],_=S+C*s[1],A=j-T,R=1-A,D=0;D<m;D++)for(var F=D*k,M=Math.floor(F),z=Math.min(Math.ceil(F),d-1),L=F-M,P=1-L,B=E+M*s[2],W=E+z*s[2],U=_+M*s[2],V=_+z*s[2],G=R*P,H=R*L,q=A*P,K=A*L,X=0;X<p;X++){var Y=w[O++];v[B+X]+=Y*G,v[W+X]+=Y*H,v[U+X]+=Y*q,v[V+X]+=Y*K}return n.makeTensorInfo([c,d,l,p],"float32",v)}};var HF={kernelName:_r,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=r.alignCorners,o=r.halfPixelCenters,s=r.size;cE(a,"resizeNearestNeighbor");for(var u=Ga.computeStrides(a.shape),c=Object(y.a)(s,2),l=c[0],d=c[1],p=Object(y.a)(a.shape,4),f=p[0],h=p[1],m=p[2],v=p[3],b=n.data.get(a.dataId).values,g=new Float32Array(f*l*d*v),x=[i&&l>1?h-1:h,i&&d>1?m-1:m],k=[i&&l>1?l-1:l,i&&d>1?d-1:d],w=x[0]/k[0],O=x[1]/k[1],I=0,S=0;S<f;S++)for(var N=S*u[0],j=0;j<l;j++){var T=o?w*(j+.5):w*j,C=Math.min(h-1,i?Math.round(T):Math.floor(T));o&&(C=Math.max(0,C));for(var E=N+C*u[1],_=0;_<d;_++){var A=o?O*(_+.5):O*_,R=Math.min(m-1,i?Math.round(A):Math.floor(A));o&&(R=Math.max(0,R));for(var D=E+R*u[2],F=0;F<v;F++){var M=b[D+F];g[I++]=M}}}return n.makeTensorInfo([f,l,d,v],a.dtype,g)}};var qF={kernelName:Ar,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=t.dy,o=r.alignCorners;cE([i,a],"resizeNearestNeighborGrad");for(var s=Ga.computeStrides(a.shape),u=Ga.computeStrides(i.shape),c=Object(y.a)(a.shape,4),l=c[0],d=c[1],p=c[2],f=c[3],h=Object(y.a)(i.shape,3),m=h[1],v=h[2],b=new Float32Array(l*d*p*f),g=n.data.get(i.dataId).values,x=[o&&m>1?d-1:d,o&&v>1?p-1:p],k=[o&&m>1?m-1:m,o&&v>1?v-1:v],w=x[0]/k[0],O=x[1]/k[1],I=1/w,S=1/O,N=2*Math.ceil(I)+2,j=2*Math.ceil(S)+2,T=0;T<l;T++)for(var C=T*s[0],E=0;E<d;E++)for(var _=C+E*s[1],A=Math.floor(E*I),R=Math.floor(A-N/2),D=0;D<p;D++)for(var F=_+D*s[2],M=Math.floor(D*S),z=Math.floor(M-j/2),L=0;L<f;L++){for(var P=0,B=0;B<N;B++){var W=B+R;if(!(W<0||W>=m)){var U=C+W*u[1],V=W*w;if(E===Math.min(d-1,o?Math.round(V):Math.floor(V)))for(var G=0;G<j;G++){var H=G+z;if(!(H<0||H>=v)){var q=U+H*u[2],K=H*O;D===Math.min(p-1,o?Math.round(K):Math.floor(K))&&(P+=g[q+L])}}}}b[F+L]=P}return n.makeTensorInfo(a.shape,a.dtype,b)}};var KF={kernelName:Mr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.dims;cE(a,"reverse");var o=a.shape.length,s=Ga.parseAxisParam(i,a.shape);if(0===o)return yE({inputs:{x:a},backend:n});for(var u=new Si(a.shape,a.dtype),c=n.bufferSync(a),l=function(e){var t=u.indexToLoc(e),n=t.slice();s.forEach((function(e){return n[e]=a.shape[e]-1-n[e]})),u.set.apply(u,[c.get.apply(c,Object(S.a)(n))].concat(Object(S.a)(t)))},d=0;d<u.size;d++)l(d);return n.makeTensorInfo(u.shape,u.dtype,u.values)}},XF={kernelName:ja,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.attrs,r=e.backend,a=t.image,i=n.radians,o=n.fillValue,s=n.center,u=r,c=Ga.getTypedArrayFromDType(a.dtype,Ga.sizeFromShape(a.shape)),l=Object(y.a)(a.shape,4),d=l[0],p=l[1],f=l[2],h=l[3],m=Wm.getImageCenter(s,p,f),v=Object(y.a)(m,2),b=v[0],g=v[1],x=Math.sin(i),k=Math.cos(i),w=u.data.get(a.dataId).values,O=0;O<d;O++)for(var I=O*f*p*h,S=0;S<p;S++)for(var N=S*(f*h),j=0;j<f;j++)for(var T=j*h,C=0;C<h;C++){var E=[d,S,j,C],_=E[2],A=E[1],R=(_-b)*k-(A-g)*x,D=(_-b)*x+(A-g)*k;R=Math.round(R+b),D=Math.round(D+g);var F=o;if("number"!=typeof o&&(F=3===C?255:o[C]),R>=0&&R<f&&D>=0&&D<p)F=w[I+D*(f*h)+R*h+C];c[I+N+T+C]=F}return{dataId:u.write(c,a.shape,a.dtype),shape:a.shape,dtype:a.dtype}}},YF=LE(zr,(function(e){var t=Math.floor(e);return e-t<.5?Math.floor(e):e-t>.5?Math.ceil(e):t%2===0?t:t+1})),ZF={kernelName:zr,backendName:"cpu",kernelFunc:YF};var JF={kernelName:Pr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=t.updates,o=r.shape,s=Wm.calculateShapes(i,a,o),u=s.sliceRank,c=s.numUpdates,l=s.sliceSize,d=s.strides,p=s.outputSize,f=iA(n.bufferSync(a),n.bufferSync(i),o,p,l,c,u,d,0,!0);return n.makeTensorInfo(o,f.dtype,f.values)}};function QF(e,t){for(var n=0,r=e.length,a=0;n<r;)e[a=Math.floor((n+r)/2)]<t?n=a+1:r=a;return r}function $F(e,t){for(var n=0,r=e.length,a=0;n<r;)e[a=Math.floor((n+r)/2)]<=t?n=a+1:r=a;return r}var eM={kernelName:Wr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.sortedSequence,i=t.values,o=r.side,s=function(e,t,n,r,a,i){for(var o=Ga.getArrayFromDType("int32",n*a),s=0;s<n;++s)for(var u=e.slice(s*r,(s+1)*r),c=s*a,l=0;l<a;++l)o[c+l]="left"===i?QF(u,t[l+c]):$F(u,t[l+c]);return o}(n.data.get(a.dataId).values,n.data.get(i.dataId).values,a.shape[0],a.shape[1],i.shape[1],o);return n.makeTensorInfo(i.shape,"int32",s)}};var tM={kernelName:Ur,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.condition,a=t.t,i=t.e;cE([r,a,i],"select");for(var o=r.shape.length,s=n.data.get(r.dataId).values,u=n.data.get(a.dataId).values,c=n.data.get(i.dataId).values,l=Li(a.dtype,i.dtype),d=Ga.makeZerosTypedArray(Ga.sizeFromShape(a.shape),l),p=0,f=0===o||o>1||1===a.shape.length?1:Ga.sizeFromShape(a.shape.slice(1)),h=0;h<s.length;h++)for(var m=0;m<f;m++)1===s[h]?d[p++]=u[h]:d[p++]=c[h];return n.makeTensorInfo(a.shape,l,d)}},nM=Wm.SELU_SCALEALPHA,rM=Wm.SELU_SCALE,aM=LE(Vr,(function(e){return e>=0?rM*e:nM*(Math.exp(e)-1)})),iM={kernelName:Vr,backendName:"cpu",kernelFunc:aM},oM=LE(Kr,(function(e){return e<0?-1:e>0?1:0})),sM={kernelName:Kr,backendName:"cpu",kernelFunc:oM},uM=LE(Hr,(function(e){return Math.sin(e)})),cM={kernelName:Hr,backendName:"cpu",kernelFunc:uM},lM=LE(qr,(function(e){return Math.sinh(e)})),dM={kernelName:qr,backendName:"cpu",kernelFunc:lM},pM=Math.log(1.1920928955078125e-7)+2,fM=LE(Yr,(function(e){var t=e>-pM,n=e<pM,r=Math.exp(e);return n?r:t?e:Math.log(1+r)})),hM={kernelName:Yr,backendName:"cpu",kernelFunc:fM};var mM={kernelName:Qr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.paddings;cE([a],"spaceToBatchND");var s=Ga.sizeFromShape(i),u=[[0,0]];u.push.apply(u,Object(S.a)(o));for(var c=1+i.length;c<a.shape.length;++c)u.push([0,0]);var l=RF.kernelFunc({inputs:{x:a},backend:n,attrs:{paddings:u,constantValue:0}}),d=Wm.getReshaped(l.shape,i,s,!1),p=Wm.getPermuted(d.length,i.length,!1),f=Wm.getReshapedPermuted(l.shape,i,s,!1),h=JA({inputs:{x:l},backend:n,attrs:{shape:d}}),m=B_({inputs:{x:h},backend:n,attrs:{perm:p}}),v=JA({inputs:{x:m},backend:n,attrs:{shape:f}});return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(m),v}};var vM={kernelName:ta,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.indices,a=t.values,i=t.denseShape,o=t.defaultValue;if(1!==i.shape.length)throw new Error("Dense shape must be a vector, saw:\n        ".concat(i.shape));if(2!==r.shape.length)throw new Error("Indices must be a matrix, saw:\n        ".concat(r.shape));if(1!==a.shape.length)throw new Error("Values must be a vector, saw:\n        ".concat(a.shape));if(0!==o.shape.length)throw new Error("Default value must be a scalar, saw:\n        ".concat(o.shape));var s=n.data.get(r.dataId).values,u=n.data.get(a.dataId).values,c=n.data.get(i.dataId).values,l=n.data.get(o.dataId).values[0],d=pA(s,r.shape,r.dtype,u,a.dtype,c,l),p=Object(y.a)(d,5),f=p[0],h=p[1],m=p[2],v=p[3],b=p[4];return[n.makeTensorInfo(h,r.dtype,f),n.makeTensorInfo([h[0]],a.dtype,m),n.makeTensorInfo([v.length],"bool",new Uint8Array(v.map((function(e){return Number(e)})))),n.makeTensorInfo([b.length],r.dtype,new Int32Array(b))]}};var bM={kernelName:na,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.inputIndices,a=t.inputShape,i=t.newShape;if(2!==r.shape.length)throw new Error("Input indices should be a matrix but received shape\n        ".concat(r.shape));if(1!==a.shape.length)throw new Error("Input shape should be a vector but received shape\n        ".concat(a.shape));if(1!==i.shape.length)throw new Error("Target shape should be a vector but received shape ".concat(i.shape));var o=Array.from(n.data.get(a.dataId).values),s=n.data.get(r.dataId).values,u=Array.from(n.data.get(i.dataId).values),c=fA(s,r.shape,r.dtype,o,u),l=Object(y.a)(c,3),d=l[0],p=l[1],f=l[2];return[n.makeTensorInfo(p,r.dtype,d),n.makeTensorInfo([f.length],i.dtype,new Int32Array(f))]}};var gM={kernelName:ra,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.data,a=t.indices,i=t.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n          ".concat(a.shape));if(1!==i.shape.length)throw new Error("Segment ids should be a vector but received shape\n          ".concat(i.shape));if(a.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");var o=n.data.get(r.dataId).values,s=n.data.get(a.dataId).values,u=n.data.get(i.dataId).values,c=hA(o,r.shape,r.dtype,s,u,!0),l=Object(y.a)(c,2),d=l[0],p=l[1];return n.makeTensorInfo(p,r.dtype,d)}};var yM={kernelName:aa,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.data,a=t.indices,i=t.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n         ".concat(a.shape));if(1!==i.shape.length)throw new Error("Segment ids should be a vector but received shape\n         ".concat(i.shape));if(a.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");var o=n.data.get(r.dataId).values,s=n.data.get(a.dataId).values,u=n.data.get(i.dataId).values,c=hA(o,r.shape,r.dtype,s,u),l=Object(y.a)(c,2),d=l[0],p=l[1];return n.makeTensorInfo(p,r.dtype,d)}};var xM={kernelName:ia,backendName:"cpu",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.sparseIndices,o=n.sparseValues,s=n.defaultValue,u=a.outputShape,c=Wm.calculateShapes(o,i,u),l=c.sliceRank,d=c.numUpdates,p=c.sliceSize,f=c.strides,h=c.outputSize,m=r.bufferSync(i);switch(o.dtype){case"bool":t=iA(m,r.bufferSync(o),u,h,p,d,l,f,!!r.data.get(s.dataId).values[0],!1);break;case"float32":t=iA(m,r.bufferSync(o),u,h,p,d,l,f,r.data.get(s.dataId).values[0],!1);break;case"int32":t=iA(m,r.bufferSync(o),u,h,p,d,l,f,r.data.get(s.dataId).values[0],!1);break;case"string":t=iA(m,r.bufferSync(o),u,h,p,d,l,f,Ga.decodeString(r.data.get(s.dataId).values[0]),!1);break;default:throw new Error("Unsupported type ".concat(o.dtype))}return r.makeTensorInfo(u,t.dtype,t.values)}};var kM={kernelName:$r,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.numOrSizeSplits,o=r.axis,s=Ga.parseAxisParam(o,a.shape)[0],u=Wm.prepareSplitSize(a,i,s),c=new Array(a.shape.length).fill(0),l=a.shape.slice();return u.map((function(e){var t=Object(S.a)(l);t[s]=e;var r=lA({inputs:{x:a},backend:n,attrs:{begin:c,size:t}});return c[s]+=e,r}))}},wM={kernelName:sa,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=n;cE(r,"square");for(var i=a.data.get(r.dataId).values,o=new Float32Array(i.length),s=0;s<i.length;++s){var u=i[s];o[s]=u*u}return{dataId:a.write(o,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},OM=LE(Sa,(function(e,t){var n=t;return isNaN(e)?NaN:e>0?1:n.alpha})),IM={kernelName:Sa,backendName:"cpu",kernelFunc:OM};var SM={kernelName:ca,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.begin,o=r.end,s=r.strides,u=r.beginMask,c=r.endMask,l=r.ellipsisMask,d=r.newAxisMask,p=r.shrinkAxisMask;cE(a,"stridedSlice");var f,h=bm.sliceInfo(a.shape,i,o,s,u,c,l,d,p),m=h.finalShapeSparse,v=h.finalShape,b=h.isIdentity,g=h.sliceDim0,y=h.isSimpleSlice,x=h.begin,k=h.end,w=h.strides;if(b)f=JA({inputs:{x:a},backend:n,attrs:{shape:v}});else if(g||y){Ga.assert(a.shape.length>=1,(function(){return"Input must have rank at least 1, got: ".concat(a.shape.length)}));var O=bm.computeOutShape(x,k,w),I=lA({inputs:{x:a},backend:n,attrs:{begin:x,size:O}});f=JA({inputs:{x:I},backend:n,attrs:{shape:v}}),n.disposeIntermediateTensorInfo(I)}else{var S=IA(m,n.bufferSync(a),w,x);f=n.makeTensorInfo(v,S.dtype,S.values)}return f}};var NM={kernelName:la,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=r.separator,i=r.nGramWidths,o=r.leftPad,s=r.rightPad,u=r.padWidth,c=r.preserveShortSequences,l=t.data,d=t.dataSplits,p=NA(n.data.get(l.dataId).values,n.data.get(d.dataId).values,a,i,o,s,u,c),f=Object(y.a)(p,2),h=f[0],m=f[1];return[n.makeTensorInfo([h.length],"string",h),n.makeTensorInfo(d.shape,"int32",m)]}};var jM={kernelName:da,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.skipEmpty,a=t.input,i=t.delimiter;if("string"!==a.dtype)throw new Error("Input must be of datatype string");if(1!==a.shape.length)throw new Error("Input must be a vector, got shape: ".concat(a.shape));if(0!==i.shape.length)throw new Error("Delimiter must be a scalar, got shape: ".concat(i.shape));var o=TA(n.data.get(a.dataId).values,n.data.get(i.dataId).values[0],r),s=Object(y.a)(o,3),u=s[0],c=s[1],l=s[2],d=c.length;return[n.makeTensorInfo([d,2],"int32",u),n.makeTensorInfo([d],"string",c),n.makeTensorInfo([2],"int32",new Int32Array(l))]}};var TM={kernelName:pa,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.numBuckets,a=t.input;if("string"!==a.dtype)throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");var i=CA(n.data.get(a.dataId).values,r);return n.makeTensorInfo(a.shape,"int32",i)}},CM=LE(ha,(function(e){return Math.tan(e)})),EM={kernelName:ha,backendName:"cpu",kernelFunc:CM},_M=LE(ma,(function(e){return Math.tanh(e)}));function AM(e,t,n){switch(n){case"reflect":return function(e,t){var n=e;if(n<0)if(t<=1)n=0;else{var r=2*t;n<r&&(n=r*Math.trunc(-n/r)+n),n=n<-t?n+r:-n-1}else if(n>t-1)if(t<=1)n=0;else{var a=2*t;(n-=a*Math.trunc(n/a))>=t&&(n=a-n-1)}return Ga.clamp(0,n,t-1)}(e,t);case"wrap":return function(e,t){var n=e;if(n<0)if(t<=1)n=0;else{var r=t-1;n+=t*(Math.trunc(-n/r)+1)}else if(n>t-1)if(t<=1)n=0;else{var a=t-1;n-=t*Math.trunc(n/a)}return Ga.clamp(0,n,t-1)}(e,t);case"nearest":return function(e,t){return Ga.clamp(0,e,t-1)}(e,t);case"constant":default:return function(e,t){return e}(e)}}function RM(e,t,n,r,a,i,o,s,u,c,l){return 0<=s&&s<t&&0<=u&&u<n?e[o*r+s*a+u*i+c]:l}function DM(e,t,n,r,a,i,o,s,u,c,l){return RM(e,t,n,r,a,i,o,Math.round(s),Math.round(u),c,l)}function FM(e,t,n,r,a,i,o,s,u,c,l){var d=Math.floor(s),p=Math.floor(u),f=d+1,h=p+1;return(f-s)*((h-u)*RM(e,t,n,r,a,i,o,d,p,c,l)+(u-p)*RM(e,t,n,r,a,i,o,d,h,c,l))+(s-d)*((h-u)*RM(e,t,n,r,a,i,o,f,p,c,l)+(u-p)*RM(e,t,n,r,a,i,o,f,h,c,l))}for(var MM=0,zM=[tR,hE,rR,iR,_E,oR,sR,uR,cR,lR,pR,hR,vR,yR,kR,SR,NR,jR,TR,eR,CR,ER,_R,ME,AR,SE,UE,DR,bE,FR,PR,WR,UR,VR,GR,HR,qR,XR,ZR,JR,QR,$R,eD,tD,rD,aD,iD,oD,sD,uD,cD,lD,fD,BA,hD,qE,wD,YE,ID,QE,ED,AD,RD,t_,a_,DD,FD,MD,zD,c_,p_,xE,LD,zR,BD,UD,GD,UA,m_,g_,HD,w_,KD,ZD,QD,tF,nF,rF,iF,N_,oF,sF,uF,cF,lF,dF,pF,C_,fF,vF,xF,R_,F_,wF,IF,NF,L_,jF,EF,AF,RF,MF,HA,V_,zF,LF,PF,BF,wE,jD,UF,KA,YA,QA,VF,GF,HF,qF,KF,XF,ZF,aA,JF,eM,tM,iM,uA,sM,cM,dM,dA,yF,hM,mM,vM,bM,gM,yM,xM,kM,bA,wM,xA,OA,IM,SM,NM,jM,TM,RA,pD,EM,{kernelName:ma,backendName:"cpu",kernelFunc:_M},{kernelName:Br,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.tensor,a=t.indices,i=t.updates,o=Wm.calculateShapes(i,a,r.shape),s=o.sliceRank,u=o.numUpdates,c=o.sliceSize,l=o.strides,d=o.outputSize,p=n.bufferSync(a),f=n.bufferSync(i),h=n.bufferSync(r),m=iA(p,f,r.shape,d,c,u,s,l,h,!1);return n.makeTensorInfo(r.shape,m.dtype,m.values)}},{kernelName:va,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.reps;cE(a,"tile");var o=DA(n.bufferSync(a),i);return n.makeTensorInfo(o.shape,o.dtype,o.values)}},{kernelName:ba,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.k,o=r.sorted;cE(a,"topk");var s=MA(n.data.get(a.dataId).values,a.shape,a.dtype,i,o),u=Object(y.a)(s,2),c=u[0],l=u[1];return[n.makeTensorInfo(c.shape,c.dtype,c.values),n.makeTensorInfo(l.shape,l.dtype,l.values)]}},{kernelName:ga,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.image,i=t.transforms,o=n.interpolation,s=n.fillMode,u=n.fillValue,c=n.outputShape,l=Object(y.a)(a.shape,4),d=l[0],p=l[1],f=l[2],h=l[3],m=null!=c?c:[p,f],v=Object(y.a)(m,2),b=v[0],g=v[1],x=[d,b,g,h],k=Ga.computeStrides(a.shape),w=k[0],O=k[1],I=k[2],S=Ga.computeStrides(x),N=S[0],j=S[1],T=S[2],C=Ga.getTypedArrayFromDType(a.dtype,Ga.sizeFromShape(x));C.fill(u);for(var E=r.data.get(a.dataId).values,_=r.data.get(i.dataId).values,A=0;A<d;++A){for(var R=1===i.shape[0]?_:_.subarray(8*A,8*A+8),D=0;D<b;++D)for(var F=0;F<g;++F)for(var M=0;M<h;++M){var z=void 0,L=R[6]*F+R[7]*D+1;if(0!==L){var P=(R[0]*F+R[1]*D+R[2])/L,B=(R[3]*F+R[4]*D+R[5])/L,W=AM(P,f,s),U=AM(B,p,s);switch(o){case"nearest":z=DM(E,p,f,w,O,I,A,U,W,M,u);break;case"bilinear":z=FM(E,p,f,w,O,I,A,U,W,M,u);break;default:throw new Error("Error in Transform: Expect 'nearest' or 'bilinear', but got ".concat(o))}C[A*N+D*j+F*T+M]=z}}return r.makeTensorInfo(x,a.dtype,C)}return{dataId:r.write(C,x,a.dtype),shape:a.shape,dtype:a.dtype}}},W_,{kernelName:xa,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=n.axis,i=t.x;cE(i,"unique");var o=zA(r.data.get(i.dataId).values,a,i.shape,i.dtype),s=o.outputValues,u=o.outputShape,c=o.indices;return[r.makeTensorInfo(u,i.dtype,s),r.makeTensorInfo([c.length],"int32",c)]}},{kernelName:ka,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.value,i=r.axis;i<0&&(i+=a.shape.length);for(var o=a.shape.length,s=a.shape[i],u=new Array(o-1),c=0,l=0;l<o;l++)l!==i&&(u[c++]=a.shape[l]);var d=new Array(o).fill(0),p=a.shape.slice();p[i]=1;for(var f=new Array(s),h=0;h<f.length;h++){d[i]=h;var m=lA({inputs:{x:a},backend:n,attrs:{begin:d,size:p}});f[h]=JA({inputs:{x:m},backend:n,attrs:{shape:u}}),n.disposeIntermediateTensorInfo(m)}return f}},{kernelName:wa,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.segmentIds,o=r.numSegments;cE(a,"unsortedSegmentSum");for(var s=[],u=[],c=a.shape.length-i.shape.length,l=i,d=0;d<c;++d){var p=OD({inputs:{input:l},backend:n,attrs:{dim:d+1}});l=p,u.push(p)}for(var f=0;f<o;++f){var h=Ga.createScalarValue(f,"int32"),m=n.makeTensorInfo([],"int32",h),v=HE({inputs:{a:m,b:l},backend:n}),b=IE({inputs:{x:v},backend:n,attrs:{dtype:"float32"}}),g=A_({inputs:{a:b,b:a},backend:n}),y=dD({inputs:{x:g},backend:n,attrs:{axis:0,keepDims:!1}});s.push(y),u.push(m),u.push(v),u.push(b),u.push(g),u.push(y)}var x=_F({inputs:s,backend:n,attrs:{axis:0}});return u.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),x}},CF];MM<zM.length;MM++){La(zM[MM])}var LM={};z(LM,{assertNotComplex:function(){return Hz},bindCanvasToFramebuffer:function(){return kz},bindColorTextureToFramebuffer:function(){return wz},bindTextureToProgramUniformSampler:function(){return xz},bindTextureUnit:function(){return vz},bindVertexBufferToProgramAttribute:function(){return mz},callAndCheck:function(){return ZM},canBeRepresented:function(){return JM},createFragmentShader:function(){return tz},createFramebuffer:function(){return hz},createProgram:function(){return oz},createStaticIndexBuffer:function(){return lz},createStaticVertexBuffer:function(){return cz},createTexture:function(){return pz},createVertexShader:function(){return ez},getBatchDim:function(){return Tz},getExtensionOrThrow:function(){return $M},getFramebufferErrorMessage:function(){return Sz},getMaxTexturesInShader:function(){return zz},getNumChannels:function(){return dz},getProgramUniformLocation:function(){return yz},getProgramUniformLocationOrThrow:function(){return gz},getRowsCols:function(){return Cz},getShapeAs3D:function(){return Ez},getTextureShapeFromLogicalShape:function(){return _z},getWebGLDisjointQueryTimerVersion:function(){return Lz},getWebGLErrorMessage:function(){return QM},getWebGLMaxTextureSize:function(){return Dz},hasExtension:function(){return Pz},isCapableOfRenderingToFloatTexture:function(){return Wz},isDownloadFloatTextureEnabled:function(){return Uz},isReshapeFree:function(){return Rz},isWebGLFenceEnabled:function(){return Gz},isWebGLVersionEnabled:function(){return Bz},linkProgram:function(){return sz},logShaderSourceAndInfoLog:function(){return iz},resetMaxTextureSize:function(){return Fz},resetMaxTexturesInShader:function(){return Mz},unbindColorTextureFromFramebuffer:function(){return Oz},unbindTextureUnit:function(){return bz},validateFramebuffer:function(){return Iz},validateProgram:function(){return uz},validateTextureSize:function(){return fz}});var PM,BM,WM,UM={},VM={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function GM(e,t){UM[e]=t}function HM(e,t){if(!(e in UM)||null!=t){var n=function(e,t){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var n=null==t?function(e){if(!st().getBool("IS_SAFARI")&&"undefined"!=typeof OffscreenCanvas&&2===e)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(e):t;return n.addEventListener("webglcontextlost",(function(t){t.preventDefault(),delete UM[e]}),!1),st().getBool("SOFTWARE_WEBGL_ENABLED")&&(VM.failIfMajorPerformanceCaveat=!1),1===e?n.getContext("webgl",VM)||n.getContext("experimental-webgl",VM):n.getContext("webgl2",VM)}(e,t);if(null===n)return console.log("Could not get context for WebGL version",e),null;UM[e]=n}var r=UM[e];return null==r||r.isContextLost()?(delete UM[e],HM(e)):(r.disable(r.DEPTH_TEST),r.disable(r.STENCIL_TEST),r.disable(r.BLEND),r.disable(r.DITHER),r.disable(r.POLYGON_OFFSET_FILL),r.disable(r.SAMPLE_COVERAGE),r.enable(r.SCISSOR_TEST),r.enable(r.CULL_FACE),r.cullFace(r.BACK),UM[e])}function qM(e,t){return[t,e]}function KM(e){var t=Ga.sizeFromShape(e),n=Math.ceil(t/4);return Ga.sizeToSquarishShape(n)}function XM(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function YM(e,t){var n,r,a,i,o,s,u,c,l,d,p=e;return 2===st().getNumber("WEBGL_VERSION")?(n=p.R32F,r=p.R16F,a=p.RGBA16F,i=p.RGBA32F,o=p.RED,u=4,c=1,l=p.HALF_FLOAT,d=p.FLOAT,s=p.RGBA8):(n=e.RGBA,r=e.RGBA,a=e.RGBA,i=p.RGBA,o=e.RGBA,u=4,c=4,l=null!=t?t.HALF_FLOAT_OES:null,d=e.FLOAT,s=e.RGBA),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:a,internalFormatPackedFloat:i,textureFormatFloat:o,downloadTextureFormat:s,downloadUnpackNumChannels:u,defaultNumChannels:c,textureTypeHalfFloat:l,textureTypeFloat:d}}function ZM(e,t){var n=t();return st().getBool("DEBUG")&&function(e){var t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+QM(e,t))}(e),n}!function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"}(PM||(PM={})),function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(BM||(BM={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(WM||(WM={}));function JM(e){return!!(st().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===e||5.96e-8<Math.abs(e)&&Math.abs(e)<65504)}function QM(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code ".concat(t)}}function $M(e,t){return Nz(e,(function(){return e.getExtension(t)}),'Extension "'+t+'" not supported on this browser.')}function ez(e,t){var n=Nz(e,(function(){return e.createShader(e.VERTEX_SHADER)}),"Unable to create vertex WebGLShader.");if(ZM(e,(function(){return e.shaderSource(n,t)})),ZM(e,(function(){return e.compileShader(n)})),!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}function tz(e,t){var n=Nz(e,(function(){return e.createShader(e.FRAGMENT_SHADER)}),"Unable to create fragment WebGLShader.");if(ZM(e,(function(){return e.shaderSource(n,t)})),ZM(e,(function(){return e.compileShader(n)})),st().get("ENGINE_COMPILE_ONLY"))return n;if(!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw iz(t,e.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}var nz,rz,az=/ERROR: [0-9]+:([0-9]+):/g;function iz(e,t){var n=az.exec(t);if(null==n)return console.log("Couldn't parse line number in error: ".concat(t)),void console.log(e);for(var r=+n[1],a=e.split("\n"),i=a.length.toString().length+2,o=a.map((function(e,t){return Ga.rightPad((t+1).toString(),i)+e})),s=0,u=0;u<o.length;u++)s=Math.max(o[u].length,s);var c=o.slice(0,r-1),l=o.slice(r-1,r),d=o.slice(r);console.log(c.join("\n")),console.log(t.split("\n")[0]),console.log("%c ".concat(Ga.rightPad(l[0],s)),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(d.join("\n"))}function oz(e){return Nz(e,(function(){return e.createProgram()}),"Unable to create WebGLProgram.")}function sz(e,t){if(ZM(e,(function(){return e.linkProgram(t)})),!st().get("ENGINE_COMPILE_ONLY")&&!1===e.getProgramParameter(t,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}function uz(e,t){if(ZM(e,(function(){return e.validateProgram(t)})),!1===e.getProgramParameter(t,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function cz(e,t){var n=Nz(e,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return ZM(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,n)})),ZM(e,(function(){return e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW)})),n}function lz(e,t){var n=Nz(e,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return ZM(e,(function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n)})),ZM(e,(function(){return e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW)})),n}function dz(){return 2===st().getNumber("WEBGL_VERSION")?1:4}function pz(e){return Nz(e,(function(){return e.createTexture()}),"Unable to create WebGLTexture.")}function fz(e,t){var n=st().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0){var r="[".concat(e,"x").concat(t,"]");throw new Error("Requested texture size "+r+" is invalid.")}if(e>n||t>n){var a="[".concat(e,"x").concat(t,"]"),i="[".concat(n,"x").concat(n,"]");throw new Error("Requested texture size "+a+" greater than WebGL maximum on this browser / GPU "+i+".")}}function hz(e){return Nz(e,(function(){return e.createFramebuffer()}),"Unable to create WebGLFramebuffer.")}function mz(e,t,n,r,a,i,o){var s=e.getAttribLocation(t,n);return-1!==s&&(ZM(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,r)})),ZM(e,(function(){return e.vertexAttribPointer(s,a,e.FLOAT,!1,i,o)})),ZM(e,(function(){return e.enableVertexAttribArray(s)})),!0)}function vz(e,t,n){jz(e,n),ZM(e,(function(){return e.activeTexture(e.TEXTURE0+n)})),ZM(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)}))}function bz(e,t){jz(e,t),ZM(e,(function(){return e.activeTexture(e.TEXTURE0+t)})),ZM(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}function gz(e,t,n){return Nz(e,(function(){return e.getUniformLocation(t,n)}),'uniform "'+n+'" not present in program.')}function yz(e,t,n){return e.getUniformLocation(t,n)}function xz(e,t,n,r){ZM(e,(function(){return vz(e,t,r)})),ZM(e,(function(){return e.uniform1i(n,r)}))}function kz(e){ZM(e,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)})),ZM(e,(function(){return e.viewport(0,0,e.canvas.width,e.canvas.height)})),ZM(e,(function(){return e.scissor(0,0,e.canvas.width,e.canvas.height)}))}function wz(e,t,n){ZM(e,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,n)})),ZM(e,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)}))}function Oz(e,t){ZM(e,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,t)})),ZM(e,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)}))}function Iz(e){var t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+Sz(e,t))}function Sz(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error ".concat(t)}}function Nz(e,t,n){var r=ZM(e,(function(){return t()}));if(null==r)throw new Error(n);return r}function jz(e,t){var n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n){var a="[gl.TEXTURE0, gl.TEXTURE".concat(n,"]");throw new Error("textureUnit must be in ".concat(a,"."))}}function Tz(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return Ga.sizeFromShape(e.slice(0,e.length-t))}function Cz(e){if(0===e.length)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function Ez(e){var t=[1,1,1];return 0===e.length||1===e.length&&1===e[0]||(t=[Tz(e)].concat(Object(S.a)(Cz(e)))),t}function _z(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=st().getNumber("WEBGL_MAX_TEXTURE_SIZE"),r=st().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");r===1/0&&st().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(r=n/2),t&&(n*=2,r*=2,1===(e=e.map((function(t,n){return n>=e.length-2?Ga.nearestLargerEven(e[n]):e[n]}))).length&&(e=[2,e[0]])),2!==e.length&&(e=Ga.squeezeShape(e).newShape);var a=Ga.sizeFromShape(e),i=null;e.length<=1&&a<=n?i=[1,a]:2===e.length&&e[0]<=n&&e[1]<=n?i=e:3===e.length&&e[0]*e[1]<=n&&e[2]<=n?i=[e[0]*e[1],e[2]]:3===e.length&&e[0]<=n&&e[1]*e[2]<=n?i=[e[0],e[1]*e[2]]:4===e.length&&e[0]*e[1]*e[2]<=n&&e[3]<=n?i=[e[0]*e[1]*e[2],e[3]]:4===e.length&&e[0]<=n&&e[1]*e[2]*e[3]<=n&&(i=[e[0],e[1]*e[2]*e[3]]);var o=null!=i&&Math.max.apply(Math,Object(S.a)(i))>r&&Math.min.apply(Math,Object(S.a)(i))<=(t?2:1)&&Math.min.apply(Math,Object(S.a)(i))>0;if(null==i||o)if(t){var s,u,c=Tz(e),l=2,d=2;e.length&&(s=Cz(e),l=(u=Object(y.a)(s,2))[0],d=u[1]),a=c*(l/2)*(d/2),i=Ga.sizeToSquarishShape(a).map((function(e){return 2*e}))}else i=Ga.sizeToSquarishShape(a);return i}function Az(e){return e%2===0}function Rz(e,t){if(e=e.slice(-2),t=t.slice(-2),Ga.arraysEqual(e,t)||!e.length||!t.length||0===e[0]||0===e[1]||0===t[0]||0===t[1])return!0;if(e.length!==t.length){var n=e[e.length-1],r=t[t.length-1];if(n===r||Az(n)&&Az(r)&&(1===e[0]||1===t[0]))return!0}return e[1]===t[1]&&Az(e[0])&&Az(t[0])}function Dz(e){if(null==nz){var t=HM(e);nz=t.getParameter(t.MAX_TEXTURE_SIZE)}return nz}function Fz(){nz=null}function Mz(){rz=null}function zz(e){if(null==rz){var t=HM(e);rz=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,rz)}function Lz(e){if(0===e)return 0;var t=HM(e);return Pz(t,"EXT_disjoint_timer_query_webgl2")&&2===e?2:Pz(t,"EXT_disjoint_timer_query")?1:0}function Pz(e,t){return null!=e.getExtension(t)}function Bz(e){try{if(null!=HM(e))return!0}catch(t){return console.log("Error when getting WebGL context: ",t),!1}return!1}function Wz(e){if(0===e)return!1;var t=HM(e);if(1===e){if(!Pz(t,"OES_texture_float"))return!1}else if(!Pz(t,"EXT_color_buffer_float"))return!1;return Vz(t)}function Uz(e){if(0===e)return!1;var t=HM(e);if(1!==e){if(Pz(t,"EXT_color_buffer_float"))return Vz(t);var n="EXT_color_buffer_half_float";if(Pz(t,n)){var r=t.getExtension(n);return function(e,t){var n=YM(e,t),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r);e.texImage2D(e.TEXTURE_2D,0,n.internalFormatHalfFloat,1,1,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);var a=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,a),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);var i=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(a),i}(t,r)}return!1}return!(!Pz(t,"OES_texture_float")||!Pz(t,"WEBGL_color_buffer_float"))&&Vz(t)}function Vz(e){var t=YM(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n);e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);var r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);var a=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(r),a}function Gz(e){return 2===e&&null!=HM(e).fenceSync}function Hz(e,t){Array.isArray(e)||(e=[e]),e.forEach((function(e){null!=e&&Ga.assert("complex64"!==e.dtype,(function(){return"".concat(t," does not support complex64 tensors in the WebGL backend.")}))}))}var qz=st();function Kz(){var e,t,n,r,a,i,o,s,u,c;return 2===st().getNumber("WEBGL_VERSION")?(e="#version 300 es",t="in",n="out",r="in",a="texture",i="outputColor",o="out vec4 outputColor;",s=st().getBool("WEBGL2_ISNAN_CUSTOM")?"\n      bool isnan_custom(float val) {\n        uint floatToUint = floatBitsToUint(val);\n        return (floatToUint & 0x7fffffffu) > 0x7f800000u;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ":"",u="",c="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(e="",t="attribute",n="varying",r="varying",a="texture2D",i="gl_FragColor",o="",s="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",u="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",c="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:a,output:i,defineOutput:o,defineSpecialNaN:s,defineSpecialInf:u,defineRound:c}}function Xz(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index",r=Ga.computeStrides(t);return r.map((function(t,a){var i="int ".concat(e[a]," = ").concat(n," / ").concat(t),o=a===r.length-1?"int ".concat(e[a+1]," = ").concat(n," - ").concat(e[a]," * ").concat(t):"index -= ".concat(e[a]," * ").concat(t);return"".concat(i,"; ").concat(o,";")})).join("")}function Yz(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index",r=Ga.computeStrides(t);return r.map((function(t,a){var i="int ".concat(e[a]," = ").concat(n," / outShapeStrides[").concat(a,"]"),o=a===r.length-1?"int ".concat(e[a+1]," = ").concat(n," - ").concat(e[a]," * outShapeStrides[").concat(a,"]"):"index -= ".concat(e[a]," * outShapeStrides[").concat(a,"]");return"".concat(i,"; ").concat(o,";")})).join("")}function Zz(e,t){var n=e.length,r=e.map((function(e){return"".concat(t,"[").concat(e,"]")})),a=new Array(n-1);a[n-2]=r[n-1];for(var i=n-3;i>=0;--i)a[i]="(".concat(a[i+1]," * ").concat(r[i+1],")");return a}function Jz(e){var t=Ga.computeStrides(e).map((function(e){return e.toString()}));return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * ".concat(t[0]," + coords.y * ").concat(t[1]," + coords.z;\n  }\n")}qz.registerFlag("HAS_WEBGL",(function(){return qz.getNumber("WEBGL_VERSION")>0})),qz.registerFlag("WEBGL_VERSION",(function(){return Bz(2)?2:Bz(1)?1:0})),qz.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",(function(){return!1})),qz.registerFlag("WEBGL_BUFFER_SUPPORTED",(function(){return 2===qz.get("WEBGL_VERSION")})),qz.registerFlag("WEBGL_CPU_FORWARD",(function(){return!0})),qz.registerFlag("WEBGL_FORCE_F16_TEXTURES",(function(){return!1})),qz.registerFlag("WEBGL_PACK",(function(){return qz.getBool("HAS_WEBGL")})),qz.registerFlag("WEBGL_PACK_NORMALIZATION",(function(){return qz.getBool("WEBGL_PACK")})),qz.registerFlag("WEBGL_PACK_CLIP",(function(){return qz.getBool("WEBGL_PACK")})),qz.registerFlag("WEBGL_PACK_DEPTHWISECONV",(function(){return qz.getBool("WEBGL_PACK")})),qz.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(function(){return qz.getBool("WEBGL_PACK")})),qz.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(function(){return qz.getBool("WEBGL_PACK")})),qz.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(function(){return qz.getBool("WEBGL_PACK")})),qz.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(function(){return qz.getBool("WEBGL_PACK")})),qz.registerFlag("WEBGL_PACK_REDUCE",(function(){return qz.getBool("WEBGL_PACK")})),qz.registerFlag("WEBGL_LAZILY_UNPACK",(function(){return qz.getBool("WEBGL_PACK")})),qz.registerFlag("WEBGL_CONV_IM2COL",(function(){return qz.getBool("WEBGL_PACK")})),qz.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(function(){return Dz(qz.getNumber("WEBGL_VERSION"))})),qz.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(function(){return zz(qz.getNumber("WEBGL_VERSION"))})),qz.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(function(){var e=qz.getNumber("WEBGL_VERSION");return 0===e?0:Lz(e)})),qz.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(function(){return qz.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!eo.isMobile()})),qz.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(function(){return Wz(qz.getNumber("WEBGL_VERSION"))})),qz.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(function(){return!qz.getBool("WEBGL_FORCE_F16_TEXTURES")&&qz.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")})),qz.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(function(){return Uz(qz.getNumber("WEBGL_VERSION"))})),qz.registerFlag("WEBGL_FENCE_API_ENABLED",(function(){return Gz(qz.getNumber("WEBGL_VERSION"))})),qz.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(function(){return qz.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0})),qz.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",(function(){return-1}),(function(e){if(e<0&&-1!==e)throw new Error("WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ".concat(e,"."))})),qz.registerFlag("WEBGL_FLUSH_THRESHOLD",(function(){return eo.isMobile()?1:-1}),(function(e){if(e<0&&-1!==e)throw new Error("WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ".concat(e,"."))})),qz.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",(function(){return 128})),qz.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",(function(){return!1})),qz.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",(function(){return 1e5})),qz.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",(function(){return 128})),qz.registerFlag("WEBGL_EXP_CONV",(function(){return!1})),qz.registerFlag("SOFTWARE_WEBGL_ENABLED",(function(){return qz.getBool("IS_TEST")})),qz.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",(function(){return 1/0})),qz.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",(function(){return!1})),qz.registerFlag("WEBGL2_ISNAN_CUSTOM",(function(){return!1})),qz.registerFlag("ENGINE_COMPILE_ONLY",(function(){return!1}));var Qz="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n",$z=Wm.getBroadcastDims;function eL(e,t,n){var r=[];if(e.forEach((function(e){var t=Ga.sizeFromShape(e.shapeInfo.logicalShape);if(e.shapeInfo.isUniform?r.push("uniform float ".concat(e.name).concat(t>1?"[".concat(t,"]"):"",";")):(r.push("uniform sampler2D ".concat(e.name,";")),r.push("uniform int offset".concat(e.name,";"))),n.enableShapeUniforms){switch(yL(n.packedInputs,e.shapeInfo.logicalShape,e.shapeInfo.texShape).uniformShape.length){case 1:r.push("uniform int ".concat(e.name,"Shape;"));break;case 2:r.push("uniform ivec2 ".concat(e.name,"Shape;"));break;case 3:r.push("uniform ivec3 ".concat(e.name,"Shape;"));break;case 4:r.push("uniform ivec4 ".concat(e.name,"Shape;"))}r.push("uniform ivec2 ".concat(e.name,"TexShape;"))}})),n.enableShapeUniforms){switch(t.logicalShape.length){case 1:r.push("uniform int outShape;");break;case 2:r.push("uniform ivec2 outShape;"),r.push("uniform int outShapeStrides;");break;case 3:r.push("uniform ivec3 outShape;"),r.push("uniform ivec2 outShapeStrides;");break;case 4:r.push("uniform ivec4 outShape;"),r.push("uniform ivec3 outShapeStrides;")}r.push("uniform ivec2 outTexShape;")}n.customUniforms&&n.customUniforms.forEach((function(e){r.push("uniform ".concat(e.type," ").concat(e.name).concat(e.arrayIndex?"[".concat(e.arrayIndex,"]"):"",";"))}));var a,i,o=r.join("\n"),s=e.map((function(e){return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0,a="";a+=n?nL(e,r):tL(e,r);var i=e.shapeInfo.logicalShape,o=t.logicalShape;return i.length<=o.length&&(a+=n?vL(e,t):bL(e,t)),a}(e,t,n.packedInputs,n.enableShapeUniforms)})).join("\n"),u=t.texShape,c=Kz(),l=function(e){return"\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return ".concat(e.texture2D,"(textureSampler, uv).r;\n    }\n  ")}(c),d=function(e){return"".concat(e.version,"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    ").concat(e.varyingFs," vec2 resultUV;\n    ").concat(e.defineOutput,"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    ").concat(e.defineSpecialNaN,"\n    ").concat(e.defineSpecialInf,"\n    ").concat(e.defineRound,"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    ").concat(rL,"\n    ").concat(aL,"\n    ").concat(iL,"\n  ")}(c);return t.isPacked?(a=function(e,t,n){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t,n){var r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];return 1===r[0]?n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));\n      }\n    ":"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ".concat(r[1],".0);\n      }\n    "):1===r[1]?n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));\n      }\n    ":"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ".concat(r[0],".0);\n      }\n    "):n?"\n    int getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);\n    }\n  ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(r[0],", ").concat(r[1],"));\n      return 2 * (resTexRC.x * ").concat(r[1]," + resTexRC.y);\n    }\n  ")}(0,t,n);case 2:return function(e,t,n){var r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(Ga.arraysEqual(e,t))return n?"\n      ivec2 getOutputCoords() {\n        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2(".concat(r[0],", ").concat(r[1],"));\n      }\n    ");var a=Math.ceil(e[1]/2);return n?"\n    ivec2 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec2(r, c);\n    }\n  ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(r[0],", ").concat(r[1],"));\n\n      int index = resTexRC.x * ").concat(r[1]," + resTexRC.y;\n      int r = 2 * (index / ").concat(a,");\n      int c = imod(index, ").concat(a,") * 2;\n\n      return ivec2(r, c);\n    }\n  ")}(e,t,n);case 3:return function(e,t,n){if(n)return"\n    ivec3 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";var r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],a=Math.ceil(e[2]/2),i=a*Math.ceil(e[1]/2);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(r[0],", ").concat(r[1],"));\n      int index = resTexRC.x * ").concat(r[1]," + resTexRC.y;\n\n      int b = index / ").concat(i,";\n      index -= b * ").concat(i,";\n\n      int r = 2 * (index / ").concat(a,");\n      int c = imod(index, ").concat(a,") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ")}(e,t,n);default:return function(e,t,n){if(n)return"\n    ivec4 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatchN = texelsInBatch * outShape[1];\n\n      int b2 = index / texelsInBatchN;\n      index -= b2 * texelsInBatchN;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec4(b2, b, r, c);\n    }\n  ";for(var r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],a=Math.ceil(e[e.length-1]/2),i=a*Math.ceil(e[e.length-2]/2),o=i,s="",u="b, r, c",c=2;c<e.length-1;c++)o*=e[e.length-c-1],s="\n      int b".concat(c," = index / ").concat(o,";\n      index -= b").concat(c," * ").concat(o,";\n    ")+s,u="b".concat(c,", ")+u;return"\n    ivec".concat(e.length," getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(").concat(r[0],", ").concat(r[1],"));\n      int index = resTexRC.x * ").concat(r[1]," + resTexRC.y;\n\n      ").concat(s,"\n\n      int b = index / ").concat(i,";\n      index -= b * ").concat(i,";\n\n      int r = 2 * (index / ").concat(a,");\n      int c = imod(index, ").concat(a,") * 2;\n\n      return ivec").concat(e.length,"(").concat(u,");\n    }\n  ")}(e,t,n)}}(t.logicalShape,u,n.enableShapeUniforms),i=function(e){return"\n    void setOutput(vec4 val) {\n      ".concat(e.output," = val;\n    }\n  ")}(c)):(a=function(e,t,n){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t,n){return 1===t[0]?n?"\n      int getOutputCoords() {\n        return int(resultUV.x * float(outTexShape[1]));\n      }\n    ":"\n      int getOutputCoords() {\n        return int(resultUV.x * ".concat(t[1],".0);\n      }\n    "):1===t[1]?n?"\n      int getOutputCoords() {\n        return int(resultUV.y * float(outTexShape[0]));\n      }\n    ":"\n      int getOutputCoords() {\n        return int(resultUV.y * ".concat(t[0],".0);\n      }\n    "):n?"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      return resTexRC.x * outTexShape[1] + resTexRC.y;\n    }\n  ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      return resTexRC.x * ").concat(t[1]," + resTexRC.y;\n    }\n  ")}(0,t,n);case 2:return function(e,t,n){return Ga.arraysEqual(e,t)?n?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(".concat(t[0],", ").concat(t[1],"));\n      }\n    "):1===e[1]?n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(".concat(t[0],", ").concat(t[1],"));\n        int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    "):1===e[0]?n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(".concat(t[0],", ").concat(t[1],"));\n        int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n        return ivec2(0, index);\n      }\n    "):n?"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      int r = index / outShape[1];\n      int c = index - r * outShape[1];\n      return ivec2(r, c);\n    }\n  ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      int r = index / ").concat(e[1],";\n      int c = index - r * ").concat(e[1],";\n      return ivec2(r, c);\n    }\n  ")}(e,t,n);case 3:return function(e,t,n){if(n)return"\n  ivec3 getOutputCoords() {\n    ivec2 resTexRC = ivec2(resultUV.yx *\n                           vec2(outTexShape[0], outTexShape[1]));\n    int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n    ".concat(Yz(["r","c","d"],e),"\n    return ivec3(r, c, d);\n  }\n");var r=Xz(["r","c","d"],e);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      ").concat(r,"\n      return ivec3(r, c, d);\n    }\n  ")}(e,t,n);case 4:return function(e,t,n){if(n)return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      ".concat(Yz(["r","c","d","d2"],e),"\n      return ivec4(r, c, d, d2);\n    }\n  ");var r=Xz(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      ").concat(r,"\n      return ivec4(r, c, d, d2);\n    }\n  ")}(e,t,n);case 5:return function(e,t){var n=Xz(["r","c","d","d2","d3"],e);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2(".concat(t[0],",\n                             ").concat(t[1],"));\n\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n\n      ").concat(n,"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  ")}(e,t);case 6:return function(e,t){var n=Xz(["r","c","d","d2","d3","d4"],e);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n\n      ").concat(n,"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  ")}(e,t);default:throw new Error("".concat(e.length,"-D output sampling is not yet supported"))}}(t.logicalShape,u,n.enableShapeUniforms),i=function(e){return"\n    void setOutput(float val) {\n      ".concat(e.output," = vec4(val, 0, 0, 0);\n    }\n  ")}(c)),n.packedInputs&&(d+=oL),[d,l,i,o,a,s,n.userCode].join("\n")}function tL(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.shapeInfo.logicalShape;switch(n.length){case 0:return uL(e,t);case 1:return cL(e,t);case 2:return lL(e,t);case 3:return dL(e,t);case 4:return pL(e,t);case 5:return fL(e);case 6:return hL(e);default:throw new Error("".concat(n.length,"-D input sampling is not yet supported"))}}function nL(e,t){switch(e.shapeInfo.logicalShape.length){case 0:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=Kz();return"\n    vec4 ".concat(n,"() {\n      return ").concat(r.texture2D,"(").concat(t,", halfCR);\n    }\n  ")}(e);case 1:return function(e,t){var n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=e.shapeInfo.texShape,i=Kz();if(t)return"\n    vec4 ".concat(r,"(int index) {\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(n,"TexShape[0]) / 2.0), ceil(float(").concat(n,"TexShape[1]) / 2.0));\n      vec2 uv = packedUVfrom1D(\n        packedTexShape[0], packedTexShape[1], index);\n      return ").concat(i.texture2D,"(").concat(n,", uv);\n    }\n  ");var o=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];return"\n    vec4 ".concat(r,"(int index) {\n      vec2 uv = packedUVfrom1D(\n        ").concat(o[0],", ").concat(o[1],", index);\n      return ").concat(i.texture2D,"(").concat(n,", uv);\n    }\n  ")}(e,t);case 2:return function(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape,o=i[0],s=i[1],u=Kz();if(null!=i&&Ga.arraysEqual(n,i))return t?"\n      vec4 ".concat(a,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n\n        return ").concat(u.texture2D,"(").concat(r,", uv);\n      }\n    "):"\n      vec4 ".concat(a,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(s,".0, ").concat(o,".0);\n\n        return ").concat(u.texture2D,"(").concat(r,", uv);\n      }\n    ");if(t)return"\n    vec4 ".concat(a,"(int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(r,"TexShape[0]) / 2.0), ceil(float(").concat(r,"TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(").concat(r,"Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);\n      return ").concat(u.texture2D,"(").concat(r,", uv);\n    }\n  ");var c=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],l=Math.ceil(n[1]/2);return"\n    vec4 ".concat(a,"(int row, int col) {\n      vec2 uv = packedUVfrom2D(").concat(l,", ").concat(c[0],", ").concat(c[1],", row, col);\n      return ").concat(u.texture2D,"(").concat(r,", uv);\n    }\n  ")}(e,t);case 3:return function(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape,o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(1===n[0]){var s=n.slice(1),u=xL(e,s);return"\n        ".concat(nL(u,t),"\n        vec4 ").concat(a,"(int b, int row, int col) {\n          return ").concat(a,"(").concat(kL(["b","row","col"],[1,2]),");\n        }\n      ")}var c=Kz();if(t)return"\n    vec4 ".concat(a,"(int b, int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(r,"TexShape[0]) / 2.0), ceil(float(").concat(r,"TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(").concat(r,"Shape[2]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(").concat(r,"Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom3D(\n        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);\n      return ").concat(c.texture2D,"(").concat(r,", uv);\n    }\n  ");var l=o[0],d=o[1],p=Math.ceil(n[2]/2),f=p*Math.ceil(n[1]/2);return"\n    vec4 ".concat(a,"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        ").concat(l,", ").concat(d,", ").concat(f,", ").concat(p,", b, row, col);\n      return ").concat(c.texture2D,"(").concat(r,", uv);\n    }\n  ")}(e,t);default:return function(e,t){var n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=Kz();if(t)return"\n    vec4 ".concat(r,"(int b2, int b, int row, int col) {\n      int valuesPerRow = int(ceil(float(").concat(n,"Shape[3]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(").concat(n,"Shape[2]) / 2.0));\n      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);\n      texelsInBatch *= ").concat(n,"Shape[1];\n      index = b2 * texelsInBatch + index;\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(n,"TexShape[0]) / 2.0), ceil(float(").concat(n,"TexShape[1]) / 2.0));\n      int texR = index / packedTexShape[1];\n      int texC = index - texR * packedTexShape[1];\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ").concat(a.texture2D,"(").concat(n,", uv);\n    }\n  ");for(var i=e.shapeInfo.logicalShape,o=i.length,s=e.shapeInfo.texShape,u=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],c=u[0],l=u[1],d=Math.ceil(i[o-1]/2),p=d*Math.ceil(i[o-2]/2),f="int b, int row, int col",h="b * ".concat(p," + (row / 2) * ").concat(d," + (col / 2)"),m=2;m<o-1;m++)f="int b".concat(m,", ")+f,p*=i[o-m-1],h="b".concat(m," * ").concat(p," + ")+h;return"\n    vec4 ".concat(r,"(").concat(f,") {\n      int index = ").concat(h,";\n      int texR = index / ").concat(l,";\n      int texC = index - texR * ").concat(l,";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(l,", ").concat(c,");\n      return ").concat(a.texture2D,"(").concat(n,", uv);\n    }\n  ")}(e,t)}}var rL="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",aL="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",iL="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",oL="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function sL(e){return"offset".concat(e)}function uL(e,t){var n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return"float ".concat(r,"() {return ").concat(n,";}");var a=Object(y.a)(e.shapeInfo.texShape,2),i=a[0],o=a[1];if(1===i&&1===o)return"\n      float ".concat(r,"() {\n        return sampleTexture(").concat(n,", halfCR);\n      }\n    ");var s=sL(n);if(t)return"\n    float ".concat(r,"() {\n      vec2 uv = uvFromFlat(").concat(n,"TexShape[0], ").concat(n,"TexShape[1], ").concat(s,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ");var u=Object(y.a)(e.shapeInfo.texShape,2),c=u[0],l=u[1];return"\n    float ".concat(r,"() {\n      vec2 uv = uvFromFlat(").concat(c,", ").concat(l,", ").concat(s,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}function cL(e,t){var n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int index) {\n        ").concat(mL(e),"\n      }\n    ");var a=e.shapeInfo.texShape,i=a[0],o=a[1];if(1===o&&1===i)return"\n      float ".concat(r,"(int index) {\n        return sampleTexture(").concat(n,", halfCR);\n      }\n    ");var s=sL(n);return 1===o?t?"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2(0.5, (float(index + ").concat(s,") + 0.5) / float(").concat(n,"TexShape[0]));\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2(0.5, (float(index + ").concat(s,") + 0.5) / ").concat(i,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):1===i?t?"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2((float(index + ").concat(s,") + 0.5) / float(").concat(n,"TexShape[1]), 0.5);\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2((float(index + ").concat(s,") + 0.5) / ").concat(o,".0, 0.5);\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):t?"\n    float ".concat(r,"(int index) {\n      vec2 uv = uvFromFlat(").concat(n,"TexShape[0], ").concat(n,"TexShape[1], index + ").concat(s,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  "):"\n    float ".concat(r,"(int index) {\n      vec2 uv = uvFromFlat(").concat(i,", ").concat(o,", index + ").concat(s,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}function lL(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape;if(null!=i&&Ga.arraysEqual(n,i)){if(t)return"\n      float ".concat(a,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    ");var o=i[0],s=i[1];return"\n    float ".concat(a,"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(s,".0, ").concat(o,".0);\n      return sampleTexture(").concat(r,", uv);\n    }\n  ")}var u=Ga.squeezeShape(n),c=u.newShape,l=u.keptDims,d=c;if(d.length<n.length){var p=xL(e,d);return"\n      ".concat(tL(p,t),"\n      float ").concat(a,"(int row, int col) {\n        return ").concat(a,"(").concat(kL(["row","col"],l),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(a,"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2(").concat(n[1],", 1)));\n        ").concat(mL(e),"\n      }\n    ");var f=i[0],h=i[1],m=sL(r);return 1===h?t?"\n      float ".concat(a,"(int row, int col) {\n        float index = dot(vec3(row, col, ").concat(m,"), vec3(").concat(r,"Shape[1], 1, 1));\n        vec2 uv = vec2(0.5, (index + 0.5) / float(").concat(r,"TexShape[0]));\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n    float ".concat(a,"(int row, int col) {\n      float index = dot(vec3(row, col, ").concat(m,"), vec3(").concat(n[1],", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / ").concat(f,".0);\n      return sampleTexture(").concat(r,", uv);\n    }\n  "):1===f?t?"\n      float ".concat(a,"(int row, int col) {\n        float index = dot(vec3(row, col, ").concat(m,"), vec3(").concat(r,"Shape[1], 1, 1));\n        vec2 uv = vec2((index + 0.5) / float(").concat(r,"TexShape[1]), 0.5);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n    float ".concat(a,"(int row, int col) {\n      float index = dot(vec3(row, col, ").concat(m,"), vec3(").concat(n[1],", 1, 1));\n      vec2 uv = vec2((index + 0.5) / ").concat(h,".0, 0.5);\n      return sampleTexture(").concat(r,", uv);\n    }\n  "):t?"\n      float ".concat(a,"(int row, int col) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ").concat(r,"Shape[1] + col + ").concat(m,";\n        vec2 uv = uvFromFlat(").concat(r,"TexShape[0], ").concat(r,"TexShape[1], index);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n  float ".concat(a,"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * ").concat(n[1]," + col + ").concat(m,";\n    vec2 uv = uvFromFlat(").concat(f,", ").concat(h,", index);\n    return sampleTexture(").concat(r,", uv);\n  }\n")}function dL(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n[1]*n[2],o=n[2],s=Ga.squeezeShape(n),u=s.newShape,c=s.keptDims,l=u;if(l.length<n.length){var d=xL(e,l);return"\n        ".concat(tL(d,t),"\n        float ").concat(a,"(int row, int col, int depth) {\n          return ").concat(a,"(").concat(kL(["row","col","depth"],c),");\n        }\n      ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(a,"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3(").concat(i,", ").concat(o,", 1)));\n        ").concat(mL(e),"\n      }\n    ");var p=e.shapeInfo.texShape,f=p[0],h=p[1],m=e.shapeInfo.flatOffset;if(h===i&&null==m)return t?"\n      float ".concat(a,"(int row, int col, int depth) {\n        int stride1 = ").concat(r,"Shape[2];\n        float texR = float(row);\n        float texC = dot(vec2(col, depth), vec2(stride1, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n        float ".concat(a,"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2(").concat(o,", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2(").concat(h,".0, ").concat(f,".0);\n          return sampleTexture(").concat(r,", uv);\n        }\n      ");if(h===o&&null==m)return t?"\n      float ".concat(a,"(int row, int col, int depth) {\n        float texR = dot(vec2(row, col), vec2(").concat(r,"Shape[1], 1));\n        float texC = float(depth);\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n    float ".concat(a,"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2(").concat(n[1],", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(h,".0, ").concat(f,".0);\n      return sampleTexture(").concat(r,", uv);\n    }\n  ");var v=sL(r);return t?"\n    float ".concat(a,"(int row, int col, int depth) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int stride0 = ").concat(r,"Shape[1] * ").concat(r,"Shape[2];\n      int stride1 = ").concat(r,"Shape[2];\n      int index = row * stride0 + col * stride1 + depth + ").concat(v,";\n      vec2 uv = uvFromFlat(").concat(r,"TexShape[0], ").concat(r,"TexShape[1], index);\n      return sampleTexture(").concat(r,", uv);\n    }\n    "):"\n      float ".concat(a,"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ").concat(i," + col * ").concat(o," + depth + ").concat(v,";\n        vec2 uv = uvFromFlat(").concat(f,", ").concat(h,", index);\n        return sampleTexture(").concat(r,", uv);\n      }\n  ")}function pL(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n[3],o=n[2]*i,s=n[1]*o,u=Ga.squeezeShape(n),c=u.newShape,l=u.keptDims;if(c.length<n.length){var d=xL(e,c);return"\n      ".concat(tL(d,t),"\n      float ").concat(a,"(int row, int col, int depth, int depth2) {\n        return ").concat(a,"(").concat(kL(["row","col","depth","depth2"],l),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4(").concat(s,", ").concat(o,", ").concat(i,", 1)));\n        ").concat(mL(e),"\n      }\n    ");var p=e.shapeInfo.flatOffset,f=e.shapeInfo.texShape,h=f[0],m=f[1],v="int stride2 = ".concat(r,"Shape[3];"),b="int stride1 = ".concat(r,"Shape[2] * stride2;"),g="int stride0 = ".concat(r,"Shape[1] * stride1;");if(m===s&&null==p)return t?"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        ").concat(v,"\n        ").concat(b,"\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(stride1, stride2, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(").concat(o,", ").concat(i,", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(m,".0, ").concat(h,".0);\n        return sampleTexture(").concat(r,", uv);\n      }\n    ");if(m===i&&null==p)return t?"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(").concat(r,"Shape[1] * ").concat(r,"Shape[2], ").concat(r,"Shape[2], 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(").concat(n[1]*n[2],", ").concat(n[2],", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(m,".0, ").concat(h,".0);\n        return sampleTexture(").concat(r,", uv);\n      }\n    ");var y=sL(r);return t?"\n    float ".concat(a,"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      ").concat(v,"\n      ").concat(b,"\n      ").concat(g,"\n      int index = row * stride0 + col * stride1 +\n          depth * stride2 + depth2;\n      vec2 uv = uvFromFlat(").concat(r,"TexShape[0], ").concat(r,"TexShape[1], index + ").concat(y,");\n      return sampleTexture(").concat(r,", uv);\n    }\n  "):"\n    float ".concat(a,"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(s," + col * ").concat(o," +\n          depth * ").concat(i," + depth2;\n      vec2 uv = uvFromFlat(").concat(h,", ").concat(m,", index + ").concat(y,");\n      return sampleTexture(").concat(r,", uv);\n    }\n  ")}function fL(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=t[4],i=t[3]*a,o=t[2]*i,s=t[1]*o,u=Ga.squeezeShape(t),c=u.newShape,l=u.keptDims;if(c.length<t.length){var d=xL(e,c);return"\n      ".concat(tL(d),"\n      float ").concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        return ").concat(r,"(").concat(kL(["row","col","depth","depth2","depth3"],l),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(s,", ").concat(o,", ").concat(i,", ").concat(a,")) +\n          depth3;\n        ").concat(mL(e),"\n      }\n    ");var p=e.shapeInfo.flatOffset,f=e.shapeInfo.texShape,h=f[0],m=f[1];if(m===s&&null==p)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4(").concat(o,", ").concat(i,", ").concat(a,", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(m,".0, ").concat(h,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(m===a&&null==p)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(t[1]*t[2]*t[3],",\n               ").concat(t[2]*t[3],", ").concat(t[3],", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(m,".0, ").concat(h,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");var v=sL(n);return"\n    float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(s," + col * ").concat(o," + depth * ").concat(i," +\n          depth2 * ").concat(a," + depth3 + ").concat(v,";\n      vec2 uv = uvFromFlat(").concat(h,", ").concat(m,", index);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}function hL(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=Ga.squeezeShape(t),i=a.newShape,o=a.keptDims;if(i.length<t.length){var s=xL(e,i);return"\n      ".concat(tL(s),"\n      float ").concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return ").concat(r,"(").concat(kL(["row","col","depth","depth2","depth3","depth4"],o),");\n      }\n    ")}var u=t[5],c=t[4]*u,l=t[3]*c,d=t[2]*l,p=t[1]*d;if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(p,", ").concat(d,", ").concat(l,", ").concat(c,")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2(").concat(u,", 1)));\n        ").concat(mL(e),"\n      }\n    ");var f=e.shapeInfo.flatOffset,h=e.shapeInfo.texShape,m=h[0],v=h[1];if(v===p&&null==f)return"\n      float ".concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4(").concat(d,", ").concat(l,", ").concat(c,", ").concat(u,")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(v,".0, ").concat(m,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(v===u&&null==f)return"\n      float ".concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4(").concat(t[1]*t[2]*t[3]*t[4],",\n               ").concat(t[2]*t[3]*t[4],",\n               ").concat(t[3]*t[4],",\n               ").concat(t[4],")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(v,".0, ").concat(m,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");var b=sL(n);return"\n    float ".concat(r,"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(p," + col * ").concat(d," + depth * ").concat(l," +\n          depth2 * ").concat(c," + depth3 * ").concat(u," + depth4 + ").concat(b,";\n      vec2 uv = uvFromFlat(").concat(m,", ").concat(v,", index);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}function mL(e){var t=e.name,n=Ga.sizeFromShape(e.shapeInfo.logicalShape);return n<2?"return ".concat(t,";"):"\n    for (int i = 0; i < ".concat(n,"; i++) {\n      if (i == index) {\n        return ").concat(t,"[i];\n      }\n    }\n  ")}function vL(e,t){var n,r=e.name,a=r.charAt(0).toUpperCase()+r.slice(1),i="get"+a+"AtOutCoords",o=e.shapeInfo.logicalShape.length,s=t.logicalShape.length,u=$z(e.shapeInfo.logicalShape,t.logicalShape),c=gL(s),l=s-o,d=["x","y","z","w","u","v"];n=0===o?"":s<2&&u.length>=1?"coords = 0;":u.map((function(e){return"coords.".concat(d[e+l]," = 0;")})).join("\n");var p="";p=s<2&&o>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords.".concat(d[t+l])})).join(", ");var f="return outputValue;",h=1===Ga.sizeFromShape(e.shapeInfo.logicalShape),m=1===Ga.sizeFromShape(t.logicalShape);if(1!==o||h||m){if(h&&!m)f=1===s?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(u.length){var v=o-2,b=o-1;u.indexOf(v)>-1&&u.indexOf(b)>-1?f="return vec4(outputValue.x);":u.indexOf(v)>-1?f="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":u.indexOf(b)>-1&&(f="return vec4(outputValue.xx, outputValue.zz);")}}else f="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 ".concat(i,"() {\n      ").concat(c," coords = getOutputCoords();\n      ").concat(n,"\n      vec4 outputValue = get").concat(a,"(").concat(p,");\n      ").concat(f,"\n    }\n  ")}function bL(e,t){var n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),a="get"+r+"AtOutCoords",i=t.texShape,o=e.shapeInfo.texShape,s=e.shapeInfo.logicalShape.length,u=t.logicalShape.length;if(!e.shapeInfo.isUniform&&s===u&&null==e.shapeInfo.flatOffset&&Ga.arraysEqual(o,i))return"\n      float ".concat(a,"() {\n        return sampleTexture(").concat(n,", resultUV);\n      }\n    ");var c,l=gL(u),d=$z(e.shapeInfo.logicalShape,t.logicalShape),p=u-s,f=["x","y","z","w","u","v"];c=0===s?"":u<2&&d.length>=1?"coords = 0;":d.map((function(e){return"coords.".concat(f[e+p]," = 0;")})).join("\n");var h="";return h=u<2&&s>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords.".concat(f[t+p])})).join(", "),"\n    float ".concat(a,"() {\n      ").concat(l," coords = getOutputCoords();\n      ").concat(c,"\n      return get").concat(r,"(").concat(h,");\n    }\n  ")}function gL(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error("GPU for rank ".concat(e," is not yet supported"))}function yL(e,t,n){var r=Ga.squeezeShape(t),a=r.newShape,i=r.keptDims,o=t.length,s=e&&3===o&&1===t[0],u=s?t.slice(1):a,c=!e&&o>1&&!Ga.arraysEqual(t,n)&&a.length<o||s;return{useSqueezeShape:c,uniformShape:c?u:t,keptDims:i}}function xL(e,t){var n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function kL(e,t){return t.map((function(t){return e[t]})).join(", ")}function wL(e,t,n,r){var a=n.map((function(e,n){var r={logicalShape:e.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform,isPacked:!e.isUniform&&e.texData.isPacked,flatOffset:null};return null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0&&(r.flatOffset=e.texData.slice.flatOffset),{name:t.variableNames[n],shapeInfo:r}})),i=a.map((function(e){return e.shapeInfo})),o={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},s=eL(a,o,t),u=tz(e.gl,s),c=e.createProgram(u);return st().get("ENGINE_COMPILE_ONLY")?{program:t,fragmentShader:u,source:s,webGLProgram:c,inShapeInfos:i,outShapeInfo:o,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(e.buildVao(c),Object.assign({program:t,fragmentShader:u,source:s,webGLProgram:c,inShapeInfos:i,outShapeInfo:o},OL(e,t,c)))}function OL(e,t,n){var r,a,i,o,s=[],u=[],c=null;o=e.getUniformLocation(n,"NAN",!1),1===st().getNumber("WEBGL_VERSION")&&(c=e.getUniformLocation(n,"INFINITY",!1));var l,d=!1,p=Object(N.a)(t.variableNames);try{for(p.s();!(l=p.n()).done;){var f=l.value,h={name:f,uniform:e.getUniformLocation(n,f,d),offset:e.getUniformLocation(n,"offset".concat(f),d)};t.enableShapeUniforms&&(h.shape=e.getUniformLocation(n,"".concat(f,"Shape"),d),h.texShape=e.getUniformLocation(n,"".concat(f,"TexShape"),d)),s.push(h)}}catch(g){p.e(g)}finally{p.f()}if(t.enableShapeUniforms&&(r=e.getUniformLocation(n,"outShape",d),i=e.getUniformLocation(n,"outShapeStrides",d),a=e.getUniformLocation(n,"outTexShape",d)),t.customUniforms){var m,v=Object(N.a)(t.customUniforms);try{for(v.s();!(m=v.n()).done;){var b=m.value;u.push(e.getUniformLocation(n,b.name,d))}}catch(g){v.e(g)}finally{v.f()}}return{variablesLocations:s,customUniformLocations:u,infLoc:c,nanLoc:o,outShapeLocation:r,outShapeStridesLocation:i,outTexShapeLocation:a}}function IL(e,t){if(e.length!==t.length)throw Error("Binary was compiled with ".concat(e.length," inputs, but was executed with ").concat(t.length," inputs"));e.forEach((function(e,n){var r=e.logicalShape,a=t[n],i=a.shape;if(!Ga.arraysEqual(r,i))throw Error("Binary was compiled with different shapes than the current args. Shapes ".concat(r," and ").concat(i," must match"));if(!e.isUniform||!a.isUniform){var o=e.texShape,s=a.isUniform?null:a.texData.texShape;if(!Ga.arraysEqual(o,s))throw Error("Binary was compiled with different texture shapes than the current args. Shape ".concat(o," and ").concat(s," must match"))}}))}function SL(e,t,n,r,a){t.program.enableShapeUniforms||(IL(t.inShapeInfos,n),IL([t.outShapeInfo],[r]));var i=r.texData.texture,o=r.texData.texShape;r.texData.isPacked?e.setOutputPackedMatrixTexture(i.texture,o[0],o[1]):e.setOutputMatrixTexture(i.texture,o[0],o[1]),e.setProgram(t.webGLProgram),e.bindVertexArray(t.webGLProgram.vao),1===st().getNumber("WEBGL_VERSION")&&null!==t.infLoc&&e.gl.uniform1f(t.infLoc,1/0),null!==t.nanLoc&&e.gl.uniform1f(t.nanLoc,NaN);for(var s=0;s<n.length;++s){var u=n[s],c=t.variablesLocations[s],l=c.uniform,d=c.offset,p=c.shape,f=c.texShape;if(p){var h=yL(t.program.packedInputs,u.shape,u.texData.texShape).uniformShape;switch(h.length){case 1:e.gl.uniform1iv(p,new Int32Array(h));break;case 2:e.gl.uniform2iv(p,new Int32Array(h));break;case 3:e.gl.uniform3iv(p,new Int32Array(h));break;case 4:e.gl.uniform4iv(p,new Int32Array(h))}}if(f&&e.gl.uniform2i(f,u.texData.texShape[0],u.texData.texShape[1]),null!=l){if(u.isUniform){if(Ga.sizeFromShape(u.shape)<2)e.gl.uniform1f(l,u.uniformValues[0]);else{var m=u.uniformValues;m instanceof Float32Array||(m=new Float32Array(m)),e.gl.uniform1fv(l,m)}continue}null!=u.texData.slice&&null!=d&&e.gl.uniform1i(d,u.texData.slice.flatOffset),e.setInputMatrixTexture(u.texData.texture.texture,l,s)}}var v=t.outShapeLocation;if(v)switch(r.shape.length){case 1:e.gl.uniform1iv(v,new Int32Array(r.shape));break;case 2:e.gl.uniform2iv(v,new Int32Array(r.shape));break;case 3:e.gl.uniform3iv(v,new Int32Array(r.shape));break;case 4:e.gl.uniform4iv(v,new Int32Array(r.shape))}if(t.outShapeStridesLocation){var b=Ga.computeStrides(r.shape);switch(r.shape.length){case 2:e.gl.uniform1iv(t.outShapeStridesLocation,new Int32Array(b));break;case 3:e.gl.uniform2iv(t.outShapeStridesLocation,new Int32Array(b));break;case 4:e.gl.uniform3iv(t.outShapeStridesLocation,new Int32Array(b))}}if(t.outTexShapeLocation&&e.gl.uniform2i(t.outTexShapeLocation,r.texData.texShape[0],r.texData.texShape[1]),t.program.customUniforms&&a)for(var g=0;g<t.program.customUniforms.length;++g){var y=t.program.customUniforms[g],x=t.customUniformLocations[g],k=a[g];if("float"===y.type)e.gl.uniform1fv(x,k);else if("vec2"===y.type)e.gl.uniform2fv(x,k);else if("vec3"===y.type)e.gl.uniform3fv(x,k);else if("vec4"===y.type)e.gl.uniform4fv(x,k);else if("int"===y.type)e.gl.uniform1iv(x,k);else if("ivec2"===y.type)e.gl.uniform2iv(x,k);else if("ivec3"===y.type)e.gl.uniform3iv(x,k);else{if("ivec4"!==y.type)throw Error("uniform type ".concat(y.type," is not supported yet."));e.gl.uniform4iv(x,k)}}e.executeProgram()}function NL(e,t,n){var r="";t.concat(n).forEach((function(t){var a=null!=t.texData&&null!=t.texData.slice&&t.texData.slice.flatOffset>0;if(e.enableShapeUniforms&&!t.isUniform){var i=t.texData.texShape,o=yL(e.packedInputs,t.shape,i),s=o.useSqueezeShape,u=o.uniformShape,c=o.keptDims,l="",d="",p="";if(1===u.length&&e.packedInputs){var f=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];l="".concat(f[0]>1,"_").concat(f[1]>1)}else if(2!==u.length||e.packedInputs){if(u.length>2&&!e.packedInputs){var h=Ga.computeStrides(u);p="".concat(h[0]===i[1],"_").concat(h[h.length-1]===i[1])}}else d="".concat(u[0]>1,"_").concat(u[1]>1);var m=t.shape.length,v=2===u.length&&Ga.arraysEqual(t.shape,i),b=1===Ga.sizeFromShape(t.shape),g=Wm.getBroadcastDims(t.shape,n.shape),y=!e.packedInputs&&m===n.shape.length&&Ga.arraysEqual(i,n.texData.texShape),x=e.packedInputs||u.length>2?"":"".concat(i[0]>1,"_").concat(i[1]>1);r+="".concat(m,"_").concat(y,"_").concat(s?c:"","_").concat(u.length,"_").concat(b,"_").concat(g,"_").concat(v,"_").concat(l,"_").concat(d,"_").concat(p,"_").concat(x,"_").concat(a)}else{var k=t.isUniform?"uniform":t.texData.texShape;r+="".concat(t.shape,"_").concat(k,"_").concat(a)}}));var a=e.userCode,i=e.constructor.name;return i+="_"+r+"_"+a+"".concat(st().getNumber("WEBGL_VERSION"))}function jL(e){return st().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&e<=4}var TL=function e(t){Object(O.a)(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=PM.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];var n=Kz();this.outputShape=t,this.enableShapeUniforms=jL(this.outputShape.length),this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ".concat(this.enableShapeUniforms?Yz(["r","c","d"],t):Xz(["r","c","d"],t),"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        ").concat(n.output," = result;\n      }\n    ")},CL=function e(t){Object(O.a)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=PM.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];var n=Kz();this.outputShape=t,this.enableShapeUniforms=jL(this.outputShape.length),this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ".concat(this.enableShapeUniforms?Yz(["r","c","d"],t):Xz(["r","c","d"],t),"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        ").concat(n.output," = result;\n      }\n    ")},EL=function e(t){Object(O.a)(this,e),this.variableNames=["A"],this.outTexUsage=BM.DOWNLOAD;var n=Kz();this.outputShape=t,this.userCode="\n      ".concat(Qz,"\n\n      void main() {\n        float x = getAAtOutCoords();\n        ").concat(n.output," = encode_float(x);\n      }\n    ")},_L=function e(t){Object(O.a)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=BM.DOWNLOAD;var n=Kz();this.outputShape=t,this.userCode="\n      ".concat(Qz,"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        ").concat(n.output," = encode_float(x);\n      }\n    ")},AL={R:0,G:1,B:2,A:3},RL=function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"RGBA";Object(O.a)(this,e),this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];var a=Kz();this.outputShape=t,this.enableShapeUniforms=jL(this.outputShape.length);var i="result";n&&(i="floor(result * 255. + 0.5)");for(var o="",s=0;s<r.length;s++){var u=r[s];o+="\n          if(offset == ".concat(s,") {\n            result = values[").concat(AL[u],"];\n          }")}this.userCode="\n      ".concat(this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":Jz(t),"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int flatIndex = getFlatIndex(coords);\n        float result = 0.;\n        int offset = imod(flatIndex, ").concat(r.length,");\n\n        flatIndex = idiv(flatIndex, ").concat(r.length,", 1.);\n\n        int r = flatIndex / texShape[1];\n        if (r < texShape[0]) {\n          int c = imod(flatIndex, texShape[1]);\n          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n          vec4 values = ").concat(a.texture2D,"(A, uv);\n          ").concat(o,"\n        }\n        ").concat(a.output," = vec4(").concat(i,", 0., 0., 0.);\n      }\n    ")},DL=function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Object(O.a)(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];var r=Kz();this.outputShape=t,this.enableShapeUniforms=jL(this.outputShape.length);var a="",i="result";n&&(i="floor(result * 255. + 0.5)");for(var o=0;o<=1;o++)for(var s=0;s<=1;s++){var u=2*o+s;a+="\n          localCoords = coords;\n          if(localCoords[2] + ".concat(s," < ").concat(this.enableShapeUniforms?"outShape[2]":"".concat(t[2]),") {\n          localCoords[2] += ").concat(s,";\n          if (localCoords[1] + ").concat(o," < ").concat(this.enableShapeUniforms?"outShape[1]":"".concat(t[1]),") {\n            localCoords[1] += ").concat(o,";\n\n            flatIndex = getFlatIndex(localCoords);\n            offset = imod(flatIndex, 4);\n\n            flatIndex = idiv(flatIndex, 4, 1.);\n\n            int r = flatIndex / texShape[1];\n            int c = imod(flatIndex, texShape[1]);\n            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n            values = ").concat(r.texture2D,"(A, uv);\n\n            if (offset == 0) {\n              result[").concat(u,"] = values[0];\n            } else if (offset == 1) {\n              result[").concat(u,"] = values[1];\n            } else if (offset == 2) {\n              result[").concat(u,"] = values[2];\n            } else {\n              result[").concat(u,"] = values[3];\n            }\n          }\n        }\n        ")}this.userCode="\n        ".concat(this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":Jz(t),"\n\n        void main() {\n          ivec3 coords = getOutputCoords();\n\n          vec4 result = vec4(0.);\n          int flatIndex, r, c, offset;\n          ivec3 localCoords;\n          vec2 uv;\n          vec4 values;\n\n          ").concat(a,"\n\n          ").concat(r.output," = ").concat(i,";\n        }\n    ")},FL={};function ML(e){var t=Kz();return ez(e,"".concat(t.version,"\n    precision highp float;\n    ").concat(t.attribute," vec3 clipSpacePos;\n    ").concat(t.attribute," vec2 uv;\n    ").concat(t.varyingVs," vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }"))}function zL(e){return cz(e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function LL(e){return lz(e,new Uint16Array([0,1,2,2,1,3]))}function PL(e,t,n,r,a,i){fz(t,n);var o=pz(e),s=e.TEXTURE_2D;return ZM(e,(function(){return e.bindTexture(s,o)})),ZM(e,(function(){return e.texParameteri(s,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)})),ZM(e,(function(){return e.texParameteri(s,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)})),ZM(e,(function(){return e.texParameteri(s,e.TEXTURE_MIN_FILTER,e.NEAREST)})),ZM(e,(function(){return e.texParameteri(s,e.TEXTURE_MAG_FILTER,e.NEAREST)})),1===st().getNumber("WEBGL_VERSION")?ZM(e,(function(){return e.texImage2D(s,0,r,t,n,0,a,i,null)})):ZM(e,(function(){return e.texStorage2D(s,1,r,t,n)})),ZM(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)})),{texture:o,texShape:[n,t]}}function BL(e){return e.internalFormatFloat}function WL(e,t,n,r){var a=qM(t,n),i=Object(y.a)(a,2);return PL(e,i[0],i[1],BL(r),r.textureFormatFloat,e.FLOAT)}function UL(e){return e.internalFormatHalfFloat}function VL(e,t,n,r){var a=qM(t,n),i=Object(y.a)(a,2);return PL(e,i[0],i[1],UL(r),r.textureFormatFloat,r.textureTypeHalfFloat)}function GL(e){return e.downloadTextureFormat}function HL(e,t,n,r){var a=qM(t,n),i=Object(y.a)(a,2);return PL(e,i[0],i[1],GL(r),e.RGBA,e.UNSIGNED_BYTE)}function qL(e){return e.internalFormatPackedFloat}function KL(e,t,n,r){var a=XM(t,n),i=Object(y.a)(a,2);return PL(e,i[0],i[1],qL(r),e.RGBA,e.FLOAT)}function XL(e){return e.internalFormatPackedHalfFloat}function YL(e,t,n,r){var a=XM(t,n),i=Object(y.a)(a,2);return PL(e,i[0],i[1],XL(r),e.RGBA,r.textureTypeHalfFloat)}function ZL(e,t,n){return ZM(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,n)})),mz(e,t,"clipSpacePos",n,3,20,0)&&mz(e,t,"uv",n,2,20,12)}function JL(e,t,n,r,a,i){var o,s,u;ZM(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)})),a instanceof Uint8Array?(o=new Uint8Array(n*r*4),s=e.UNSIGNED_BYTE,u=e.RGBA):(o=new Float32Array(n*r*4),s=e.FLOAT,u=i.internalFormatPackedFloat),o.set(a),2===st().getNumber("WEBGL_VERSION")?ZM(e,(function(){return e.texSubImage2D(e.TEXTURE_2D,0,0,0,n,r,e.RGBA,s,o)})):ZM(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,u,n,r,0,e.RGBA,s,o)})),ZM(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}function QL(e,t,n){ZM(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)})),n.data instanceof Uint8Array?2===st().getNumber("WEBGL_VERSION")?ZM(e,(function(){return e.texSubImage2D(e.TEXTURE_2D,0,0,0,n.width,n.height,e.RGBA,e.UNSIGNED_BYTE,n.data)})):ZM(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n.width,n.height,0,e.RGBA,e.UNSIGNED_BYTE,n.data)})):2===st().getNumber("WEBGL_VERSION")?ZM(e,(function(){return e.texSubImage2D(e.TEXTURE_2D,0,0,0,e.RGBA,e.UNSIGNED_BYTE,n)})):ZM(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n)})),ZM(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}function $L(e,t,n,r){var a=e.createBuffer();ZM(e,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,a)}));var i=16*t*n;return ZM(e,(function(){return e.bufferData(e.PIXEL_PACK_BUFFER,i,e.STREAM_READ)})),ZM(e,(function(){return e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,0)})),ZM(e,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,null)})),a}function eP(e,t,n){var r=e,a=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,a),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),a}function tP(e,t,n,r){var a=qM(t,n),i=Object(y.a)(a,2),o=i[0],s=i[1],u=new Uint8Array(function(e,t){return e*t}(t*n,4));return ZM(e,(function(){return e.readPixels(0,0,o,s,r.downloadTextureFormat,e.UNSIGNED_BYTE,u)})),new Float32Array(u.buffer)}function nP(e,t,n,r,a,i,o,s){var u=e,c=new Float32Array(function(e,t){var n=XM(e,t),r=Object(y.a)(n,2);return r[0]*r[1]*4}(i,o));return u.bindBuffer(u.PIXEL_PACK_BUFFER,t),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,c),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),c}function rP(e,t,n){var r=new Float32Array(t*n*4);return ZM(e,(function(){return e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,r)})),r}z(FL,{bindVertexProgramAttributeStreams:function(){return ZL},createBufferFromOutputTexture:function(){return $L},createFloat16MatrixTexture:function(){return VL},createFloat16PackedMatrixTexture:function(){return YL},createFloat32MatrixTexture:function(){return WL},createIndexBuffer:function(){return LL},createPackedMatrixTexture:function(){return KL},createUnsignedBytesMatrixTexture:function(){return HL},createVertexBuffer:function(){return zL},createVertexShader:function(){return ML},downloadByteEncodedFloatMatrixFromOutputTexture:function(){return tP},downloadFloat32MatrixFromBuffer:function(){return eP},downloadMatrixFromPackedOutputTexture:function(){return rP},downloadPackedMatrixFromBuffer:function(){return nP},getInternalFormatForFloat16MatrixTexture:function(){return UL},getInternalFormatForFloat16PackedMatrixTexture:function(){return XL},getInternalFormatForFloat32MatrixTexture:function(){return BL},getInternalFormatForPackedMatrixTexture:function(){return qL},getInternalFormatForUnsignedBytesMatrixTexture:function(){return GL},uploadDenseMatrixToTexture:function(){return JL},uploadPixelDataToTexture:function(){return QL}});var aP=function(){function e(t){Object(O.a)(this,e),this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];var n=st().getNumber("WEBGL_VERSION");if(null!=t?(this.gl=t,GM(n,t)):this.gl=HM(n),t=this.gl,2===st().getNumber("WEBGL_VERSION")){var r=t;this.createVertexArray=function(){return ZM(r,(function(){return r.createVertexArray()}))},this.bindVertexArray=function(e){return ZM(r,(function(){return r.bindVertexArray(e)}))},this.deleteVertexArray=function(e){return ZM(r,(function(){return r.deleteVertexArray(e)}))},this.getVertexArray=function(){return ZM(r,(function(){return r.getParameter(r.VERTEX_ARRAY_BINDING)}))}}else if(null!=t){var a=t.getExtension("OES_vertex_array_object");if(null==a)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=function(){return ZM(t,(function(){return a.createVertexArrayOES()}))},this.bindVertexArray=function(e){return ZM(t,(function(){return a.bindVertexArrayOES(e)}))},this.deleteVertexArray=function(e){return ZM(t,(function(){return a.deleteVertexArrayOES(e)}))},this.getVertexArray=function(){return ZM(t,(function(){return t.getParameter(a.VERTEX_ARRAY_BINDING_OES)}))}}var i="WEBGL_color_buffer_float",o="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),1===st().getNumber("WEBGL_VERSION")){var s="OES_texture_half_float";if(this.textureFloatExtension=$M(this.gl,"OES_texture_float"),Pz(this.gl,s))this.textureHalfFloatExtension=$M(this.gl,s);else if(st().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(i),Pz(this.gl,o))this.colorBufferHalfFloatExtension=$M(this.gl,o);else if(st().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(i="EXT_color_buffer_float",Pz(this.gl,i))this.colorBufferFloatExtension=this.gl.getExtension(i);else{if(!Pz(this.gl,o))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension(o)}this.vertexBuffer=zL(this.gl),this.indexBuffer=LL(this.gl),this.framebuffer=hz(this.gl),this.textureConfig=YM(this.gl,this.textureHalfFloatExtension)}return Object(I.a)(e,[{key:"dispose",value:function(){var e=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;ZM(t,(function(){return t.finish()})),ZM(t,(function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)})),ZM(t,(function(){return t.deleteFramebuffer(e.framebuffer)})),ZM(t,(function(){return t.bindBuffer(t.ARRAY_BUFFER,null)})),ZM(t,(function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)})),ZM(t,(function(){return t.deleteBuffer(e.indexBuffer)})),this.disposed=!0}}},{key:"createFloat32MatrixTexture",value:function(e,t){return this.throwIfDisposed(),WL(this.gl,e,t,this.textureConfig)}},{key:"createFloat16MatrixTexture",value:function(e,t){return this.throwIfDisposed(),VL(this.gl,e,t,this.textureConfig)}},{key:"createUnsignedBytesMatrixTexture",value:function(e,t){return this.throwIfDisposed(),HL(this.gl,e,t,this.textureConfig)}},{key:"uploadPixelDataToTexture",value:function(e,t){this.throwIfDisposed(),QL(this.gl,e,t)}},{key:"uploadDenseMatrixToTexture",value:function(e,t,n,r){this.throwIfDisposed(),JL(this.gl,e,t,n,r,this.textureConfig)}},{key:"createFloat16PackedMatrixTexture",value:function(e,t){return this.throwIfDisposed(),YL(this.gl,e,t,this.textureConfig)}},{key:"createPackedMatrixTexture",value:function(e,t){return this.throwIfDisposed(),KL(this.gl,e,t,this.textureConfig)}},{key:"deleteMatrixTexture",value:function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(Oz(this.gl,this.framebuffer),this.outputTexture=null),ZM(this.gl,(function(){return t.gl.deleteTexture(e)}))}},{key:"downloadByteEncodedFloatMatrixFromOutputTexture",value:function(e,t,n){var r=this;return this.downloadMatrixDriver(e,(function(){return tP(r.gl,t,n,r.textureConfig)}))}},{key:"downloadPackedMatrixFromBuffer",value:function(e,t,n,r,a,i){return nP(this.gl,e,0,0,0,a,i,this.textureConfig)}},{key:"downloadFloat32MatrixFromBuffer",value:function(e,t){return eP(this.gl,e,t)}},{key:"createBufferFromTexture",value:function(e,t,n){this.bindTextureToFrameBuffer(e);var r=$L(this.gl,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}},{key:"createAndWaitForFence",value:function(){var e=this.createFence(this.gl);return this.pollFence(e)}},{key:"createFence",value:function(e){var t,n,r=this;if(st().getBool("WEBGL_FENCE_API_ENABLED")){var a=e,i=a.fenceSync(a.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=function(){var e=a.clientWaitSync(i,0,0);return e===a.ALREADY_SIGNALED||e===a.CONDITION_SATISFIED},t=i}else st().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=function(){return r.isQueryAvailable(t,st().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:t,isFencePassed:n}}},{key:"downloadMatrixFromPackedTexture",value:function(e,t,n){var r=this;return this.downloadMatrixDriver(e,(function(){return rP(r.gl,t,n)}))}},{key:"createProgram",value:function(e){var t=this;this.throwIfDisposed();var n=this.gl;null==this.vertexShader&&(this.vertexShader=ML(n));var r=oz(n);ZM(n,(function(){return n.attachShader(r,t.vertexShader)})),ZM(n,(function(){return n.attachShader(r,e)})),sz(n,r);var a=Object.assign(r,{vao:this.createVertexArray()});return this.debug&&uz(n,a),a}},{key:"buildVao",value:function(e){var t=this;this.setProgram(e),this.bindVertexArray(e.vao);var n=this.gl;ZM(n,(function(){return n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t.indexBuffer)})),ZL(n,e,this.vertexBuffer)}},{key:"deleteProgram",value:function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&(ZM(this.gl,(function(){return t.gl.deleteProgram(e)})),this.deleteVertexArray(e.vao))}},{key:"setProgram",value:function(e){var t=this;this.throwIfDisposed(),this.program=e,null!=this.program&&this.debug&&uz(this.gl,this.program),ZM(this.gl,(function(){return t.gl.useProgram(e)}))}},{key:"getUniformLocation",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this.throwIfDisposed(),n?gz(this.gl,e,t):yz(this.gl,e,t)}},{key:"getAttributeLocation",value:function(e,t){var n=this;return this.throwIfDisposed(),ZM(this.gl,(function(){return n.gl.getAttribLocation(e,t)}))}},{key:"getUniformLocationNoThrow",value:function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}},{key:"setInputMatrixTexture",value:function(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),xz(this.gl,e,t,n)}},{key:"setOutputMatrixTexture",value:function(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)}},{key:"setOutputPackedMatrixTexture",value:function(e,t,n){this.throwIfDisposed();var r=XM(t,n),a=Object(y.a)(r,2),i=a[0],o=a[1];this.setOutputMatrixTextureDriver(e,i,o)}},{key:"setOutputMatrixWriteRegion",value:function(e,t,n,r){this.setOutputMatrixWriteRegionDriver(n,e,r,t)}},{key:"setOutputPackedMatrixWriteRegion",value:function(e,t,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}},{key:"debugValidate",value:function(){null!=this.program&&uz(this.gl,this.program),Iz(this.gl)}},{key:"executeProgram",value:function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;if(this.debug){var t=this.getVertexArray();console.assert(t===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}ZM(e,(function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)}))}},{key:"blockUntilAllProgramsCompleted",value:function(){var e=this;this.throwIfDisposed(),ZM(this.gl,(function(){return e.gl.finish()}))}},{key:"getQueryTimerExtension",value:function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=$M(this.gl,2===st().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}},{key:"getQueryTimerExtensionWebGL2",value:function(){return this.getQueryTimerExtension()}},{key:"getQueryTimerExtensionWebGL1",value:function(){return this.getQueryTimerExtension()}},{key:"beginQuery",value:function(){if(2===st().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}var r=this.getQueryTimerExtensionWebGL1(),a=r.createQueryEXT();return r.beginQueryEXT(r.TIME_ELAPSED_EXT,a),a}},{key:"endQuery",value:function(){if(2!==st().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,n=this.getQueryTimerExtensionWebGL2();t.endQuery(n.TIME_ELAPSED_EXT)}}},{key:"waitForQueryAndGetTime",value:function(){var e=Object(w.a)(k.a.mark((function e(t){var n=this;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ga.repeatedTry((function(){return n.disposed||n.isQueryAvailable(t,st().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}));case 2:return e.abrupt("return",this.getQueryTime(t,st().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getQueryTime",value:function(e,t){if(0===t)return null;if(2===t){var n=this.gl;return n.getQueryParameter(e,n.QUERY_RESULT)/1e6}var r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(e,r.QUERY_RESULT_EXT)/1e6}},{key:"isQueryAvailable",value:function(e,t){if(0===t)return!0;if(2===t){var n=this.gl,r=this.getQueryTimerExtensionWebGL2(),a=n.getQueryParameter(e,n.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),a&&!this.disjoint}var i=this.getQueryTimerExtensionWebGL1(),o=i.getQueryObjectEXT(e,i.QUERY_RESULT_AVAILABLE_EXT);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),o&&!this.disjoint}},{key:"pollFence",value:function(e){var t=this;return new Promise((function(n){t.addItemToPoll((function(){return e.isFencePassed()}),(function(){return n()}))}))}},{key:"pollItems",value:function(){for(var e=function(e){for(var t=0;t<e.length&&e[t]();++t);return t-1}(this.itemsToPoll.map((function(e){return e.isDoneFn}))),t=0;t<=e;++t){(0,this.itemsToPoll[t].resolveFn)()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}},{key:"addItemToPoll",value:function(e,t){var n,r=this;(this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1)||("setTimeoutCustom"in st().platform&&(n=st().platform.setTimeoutCustom.bind(st().platform)),Ga.repeatedTry((function(){return r.pollItems(),0===r.itemsToPoll.length}),(function(){return 0}),null,n))}},{key:"bindTextureToFrameBuffer",value:function(e){this.throwIfDisposed(),wz(this.gl,e,this.framebuffer),this.debug&&Iz(this.gl)}},{key:"unbindTextureToFrameBuffer",value:function(){null!=this.outputTexture?(wz(this.gl,this.outputTexture,this.framebuffer),this.debug&&Iz(this.gl)):Oz(this.gl,this.framebuffer)}},{key:"downloadMatrixDriver",value:function(e,t){this.bindTextureToFrameBuffer(e);var n=t();return this.unbindTextureToFrameBuffer(),n}},{key:"setOutputMatrixTextureDriver",value:function(e,t,n){this.throwIfDisposed();var r=this.gl;wz(r,e,this.framebuffer),this.debug&&Iz(r),this.outputTexture=e,ZM(r,(function(){return r.viewport(0,0,t,n)})),ZM(r,(function(){return r.scissor(0,0,t,n)}))}},{key:"setOutputMatrixWriteRegionDriver",value:function(e,t,n,r){var a=this;this.throwIfDisposed(),ZM(this.gl,(function(){return a.gl.scissor(e,t,n,r)}))}},{key:"throwIfDisposed",value:function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}},{key:"throwIfNoProgram",value:function(){if(null==this.program)throw new Error("No GPU program is currently set.")}},{key:"debug",get:function(){return st().getBool("DEBUG")}}]),e}();var iP=pE.addImpl,oP=pE.bincountImpl,sP=pE.bincountReduceImpl,uP=pE.bitwiseAndImpl,cP=pE.castImpl,lP=pE.ceilImpl,dP=pE.concatImpl,pP=pE.equalImpl,fP=pE.expImpl,hP=pE.expm1Impl,mP=pE.floorImpl,vP=pE.gatherNdImpl,bP=pE.gatherV2Impl,gP=pE.greaterImpl,yP=pE.greaterEqualImpl,xP=pE.lessImpl,kP=pE.lessEqualImpl,wP=pE.linSpaceImpl,OP=pE.logImpl,IP=pE.maxImpl,SP=pE.maximumImpl,NP=pE.minimumImpl,jP=pE.multiplyImpl,TP=pE.negImpl,CP=pE.notEqualImpl,EP=pE.prodImpl,_P=pE.raggedGatherImpl,AP=pE.raggedRangeImpl,RP=pE.raggedTensorToTensorImpl,DP=pE.rangeImpl,FP=pE.rsqrtImpl,MP=pE.scatterImpl,zP=pE.sigmoidImpl,LP=pE.simpleAbsImpl,PP=pE.sliceImpl,BP=pE.sparseFillEmptyRowsImpl,WP=pE.sparseReshapeImpl,UP=pE.sparseSegmentReductionImpl,VP=pE.sqrtImpl,GP=pE.staticRegexReplaceImpl,HP=pE.stridedSliceImpl,qP=pE.stringNGramsImpl,KP=pE.stringSplitImpl,XP=pE.stringToHashBucketFastImpl,YP=pE.subImpl,ZP=pE.tileImpl,JP=pE.topKImpl,QP=pE.transposeImpl,$P=pE.uniqueImpl;function eB(e,t){return["x","y","z","w","u","v"].slice(0,t).map((function(t){return"".concat(e,".").concat(t)}))}function tB(e,t){return 1===t?[e]:eB(e,t)}var nB=function(){function e(t){if(Object(O.a)(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.enableShapeUniforms=jL(this.outputShape.length),0===this.rank)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var n=tB("rc",this.rank),r=gL(this.rank),a=this.getOutOfBoundsCondition(n),i=this.getSetup(n),o=this.getOutput(n);this.userCode="\n        void main() {\n          ".concat(r," rc = getOutputCoords();\n\n          if(").concat(a,") {\n            setOutput(vec4(0));\n          } else {\n            ").concat(i,"\n\n            setOutput(vec4(").concat(o,"));\n          }\n        }\n      ")}}return Object(I.a)(e,[{key:"getSourceCoordsArr",value:function(e){for(var t=[],n=0;n<=1;n++)for(var r=0;r<=1;r++){for(var a="".concat(0===n?"r":"rp1",", ").concat(0===r?"c":"cp1"),i=2;i<this.rank;i++)a="".concat(e[e.length-1-i],",")+a;t.push(a)}return t}},{key:"getOutOfBoundsCondition",value:function(e){if(1===this.rank)return"rc > ".concat(this.enableShapeUniforms?"outShape":this.outputShape[0]);for(var t="",n=this.rank-2;n<this.rank;n++)t+="".concat(e[n]," >= ").concat(this.enableShapeUniforms?"outShape[".concat(n,"]"):this.outputShape[n]),n<this.rank-1&&(t+="||");return t}},{key:"getSetup",value:function(e){if(1===this.rank)return"";var t=e.slice(-2),n=this.enableShapeUniforms?"outShape[".concat(this.rank," - 1]"):this.outputShape[this.rank-1],r=this.enableShapeUniforms?"outShape[".concat(this.rank," - 2]"):this.outputShape[this.rank-2];return"\n      int r = ".concat(t[0],";\n      int c = ").concat(t[1],";\n      int rp1 = r + 1;\n      int cp1 = c + 1;\n\n      bool cEdge = cp1 >= ").concat(n,";\n      bool rEdge = rp1 >= ").concat(r,";\n    ")}},{key:"getOutput",value:function(e){var t=this.getSourceCoordsArr(e);return 1===this.rank?"getA(rc), (rc + 1 >= ".concat(this.enableShapeUniforms?"outShape":this.outputShape[0]," ? 0. : getA(rc + 1)), 0, 0"):"getA(".concat(t[0],"),\n            cEdge ? 0. : getA(").concat(t[1],"),\n            rEdge ? 0. : getA(").concat(t[2],"),\n            rEdge || cEdge ? 0. : getA(").concat(t[3],")")}}]),e}(),rB=function e(t,n){Object(O.a)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=t,this.enableShapeUniforms=jL(this.outputShape.length);for(var r="",a=0;a<4;a++){var i="thisRC = rc;";a%2===1&&(i+="thisRC.z += 1;"),a>1&&(i+="thisRC.y += 1;"),r+="\n        ".concat(i,"\n        ").concat(a>0?"if(thisRC.y < rows && thisRC.z < cols){":"","\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result[").concat(a,"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        ").concat(a>0?"}":"","\n      ")}this.userCode="\n      ".concat(function(e,t){return"\n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      ".concat(t?function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index",r=e.map((function(e,t){return t})),a=Zz(r,t);return a.map((function(t,r){var i="int ".concat(e[r]," = ").concat(n," / ").concat(a[r]),o=r===a.length-1?"int ".concat(e[r+1]," = ").concat(n," - ").concat(e[r]," * ").concat(a[r]):"index -= ".concat(e[r]," * ").concat(a[r]);return"".concat(i,"; ").concat(o,";")})).join("")}(["r","c","d"],"inputShape"):Xz(["r","c","d"],e),"\n      return ivec3(r, c, d);\n    }\n  ")}(n,this.enableShapeUniforms),"\n      ").concat(this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":Jz(t),"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = ").concat(this.enableShapeUniforms?"outShape[1]":t[1],";\n        int cols = ").concat(this.enableShapeUniforms?"outShape[2]":t[2],";\n\n        ").concat(r,"\n\n        setOutput(result);\n      }\n    ")};var aB=function(){function e(t){Object(O.a)(this,e),this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}return Object(I.a)(e,[{key:"acquireTexture",value:function(e,t,n){var r=oB(t,n),a=sB(e,r,n);a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]);var i,o=iB(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,n);if(this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=o,this.log();var s=this.freeTextures[a].pop();return this.usedTextures[a].push(s),s}return r===WM.PACKED_2X2_FLOAT32?i=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===WM.PACKED_2X2_FLOAT16?i=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===WM.UNPACKED_FLOAT32?i=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===WM.UNPACKED_FLOAT16?i=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===WM.PACKED_4X1_UNSIGNED_BYTE&&(i=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[a].push(i),this.numUsedTextures++,this._numBytesAllocated+=o,this.log(),i}},{key:"releaseTexture",value:function(e,t,n,r){if(null!=this.freeTextures){var a=oB(n,r),i=sB(t,a,r);i in this.freeTextures||(this.freeTextures[i]=[]);var o=iB(t,a,this.gpgpu.gl,this.gpgpu.textureConfig,r),s=st().get("WEBGL_DELETE_TEXTURE_THRESHOLD");-1!==s&&this._numBytesAllocated>s?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=o):(this.freeTextures[i].push(e),this.numFreeTextures++,this._numBytesFree+=o),this.numUsedTextures--;var u=this.usedTextures[i],c=u&&u.indexOf(e);if(null==c||c<0)throw new Error("Cannot release a texture that was never provided by this texture manager");u[c]=u[u.length-1],u.pop(),this.log()}}},{key:"log",value:function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used","".concat(this.numFreeTextures," / ").concat(this.numUsedTextures),"(".concat(e,")"));var t=this._numBytesFree/this._numBytesAllocated;console.log("Bytes allocated: ".concat(this._numBytesAllocated)),console.log("Bytes unused: ".concat(this._numBytesFree," (").concat(Math.round(100*t),"%)"))}}},{key:"getNumUsedTextures",value:function(){return this.numUsedTextures}},{key:"getNumFreeTextures",value:function(){return this.numFreeTextures}},{key:"dispose",value:function(){var e=this;if(null!=this.freeTextures){for(var t in this.freeTextures)this.freeTextures[t].forEach((function(t){e.gpgpu.deleteMatrixTexture(t.texture)}));for(var n in this.usedTextures)this.usedTextures[n].forEach((function(t){e.gpgpu.deleteMatrixTexture(t.texture)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}},{key:"numBytesAllocated",get:function(){return this._numBytesAllocated}},{key:"numBytesFree",get:function(){return this._numBytesFree}}]),e}();function iB(e,t,n,r,a){var i,o=function(e,t){switch(e){case WM.PACKED_2X2_FLOAT32:return qL(t);case WM.PACKED_2X2_FLOAT16:return XL(t);case WM.UNPACKED_FLOAT32:return BL(t);case WM.UNPACKED_FLOAT16:return UL(t);case WM.PACKED_4X1_UNSIGNED_BYTE:return GL(t);default:throw new Error("Unknown physical texture type ".concat(e))}}(t,r);if(a){var s=XM(e[0],e[1]),u=Object(y.a)(s,2);i=u[0]*u[1]}else{var c=qM(e[0],e[1]),l=Object(y.a)(c,2);i=l[0]*l[1]}return i*function(e,t){var n=e;if(t===n.R32F)return 4;if(t===n.R16F)return 2;if(t===n.RGBA32F||t===e.RGBA)return 16;if(t===n.RGBA16F)return 8;if(t===n.RGBA8)return 4;throw new Error("Unknown internal format ".concat(t))}(n,o)}function oB(e,t){if(e===BM.UPLOAD)return WM.PACKED_2X2_FLOAT32;if(e===BM.RENDER||null==e)return function(e){return st().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?WM.PACKED_2X2_FLOAT32:WM.UNPACKED_FLOAT32:e?WM.PACKED_2X2_FLOAT16:WM.UNPACKED_FLOAT16}(t);if(e===BM.DOWNLOAD||e===BM.PIXELS)return WM.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type ".concat(e))}function sB(e,t,n){return"".concat(e[0],"_").concat(e[1],"_").concat(t,"_").concat(n)}var uB=function e(t,n){Object(O.a)(this,e),this.variableNames=["A"],this.outputShape=t,this.enableShapeUniforms=jL(this.outputShape.length),this.userCode="\n      float unaryOperation(float x) {\n        ".concat(n,"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    ")},cB="if (isnan(x)) return x;",lB="return x;",dB="return abs(x);",pB="return (x >= 0.0) ? x : (exp(x) - 1.0);",fB=cB+"\n  return (x < 0.0) ? 0.0 : x;\n",hB=cB+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",mB="return x;",vB="return 1.0 / (1.0 + exp(-1.0 * x));",bB="return x;",gB="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n",yB="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",xB="\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",kB="return 1.0 / (1.0 + exp(-1.0 * x));",wB=function e(t,n){Object(O.a)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.enableShapeUniforms=jL(this.outputShape.length),this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        ".concat(n,"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    ")},OB=function e(t){Object(O.a)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=t,this.enableShapeUniforms=jL(this.outputShape.length);var n=t.length,r=tB("rc",n),a=gL(n),i=function(e,t){if(1===e)return"rc";for(var n="",r=0;r<e;r++)n+=t[r],r<e-1&&(n+=",");return n}(n,r),o=r.slice(-2),s=n<=1?"rc":"vec2(".concat(o.join(","),")");this.userCode="\n      void main() {\n        ".concat(a," rc = getOutputCoords();\n        vec4 packedInput = getA(").concat(i,");\n\n        setOutput(getChannel(packedInput, ").concat(s,"));\n      }\n    ")},IB=Gv.whereImpl,SB={};var NB=st().getNumber("CPU_HANDOFF_SIZE_THRESHOLD");var jB=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r,a;if(Object(O.a)(this,n),(r=t.call(this)).pendingRead=new WeakMap,r.pendingDisposal=new WeakSet,r.dataRefCount=new WeakMap,r.numBytesInGPU=0,r.uploadWaitMs=0,r.downloadWaitMs=0,r.lastGlFlushTime=0,r.warnedAboutMemory=!1,r.pendingDeletes=0,r.disposed=!1,!st().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null!=e){if(e instanceof aP)a=e;else{var i=HM(st().getNumber("WEBGL_VERSION"),e);a=new aP(i)}r.binaryCache={},r.gpgpuCreatedLocally=!1}else{var o=HM(st().getNumber("WEBGL_VERSION"));a=new aP(o),r.binaryCache=function(e){return e in SB||(SB[e]={}),SB[e]}(st().getNumber("WEBGL_VERSION")),r.gpgpuCreatedLocally=!0}return r.gpgpu=a,r.canvas=r.gpgpu.gl.canvas,r.textureManager=new aB(r.gpgpu),r.numMBBeforeWarning=null==st().global.screen?1024:st().global.screen.height*st().global.screen.width*window.devicePixelRatio*600/1024/1024,r.texData=new oe(Object(f.a)(r),Ds()),Object(m.a)(r)}return Object(I.a)(n,[{key:"nextDataId",value:function(){return n.nextDataId++}}]),Object(I.a)(n,[{key:"numDataIds",value:function(){return this.texData.numDataIds()-this.pendingDeletes}},{key:"writeTexture",value:function(e,t,n,r,a,i){var o=this.makeTensorInfo(t,n),s=this.texData.get(o.dataId);s.isPacked=!1,s.texture={texture:e,texShape:[r,a]},s.texShape=[r,a];var u=Ez(t),c=new RL(u,!1,i),l=this.runWebGLProgram(c,[o],n,[[r,a]]);return l.shape=t,s.texture=null,this.disposeIntermediateTensorInfo(o),l.dataId}},{key:"write",value:function(e,t,n){if((st().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||st().getBool("DEBUG"))&&this.checkNumericalProblems(e),"complex64"===n&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var r={id:this.nextDataId()};return this.texData.set(r,{shape:t,dtype:n,values:e,usage:BM.UPLOAD,refCount:1}),r}},{key:"refCount",value:function(e){return this.texData.has(e)?this.texData.get(e).refCount:0}},{key:"incRef",value:function(e){this.texData.get(e).refCount++}},{key:"decRef",value:function(e){this.texData.has(e)&&this.texData.get(e).refCount--}},{key:"move",value:function(e,t,n,r,a){if(st().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:n,dtype:r,values:t,usage:BM.UPLOAD,refCount:a})}},{key:"disposeIntermediateTensorInfo",value:function(e){this.disposeData(e.dataId)}},{key:"readSync",value:function(e){var t=this.texData.get(e),n=t.values,r=t.dtype,a=t.complexTensorInfos,i=t.slice,o=t.shape,s=t.isPacked;if(null!=i){var u;u=s?new wB(o,mB):new uB(o,mB);var c=this.runWebGLProgram(u,[{dataId:e,shape:o,dtype:r}],r),l=this.readSync(c.dataId);return this.disposeIntermediateTensorInfo(c),l}if(null!=n)return this.convertAndCacheOnCPU(e);if("string"===r)return n;var d,p,f=null!=this.activeTimers;if(f&&(d=Ga.now()),"complex64"===r){var h=this.readSync(a.real.dataId),m=this.readSync(a.imag.dataId);p=Wm.mergeRealAndImagArrays(h,m)}else p=this.getValuesFromTexture(e);return f&&(this.downloadWaitMs+=Ga.now()-d),this.convertAndCacheOnCPU(e,p)}},{key:"read",value:function(){var e=Object(w.a)(k.a.mark((function e(t){var n,r,a,i,o,s,u,c,l,d,p,f,h,m,v,b,g,y,x,w,O,I,N;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.pendingRead.has(t)){e.next=3;break}return n=this.pendingRead.get(t),e.abrupt("return",new Promise((function(e){return n.push(e)})));case 3:if(r=this.texData.get(t),a=r.values,i=r.shape,o=r.slice,s=r.dtype,u=r.complexTensorInfos,c=r.isPacked,null==o){e.next=8;break}return l=c?new wB(i,mB):new uB(i,mB),d=this.runWebGLProgram(l,[{dataId:t,shape:i,dtype:s}],s),p=this.read(d.dataId),e.abrupt("return",(this.disposeIntermediateTensorInfo(d),p));case 8:if(null==a){e.next=10;break}return e.abrupt("return",this.convertAndCacheOnCPU(t));case 10:if(!st().getBool("DEBUG")||st().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")||2!==st().getNumber("WEBGL_VERSION")){e.next=12;break}throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");case 12:if(f=null,"complex64"!==s&&st().get("WEBGL_BUFFER_SUPPORTED")&&(h=this.decode(t),v=this.texData.get(h.dataId),f=(m=this.gpgpu).createBufferFromTexture.apply(m,[v.texture.texture].concat(Object(S.a)(KM(i))))),this.pendingRead.set(t,[]),e.t0="complex64"!==s,!e.t0){e.next=19;break}return e.next=19,this.gpgpu.createAndWaitForFence();case 19:if("complex64"!==s){e.next=28;break}return e.next=22,Promise.all([this.read(u.real.dataId),this.read(u.imag.dataId)]);case 22:g=e.sent,y=g[0],x=g[1],b=Wm.mergeRealAndImagArrays(y,x),e.next=29;break;case 28:null==f?b=this.getValuesFromTexture(t):(w=Ga.sizeFromShape(i),b=this.gpgpu.downloadFloat32MatrixFromBuffer(f,w));case 29:return null!=h&&this.disposeIntermediateTensorInfo(h),null!=f&&ZM(O=this.gpgpu.gl,(function(){return O.deleteBuffer(f)})),I=this.convertAndCacheOnCPU(t,b),N=this.pendingRead.get(t),e.abrupt("return",(this.pendingRead.delete(t),N.forEach((function(e){return e(I)})),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t)&&Ds().removeDataId(t,this),this.pendingDeletes--),I));case 32:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"readToGPU",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.texData.get(e),r=n.values,a=n.shape,i=n.slice,o=n.dtype,s=n.isPacked,u=n.texture;if("complex64"===o)throw new Error("Does not support reading texture for complex64 dtype.");if(null!=i){var c;c=s?new wB(a,mB):new uB(a,mB);var l=this.runWebGLProgram(c,[{dataId:e,shape:a,dtype:o}],o),d=this.readToGPU(l,t);return this.disposeIntermediateTensorInfo(l),d}if(null==u)throw null!=r?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");var p=this.decode(e,t.customTexShape),f=Ds().makeTensorFromTensorInfo(p),h=this.texData.get(p.dataId);return Object.assign({tensorRef:f},h.texture)}},{key:"bufferSync",value:function(e){var t=this.readSync(e.dataId);if("string"===e.dtype)try{var n=t.map((function(e){return Ga.decodeString(e)}));return Ss(e.shape,e.dtype,n)}catch(w0){throw new Error("Failed to decode encoded string bytes into utf-8")}return Ss(e.shape,e.dtype,t)}},{key:"checkNumericalProblems",value:function(e){if(null!=e)for(var t=0;t<e.length;t++){var n=e[t];if(!JM(n))throw st().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value ".concat(n," cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'")):Error("The value ".concat(n," cannot be represented on this device."))}}},{key:"getValuesFromTexture",value:function(e){var t=this.texData.get(e),n=t.shape,r=t.dtype,a=t.isPacked,i=Ga.sizeFromShape(n);if(st().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var o,s=this.decode(e),u=this.texData.get(s.dataId),c=(o=this.gpgpu).downloadMatrixFromPackedTexture.apply(o,[u.texture.texture].concat(Object(S.a)(KM(n)))).subarray(0,i);return this.disposeIntermediateTensorInfo(s),c}var l=st().getBool("WEBGL_PACK")&&!0===a,d=l?Ez(n):n,p=l?new _L(d):new EL(d),f=this.runWebGLProgram(p,[{shape:d,dtype:r,dataId:e}],"float32"),h=this.texData.get(f.dataId),m=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(h.texture.texture,h.texShape[0],h.texShape[1]).subarray(0,i);return this.disposeIntermediateTensorInfo(f),m}},{key:"timerAvailable",value:function(){return st().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}},{key:"time",value:function(e){var t=this,n=this.activeTimers,r=[],a=!1;null==this.programTimersStack?(this.programTimersStack=r,a=!0):this.activeTimers.push(r),this.activeTimers=r,e();var i=Ga.flatten(this.activeTimers.map((function(e){return e.query}))).filter((function(e){return null!=e})),o=Ga.flatten(this.activeTimers.map((function(e){return e.name}))).filter((function(e){return null!=e}));this.activeTimers=n,a&&(this.programTimersStack=null);var s={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return Object(w.a)(k.a.mark((function e(){var n;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(st().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)){e.next=7;break}return e.next=3,Promise.all(i);case 3:n=e.sent,s.kernelMs=Ga.sum(n),s.getExtraProfileInfo=function(){return n.map((function(e,t){return{name:o[t],ms:e}})).map((function(e){return"".concat(e.name,": ").concat(e.ms)})).join(", ")},e.next=8;break;case 7:s.kernelMs={error:"WebGL query timers are not supported in this environment."};case 8:return e.abrupt("return",(t.uploadWaitMs=0,t.downloadWaitMs=0,s));case 9:case"end":return e.stop()}}),e)})))()}},{key:"memory",value:function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}},{key:"startTimer",value:function(){return st().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Ga.now(),endMs:null}}},{key:"endTimer",value:function(e){return st().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=Ga.now(),e)}},{key:"getQueryTime",value:function(){var e=Object(w.a)(k.a.mark((function e(t){var n;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(st().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)){e.next=2;break}return e.abrupt("return",this.gpgpu.waitForQueryAndGetTime(t));case 2:return n=t,e.abrupt("return",n.endMs-n.startMs);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"disposeData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(t?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!t&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);var n=this.texData.get(e),r=n.complexTensorInfos;return null!=r&&(this.disposeData(r.real.dataId,t),this.disposeData(r.imag.dataId,t)),this.texData.delete(e),!0}},{key:"releaseGPUData",value:function(e){var t=this.texData.get(e),n=t.texture,r=t.dtype,a=t.texShape,i=t.usage,o=t.isPacked,s=t.slice,u=s&&s.origDataId||e,c=this.dataRefCount.get(u);c>1?this.dataRefCount.set(u,c-1):(this.dataRefCount.delete(u),null!=n&&(this.numBytesInGPU-=this.computeBytes(a,r),this.textureManager.releaseTexture(n,a,i,o)));var l=this.texData.get(e);l.texture=null,l.texShape=null,l.isPacked=!1,l.slice=null}},{key:"getTexture",value:function(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}},{key:"getDataInfo",value:function(e){return this.texData.get(e)}},{key:"shouldExecuteOnCPU",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:NB;return st().getBool("WEBGL_CPU_FORWARD")&&e.every((function(e){return null==t.texData.get(e.dataId).texture&&Ga.sizeFromShape(e.shape)<n}))}},{key:"getGPGPUContext",value:function(){return this.gpgpu}},{key:"where",value:function(e){Wm.warn("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var t=e.dataSync();return IB(e.shape,t)}},{key:"packedUnaryOp",value:function(e,t,n){var r=new wB(e.shape,t),a=this.compileAndRun(r,[e],n);return Ds().makeTensorFromTensorInfo(a)}},{key:"abs",value:function(e){if(this.shouldExecuteOnCPU([e])&&"complex64"!==e.dtype){var t=LP(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,t)}if(st().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,dB,e.dtype);var n=new uB(e.shape,dB),r=this.compileAndRun(n,[e]);return Ds().makeTensorFromTensorInfo(r)}},{key:"makeTensorInfo",value:function(e,t,n){var r;if("string"===t&&null!=n&&n.length>0&&Ga.isString(n[0])){var a=n.map((function(e){return Ga.encodeString(e)}));r=this.write(a,e,t)}else r=this.write(n,e,t);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:t}}},{key:"makeOutput",value:function(e,t,n){return Ds().makeTensorFromTensorInfo(this.makeTensorInfo(e,t,n),this)}},{key:"unpackTensor",value:function(e){var t=new OB(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}},{key:"packTensor",value:function(e){var t=new nB(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}},{key:"packedReshape",value:function(e,t){var n=[Tz(e.shape)].concat(Object(S.a)(Cz(e.shape))),r={dtype:e.dtype,shape:n,dataId:e.dataId},a=[Tz(t)].concat(Object(S.a)(Cz(t))),i=new rB(a,n),o=[n],s=this.runWebGLProgram(i,[r],e.dtype,o,!0);return{dataId:s.dataId,shape:t,dtype:s.dtype}}},{key:"decode",value:function(e,t){var n=this.texData.get(e),r=n.isPacked,a=n.shape,i=n.dtype;if(null!=t){var o=Ga.sizeFromShape(a),s=t[0]*t[1]*4;Ga.assert(o<=s,(function(){return"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data."}))}var u,c=Ez(a);u=r?new CL(c):new TL(c);var l=[null!=t?t:KM(c)];return{dtype:i,shape:a,dataId:this.runWebGLProgram(u,[{shape:c,dtype:i,dataId:e}],i,l,!0,t).dataId}}},{key:"runWebGLProgram",value:function(e,t,n,r){var a=this,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5?arguments[5]:void 0,s=this.makeTensorInfo(e.outputShape,n),u=this.texData.get(s.dataId);if(e.packedOutput&&(u.isPacked=!0),e.outPackingScheme===PM.DENSE){var c=null!=o?o:KM(e.outputShape);u.texShape=c.map((function(e){return 2*e}))}if(null!=e.outTexUsage&&(u.usage=e.outTexUsage),0===Ga.sizeFromShape(s.shape))return u.values=Ga.getTypedArrayFromDType(s.dtype,0),s;var l=[],d=t.map((function(t){if("complex64"===t.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var n=a.texData.get(t.dataId);if(null==n.texture){if(!e.packedInputs&&Ga.sizeFromShape(t.shape)<=st().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:t.shape,texData:null,isUniform:!0,uniformValues:n.values};e.packedInputs&&(n.isPacked=!0,n.shape=t.shape)}if(a.uploadToGPU(t.dataId),!!n.isPacked!=!!e.packedInputs)t=n.isPacked?a.unpackTensor(t):a.packTensor(t),l.push(t),n=a.texData.get(t.dataId);else if(n.isPacked&&!Rz(n.shape,t.shape)){var r=t,i=t.shape;t.shape=n.shape,t=a.packedReshape(t,i),l.push(t),n=a.texData.get(t.dataId),r.shape=i}return{shape:t.shape,texData:n,isUniform:!1}}));this.uploadToGPU(s.dataId);var p,f={shape:s.shape,texData:u,isUniform:!1},h=NL(e,d,f),m=this.getAndSaveBinary(h,(function(){return wL(a.gpgpu,e,d,f)})),v=null!=this.activeTimers;v&&(p=this.startTimer()),st().get("ENGINE_COMPILE_ONLY")||SL(this.gpgpu,m,d,f,r),l.forEach((function(e){return a.disposeIntermediateTensorInfo(e)})),v&&(p=this.endTimer(p),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(p)}));var b=st().get("WEBGL_FLUSH_THRESHOLD");if(b>0){var g=Ga.now();g-this.lastGlFlushTime>b&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=g)}if(!st().getBool("WEBGL_LAZILY_UNPACK")&&u.isPacked&&!1===i){var y=this.unpackTensor(s);return this.disposeIntermediateTensorInfo(s),y}return s}},{key:"compileAndRun",value:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return n=n||t[0].dtype,this.runWebGLProgram(e,t,n,r,a)}},{key:"getAndSaveBinary",value:function(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}},{key:"getTextureManager",value:function(){return this.textureManager}},{key:"dispose",value:function(){var e=this;this.disposed||(st().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach((function(t){e.gpgpu.deleteProgram(e.binaryCache[t].webGLProgram),delete e.binaryCache[t]})),this.textureManager.dispose(),null!=this.canvas&&"undefined"!=typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}},{key:"floatPrecision",value:function(){var e=this;return null==this.floatPrecisionValue&&(this.floatPrecisionValue=zs((function(){if(!st().get("WEBGL_RENDER_FLOAT32_ENABLED")){var t=st().getBool("DEBUG");st().set("DEBUG",!1);var n=e.abs(Uc(1e-8)).dataSync()[0];if(st().set("DEBUG",t),n>0)return 32}return 16}))),this.floatPrecisionValue}},{key:"epsilon",value:function(){return 32===this.floatPrecision()?1e-7:1e-4}},{key:"uploadToGPU",value:function(e){var t=this.texData.get(e),n=t.shape,r=t.dtype,a=t.values,i=t.texture,o=t.usage,s=t.isPacked;if(null==i){var u,c=null!=this.activeTimers;c&&(u=Ga.now());var l=t.texShape;if(null==l&&(l=_z(n,s),t.texShape=l),null!=a){var d,p,f,h=Ez(n),m=l[1],v=l[0],b=a instanceof Uint8Array||a instanceof Uint8ClampedArray;(s||!b)&&(d=XM(l[0],l[1]),m=(p=Object(y.a)(d,2))[0],v=p[1]),f=s?new DL(h,b):new RL(h,b);var g=b?[v,m]:l,x=this.makeTensorInfo(g,r),k=this.texData.get(x.dataId);k.usage=b?BM.PIXELS:BM.UPLOAD,k.texShape=g,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(x.dataId),m,v,a);var w=[[v,m]],O=this.runWebGLProgram(f,[x],r,w,!0),I=this.texData.get(O.dataId);t.texShape=I.texShape,t.isPacked=I.isPacked,t.usage=I.usage,st().get("ENGINE_COMPILE_ONLY")?this.disposeData(O.dataId):(t.texture=I.texture,t.values=null,this.texData.delete(O.dataId)),this.disposeIntermediateTensorInfo(x),c&&(this.uploadWaitMs+=Ga.now()-u)}else{var S=this.acquireTexture(l,o,r,s);t.texture=S}}}},{key:"convertAndCacheOnCPU",value:function(e,t){var n=this.texData.get(e),r=n.dtype;return null!=t&&(n.values=function(e,t){if("float32"===t||"complex64"===t)return e;if("int32"===t||"bool"===t){for(var n="int32"===t?new Int32Array(e.length):new Uint8Array(e.length),r=0;r<n.length;++r)n[r]=Math.round(e[r]);return n}throw new Error("Unknown dtype ".concat(t))}(t,r)),n.values}},{key:"acquireTexture",value:function(e,t,n,r){if(this.numBytesInGPU+=this.computeBytes(e,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var a=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: ".concat(a," MB, most likely due to a memory leak"))}return this.textureManager.acquireTexture(e,t,r)}},{key:"computeBytes",value:function(e,t){return e[0]*e[1]*Ga.bytesPerElement(t)}},{key:"checkCompileCompletion",value:function(){for(var e=0,t=Object.entries(this.binaryCache);e<t.length;e++){var n=Object(y.a)(t[e],2)[1];this.checkCompletion_(n)}}},{key:"checkCompileCompletionAsync",value:function(){var e=Object(w.a)(k.a.mark((function e(){var t,n,r,a,i,o,s,u,c=this;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=[],!this.gpgpu.parallelCompilationExtension){e.next=6;break}for(n=0,r=Object.entries(this.binaryCache);n<r.length;n++)a=Object(y.a)(r[n],2),i=a[1],t.push(this.checkCompletionAsync_(i));return e.abrupt("return",Promise.all(t));case 6:for(o=function(){var e=Object(y.a)(u[s],2)[1],n=new Promise((function(t){try{c.checkCompletion_(e),t(!0)}catch(o$){throw o$}}));t.push(n)},s=0,u=Object.entries(this.binaryCache);s<u.length;s++)o();return e.abrupt("return",Promise.all(t));case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"checkCompletionAsync_",value:function(){var e=Object(w.a)(k.a.mark((function e(t){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)){e.next=4;break}e.t0=this.checkCompletion_(t),e.next=7;break;case 4:return e.next=6,Pm();case 6:e.t0=this.checkCompletionAsync_(t);case 7:return e.abrupt("return",e.t0);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"checkCompletion_",value:function(e){if(!1===this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS))throw console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),!1===this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)?(iz(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}},{key:"getUniformLocations",value:function(){for(var e=0,t=Object.values(this.binaryCache);e<t.length;e++){var n=t[e];this.gpgpu.buildVao(n.webGLProgram);var r=OL(this.gpgpu,n.program,n.webGLProgram),a=r.variablesLocations,i=r.customUniformLocations,o=r.infLoc,s=r.nanLoc,u=r.outShapeLocation,c=r.outShapeStridesLocation,l=r.outTexShapeLocation;n.variablesLocations=a,n.customUniformLocations=i,n.infLoc=o,n.nanLoc=s,n.outShapeLocation=u,n.outShapeStridesLocation=c,n.outTexShapeLocation=l}}},{key:"createTensorFromGPUData",value:function(e,t,n){e.channels=e.channels||"RGBA";var r=e.texture,a=e.height,i=e.width,o=e.channels,s=Ds().backend;if(!s.gpgpu.gl.isTexture(r))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");var u=s.writeTexture(r,t,n,a,i,o);return Ds().makeTensorFromDataId(u,t,n,s)}}]),n}(se);jB.nextDataId=0;var TB="4.7.0";function CB(){st().set("WEBGL_FORCE_F16_TEXTURES",!0)}eo.isBrowser()&&Ks("webgl",(function(){return new jB}),2);var EB={forceHalfFloat:CB},_B=function e(t,n,r){Object(O.a)(this,e),this.variableNames=["A","B"],this.outputShape=Wm.assertAndGetBroadcastShape(n,r),this.enableShapeUniforms=jL(this.outputShape.length),this.userCode="\n      float binaryOperation(float a, float b) {\n        ".concat(t,"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    ")},AB="\n  result.r = isNaN.r ? NAN : result.r;\n  result.g = isNaN.g ? NAN : result.g;\n  result.b = isNaN.b ? NAN : result.b;\n  result.a = isNaN.a ? NAN : result.a;\n",RB=function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];Object(O.a)(this,e),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Wm.assertAndGetBroadcastShape(n,r);var i=this.outputShape.length;this.enableShapeUniforms=jL(i);var o="";if(a)if(0===i||1===Ga.sizeFromShape(this.outputShape))o="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(o="\n          ".concat(gL(i)," coords = getOutputCoords();\n        "),1===i)this.enableShapeUniforms?o+="\n            result.y = (coords + 1) >= outShape ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ":o+="\n            result.y = (coords + 1) >= ".concat(this.outputShape[0]," ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ");else{var s=tB("coords",i);this.enableShapeUniforms?o+="\n            bool nextRowOutOfBounds =\n              (".concat(s[i-2]," + 1) >= outShape[").concat(i," - 2];\n            bool nextColOutOfBounds =\n              (").concat(s[i-1]," + 1) >= outShape[").concat(i," - 1];\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          "):o+="\n            bool nextRowOutOfBounds =\n              (".concat(s[i-2]," + 1) >= ").concat(this.outputShape[i-2],";\n            bool nextColOutOfBounds =\n              (").concat(s[i-1]," + 1) >= ").concat(this.outputShape[i-1],";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          ")}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        ".concat(t,"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        ").concat(o,"\n\n        setOutput(result);\n      }\n    ")};function DB(e){var t=e.inputs,n=e.backend,r=t.x;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var FB={kernelName:Cn,backendName:"webgl",kernelFunc:DB};function MB(e){var t=e.inputs,n=e.backend,r=t.real,a=t.imag,i=n.makeTensorInfo(r.shape,"complex64"),o=n.texData.get(i.dataId),s=DB({inputs:{x:r},backend:n}),u=DB({inputs:{x:a},backend:n});return o.complexTensorInfos={real:s,imag:u},i}var zB={kernelName:Pt,backendName:"webgl",kernelFunc:MB},LB="return (a < 0.) ? b * a : a;",PB="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";var BB={kernelName:Fn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.alpha,o=n.makeTensorInfo([],"float32",Ga.createScalarValue(i,"float32")),s=st().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new RB(PB,a.shape,o.shape):new _B(LB,a.shape,o.shape),u=n.runWebGLProgram(s,[a,o],"float32");return n.disposeIntermediateTensorInfo(o),u}},WB="return (a < 0.) ? b * a : a;",UB="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";var VB={kernelName:kr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=t.alpha,i=st().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new RB(UB,r.shape,a.shape):new _B(WB,r.shape,a.shape);return n.runWebGLProgram(i,[r,a],"float32")}};function GB(e){var t=e.opSnippet,n=e.packedOpSnippet,r=e.cpuKernelImpl,a=e.dtype;return function(e){var i,o=e.inputs,s=e.backend,u=o.x,c=s,l=a||u.dtype;if(c.shouldExecuteOnCPU([u])&&null!=r){var d=c.texData.get(u.dataId),p=r(d.values,l);return c.makeTensorInfo(u.shape,l,p)}return i=st().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&null!=n?new wB(u.shape,n):new uB(u.shape,t),c.runWebGLProgram(i,[u],l)}}function HB(e){var t=e.opSnippet,n=e.packedOpSnippet,r=e.checkOutOfBounds,a=void 0!==r&&r,i=e.supportsComplex,o=void 0!==i&&i,s=e.cpuKernelImpl,u=e.dtype;return function(e){var r=e.inputs,i=e.backend,c=r.a,l=r.b,d=i;if(o&&"complex64"===c.dtype){var p=d.texData.get(c.dataId),f=d.texData.get(l.dataId),h=[[p.complexTensorInfos.real,f.complexTensorInfos.real],[p.complexTensorInfos.imag,f.complexTensorInfos.imag]].map((function(e){var n=Object(y.a)(e,2),r=n[0],a=n[1],i={dataId:r.dataId,dtype:r.dtype,shape:c.shape},o={dataId:a.dataId,dtype:a.dtype,shape:l.shape},s=new _B(t,c.shape,l.shape);return d.runWebGLProgram(s,[i,o],Li(r.dtype,a.dtype))})),m=Object(y.a)(h,2),v=m[0],b=m[1],g=MB({inputs:{real:v,imag:b},backend:d});return d.disposeIntermediateTensorInfo(v),d.disposeIntermediateTensorInfo(b),g}var x,k=u||Li(c.dtype,l.dtype);if(("string"===c.dtype||"string"===l.dtype||d.shouldExecuteOnCPU([c,l]))&&null!=s){var w=d.texData.get(c.dataId).values,O=d.texData.get(l.dataId).values,I="string"===c.dtype?Wm.fromUint8ToStringArray(w):w,S="string"===c.dtype?Wm.fromUint8ToStringArray(O):O,N=s(c.shape,l.shape,I,S,k),j=Object(y.a)(N,2),T=j[0],C=j[1],E=d.makeTensorInfo(C,k);return d.texData.get(E.dataId).values=T,E}return x=st().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&null!=n?new RB(n,c.shape,l.shape,a):new _B(t,c.shape,l.shape),d.runWebGLProgram(x,[c,l],k)}}function qB(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("linear"===e)return t?bB:lB;if("relu"===e)return t?yB:fB;if("elu"===e)return t?gB:pB;if("relu6"===e)return t?xB:hB;if("prelu"===e)return t?UB:WB;if("leakyrelu"===e)return t?PB:LB;if("sigmoid"===e)return t?kB:vB;throw new Error("Activation ".concat(e," has not been implemented for the WebGL backend."))}var KB=function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,u=arguments.length>7&&void 0!==arguments[7]&&arguments[7],c=arguments.length>8&&void 0!==arguments[8]&&arguments[8];Object(O.a)(this,e),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r,this.enableShapeUniforms=jL(this.outputShape.length);var l=a?t[1]:t[2],d=Math.ceil(l/2),p=a?"i * 2, rc.y":"rc.y, i * 2",f=i?"rc.z, i * 2":"i * 2, rc.z",h=a?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],m=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],v="",b="";s&&(v=u?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ".concat(s,"\n        }"):c?"vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ".concat(s,"\n        }"):"vec4 activation(vec4 x) {\n          ".concat(s,"\n        }"),b="result = activation(result);");var g=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),u&&this.variableNames.push("preluActivationWeights"),c&&this.variableNames.push("leakyreluAlpha");var y="rc.x",x="rc.x";t[0]<n[0]?y="imod(rc.x, ".concat(t[0],")"):n[0]<t[0]&&(x="imod(rc.x, ".concat(n[0],")")),this.userCode="\n      ".concat(v,"\n      // Don't use uniform for sharedDimensionPacked for performance.\n      const float sharedDimension = ").concat(d,".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        int batchA = ").concat(y,";\n        int batchB = ").concat(x,";\n        for (int i = 0; i < ").concat(d,"; i++) {\n          vec4 a = getMatrixA(batchA, ").concat(p,");\n          vec4 b = getMatrixB(batchB, ").concat(f,");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += (").concat(h[0]," * ").concat(m[0],");\n          result += (").concat(h[1]," * ").concat(m[1],");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        ").concat(g,"\n\n        ").concat(b,"\n\n        setOutput(result);\n      }\n    ")},XB="return areal * breal - aimag * bimag;",YB="return areal * bimag + aimag * breal;",ZB=function e(t,n,r){Object(O.a)(this,e),this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Wm.assertAndGetBroadcastShape(n,r),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        ".concat(t,"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    ")},JB="return a * b;";function QB(e){var t,n=e.inputs,r=e.backend,a=n.a,i=n.b,o=Wm.upcastType(a.dtype,i.dtype);if("complex64"===a.dtype){var s=r.texData.get(a.dataId),u=r.texData.get(i.dataId),c=new ZB(XB,a.shape,i.shape),l=new ZB(YB,a.shape,i.shape),d=[{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:a.shape},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:a.shape},{dataId:u.complexTensorInfos.real.dataId,dtype:u.complexTensorInfos.real.dtype,shape:i.shape},{dataId:u.complexTensorInfos.imag.dataId,dtype:u.complexTensorInfos.imag.dtype,shape:i.shape}],p=r.runWebGLProgram(c,d,"float32"),f=r.runWebGLProgram(l,d,"float32"),h=MB({inputs:{real:p,imag:f},backend:r});return r.disposeIntermediateTensorInfo(p),r.disposeIntermediateTensorInfo(f),h}if(r.shouldExecuteOnCPU([a,i])){var m=r.texData.get(a.dataId),v=r.texData.get(i.dataId),b=jP(a.shape,i.shape,m.values,v.values,o),g=Object(y.a)(b,2),x=g[0],k=g[1],w=r.makeTensorInfo(k,o);return r.texData.get(w.dataId).values=x,w}return t=st().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new RB(JB,a.shape,i.shape):new _B(JB,a.shape,i.shape),r.runWebGLProgram(t,[a,i],o)}var $B={kernelName:cr,backendName:"webgl",kernelFunc:QB};function eW(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.shape,o=n,s=Ga.sizeFromShape(a.shape),u=Ga.inferFromImplicitShape(i,s),c=Ga.sizeFromShape(u);Ga.assert(s===c,(function(){return"The new shape (".concat(u,") has ").concat(c," elements and the old shape (").concat(a.shape,") has ").concat(s," elements. The new shape and old shape must have the same number of elements.")}));var l=o.texData.get(a.dataId);return!l.isPacked||Rz(a.shape,u)||null!==l.texture&&Rz(l.shape,u)?(o.incRef(a.dataId),{dataId:a.dataId,shape:u,dtype:a.dtype}):function(e,t,n){var r=[Tz(e.shape)].concat(Object(S.a)(Cz(e.shape))),a={dtype:e.dtype,shape:r,dataId:e.dataId},i=[Tz(t)].concat(Object(S.a)(Cz(t))),o=new rB(i,r),s=[r],u=n.runWebGLProgram(o,[a],e.dtype,s,!0);return{dataId:u.dataId,shape:t,dtype:u.dtype}}(a,u,o)}var tW={kernelName:Er,backendName:"webgl",kernelFunc:eW},nW=function e(t,n){Object(O.a)(this,e),this.variableNames=["x"];var r=t.windowSize,a=t.batchSize,i=t.inSize,o=t.outSize;this.outputShape=[a,o];var s=4*Math.floor(r/4),u=r%4,c="sumValue += dot(values, ones);";if(null!=n){var l=1/n;c="sumValue += dot(values * ".concat(Ga.isInt(l)?l.toPrecision(2):l,", ones);")}var d="";i%r>0&&(d="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return 0.0;\n        }\n      ")),this.userCode="\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ".concat(d,"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ").concat(r,";\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ").concat(s,"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ").concat(c,"\n        }\n\n        int inIdx = inOffset + ").concat(s,";\n        if (").concat(1===u,") {\n          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);\n\n          ").concat(c,"\n        } else if (").concat(2===u,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1), 0.0, 0.0);\n\n          ").concat(c,"\n        } else if (").concat(3===u,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2), 0.0);\n\n          ").concat(c,"\n        }\n        setOutput(sumValue);\n      }\n    ")},rW=function e(t,n){Object(O.a)(this,e),this.variableNames=["x"];var r=t.windowSize,a=t.batchSize,i=t.inSize,o=t.outSize;this.outputShape=[a,o];var s="0.0",u="";"prod"===n?s="1.0":"min"===n?(s="1.0 / 1e-20",u="min"):"max"===n&&(s="-1.0 / 1e-20",u="max");var c="".concat(n,"(").concat(n,"(").concat(n,"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])");"sum"===n?c="sumValue":"prod"===n?c="prodValue":"all"===n?c="allValue":"any"===n&&(c="anyValue");var l=4*Math.floor(r/4),d=r%4,p="\n      if (".concat("sum"===n,") {\n        sumValue += dot(values, ones);\n      } else if (").concat("prod"===n,") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = ").concat(u,"(values, minMaxValue);\n        if (").concat("min"===n," || ").concat("max"===n,") {\n          minMaxValue = ").concat(u,"(values, minMaxValue);\n          bvec4 isNaN = isnan(values);\n          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {\n            minMaxValue = vec4(NAN);\n          }\n        }\n      }\n    "),f="vec4";"all"===n?(s="1.0",p="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",f="bvec4"):"any"===n&&(s="0.0",p="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",f="bvec4");var h="";i%r>0&&(h="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return initializationValue;\n        }\n      ")),this.userCode="\n      const float initializationValue = ".concat(s,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ").concat(h,"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ").concat(r,";\n\n        vec4 minMaxValue = vec4(").concat(s,");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < ").concat(l,"; i += 4) {\n          int inIdx = inOffset + i;\n          ").concat(f," values = ").concat(f,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ").concat(p,"\n        }\n\n        int inIdx = inOffset + ").concat(l,";\n        if (").concat(1===d,") {\n          ").concat(f," values = ").concat(f,"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          ").concat(p,"\n        } else if (").concat(2===d,") {\n          ").concat(f," values = ").concat(f,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          ").concat(p,"\n        } else if (").concat(3===d,") {\n          ").concat(f," values = ").concat(f,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          ").concat(p,"\n        }\n        setOutput(").concat(c,");\n      }\n    ")};function aW(e,t,n,r){for(var a=function(e){for(var t=[];0===t.length||1!==t[t.length-1].outSize;){var n=t.length?t[t.length-1].outSize:e[1],r=Wm.computeOptimalWindowSize(n);t.push({inSize:n,windowSize:r,outSize:Math.ceil(n/r)})}return t}(e.shape),i=e,o=0;o<a.length;o++){var s,u=a[o],c=u.inSize,l=u.windowSize,d=u.outSize,p=void 0;p="mean"===n?0===o?new nW({windowSize:l,inSize:c,batchSize:e.shape[0],outSize:d},c):new nW({windowSize:l,inSize:c,batchSize:e.shape[0],outSize:d}):new rW({windowSize:l,inSize:c,batchSize:e.shape[0],outSize:d},n),s=i,i=r.runWebGLProgram(p,[i],t),s.dataId!==e.dataId&&r.disposeIntermediateTensorInfo(s)}return i}var iW=function e(t,n){Object(O.a)(this,e),this.variableNames=["A"];for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[n[a]];this.outputShape=r,this.rank=r.length;var i=gL(this.rank),o=function(e){var t=e.length;if(t>6)throw Error("Transpose for rank ".concat(t," is not yet supported"));for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t),a=0;a<e.length;a++)r[e[a]]=n[a];return r.join()}(n);this.userCode="\n    void main() {\n      ".concat(i," resRC = getOutputCoords();\n      setOutput(getA(").concat(o,"));\n    }\n    ")};var oW=function e(t,n){Object(O.a)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[n[a]];if(this.outputShape=r,this.rank=r.length,this.rank>6)throw Error("Packed transpose for rank ".concat(this.rank," is not yet supported."));for(var i=gL(this.rank),o=eB("rc",this.rank),s=new Array(this.rank),u=0;u<n.length;u++)s[n[u]]=o[u];var c="vec2(".concat(s.slice(-2).join(),")"),l="++".concat(o[this.rank-1]," < ").concat(r[this.rank-1]),d="getChannel(getA(".concat(s.join(),"), ").concat(c,")");this.userCode="\n    void main() {\n      ".concat(i," rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = ").concat(d,";\n      if(").concat(l,") {\n        result[1] = ").concat(d,";\n      }\n      --").concat(o[this.rank-1],";\n      if(++").concat(o[this.rank-2]," < ").concat(r[this.rank-2],") {\n        result[2] = ").concat(d,";\n        if(").concat(l,") {\n          result[3] = ").concat(d,";\n        }\n      }\n      setOutput(result);\n    }\n    ")};function sW(e,t,n){var r=st().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new oW(e.shape,t):new iW(e.shape,t);return n.runWebGLProgram(r,[e],e.dtype)}function uW(e){var t=e.inputs,n=e.backend,r=e.attrs;return function(e,t,n,r){var a=t,i=e.shape.length,o=Ga.parseAxisParam(a,e.shape),s=o,u=Wm.getAxesPermutation(s,i),c=null!=u,l=e;c&&(l=sW(e,u,r),s=Wm.getInnerMostAxes(s.length,i)),Wm.assertAxesAreInnerMostDims("sum",s,i);var d=Wm.computeOutAndReduceShapes(l.shape,s),p=Object(y.a)(d,2),f=p[0],h=p[1],m=f;n&&(m=Wm.expandShapeToKeepDim(f,o));var v=Ga.sizeFromShape(h),b=eW({inputs:{x:l},attrs:{shape:[Ga.sizeFromShape(e.shape)/v,v]},backend:r}),g=aW(b,Pi(e.dtype),"sum",r),x=eW({inputs:{x:g},attrs:{shape:m},backend:r});return r.disposeIntermediateTensorInfo(b),r.disposeIntermediateTensorInfo(g),c&&r.disposeIntermediateTensorInfo(l),x}(t.x,r.axis,r.keepDims,n)}var cW={kernelName:Jr,backendName:"webgl",kernelFunc:uW};function lW(e){for(var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.perm,s=r,u=i.shape.length,c=new Array(u),l=0;l<c.length;l++)c[l]=i.shape[o[l]];if(s.shouldExecuteOnCPU([i])){var d=s.texData.get(i.dataId).values,p=QP(d,i.shape,i.dtype,o,c);t=s.makeTensorInfo(c,i.dtype),s.texData.get(t.dataId).values=p}else t=sW(i,o,s);return t}var dW={kernelName:ya,backendName:"webgl",kernelFunc:lW};function pW(e){var t=e.a,n=e.b,r=e.transposeA,a=e.transposeB,i=e.backend,o=e.bias,s=void 0===o?null:o,u=e.preluActivationWeights,c=void 0===u?null:u,l=e.leakyreluAlpha,d=void 0===l?0:l,p=e.activation,f=void 0===p?null:p,h=t.shape.length,m=n.shape.length,v=r?t.shape[h-2]:t.shape[h-1],b=a?n.shape[m-1]:n.shape[m-2],g=r?t.shape[h-1]:t.shape[h-2],y=a?n.shape[m-2]:n.shape[m-1],x=t.shape.slice(0,-2),k=n.shape.slice(0,-2),w=Ga.sizeFromShape(x),O=Ga.sizeFromShape(k),I=gc.assertAndGetBroadcastShape(t.shape.slice(0,-2),n.shape.slice(0,-2)).concat([g,y]);Ga.assert(v===b,(function(){return"Error in matMul: inner shapes (".concat(v,") and (").concat(b,") of Tensors with shapes ").concat(t.shape," and ").concat(n.shape," and transposeA=").concat(r," and transposeB=").concat(a," must match.")}));var S,N=r?[w,v,g]:[w,g,v],j=a?[O,y,b]:[O,b,y],T=eW({inputs:{x:t},backend:i,attrs:{shape:N}}),C=eW({inputs:{x:n},backend:i,attrs:{shape:j}}),E=[T,C],_=Math.max(w,O),A=r?T.shape[1]:T.shape[2],R=null!=s,D=null!=c,F="leakyrelu"===f,M=null!=f?qB(f,!0):null;if((1===g||1===y)&&A>1e3&&!1===(R||D||F||null!=M)){var z=T,L=C;r&&(z=lW({inputs:{x:T},backend:i,attrs:{perm:[0,2,1]}}),E.push(z)),a&&(L=lW({inputs:{x:C},backend:i,attrs:{perm:[0,2,1]}}),E.push(L));var P=1===y,B=z;1!==y&&(B=eW({inputs:{x:z},backend:i,attrs:{shape:[_,A,1]}}),E.push(B));var W=1===y?2:1,U=L;P&&(U=eW({inputs:{x:L},backend:i,attrs:{shape:[_,1,A]}}),E.push(U));var V=QB({inputs:{a:B,b:U},backend:i});S=uW({inputs:{x:V},backend:i,attrs:{axis:W,keepDims:!0}}),E.push(V)}else{var G=Li(t.dtype,n.dtype),H=new KB(N,j,[_,g,y],r,a,R,M,D,F),q=[T,C];if(null!=s&&q.push(s),D&&q.push(c),F){var K=i.makeTensorInfo([],"float32",Ga.createScalarValue(d,"float32"));q.push(K),E.push(K)}S=i.runWebGLProgram(H,q,G)}var X=eW({inputs:{x:S},backend:i,attrs:{shape:I}});E.push(S);for(var Y=0,Z=E;Y<Z.length;Y++){var J=Z[Y];i.disposeIntermediateTensorInfo(J)}return X}var fW={kernelName:Ta,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.a,i=t.b,o=t.bias,s=t.preluActivationWeights,u=r.transposeA,c=r.transposeB,l=r.activation;return pW({a:a,b:i,transposeA:u,transposeB:c,backend:n,bias:o,preluActivationWeights:s,leakyreluAlpha:r.leakyreluAlpha,activation:l})}},hW="return abs(x);";var mW={kernelName:pt,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=n.x;if(r.shouldExecuteOnCPU([a])&&"complex64"!==a.dtype){var i=r.texData.get(a.dataId),o=LP(i.values);return r.makeTensorInfo(a.shape,a.dtype,o)}return t=st().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new wB(a.shape,hW):new uB(a.shape,hW),r.runWebGLProgram(t,[a],a.dtype)}},vW=GB({opSnippet:"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n"}),bW={kernelName:ft,backendName:"webgl",kernelFunc:vW},gW=GB({opSnippet:"if (isnan(x)) return x;\n  if (x < 1.0) return NAN;\nreturn log(x + sqrt(x * x - 1.0));"}),yW={kernelName:ht,backendName:"webgl",kernelFunc:gW},xW="return a + b;",kW=HB({opSnippet:xW,packedOpSnippet:xW,supportsComplex:!0,cpuKernelImpl:iP}),wW={kernelName:mt,backendName:"webgl",kernelFunc:kW},OW=function e(t,n){Object(O.a)(this,e),this.outputShape=[],this.outputShape=t,this.variableNames=n.map((function(e,t){return"T".concat(t)}));var r=[];this.variableNames.forEach((function(e){r.push("float v".concat(e," = get").concat(e,"AtOutCoords();"))}));var a=this.variableNames.map((function(e){return"v".concat(e)})).join(" + ");this.userCode="\n      void main() {\n        ".concat(r.join("\n        "),"\n\n        float result = ").concat(a,";\n        setOutput(result);\n      }\n    ")},IW=function e(t,n){Object(O.a)(this,e),this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.variableNames=n.map((function(e,t){return"T".concat(t)}));var r=[];this.variableNames.forEach((function(e){r.push("vec4 v".concat(e," = get").concat(e,"AtOutCoords();"))}));var a=this.variableNames.map((function(e){return"v".concat(e)})).join(" + ");this.userCode="\n      void main() {\n        ".concat(r.join("\n        "),"\n\n        vec4 result = ").concat(a,";\n        setOutput(result);\n      }\n    ")};var SW={kernelName:vt,backendName:"webgl",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=n;if(1===a.length)return DB({inputs:{x:a[0]},backend:r});if(a.length>st().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var i=Math.floor(a.length/2),o=e({inputs:a.slice(0,i),backend:r}),s=e({inputs:a.slice(i),backend:r});return e({inputs:[o,s],backend:r})}var u=a.map((function(e){return e.dtype})).reduce((function(e,t){return Li(e,t)})),c=a.map((function(e){return e.shape})),l=st().getBool("WEBGL_PACK")?new IW(a[0].shape,c):new OW(a[0].shape,c);return r.runWebGLProgram(l,a,u)}};var NW={kernelName:bt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims,s=a.shape.length,u=Ga.parseAxisParam(i,a.shape),c=u,l=Wm.getAxesPermutation(c,s),d=a;null!=l&&(d=lW({inputs:{x:a},backend:n,attrs:{perm:l}}),c=Wm.getInnerMostAxes(c.length,s)),Wm.assertAxesAreInnerMostDims("all",c,s);var p,f=Wm.computeOutAndReduceShapes(d.shape,c),h=Object(y.a)(f,2),m=h[0],v=h[1],b=eW({inputs:{x:d},backend:n,attrs:{shape:[-1,Ga.sizeFromShape(v)]}}),g=aW(b,b.dtype,"all",n);return p=eW(o?{inputs:{x:g},backend:n,attrs:{shape:Wm.expandShapeToKeepDim(m,u)}}:{inputs:{x:g},backend:n,attrs:{shape:m}}),n.disposeIntermediateTensorInfo(b),n.disposeIntermediateTensorInfo(g),null!=l&&n.disposeIntermediateTensorInfo(d),p}};var jW={kernelName:gt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims,s=a.shape.length,u=Ga.parseAxisParam(i,a.shape),c=u,l=Wm.getAxesPermutation(c,s),d=a;null!=l&&(d=lW({inputs:{x:a},backend:n,attrs:{perm:l}}),c=Wm.getInnerMostAxes(c.length,s)),Wm.assertAxesAreInnerMostDims("any",c,s);var p,f=Wm.computeOutAndReduceShapes(d.shape,c),h=Object(y.a)(f,2),m=h[0],v=h[1],b=eW({inputs:{x:d},backend:n,attrs:{shape:[-1,Ga.sizeFromShape(v)]}}),g=aW(b,b.dtype,"any",n);return p=eW(o?{inputs:{x:g},backend:n,attrs:{shape:Wm.expandShapeToKeepDim(m,u)}}:{inputs:{x:g},backend:n,attrs:{shape:m}}),n.disposeIntermediateTensorInfo(b),n.disposeIntermediateTensorInfo(g),null!=l&&n.disposeIntermediateTensorInfo(d),p}},TW=function e(t,n,r){Object(O.a)(this,e),this.variableNames=["A"];var a=t.windowSize,i=t.batchSize,o=t.outSize;r||this.variableNames.push("bestIndicesA"),this.outputShape=[i,o];var s="max"===n?">":"<",u=r?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ".concat(a,";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < ").concat(a,"; i++) {\n          int inIdx = ").concat(u,";\n          float candidate = getA(batch, inIdx);\n          if (candidate ").concat(s," bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    ")},CW=function e(t,n,r,a){Object(O.a)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,Ga.assert(t.length>2,(function(){return"Packed arg".concat(r.charAt(0).toUpperCase()+r.slice(1)," supports only inputs with rank above 2.")}));var i=t[t.length-1],o=Math.ceil(i/n);this.outputShape=t.slice(0,-1),o>1&&this.outputShape.push(o),a||this.variableNames.push("bestIndicesA");var s,u,c=this.outputShape,l=c.length,d=gL(l),p=tB("coords",l);if(1===o){var f=gL(u=l+1);s="\n        ".concat(f," sourceLocR = ").concat(f,"(").concat(p.join(),", 0);\n        ++").concat(p[l-1],";\n        ").concat(f," sourceLocG = ").concat(f,"(").concat(p.join(),", 0);\n        ++").concat(p[l-2],";\n        ").concat(f," sourceLocA = ").concat(f,"(").concat(p.join(),", 0);\n        --").concat(p[l-1],";\n        ").concat(f," sourceLocB = ").concat(f,"(").concat(p.join(),", 0);\n        --").concat(p[l-2],";")}else u=l,s="\n        ".concat(d," sourceLocR = coords;\n        ++").concat(p[l-1],";\n        ").concat(d," sourceLocG = coords;\n        ++").concat(p[l-2],";\n        ").concat(d," sourceLocA = coords;\n        --").concat(p[l-1],";\n        ").concat(d," sourceLocB = coords;\n        --").concat(p[l-2],";");var h=["x","y","z","w","u","v"].slice(0,u),m="."+h[u-1],v=h.map((function(e){return"int "+e})),b=tB("sourceLocR",u-1).concat("inIdx.r"),g=tB("sourceLocG",u-1).concat("inIdx.g"),y=tB("sourceLocB",u-1).concat("inIdx.b"),x=tB("sourceLocA",u-1).concat("inIdx.a"),k="max"===r?"greaterThan":"lessThan",w=a?"":"\n          inIdx = round(vec4(getBestIndicesAChannel(".concat(b.join(),"),\n                             getBestIndicesAChannel(").concat(g.join(),"),\n                             getBestIndicesAChannel(").concat(y.join(),"),\n                             getBestIndicesAChannel(").concat(x.join(),")));"),I="vec4(\n            getAChannel(".concat(b.join(),"),\n            hasNextCol ? getAChannel(").concat(g.join(),") : 0.,\n            hasNextRow ? getAChannel(").concat(y.join(),") : 0.,\n            hasNextRow && hasNextCol ? getAChannel(").concat(x.join(),") : 0.)"),S=a?"":"\n      float getBestIndicesAChannel(".concat(v.join(),") {\n        return getChannel(getBestIndicesA(").concat(h.join(),"),\n                                          vec2(").concat(h.slice(-2).join(),"));\n      }");this.userCode="\n      float getAChannel(".concat(v.join(),") {\n        return getChannel(getA(").concat(h.join(),"),\n                               vec2(").concat(h.slice(-2).join(),"));\n      }\n      ").concat(S,"\n      void main() {\n        ").concat(d," coords = getOutputCoords();\n        bool hasNextCol = ").concat(p[l-1]," < ").concat(c[l-1]-1,";\n        bool hasNextRow = ").concat(p[l-2]," < ").concat(c[l-2]-1,";\n        ").concat(s,"\n        ivec4 srcIdx = ivec4(sourceLocR").concat(m,", sourceLocG").concat(m,",\n          sourceLocB").concat(m,", sourceLocA").concat(m,") * ").concat(n,";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = ").concat(I,";\n\n        for (int i = 0; i < ").concat(n,"; i++) {\n          inIdx = srcIdx;\n          ").concat(w,"\n          vec4 candidate = ").concat(I,";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4(").concat(k,"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    ")};function EW(e,t,n,r){var a=[n];if(Wm.assertAxesAreInnerMostDims("arg"+r.charAt(0).toUpperCase()+r.slice(1),a,t.shape.length),!st().getBool("WEBGL_PACK_REDUCE")||t.shape.length<=2){var i=[],o=e.texData.get(t.dataId),s=t;null!==o&&o.isPacked&&(s=e.unpackTensor(t),i.push(s));var u=Wm.computeOutAndReduceShapes(s.shape,a),c=Object(y.a)(u,2),l=c[0],d=c[1],p=Ga.sizeFromShape(d),f=eW({inputs:{x:s},backend:e,attrs:{shape:[-1,p]}});i.push(f);var h=function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=n.shape[0],o=n.shape[1];null!=a&&(i=a.shape[0],o=a.shape[1]);var s=Wm.computeOptimalWindowSize(o),u={windowSize:s,inSize:o,batchSize:i,outSize:Math.ceil(o/s)},c=new TW(u,r,null==a),l=[n];null!=a&&l.push(a);var d=t.runWebGLProgram(c,l,"int32");if(1===d.shape[1])return d;var p=e(t,n,r,d);return t.disposeIntermediateTensorInfo(d),p}(e,f,r);i.push(h);var m=eW({inputs:{x:h},backend:e,attrs:{shape:l}});return i.forEach((function(t){return e.disposeIntermediateTensorInfo(t)})),m}return function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=null!=a?a.shape:n.shape,o=i[i.length-1],s=Wm.computeOptimalWindowSize(o),u=new CW(i,s,r,null==a),c=null==a?[n]:[n,a],l=t.runWebGLProgram(u,c,"int32");if(l.shape.length===n.shape.length){var d=e(t,n,r,l);return t.disposeIntermediateTensorInfo(l),d}return l}(e,t,r)}var _W={kernelName:yt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=Ga.parseAxisParam(i,a.shape),s=Wm.getAxesPermutation(o,a.shape.length),u=a,c=[];null!=s&&(u=lW({inputs:{x:a},backend:n,attrs:{perm:s}}),c.push(u),o=Wm.getInnerMostAxes(o.length,u.shape.length)),Wm.assertAxesAreInnerMostDims("argMax",[o[0]],u.shape.length);var l=EW(n,u,o[0],"max");return c.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),l}};var AW={kernelName:xt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=Ga.parseAxisParam(i,a.shape),s=Wm.getAxesPermutation(o,a.shape.length),u=a,c=[];null!=s&&(u=lW({inputs:{x:a},backend:n,attrs:{perm:s}}),c.push(u),o=Wm.getInnerMostAxes(o.length,u.shape.length)),Wm.assertAxesAreInnerMostDims("argMin",[o[0]],u.shape.length);var l=EW(n,u,o[0],"min");return c.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),l}},RW=GB({opSnippet:"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n"}),DW={kernelName:kt,backendName:"webgl",kernelFunc:RW},FW=GB({opSnippet:"if (isnan(x)) return x;return log(x + sqrt(x * x + 1.0));"}),MW={kernelName:wt,backendName:"webgl",kernelFunc:FW},zW=GB({opSnippet:"if (isnan(x)) return x;\n  return atan(x);\n"}),LW={kernelName:Ot,backendName:"webgl",kernelFunc:zW},PW=HB({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",packedOpSnippet:"\n  vec4 result = atan(a, b);\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  \n  result.r = isNaN.r ? NAN : result.r;\n  result.g = isNaN.g ? NAN : result.g;\n  result.b = isNaN.b ? NAN : result.b;\n  result.a = isNaN.a ? NAN : result.a;\n\n  return result;\n"}),BW={kernelName:St,backendName:"webgl",kernelFunc:PW},WW=GB({opSnippet:"if (isnan(x)) return x;\n  if ((x < -1.0) || (x > 1.0)) return NAN;\nreturn (log(1.0 + x) - log(1.0 - x)) / 2.0;"}),UW={kernelName:It,backendName:"webgl",kernelFunc:WW},VW=function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(Object(O.a)(this,e),this.variableNames=["x"],"avg"===n&&r)throw new Error("Cannot compute positions for average pool.");var o=t.filterWidth,s=t.strideHeight,u=t.strideWidth,c=t.dilationHeight,l=t.dilationWidth,d=t.effectiveFilterHeight,p=t.effectiveFilterWidth,f=t.padInfo.top,h=t.padInfo.left;this.outputShape=t.outShape;var m="avg"===n,v="((batch  * ".concat(t.inHeight," + xR) * ").concat(t.inWidth," + xC) * ").concat(t.inChannels," + d"),b="(xR * ".concat(t.inWidth," + xC) * ").concat(t.inChannels," + d"),g="0.0";if(m||(g="-1.0 / 1e-20"),r){var y=">=";this.userCode="\n        const ivec2 strides = ivec2(".concat(s,", ").concat(u,");\n        const ivec2 pads = ivec2(").concat(f,", ").concat(h,");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < ").concat(d,";\n              wR += ").concat(c,") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(p,";\n                wC += ").concat(l,") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value ").concat(y," currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = ").concat(a?i?v:b:"wR * ".concat(p," + wC"),";\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ")}else{var x="max",k="".concat(n,"(").concat(n,"(").concat(n,"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])");"avg"===n&&(k="avgValue / max(count, 1.0)");var w=4*Math.floor(o/4),I=o%4,S="\n      if (".concat(m,") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = ").concat(x,"(values, minMaxValue);\n      }\n    ");this.userCode="\n      const ivec2 strides = ivec2(".concat(s,", ").concat(u,");\n      const ivec2 pads = ivec2(").concat(f,", ").concat(h,");\n      const float initializationValue = ").concat(g,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= ").concat(t.inWidth,") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(").concat(g,");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < ").concat(d,";\n            wR += ").concat(c,") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= ").concat(t.inHeight,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(w,"; wC += 4) {\n            int xC = xCCorner + wC * ").concat(l,";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              getValue(batch, xR, xC + 2 * ").concat(l,", d),\n              getValue(batch, xR, xC + 3 * ").concat(l,", d)\n            );\n\n            ").concat(S,"\n          }\n\n          int xC = xCCorner + ").concat(w,";\n          if (").concat(1===I,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            ").concat(S,"\n          } else if (").concat(2===I,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              initializationValue,\n              initializationValue\n            );\n\n            ").concat(S,"\n          } else if (").concat(3===I,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              getValue(batch, xR, xC + 2 * ").concat(l,", d),\n              initializationValue\n            );\n\n            ").concat(S,"\n          }\n        }\n        setOutput(").concat(k,");\n      }\n    ")}},GW=function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(Object(O.a)(this,e),this.variableNames=["x"],"avg"===n&&r)throw new Error("Cannot compute positions for average pool.");var o=t.filterWidth,s=t.strideDepth,u=t.strideHeight,c=t.strideWidth,l=t.dilationDepth,d=t.dilationHeight,p=t.dilationWidth,f=t.effectiveFilterDepth,h=t.effectiveFilterHeight,m=t.effectiveFilterWidth,v=t.padInfo.front,b=t.padInfo.top,g=t.padInfo.left;this.outputShape=t.outShape;var y="avg"===n,x="0.0";if(y||(x="-1.0 / 1e-20"),r){var k=">=";this.userCode="\n        const ivec3 strides =\n            ivec3(".concat(s,", ").concat(u,", ").concat(c,");\n        const ivec3 pads = ivec3(").concat(v,", ").concat(b,", ").concat(g,");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < ").concat(f,";\n              wD += ").concat(l,") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= ").concat(t.inDepth,") {\n              continue;\n            }\n\n            for (int wR = 0; wR < ").concat(h,";\n                wR += ").concat(d,") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= ").concat(t.inHeight,") {\n                continue;\n              }\n\n              for (int wC = 0; wC < ").concat(m,";\n                  wC += ").concat(p,") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value ").concat(k," currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition = ").concat(a?i?"(((batch * ".concat(t.inDepth," + xD) * ").concat(t.inHeight," + xR) * ").concat(t.inWidth," + xC) * ").concat(t.inChannels," + ch"):"((xD * ".concat(t.inHeight," + xR) * ").concat(t.inWidth," + xC) * ").concat(t.inChannels," + ch"):"wD * ".concat(h," * ").concat(m," +\n                      wR * ").concat(m," + wC"),";\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ")}else{var w="max",I="".concat(n,"(").concat(n,"(").concat(n,"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])");"avg"===n&&(I="avgValue / max(count, 1.0)");var S=4*Math.floor(o/4),N=o%4,j="\n      if (".concat(y,") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = ").concat(w,"(values, minMaxValue);\n      }\n    ");this.userCode="\n      const ivec3 strides =\n        ivec3(".concat(s,", ").concat(u,", ").concat(c,");\n      const ivec3 pads = ivec3(").concat(v,", ").concat(b,", ").concat(g,");\n      const float initializationValue = ").concat(x,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= ").concat(t.inWidth,") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(").concat(x,");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < ").concat(f,";\n            wD += ").concat(l,") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= ").concat(t.inDepth,") {\n            continue;\n          }\n\n          for (int wR = 0; wR < ").concat(h,";\n            wR += ").concat(d,") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(S,"; wC += 4) {\n              int xC = xCCorner + wC * ").concat(p,";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(p,", ch),\n                getValue(batch, xD, xR, xC + 2 * ").concat(p,", ch),\n                getValue(batch, xD, xR, xC + 3 * ").concat(p,", ch)\n              );\n\n              ").concat(j,"\n            }\n\n            int xC = xCCorner + ").concat(S,";\n            if (").concat(1===N,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              ").concat(j,"\n            } else if (").concat(2===N,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(p,", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              ").concat(j,"\n            } else if (").concat(3===N,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(p,", ch),\n                getValue(batch, xD, xR, xC + 2 * ").concat(p,", ch),\n                initializationValue\n              );\n\n              ").concat(j,"\n            }\n          }\n        }\n        setOutput(").concat(I,");\n      }\n    ")}};var HW={kernelName:Nt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;Hz(a,"avgPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode;Ga.assert(Wm.eitherStridesOrDilationsAreOne(o,1),(function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides ".concat(o," and dilations '").concat(1,"'")}));var c=Wm.computePool2DInfo(a.shape,i,o,1,s,u);if(1===c.filterWidth&&1===c.filterHeight&&Ga.arraysEqual(c.inShape,c.outShape))return DB({inputs:{x:a},backend:n});var l=new VW(c,"avg",!1);return n.runWebGLProgram(l,[a],"float32")}};var qW={kernelName:Tt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=r.dataFormat,l=Wm.computePool3DInfo(a.shape,i,o,[1,1,1],s,u,c),d=new GW(l,"avg",!1);return n.runWebGLProgram(d,[a],"float32")}},KW=function e(t){Object(O.a)(this,e),this.variableNames=["dy"],this.outputShape=t.inShape;var n=t.filterHeight,r=t.filterWidth,a=t.strideHeight,i=t.strideWidth,o=t.dilationHeight,s=t.dilationWidth,u=t.effectiveFilterHeight,c=t.effectiveFilterWidth,l=u-1-t.padInfo.top,d=c-1-t.padInfo.left,p=1/(n*r);this.userCode="\n      const ivec2 pads = ivec2(".concat(l,", ").concat(d,");\n      const float avgMultiplier = float(").concat(p,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(u,";\n            wR += ").concat(o,") {\n          float dyR = float(dyRCorner + wR) / ").concat(a,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ").concat(c,";\n            wC+= ").concat(s,") {\n            float dyC = float(dyCCorner + wC) / ").concat(i,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},XW=function e(t){Object(O.a)(this,e),this.variableNames=["dy"],this.outputShape=t.inShape;var n=t.filterDepth,r=t.filterHeight,a=t.filterWidth,i=t.strideDepth,o=t.strideHeight,s=t.strideWidth,u=t.dilationDepth,c=t.dilationHeight,l=t.dilationWidth,d=t.effectiveFilterDepth,p=t.effectiveFilterHeight,f=t.effectiveFilterWidth,h=d-1-t.padInfo.front,m=p-1-t.padInfo.top,v=f-1-t.padInfo.left,b=1/(n*r*a);this.userCode="\n      const ivec3 pads = ivec3(".concat(h,", ").concat(m,", ").concat(v,");\n      const float avgMultiplier = float(").concat(b,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ").concat(d,";\n            wD += ").concat(u,") {\n          float dyD = float(dyDCorner + wD) / ").concat(i,".0;\n\n          if (dyD < 0.0 || dyD >= ").concat(t.outDepth,".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ").concat(p,";\n              wR += ").concat(c,") {\n            float dyR = float(dyRCorner + wR) / ").concat(o,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ").concat(f,";\n                wC += ").concat(l,") {\n              float dyC = float(dyCCorner + wC) / ").concat(s,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")};var YW={kernelName:Ct,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode,l=Wm.computePool3DInfo(i.shape,o,s,[1,1,1],u,c),d=new XW(l);return n.runWebGLProgram(d,[a],i.dtype)}};var ZW={kernelName:jt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;Hz([a,i],"avgPoolGrad");var s=r.filterSize,u=r.strides,c=r.pad,l=Wm.computePool2DInfo(o.shape,s,u,1,c),d=new KW(l);return n.runWebGLProgram(d,[a],o.dtype)}};var JW={kernelName:Et,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs;return pW({a:t.a,b:t.b,transposeA:r.transposeA,transposeB:r.transposeB,backend:n})}},QW=function e(t,n,r,a,i,o){Object(O.a)(this,e),this.outputShape=[],this.variableNames=["x","mean","variance"],Wm.assertAndGetBroadcastShape(t,n),Wm.assertAndGetBroadcastShape(t,r);var s="0.0";null!=a&&(Wm.assertAndGetBroadcastShape(t,a),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var u="1.0";null!=i&&(Wm.assertAndGetBroadcastShape(t,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = ".concat(s,";\n        float scale = ").concat(u,";\n        float inv = scale * inversesqrt(variance + float(").concat(o,"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    ")},$W=function e(t,n,r,a,i,o){Object(O.a)(this,e),this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Wm.assertAndGetBroadcastShape(t,n),Wm.assertAndGetBroadcastShape(t,r);var s="vec4(0.0)";null!=a&&(Wm.assertAndGetBroadcastShape(t,a),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var u="vec4(1.0)";null!=i&&(Wm.assertAndGetBroadcastShape(t,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        vec4 offset = ".concat(s,";\n        vec4 scale = ").concat(u,";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4(").concat(o,"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    ")},eU={kernelName:In,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.mean,o=t.variance,s=t.offset,u=t.scale;Ga.assert(i.shape.length===o.shape.length,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),Ga.assert(null==s||i.shape.length===s.shape.length,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),Ga.assert(null==u||i.shape.length===u.shape.length,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}));var c=r.varianceEpsilon;null==c&&(c=.001);var l=[a,i,o],d=null;null!=s&&(d=s.shape,l.push(s));var p=null;null!=u&&(p=u.shape,l.push(u));var f=st().getBool("WEBGL_PACK_NORMALIZATION")?new $W(a.shape,i.shape,o.shape,d,p,c):new QW(a.shape,i.shape,o.shape,d,p,c);return n.runWebGLProgram(f,l,l[0].dtype)}},tU=function e(t){Object(O.a)(this,e),this.variableNames=["source"],this.outputShape=t,this.rank=t.length;var n=gL(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];var r,a=function(e){if(1===e)return"sourceLoc";if(e<=6)return nU.slice(0,e).map((function(e){return"sourceLoc."+e})).join(",");throw Error("Slicing for rank ".concat(e," is not yet supported"))}(this.rank),i=t.map((function(e,t){return"sourceLoc.".concat(nU[t]," = start[").concat(t,"] + coords.").concat(nU[t],";")}));r="\n        ".concat(n," sourceLoc;\n        ").concat(n," coords = getOutputCoords();\n        ").concat(i.join("\n"),"\n      "),this.userCode="\n      void main() {\n        ".concat(r,"\n        setOutput(getSource(").concat(a,"));\n      }\n    ")},nU=["x","y","z","w","u","v"];var rU=function e(t){Object(O.a)(this,e),this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];var n=gL(this.rank),r=tB("coords",this.rank),a=tB("sourceLoc",this.rank),i=1===this.rank?"sourceLoc":"vec2(".concat(a.slice(-2).join(),")"),o="getChannel(getSource(".concat(a.join(),"), ").concat(i,")"),s="\n      result.x = ".concat(o,";\n      if (++").concat(r[this.rank-1]," < ").concat(t[this.rank-1],") {\n        ++").concat(a[this.rank-1],";\n        result.y = ").concat(o,";\n        --").concat(a[this.rank-1],";\n      }\n    "),u=1===this.rank?"":"\n      --".concat(r[this.rank-1],";\n      if (++").concat(r[this.rank-2]," < ").concat(t[this.rank-2],") {\n        ++").concat(a[this.rank-2],";\n        result.z = ").concat(o,";\n        if (++").concat(r[this.rank-1]," < ").concat(t[this.rank-1],") {\n          ++").concat(a[this.rank-1],";\n          result.w = ").concat(o,";\n        }\n      }\n    "),c=this.rank<=4?"sourceLoc = coords +\n            ".concat(n,"(").concat(t.map((function(e,t){return"start[".concat(t,"]")})).join(),");"):t.map((function(e,t){return"".concat(a[t]," = ").concat(r[t]," + start[").concat(t,"];")})).join("\n");this.userCode="\n      void main() {\n        ".concat(n," coords = getOutputCoords();\n        ").concat(n," sourceLoc;\n        ").concat(c,"\n        vec4 result = vec4(0.);\n        ").concat(s,"\n        ").concat(u,"\n        setOutput(result);\n      }\n    ")};function aU(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.begin,o=r.size,s=bm.parseSliceParams(a,i,o),u=Object(y.a)(s,2),c=u[0],l=u[1];if(bm.assertParamsValid(a,c,l),0===Ga.sizeFromShape(l))return n.makeTensorInfo(l,a.dtype,[]);if(n.shouldExecuteOnCPU([a])||"string"===a.dtype){var d=n.texData.get(a.dataId),p=PP(d.values,c,l,a.shape,a.dtype);return n.makeTensorInfo(l,a.dtype,p)}var f=n.texData.get(a.dataId).isPacked,h=bm.isSliceContinous(a.shape,c,l);if(f||!h){var m=st().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new rU(l):new tU(l),v=[c];return n.runWebGLProgram(m,[a],a.dtype,v)}return n.uploadToGPU(a.dataId),function(e,t,n,r){var a=r.texData.get(e.dataId),i=r.makeTensorInfo(n,e.dtype),o=r.texData.get(i.dataId);Object.assign(o,a),o.refCount=1,o.shape=n,o.dtype=e.dtype;var s=bm.computeFlatOffset(t,Ga.computeStrides(e.shape));a.slice&&(s+=a.slice.flatOffset),o.slice={flatOffset:s,origDataId:a.slice&&a.slice.origDataId||e.dataId};var u=r.dataRefCount.get(o.slice.origDataId)||1;return r.dataRefCount.set(o.slice.origDataId,u+1),i}(a,c,l,n)}var iU={kernelName:Gr,backendName:"webgl",kernelFunc:aU},oU={kernelName:_t,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.crops;Ga.assert(a.shape.length<=4,(function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"}));var s=i.reduce((function(e,t){return e*t})),u=Wm.getReshaped(a.shape,i,s),c=Wm.getPermuted(u.length,i.length),l=Wm.getReshapedPermuted(a.shape,i,s),d=Wm.getSliceBeginCoords(o,i.length),p=Wm.getSliceSize(l,o,i.length),f=[],h=eW({inputs:{x:a},backend:n,attrs:{shape:u}}),m=lW({inputs:{x:h},backend:n,attrs:{perm:c}}),v=eW({inputs:{x:m},backend:n,attrs:{shape:l}}),b=aU({inputs:{x:v},backend:n,attrs:{begin:d,size:p}});return f.push(h),f.push(m),f.push(v),f.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),b}};var sU={kernelName:At,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=n.readSync(a.dataId),u=n.readSync(i.dataId),c=oP(s,u,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,c)}};var uU={kernelName:Rt,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=n.a,i=n.b,o=st().getBool("WEBGL_PACK_BINARY_OPERATIONS"),s=st().getNumber("WEBGL_VERSION");if(r.shouldExecuteOnCPU([a,i])||1===s){var u=r.texData.get(a.dataId).values,c=r.texData.get(i.dataId).values,l=uP(a.shape,i.shape,u,c,a.dtype),d=Object(y.a)(l,2),p=d[0],f=d[1],h=r.makeTensorInfo(f,a.dtype);return r.texData.get(h.dataId).values=p,h}return t=o?new RB("\n  int r = int(a.r) & int(b.r);\n  int g = int(a.g) & int(b.g);\n  int rb = int(a.b) & int(b.b);\n  int ra = int(a.a) & int(b.a);\n  return vec4(r, g, rb, ra);\n",a.shape,i.shape,!1):new _B("\n  return float(int(a.r) & int(b.r));\n",a.shape,i.shape),r.runWebGLProgram(t,[a,i],a.dtype)}};var cU={kernelName:Ft,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.s0,a=t.s1,i=n.readSync(r.dataId),o=n.readSync(a.dataId),s=Wm.assertAndGetBroadcastShape(Array.from(i),Array.from(o));return n.makeTensorInfo([s.length],"int32",Int32Array.from(s))}},lU=HB({opSnippet:"return float(a != b);",cpuKernelImpl:CP,dtype:"bool"}),dU={kernelName:dr,backendName:"webgl",kernelFunc:lU};function pU(e){var t=e.inputs,n=e.backend,r=t.input;return DB({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.real},backend:n})}var fU={kernelName:jr,backendName:"webgl",kernelFunc:pU};var hU={kernelName:Mt,backendName:"webgl",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=t.attrs,i=n.x,o=a.dtype;if("complex64"===o){if("complex64"===i.dtype)return DB({inputs:{x:i},backend:r});var s=Bl(i.shape),u=e({inputs:{x:i},backend:r,attrs:{dtype:"float32"}}),c=MB({inputs:{real:u,imag:s},backend:r});return s.dispose(),r.disposeIntermediateTensorInfo(u),c}if("complex64"===i.dtype){var l=pU({inputs:{input:i},backend:r}),d=e({inputs:{x:l},backend:r,attrs:{dtype:o}});return r.disposeIntermediateTensorInfo(l),d}if(!Ga.hasEncodingLoss(i.dtype,o)){var p=DB({inputs:{x:i},backend:r});return{dataId:p.dataId,shape:p.shape,dtype:o}}if(r.shouldExecuteOnCPU([i])){var f=r.texData.get(i.dataId).values,h=cP(f,i.shape,i.dtype,o),m=Object(y.a)(h,3),v=m[0],b=m[1],g=m[2];return r.makeTensorInfo(v,b,g)}if("int32"===o)return function(e,t){var n=new uB(e.shape,"return float(int(x));"),r=t.runWebGLProgram(n,[e],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}(i,r);if("bool"===o){var x=r.makeTensorInfo([],"bool",Ga.getTypedArrayFromDType("bool",1)),k=lU({inputs:{a:i,b:x},backend:r});return r.disposeIntermediateTensorInfo(x),k}throw new Error("Error in Cast: failed to cast ".concat(i.dtype," to ").concat(o))}},mU="return ceil(x);",vU=GB({opSnippet:mU,packedOpSnippet:mU,cpuKernelImpl:lP}),bU={kernelName:zt,backendName:"webgl",kernelFunc:vU},gU=function e(t){Object(O.a)(this,e),this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode="\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "},yU=function e(t){Object(O.a)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode="\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "};var xU={kernelName:Lt,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.clipValueMin,s=a.clipValueMax;t=st().getBool("WEBGL_PACK_CLIP")?new yU(i.shape):new gU(i.shape);var u=[[o],[s]];return r.runWebGLProgram(t,[i],i.dtype,u)}},kU=function e(t){Object(O.a)(this,e),this.variableNames=["real","imag"],this.outputShape=t,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "};function wU(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}}var OU={kernelName:Bt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=n.texData.get(r.dataId),i=new kU(r.shape),o=[wU(r,a.complexTensorInfos.real),wU(r,a.complexTensorInfos.imag)];return n.runWebGLProgram(i,o,o[0].dtype)}},IU=function e(t){Object(O.a)(this,e),this.outputShape=[],this.outputShape=Wm.computeOutShape(t,1),this.variableNames=t.map((function(e,t){return"T".concat(t)}));var n=new Array(t.length-1);n[0]=t[0][1];for(var r=1;r<n.length;r++)n[r]=n[r-1]+t[r][1];for(var a=["if (yC < ".concat(n[0],") setOutput(getT0(yR, yC));")],i=1;i<n.length;i++){var o=n[i-1];a.push("else if (yC < ".concat(n[i],") setOutput(getT").concat(i,"(yR, yC-").concat(o,"));"))}var s=n.length,u=n[n.length-1];a.push("else setOutput(getT".concat(s,"(yR, yC-").concat(u,"));")),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        ".concat(a.join("\n        "),"\n      }\n    ")},SU=function e(t,n){Object(O.a)(this,e),this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Wm.computeOutShape(t,n);var r=this.outputShape,a=r.length,i=gL(a),o=tB("coords",a),s=["x","y","z","w","u","v"].slice(0,a);this.variableNames=t.map((function(e,t){return"T".concat(t)}));var u=new Array(t.length-1);u[0]=t[0][n];for(var c=1;c<u.length;c++)u[c]=u[c-1]+t[c][n];for(var l=s[n],d=s.slice(-2),p=s.join(),f="if (".concat(l," < ").concat(u[0],") {\n        return getChannel(\n            getT0(").concat(p,"), vec2(").concat(d.join(),"));\n        }"),h=1;h<u.length;h++){var m=u[h-1];f+="\n        if (".concat(l," < ").concat(u[h],"  && ").concat(l," >= ").concat(u[h-1],") {\n          return getChannel(\n            getT").concat(h,"(").concat(NU(s,l,m),"),\n            vec2(").concat(NU(d,l,m),"));\n        }")}var v=u.length,b=u[u.length-1];f+="\n        return getChannel(\n          getT".concat(v,"(").concat(NU(s,l,b),"),\n          vec2(").concat(NU(d,l,b),"));"),this.userCode="\n      float getValue(".concat(s.map((function(e){return"int "+e})),") {\n        ").concat(f,"\n      }\n\n      void main() {\n        ").concat(i," coords = getOutputCoords();\n        vec4 result = vec4(getValue(").concat(o,"), 0., 0., 0.);\n\n        ").concat(o[a-1]," = ").concat(o[a-1]," + 1;\n        if (").concat(o[a-1]," < ").concat(r[a-1],") {\n          result.g = getValue(").concat(o,");\n        }\n\n        ").concat(o[a-2]," = ").concat(o[a-2]," + 1;\n        if (").concat(o[a-2]," < ").concat(r[a-2],") {\n          result.a = getValue(").concat(o,");\n        }\n\n        ").concat(o[a-1]," = ").concat(o[a-1]," - 1;\n        if (").concat(o[a-2]," < ").concat(r[a-2]," &&\n            ").concat(o[a-1]," < ").concat(r[a-1],") {\n          result.b = getValue(").concat(o,");\n        }\n        setOutput(result);\n      }\n    ")};function NU(e,t,n){var r=e.indexOf(t);return e.map((function(e,t){return t===r?"".concat(e," - ").concat(n):e})).join()}function jU(e){var t=e.inputs,n=e.backend,r=t.input;return DB({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.imag},backend:n})}var TU={kernelName:_n,backendName:"webgl",kernelFunc:jU};function CU(e,t,n){var r=e[0].dtype;if("complex64"===r){var a=e.map((function(e){return pU({inputs:{input:e},backend:n})})),i=e.map((function(e){return jU({inputs:{input:e},backend:n})})),o=CU(a,t,n),s=CU(i,t,n),u=MB({inputs:{real:o,imag:s},backend:n});return a.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),i.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}var c=n.shouldExecuteOnCPU(e);if("string"===r&&(c=!0),c){var l=e.map((function(e){var r=[-1,Ga.sizeFromShape(e.shape.slice(t))];return eW({inputs:{x:e},backend:n,attrs:{shape:r}})})),d=l.map((function(e){return{vals:n.readSync(e.dataId),shape:e.shape}})),p=Wm.computeOutShape(l.map((function(e){return e.shape})),1),f=1===l[0].shape[0],h=dP(d,p,r,f),m=Wm.computeOutShape(e.map((function(e){return e.shape})),t),v=n.makeTensorInfo(m,r,h);return l.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),v}var b=e.filter((function(e){return Ga.sizeFromShape(e.shape)>0})),g=st().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&b[0].shape.length>1;if(1===b.length){var y=g?new uB(e[0].shape,mB):new wB(e[0].shape,mB);return n.runWebGLProgram(y,e,r)}var x=st().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(b.length>x){for(var k=[],w=0;w<b.length;w+=x){var O=b.slice(w,w+x);k.push(CU(O,t,n))}for(var I=CU(k,t,n),S=0,N=k;S<N.length;S++){var j=N[S];n.disposeIntermediateTensorInfo(j)}return I}if(g){var T=new SU(b.map((function(e){return e.shape})),t);return n.runWebGLProgram(T,b,r)}var C=function(e,t,n){var r=Wm.computeOutShape(e.map((function(e){return e.shape})),t);return{tensors2D:e.map((function(e){return eW({inputs:{x:e},attrs:{shape:[-1,Ga.sizeFromShape(e.shape.slice(t))]},backend:n})})),outShape:r}}(b,t,n),E=C.tensors2D,_=C.outShape,A=new IU(E.map((function(e){return e.shape}))),R=n.runWebGLProgram(A,E,r);E.forEach((function(e){return n.disposeIntermediateTensorInfo(e)}));var D=eW({inputs:{x:R},attrs:{shape:_},backend:n});return n.disposeIntermediateTensorInfo(R),D}function EU(e){var t=e.inputs,n=e.backend,r=e.attrs.axis,a=Ga.parseAxisParam(r,t[0].shape)[0],i=t.map((function(e){return e.shape}));Wm.assertParamsConsistent(i,a);var o=Wm.computeOutShape(t.map((function(e){return e.shape})),a);if(0===Ga.sizeFromShape(o))return n.makeTensorInfo(o,t[0].dtype,[]);var s=t.filter((function(e){return Ga.sizeFromShape(e.shape)>0}));return 1===s.length?DB({inputs:{x:s[0]},backend:n}):CU(s,a,n)}var _U={kernelName:Wt,backendName:"webgl",kernelFunc:EU},AU=function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];Object(O.a)(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var o=t.padInfo.top,s=t.padInfo.left,u=t.strideHeight,c=t.strideWidth,l=t.dilationHeight,d=t.dilationWidth,p=t.filterHeight,f=t.filterWidth,h=4*Math.floor(t.inChannels/4),m=t.inChannels%4,v="channelsLast"===t.dataFormat,b=v?1:2,g=v?2:3,y=v?3:1,x="",k="";r&&(x=a?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ".concat(r,"\n        }"):i?"float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ".concat(r,"\n        }"):"\n          float activation(float x) {\n            ".concat(r,"\n          }\n        "),k="result = activation(result);");var w=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(x,"\n\n      const ivec2 strides = ivec2(").concat(u,", ").concat(c,");\n      const ivec2 pads = ivec2(").concat(o,", ").concat(s,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[").concat(y,"];\n\n        ivec2 xRCCorner =\n            ivec2(coords[").concat(b,"], coords[").concat(g,"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(p,"; wR++) {\n          int xR = xRCorner + wR * ").concat(l,";\n\n          if (xR < 0 || xR >= ").concat(t.inHeight,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(f,"; wC++) {\n            int xC = xCCorner + wC * ").concat(d,";\n\n            if (xC < 0 || xC >= ").concat(t.inWidth,") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < ").concat(h,"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if (").concat(v,") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if (").concat(1===m,") {\n\n              if (").concat(v,") {\n                dotProd +=\n                    getX(batch, xR, xC, ").concat(h,") *\n                    getW(wR, wC, ").concat(h,", d2);\n              } else {\n                dotProd +=\n                    getX(batch, ").concat(h,", xR, xC) *\n                    getW(wR, wC, ").concat(h,", d2);\n              }\n\n            } else if (").concat(2===m,") {\n              vec2 wValues = vec2(\n                getW(wR, wC, ").concat(h,", d2),\n                getW(wR, wC, ").concat(h," + 1, d2)\n              );\n\n              if (").concat(v,") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, ").concat(h,"),\n                  getX(batch, xR, xC, ").concat(h," + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, ").concat(h,", xR, xC),\n                  getX(batch, ").concat(h," + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if (").concat(3===m,") {\n              vec3 wValues = vec3(\n                getW(wR, wC, ").concat(h,", d2),\n                getW(wR, wC, ").concat(h," + 1, d2),\n                getW(wR, wC, ").concat(h," + 2, d2)\n              );\n\n              if (").concat(v,") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, ").concat(h,"),\n                  getX(batch, xR, xC, ").concat(h," + 1),\n                  getX(batch, xR, xC, ").concat(h," + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, ").concat(h,", xR, xC),\n                  getX(batch, ").concat(h," + 1, xR, xC),\n                  getX(batch, ").concat(h," + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        ").concat(w,"\n        ").concat(k,"\n        setOutput(result);\n      }\n    ")},RU=function e(t){Object(O.a)(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var n=t.padInfo.front,r=t.padInfo.top,a=t.padInfo.left,i=t.strideDepth,o=t.strideHeight,s=t.strideWidth,u=t.dilationDepth,c=t.dilationHeight,l=t.dilationWidth,d=t.filterDepth,p=t.filterHeight,f=t.filterWidth,h=4*Math.floor(t.inChannels/4),m=t.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3(".concat(i,", ").concat(o,", ").concat(s,");\n      const ivec3 pads = ivec3(").concat(n,", ").concat(r,", ").concat(a,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ").concat(d,"; wF++) {\n          int xF = xFCorner + wF * ").concat(u,";\n\n          if (xF < 0 || xF >= ").concat(t.inDepth,") {\n            continue;\n          }\n\n          for (int wR = 0; wR < ").concat(p,"; wR++) {\n            int xR = xRCorner + wR * ").concat(c,";\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(f,"; wC++) {\n              int xC = xCCorner + wC * ").concat(l,";\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < ").concat(h,"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if (").concat(1===m,") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, ").concat(h,") *\n                  getW(wF, wR, wC, ").concat(h,", d2);\n              } else if (").concat(2===m,") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, ").concat(h,"),\n                  getX(batch, xF, xR, xC, ").concat(h," + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, ").concat(h,", d2),\n                  getW(wF, wR, wC, ").concat(h," + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if (").concat(3===m,") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, ").concat(h,"),\n                  getX(batch, xF, xR, xC, ").concat(h," + 1),\n                  getX(batch, xF, xR, xC, ").concat(h," + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, ").concat(h,", d2),\n                  getW(wF, wR, wC, ").concat(h," + 1, d2),\n                  getW(wF, wR, wC, ").concat(h," + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},DU=function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];Object(O.a)(this,e),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=jL(this.outputShape.length);for(var o=t.padInfo.left,s=t.strideWidth,u=t.dilationWidth,c=t.filterHeight,l=t.filterWidth,d=l,p="\n       int xR; int xC; int xCOffset;\n       vec4 wTexel; vec4 previous; vec4 final;",f=0;f<l;f++)p+="\n           vec4 xTexelC".concat(2*f,";\n           int xTexelC").concat(2*f,"Ready;\n           vec4 xTexelC").concat(2*f+1,";\n           int xTexelC").concat(2*f+1,"Ready;\n           vec4 xC").concat(f,";");p+="\n     for (int r = 0; r < ".concat(c,"; r++) {\n      for (int d1 = 0; d1 < ").concat(t.inChannels,"; d1 += 2) {\n       ");for(var h=0;h<l;h++)p+="\n           xTexelC".concat(2*h," = vec4(0.0);\n           xTexelC").concat(2*h,"Ready = 0;\n           xTexelC").concat(2*h+1," = vec4(0.0);\n           xTexelC").concat(2*h+1,"Ready = 0;\n           xC").concat(h," = vec4(0.0);");p+="\n         xR = xRCorner + r * dilations[0];\n         if (xR >=0 && xR < inDims[0]) {\n       ";for(var m=0;m<(d+1)/2;m++){var v=2*m;if(p+="\n           xC = xCCorner + ".concat(v*u,";\n           "),1===s){if(v<l&&(o%2===1?(p+="\n                 xCOffset = xC + 1;\n                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(v,"Ready == 0) {\n                   xTexelC").concat(v," = getX(batch, xR, xCOffset, d1);\n\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC").concat(v,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(v,"Ready = 1;\n                 }\n               "),p+=1===u&&v>0?"\n                 xC".concat(v," = vec4(xTexelC").concat(v-2,".zw, xTexelC").concat(v,".xy);\n                 "):"\n                   xCOffset = xC + 1 - 2;\n\n                   if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                     previous = getX(batch, xR, xCOffset, d1);\n\n                     // Need to manually clear unused channels in case\n                     // we're reading from recycled texture.\n                     if (xCOffset + 1 >= inDims[1]) {\n                       previous.zw = vec2(0.0);\n                     }\n\n                     xC".concat(v," = vec4(previous.zw, xTexelC").concat(v,".xy);\n                   } else {\n                     xC").concat(v," = vec4(0.0, 0.0, xTexelC").concat(v,".xy);\n                   }\n                   ")):p+="\n                 if (xC >= 0 && xC < inDims[1] && xTexelC".concat(v,"Ready == 0) {\n                   xTexelC").concat(v," = getX(batch, xR, xC, d1);\n                   if (xC + 1 >= inDims[1]) {\n                     xTexelC").concat(v,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(v,"Ready = 1;\n                 }\n\n                 xC").concat(v," = xTexelC").concat(v,";\n                 "),v+1<l)){var b=o%2===0?Ga.nearestLargerEven(u):u;u%2===0&&o%2===1||u%2!==0&&o%2!==1?(p+="\n                   xCOffset = xC + imod(pads[1], 2) + ".concat(b,";\n\n                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(v+1,"Ready == 0) {\n                     xTexelC").concat(v+1," = getX(batch, xR, xCOffset, d1);\n\n                     // Need to manually clear unused channels in case\n                     // we're reading from recycled texture.\n                     if (xCOffset + 1 >= inDims[1]) {\n                       xTexelC").concat(v+1,".zw = vec2(0.0);\n                     }\n                     xTexelC").concat(v+1,"Ready = 1;\n                   }\n                   "),p+=u>1?"\n                     xCOffset -= 2;\n                     if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                      previous = getX(batch, xR, xCOffset, d1);\n                      xC".concat(v+1," = vec4(previous.zw, xTexelC").concat(v+1,".xy);\n                     } else {\n                      xC").concat(v+1," = vec4(0.0, 0.0, xTexelC").concat(v+1,".xy);\n                     }\n                     "):"\n                     xC".concat(v+1," = vec4(xTexelC").concat(v,".zw, xTexelC").concat(v+1,".xy);\n                     ")):p+=1===b?"\n                     xC".concat(v+1," = xTexelC").concat(v,";\n                     "):"\n                     xCOffset = xC + ".concat(b,";\n\n                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(v+1,"Ready == 0) {\n                       xTexelC").concat(v+1," = getX(batch, xR, xCOffset, d1);\n                       if (xCOffset + 1 >= inDims[1]) {\n                         xTexelC").concat(v+1,".zw = vec2(0.0);\n                       }\n                       xTexelC").concat(v+1,"Ready = 1;\n                     }\n\n                     xC").concat(v+1," = xTexelC").concat(v+1,";\n                     ")}}else v<l&&(o%2===1?(p+="\n                 xCOffset = xC + 1 - strides[1];\n                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(v,"Ready == 0) {\n                   xTexelC").concat(v," = getX(batch, xR, xCOffset, d1);\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC").concat(v,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(v,"Ready = 1;\n                 }\n\n                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC").concat(v+1,"Ready == 0) {\n                   xTexelC").concat(v+1," = getX(batch, xR, xC + 1, d1);\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xC + 2 >= inDims[1]) {\n                     xTexelC").concat(v+1,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(v+1,"Ready = 1;\n                 }\n\n                 xC").concat(v," = vec4(xTexelC").concat(v,".zw, xTexelC").concat(v+1,".zw);\n               "),v+1<l&&(p+="\n                   final = vec4(0.0);\n                   xCOffset = xC + 1 + strides[1];\n                   if(xCOffset >= 0 && xCOffset < inDims[1]) {\n                     final = getX(batch, xR, xCOffset, d1);\n                   }\n                   xC".concat(v+1," = vec4(xTexelC").concat(v+1,".xy, final.xy);\n                 "))):(p+="\n                 if(xC >= 0 && xC < inDims[1] && xTexelC".concat(v,"Ready == 0) {\n                   xTexelC").concat(v," = getX(batch, xR, xC, d1);\n                   if (xC + 1 >= inDims[1]) {\n                     xTexelC").concat(v,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(v,"Ready = 1;\n                 }\n\n                 xCOffset = xC + strides[1];\n                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(v+1,"Ready == 0) {\n                   xTexelC").concat(v+1," = getX(batch, xR, xCOffset, d1);\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC").concat(v+1,".zw = vec2(0.);\n                   }\n                   xTexelC").concat(v+1,"Ready = 1;\n                 }\n\n                 xC").concat(v," = vec4(\n                   xTexelC").concat(v,".xy, xTexelC").concat(v+1,".xy);\n               "),v+1<l&&(p+="\n                   xC".concat(v+1," = vec4(xTexelC").concat(v,".zw, xTexelC").concat(v+1,".zw);\n                 "))));v<l&&(p+="\n             wTexel = getW(r, ".concat(v,", d1, d2);\n             dotProd += xC").concat(v,".xxzz * vec4(wTexel.xy, wTexel.xy);\n             if(d1 + 1 < ").concat(t.inChannels,") {\n               dotProd += xC").concat(v,".yyww * vec4(wTexel.zw, wTexel.zw);\n             }\n           "),v+1<l&&(p+="\n               wTexel = getW(r, ".concat(v+1,", d1, d2);\n               dotProd += xC").concat(v+1,".xxzz * vec4(wTexel.xy, wTexel.xy);\n               if(d1 + 1 < ").concat(t.inChannels,") {\n                 dotProd += xC").concat(v+1,".yyww * vec4(wTexel.zw, wTexel.zw);\n               }\n             ")))}p+="\n     }\n   ",p+="\n     }\n   ",p+="\n     }\n   ";var g="",y="";r&&(g=a?"vec4 activation(vec4 a) {\n           vec4 b = getPreluActivationWeightsAtOutCoords();\n           ".concat(r,"\n         }"):i?"vec4 activation(vec4 a) {\n           vec4 b = getLeakyreluAlphaAtOutCoords();\n           ".concat(r,"\n         }"):"vec4 activation(vec4 x) {\n           ".concat(r,"\n         }"),y="result = activation(result);");var x=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n       ".concat(g,"\n\n       void main() {\n         ivec4 coords = getOutputCoords();\n         int batch = coords.x;\n         ivec2 xRCCorner = coords.yz * strides - pads;\n         int d2 = coords.w;\n         int xRCorner = xRCCorner.x;\n         int xCCorner = xRCCorner.y;\n\n         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.\n         vec4 dotProd = vec4(0.000000000000001);\n\n         ").concat(p,"\n\n         vec4 result = dotProd - vec4(0.000000000000001);\n         ").concat(x,"\n         ").concat(y,"\n         setOutput(result);\n       }\n     ")},FU=function e(t,n){Object(O.a)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=t,this.enableShapeUniforms=jL(this.outputShape.length);for(var r=n.dataFormat,a=Kz(),i="channelsLast"===r,o=i?1:2,s=i?2:3,u=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":"if(blockIndex < ".concat(t[2]," && pos < ").concat(t[1],") {"),c="",l=0;l<=1;l++)for(var d=0;d<=1;d++)c+="\n          blockIndex = rc.z + ".concat(d,";\n          pos = rc.y + ").concat(l,";\n\n          ").concat(u,"\n            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];\n            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);\n\n            if(d0 < inputShape[").concat(o,"] && d0 >= 0) {\n              // Use custom imod instead mod. On Intel GPU, mod may generate\n              // unexpected value.\n              // https://github.com/tensorflow/tfjs/issues/5447\n              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];\n              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /\n                  inChannels);\n\n              if(d1 < inputShape[").concat(s,"] && d1 >= 0) {\n\n                ch = imod(pos, inChannels);\n\n                if (").concat(i,") {\n                  innerDims = vec2(d1, ch);\n                  result[").concat(2*l+d,"] = getChannel(\n                    getA(rc.x, d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result[").concat(2*l+d,"] = getChannel(\n                    getA(rc.x, ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ");this.userCode="\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        ".concat(c,"\n\n        ").concat(a.output," = result;\n      }\n    ")};function MU(e,t){var n=e.length;return n>=3?[].concat(Object(S.a)(e.slice(0,-3)),t?[e[n-3]*e[n-2],e[n-1]]:[e[n-3],e[n-2]*e[n-1]]):!t&&1===n&&e[0]>1?[e[0],1]:null}function zU(e){var t,n=e.x,r=e.filter,a=e.convInfo,i=e.backend,o=e.bias,s=void 0===o?null:o,u=e.preluActivationWeights,c=void 0===u?null:u,l=e.leakyreluAlpha,d=void 0===l?0:l,p=e.activation,f=void 0===p?null:p,h=n.shape,m=i.texData.get(n.dataId),v=a.inChannels,b=h[0]*h[1]*h[2],g=a.outChannels,y="channelsLast"===a.dataFormat,x=[];if(null!=c){var k=MU(c.shape,y);null!=k&&(c=eW({inputs:{x:c},backend:i,attrs:{shape:k}}),x.push(c))}if(null!=s){var w=MU(s.shape,y);null!=w&&(s=eW({inputs:{x:s},backend:i,attrs:{shape:w}}),x.push(s))}if((1!==b&&1!==g||!(v>1e3))&&m.isPacked&&y&&null!=m.texture&&h[2]%2!==0&&Ga.arraysEqual(m.shape.slice(-3),h.slice(-3))){var O=h[0]*h[1]*(h[2]+1),I={dataId:n.dataId,shape:[1,O,a.inChannels],dtype:n.dtype},S=m.shape;m.shape=m.shape.slice(),m.shape[m.shape.length-2]++,Ga.assert(Rz(m.shape,I.shape),(function(){return"packed reshape ".concat(m.shape," to ").concat(I.shape," isn't free")}));var N=eW({inputs:{x:r},backend:i,attrs:{shape:[1,a.inChannels,a.outChannels]}});x.push(N);var j=pW({a:I,b:N,backend:i,transposeA:!1,transposeB:!1,bias:s,activation:f,preluActivationWeights:c,leakyreluAlpha:d}),T=i.texData.get(j.dataId);Ga.assert(T.isPacked,(function(){return"batchMatMul result is expected to be packed"})),m.shape=S,T.shape=a.outShape,(t=DB({inputs:{x:j},backend:i})).shape=a.outShape,x.push(j)}else{var C=a.outHeight*a.outWidth,E=eW({inputs:{x:n},backend:i,attrs:{shape:y?[a.batchSize,C,a.inChannels]:[a.batchSize,a.inChannels,C]}}),_=eW({inputs:{x:r},backend:i,attrs:{shape:[1,a.inChannels,a.outChannels]}}),A=pW({a:y?E:_,b:y?_:E,transposeA:!y,transposeB:!1,backend:i,bias:s,activation:f,preluActivationWeights:c,leakyreluAlpha:d});t=eW({inputs:{x:A},backend:i,attrs:{shape:a.outShape}}),x.push(E),x.push(_),x.push(A)}for(var R=0,D=x;R<D.length;R++){var F=D[R];i.disposeIntermediateTensorInfo(F)}return t}function LU(e){var t=e.x,n=e.filter,r=e.convInfo,a=e.backend,i=e.bias,o=void 0===i?null:i,s=e.preluActivationWeights,u=void 0===s?null:s,c=e.leakyreluAlpha,l=void 0===c?0:c,d=e.activation,p=void 0===d?null:d,f=r.filterWidth,h=r.filterHeight,m=r.inChannels,v=r.outWidth,b=r.outHeight,g="channelsLast"===r.dataFormat,y=f*h*m,x=b*v,k=[r.batchSize,y,x],w=[];if(null!=u){var O=MU(u.shape,g);null!=O&&(u=eW({inputs:{x:u},backend:a,attrs:{shape:O}}),w.push(u))}if(null!=o){var I=MU(o.shape,g);null!=I&&(o=eW({inputs:{x:o},backend:a,attrs:{shape:I}}),w.push(o))}var S=eW({inputs:{x:n},backend:a,attrs:{shape:[1,y,Ga.sizeFromShape(n.shape)/y]}});w.push(S);var N=new FU(k,r),j=[t.shape,[r.padInfo.top,r.padInfo.left],[r.strideHeight,r.strideWidth],[r.dilationHeight,r.dilationWidth],[r.inChannels],[r.filterWidth*r.inChannels],[r.outWidth]],T=a.runWebGLProgram(N,[t],"float32",j),C=eW({inputs:{x:T},backend:a,attrs:{shape:k}});w.push(T),w.push(C);var E=null!=o,_=null!=u,A="leakyrelu"===p,R=p?qB(p,!0):null,D=new KB(g?C.shape:S.shape,g?S.shape:C.shape,g?[r.batchSize,x,r.outChannels]:[r.batchSize,r.outChannels,x],!0,!1,E,R,_,A),F=g?[C,S]:[S,C];if(o&&F.push(o),_&&F.push(u),A){var M=a.makeTensorInfo([],"float32",Ga.createScalarValue(l,"float32"));F.push(M),w.push(M)}var z=a.runWebGLProgram(D,F,"float32"),L=eW({inputs:{x:z},backend:a,attrs:{shape:r.outShape}});w.push(z);for(var P=0,B=w;P<B.length;P++){var W=B[P];a.disposeIntermediateTensorInfo(W)}return L}var PU={kernelName:Ut,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=n.filter,s=a.strides,u=a.pad,c=a.dataFormat,l=a.dilations,d=a.dimRoundingMode,p=Wm.convertConv2DDataFormat(c),f=Wm.computeConv2DInfo(i.shape,o.shape,s,l,u,d,!1,p);if(1!==f.filterHeight||1!==f.filterWidth||1!==f.dilationHeight||1!==f.dilationWidth||1!==f.strideHeight||1!==f.strideWidth||"SAME"!==f.padInfo.type&&"VALID"!==f.padInfo.type)if(f.strideWidth<=2&&"channelsLast"===p&&st().getBool("WEBGL_EXP_CONV")){var h=new DU(f),m=[[f.padInfo.top,f.padInfo.left],[f.strideHeight,f.strideWidth],[f.dilationHeight,f.dilationWidth],[f.inHeight,f.inWidth]];t=r.runWebGLProgram(h,[i,o],"float32",m)}else if(st().getBool("WEBGL_CONV_IM2COL"))t=LU({x:i,filter:o,convInfo:f,backend:r});else{var v=new AU(f);t=r.runWebGLProgram(v,[i,o],"float32")}else t=zU({x:i,filter:o,convInfo:f,backend:r});var b=eW({inputs:{x:t},backend:r,attrs:{shape:f.outShape}});return r.disposeIntermediateTensorInfo(t),b}},BU=function e(t){Object(O.a)(this,e),this.variableNames=["x","dy"],this.outputShape=t.filterShape;var n=t.strideHeight,r=t.strideWidth,a=t.padInfo.top,i=t.padInfo.left,o="channelsLast"===t.dataFormat;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ".concat(t.batchSize,"; b++) {\n          for (int yR = 0; yR < ").concat(t.outHeight,"; yR++) {\n            int xR = wR + yR * ").concat(n," - ").concat(a,";\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int yC = 0; yC < ").concat(t.outWidth,"; yC++) {\n              int xC = wC + yC * ").concat(r," - ").concat(i,";\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              ").concat(o?"float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);":"float dyValue = getDy(b, d2, yR, yC);\n              float xValue = getX(b, d1, xR, xC);\n              dotProd += (xValue * dyValue);","\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},WU=function e(t){Object(O.a)(this,e),this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterHeight,r=t.filterWidth,a=t.strideHeight,i=t.strideWidth,o="channelsLast"===t.dataFormat,s=n-1-t.padInfo.top,u=r-1-t.padInfo.left,c=o?1:2,l=o?2:3,d=o?3:1;this.userCode="\n      const ivec2 pads = ivec2(".concat(s,", ").concat(u,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[").concat(d,"];\n\n        ivec2 dyCorner = ivec2(coords[").concat(c,"], coords[").concat(l,"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(n,"; wR++) {\n          float dyR = float(dyRCorner + wR) / ").concat(a,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ").concat(n," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(r,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(i,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ").concat(r," - 1 - wC;\n\n            for (int d2 = 0; d2 < ").concat(t.outChannels,"; d2++) {\n\n              if (").concat(o,") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},UU=function e(t){Object(O.a)(this,e),this.variableNames=["x","dy"],this.outputShape=t.filterShape;var n=t.strideDepth,r=t.strideHeight,a=t.strideWidth,i=t.padInfo.front,o=t.padInfo.top,s=t.padInfo.left;this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ".concat(t.batchSize,"; b++) {\n          for (int yF = 0; yF < ").concat(t.outDepth,"; yF++) {\n            int xF = wF + yF * ").concat(n," - ").concat(i,";\n\n            if (xF < 0 || xF >= ").concat(t.inDepth,") {\n              continue;\n            }\n\n            for (int yR = 0; yR < ").concat(t.outHeight,"; yR++) {\n              int xR = wR + yR * ").concat(r," - ").concat(o,";\n\n              if (xR < 0 || xR >= ").concat(t.inHeight,") {\n                continue;\n              }\n\n              for (int yC = 0; yC < ").concat(t.outWidth,"; yC++) {\n                int xC = wC + yC * ").concat(a," - ").concat(s,";\n\n                if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},VU=function e(t){Object(O.a)(this,e),this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterDepth,r=t.filterHeight,a=t.filterWidth,i=t.strideDepth,o=t.strideHeight,s=t.strideWidth,u=n-1-t.padInfo.front,c=r-1-t.padInfo.top,l=a-1-t.padInfo.left;this.userCode="\n      const ivec3 pads = ivec3(".concat(u,", ").concat(c,", ").concat(l,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ").concat(n,"; wF++) {\n          float dyF = float(dyFCorner + wF) / ").concat(i,".0;\n\n          if (dyF < 0.0 || dyF >= ").concat(t.outDepth,".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = ").concat(n," - 1 - wF;\n\n          for (int wR = 0; wR < ").concat(r,"; wR++) {\n            float dyR = float(dyRCorner + wR) / ").concat(o,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = ").concat(r," - 1 - wR;\n\n            for (int wC = 0; wC < ").concat(a,"; wC++) {\n              float dyC = float(dyCCorner + wC) / ").concat(s,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = ").concat(a," - 1 - wC;\n\n              for (int d2 = 0; d2 < ").concat(t.outChannels,"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")};var GU={kernelName:Vt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dimRoundingMode,l=r.filterShape,d=Wm.convertConv2DDataFormat(u),p=Wm.computeConv2DInfo(a.shape,l,o,1,s,c,!1,d),f=new BU(p);return n.runWebGLProgram(f,[a,i],"float32")}},HU=function e(t){Object(O.a)(this,e),this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=t.inShape,this.enableShapeUniforms=jL(this.outputShape.length);var n=t.filterHeight,r=t.filterWidth,a=n-1-t.padInfo.top,i=r-1-t.padInfo.left;this.userCode="\n      const ivec2 pads = ivec2(".concat(a,", ").concat(i,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n\n        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        vec4 result = vec4(0.);\n        for (int wR = 0; wR < ").concat(n,"; wR++) {\n          float dyR = float(dyRCorner + wR) / strides[0];\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n          int wRPerm = ").concat(n," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(r,"; wC++) {\n            int wCPerm = ").concat(r," - 1 - wC;\n\n            float dyC = float(dyCCorner + wC) / strides[1];\n            bool idyCVal = (dyC >= 0.0) && (dyC < ").concat(t.outWidth,".0)\n              && (fract(dyC) == 0.0);\n            int idyC = int(dyC);\n\n            float dyC2 = float(dyCCorner + wC + 1) / strides[1];\n            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ").concat(t.outWidth,".0)\n              && (fract(dyC2) == 0.0);\n            int idyC2 = int(dyC2);\n\n            if (idyCVal && idyCVal2) {\n              for (int d2 = 0; d2 < ").concat(t.outChannels,"; d2 += 2) {\n                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);\n                vec4 dySample = getDy(batch, idyR, idyC, d2);\n                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?\n                  dySample : getDy(batch, idyR, idyC2, d2);\n\n                vec2 dyValue = mod(float(idyC), 2.) == 0. ?\n                  dySample.xy : dySample.zw;\n                result.xy += vec2(dot(dyValue, wValue.xy),\n                  dot(dyValue, wValue.zw));\n\n                dyValue = mod(float(idyC2), 2.) == 0. ?\n                  dySample2.xy : dySample2.zw;\n                result.zw += vec2(dot(dyValue, wValue.xy),\n                  dot(dyValue, wValue.zw));\n              }\n            } else if (idyCVal) {\n              for (int d2 = 0; d2 < ").concat(t.outChannels,"; d2 += 2) {\n                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);\n                vec4 dySample = getDy(batch, idyR, idyC, d2);\n                vec2 dyValue = mod(float(idyC), 2.) == 0. ?\n                  dySample.xy : dySample.zw;\n                result.xy += vec2(dot(dyValue, wValue.xy),\n                  dot(dyValue, wValue.zw));\n              }\n            } else if (idyCVal2) {\n              for (int d2 = 0; d2 < ").concat(t.outChannels,"; d2 += 2) {\n                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);\n                vec4 dySample = getDy(batch, idyR, idyC2, d2);\n                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?\n                  dySample.xy : dySample.zw;\n                result.zw += vec2(dot(dyValue, wValue.xy),\n                  dot(dyValue, wValue.zw));\n              }\n            }\n          }\n        }\n        setOutput(result);\n      }\n    ")};var qU={kernelName:Gt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.inputShape,s=r.strides,u=r.pad,c=r.dataFormat,l=r.dimRoundingMode,d=Wm.convertConv2DDataFormat(c),p=Wm.computeConv2DInfo(o,i.shape,s,1,u,l,!1,d);if(st().getBool("WEBGL_PACK")&&"channelsLast"===d){var f=[[p.strideHeight,p.strideWidth]],h=new HU(p);return n.runWebGLProgram(h,[a,i],"float32",f)}var m=new WU(p);return n.runWebGLProgram(m,[a,i],"float32")}};var KU={kernelName:Ht,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations,c=Wm.computeConv3DInfo(a.shape,i.shape,o,u,s),l=new RU(c);return n.runWebGLProgram(l,[a,i],"float32")}};var XU={kernelName:qt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.pad,u=r.filterShape,c=Wm.computeConv3DInfo(a.shape,u,o,1,s),l=new UU(c);return n.runWebGLProgram(l,[a,i],"float32")}};var YU,ZU={kernelName:Kt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.pad,s=r.strides,u=r.inputShape,c=Wm.computeConv3DInfo(u,i.shape,s,1,o),l=new VU(c);return n.runWebGLProgram(l,[a,i],"float32")}},JU=GB({opSnippet:"if (isnan(x)) return x;\n  return cos(x);\n",packedOpSnippet:"\n  vec4 result = cos(x);\n  bvec4 isNaN = isnan(x);\n  ".concat(AB,"\n  return result;\n")}),QU={kernelName:Xt,backendName:"webgl",kernelFunc:JU},$U=GB({opSnippet:"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n"}),eV={kernelName:Yt,backendName:"webgl",kernelFunc:$U},tV=function e(t,n,r,a,i){Object(O.a)(this,e),this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var o=Object(y.a)(t,4),s=o[0],u=o[1],c=o[2],l=o[3],d=Object(y.a)(n,1)[0],p=Object(y.a)(r,2),f=p[0],h=p[1];this.outputShape=[d,f,h,l];var m="bilinear"===a?1:0,v="".concat(u-1,".0"),b="".concat(c-1,".0"),g=f>1?["".concat((u-1)/(f-1)),"(y2-y1) * height_ratio","y1*".concat(v," + float(y)*(height_scale)")]:["0.0","0.0","0.5 * (y1+y2) * ".concat(v)],x=Object(y.a)(g,3),k=x[0],w=x[1],I=x[2],S=h>1?["".concat((c-1)/(h-1)),"(x2-x1) * width_ratio","x1*".concat(b," + float(x)*(width_scale)")]:["0.0","0.0","0.5 * (x1+x2) * ".concat(b)],N=Object(y.a)(S,3),j=N[0],T=N[1],C=N[2];this.userCode="\n      const float height_ratio = float(".concat(k,");\n      const float width_ratio = float(").concat(j,");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= ").concat(s,") {\n          return;\n        }\n\n        float height_scale = ").concat(w,";\n        float width_scale = ").concat(T,";\n\n        float in_y = ").concat(I,";\n        if( in_y < 0.0 || in_y > ").concat(v," ) {\n          setOutput(float(").concat(i,"));\n          return;\n        }\n        float in_x = ").concat(C,";\n        if( in_x < 0.0 || in_x > ").concat(b," ) {\n          setOutput(float(").concat(i,"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if(").concat(m," == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    ")},nV={kernelName:Qt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.image,i=t.boxes,o=t.boxInd,s=r.cropSize,u=r.method,c=r.extrapolationValue,l=new tV(a.shape,i.shape,s,u,c);return n.runWebGLProgram(l,[a,i,o],"float32")}};!function(e){e.Prod="*",e.Sum="+"}(YU||(YU={}));var rV=function e(t,n,r,a){Object(O.a)(this,e),this.op=t,this.outputShape=n,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];var i=this.outputShape.length,o=this.op===YU.Prod?"1.0":"0.0",s=r?o:"getX(".concat(aV(i,"coords",this.op),")"),u=this.outputShape[this.outputShape.length-1],c="",l="";r?(c=a?"end != ".concat(u-1):"end != 0",l=a?"end + 1":"end - 1"):(c=a?"end + pow2 < ".concat(u):"end >= pow2",l=a?"end + pow2":"end - pow2"),this.userCode="\n      void main() {\n        ".concat(gL(i)," coords = getOutputCoords();\n        int end = ").concat(iV(i,"coords",this.op),";\n        float val = ").concat(s,";\n        int pow2 = int(pow(2.0, index));\n        if (").concat(c,") {\n          int idx = ").concat(l,";\n          ").concat(iV(i,"coords",this.op)," = idx;\n          val ").concat(this.op,"= getX(").concat(aV(i,"coords",this.op),");\n        }\n        setOutput(val);\n      }\n    ")};function aV(e,t,n){if(1===e)return"".concat(t);if(2===e)return"".concat(t,".x, ").concat(t,".y");if(3===e)return"".concat(t,".x, ").concat(t,".y, ").concat(t,".z");if(4===e)return"".concat(t,".x, ").concat(t,".y, ").concat(t,".z, ").concat(t,".w");throw new Error("Cumulative ".concat(n," for rank ").concat(e," is not yet supported"))}function iV(e,t,n){if(1===e)return"".concat(t);if(2===e)return"".concat(t,".y");if(3===e)return"".concat(t,".z");if(4===e)return"".concat(t,".w");throw new Error("Cumulative ".concat(n," for rank ").concat(e," is not yet supported"))}function oV(e,t,n,r,a,i){var o=t.shape.length,s=Wm.getAxesPermutation([r],o),u=t;null!=s&&(u=lW({inputs:{x:t},backend:n,attrs:{perm:s}}));var c=Wm.getInnerMostAxes(1,o)[0];if(c!==o-1)throw new Error("WebGL cumprod shader expects an inner-most axis=".concat(t.shape.length-1," but got axis=").concat(r));for(var l=u.shape[c],d=DB({inputs:{x:u},backend:n}),p=0;p<=Math.ceil(Math.log2(l))-1;p++){var f=new rV(e,u.shape,!1,i),h=[[p]],m=d;d=n.runWebGLProgram(f,[d],d.dtype,h),n.disposeIntermediateTensorInfo(m)}if(a){var v=new rV(e,u.shape,a,i),b=d;d=n.runWebGLProgram(v,[d],d.dtype),n.disposeIntermediateTensorInfo(b)}if(null!=s){var g=lW({inputs:{x:d},backend:n,attrs:{perm:Wm.getUndoAxesPermutation(s)}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(u),g}return d}var sV={kernelName:Zt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse;return oV(YU.Prod,a,n,i,o,s)}};var uV={kernelName:Jt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse;return oV(YU.Sum,a,n,i,o,s)}};var cV={kernelName:$t,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=r.binaryOutput;if(1===a.shape.length){var u=n.readSync(a.dataId),c=n.readSync(i.dataId),l=oP(u,c,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,l)}if(2===a.shape.length){var d=n.bufferSync(a),p=n.bufferSync(i),f=sP(d,p,o,s);return n.makeTensorInfo(f.shape,i.dtype,f.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank".concat(a.shape.length,"."))}},lV=function(){function e(t,n,r){Object(O.a)(this,e),this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=n,this.dataFormat=r,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = ".concat(this.getHeightCoordString(),";\n      int w = ").concat(this.getWidthCoordString(),";\n      int d = ").concat(this.getDepthCoordString(),";\n\n      int in_h = h / ").concat(n,";\n      int offset_h = imod(h, ").concat(n,");\n      int in_w = w / ").concat(n,";\n      int offset_w = imod(w, ").concat(n,");\n      int offset_d = (offset_h * ").concat(n," + offset_w) *\n        ").concat(this.getOutputDepthSize(),";\n      int in_d = d + offset_d;\n\n      float result = ").concat(this.getInputSamplingString(),";\n      setOutput(result);\n    }\n  ")}return Object(I.a)(e,[{key:"getHeightCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"}},{key:"getWidthCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"}},{key:"getDepthCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"}},{key:"getOutputDepthSize",value:function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]}},{key:"getInputSamplingString",value:function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}]),e}();var dV={kernelName:en,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockSize,o=r.dataFormat,s=a.shape[0],u=("NHWC"===o?a.shape[1]:a.shape[2])*i,c=("NHWC"===o?a.shape[2]:a.shape[3])*i,l=("NHWC"===o?a.shape[3]:a.shape[1])/(i*i),d=new lV("NHWC"===o?[s,u,c,l]:[s,l,u,c],i,o);return n.runWebGLProgram(d,[a],a.dtype)}},pV=function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];Object(O.a)(this,e),this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=jL(this.outputShape.length);var o=t.filterHeight,s=t.filterWidth,u=t.outChannels/t.inChannels,c="",l="";r&&(c=a?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ".concat(r,"\n        }"):i?"float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ".concat(r,"\n        }"):"\n          float activation(float x) {\n            ".concat(r,"\n          }\n        "),l="result = activation(result);");var d=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(c,"\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ").concat(u,";\n        int q = d2 - d1 * ").concat(u,";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < ").concat(o,"; wR++) {\n          int xR = xRCorner + wR * dilations[0];\n\n          if (xR < 0 || xR >= inDims[0]) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(s,"; wC++) {\n            int xC = xCCorner + wC * dilations[1];\n\n            if (xC < 0 || xC >= inDims[1]) {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        ").concat(d,"\n        ").concat(l,"\n        setOutput(result);\n      }\n    ")},fV=function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];Object(O.a)(this,e),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=jL(this.outputShape.length);for(var o=t.outChannels/t.inChannels,s=t.padInfo.left,u=t.strideWidth,c=t.dilationWidth,l=t.filterHeight,d=t.filterWidth,p=d,f="\n      int xR; int xC; int xCOffset;\n      vec4 wTexel; vec4 previous; vec4 final;",h=0;h<d;h++)f+="\n          vec4 xTexelC".concat(2*h,";\n          int xTexelC").concat(2*h,"Ready;\n          vec4 xTexelC").concat(2*h+1,";\n          int xTexelC").concat(2*h+1,"Ready;\n          vec4 xC").concat(h,";");f+="\n    for (int r = 0; r < ".concat(l,"; r++) {\n      ");for(var m=0;m<d;m++)f+="\n          xTexelC".concat(2*m," = vec4(0.0);\n          xTexelC").concat(2*m,"Ready = 0;\n          xTexelC").concat(2*m+1," = vec4(0.0);\n          xTexelC").concat(2*m+1,"Ready = 0;\n          xC").concat(m," = vec4(0.0);");f+="\n        xR = xRCorner + r * dilations[0];\n        if (xR >=0 && xR < inDims[0]) {\n      ";for(var v=0;v<(p+1)/2;v++){var b=2*v;if(f+="\n          xC = xCCorner + ".concat(b*c,";\n          "),1===u){if(b<d&&(s%2===1?(f+="\n                xCOffset = xC + 1;\n                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(b,"Ready == 0) {\n                  xTexelC").concat(b," = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC").concat(b,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(b,"Ready = 1;\n                }\n              "),f+=1===c&&b>0?"\n                xC".concat(b," = vec4(xTexelC").concat(b-2,".zw, xTexelC").concat(b,".xy);\n                "):"\n                  xCOffset = xC + 1 - 2;\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                    previous = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      previous.zw = vec2(0.0);\n                    }\n\n                    xC".concat(b," = vec4(previous.zw, xTexelC").concat(b,".xy);\n                  } else {\n                    xC").concat(b," = vec4(0.0, 0.0, xTexelC").concat(b,".xy);\n                  }\n                  ")):f+="\n                if (xC >= 0 && xC < inDims[1] && xTexelC".concat(b,"Ready == 0) {\n                  xTexelC").concat(b," = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC").concat(b,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(b,"Ready = 1;\n                }\n\n                xC").concat(b," = xTexelC").concat(b,";\n                "),b+1<d)){var g=s%2===0?Ga.nearestLargerEven(c):c;c%2===0&&s%2===1||c%2!==0&&s%2!==1?(f+="\n                  xCOffset = xC + imod(pads[1], 2) + ".concat(g,";\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(b+1,"Ready == 0) {\n                    xTexelC").concat(b+1," = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      xTexelC").concat(b+1,".zw = vec2(0.0);\n                    }\n                    xTexelC").concat(b+1,"Ready = 1;\n                  }\n                  "),f+=c>1?"\n                    xCOffset -= 2;\n                    if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                     previous = getX(batch, xR, xCOffset, d1);\n                     xC".concat(b+1," = vec4(previous.zw, xTexelC").concat(b+1,".xy);\n                    } else {\n                     xC").concat(b+1," = vec4(0.0, 0.0, xTexelC").concat(b+1,".xy);\n                    }\n                    "):"\n                    xC".concat(b+1," = vec4(xTexelC").concat(b,".zw, xTexelC").concat(b+1,".xy);\n                    ")):f+=1===g?"\n                    xC".concat(b+1," = xTexelC").concat(b,";\n                    "):"\n                    xCOffset = xC + ".concat(g,";\n\n                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(b+1,"Ready == 0) {\n                      xTexelC").concat(b+1," = getX(batch, xR, xCOffset, d1);\n                      if (xCOffset + 1 >= inDims[1]) {\n                        xTexelC").concat(b+1,".zw = vec2(0.0);\n                      }\n                      xTexelC").concat(b+1,"Ready = 1;\n                    }\n\n                    xC").concat(b+1," = xTexelC").concat(b+1,";\n                    ")}}else b<d&&(s%2===1?(f+="\n                xCOffset = xC + 1 - strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(b,"Ready == 0) {\n                  xTexelC").concat(b," = getX(batch, xR, xCOffset, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC").concat(b,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(b,"Ready = 1;\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC").concat(b+1,"Ready == 0) {\n                  xTexelC").concat(b+1," = getX(batch, xR, xC + 1, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xC + 2 >= inDims[1]) {\n                    xTexelC").concat(b+1,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(b+1,"Ready = 1;\n                }\n\n                xC").concat(b," = vec4(xTexelC").concat(b,".zw, xTexelC").concat(b+1,".zw);\n              "),b+1<d&&(f+="\n                  final = vec4(0.0);\n                  xCOffset = xC + 1 + strides[1];\n                  if(xCOffset >= 0 && xCOffset < inDims[1]) {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xC".concat(b+1," = vec4(xTexelC").concat(b+1,".xy, final.xy);\n                "))):(f+="\n                if(xC >= 0 && xC < inDims[1] && xTexelC".concat(b,"Ready == 0) {\n                  xTexelC").concat(b," = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC").concat(b,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(b,"Ready = 1;\n                }\n\n                xCOffset = xC + strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(b+1,"Ready == 0) {\n                  xTexelC").concat(b+1," = getX(batch, xR, xCOffset, d1);\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC").concat(b+1,".zw = vec2(0.);\n                  }\n                  xTexelC").concat(b+1,"Ready = 1;\n                }\n\n                xC").concat(b," = vec4(\n                  xTexelC").concat(b,".xy, xTexelC").concat(b+1,".xy);\n              "),b+1<d&&(f+="\n                  xC".concat(b+1," = vec4(xTexelC").concat(b,".zw, xTexelC").concat(b+1,".zw);\n                "))));b<d&&(f+="\n            wTexel = getW(r, ".concat(b,", d1, q);\n            dotProd += xC").concat(b," * vec4(wTexel.xz, wTexel.xz);\n          "),b+1<d&&(f+="\n              wTexel = getW(r, ".concat(b+1,", d1, q);\n              dotProd += xC").concat(b+1," * vec4(wTexel.xz, wTexel.xz);\n            ")))}f+="\n    }\n  ",f+="\n      }\n    ";var y="",x="";r&&(y=a?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ".concat(r,"\n        }"):i?"vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ".concat(r,"\n        }"):"vec4 activation(vec4 x) {\n          ".concat(r,"\n        }"),x="result = activation(result);");var k=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(y,"\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ").concat(o,";\n        int q = d2 - d1 * ").concat(o,";\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.\n        vec4 dotProd = vec4(0.000000000000001);\n\n        ").concat(f,"\n\n        vec4 result = dotProd - vec4(0.000000000000001);\n        ").concat(k,"\n        ").concat(x,"\n        setOutput(result);\n      }\n    ")};var hV={kernelName:tn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations,c=r.dimRoundingMode,l=u;null==l&&(l=[1,1]),Ga.assert(Wm.eitherStridesOrDilationsAreOne(o,l),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ".concat(o," and dilations '").concat(l,"'")}));var d,p=Wm.computeConv2DInfo(a.shape,i.shape,o,l,s,c,!0);d=st().getBool("WEBGL_PACK_DEPTHWISECONV")&&p.strideWidth<=2&&p.outChannels/p.inChannels===1?new fV(p):new pV(p);var f=[[p.padInfo.top,p.padInfo.left],[p.strideHeight,p.strideWidth],[p.dilationHeight,p.dilationWidth],[p.inHeight,p.inWidth]];return n.runWebGLProgram(d,[a,i],"float32",f)}},mV=function e(t){Object(O.a)(this,e),this.variableNames=["x","dy"],this.outputShape=t.filterShape;var n=t.strideHeight,r=t.strideWidth,a=t.padInfo.top,i=t.padInfo.left,o=t.outChannels/t.inChannels;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * ".concat(o," + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < ").concat(t.batchSize,"; b++) {\n          for (int yR = 0; yR < ").concat(t.outHeight,"; yR++) {\n            int xR = wR + yR * ").concat(n," - ").concat(a,";\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int yC = 0; yC < ").concat(t.outWidth,"; yC++) {\n              int xC = wC + yC * ").concat(r," - ").concat(i,";\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},vV=function e(t){Object(O.a)(this,e),this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterHeight,r=t.filterWidth,a=t.strideHeight,i=t.strideWidth,o=n-1-t.padInfo.top,s=r-1-t.padInfo.left,u=t.outChannels/t.inChannels;this.userCode="\n      const ivec2 pads = ivec2(".concat(o,", ").concat(s,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < ").concat(n,"; wR++) {\n          float dyR = float(dyRCorner + wR) / ").concat(a,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ").concat(n," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(r,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(i,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ").concat(r," - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < ").concat(u,"; dm++) {\n              int d2 = d1 * ").concat(u," + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")};var bV={kernelName:nn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,l=r.filterShape,d=Wm.computeConv2DInfo(a.shape,l,o,s,u,c,!0),p=new mV(d);return n.runWebGLProgram(p,[a,i],"float32")}};var gV={kernelName:rn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,l=r.inputShape,d=Wm.computeConv2DInfo(l,i.shape,o,s,u,c,!0),p=new vV(d);return n.runWebGLProgram(p,[a,i],"float32")}},yV=function e(t){Object(O.a)(this,e),this.variableNames=["X"],this.outputShape=[t,t],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "};var xV={kernelName:an,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=[].concat(Object(S.a)(r.shape),Object(S.a)(r.shape)),i=Ga.sizeFromShape(r.shape),o=eW({inputs:{x:r},backend:n,attrs:{shape:[i]}}),s=new yV(i),u=n.runWebGLProgram(s,[o],o.dtype),c=eW({inputs:{x:u},backend:n,attrs:{shape:a}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(u),c}},kV=function e(t){Object(O.a)(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var n=t.inHeight,r=t.inWidth,a=t.padInfo,i=t.strideHeight,o=t.strideWidth,s=t.filterHeight,u=t.filterWidth,c=t.dilationHeight,l=t.dilationWidth,d=a.top,p=a.left;this.userCode="\n      const ivec2 strides = ivec2(".concat(i,", ").concat(o,");\n      const ivec2 pads = ivec2(").concat(d,", ").concat(p,");\n      const float neg_infinity = -3.4e38;\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.w;\n        ivec2 outTopLeftCorner =\n            coords.yz * strides - pads;\n        int hBeg = outTopLeftCorner.x;\n        int wBeg = outTopLeftCorner.y;\n\n        float curVal = neg_infinity;\n        for (int h = 0; h < ").concat(s,"; h++) {\n          int hIn = hBeg + h * ").concat(c,";\n\n          if (hIn >= 0 && hIn < ").concat(n,") {\n            for (int w = 0; w < ").concat(u,"; w++) {\n              int wIn = wBeg + w * ").concat(l,";\n\n              if (wIn >= 0 && wIn < ").concat(r,") {\n                float xVal = getX(batch, hIn, wIn, d1);\n                float wVal = getW(h, w, d1);\n\n                float val = xVal + wVal;\n                if (val > curVal) {\n                  curVal = val;\n                }\n              }\n            }\n          }\n        }\n\n        float result = curVal;\n        setOutput(result);\n      }\n    ")};var wV={kernelName:on,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=n.filter,s=a.strides,u=a.pad,c=a.dilations,l=Wm.computeDilation2DInfo(i.shape,o.shape,s,u,"NHWC",c),d=new kV(l),p=eW({inputs:{x:t=r.runWebGLProgram(d,[i,o],"float32")},backend:r,attrs:{shape:l.outShape}});return r.disposeIntermediateTensorInfo(t),p}};var OV={kernelName:dn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.equation,a=t,i=Wm.decodeEinsumEquation(r,a.length),o=i.allDims,s=i.summedDims,u=i.idDims;Wm.checkEinsumDimSizes(o.length,u,a);for(var c=Wm.getEinsumComputePath(s,u),l=c.path,d=c.steps,p=d.length,f=null,h=o.length,m=[],v=0;v<p;++v){var b,g=Object(N.a)(d[v]);try{for(g.s();!(b=g.n()).done;){var y=b.value,x=Wm.getEinsumPermutation(h,u[y]),k=x.permutationIndices,w=x.expandDims,O=void 0;Wm.isIdentityPermutation(k)?O=a[y]:(O=lW({inputs:{x:a[y]},backend:n,attrs:{perm:k}}),m.push(O));for(var I=O.shape.slice(),S=0;S<w.length;++S)I.splice(w[S],0,1);Ga.arraysEqual(O.shape,I)||(O=eW({inputs:{x:O},backend:n,attrs:{shape:I}}),m.push(O)),null===f?f=O:(f=QB({inputs:{a:O,b:f},backend:n}),m.push(f))}}catch(E){g.e(E)}finally{g.f()}v<p-1&&(l[v]>=0&&(f=uW({inputs:{x:f},backend:n,attrs:{axis:l[v]-(o.length-h),keepDims:!1}}),m.push(f)),h--)}for(var j=0,T=m;j<T.length;j++){var C=T[j];C!==f&&n.disposeIntermediateTensorInfo(C)}return f}},IV=GB({opSnippet:"return (x >= 0.0) ? x : (exp(x) - 1.0);",packedOpSnippet:"\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n"}),SV={kernelName:pn,backendName:"webgl",kernelFunc:IV},NV={kernelName:fn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.dy,a=t.y,i=st().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new RB("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",r.shape,a.shape):new _B("return (b >= 0.0) ? a : a * (b + 1.0);",r.shape,a.shape);return n.runWebGLProgram(i,[r,a],r.dtype)}},jV=HB({opSnippet:"return float(a == b);",packedOpSnippet:"\n  return vec4(equal(a, b));\n",dtype:"bool",cpuKernelImpl:pP}),TV={kernelName:mn,backendName:"webgl",kernelFunc:jV},CV=GB({opSnippet:'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = '.concat(Wm.ERF_P,";\n  float a1 = ").concat(Wm.ERF_A1,";\n  float a2 = ").concat(Wm.ERF_A2,";\n  float a3 = ").concat(Wm.ERF_A3,";\n  float a4 = ").concat(Wm.ERF_A4,";\n  float a5 = ").concat(Wm.ERF_A5,";\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n")}),EV={kernelName:hn,backendName:"webgl",kernelFunc:CV},_V=GB({opSnippet:"if (isnan(x)) return x;\n  return exp(x);\n",packedOpSnippet:"\n  vec4 result = exp(x);\n  bvec4 isNaN = isnan(x);\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",cpuKernelImpl:fP,dtype:"float32"}),AV={kernelName:vn,backendName:"webgl",kernelFunc:_V};function RV(e){var t=e.inputs,n=e.attrs,r=e.backend,a=n.dim,i=t.input,o=i.shape.length,s=i.shape.slice(),u=a;return a<0&&(Ga.assert(-(o+1)<=a,(function(){return"Axis must be in the interval [".concat(-(o+1),", ").concat(o,"]")})),u=o+a+1),s.splice(u,0,1),eW({inputs:{x:i},backend:r,attrs:{shape:s}})}var DV={kernelName:bn,backendName:"webgl",kernelFunc:RV},FV="return exp(x) - 1.0;",MV=GB({opSnippet:FV,packedOpSnippet:FV,cpuKernelImpl:hP}),zV={kernelName:gn,backendName:"webgl",kernelFunc:MV},LV=function e(t,n,r){Object(O.a)(this,e),this.variableNames=["real","imag"];var a=n[1];this.outputShape=n;var i,o=r?"2.0 * ".concat(Math.PI):"-2.0 * ".concat(Math.PI),s=r?"".concat(a,".0"):"1.0";if("real"===t)i="return real * expR - imag * expI;";else{if("imag"!==t)throw new Error('FFT component must be either "real" or "imag", got '.concat(t,"."));i="return real * expI + imag * expR;"}this.userCode="\n      const float exponentMultiplier = ".concat(o,";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        ").concat(i,"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float(").concat(a,");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < ").concat(a,"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / ").concat(s,";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    ")};function PV(e,t,n){var r=n.texData.get(e.dataId),a=Ga.sizeFromShape(e.shape),i=e.shape[e.shape.length-1],o=eW({inputs:{x:e},backend:n,attrs:{shape:[a/i,i]}}),s=o.shape,u=new LV("real",s,t),c=new LV("imag",s,t),l=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:s},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:s}],d=n.runWebGLProgram(u,l,"float32"),p=n.runWebGLProgram(c,l,"float32"),f=MB({inputs:{real:d,imag:p},backend:n});n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p);var h=eW({inputs:{x:f},backend:n,attrs:{shape:e.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(f),h}var BV={kernelName:yn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend;return PV(t.input,!1,n)}},WV=function e(t,n){Object(O.a)(this,e),this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=t,this.userCode="\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "};function UV(e){var t=e.backend,n=e.attrs,r=n.shape,a=n.value,i=n.dtype;if("string"===(i=i||Ga.inferDtype(a))){var o=Ga.getArrayFromDType(i,Ga.sizeFromShape(r));return o.fill(a),t.makeTensorInfo(r,i,o)}var s=new WV(r,a),u=[[a]];return t.runWebGLProgram(s,[],i,u)}var VV,GV={kernelName:xn,backendName:"webgl",kernelFunc:UV},HV=function e(t){Object(O.a)(this,e),this.variableNames=["Image"],this.outputShape=[];var n=t[2];this.outputShape=t,this.userCode="\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n\n          int coordX = ".concat(n," - x - 1;\n          float outputValue;\n          if(coordX >= 0 && coordX < ").concat(n,") {\n            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);\n          } else {\n            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    ")},qV={kernelName:kn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.image,a=n,i=new HV(r.shape);return a.runWebGLProgram(i,[r],r.dtype)}},KV="return floor(x);",XV=GB({opSnippet:KV,packedOpSnippet:KV,cpuKernelImpl:mP}),YV={kernelName:wn,backendName:"webgl",kernelFunc:XV},ZV=HB({opSnippet:"\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",packedOpSnippet:"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n",dtype:"int32"}),JV={kernelName:On,backendName:"webgl",kernelFunc:ZV},QV=function e(t){Object(O.a)(this,e),this.variableNames=["A"];var n=Kz(),r=Object(y.a)(t,2),a=r[0],i=r[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(".concat(i,".0, ").concat(a,".0);\n\n        vec4 values = ").concat(n.texture2D,"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    ")},$V=function e(t){Object(O.a)(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var n=Kz(),r=Object(y.a)(t,2),a=r[0],i=r[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2(".concat(i,".0, ").concat(a,".0);\n            vec4 values = ").concat(n.texture2D,"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        ").concat(n.output," = result;\n      }\n    ")},eG={kernelName:Na,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.pixels,i=r.numChannels,o="undefined"!=typeof HTMLVideoElement&&a instanceof HTMLVideoElement,s="undefined"!=typeof HTMLImageElement&&a instanceof HTMLImageElement,u=o?[a.videoWidth,a.videoHeight]:[a.width,a.height],c=Object(y.a)(u,2),l=c[0],d=c[1],p=[d,l],f=[d,l,i];if(s||o){var h=st().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(null==VV||h!==tG)&&(tG=h,VV=document.createElement("canvas").getContext("2d",{willReadFrequently:tG})),VV.canvas.width=l,VV.canvas.height=d,VV.drawImage(a,0,0,l,d),a=VV.canvas}var m=n.makeTensorInfo(p,"int32");n.texData.get(m.dataId).usage=BM.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(m.dataId),a);var v=st().getBool("WEBGL_PACK")?new $V(f):new QV(f),b=n.runWebGLProgram(v,[m],"int32");return n.disposeData(m.dataId),b}},tG=st().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");var nG={kernelName:Ca,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=n.filter,s=n.bias,u=n.preluActivationWeights,c=a.strides,l=a.pad,d=a.dataFormat,p=a.dilations,f=a.dimRoundingMode,h=a.activation,m=a.leakyreluAlpha,v=Wm.convertConv2DDataFormat(d),b=Wm.computeConv2DInfo(i.shape,o.shape,c,p,l,f,!1,v),g=[],y=null!=s,x=null!=u,k="leakyrelu"===h,w=function(){var e=[i,o],t=function(e,t){if("NCHW"===t&&1===e.shape.length&&1!==e.shape[0]){var n=eW({inputs:{x:e},backend:r,attrs:{shape:[e.shape[0],1,1]}});return g.push(n),n}return e};if(y&&e.push(t(s,d)),x&&e.push(t(u,d)),k){var n=r.makeTensorInfo([],"float32",Ga.createScalarValue(m,"float32"));e.push(n),g.push(n)}return e};if(1!==b.filterHeight||1!==b.filterWidth||1!==b.dilationHeight||1!==b.dilationWidth||1!==b.strideHeight||1!==b.strideWidth||"SAME"!==b.padInfo.type&&"VALID"!==b.padInfo.type)if(b.strideWidth<=2&&"channelsLast"===v&&st().getBool("WEBGL_EXP_CONV")){var O=h?qB(h,!0):null,I=new DU(b,y,O,x,k),S=[[b.padInfo.top,b.padInfo.left],[b.strideHeight,b.strideWidth],[b.dilationHeight,b.dilationWidth],[b.inHeight,b.inWidth]],N=w();t=r.runWebGLProgram(I,N,"float32",S)}else if(st().getBool("WEBGL_CONV_IM2COL"))t=LU({x:i,filter:o,convInfo:b,backend:r,bias:s,activation:h,preluActivationWeights:u,leakyreluAlpha:m});else{var j=h?qB(h,!1):null,T=new AU(b,y,j,x,k),C=w();t=r.runWebGLProgram(T,C,"float32")}else t=zU({x:i,filter:o,convInfo:b,backend:r,bias:s,activation:h,preluActivationWeights:u,leakyreluAlpha:m});var E=eW({inputs:{x:t},backend:r,attrs:{shape:b.outShape}});return g.push(t),g.forEach((function(e){return r.disposeIntermediateTensorInfo(e)})),E}};var rG={kernelName:Ea,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.bias,s=t.preluActivationWeights,u=r.strides,c=r.pad,l=r.dilations,d=r.dimRoundingMode,p=r.activation,f=r.leakyreluAlpha,h=[],m=l;null==m&&(m=[1,1]),Ga.assert(Wm.eitherStridesOrDilationsAreOne(u,m),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ".concat(u," and dilations '").concat(m,"'")}));var v,b=Wm.computeConv2DInfo(a.shape,i.shape,u,m,c,d,!0),g=st().getBool("WEBGL_PACK_DEPTHWISECONV")&&b.strideWidth<=2&&b.outChannels/b.inChannels===1,y=p?qB(p,g):null,x=[a,i],k=null!=o,w=null!=s,O="leakyrelu"===p;if(k&&x.push(o),w&&x.push(s),O){var I=n.makeTensorInfo([],"float32",Ga.createScalarValue(f,"float32"));x.push(I),h.push(I)}v=g?new fV(b,k,y,w,O):new pV(b,k,y,w,O);var S=[[b.padInfo.top,b.padInfo.left],[b.strideHeight,b.strideWidth],[b.dilationHeight,b.dilationWidth],[b.inHeight,b.inWidth]],N=n.runWebGLProgram(v,x,"float32",S);return h.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),N}},aG=function e(t,n,r,a){Object(O.a)(this,e),this.sliceDim=t,this.strides=n,this.paramsShape=a,this.variableNames=["x","indices"],this.outputShape=r;for(var i=gL(r.length),o="\n    int index;",s=0;s<this.sliceDim;s++)o+="\n          index = round(getIndices(coords[0], ".concat(s,"));\n          out_of_bounds = out_of_bounds || index < 0;\n          out_of_bounds = out_of_bounds || index >= ").concat(this.paramsShape[s],";\n          flattenIndex += index * ").concat(this.strides[s],";");this.userCode="\n         void main() {\n          ".concat(i," coords = getOutputCoords();\n          int flattenIndex = 0;\n          bool out_of_bounds = false;\n\n          ").concat(o,"\n\n          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));\n        }\n      ")};var iG={kernelName:Nn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.params,a=t.indices,i=a.shape,o=i[i.length-1],s=Ga.sizeFromShape(r.shape),u=Wm.prepareAndValidate(r,a),c=Object(y.a)(u,4),l=c[0],d=c[1],p=c[2],f=c[3],h=eW({inputs:{x:a},backend:n,attrs:{shape:[d,o]}}),m=eW({inputs:{x:r},backend:n,attrs:{shape:[Ga.sizeFromShape(r.shape)/p,p]}});if(n.shouldExecuteOnCPU([r,a])||"string"===r.dtype){var v=n.readSync(a.dataId),b=n.bufferSync(r),g=vP(v,b,r.dtype,d,o,p,f,r.shape,s);return n.makeTensorInfo(l,r.dtype,g.values)}var x=new aG(o,f,[d,p],r.shape),k=n.runWebGLProgram(x,[m,h],m.dtype),w=eW({inputs:{x:k},backend:n,attrs:{shape:l}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(k),w}},oG=function e(t,n){Object(O.a)(this,e),this.variableNames=["A","indices"],this.outputShape=n,this.rank=n.length;var r=gL(this.rank),a=function(e,t){for(var n=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[],a=0;a<e.length;a++)2===a?r.push("index"):r.push("".concat(n[a]));return r.join()}(t);this.userCode="\n      void main() {\n        ".concat(r," resRC = getOutputCoords();\n        int index = int(getIndices(resRC.x, resRC.z));\n        float inBounds = (index >= 0) && (index < ").concat(t[2],") ? 1.0 : 0.0;\n        setOutput(inBounds * getA(").concat(a,"));\n      }\n    ")};function sG(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.indices,o=r.axis,s=r.batchDims,u=Ga.parseAxisParam(o,a.shape)[0];st().get("DEBUG")&&function(){for(var e=n.readSync(i.dataId),t=a.shape[u],r=function(n){var r=e[n];Ga.assert(r<=t-1&&r>=0,(function(){return"GatherV2: the index value ".concat(r," is not in [0, ").concat(t-1,"]")}))},o=0;o<e.length;++o)r(o)}();var c=Wm.segment_util.collectGatherOpShapeInfo(a,i,u,s),l=Ga.sizeFromShape(i.shape),d=[],p=eW({inputs:{x:a},backend:n,attrs:{shape:[c.batchSize,c.outerSize,c.dimSize,c.sliceSize]}}),f=eW({inputs:{x:i},backend:n,attrs:{shape:[c.batchSize,l/c.batchSize]}});d.push(p),d.push(f);var h=[c.batchSize,c.outerSize,l/c.batchSize,c.sliceSize];if(n.shouldExecuteOnCPU([a,i])||"string"===a.dtype){var m=n.bufferSync(f),v=n.bufferSync(p),b=bP(v,m,h);return d.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(c.outputShape,b.dtype,b.values)}var g=new oG(p.shape,h),y=n.runWebGLProgram(g,[p,f],p.dtype);d.push(y);var x=eW({inputs:{x:y},backend:n,attrs:{shape:c.outputShape}});return d.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),x}var uG={kernelName:Sn,backendName:"webgl",kernelFunc:sG},cG=HB({opSnippet:"return float(a > b);",packedOpSnippet:"\n  return vec4(greaterThan(a, b));\n",cpuKernelImpl:gP,dtype:"bool"}),lG={kernelName:jn,backendName:"webgl",kernelFunc:cG},dG=HB({opSnippet:"return float(a >= b);",packedOpSnippet:"\n  return vec4(greaterThanEqual(a, b));\n",dtype:"bool",cpuKernelImpl:yP}),pG={kernelName:Tn,backendName:"webgl",kernelFunc:dG};var fG={kernelName:En,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend;return PV(t.input,!0,n)}},hG=GB({opSnippet:"return float(!isnan(x) && !isinf(x));",dtype:"bool"}),mG={kernelName:An,backendName:"webgl",kernelFunc:hG},vG=GB({opSnippet:"return float(isinf(x));",dtype:"bool"}),bG={kernelName:Rn,backendName:"webgl",kernelFunc:vG},gG=GB({opSnippet:"return float(isnan(x));",dtype:"bool"}),yG={kernelName:Dn,backendName:"webgl",kernelFunc:gG},xG=HB({opSnippet:"return float(a < b);",packedOpSnippet:"\n  return vec4(lessThan(a, b));\n",cpuKernelImpl:xP,dtype:"bool"}),kG={kernelName:Mn,backendName:"webgl",kernelFunc:xG},wG=HB({opSnippet:"return float(a <= b);",packedOpSnippet:"\n  return vec4(lessThanEqual(a, b));\n",cpuKernelImpl:kP,dtype:"bool"}),OG={kernelName:zn,backendName:"webgl",kernelFunc:wG};var IG={kernelName:Ln,backendName:"webgl",kernelFunc:function(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,i=n.num,o=wP(r,a,i);return t.makeTensorInfo([o.length],"float32",o)}},SG=GB({opSnippet:"if (isnan(x)) return x;\n  return x < 0.0 ? 0./0. : log(x);\n",packedOpSnippet:"\n  vec4 result = log(x);\n  bvec4 isNaN = isnan(x);\n  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);\n  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);\n  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);\n  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);\n  return result;\n",cpuKernelImpl:OP}),NG={kernelName:Pn,backendName:"webgl",kernelFunc:SG},jG=GB({opSnippet:"if (isnan(x)) return x;\n  return log(1.0 + x);\n"}),TG={kernelName:Bn,backendName:"webgl",kernelFunc:jG},CG=HB({opSnippet:"return float(a >= 1.0 && b >= 1.0);",packedOpSnippet:"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n",dtype:"bool"}),EG={kernelName:Wn,backendName:"webgl",kernelFunc:CG},_G=GB({opSnippet:"return float(!(x >= 1.0));"}),AG={kernelName:Un,backendName:"webgl",kernelFunc:_G},RG=HB({opSnippet:"return float(a >= 1.0 || b >= 1.0);",packedOpSnippet:"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n",dtype:"bool"}),DG={kernelName:Vn,backendName:"webgl",kernelFunc:RG},FG=function e(t,n,r,a,i){Object(O.a)(this,e),this.variableNames=["x"],this.outputShape=[];var o=n,s=t[3]-1;this.outputShape=t;var u,c="float(".concat(r,") + float(").concat(a,") * sum");u=.5===i?"inversesqrt(".concat(c,")"):1===i?"1.0/(".concat(c,")"):"exp(log(".concat(c,") * float(-").concat(i,"));"),this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -".concat(o,"; j <= ").concat(o,"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  ").concat(s,") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * ").concat(u,";\n        setOutput(val);\n      }\n    ")},MG=function e(t,n,r,a,i){Object(O.a)(this,e),this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var o=n,s=t[3]-1;this.outputShape=t;var u,c="float(".concat(r,") + float(").concat(a,") * sum");u=.5===i?"inversesqrt(".concat(c,")"):1===i?"1.0/(".concat(c,")"):"exp(log(".concat(c,") * float(-").concat(i,"));"),this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < ".concat(this.outputShape[3],";\n        bool hasNextRow = c < ").concat(this.outputShape[2],";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - ").concat(o,";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - ").concat(o,"; j <= ").concat(o,"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(").concat(s,"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * ").concat(u,";\n        setOutput(result);\n      }\n    ")},zG={kernelName:Kn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.depthRadius,o=r.bias,s=r.alpha,u=r.beta,c=st().getBool("WEBGL_PACK_NORMALIZATION")?new MG(a.shape,i,o,s,u):new FG(a.shape,i,o,s,u);return n.runWebGLProgram(c,[a],a.dtype)}},LG=function e(t,n,r,a,i){Object(O.a)(this,e),this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=t,this.depth=t[3],this.depthRadius=n,this.bias=r,this.alpha=a,this.beta=i,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < ".concat(this.depth,"; ++d) {\n          int depthBegin = int(max(0.0, float(d - ").concat(n,")));\n          int depthEnd = int(min(float(").concat(this.depth,"),\n              float(d + ").concat(n," + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = ").concat(this.depth,";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float(").concat(a,") * norm + float(").concat(r,");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float(").concat(a,")\n                * float(").concat(i,")\n                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * ").concat(i,");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    ")},PG={kernelName:Xn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.y,o=t.dy,s=r.depthRadius,u=r.bias,c=r.alpha,l=r.beta,d=new LG(a.shape,s,u,c,l);return n.runWebGLProgram(d,[a,i,o],a.dtype)}};function BG(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.reductionIndices,o=r.keepDims,s=a.shape.length,u=Ga.parseAxisParam(i,a.shape),c=u,l=Wm.getAxesPermutation(c,s),d=null!=l,p=n.shouldExecuteOnCPU([a]),f=a;if(d){if(p){for(var h=n.texData.get(f.dataId).values,m=new Array(s),v=0;v<m.length;v++)m[v]=a.shape[l[v]];var b=QP(h,a.shape,a.dtype,l,m);f=n.makeTensorInfo(m,a.dtype),n.texData.get(f.dataId).values=b}else f=sW(a,l,n);c=Wm.getInnerMostAxes(c.length,s)}Wm.assertAxesAreInnerMostDims("max",c,s);var g,x=Wm.computeOutAndReduceShapes(f.shape,c),k=Object(y.a)(x,2),w=k[0],O=k[1],I=w;if(o&&(I=Wm.expandShapeToKeepDim(w,u)),p){var S=n.texData.get(f.dataId).values,N=IP(S,Ga.sizeFromShape(O),I,a.dtype);g=n.makeTensorInfo(I,a.dtype),n.texData.get(g.dataId).values=N}else g=function(e,t,n,r){var a=Ga.sizeFromShape(t),i=eW({inputs:{x:e},attrs:{shape:[Ga.sizeFromShape(e.shape)/a,a]},backend:r}),o=aW(i,e.dtype,"max",r),s=eW({inputs:{x:o},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),s}(f,O,I,n);return d&&n.disposeIntermediateTensorInfo(f),g}var WG={kernelName:Zn,backendName:"webgl",kernelFunc:BG},UG=HB({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(max(a, b));\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  \n  result.r = isNaN.r ? NAN : result.r;\n  result.g = isNaN.g ? NAN : result.g;\n  result.b = isNaN.b ? NAN : result.b;\n  result.a = isNaN.a ? NAN : result.a;\n\n  return result;\n",cpuKernelImpl:SP}),VG={kernelName:Jn,backendName:"webgl",kernelFunc:UG};var GG={kernelName:Qn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;Hz(a,"maxPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode;Ga.assert(Wm.eitherStridesOrDilationsAreOne(o,1),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides ".concat(o," and dilations '").concat(1,"'")}));var c=Wm.computePool2DInfo(a.shape,i,o,1,s,u);if(1===c.filterWidth&&1===c.filterHeight&&Ga.arraysEqual(c.inShape,c.outShape))return DB({inputs:{x:a},backend:n});var l=new VW(c,"max",!1);return n.runWebGLProgram(l,[a],a.dtype)}};var HG={kernelName:er,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dimRoundingMode,l=Wm.computePool3DInfo(a.shape,i,o,[1,1,1],s,c,u),d=new GW(l,"max",!1);return n.runWebGLProgram(d,[a],a.dtype)}},qG=function e(t){Object(O.a)(this,e),this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var n=t.strideHeight,r=t.strideWidth,a=t.dilationHeight,i=t.effectiveFilterHeight,o=t.effectiveFilterWidth,s=i-1-t.padInfo.top,u=o-1-t.padInfo.left,c=i*o-1;this.userCode="\n      const ivec2 pads = ivec2(".concat(s,", ").concat(u,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(i,";\n          wR += ").concat(a,") {\n          float dyR = float(dyRCorner + wR) / ").concat(n,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ").concat(o,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(r,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = ").concat(c," - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * ").concat(o," + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},KG=function e(t){Object(O.a)(this,e),this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var n=t.strideDepth,r=t.strideHeight,a=t.strideWidth,i=t.dilationDepth,o=t.dilationHeight,s=t.dilationWidth,u=t.effectiveFilterDepth,c=t.effectiveFilterHeight,l=t.effectiveFilterWidth,d=u-1-t.padInfo.front,p=c-1-t.padInfo.top,f=l-1-t.padInfo.left,h=u*c*l-1;this.userCode="\n      const ivec3 pads = ivec3(".concat(d,", ").concat(p,", ").concat(f,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ").concat(u,";\n           wD += ").concat(i,") {\n          float dyD = float(dyDCorner + wD) / ").concat(n,".0;\n\n          if (dyD < 0.0 || dyD >= ").concat(t.outDepth,".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ").concat(c,";\n              wR += ").concat(o,") {\n            float dyR = float(dyRCorner + wR) / ").concat(r,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ").concat(l,";\n                wC += ").concat(s,") {\n              float dyC = float(dyCCorner + wC) / ").concat(a,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = ").concat(h," -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * ").concat(c," * ").concat(l," +\n                  wR * ").concat(l," + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")};var XG={kernelName:tr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode,l=Wm.computePool3DInfo(i.shape,o,s,[1,1,1],u,c),d=new GW(l,"max",!0),p=n.runWebGLProgram(d,[i],i.dtype),f=new KG(l),h=n.runWebGLProgram(f,[a,p],i.dtype);return n.disposeIntermediateTensorInfo(p),h}};var YG={kernelName:$n,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;Hz([i,t.output],"maxPoolGrad");var s=r.filterSize,u=r.strides,c=r.pad,l=r.dimRoundingMode,d=Wm.computePool2DInfo(o.shape,s,u,1,c,l),p=new VW(d,"max",!0),f=n.runWebGLProgram(p,[o],o.dtype),h=new qG(d),m=n.runWebGLProgram(h,[a,f],o.dtype);return n.disposeIntermediateTensorInfo(f),m}};var ZG={kernelName:nr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.filterSize,o=n.strides,s=n.pad,u=n.includeBatchInIndex,c=r;Ga.assert(4===a.shape.length,(function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(a.shape.length,".")}));var l=[1,1];Ga.assert(Wm.eitherStridesOrDilationsAreOne(o,l),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides ".concat(o," and dilations '").concat(l,"'")}));var d=Wm.computePool2DInfo(a.shape,i,o,l,s),p=function(e,t,n,r){var a=new VW(n,"max",!1),i=r.runWebGLProgram(a,[e],"float32");return a=new VW(n,"max",!0,!0,t),[i,r.runWebGLProgram(a,[e],"float32")]}(a,u,d,c),f=Object(y.a)(p,2);return[f[0],f[1]]}};var JG={kernelName:rr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.keepDims,o=n.axis,s=r,u=a.shape.length,c=Ga.parseAxisParam(o,a.shape),l=c,d=Wm.getAxesPermutation(l,u),p=null!=d,f=s.shouldExecuteOnCPU([a]),h=[],m=a;if(p){if(f){for(var v=s.texData.get(m.dataId).values,b=new Array(u),g=0;g<b.length;g++)b[g]=a.shape[d[g]];var x=QP(v,a.shape,a.dtype,d,b);m=s.makeTensorInfo(b,a.dtype),s.texData.get(m.dataId).values=x}else m=sW(a,d,s);h.push(m),l=Wm.getInnerMostAxes(l.length,u)}Wm.assertAxesAreInnerMostDims("sum",l,u);var k=Wm.computeOutAndReduceShapes(m.shape,l),w=Object(y.a)(k,2),O=w[0],I=w[1],S=O;i&&(S=Wm.expandShapeToKeepDim(O,c));for(var N=function(e,t,n,r){var a=Ga.sizeFromShape(t),i=eW({inputs:{x:e},attrs:{shape:[Ga.sizeFromShape(e.shape)/a,a]},backend:r}),o=aW(i,"float32","mean",r),s=eW({inputs:{x:o},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),s}(m,I,S,s),j=0,T=h;j<T.length;j++){var C=T[j];s.disposeIntermediateTensorInfo(C)}return N}};var QG={kernelName:ar,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims,s=a.shape.length,u=Ga.parseAxisParam(i,a.shape),c=u,l=Wm.getAxesPermutation(c,s),d=a;null!=l&&(d=lW({inputs:{x:a},backend:n,attrs:{perm:l}}),c=Wm.getInnerMostAxes(c.length,a.shape.length)),Wm.assertAxesAreInnerMostDims("min",c,s);var p,f=Wm.computeOutAndReduceShapes(d.shape,c),h=Object(y.a)(f,2),m=h[0],v=h[1],b=eW({inputs:{x:d},backend:n,attrs:{shape:[-1,Ga.sizeFromShape(v)]}}),g=aW(b,b.dtype,"min",n);return p=eW(o?{inputs:{x:g},backend:n,attrs:{shape:Wm.expandShapeToKeepDim(m,u)}}:{inputs:{x:g},backend:n,attrs:{shape:m}}),n.disposeIntermediateTensorInfo(b),n.disposeIntermediateTensorInfo(g),null!=l&&n.disposeIntermediateTensorInfo(d),p}},$G=HB({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(min(a, b));\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  \n  result.r = isNaN.r ? NAN : result.r;\n  result.g = isNaN.g ? NAN : result.g;\n  result.b = isNaN.b ? NAN : result.b;\n  result.a = isNaN.a ? NAN : result.a;\n\n  return result;\n",cpuKernelImpl:NP}),eH={kernelName:ir,backendName:"webgl",kernelFunc:$G},tH=function e(t,n,r){Object(O.a)(this,e),this.variableNames=["x"],this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));var a=t.length,i=gL(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,a),c="reflect"===r?0:1;this.userCode=1!==a?"\n      ".concat(i," start = ").concat(i,"(").concat(o,");\n      ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outC = getOutputCoords();\n        for (int i = 0; i < ").concat(a,"; i++) {\n          if (outC[i] < start[i]) {\n            outC[i] = start[i] * 2 - outC[i] - ").concat(c,";\n          } else if(outC[i] >= end[i]) {\n            outC[i] = (end[i] - 1) * 2 - outC[i] + ").concat(c,";\n          }\n        }\n        ").concat(i," coords = outC - start;\n        setOutput(getX(").concat(u,"));\n      }\n    "):"\n        int start = ".concat(o,";\n        int end = ").concat(s,";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start) {\n            outC = start * 2 - outC - ").concat(c,";\n          } else if(outC >= end) {\n            outC = (end - 1) * 2 - outC + ").concat(c,";\n          }\n          setOutput(getX(outC - start));\n        }\n      ")},nH=function e(t,n,r){Object(O.a)(this,e),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));var a=t.length,i=gL(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=tB("rc",a),c=tB("source",a),l="".concat(u[a-1]," < ").concat(this.outputShape[a-1]),d=1===a?"source":"vec2(".concat(c.slice(-2).join(),")"),p="reflect"===r?0:1,f="";if(1===a){var h="\n        ".concat(i," source = rc;\n        if (source < start) {\n          source = start * 2 - source - ").concat(p,";\n        } else if (source >= end) {\n          source = (end - 1) * 2 - source + ").concat(p,";\n        }\n        source -= start;\n      ");f="\n        ".concat(i," rc = outputLoc;\n        ").concat(h,"\n        result[0] = getChannel(getX(").concat(c.join(),"), ").concat(d,");\n        ").concat(u[a-1]," += 1;\n        if(").concat(l,") {\n          ").concat(h,"\n          result[1] = getChannel(getX(").concat(c.join(),"), ").concat(d,");\n        }\n      ")}else{var m="\n        ".concat(i," source = rc;\n        ").concat(i," lt = ").concat(i,"(lessThan(source, start));\n        ").concat(i," gte = ").concat(i,"(greaterThanEqual(source, end));\n        ").concat(i," orig = 1 - (lt + gte);\n        source = orig * source +\n                lt * (start * 2 - source - ").concat(p,") +\n                gte * ((end - 1) * 2 - source + ").concat(p,");\n        source -= start;\n      ");f="\n        ".concat(i," rc = outputLoc;\n        ").concat(m,"\n        result[0] = getChannel(getX(").concat(c.join(),"), ").concat(d,");\n        ").concat(u[a-1]," += 1;\n        if(").concat(l,") {\n          ").concat(m,"\n          result[1] = getChannel(getX(").concat(c.join(),"), ").concat(d,");\n        }\n        rc = outputLoc;\n        ").concat(u[a-2]," += 1;\n        if(").concat(u[a-2]," < ").concat(this.outputShape[a-2],") {\n          ").concat(m,"\n          result[2] = getChannel(getX(").concat(c.join(),"), ").concat(d,");\n          ").concat(u[a-1]," += 1;\n          if(").concat(l,") {\n            ").concat(m,"\n            result[3] = getChannel(getX(").concat(c.join(),"), ").concat(d,");\n          }\n        }\n      ")}this.userCode="\n      const ".concat(i," start = ").concat(i,"(").concat(o,");\n      const ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ").concat(f,"\n        setOutput(result);\n      }\n    ")},rH={kernelName:or,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.paddings,o=r.mode,s=st().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new nH(a.shape,i,o):new tH(a.shape,i,o);return n.runWebGLProgram(s,[a],a.dtype)}},aH=HB({opSnippet:"if (b == 0.0) return NAN;\n  return mod(a, b);",packedOpSnippet:"\n  vec4 result = mod(a, b);\n  bvec4 isNaN = equal(b, vec4(0.0));\n  \n  result.r = isNaN.r ? NAN : result.r;\n  result.g = isNaN.g ? NAN : result.g;\n  result.b = isNaN.b ? NAN : result.b;\n  result.a = isNaN.a ? NAN : result.a;\n\n  return result;\n"}),iH={kernelName:sr,backendName:"webgl",kernelFunc:aH},oH=function e(t,n,r){Object(O.a)(this,e),this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[t,r],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < ".concat(n-1,"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float(").concat(n-1,"));\n      }\n    ")},sH=HB({opSnippet:"\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",packedOpSnippet:"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n",checkOutOfBounds:!0}),uH={kernelName:ln,backendName:"webgl",kernelFunc:sH},cH="return a - b;",lH=HB({opSnippet:cH,packedOpSnippet:cH,supportsComplex:!0,cpuKernelImpl:YP}),dH={kernelName:fa,backendName:"webgl",kernelFunc:lH};function pH(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,i=r.dim,o=Ga.parseAxisParam([i],a.shape),s=BG({inputs:{x:a},backend:n,attrs:{reductionIndices:o,keepDims:!1}}),u=Wm.expandShapeToKeepDim(s.shape,o),c=eW({inputs:{x:s},backend:n,attrs:{shape:u}}),l=lH({inputs:{a:a,b:c},backend:n}),d=_V({inputs:{x:l},backend:n}),p=uW({inputs:{x:d},backend:n,attrs:{axis:o,keepDims:!1}}),f=eW({inputs:{x:p},backend:n,attrs:{shape:u}}),h=sH({inputs:{a:d,b:f},backend:n});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),h}var fH={kernelName:ea,backendName:"webgl",kernelFunc:pH};var hH={kernelName:ur,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,i=r.numSamples,o=r.seed,s=r.normalized,u=s?a:pH({inputs:{logits:a},backend:n,attrs:{dim:a.shape.length-1}}),c=u.shape[0],l=u.shape[1],d=new oH(c,l,i),p=[[o]],f=n.runWebGLProgram(d,[u],"int32",p);return s||n.disposeIntermediateTensorInfo(u),f}};var mH={kernelName:lr,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=n.x;if(r.shouldExecuteOnCPU([a])){var i=r.texData.get(a.dataId),o=TP(i.values,a.shape,a.dtype),s=Object(y.a)(o,2),u=s[0],c=s[1];return r.makeTensorInfo(c,a.dtype,u)}return t=st().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new wB(a.shape,"\n  vec4 result = -x;\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"):new uB(a.shape,"if (isnan(x)) return x;\n  return -x;\n"),r.runWebGLProgram(t,[a],a.dtype)}},vH=Gv.nonMaxSuppressionV3Impl;var bH={kernelName:pr,backendName:"webgl",kernelFunc:function(e){Wm.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=n.readSync(a.dataId),l=n.readSync(i.dataId),d=vH(c,l,o,s,u).selectedIndices;return n.makeTensorInfo([d.length],"int32",new Int32Array(d))}},gH=Gv.nonMaxSuppressionV4Impl;var yH={kernelName:fr,backendName:"webgl",kernelFunc:function(e){Wm.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.padToMaxOutputSize,l=n.readSync(a.dataId),d=n.readSync(i.dataId),p=gH(l,d,o,s,u,c),f=p.selectedIndices,h=p.validOutputs;return[n.makeTensorInfo([f.length],"int32",new Int32Array(f)),n.makeTensorInfo([],"int32",new Int32Array([h]))]}},xH=Gv.nonMaxSuppressionV5Impl;var kH={kernelName:hr,backendName:"webgl",kernelFunc:function(e){Wm.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.softNmsSigma,l=n.readSync(a.dataId),d=n.readSync(i.dataId),p=xH(l,d,o,s,u,c),f=p.selectedIndices,h=p.selectedScores;return[n.makeTensorInfo([f.length],"int32",new Int32Array(f)),n.makeTensorInfo([h.length],"float32",new Float32Array(h))]}},wH=function e(t,n,r,a){Object(O.a)(this,e),this.variableNames=["indices"],this.outputShape=[t,n],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float(".concat(a,"), float(").concat(r,"),\n                      float(index == coords.y)));\n      }\n    ")},OH={kernelName:vr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=r.dtype,o=r.depth,s=r.onValue,u=r.offValue,c=Ga.sizeFromShape(a.shape),l=new wH(c,o,s,u),d=eW({inputs:{x:a},backend:n,attrs:{shape:[c]}}),p=n.runWebGLProgram(l,[d],i);n.disposeIntermediateTensorInfo(d);var f=eW({inputs:{x:p},backend:n,attrs:{shape:[].concat(Object(S.a)(a.shape),[o])}});return n.disposeIntermediateTensorInfo(p),f}};function IH(e){var t=e.inputs,n=e.backend,r=t.x;if("complex64"===r.dtype){var a=pU({inputs:{input:r},backend:n}),i=IH({inputs:{x:a},backend:n}),o=jU({inputs:{input:r},backend:n}),s=IH({inputs:{x:o},backend:n}),u=MB({inputs:{real:i,imag:s},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}return UV({attrs:{shape:r.shape,dtype:r.dtype,value:"string"===r.dtype?"":0},backend:n})}var SH={kernelName:Ia,backendName:"webgl",kernelFunc:IH};var NH={kernelName:mr,backendName:"webgl",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=n.x;if("string"===a.dtype)throw new Error("onesLike is not supported under string dtype");if("complex64"===a.dtype){var i=pU({inputs:{input:a},backend:r}),o=e({inputs:{x:i},backend:r}),s=jU({inputs:{input:a},backend:r}),u=IH({inputs:{x:s},backend:r}),c=MB({inputs:{real:o,imag:u},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(u),c}return UV({attrs:{shape:a.shape,dtype:a.dtype,value:1},backend:r})}};var jH={kernelName:br,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.axis;if(1===t.length)return RV({inputs:{input:t[0]},backend:n,attrs:{dim:r}});var a=t[0].shape,i=t[0].dtype;t.forEach((function(e){Ga.assertShapesMatch(a,e.shape,"All tensors passed to stack must have matching shapes"),Ga.assert(i===e.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var o=[],s=EU({inputs:t.map((function(e){var t=RV({inputs:{input:e},backend:n,attrs:{dim:r}});return o.push(t),t})),backend:n,attrs:{axis:r}});return o.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),s}},TH=function e(t,n,r){Object(O.a)(this,e),this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));var a=t.length,i=gL(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,a);this.userCode=1!==a?"\n      ".concat(i," start = ").concat(i,"(").concat(o,");\n      ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(value);\n        } else {\n          ").concat(i," coords = outC - start;\n          setOutput(getX(").concat(u,"));\n        }\n      }\n    "):"\n        int start = ".concat(o,";\n        int end = ").concat(s,";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(value);\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      ")},CH=function e(t,n,r){Object(O.a)(this,e),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));for(var a=t.length,i=gL(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=tB("rc",a),c=tB("source",a),l="".concat(u[a-1]," < ").concat(this.outputShape[a-1]),d=1===a?"source":"vec2(".concat(c.slice(-2).join(),")"),p=["".concat(i," rc = outputLoc;"),"".concat(u[a-1]," += 1;\n       if(").concat(l,") {\n      "),1===a?"":"}\n       rc = outputLoc;\n       ".concat(u[a-2]," += 1;\n       if(").concat(u[a-2]," < ").concat(this.outputShape[a-2],") {"),1===a?"":"  ".concat(u[a-1]," += 1;\n         if(").concat(l,") {")],f=1===a?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",h="",m=0,v=1===a?2:4;m<v;m++)h+="\n        ".concat(p[m],"\n        if (").concat(f,") {\n          result[").concat(m,"] = float(value);\n        } else {\n          ").concat(i," source = rc - start;\n          result[").concat(m,"] = getChannel(getX(").concat(c.join(),"), ").concat(d,");\n        }\n      ");h+=1===a?"} ":"}}",this.userCode="\n      const ".concat(i," start = ").concat(i,"(").concat(o,");\n      const ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ").concat(h,"\n        setOutput(result);\n      }\n    ")},EH=function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.paddings,o=r.constantValue;if(0===Ga.sizeFromShape(a.shape))return UV({backend:n,attrs:{shape:i.map((function(e,t){return e[0]+a.shape[t]+e[1]})),value:o,dtype:a.dtype}});var s=st().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new CH(a.shape,i,o):new TH(a.shape,i,o),u=[[o]];return n.runWebGLProgram(s,[a],a.dtype,u)},_H={kernelName:gr,backendName:"webgl",kernelFunc:EH},AH=HB({opSnippet:"\n  if(a < 0.0 && floor(b) < b){\n    return NAN;\n  }\n  if (b == 0.0) {\n    return 1.0;\n  }\n  return (round(mod(b, 2.0)) != 1) ?\n      pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",packedOpSnippet:"\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  bvec4 isNaN1 = lessThan(a, vec4(0.0));\n  bvec4 isNaN2 = lessThan(floor(b), b);\n  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);\n  \n  result.r = isNaN.r ? NAN : result.r;\n  result.g = isNaN.g ? NAN : result.g;\n  result.b = isNaN.b ? NAN : result.b;\n  result.a = isNaN.a ? NAN : result.a;\n\n  return result;\n"}),RH={kernelName:xr,backendName:"webgl",kernelFunc:AH};var DH={kernelName:wr,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.axis,s=a.keepDims,u=i.shape.length,c=[],l=Ga.parseAxisParam(o,i.shape),d=l,p=Wm.getAxesPermutation(d,u),f=i;if(null!=p&&(f=lW({inputs:{x:i},backend:r,attrs:{perm:p}}),d=Wm.getInnerMostAxes(d.length,u),c.push(f)),Wm.assertAxesAreInnerMostDims("prod",d,u),r.shouldExecuteOnCPU([f])){var h=r.texData.get(f.dataId).values,m=EP(f.shape,f.dtype,h,d),v=m.outVals,b=m.outShape,g=m.outDtype;t=r.makeTensorInfo(b,g,v)}else{var x=Wm.computeOutAndReduceShapes(f.shape,d),k=Object(y.a)(x,2),w=k[0],O=k[1],I=Ga.sizeFromShape(O),S=eW({inputs:{x:f},backend:r,attrs:{shape:[-1,I]}}),N=aW(S,Pi(i.dtype),"prod",r);t=eW({inputs:{x:N},backend:r,attrs:{shape:w}}),c.push(S),c.push(N)}if(s){c.push(t);var j=Wm.expandShapeToKeepDim(t.shape,l);t=eW({inputs:{x:t},backend:r,attrs:{shape:j}})}return c.forEach((function(e){return r.disposeIntermediateTensorInfo(e)})),t}};var FH={kernelName:Or,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.paramsNestedSplits,i=t.paramsDenseValues,o=t.indices,s=r.outputRaggedRank,u=a.map((function(e){return n.readSync(e.dataId)})),c=a.map((function(e){return e.shape})),l=n.readSync(i.dataId),d=n.readSync(o.dataId),p=_P(u,c,l,i.shape,i.dtype,d,o.shape,s),f=Object(y.a)(p,3),h=f[0],m=f[1],v=f[2],b=h.map((function(e){return n.makeTensorInfo([e.length],"int32",e)})),g=n.makeTensorInfo(v,i.dtype,m);return b.concat([g])}};var MH={kernelName:Ir,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.starts,a=t.limits,i=t.deltas,o=n.readSync(r.dataId),s=n.readSync(a.dataId),u=n.readSync(i.dataId),c=AP(o,r.shape,r.dtype,s,a.shape,u,i.shape),l=Object(y.a)(c,2),d=l[0],p=l[1];return[n.makeTensorInfo([d.length],"int32",d),n.makeTensorInfo([p.length],r.dtype,p)]}};var zH={kernelName:Sr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.shape,i=t.values,o=t.defaultValue,s=t.rowPartitionTensors,u=r.rowPartitionTypes,c=n.readSync(a.dataId),l=n.readSync(i.dataId),d=n.readSync(o.dataId),p=s.map((function(e){return n.readSync(e.dataId)})),f=s.map((function(e){return e.shape})),h=RP(c,a.shape,l,i.shape,i.dtype,d,o.shape,p,f,u),m=Object(y.a)(h,2),v=m[0],b=m[1];return n.makeTensorInfo(v,i.dtype,b)}},LH=function(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,i=n.step,o=n.dtype,s=DP(r,a,i,o);return t.makeTensorInfo([s.length],o,s)},PH={kernelName:Nr,backendName:"webgl",kernelFunc:LH},BH=GB({opSnippet:"return 1.0 / x;"}),WH={kernelName:Tr,backendName:"webgl",kernelFunc:BH},UH=GB({opSnippet:"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : x;\n",packedOpSnippet:"\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"}),VH={kernelName:Cr,backendName:"webgl",kernelFunc:UH},GH=GB({opSnippet:"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",packedOpSnippet:"\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"}),HH={kernelName:Fr,backendName:"webgl",kernelFunc:GH},qH=function e(t,n,r,a,i){Object(O.a)(this,e),this.variableNames=["A"],this.outputShape=[];var o=Object(y.a)(t,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,n,r,l];var d,p=[a&&n>1?u-1:u,a&&r>1?c-1:c],f=[a&&n>1?n-1:n,a&&r>1?r-1:r];d=i?"(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ".concat(p[0]/f[0],",\n          ").concat(p[1]/f[1],");\n      const vec2 inputShapeRC = vec2(").concat(u,".0, ").concat(c,".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ").concat(d,";\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    ")},KH=function e(t,n,r,a,i){Object(O.a)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=Object(y.a)(t,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,n,r,l];var d,p=[a&&n>1?u-1:u,a&&r>1?c-1:c],f=[a&&n>1?n-1:n,a&&r>1?r-1:r];d=i?"(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ".concat(p[0]/f[0],",\n          ").concat(p[1]/f[1],",\n          ").concat(p[1]/f[1],");\n      const vec3 inputShapeRC = vec3(").concat(u,".0, ").concat(c,".0,\n                                     ").concat(c,".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ").concat(d,";\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ").concat(l-1,";\n        bool hasNextRow = coords.z < ").concat(r-1,";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    ")};var XH={kernelName:Rr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=r.alignCorners,o=r.halfPixelCenters,s=r.size,u=Object(y.a)(s,2),c=u[0],l=u[1],d=st().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new KH(a.shape,c,l,i,o):new qH(a.shape,c,l,i,o);return n.runWebGLProgram(d,[a],"float32")}},YH=function e(t,n,r){Object(O.a)(this,e),this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;var a=Object(y.a)(n,3),i=a[1],o=a[2],s=Object(y.a)(t,3),u=s[1],c=s[2],l=[r&&u>1?i-1:i,r&&c>1?o-1:o],d=[r&&u>1?u-1:u,r&&c>1?c-1:c],p=l[0]/d[0],f=l[1]/d[1],h=1/p,m=1/f,v=2*Math.ceil(h)+2,b=2*Math.ceil(m)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(".concat(p,");\n        const float widthScale = float(").concat(f,");\n\n        const float invHeightScale = float(").concat(h,");\n        const float invWidthScale = float(").concat(m,");\n\n        const int winHeight = int(").concat(v,");\n        const int winWidth = int(").concat(b,");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ").concat(u,") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ").concat(c,") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), ").concat(i-1,".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), ").concat(o-1,".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    ")};var ZH={kernelName:Dr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=t.dy,o=r.alignCorners,s=new YH(i.shape,a.shape,o);return n.runWebGLProgram(s,[i],i.dtype)}},JH=function e(t,n,r,a,i){Object(O.a)(this,e),this.variableNames=["A"],this.outputShape=[];var o=Object(y.a)(t,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,n,r,l];var d,p=[a&&n>1?u-1:u,a&&r>1?c-1:c],f=[a&&n>1?n-1:n,a&&r>1?r-1:r],h=a?"0.5":"0.0";d=i?"max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ".concat(p[0]/f[0],",\n          ").concat(p[1]/f[1],");\n      const vec2 inputShapeRC = vec2(").concat(u,".0, ").concat(c,".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ").concat(d,";\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ").concat(h,")));\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    ")},QH=function e(t,n,r,a,i){Object(O.a)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=Object(y.a)(t,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,n,r,l];var d,p=[a&&n>1?u-1:u,a&&r>1?c-1:c],f=[a&&n>1?n-1:n,a&&r>1?r-1:r],h=a?"0.5":"0.0";d=i?"max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ".concat(p[0]/f[0],",\n          ").concat(p[1]/f[1],",\n          ").concat(p[1]/f[1],");\n      const vec3 inputShapeRC = vec3(").concat(u,".0, ").concat(c,".0,\n                                     ").concat(c,".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ").concat(d,";\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec3 sourceNearestRC = ivec3(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ").concat(h,")));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ").concat(l-1,";\n        bool hasNextRow = coords.z < ").concat(r-1,";\n\n        vec4 newValue = vec4(\n          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),\n          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);\n\n        setOutput(newValue);\n      }\n    ")};var $H={kernelName:_r,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=r.alignCorners,o=r.halfPixelCenters,s=r.size,u=Object(y.a)(s,2),c=u[0],l=u[1],d=st().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new QH(a.shape,c,l,i,o):new JH(a.shape,c,l,i,o);return n.runWebGLProgram(d,[a],a.dtype)}},eq=function e(t,n,r){Object(O.a)(this,e),this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;var a=Object(y.a)(n,3),i=a[1],o=a[2],s=Object(y.a)(t,3),u=s[1],c=s[2],l=[r&&u>1?i-1:i,r&&c>1?o-1:o],d=[r&&u>1?u-1:u,r&&c>1?c-1:c],p=l[0]/d[0],f=l[1]/d[1],h=1/p,m=1/f,v=2*Math.ceil(h)+2,b=2*Math.ceil(m)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(".concat(p,");\n        const float widthScale = float(").concat(f,");\n\n        const float invHeightScale = float(").concat(h,");\n        const float invWidthScale = float(").concat(m,");\n\n        const int winHeight = int(").concat(v,");\n        const int winWidth = int(").concat(b,");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ").concat(u,") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ").concat(c,") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float(").concat(l[0],") *\n                (float(dyR) / float(").concat(d[0],"));\n\n            float sourceFracCol =\n                float(").concat(l[1],") *\n                  (float(dyC) / float(").concat(d[1],"));\n\n            int sourceNearestRow = int(min(\n                float(int(").concat(i,") - 1),\n                ").concat(r," ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int(").concat(o,") - 1),\n                ").concat(r," ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    ")};var tq={kernelName:Ar,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=t.dy,o=r.alignCorners,s=new eq(i.shape,a.shape,o);return n.runWebGLProgram(s,[i],i.dtype)}},nq=function e(t,n){Object(O.a)(this,e),this.variableNames=["x"];var r=t.length;if(r>4)throw new Error("WebGL backend: Reverse of rank-".concat(r," tensor is not yet supported"));if(this.outputShape=t,1!==r){var a=t.map((function(e,r){return function(e){return-1!==n.indexOf(e)&&1!==t[e]?"".concat(t[e]," - coords[").concat(e,"] - 1"):"coords[".concat(e,"]")}(r)})).join(","),i=gL(r);this.userCode="\n      void main() {\n        ".concat(i," coords = getOutputCoords();\n        setOutput(getX(").concat(a,"));\n      }\n    ")}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX(".concat(t[0]," - coord - 1));\n        }\n      ")},rq=function e(t,n){Object(O.a)(this,e),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var r=t.length;if(r>4)throw new Error("WebGL backend: Reverse of rank-".concat(r," tensor is not yet supported"));this.outputShape=t;var a,i=tB("rc",r),o="".concat(i[r-1]," + 1 < ").concat(this.outputShape[r-1]),s="".concat(i[r-2]," + 1 < ").concat(this.outputShape[r-2]),u=gL(r);function c(e){var r=t.map((function(r,a){return function(e,r){return-1!==n.indexOf(e)&&1!==t[e]?"".concat(t[e]," - ").concat(r[e]," - 1"):"".concat(r[e])}(a,e)})),a=r.join(","),i=r.slice(-2).join(",");return"getChannel(getX(".concat(a,"), vec2(").concat(i,"))")}this.userCode=1===r?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX(".concat(t[0]," - rc - 1),\n            ").concat(t[0]," - rc - 1);\n          if(").concat(o,"){\n              result.g = getChannel(getX(").concat(t[0]," - (rc  + 1) - 1),\n                ").concat(t[0]," - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      "):"\n        void main() {\n          ".concat(u," rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = ").concat((a=i.slice(),c(a)),";\n          if(").concat(o,"){\n            result.g = ").concat(function(e){return e[r-1]="("+e[r-1]+" + 1)",c(e)}(i.slice()),";\n          }\n          if(").concat(s,") {\n            result.b = ").concat(function(e){return e[r-2]="("+e[r-2]+" + 1)",c(e)}(i.slice()),";\n            if(").concat(o,") {\n              result.a = ").concat(function(e){return e[r-1]="("+e[r-1]+" + 1)",e[r-2]="("+e[r-2]+" + 1)",c(e)}(i.slice()),";\n            }\n          }\n          setOutput(result);\n        }\n    ")};var aq={kernelName:Mr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.dims,o=a.shape.length,s=Ga.parseAxisParam(i,a.shape);if(0===o)return DB({inputs:{x:a},backend:n});var u=st().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new rq(a.shape,s):new nq(a.shape,s);return n.runWebGLProgram(u,[a],a.dtype)}},iq=function e(t,n){Object(O.a)(this,e),this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];var r=t[1],a=t[2];this.outputShape=t;var i="";i="number"==typeof n?"float outputValue = ".concat(n.toFixed(2),";"):"\n        vec3 fill = vec3(".concat(n.join(","),");\n        float outputValue = fill[coords[3]];"),this.userCode="\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n          int y = coords[1];\n          float coordXFloat = (float(x) - params[0]) * params[3] -\n            (float(y) - params[1]) * params[2];\n          float coordYFloat = (float(x) - params[0]) * params[2] +\n            (float(y) - params[1]) * params[3];\n          int coordX = int(round(coordXFloat + params[0]));\n          int coordY = int(round(coordYFloat + params[1]));\n          ".concat(i,"\n          if(coordX >= 0 && coordX < ").concat(a," && coordY >= 0 && coordY < ").concat(r,") {\n            outputValue = getImage(coords[0], coordY, coordX, coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    ")},oq={kernelName:ja,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.image,i=n.radians,o=n.fillValue,s=n.center,u=r,c=new iq(a.shape,o),l=Wm.getImageCenter(s,a.shape[1],a.shape[2]),d=Object(y.a)(l,2),p=[[d[0],d[1],Math.sin(i),Math.cos(i)]];return u.runWebGLProgram(c,[a],a.dtype,p)}},sq=GB({opSnippet:"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n"}),uq={kernelName:zr,backendName:"webgl",kernelFunc:sq},cq=GB({opSnippet:"return inversesqrt(x);",cpuKernelImpl:FP}),lq={kernelName:Lr,backendName:"webgl",kernelFunc:cq},dq=function e(t,n,r,a,i,o){var s=arguments.length>7&&void 0!==arguments[7]&&arguments[7];Object(O.a)(this,e),this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;var u=gL(i.length),c=gL(o.length),l="";1===r?l="i":2===r&&(l="i, j");var d="getIndices(".concat(l,")"),p="";1===a?p="i":2===a&&(p="i, coords[1]");var f="getUpdates(".concat(p,")"),h="";s&&(h="coords[0], coords[1]");var m="getDefaultValue(".concat(h,")"),v=n>1?"strides[j]":"strides";this.userCode="\n        ".concat(u," strides = ").concat(u,"(").concat(i,");\n\n        void main() {\n          ").concat(c," coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < ").concat(t,"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < ").concat(n,"; j++) {\n              int index = round(").concat(d,");\n              flattenedIndex += index * ").concat(v,";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += ").concat(f,";\n              found = true;\n            }\n          }\n          setOutput(mix(").concat(m,", sum, float(found)));\n        }\n      ")},pq=function e(t,n,r,a,i,o){var s=arguments.length>7&&void 0!==arguments[7]&&arguments[7];Object(O.a)(this,e),this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=o;var u=gL(i.length),c=gL(o.length),l="";1===r?l="i":2===r&&(l="i, j");var d="getIndices(".concat(l,")"),p="";1===a?p="i":2===a&&(p="i, coords[1]");var f="getUpdates(".concat(p,")"),h="";s&&(h="coords[0], coords[1]");var m="getDefaultValue(".concat(h,")"),v=n>1?"strides[j]":"strides",b=n>1?"strides[j + 1]":"strides";this.userCode="\n        ".concat(u," strides = ").concat(u,"(").concat(i,");\n\n        void main() {\n          ").concat(c," coords = getOutputCoords();\n          vec4 sum = vec4(0.);\n          vec4 found = vec4(0.);\n          for (int i = 0; i < ").concat(t,"; i+=2) {\n            ivec2 flattenedIndex = ivec2(0);\n            for (int j = 0; j < ").concat(n,"; j+=2) {\n              ivec4 index = round(").concat(d,");\n              flattenedIndex += index.xz * ").concat(v,";\n              if (j + 1 < ").concat(n,") {\n                flattenedIndex += index.yw * ").concat(b,";\n              }\n            }\n            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||\n                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {\n              vec4 updVals = ").concat(f,";\n              if (flattenedIndex[0] == coords[0]) {\n                sum.xy += updVals.xy;\n                found.xy = vec2(1.);\n              } else if (flattenedIndex[0] == coords[0] + 1) {\n                sum.zw += updVals.xy;\n                found.zw = vec2(1.);\n              }\n              if (flattenedIndex[1] == coords[0]) {\n                sum.xy += updVals.zw;\n                found.xy = vec2(1.);\n              } else if (flattenedIndex[1] == coords[0] + 1) {\n                sum.zw += updVals.zw;\n                found.zw = vec2(1.);\n              }\n            }\n          }\n          setOutput(mix(").concat(m,", sum, found));\n        }\n      ")};var fq={kernelName:Pr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=t.updates,o=r.shape,s=Wm.calculateShapes(i,a,o),u=s.sliceRank,c=s.numUpdates,l=s.sliceSize,d=s.strides,p=s.outputSize,f=[p/l,l];if(0===p)return n.makeTensorInfo(o,a.dtype);var h,m=eW({inputs:{x:a},backend:n,attrs:{shape:[c,u]}}),v=eW({inputs:{x:i},backend:n,attrs:{shape:[c,l]}}),b=n.makeTensorInfo([],"float32",new Float32Array([0]));h=st().getBool("WEBGL_PACK")?new pq(c,u,m.shape.length,v.shape.length,d,f):new dq(c,u,m.shape.length,v.shape.length,d,f);var g=n.runWebGLProgram(h,[v,m,b],v.dtype),y=eW({inputs:{x:g},backend:n,attrs:{shape:o}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(b),y}},hq=function e(t,n,r,a){Object(O.a)(this,e),this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[t,r];var i="for (int i = 0; i < ".concat(Math.ceil(Math.log2(n+1)),"; ++i) { if (left >= right) break;"),o=2===st().getNumber("WEBGL_VERSION")?"while (left < right) {":i,s="left"===a?"<":"<=";this.userCode="\n       int findBound(int batch, float value) {\n         int left = 0;\n         int right = numInputs;\n         int mid;\n         ".concat(o,"\n           mid = (left + right) / 2;\n           if (getSortedSequence(batch, mid) ").concat(s," value) {\n             left = mid + 1;\n           } else {\n             right = mid;\n           }\n         }\n         return right;\n       }\n\n       void main() {\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int valueIndex = coords[1];\n\n         float value = getValues(batch, valueIndex);\n\n         setOutput(float(findBound(batch, value)));\n       }\n     ")};var mq={kernelName:Wr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.sortedSequence,i=t.values,o=r.side,s=new hq(a.shape[0],a.shape[1],i.shape[1],o),u=[[a.shape[1]]];return n.runWebGLProgram(s,[a,i],"int32",u)}},vq=function e(t,n,r){var a,i;if(Object(O.a)(this,e),this.variableNames=["c","a","b"],this.outputShape=n,r>4)throw Error("Where for rank ".concat(r," is not yet supported"));if(1===r)i="resRC",a="resRC";else{for(var o=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[],u=[],c=0;c<n.length;c++)u.push("".concat(o[c])),c<t&&s.push("".concat(o[c]));a=s.join(),i=u.join()}var l=gL(r);this.userCode="\n      void main() {\n        ".concat(l," resRC = getOutputCoords();\n        float cVal = getC(").concat(a,");\n        if (cVal >= 1.0) {\n          setOutput(getA(").concat(i,"));\n        } else {\n          setOutput(getB(").concat(i,"));\n        }\n      }\n    ")};var bq={kernelName:Ur,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.condition,a=t.t,i=t.e,o=new vq(r.shape.length,a.shape,a.shape.length);return n.runWebGLProgram(o,[r,a,i],Li(a.dtype,i.dtype))}},gq=GB({opSnippet:"\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = ".concat(Wm.SELU_SCALEALPHA,";\n  float scale = ").concat(Wm.SELU_SCALE,";\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n")}),yq={kernelName:Vr,backendName:"webgl",kernelFunc:gq},xq=GB({opSnippet:"if (isnan(x)) return x;\n  return 1.0 / (1.0 + exp(-1.0 * x));\n",packedOpSnippet:"\n  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",cpuKernelImpl:zP}),kq={kernelName:Xr,backendName:"webgl",kernelFunc:xq},wq=GB({opSnippet:"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n"}),Oq={kernelName:Kr,backendName:"webgl",kernelFunc:wq},Iq=GB({opSnippet:"if (isnan(x)) return x;\n  return sin(x);\n",packedOpSnippet:"\n  vec4 result = sin(x);\n  bvec4 isNaN = isnan(x);\n  ".concat(AB,"\n  return result;\n")}),Sq={kernelName:Hr,backendName:"webgl",kernelFunc:Iq},Nq=GB({opSnippet:"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n"}),jq={kernelName:qr,backendName:"webgl",kernelFunc:Nq},Tq=GB({opSnippet:"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n"}),Cq={kernelName:Yr,backendName:"webgl",kernelFunc:Tq},Eq={kernelName:Qr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.paddings;Ga.assert(a.shape.length<=4,(function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"}));var s=i.reduce((function(e,t){return e*t})),u=[[0,0]];u.push.apply(u,Object(S.a)(o));for(var c=1+i.length;c<a.shape.length;++c)u.push([0,0]);var l=[],d=EH({inputs:{x:a},backend:n,attrs:{paddings:u,constantValue:0}}),p=Wm.getReshaped(d.shape,i,s,!1),f=Wm.getPermuted(p.length,i.length,!1),h=Wm.getReshapedPermuted(d.shape,i,s,!1),m=eW({inputs:{x:d},backend:n,attrs:{shape:p}}),v=lW({inputs:{x:m},backend:n,attrs:{perm:f}}),b=eW({inputs:{x:v},backend:n,attrs:{shape:h}});return l.push(d),l.push(m),l.push(v),l.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),b}};var _q={kernelName:ta,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.indices,a=t.values,i=t.denseShape,o=t.defaultValue;if(1!==i.shape.length)throw new Error("Dense shape must be a vector, saw:\n         ".concat(i.shape));if(2!==r.shape.length)throw new Error("Indices must be a matrix, saw:\n         ".concat(r.shape));if(1!==a.shape.length)throw new Error("Values must be a vector, saw:\n         ".concat(a.shape));if(0!==o.shape.length)throw new Error("Default value must be a scalar, saw:\n        ".concat(o.shape));var s=n.readSync(r.dataId),u=n.readSync(a.dataId),c=n.readSync(i.dataId),l=n.readSync(o.dataId)[0],d=BP(s,r.shape,r.dtype,u,a.dtype,c,l),p=Object(y.a)(d,5),f=p[0],h=p[1],m=p[2],v=p[3],b=p[4];return[n.makeTensorInfo(h,r.dtype,f),n.makeTensorInfo([h[0]],a.dtype,m),n.makeTensorInfo([v.length],"bool",new Uint8Array(v.map((function(e){return Number(e)})))),n.makeTensorInfo([b.length],r.dtype,new Int32Array(b))]}};var Aq={kernelName:na,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.inputIndices,a=t.inputShape,i=t.newShape;if(2!==r.shape.length)throw new Error("Input indices should be a matrix but received shape ".concat(r.shape));if(1!==a.shape.length)throw new Error("Input shape should be a vector but received shape ".concat(a.shape));if(1!==i.shape.length)throw new Error("Target shape should be a vector but received shape ".concat(i.shape));var o=Array.from(n.readSync(a.dataId)),s=n.readSync(r.dataId),u=Array.from(n.readSync(i.dataId)),c=WP(s,r.shape,r.dtype,o,u),l=Object(y.a)(c,3),d=l[0],p=l[1],f=l[2];return[n.makeTensorInfo(p,r.dtype,d),n.makeTensorInfo([f.length],i.dtype,new Int32Array(f))]}};var Rq={kernelName:ra,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.data,a=t.indices,i=t.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n              ".concat(a.shape));if(1!==i.shape.length)throw new Error("Segment ids should be a vector but received shape\n              ".concat(i.shape));var o=n.readSync(r.dataId),s=n.readSync(a.dataId),u=n.readSync(i.dataId),c=UP(o,r.shape,r.dtype,s,u,!0),l=Object(y.a)(c,2),d=l[0],p=l[1];return n.makeTensorInfo(p,r.dtype,d)}};var Dq={kernelName:aa,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.data,a=t.indices,i=t.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n             ".concat(a.shape));if(1!==i.shape.length)throw new Error("Segment ids should be a vector but received shape\n             ".concat(i.shape));var o=n.readSync(r.dataId),s=n.readSync(a.dataId),u=n.readSync(i.dataId),c=UP(o,r.shape,r.dtype,s,u),l=Object(y.a)(c,2),d=l[0],p=l[1];return n.makeTensorInfo(p,r.dtype,d)}};var Fq={kernelName:ia,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.sparseIndices,i=t.sparseValues,o=t.defaultValue,s=r.outputShape,u=Wm.calculateShapes(i,a,s),c=u.sliceRank,l=u.numUpdates,d=u.sliceSize,p=u.strides,f=u.outputSize;if("string"===i.dtype){var h=n.bufferSync(a),m=n.bufferSync(i),v=Ga.decodeString(n.readSync(o.dataId)[0]),b=MP(h,m,s,f,d,l,c,p,v,!1);return n.makeTensorInfo(s,b.dtype,b.values)}var g=new dq(l,c,a.shape.length,i.shape.length,p,[f,1],!1),y=n.runWebGLProgram(g,[i,a,o],i.dtype),x=eW({inputs:{x:y},backend:n,attrs:{shape:s}});return n.disposeIntermediateTensorInfo(y),x}};var Mq={kernelName:$r,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.numOrSizeSplits,o=r.axis,s=Ga.parseAxisParam(o,a.shape)[0],u=Wm.prepareSplitSize(a,i,s),c=a.shape.length,l=new Array(c).fill(0),d=a.shape.slice();return u.map((function(e){var t=Object(S.a)(d);t[s]=e;var r=aU({inputs:{x:a},backend:n,attrs:{begin:l,size:t}});return l[s]+=e,r}))}},zq="return sqrt(x);",Lq=GB({opSnippet:zq,packedOpSnippet:zq,cpuKernelImpl:VP}),Pq={kernelName:Zr,backendName:"webgl",kernelFunc:Lq},Bq=GB({opSnippet:"return x * x;"}),Wq={kernelName:sa,backendName:"webgl",kernelFunc:Bq},Uq="return (a - b) * (a - b);",Vq=HB({opSnippet:Uq,packedOpSnippet:Uq}),Gq={kernelName:oa,backendName:"webgl",kernelFunc:Vq};var Hq={kernelName:ua,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;if("string"!==a.dtype)throw new Error("Input must be of datatype string");var i=n.readSync(a.dataId),o=Wm.fromUint8ToStringArray(i),s=GP(o,"string",r);return n.makeTensorInfo(a.shape,"string",s)}};var qq={kernelName:Sa,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=cB+"\n    return x > 0.0 ? 1.0 : float(".concat(n.alpha,");\n  "),o=new uB(a.shape,i);return r.runWebGLProgram(o,[a],a.dtype)}},Kq=function e(t,n,r){Object(O.a)(this,e),this.variableNames=["x"],this.outputShape=r;var a=r.length,i=gL(r.length),o=gL(r.length),s="";if(1===a)s="coords * strides + begin";else{var u=0;s=r.map((function(e,t){return u++,1===r.length?"coords * strides[".concat(t,"] + begin[").concat(t,"]"):"coords[".concat(u-1,"] * strides[").concat(t,"] + begin[").concat(t,"]")})).join(",")}this.userCode="\n      ".concat(i," begin = ").concat(i,"(").concat(t,");\n      ").concat(i," strides = ").concat(i,"(").concat(n,");\n\n      void main() {\n        ").concat(o," coords = getOutputCoords();\n        setOutput(getX(").concat(s,"));\n      }\n    ")};var Xq={kernelName:ca,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.begin,s=a.end,u=a.strides,c=a.beginMask,l=a.endMask,d=a.ellipsisMask,p=a.newAxisMask,f=a.shrinkAxisMask,h=bm.sliceInfo(i.shape,o,s,u,c,l,d,p,f),m=h.finalShapeSparse,v=h.finalShape,b=h.isIdentity,g=h.sliceDim0,y=h.isSimpleSlice,x=h.begin,k=h.end,w=h.strides;if(b)t=eW({inputs:{x:i},backend:r,attrs:{shape:v}});else if(g||y){Ga.assert(i.shape.length>=1,(function(){return"Input must have rank at least 1, got: ".concat(i.shape.length)}));var O=bm.computeOutShape(x,k,w),I=aU({inputs:{x:i},backend:r,attrs:{begin:x,size:O}});t=eW({inputs:{x:I},backend:r,attrs:{shape:v}}),r.disposeIntermediateTensorInfo(I)}else if(r.shouldExecuteOnCPU([i])){var S=r.readSync(i.dataId),N=Ss(i.shape,i.dtype,S),j=HP(m,N,w,x);t=r.makeTensorInfo(v,i.dtype,j.values)}else{var T=new Kq(x,w,m);t=r.runWebGLProgram(T,[i],i.dtype)}var C=eW({inputs:{x:t},backend:r,attrs:{shape:v}});return r.disposeIntermediateTensorInfo(t),C}};var Yq={kernelName:la,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=r.separator,i=r.nGramWidths,o=r.leftPad,s=r.rightPad,u=r.padWidth,c=r.preserveShortSequences,l=t.data,d=t.dataSplits,p=n.readSync(l.dataId),f=n.readSync(d.dataId),h=qP(p,f,a,i,o,s,u,c),m=Object(y.a)(h,2),v=m[0],b=m[1];return[n.makeTensorInfo([v.length],"string",v),n.makeTensorInfo(d.shape,"int32",b)]}};var Zq={kernelName:da,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.skipEmpty,a=t.input,i=t.delimiter;if("string"!==a.dtype)throw new Error("Input must be of datatype string");if(1!==a.shape.length)throw new Error("Input must be a vector, got shape: ".concat(a.shape));if(0!==i.shape.length)throw new Error("Delimiter must be a scalar, got shape: ".concat(i.shape));var o=n.readSync(a.dataId),s=n.readSync(i.dataId)[0],u=KP(o,s,r),c=Object(y.a)(u,3),l=c[0],d=c[1],p=c[2],f=d.length;return[n.makeTensorInfo([f,2],"int32",l),n.makeTensorInfo([f],"string",d),n.makeTensorInfo([2],"int32",new Int32Array(p))]}};var Jq={kernelName:pa,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.numBuckets,a=t.input;if("string"!==a.dtype)throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");var i=n.readSync(a.dataId),o=XP(i,r);return n.makeTensorInfo(a.shape,"int32",o)}},Qq=GB({opSnippet:"return tan(x);"}),$q={kernelName:ha,backendName:"webgl",kernelFunc:Qq},eK=GB({opSnippet:"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n"});var tK=function e(t,n){Object(O.a)(this,e),this.variableNames=["A"];for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[a]*n[a];this.outputShape=r,this.rank=r.length;var i=gL(this.rank),o=function(e){var t=e.length;if(t>5)throw Error("Tile for rank ".concat(t," is not yet supported"));if(1===t)return"imod(resRC, ".concat(e[0],")");for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],a=0;a<e.length;a++)r.push("imod(".concat(n[a],", ").concat(e[a],")"));return r.join()}(t);this.userCode="\n      void main() {\n        ".concat(i," resRC = getOutputCoords();\n        setOutput(getA(").concat(o,"));\n      }\n    ")};function nK(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.reps;if("string"===a.dtype||a.shape.length>5){var o=n.readSync(a.dataId),s="string"===a.dtype?o.map((function(e){return Ga.decodeString(e)})):o,u=Ss(a.shape,a.dtype,s),c=ZP(u,i);return n.makeTensorInfo(c.shape,c.dtype,c.values)}var l=new tK(a.shape,i);return n.runWebGLProgram(l,[a],a.dtype)}var rK=function e(t){Object(O.a)(this,e),this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=t,this.userCode="\n       void main() {\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int elemIdx = coords[1];\n\n         // We compare elements pair-wise within a group of size 2 * inc.\n         // The comparing rule for each group alternates between ascending\n         // and descending. Within each group, we compare each pair at\n         // positions i and i+inc. To decide whether an element at position i\n         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than\n         // inc, it is in the first half of the group, we denote it as x0,\n         // otherwise we denote it as x1.\n         // For example, as shown in the Bitonic top K paper referenced above,\n         // Figure5(a) shows that element[1] is in the\n         // second half of the group when group size is 2, but it is in the\n         // first half of the group when group size is 4.\n\n         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;\n         int i = isFirstInPair ? elemIdx : elemIdx - inc;\n\n         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));\n         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));\n         float x0 = i0 < n ? getX(batch, i0) : negativeInf;\n         float x1 = i1 < n ? getX(batch, i1) : negativeInf;\n\n         // Denotes which direction indices are in (ascending or descending).\n         bool reverse = imod(elemIdx, 2 * dir) >= dir;\n         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);\n         if (reverse == isGreater) { // Elements in opposite order of direction\n           int iTemp = i0;\n           i0 = i1;\n           i1 = iTemp;\n         }\n         if (isFirstInPair) {\n            setOutput(float(i0));\n         } else {\n            setOutput(float(i1));\n         }\n       }\n     "},aK=function e(t){Object(O.a)(this,e),this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=t,this.userCode="\n    void main() {\n         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int elemIdx = coords[1];\n\n         // The output size is half of the previous size.\n         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),\n         // we only need to output the indices at positions |, the indices at\n         // positions _ can be thrown away, see Figure5(b) After Phase 2\n         // (Merge phase) in the Bitonic Top K paper referenced above.\n         // For example, the paper shows we only need to output the orange bars.\n         // The output sequence should look like this | | | | | | | |.\n         // Because the sequence is halved, to map the output index back\n         // to the previous sequence to find the corresponding value,\n         // we need to double the index. When we double the index,\n         // we basically interpolate a position, so 2i looks like\n         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position\n         // of each 2k positions by - elemIdx % k. E.g. for output at\n         // index 4,5,6,7, we want to get the corresponding element at\n         // original index 8,9,10,11, for output at index 8,9,10,11,\n         // we want to get the corresponding element at original index\n         // 16,17,18,19, so on and so forth.\n\n         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));\n         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));\n         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));\n\n         float x0 = getX(batch, i0);\n         float x1 = i1 < n ? getX(batch, i1) : x0;\n\n         setOutput(x0 >= x1 ? float(i0) : float(i1));\n       }\n     "};function iK(e,t){null!==t&&e.disposeIntermediateTensorInfo(t)}function oK(e){for(var t=1;t<e;)t*=2;return t}var sK=function e(t,n,r,a,i,o){Object(O.a)(this,e),this.variableNames=["Image","Transforms"],this.outputShape=o;var s,u="nearest"===r?1:2;switch(a){case"constant":s=1;break;case"reflect":s=2;break;case"wrap":s=3;break;case"nearest":s=4;break;default:s=1}this.userCode="\n            float mapCoord(float outCoord, float len) {\n              float inCoord = outCoord;\n              if(".concat(s," == 2) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    if (inCoord < sz2) {\n                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +\n                      inCoord;\n                    }\n                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    inCoord -= sz2 * float(int(float(inCoord / sz2)));\n                    if (inCoord >= len) {\n                      inCoord = sz2 - inCoord - 1.0;\n                    }\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (").concat(s," == 3) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord -= len * float(int(float(inCoord / sz)));\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (").concat(s," == 4) {\n                return clamp(outCoord, 0.0, len - 1.0);\n              } else {\n                return outCoord;\n              }\n            }\n\n            float readWithFillValue(int batch, int coordY, int coordX,\n              int channel) {\n              float outputValue;\n              if (0 <= coordY && coordY < ").concat(t," && 0 <= coordX && coordX < ").concat(n,") {\n                  outputValue = getImage(batch, coordY, coordX, channel);\n              } else {\n                outputValue = float(").concat(i,");\n              }\n              return outputValue;\n            }\n\n            void main() {\n              ivec4 coords = getOutputCoords();\n              float outputValue;\n              int batch = coords[0];\n              int x = coords[2];\n              int y = coords[1];\n              int channel = coords[3];\n              float xf = float(x);\n              float yf = float(y);\n              float a1 = getTransforms(batch, 0);\n              float a2 = getTransforms(batch, 1);\n              float a3 = getTransforms(batch, 2);\n              float b1 = getTransforms(batch, 3);\n              float b2 = getTransforms(batch, 4);\n              float b3 = getTransforms(batch, 5);\n              float c1 = getTransforms(batch, 6);\n              float c2 = getTransforms(batch, 7);\n              float projection = c1 * xf + c2 * yf + 1.0;\n              if (projection == 0.0) {\n                outputValue = float(").concat(i,");\n              } else {\n                float inX = (a1 * xf + a2 * yf + a3) / projection;\n                float inY = (b1 * xf + b2 * yf + b3) / projection;\n                float mapX = mapCoord(inX, float(").concat(n,"));\n                float mapY = mapCoord(inY, float(").concat(t,"));\n\n                if (").concat(u," == 1) {\n                  int coordY = int(round(mapY));\n                  int coordX = int(round(mapX));\n                  outputValue = readWithFillValue(batch, coordY, coordX,\n                    channel);\n                } else {\n                  float yFloor = floor(mapY);\n                  float xFloor = floor(mapX);\n                  float yCeil = yFloor + 1.0;\n                  float xCeil = xFloor + 1.0;\n                  float valueYFloor = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);\n                  float valueYCeil = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);\n                  outputValue = (yCeil - mapY) * valueYFloor +\n                  (mapY - yFloor) * valueYCeil;\n                }\n              }\n              setOutput(outputValue);\n            }\n        ")};var uK=function e(t,n){Object(O.a)(this,e),this.variableNames=["x","segmentIds"];var r=t.windowSize,a=t.batchSize,i=t.inSize,o=t.numSegments,s=o*Math.ceil(i/r);this.outputShape=[a,s];var u=4*Math.floor(r/4),c=r%4,l="\n        sumValue += dot(values, segFilter);\n    ",d="";i%r>0&&(d="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return initializationValue;\n        }\n      "));var p="";i%r>0&&(p="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return -1.0;\n        }\n      ")),this.userCode="\n      const float initializationValue = ".concat("0.0",";\n\n      float getValue(int batch, int inIdx) {\n        ").concat(d,"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        ").concat(p,"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          ").concat(o,")) * float(").concat(r,"));\n        int currentSeg = int(mod(float(outIdx), float(").concat(o,")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ").concat(u,"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          ").concat(l,"\n        }\n\n        int inIdx = inOffset + ").concat(u,";\n        if (").concat(1===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          ").concat(l,"\n        } else if (").concat(2===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          ").concat(l,"\n        } else if (").concat(3===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          ").concat(l,"\n        }\n        setOutput(").concat("sumValue",");\n      }\n    ")};for(var cK,lK,dK,pK=0,fK=[fW,mW,bW,yW,wW,SW,NW,jW,_W,AW,DW,MW,LW,BW,UW,HW,qW,YW,ZW,JW,eU,oU,sU,uU,cU,hU,bU,xU,zB,OU,_U,PU,GU,qU,KU,XU,ZU,QU,eV,nV,sV,uV,cV,dV,hV,bV,gV,xV,wV,OV,SV,NV,TV,EV,AV,DV,zV,BV,GV,qV,YV,JV,eG,nG,rG,iG,uG,lG,pG,FB,fG,TU,mG,bG,yG,BB,kG,OG,IG,NG,TG,EG,AG,DG,zG,PG,WG,VG,GG,HG,XG,YG,ZG,JG,QG,eH,rH,iH,hH,$B,mH,bH,yH,kH,dU,OH,NH,jH,_H,RH,VB,DH,FH,MH,zH,PH,fU,uH,WH,VH,HH,tW,XH,ZH,$H,tq,aq,oq,uq,lq,fq,mq,bq,yq,kq,Oq,Sq,jq,iU,fH,Cq,Eq,_q,Aq,Rq,Dq,Fq,Mq,Pq,Wq,Gq,Hq,qq,Xq,Yq,Zq,Jq,dH,cW,$q,{kernelName:ma,backendName:"webgl",kernelFunc:eK},{kernelName:Br,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.tensor,i=t.indices,o=t.updates;Object(c.a)(r);var s=Wm.calculateShapes(o,i,a.shape),u=s.sliceRank,l=s.numUpdates,d=s.sliceSize,p=s.strides,f=s.outputSize,h=[f/d,d];if(0===f)return n.makeTensorInfo(a.shape,i.dtype);var m=eW({inputs:{x:i},backend:n,attrs:{shape:[l,u]}}),v=eW({inputs:{x:o},backend:n,attrs:{shape:[l,d]}}),b=eW({inputs:{x:a},backend:n,attrs:{shape:h}}),g=new dq(l,u,m.shape.length,v.shape.length,p,h,!1,!0),y=n.runWebGLProgram(g,[v,m,b],b.dtype),x=eW({inputs:{x:y},backend:n,attrs:{shape:a.shape}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(b),n.disposeIntermediateTensorInfo(y),x}},{kernelName:va,backendName:"webgl",kernelFunc:nK},{kernelName:ba,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.k,o=r.sorted,s=st().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),u=st().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),c=a.shape,l=c[c.length-1];if(n.shouldExecuteOnCPU([a])||l<s||i>u){var d=n.readSync(a.dataId),p=JP(d,c,a.dtype,i,o),f=Object(y.a)(p,2),h=f[0],m=f[1];return[n.makeTensorInfo(h.shape,h.dtype,h.values),n.makeTensorInfo(m.shape,m.dtype,m.values)]}if(0===i)return c[c.length-1]=0,[n.makeTensorInfo(c,a.dtype,[]),n.makeTensorInfo(c,"int32",[])];if(1===l)return[a,UV({attrs:{shape:c,dtype:"int32",value:0},backend:n})];var v=n.texData.get(a.dataId),b=null!==v&&v.isPacked,g=b?n.unpackTensor(a):a,x=Ga.sizeFromShape(c)/l,k=eW({inputs:{x:g},attrs:{shape:[x,l]},backend:n});b&&iK(n,g);for(var w=oK(i),O=oK(l),I=null,S=function(){return null===I?[k,k]:[k,I]},N=function(e,t,r){var a=S(),i=new rK(r),o=[[l],[null===I?1:0],[Number.NEGATIVE_INFINITY],[e],[t]],s=I;I=n.runWebGLProgram(i,a,"int32",o),iK(n,s)},j=1;j<w;j*=2)for(var T=2*j,C=j;C>=1;C/=2)N(T,C,[x,O]);for(var E=O;E>w;E/=2){var _=S(),A=new aK([x,E/2]),R=[[l],[null===I?1:0],[w]],D=I;I=n.runWebGLProgram(A,_,"int32",R),iK(n,D);for(var F=w/2,M=2*F,z=F;z>=1;z/=2)N(M,z,I.shape)}var L=I;I=aU({inputs:{x:I},backend:n,attrs:{begin:0,size:[x,i]}}),iK(n,L);var P=sG({inputs:{x:k,indices:I},backend:n,attrs:{axis:1,batchDims:1}});iK(n,k);var B=c.slice(0,-1);B.push(i),L=I,I=eW({inputs:{x:I},attrs:{shape:B},backend:n}),iK(n,L);var W=P;return P=eW({inputs:{x:P},attrs:{shape:B},backend:n}),iK(n,W),[P,I]}},{kernelName:ga,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.image,i=t.transforms,o=r.interpolation,s=r.fillMode,u=r.fillValue,c=r.outputShape,l=Object(y.a)(a.shape,4),d=l[0],p=l[1],f=l[2],h=l[3],m=null!=c?c:[p,f],v=Object(y.a)(m,2),b=v[0],g=v[1],x=new sK(p,f,o,s,u,[d,b,g,h]);return n.runWebGLProgram(x,[a,i],"float32")}},dW,{kernelName:xa,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=n.axis,i=t.x;Hz(i,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");var o=r.readSync(i.dataId),s=$P(o,a,i.shape,i.dtype),u=s.outputValues,c=s.outputShape,l=s.indices;return[r.makeTensorInfo(c,i.dtype,u),r.makeTensorInfo([l.length],"int32",l)]}},{kernelName:ka,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.value,i=r.axis;i<0&&(i+=a.shape.length);for(var o=a,s=o.shape.length,u=a.shape[i],c=new Array(s-1),l=0,d=0;d<s;d++)d!==i&&(c[l++]=o.shape[d]);var p=[],f=new Array(s).fill(0),h=o.shape.slice();h[i]=1;for(var m=new Array(u),v=0;v<m.length;v++){f[i]=v;var b=aU({inputs:{x:o},backend:n,attrs:{begin:f,size:h}}),g=eW({inputs:{x:b},backend:n,attrs:{shape:c}});m[v]=g,p.push(b)}return p.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),m}},{kernelName:wa,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.segmentIds,o=r.numSegments,s=a.shape.length,u=[],c=0,l=Wm.getAxesPermutation([c],s),d=a;null!=l&&(d=lW({inputs:{x:a},backend:n,attrs:{perm:l}}),u.push(d),c=Wm.getInnerMostAxes(1,s)[0]);var p=Wm.segment_util.computeOutShape(d.shape,c,o),f=Ga.sizeFromShape([d.shape[c]]),h=eW({inputs:{x:d},backend:n,attrs:{shape:[-1,f]}});u.push(h);var m=eW({inputs:{x:function e(t,r,a,i,o){var s=t.shape[0],c=t.shape[1],l=Wm.segment_util.segOpComputeOptimalWindowSize(c,o),d=new uK({windowSize:l,inSize:c,batchSize:s,numSegments:o},r),p=n.compileAndRun(d,[t,a],i);if(u.push(p),p.shape[1]===o)return p;var f=LH({backend:n,attrs:{start:0,stop:o,step:1,dtype:"float32"}}),h=nK({inputs:{x:f},backend:n,attrs:{reps:[c/l]}});return u.push(f),u.push(h),e(p,r,h,i,o)}(h,"unsortedSegmentSum",i,Pi(a.dtype),o)},backend:n,attrs:{shape:p}}),v=m;if(null!=l){u.push(m);var b=Wm.getUndoAxesPermutation(l);v=lW({inputs:{x:v},backend:n,attrs:{perm:b}})}return u.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),v}},SH];pK<fK.length;pK++){La(fK[pK])}!function(e){e[e.float32=0]="float32",e[e.int32=1]="int32",e[e.bool=2]="bool",e[e.string=3]="string",e[e.complex64=4]="complex64"}(cK||(cK={})),function(e){e[e.linear=0]="linear",e[e.relu=1]="relu",e[e.relu6=2]="relu6",e[e.prelu=3]="prelu",e[e.leakyrelu=4]="leakyrelu",e[e.sigmoid=5]="sigmoid",e[e.elu=6]="elu"}(lK||(lK={}));var hK={kernelName:Ta,backendName:"wasm",setupFunc:function(e){dK=e.wasm.cwrap(Ta,null,["number","array","number","number","array","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.a,i=t.b,o=t.bias,s=t.preluActivationWeights;if("float32"!==a.dtype||"float32"!==i.dtype)throw new Error("_FusedMatMul for non non-float32 tensors not yet supported.");var u=r.transposeA,c=r.transposeB,l=r.activation,d=r.leakyreluAlpha,p=n.dataIdMap.get(a.dataId).id,f=n.dataIdMap.get(i.dataId).id,h=0;if(null!=o){var m=n.dataIdMap.get(o.dataId);if(1!==m.shape.length)throw new Error("_FusedMatMul only supports rank-1 bias but got rank ".concat(m.shape.length,"."));h=m.id}var v=null==s?0:n.dataIdMap.get(s.dataId).id,b=lK[l];if(null==b)throw new Error("".concat(l," activation not yet supported for FusedConv2D in the wasm backend."));var g=u?a.shape[2]:a.shape[1],y=c?i.shape[1]:i.shape[2],x=gc.assertAndGetBroadcastShape(a.shape.slice(0,-2),i.shape.slice(0,-2)),k=n.makeOutput([].concat(Object(S.a)(x),[g,y]),a.dtype),w=n.dataIdMap.get(k.dataId).id,O=new Uint8Array(new Int32Array(a.shape).buffer),I=new Uint8Array(new Int32Array(i.shape).buffer);return dK(p,O,a.shape.length,f,I,i.shape.length,u,c,b,h,v,d||0,w),k}};function mK(e,t){var n;return{kernelName:e,backendName:"wasm",setupFunc:function(t){n=t.wasm.cwrap(e,null,["number","number","number"])},kernelFunc:function(e){var r=e.backend,a=e.inputs.x,i=r.dataIdMap.get(a.dataId).id,o=r.makeOutput(a.shape,t||a.dtype),s=r.dataIdMap.get(o.dataId).id;return 0===Ga.sizeFromShape(o.shape)||n(i,cK[a.dtype],s),o}}}var vK=mK(pt),bK=mK(ft),gK=mK(ht);function yK(e,t,n){var r;return{kernelName:e,backendName:"wasm",setupFunc:function(t){r=t.wasm.cwrap(e,null,["number","array","number","number","array","number","number","number"])},kernelFunc:function(e){var t=e.backend,a=e.inputs,i=a.a,o=a.b,s=t.dataIdMap.get(i.dataId).id,u=t.dataIdMap.get(o.dataId).id,c=null!=n?n:i.dtype,l=Wm.assertAndGetBroadcastShape(i.shape,o.shape),d=t.makeOutput(l,c);if(0===Ga.sizeFromShape(l))return d;var p=new Uint8Array(new Int32Array(i.shape).buffer),f=new Uint8Array(new Int32Array(o.shape).buffer),h=t.dataIdMap.get(d.dataId).id;return r(s,p,i.shape.length,u,f,o.shape.length,cK[i.dtype],h),d}}}var xK,kK=yK(mt);var wK={kernelName:vt,backendName:"wasm",setupFunc:function(e){xK=e.wasm.cwrap(vt,null,["array","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=n.makeOutput(t[0].shape,t[0].dtype);if(0===Ga.sizeFromShape(r.shape))return r;var a=t.map((function(e){return n.dataIdMap.get(e.dataId).id})),i=new Uint8Array(new Int32Array(a).buffer),o=n.dataIdMap.get(r.dataId).id;return xK(i,a.length,cK[r.dtype],o),r}};function OK(e){var t=e.inputs.x,n=e.backend;if("string"===t.dtype)return ho(n.readSync(t.dataId),t.shape,t.dtype);var r=n.makeOutput(t.shape,t.dtype),a=n.typedArrayFromHeap(t);return n.typedArrayFromHeap(r).set(a),r}var IK,SK={kernelName:Cn,backendName:"wasm",kernelFunc:OK};function NK(e){for(var t=e.inputs,n=e.backend,r=e.attrs,a=function(e,t){for(var n=[],r=[],a=0;a<e.length;++a)1!==e[a]&&n.push(e[a]),1!==e[t[a]]&&r.push(t[a]);for(var i=0;i<r.length;++i){for(var o=-1,s=0;s<r.length;++s)r[s]>=i&&(-1===o||r[o]>r[s])&&(o=s);r[o]=i}return[n,r]}(t.x.shape,r.perm),i=Object(y.a)(a,2),o=i[0],s=i[1],u=!0,c=0;c<s.length;c++)s[c]!==c&&(u=!1);var l=function(e,t){for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[t[r]];return n}(t.x.shape,r.perm),d={dataId:t.x.dataId,shape:o,dtype:t.x.dtype};if(u){var p=OK({inputs:t,backend:n});return p.shape=l,p}var f=n.makeOutput(l,d.dtype),h=n.dataIdMap.get(d.dataId).id,m=n.dataIdMap.get(f.dataId).id,v=new Uint8Array(new Int32Array(s).buffer),b=new Uint8Array(new Int32Array(d.shape).buffer);return IK(h,b,d.shape.length,cK[d.dtype],m,v,s.length),f}var jK,TK={kernelName:ya,backendName:"wasm",kernelFunc:NK,setupFunc:function(e){IK=e.wasm.cwrap(ya,null,["number","array","number","number","number","array","number"])}};function CK(e,t,n){var r=e.shape,a=e.shape.length,i=Ga.parseAxisParam(t,r),o=i,s=Wm.getAxesPermutation(o,a),u=null,c=!1;if(null!=s){for(var l=new Array(a),d=0;d<l.length;d++)l[d]=r[s[d]];o=Wm.getInnerMostAxes(o.length,a),u=NK({inputs:{x:e},attrs:{perm:s},backend:n});var p=n.dataIdMap.get(e.dataId).id;n.dataIdMap.get(u.dataId).id!==p&&(c=!0)}return{transposed:u,originalAxes:i,axes:o,inputWasTransposed:c}}var EK,_K={kernelName:bt,backendName:"wasm",setupFunc:function(e){jK=e.wasm.cwrap(bt,null,["number, number, number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.axis,i=r.keepDims,o=n.x,s=t.dataIdMap.get(o.dataId).id,u=o,c=CK(o,a,t),l=c.transposed,d=c.axes,p=c.originalAxes,f=c.inputWasTransposed;f&&(u=l,s=t.dataIdMap.get(l.dataId).id);var h=u.shape.length;Wm.assertAxesAreInnerMostDims("all",d,h);var m=Wm.computeOutAndReduceShapes(u.shape,d),v=Object(y.a)(m,2),b=v[0],g=v[1],x=Ga.sizeFromShape(g),k=t.makeOutput(b,o.dtype);if(0!==Ga.sizeFromShape(u.shape)){var w=t.dataIdMap.get(k.dataId).id;jK(s,x,w)}if(f&&t.disposeData(l.dataId),i){var O=Wm.expandShapeToKeepDim(k.shape,p);k.shape=O}return k}};var AK={kernelName:gt,backendName:"wasm",setupFunc:function(e){EK=e.wasm.cwrap(gt,null,["number, number, number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.axis,i=r.keepDims,o=n.x,s=t.dataIdMap.get(o.dataId).id,u=o,c=CK(o,a,t),l=c.transposed,d=c.axes,p=c.originalAxes,f=c.inputWasTransposed;f&&(u=l,s=t.dataIdMap.get(l.dataId).id);var h=u.shape.length;Wm.assertAxesAreInnerMostDims("any",d,h);var m=Wm.computeOutAndReduceShapes(u.shape,d),v=Object(y.a)(m,2),b=v[0],g=v[1],x=Ga.sizeFromShape(g),k=t.makeOutput(b,o.dtype);if(0!==Ga.sizeFromShape(u.shape)){var w=t.dataIdMap.get(k.dataId).id;EK(s,x,w)}if(f&&t.disposeData(l.dataId),i){var O=Wm.expandShapeToKeepDim(k.shape,p);k.shape=O}return k}};function RK(e){var t;return{kernelName:e,backendName:"wasm",setupFunc:function(n){t=n.wasm.cwrap(e,null,["number","number","number","number","number"])},kernelFunc:function(e){var n=e.backend,r=e.inputs,a=e.attrs.axis,i=r.x,o=n.dataIdMap.get(i.dataId).id,s=o,u=i,c=CK(i,a,n),l=c.transposed,d=c.axes,p=c.inputWasTransposed;if(p){var f=n.dataIdMap.get(l.dataId).id;f!==o&&(u=l,s=f)}var h=u.shape.slice(0,-1),m=n.makeOutput(h,"int32"),v=n.dataIdMap.get(m.dataId).id,b=Ga.sizeFromShape(m.shape),g=u.shape[d[0]];return t(s,cK[u.dtype],b,g,v),p&&n.disposeData(l.dataId),m}}}var DK,FK=RK(yt),MK=RK(xt),zK=mK(kt),LK=mK(wt),PK=mK(Ot),BK=yK(St),WK=mK(It);var UK,VK={kernelName:Nt,backendName:"wasm",setupFunc:function(e){DK=e.wasm.cwrap(Nt,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=r.dataIdMap.get(a.dataId).id,o=n.filterSize,s=n.strides,u=n.pad,c=n.dimRoundingMode,l=Wm.computePool2DInfo(a.shape,o,s,1,u,c),d=l.filterHeight,p=l.filterWidth,f=l.padInfo.top,h=l.padInfo.right,m=l.padInfo.bottom,v=l.padInfo.left,b=l.strideHeight,g=l.strideWidth,y=l.inChannels;if("channelsLast"!==l.dataFormat)throw new Error("wasm backend does not support dataFormat:'".concat(l.dataFormat,"'. Please use 'channelsLast'."));if(1!==l.dilationWidth||1!==l.dilationHeight)throw new Error("was backend only supports average pooling with dilation = [1, 1], got [".concat(l.dilationHeight,", ").concat(l.dilationWidth,"]."));var x=r.makeOutput(l.outShape,"float32"),k=r.dataIdMap.get(x.dataId).id;return DK(i,a.shape[0],a.shape[1],a.shape[2],d,p,f,h,m,v,b,g,y,k),x}};var GK,HK={kernelName:Tt,backendName:"wasm",setupFunc:function(e){UK=e.wasm.cwrap("AvgPool3D",null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=r.dataFormat,l=Wm.computePool3DInfo(a.shape,i,o,1,s,u,c),d=n.makeOutput(l.outShape,a.dtype);return UK(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(d.dataId).id,l.batchSize,l.inChannels,l.inDepth,l.inHeight,l.inWidth,l.outDepth,l.outHeight,l.outWidth,l.strideDepth,l.strideHeight,l.strideWidth,l.dilationDepth,l.dilationHeight,l.dilationWidth,l.effectiveFilterDepth,l.effectiveFilterHeight,l.effectiveFilterWidth,l.padInfo.front,l.padInfo.top,l.padInfo.left),d}};var qK,KK={kernelName:Ct,backendName:"wasm",setupFunc:function(e){GK=e.wasm.cwrap("AvgPool3DGrad",null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode,l=Wm.computePool3DInfo(i.shape,o,s,1,u,c),d=n.makeOutput(i.shape,i.dtype);return GK(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(d.dataId).id,l.batchSize,l.inChannels,l.inDepth,l.inHeight,l.inWidth,l.outDepth,l.outHeight,l.outWidth,l.strideDepth,l.strideHeight,l.strideWidth,l.dilationDepth,l.dilationHeight,l.dilationWidth,l.effectiveFilterDepth,l.effectiveFilterHeight,l.effectiveFilterWidth,l.padInfo.front,l.padInfo.top,l.padInfo.left,l.filterDepth,l.filterHeight,l.filterWidth),d}};var XK={kernelName:jt,backendName:"wasm",setupFunc:function(e){qK=e.wasm.cwrap("AvgPoolGrad",null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,c=Wm.computePool2DInfo(i.shape,o,s,1,u),l=n.makeOutput(i.shape,i.dtype);return qK(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(l.dataId).id,c.batchSize,c.inChannels,c.inHeight,c.inWidth,c.outHeight,c.outWidth,c.strideHeight,c.strideWidth,c.dilationHeight,c.dilationWidth,c.effectiveFilterHeight,c.effectiveFilterWidth,c.padInfo.top,c.padInfo.left,c.filterHeight,c.filterWidth),l}};function YK(e){var t=e.inputs,n=e.attrs,r=t.x,a=n.shape,i=Ga.sizeFromShape(r.shape),o=Ga.inferFromImplicitShape(a,i);return Ga.assert(i===Ga.sizeFromShape(o),(function(){return"new shape: ".concat(o,", old shape: ").concat(r.shape,". New shape and old shape must have the same number of elements.")})),e.backend.incRef(r.dataId),{dataId:r.dataId,shape:o,dtype:r.dtype}}var ZK,JK={kernelName:Er,backendName:"wasm",kernelFunc:YK};var QK={kernelName:Et,backendName:"wasm",setupFunc:function(e){ZK=e.wasm.cwrap(Et,null,["number","array","number","number","array","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.a,i=t.b,o=r.transposeA,s=r.transposeB;if("float32"!==a.dtype||"float32"!==i.dtype)throw new Error("BatchMatMul for non non-float32 tensors not yet supported.");var u=a.shape.length,c=i.shape.length,l=o?a.shape[u-2]:a.shape[u-1],d=s?i.shape[c-1]:i.shape[c-2],p=o?a.shape[u-1]:a.shape[u-2],f=s?i.shape[c-2]:i.shape[c-1],h=a.shape.slice(0,-2),m=i.shape.slice(0,-2),v=Ga.sizeFromShape(h),b=Ga.sizeFromShape(m),g=gc.assertAndGetBroadcastShape(a.shape.slice(0,-2),i.shape.slice(0,-2)).concat([p,f]);Ga.assert(l===d,(function(){return"Error in matMul: inner shapes (".concat(l,") and (").concat(d,") of Tensors with shapes ").concat(a.shape," and ").concat(i.shape," and transposeA=").concat(o," and transposeB=").concat(s," must match.")}));var y=s?[b,f,d]:[b,d,f],x=YK({inputs:{x:a},backend:n,attrs:{shape:o?[v,l,p]:[v,p,l]}}),k=YK({inputs:{x:i},backend:n,attrs:{shape:y}}),w=n.dataIdMap.get(x.dataId).id,O=n.dataIdMap.get(k.dataId).id,I=o?x.shape[2]:x.shape[1],S=s?k.shape[1]:k.shape[2],N=Math.max(v,b),j=n.makeOutput([N,I,S],x.dtype),T=n.dataIdMap.get(j.dataId).id,C=new Uint8Array(new Int32Array(x.shape).buffer),E=new Uint8Array(new Int32Array(k.shape).buffer);return ZK(w,C,x.shape.length,O,E,k.shape.length,o,s,T),n.disposeData(x.dataId),n.disposeData(k.dataId),j.shape=g,j}};function $K(e){var t=e.inputs.x,n=e.attrs,r=n.begin,a=n.size,i=e.backend,o=bm.parseSliceParams(t,r,a),s=Object(y.a)(o,2),u=s[0],c=s[1],l=bm.isSliceContinous(t.shape,u,c),d=i.readSync(t.dataId),p=i.makeOutput(c,t.dtype),f=Ga.computeStrides(t.shape),h=i.dataIdMap.get(p.dataId);if(l){var m=bm.computeFlatOffset(u,f);return"string"===t.dtype?h.stringBytes=d.slice(m,m+Ga.sizeFromShape(c)):i.typedArrayFromHeap(p).set(d.subarray(m,m+Ga.sizeFromShape(c))),p}if("string"===t.dtype){var v=cA(d,u,c,t.shape,t.dtype);return h.stringBytes=v,p}var b=i.typedArrayFromHeap(p),g=t.shape.length;if(2===g)!function(e,t,n,r,a){for(var i=0,o=r[0],s=r[1],u=o+a[0],c=o;c<u;c++){var l=c*t+s;n.set(e.subarray(l,l+a[1]),i),i+=a[1]}}(d,f[0],b,u,c);else if(3===g)!function(e,t,n,r,a,i){for(var o=0,s=a[0],u=a[1],c=a[2],l=s+i[0],d=u+i[1],p=s;p<l;p++)for(var f=u;f<d;f++){var h=p*t+f*n+c;r.set(e.subarray(h,h+i[2]),o),o+=i[2]}}(d,f[0],f[1],b,u,c);else if(4===g)!function(e,t,n,r,a,i,o){for(var s=0,u=i[0],c=i[1],l=i[2],d=u+o[0],p=c+o[1],f=l+o[2],h=i[3],m=u;m<d;m++)for(var v=c;v<p;v++)for(var b=l;b<f;b++){var g=m*t+v*n+b*r+h;a.set(e.subarray(g,g+o[3]),s),s+=o[3]}}(d,f[0],f[1],f[2],b,u,c);else{var x=cA(d,u,c,t.shape,t.dtype);b.set(x)}return p}var eX={kernelName:Gr,backendName:"wasm",kernelFunc:$K};var tX,nX={kernelName:_t,backendName:"wasm",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.crops,s=i.reduce((function(e,t){return e*t})),u=Wm.getReshaped(a.shape,i,s),c=Wm.getPermuted(u.length,i.length),l=Wm.getReshapedPermuted(a.shape,i,s),d=Wm.getSliceBeginCoords(o,i.length),p=Wm.getSliceSize(l,o,i.length),f=YK({inputs:{x:a},backend:n,attrs:{shape:u}}),h=NK({inputs:{x:f},backend:n,attrs:{perm:c}}),m=$K({inputs:{x:YK({inputs:{x:h},backend:n,attrs:{shape:l}})},backend:n,attrs:{begin:d,size:p}});return n.disposeData(f.dataId),n.disposeData(h.dataId),n.disposeData(f.dataId),m}};var rX={kernelName:At,backendName:"wasm",setupFunc:function(e){tX=e.wasm.cwrap(At,null,["number","number","boolean","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=n.x,i=n.weights,o=r.size,s=0!==i.shape.reduce((function(e,t){return e*t}),1),u=1===a.shape.length?[o]:[a.shape[0],o],c=t.makeOutput(u,i.dtype);function l(e){return t.dataIdMap.get(e.dataId).id}return tX(l(a),o,s,l(i),cK[i.dtype],l(c)),c}},aX=yK(Rt);var iX={kernelName:Ft,backendName:"wasm",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.s0,a=t.s1,i=n.typedArrayFromHeap(r),o=n.typedArrayFromHeap(a),s=Wm.assertAndGetBroadcastShape(Array.from(i),Array.from(o));return n.makeOutput([s.length],"int32",void 0,new Int32Array(s))}};function oX(e){var t=e.inputs.x,n=e.attrs.dtype,r=e.backend,a=r.makeOutput(t.shape,n),i=r.typedArrayFromHeap(t);return r.typedArrayFromHeap(a).set(i),a}var sX,uX={kernelName:Mt,backendName:"wasm",kernelFunc:oX},cX=mK(zt);var lX={kernelName:Lt,backendName:"wasm",setupFunc:function(e){sX=e.wasm.cwrap(Lt,null,["number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.clipValueMin,o=r.clipValueMax,s=n.dataIdMap.get(a.dataId).id,u=n.makeOutput(a.shape,a.dtype),c=n.dataIdMap.get(u.dataId).id;return sX(s,i,o,c),u}};function dX(e){var t=e.inputs,n=e.backend,r=Ga.parseAxisParam(e.attrs.axis,t[0].shape)[0],a=t.map((function(e){return e.shape}));Wm.assertParamsConsistent(a,r);var i=Wm.computeOutShape(t.map((function(e){return e.shape})),r),o=t.filter((function(e){return Ga.sizeFromShape(e.shape)>0}));if(1===o.length)return OK({inputs:{x:o[0]},backend:n});var s=n.makeOutput(i,t[0].dtype);if(0===Ga.sizeFromShape(i))return s;if("string"===o[0].dtype){var u=o.map((function(e){var t=[-1,Ga.sizeFromShape(e.shape.slice(r))];return YK({inputs:{x:e},backend:n,attrs:{shape:t}})})),c=u.map((function(e){return{vals:n.readSync(e.dataId),shape:e.shape}}));i=Wm.computeOutShape(u.map((function(e){return e.shape})),1);var l=1===u[0].shape[0],d=VE(c,i,t[0].dtype,l),p=Wm.computeOutShape(o.map((function(e){return e.shape})),r);return s.shape=p,n.dataIdMap.get(s.dataId).stringBytes=Wm.fromStringArrayToUint8(d),u.forEach((function(e){return n.disposeData(e.dataId)})),s}for(var f=Ga.sizeFromShape(o[0].shape.slice(0,r)),h=0,m=o.map((function(e){var t=Ga.sizeFromShape(e.shape.slice(r));return h+=t,t})),v=o.map((function(e){return n.typedArrayFromHeap(e)})),b=n.typedArrayFromHeap(s),g=0;g<f;g++)for(var y=g*h,x=0;x<v.length;x++){var k=m[x],w=g*k,O=v[x].subarray(w,w+k);b.set(O,y),y+=k}return s}var pX,fX={kernelName:Wt,backendName:"wasm",kernelFunc:dX};var hX,mX={kernelName:Ut,backendName:"wasm",setupFunc:function(e){pX=e.wasm.cwrap(Ut,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=t.filter,o=r.dataIdMap.get(a.dataId).id,s=r.dataIdMap.get(i.dataId).id,u=n.strides,c=n.dilations,l=n.pad,d=n.dimRoundingMode,p=n.dataFormat,f=Wm.convertConv2DDataFormat(p),h=Wm.computeConv2DInfo(a.shape,i.shape,u,c,l,d,!1,f),m=h.filterHeight,v=h.filterWidth,b=h.padInfo.top,g=h.padInfo.right,y=h.padInfo.bottom,x=h.padInfo.left,k=h.dilationHeight,w=h.dilationWidth,O=h.strideHeight,I=h.strideWidth,S=h.inChannels,N=h.outChannels,j="SAME"===h.padInfo.type?1:0;if("channelsLast"!==h.dataFormat)throw new Error("wasm backend Conv2D does not support dataFormat:'".concat(h.dataFormat,"'. Please use 'channelsLast'."));var T=r.makeOutput(h.outShape,"float32"),C=r.dataIdMap.get(T.dataId).id;return pX(o,a.shape[0],a.shape[1],a.shape[2],s,m,v,b,g,y,x,j,k,w,O,I,S,N,C),T}};var vX,bX={kernelName:Gt,backendName:"wasm",setupFunc:function(e){hX=e.wasm.cwrap(Gt,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=n.dy,i=n.filter,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dimRoundingMode,l=r.inputShape,d=Wm.convertConv2DDataFormat(u),p=Wm.computeConv2DInfo(l,i.shape,o,1,s,c,!1,d),f=p.batchSize,h=p.filterHeight,m=p.filterWidth,v=p.inChannels,b=p.inHeight,g=p.inWidth,x=p.outChannels,k=p.outHeight,w=p.outWidth,O=p.strideHeight,I=p.strideWidth,S=h-1-p.padInfo.top,N=m-1-p.padInfo.left,j="channelsLast"===p.dataFormat,T=Ga.computeStrides(p.inShape),C=Ga.computeStrides(a.shape),E=Ga.computeStrides(i.shape),_=Object(y.a)(E,3),A=_[0],R=_[1],D=_[2],F=T[0],M=j?T[1]:T[2],z=j?T[2]:1,L=j?1:T[1],P=C[0],B=j?C[1]:C[2],W=j?C[2]:1,U=j?1:C[1],V=t.makeOutput(p.inShape,"float32"),G=t.dataIdMap.get(V.dataId).id,H=t.dataIdMap.get(a.dataId).id,q=t.dataIdMap.get(i.dataId).id;return hX(H,q,f,h,m,b,g,v,k,w,x,O,I,S,N,A,R,D,F,M,z,L,P,B,W,U,G),V}};var gX,yX={kernelName:Ht,backendName:"wasm",setupFunc:function(e){vX=e.wasm.cwrap(Ht,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations;if("float32"!==a.dtype)throw new Error("Tensor x must have dtype float32, got ".concat(a.dtype));if("float32"!==i.dtype)throw new Error("Tensor filter must have dtype float32, got ".concat(i.dtype));var c=Wm.computeConv3DInfo(a.shape,i.shape,o,u,s),l=n.makeOutput(c.outShape,a.dtype);return vX(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(i.dataId).id,n.dataIdMap.get(l.dataId).id,c.batchSize,c.inDepth,c.inHeight,c.inWidth,c.inChannels,c.outDepth,c.outHeight,c.outWidth,c.outChannels,c.strideDepth,c.strideHeight,c.strideWidth,c.dilationDepth,c.dilationHeight,c.dilationWidth,c.filterDepth,c.filterHeight,c.filterWidth,c.padInfo.front,c.padInfo.top,c.padInfo.left),l}};var xX,kX={kernelName:qt,backendName:"wasm",setupFunc:function(e){gX=e.wasm.cwrap(qt,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.pad,u=r.filterShape;if("float32"!==a.dtype)throw new Error("Tensor dy must have dtype float32, got ".concat(a.dtype));if("float32"!==i.dtype)throw new Error("Tensor filter must have dtype float32, got ".concat(i.dtype));var c=Wm.computeConv3DInfo(a.shape,u,o,1,s),l=n.makeOutput(c.filterShape,i.dtype);return gX(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(i.dataId).id,n.dataIdMap.get(l.dataId).id,c.batchSize,c.inDepth,c.inHeight,c.inWidth,c.inChannels,c.outDepth,c.outHeight,c.outWidth,c.outChannels,c.strideDepth,c.strideHeight,c.strideWidth,c.dilationDepth,c.dilationHeight,c.dilationWidth,c.filterDepth,c.filterHeight,c.filterWidth,c.padInfo.front,c.padInfo.top,c.padInfo.left),l}};var wX,OX,IX={kernelName:Kt,backendName:"wasm",setupFunc:function(e){xX=e.wasm.cwrap(Kt,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.pad,s=r.strides,u=r.inputShape;if("float32"!==a.dtype)throw new Error("Tensor dy must have dtype float32, got ".concat(a.dtype));if("float32"!==i.dtype)throw new Error("Tensor filter must have dtype float32, got ".concat(i.dtype));var c=Wm.computeConv3DInfo(u,i.shape,s,1,o),l=n.makeOutput(c.inShape,a.dtype);return xX(n.dataIdMap.get(i.dataId).id,n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(l.dataId).id,c.batchSize,c.inDepth,c.inHeight,c.inWidth,c.inChannels,c.outDepth,c.outHeight,c.outWidth,c.outChannels,c.strideDepth,c.strideHeight,c.strideWidth,c.dilationDepth,c.dilationHeight,c.dilationWidth,c.filterDepth,c.filterHeight,c.filterWidth,c.padInfo.front,c.padInfo.top,c.padInfo.left),l}},SX=mK(Xt),NX=mK(Yt);!function(e){e[e.bilinear=0]="bilinear",e[e.nearest=1]="nearest"}(wX||(wX={}));var jX,TX={kernelName:Qt,backendName:"wasm",setupFunc:function(e){OX=e.wasm.cwrap(Qt,null,["number","number","number","number","array","number","number","number","number","number"])},kernelFunc:function(e){var t,n=e.backend,r=e.inputs,a=e.attrs,i=a.method,o=a.extrapolationValue,s=a.cropSize,u=r.image,c=r.boxes,l=r.boxInd,d=c.shape[0],p=Object(y.a)(s,2),f=p[0],h=p[1],m=[d,f,h,u.shape[3]],v=n.dataIdMap.get(u.dataId);"float32"!==u.dtype&&(t=oX({backend:n,inputs:{x:u},attrs:{dtype:"float32"}}),v=n.dataIdMap.get(t.dataId));var b=v.id,g=n.dataIdMap.get(c.dataId).id,x=n.dataIdMap.get(l.dataId).id,k=n.makeOutput(m,"float32"),w=n.dataIdMap.get(k.dataId).id,O=new Uint8Array(new Int32Array(u.shape).buffer);return OX(b,g,x,d,O,f,h,wX[i],o,w),null!=t&&n.disposeData(t.dataId),k}};var CX,EX={kernelName:Zt,backendName:"wasm",setupFunc:function(e){jX=e.wasm.cwrap(Zt,null,["number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse,u=a.shape.length;Ga.assert("float32"===a.dtype||"int32"===a.dtype,(function(){return"cumprod does not support ".concat(a.dtype," tensors in the WASM backend")}));var c=Wm.getAxesPermutation([i],u),l=a;null!==c&&(l=NK({inputs:{x:a},attrs:{perm:c},backend:n}));var d=Wm.getInnerMostAxes(1,u)[0];Wm.assertAxesAreInnerMostDims("cumprod",[d],u);var p=n.makeOutput(l.shape,l.dtype),f=l.shape[d],h=n.dataIdMap.get(l.dataId).id,m=n.dataIdMap.get(p.dataId).id;jX(h,o?1:0,s?1:0,f,m,cK[a.dtype]);var v=p;return null!==c&&(v=NK({inputs:{x:p},attrs:{perm:Wm.getUndoAxesPermutation(c)},backend:n}),n.disposeData(l.dataId),n.disposeData(p.dataId)),v}};var _X,AX={kernelName:Jt,backendName:"wasm",setupFunc:function(e){CX=e.wasm.cwrap(Jt,null,["number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse,u=a.shape.length;Ga.assert("float32"===a.dtype||"int32"===a.dtype,(function(){return"cumsum does not support ".concat(a.dtype," tensors in the WASM backend")}));var c=Wm.getAxesPermutation([i],u),l=a;null!==c&&(l=NK({inputs:{x:a},attrs:{perm:c},backend:n}));var d=Wm.getInnerMostAxes(1,u)[0];Wm.assertAxesAreInnerMostDims("cumsum",[d],u);var p=n.makeOutput(l.shape,l.dtype),f=l.shape[d],h=n.dataIdMap.get(l.dataId).id,m=n.dataIdMap.get(p.dataId).id;CX(h,o?1:0,s?1:0,f,m,cK[a.dtype]);var v=p;return null!==c&&(v=NK({inputs:{x:p},attrs:{perm:Wm.getUndoAxesPermutation(c)},backend:n}),n.disposeData(l.dataId),n.disposeData(p.dataId)),v}};var RX,DX={kernelName:$t,backendName:"wasm",setupFunc:function(e){_X=e.wasm.cwrap("DenseBincount",null,["number","array","number","number","boolean","number","number","boolean","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=n.x,i=n.weights,o=r.size,s=r.binaryOutput,u=0!==i.shape.reduce((function(e,t){return e*t}),1),c=1===a.shape.length?[o]:[a.shape[0],o],l=t.makeOutput(c,i.dtype);function d(e){return t.dataIdMap.get(e.dataId).id}return _X(d(a),new Uint8Array(new Int32Array(a.shape).buffer),a.shape.length,o,u,d(i),cK[i.dtype],s,d(l)),l}};var FX,MX={kernelName:en,backendName:"wasm",setupFunc:function(e){RX=e.wasm.cwrap(en,null,["number","number","number","array","number","array","array","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=n.x,i=r.blockSize,o=r.dataFormat,s=a.shape[0],u=("NHWC"===o?a.shape[1]:a.shape[2])*i,c=("NHWC"===o?a.shape[2]:a.shape[3])*i,l=("NHWC"===o?a.shape[3]:a.shape[1])/(i*i),d="NHWC"===o?[s,u,c,l]:[s,l,u,c],p=t.makeOutput(d,"float32"),f=t.dataIdMap.get(a.dataId).id,h=new Uint8Array(new Int32Array(Ga.computeStrides(a.shape)).buffer),m=new Uint8Array(new Int32Array(d).buffer),v=new Uint8Array(new Int32Array(Ga.computeStrides(d)).buffer),b=t.dataIdMap.get(p.dataId).id;return RX(f,i,"NHWC"===o?1:0,h,a.shape.length-1,m,v,d.length,b),p}};var zX,LX={kernelName:tn,backendName:"wasm",setupFunc:function(e){FX=e.wasm.cwrap(tn,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=t.filter,o=r.dataIdMap.get(a.dataId).id,s=r.dataIdMap.get(i.dataId).id,u=n.strides,c=n.dilations,l=n.pad,d=n.dimRoundingMode,p=null==c?[1,1]:c,f=Wm.computeConv2DInfo(a.shape,i.shape,u,p,l,d,!0),h=f.filterHeight,m=f.filterWidth,v=f.padInfo.top,b=f.padInfo.right,g=f.padInfo.bottom,y=f.padInfo.left,x=f.dilationHeight,k=f.dilationWidth,w=f.strideHeight,O=f.strideWidth,I=f.inChannels,S=f.outChannels,N="SAME"===f.padInfo.type?1:0;if("channelsLast"!==f.dataFormat)throw new Error("wasm backend DepthwiseConv2dNative does not support dataFormat:'".concat(f.dataFormat,"'. Please use 'channelsLast'."));var j=r.makeOutput(f.outShape,"float32"),T=r.dataIdMap.get(j.dataId).id;return FX(o,a.shape[0],a.shape[1],a.shape[2],s,h,m,v,b,g,y,N,x,k,w,O,I,S,T),j}};var PX,BX={kernelName:an,backendName:"wasm",setupFunc:function(e){zX=e.wasm.cwrap("Diag",null,["number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=Ga.sizeFromShape(r.shape),i=n.makeOutput([].concat(Object(S.a)(r.shape),Object(S.a)(r.shape)),r.dtype);return zX(n.dataIdMap.get(r.dataId).id,cK[r.dtype],a,n.dataIdMap.get(i.dataId).id),i}};var WX,UX={kernelName:on,backendName:"wasm",setupFunc:function(e){PX=e.wasm.cwrap(on,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations;if(a.dtype!==i.dtype)throw new Error("Dilation2D error: x must have the same dtype as filter. Got ".concat(a.dtype," and ").concat(i.dtype));var c=Wm.computeDilation2DInfo(a.shape,i.shape,o,s,"NHWC",u),l=n.makeOutput(c.outShape,a.dtype);return PX(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(i.dataId).id,n.dataIdMap.get(l.dataId).id,cK[a.dtype],c.batchSize,c.inChannels,c.inHeight,c.inWidth,c.outHeight,c.outWidth,c.strideHeight,c.strideWidth,c.dilationHeight,c.dilationWidth,c.filterHeight,c.filterWidth,c.padInfo.top,c.padInfo.left),l}};var VX,GX={kernelName:un,backendName:"wasm",setupFunc:function(e){WX=e.wasm.cwrap(un,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.dy,s=r.strides,u=r.pad,c=r.dilations;if(a.dtype!==i.dtype||a.dtype!==o.dtype)throw new Error("Dilation2DBackpropFilter error: x must have the same dtype as filter and dy. Got ".concat(a.dtype,", ").concat(i.dtype,", and ").concat(o.dtype));var l=Wm.computeDilation2DInfo(a.shape,i.shape,s,u,"NHWC",c),d=n.makeOutput(i.shape,i.dtype);return WX(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(i.dataId).id,n.dataIdMap.get(o.dataId).id,n.dataIdMap.get(d.dataId).id,cK[a.dtype],l.batchSize,l.inChannels,l.inHeight,l.inWidth,l.outHeight,l.outWidth,l.strideHeight,l.strideWidth,l.dilationHeight,l.dilationWidth,l.filterHeight,l.filterWidth,l.padInfo.top,l.padInfo.left),d}};var HX,qX={kernelName:sn,backendName:"wasm",setupFunc:function(e){VX=e.wasm.cwrap(sn,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.dy,s=r.strides,u=r.pad,c=r.dilations;if(a.dtype!==i.dtype||a.dtype!==o.dtype)throw new Error("Dilation2DBackpropInput error: x must have the same dtype as filter and dy. Got ".concat(a.dtype,", ").concat(i.dtype,", and ").concat(o.dtype));var l=Wm.computeDilation2DInfo(a.shape,i.shape,s,u,"NHWC",c),d=n.makeOutput(a.shape,a.dtype);return VX(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(i.dataId).id,n.dataIdMap.get(o.dataId).id,n.dataIdMap.get(d.dataId).id,cK[a.dtype],l.batchSize,l.inChannels,l.inHeight,l.inWidth,l.outHeight,l.outWidth,l.strideHeight,l.strideWidth,l.dilationHeight,l.dilationWidth,l.filterHeight,l.filterWidth,l.padInfo.top,l.padInfo.left),d}},KX=mK(pn);var XX={kernelName:fn,backendName:"wasm",setupFunc:function(e){HX=e.wasm.cwrap(fn,null,["number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.dy,a=t.y,i=n.makeOutput(a.shape,"float32"),o=function(e){return n.dataIdMap.get(e.dataId).id};return HX(o(a),o(r),o(i)),i}},YX=yK(mn,0,"bool"),ZX=mK(hn),JX=mK(vn,"float32");function QX(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.input,i=n.dim,o=a.shape.length,s=a.shape.slice(),u=i;return i<0&&(Ga.assert(-(o+1)<=i,(function(){return"Axis must be in the interval [".concat(-(o+1),", ").concat(o,"]")})),u=o+i+1),s.splice(u,0,1),YK({inputs:{x:a},backend:r,attrs:{shape:s}})}var $X={kernelName:bn,backendName:"wasm",kernelFunc:QX},eY=mK(gn,"float32");function tY(e){var t=e.attrs,n=t.shape,r=t.value,a=t.dtype,i=e.backend,o=i.makeOutput(n,a);return i.typedArrayFromHeap(o).fill(r),o}var nY,rY={kernelName:xn,backendName:"wasm",kernelFunc:tY};var aY,iY={kernelName:kn,backendName:"wasm",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.image,a=n.makeOutput(r.shape,r.dtype),i=n.dataIdMap.get(r.dataId).id,o=n.dataIdMap.get(a.dataId).id,s=Object(y.a)(r.shape,4),u=s[0],c=s[1],l=s[2],d=s[3];return nY(i,u,c,l,d,o),a},setupFunc:function(e){nY=e.wasm.cwrap(kn,null,["number","number","number","number","number","number"])}},oY=mK(wn),sY=yK(On);var uY,cY={kernelName:In,backendName:"wasm",setupFunc:function(e){aY=e.wasm.cwrap(In,null,["number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs.varianceEpsilon,a=n.x,i=n.mean,o=n.variance,s=n.offset,u=n.scale,c=t.dataIdMap.get(a.dataId).id,l=t.dataIdMap.get(i.dataId).id,d=t.dataIdMap.get(o.dataId).id,p=null!=s?t.dataIdMap.get(s.dataId).id:0,f=null!=u?t.dataIdMap.get(u.dataId).id:0,h=t.makeOutput(a.shape,a.dtype);if(0===Ga.sizeFromShape(a.shape))return h;var m=t.dataIdMap.get(h.dataId).id;return aY(c,l,d,p,f,r,m),h}};var lY,dY={kernelName:Ca,backendName:"wasm",setupFunc:function(e){uY=e.wasm.cwrap(Ca,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=t.filter,o=t.bias,s=t.preluActivationWeights,u=n.strides,c=n.pad,l=n.dilations,d=n.dataFormat,p=n.dimRoundingMode,f=n.activation,h=n.leakyreluAlpha,m=Wm.computeConv2DInfo(a.shape,i.shape,u,l,c,p),v=lK[f];if(null==v)throw new Error("".concat(f," activation not yet supported for FusedConv2D in the wasm backend."));var b=r.dataIdMap.get(a.dataId).id,g=r.dataIdMap.get(i.dataId).id,y=m.outChannels,x=0;if(null!=o){var k=r.dataIdMap.get(o.dataId);if(1!==k.shape.length)throw new Error("FusedConv2D only supports rank-1 bias but got rank ".concat(k.shape.length,"."));if(k.shape[0]!==y)throw new Error("FusedConv2D bias shape (".concat(k.shape,") does not match the number of output channels (").concat(y,")"));x=k.id}var w=m.filterHeight,O=m.filterWidth,I=m.padInfo.top,S=m.padInfo.right,N=m.padInfo.bottom,j=m.padInfo.left,T=m.dilationHeight,C=m.dilationWidth,E=m.strideHeight,_=m.strideWidth,A=m.inChannels,R="SAME"===m.padInfo.type?1:0,D=m.batchSize,F=m.inHeight,M=m.inWidth;if("NHWC"!==d)throw new Error("wasm backend FusedConv2D does not support dataFormat:'".concat(d,"'. Please use 'NHWC'."));var z=r.makeOutput(m.outShape,"float32"),L=r.dataIdMap.get(z.dataId).id,P=null==s?0:r.dataIdMap.get(s.dataId).id;return uY(b,D,F,M,g,w,O,x,I,S,N,j,R,T,C,E,_,A,y,v,P,h||0,L),z}};var pY,fY={kernelName:Ea,backendName:"wasm",setupFunc:function(e){lY=e.wasm.cwrap(Ea,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=t.filter,o=t.bias,s=t.preluActivationWeights,u=n.strides,c=n.pad,l=n.dilations,d=n.dataFormat,p=n.dimRoundingMode,f=n.activation,h=n.leakyreluAlpha,m=Wm.computeConv2DInfo(a.shape,i.shape,u,l,c,p,!0),v=lK[f];if(null==v)throw new Error("".concat(f," activation not yet supported for FusedDepthwiseConv2D in the wasm backend."));var b=r.dataIdMap.get(a.dataId).id,g=r.dataIdMap.get(i.dataId).id,y=m.outChannels,x=0;if(null!=o){var k=r.dataIdMap.get(o.dataId);if(1!==k.shape.length)throw new Error("FusedDepthwiseConv2D only supports rank-1 bias but got rank ".concat(k.shape.length,"."));if(k.shape[0]!==y)throw new Error("FusedDepthwiseConv2D bias shape (".concat(k.shape,") does not match the number of output channels (").concat(y,")"));x=k.id}var w=m.filterHeight,O=m.filterWidth,I=m.padInfo.top,S=m.padInfo.right,N=m.padInfo.bottom,j=m.padInfo.left,T=m.dilationHeight,C=m.dilationWidth,E=m.strideHeight,_=m.strideWidth,A=m.inChannels,R="SAME"===m.padInfo.type?1:0,D=m.batchSize,F=m.inHeight,M=m.inWidth;if("NHWC"!==d)throw new Error("wasm backend FusedDepthwiseConv2D does not support dataFormat:'".concat(d,"'. Please use 'NHWC'."));var z=r.makeOutput(m.outShape,"float32"),L=r.dataIdMap.get(z.dataId).id,P=null==s?0:r.dataIdMap.get(s.dataId).id;return lY(b,D,F,M,g,w,O,x,I,S,N,j,R,T,C,E,_,A,y,v,P,h||0,L),z}};var hY,mY={kernelName:Nn,backendName:"wasm",setupFunc:function(e){pY=e.wasm.cwrap(Nn,null,["number","number","number","number","number","number","array","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=n.params,a=n.indices,i=mm.prepareAndValidate(r,a),o=Object(y.a)(i,4),s=o[0],u=o[1],c=o[2],l=o[3],d=t.makeOutput(s,r.dtype);if(0===u)return d;var p=a.shape,f=p[p.length-1],h=t.dataIdMap.get(r.dataId).id,m=t.dataIdMap.get(a.dataId).id,v=new Uint8Array(new Int32Array(l).buffer),b=t.dataIdMap.get(d.dataId).id;return pY(h,cK[r.dtype],m,u,f,c,v,b),d}};var vY,bY={kernelName:Sn,backendName:"wasm",setupFunc:function(e){hY=e.wasm.cwrap("Gather",null,["number","number","array","number","number","number","array","number"])},kernelFunc:function(e){for(var t=e.backend,n=e.inputs,r=e.attrs,a=n.x,i=n.indices,o=r.axis,s=r.batchDims,u=Ga.parseAxisParam(o,a.shape)[0],c=t.readSync(i.dataId),l=a.shape[u],d=function(e){var t=c[e];Ga.assert(t<=l-1&&t>=0,(function(){return"GatherV2: the index value ".concat(t," is not in [0, ").concat(l-1,"]")}))},p=0;p<c.length;++p)d(p);var f=Wm.segment_util.collectGatherOpShapeInfo(a,i,u,s),h=YK({inputs:{x:a},attrs:{shape:[f.batchSize,f.outerSize,f.dimSize,f.sliceSize]},backend:t}),m=Ga.sizeFromShape(i.shape),v=YK({inputs:{x:i},attrs:{shape:[f.batchSize,m/f.batchSize]},backend:t}),b=[f.batchSize,f.outerSize,m/f.batchSize,f.sliceSize],g=t.makeOutput(b,a.dtype);if(0===Ga.sizeFromShape(a.shape))return g;var y=h.shape.length-1,x=t.dataIdMap.get(h.dataId).id,k=t.dataIdMap.get(v.dataId).id,w=t.dataIdMap.get(g.dataId).id,O=new Uint8Array(new Int32Array(Ga.computeStrides(h.shape)).buffer),I=new Uint8Array(new Int32Array(Ga.computeStrides(b)).buffer);return hY(x,cK[a.dtype],O,y,k,f.batchSize,I,w),t.disposeData(h.dataId),t.disposeData(v.dataId),g.shape=f.outputShape,g}},gY=yK(jn,0,"bool"),yY=yK(Tn,0,"bool"),xY=mK(An,"bool"),kY=mK(Rn,"bool"),wY=mK(Dn,"bool");var OY,IY={kernelName:Fn,backendName:"wasm",setupFunc:function(e){vY=e.wasm.cwrap(Fn,null,["number","number","number","number"])},kernelFunc:function(e){var t=e.inputs.x,n=e.attrs.alpha,r=e.backend,a=r.dataIdMap.get(t.dataId).id,i=r.makeOutput(t.shape,"float32");if(0!==Ga.sizeFromShape(t.shape)){var o=r.dataIdMap.get(i.dataId).id;vY(a,cK[t.dtype],n,o)}return i}},SY=yK(Mn,0,"bool"),NY=yK(zn,0,"bool");var jY,TY={kernelName:Ln,backendName:"wasm",setupFunc:function(e){OY=e.wasm.cwrap(Ln,null,["number","number","number","number"])},kernelFunc:function(e){var t=e.attrs,n=e.backend,r=t.start,a=t.stop,i=t.num,o=Math.floor(i),s=n.makeOutput([o],"float32");return OY(n.dataIdMap.get(s.dataId).id,r,a,o),s}},CY=mK(Pn),EY=mK(Bn),_Y=yK(Wn,0,"bool"),AY=mK(Un),RY=yK(Vn,0,"bool"),DY=yK(Gn,0,"bool");var FY,MY={kernelName:Kn,backendName:"wasm",setupFunc:function(e){jY=e.wasm.cwrap(Kn,null,["number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.depthRadius,o=r.bias,s=r.alpha,u=r.beta;if("float32"!==a.dtype)throw new Error("LRN error: x must have dtype float32");var c=n.makeOutput(a.shape,a.dtype);return jY(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(c.dataId).id,a.shape[3],i,o,s,u),c}};var zY,LY={kernelName:Xn,backendName:"wasm",setupFunc:function(e){FY=e.wasm.cwrap(Xn,null,["number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.y,o=t.dy,s=r.depthRadius,u=r.bias,c=r.alpha,l=r.beta;if("float32"!==a.dtype||"float32"!==i.dtype||"float32"!==o.dtype)throw new Error("LRNGrad error: x, y, and dy must have dtype float32");var d=n.makeOutput(a.shape,a.dtype);return FY(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(i.dataId).id,n.dataIdMap.get(o.dataId).id,n.dataIdMap.get(d.dataId).id,o.shape[3],s,u,c,l),d}};var PY,BY={kernelName:Zn,backendName:"wasm",setupFunc:function(e){zY=e.wasm.cwrap(Zn,null,["number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.reductionIndices,i=r.keepDims,o=n.x,s=t.dataIdMap.get(o.dataId).id,u=o,c=CK(o,a,t),l=c.transposed,d=c.axes,p=c.originalAxes,f=c.inputWasTransposed;f&&(u=l,s=t.dataIdMap.get(l.dataId).id);var h=u.shape.length;Wm.assertAxesAreInnerMostDims("max",d,h);var m=Wm.computeOutAndReduceShapes(u.shape,d),v=Object(y.a)(m,2),b=v[0],g=v[1],x=Ga.sizeFromShape(g),k=t.makeOutput(b,o.dtype);if(0!==Ga.sizeFromShape(u.shape)){var w=t.dataIdMap.get(k.dataId).id;zY(s,cK[o.dtype],x,w)}if(f&&t.disposeData(l.dataId),i){var O=Wm.expandShapeToKeepDim(k.shape,p);k.shape=O}return k}},WY=yK(Jn);var UY,VY={kernelName:Qn,backendName:"wasm",setupFunc:function(e){PY=e.wasm.cwrap(Qn,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=r.dataIdMap.get(a.dataId).id;Ga.assert("float32"===a.dtype,(function(){return"Error in MaxPool: only float32 input is supported. Got ".concat(a.dtype,".")}));var o=n.filterSize,s=n.strides,u=n.pad,c=n.dimRoundingMode,l=Wm.computePool2DInfo(a.shape,o,s,1,u,c),d=l.filterHeight,p=l.filterWidth,f=l.padInfo.top,h=l.padInfo.right,m=l.padInfo.bottom,v=l.padInfo.left,b=l.dilationHeight,g=l.dilationWidth,y=l.strideHeight,x=l.strideWidth,k=l.inChannels,w=l.outChannels;if("channelsLast"!==l.dataFormat)throw new Error("wasm backend does not support dataFormat:'".concat(l.dataFormat,"'. Please use 'channelsLast'."));var O=r.makeOutput(l.outShape,"float32"),I=r.dataIdMap.get(O.dataId).id;return PY(i,a.shape[0],a.shape[1],a.shape[2],d,p,f,h,m,v,b,g,y,x,k,w,I),O}};var GY,HY={kernelName:er,backendName:"wasm",setupFunc:function(e){UY=e.wasm.cwrap("MaxPool3D",null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=r.dataFormat,l=Wm.computePool3DInfo(a.shape,i,o,1,s,u,c),d=n.makeOutput(l.outShape,a.dtype);return UY(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(d.dataId).id,l.batchSize,l.inChannels,l.inDepth,l.inHeight,l.inWidth,l.outDepth,l.outHeight,l.outWidth,l.strideDepth,l.strideHeight,l.strideWidth,l.dilationDepth,l.dilationHeight,l.dilationWidth,l.effectiveFilterDepth,l.effectiveFilterHeight,l.effectiveFilterWidth,l.padInfo.front,l.padInfo.top,l.padInfo.left),d}};var qY,KY={kernelName:tr,backendName:"wasm",setupFunc:function(e){GY=e.wasm.cwrap("MaxPool3DGrad",null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode,l=Wm.computePool3DInfo(i.shape,o,s,1,u,c),d=n.makeOutput(i.shape,i.dtype);return GY(n.dataIdMap.get(i.dataId).id,n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(d.dataId).id,l.batchSize,l.inChannels,l.inDepth,l.inHeight,l.inWidth,l.outDepth,l.outHeight,l.outWidth,l.strideDepth,l.strideHeight,l.strideWidth,l.dilationDepth,l.dilationHeight,l.dilationWidth,l.effectiveFilterDepth,l.effectiveFilterHeight,l.effectiveFilterWidth,l.padInfo.front,l.padInfo.top,l.padInfo.left),d}};var XY,YY={kernelName:$n,backendName:"wasm",setupFunc:function(e){qY=e.wasm.cwrap("MaxPoolGrad",null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode,l=Wm.computePool2DInfo(i.shape,o,s,1,u,c),d=n.makeOutput(i.shape,i.dtype);return qY(n.dataIdMap.get(i.dataId).id,n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(d.dataId).id,l.batchSize,l.inChannels,l.inHeight,l.inWidth,l.outHeight,l.outWidth,l.strideHeight,l.strideWidth,l.dilationHeight,l.dilationWidth,l.effectiveFilterHeight,l.effectiveFilterWidth,l.padInfo.top,l.padInfo.left),d}};var ZY,JY={kernelName:nr,backendName:"wasm",setupFunc:function(e){XY=e.wasm.cwrap("MaxPoolWithArgmax",null,["number","number","number","number","boolean","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.includeBatchInIndex;Ga.assert(4===a.shape.length,(function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(a.shape.length,".")}));var c=[1,1];Ga.assert(Wm.eitherStridesOrDilationsAreOne(o,c),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides ".concat(o," and dilations '").concat(c,"'")}));var l=Wm.computePool2DInfo(a.shape,i,o,[1,1],s),d=n.makeOutput(l.outShape,a.dtype),p=n.makeOutput(l.outShape,"int32");return XY(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(d.dataId).id,n.dataIdMap.get(p.dataId).id,cK[a.dtype],u,l.batchSize,l.inChannels,l.inHeight,l.inWidth,l.outHeight,l.outWidth,l.strideHeight,l.strideWidth,l.dilationHeight,l.dilationWidth,l.effectiveFilterHeight,l.effectiveFilterWidth,l.padInfo.top,l.padInfo.left),[d,p]}};var QY,$Y={kernelName:rr,backendName:"wasm",setupFunc:function(e){ZY=e.wasm.cwrap(rr,null,["number, number, number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.axis,i=r.keepDims,o=n.x,s=t.dataIdMap.get(o.dataId).id,u=s,c=o,l=CK(o,a,t),d=l.transposed,p=l.axes,f=l.originalAxes,h=l.inputWasTransposed,m=p;if(h){var v=t.dataIdMap.get(d.dataId).id;v!==s&&(c=d,u=v,m=Wm.getInnerMostAxes(m.length,c.shape.length))}Wm.assertAxesAreInnerMostDims("mean",m,c.shape.length);var b=Wm.computeOutAndReduceShapes(c.shape,m),g=Object(y.a)(b,2),x=g[0],k=g[1],w=Ga.sizeFromShape(k),O=c;"float32"!==c.dtype&&(O=oX({backend:t,inputs:{x:c},attrs:{dtype:"float32"}}),u=t.dataIdMap.get(O.dataId).id);var I=t.makeOutput(x,"float32");if(0!==Ga.sizeFromShape(c.shape)){var S=t.dataIdMap.get(I.dataId).id;ZY(u,w,S)}if(h&&t.disposeData(d.dataId),i){var N=Wm.expandShapeToKeepDim(I.shape,f);I.shape=N}return"float32"!==c.dtype&&t.disposeData(O.dataId),I}};var eZ,tZ,nZ={kernelName:ar,backendName:"wasm",setupFunc:function(e){QY=e.wasm.cwrap(ar,null,["number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.axis,i=r.keepDims,o=n.x,s=t.dataIdMap.get(o.dataId).id,u=s,c=o,l=CK(o,a,t),d=l.transposed,p=l.axes,f=l.originalAxes,h=l.inputWasTransposed;if(h){var m=t.dataIdMap.get(d.dataId).id;m!==s&&(c=d,u=m)}var v=c.shape.length;Wm.assertAxesAreInnerMostDims("min",p,v);var b=Wm.computeOutAndReduceShapes(c.shape,p),g=Object(y.a)(b,2),x=g[0],k=g[1],w=Ga.sizeFromShape(k),O=t.makeOutput(x,c.dtype);if(0!==Ga.sizeFromShape(c.shape)){var I=t.dataIdMap.get(O.dataId).id;QY(u,cK[o.dtype],w,I)}if(h&&t.disposeData(d.dataId),i){var S=Wm.expandShapeToKeepDim(O.shape,f);O.shape=S}return O}},rZ=yK(ir);!function(e){e[e.reflect=0]="reflect",e[e.symmetric=1]="symmetric"}(eZ||(eZ={}));var aZ,iZ={kernelName:or,backendName:"wasm",kernelFunc:function(e){var t=e.inputs.x,n=e.backend,r=e.attrs,a=r.paddings,i=r.mode,o=a.map((function(e,n){return e[0]+t.shape[n]+e[1]})),s=n.dataIdMap.get(t.dataId).id,u=n.makeOutput(o,t.dtype),c=n.dataIdMap.get(u.dataId).id,l=new Uint8Array(new Int32Array(t.shape).buffer),d=a.map((function(e){return e[0]})),p=a.map((function(e){return e[1]})),f=new Uint8Array(new Int32Array(d).buffer),h=new Uint8Array(new Int32Array(p).buffer);return tZ(s,l,t.shape.length,cK[t.dtype],f,h,eZ[i],c),u},setupFunc:function(e){tZ=e.wasm.cwrap(or,null,["number","array","number","number","array","array","number","number"])}};function oZ(e){var t=e.backend,n=e.inputs.logits,r=e.attrs.dim,a=t.dataIdMap.get(n.dataId).id,i=t.makeOutput(n.shape,n.dtype),o=t.dataIdMap.get(i.dataId).id,s=n.shape[r],u=Ga.sizeFromShape(n.shape)/s;return 0===Ga.sizeFromShape(i.shape)||aZ(a,o,s,u),i}var sZ,uZ={kernelName:ea,backendName:"wasm",setupFunc:function(e){aZ=e.wasm.cwrap(ea,null,["number","number","number","number"])},kernelFunc:oZ};var cZ,lZ={kernelName:ur,backendName:"wasm",setupFunc:function(e){sZ=e.wasm.cwrap(ur,null,["number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,i=r.numSamples,o=r.seed,s=r.normalized;if("float32"!==a.dtype)throw new Error("Tensor logits must have dtype float32, got ".concat(a.dtype));var u=s?a:oZ({inputs:{logits:a},backend:n,attrs:{dim:a.shape.length-1}}),c=Object(y.a)(u.shape,2),l=c[0],d=c[1],p=n.makeOutput([l,i],"int32");return sZ(n.dataIdMap.get(u.dataId).id,l,d,i,o,n.dataIdMap.get(p.dataId).id),s||n.disposeData(u.dataId),p}},dZ=yK(sr),pZ=yK(cr),fZ=mK(lr);function hZ(e,t){var n=new Int32Array(e.wasm.HEAPU8.buffer,t,4),r=n[0],a=n[1],i=n[2],o=n[3];return e.wasm._free(t),{pSelectedIndices:r,selectedSize:a,pSelectedScores:i,pValidOutputs:o}}var mZ,vZ={kernelName:pr,backendName:"wasm",setupFunc:function(e){cZ=e.wasm.cwrap(pr,"number",["number","number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.iouThreshold,i=r.maxOutputSize,o=r.scoreThreshold,s=n.boxes,u=n.scores,c=t.dataIdMap.get(s.dataId).id,l=t.dataIdMap.get(u.dataId).id,d=hZ(t,cZ(c,l,i,a,o)),p=d.pSelectedIndices,f=d.selectedSize,h=d.pSelectedScores,m=d.pValidOutputs;return t.wasm._free(h),t.wasm._free(m),t.makeOutput([f],"int32",p)}};var bZ,gZ={kernelName:fr,backendName:"wasm",setupFunc:function(e){mZ=e.wasm.cwrap(fr,"number",["number","number","number","number","number","bool"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.iouThreshold,i=r.maxOutputSize,o=r.scoreThreshold,s=r.padToMaxOutputSize,u=n.boxes,c=n.scores,l=t.dataIdMap.get(u.dataId).id,d=t.dataIdMap.get(c.dataId).id,p=hZ(t,mZ(l,d,i,a,o,s)),f=p.pSelectedIndices,h=p.selectedSize,m=p.pSelectedScores,v=p.pValidOutputs;return t.wasm._free(m),[t.makeOutput([h],"int32",f),t.makeOutput([],"int32",v)]}};var yZ,xZ={kernelName:hr,backendName:"wasm",setupFunc:function(e){bZ=e.wasm.cwrap(hr,"number",["number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.iouThreshold,i=r.maxOutputSize,o=r.scoreThreshold,s=r.softNmsSigma,u=n.boxes,c=n.scores,l=t.dataIdMap.get(u.dataId).id,d=t.dataIdMap.get(c.dataId).id,p=hZ(t,bZ(l,d,i,a,o,s)),f=p.pSelectedIndices,h=p.selectedSize,m=p.pSelectedScores,v=p.pValidOutputs;return t.wasm._free(v),[t.makeOutput([h],"int32",f),t.makeOutput([h],"float32",m)]}},kZ=yK(dr,0,"bool");var wZ={kernelName:vr,backendName:"wasm",setupFunc:function(e){yZ=e.wasm.cwrap(vr,null,["number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=r.dtype,o=r.depth,s=r.onValue,u=r.offValue,c=n.makeOutput([].concat(Object(S.a)(a.shape),[o]),i),l=n.dataIdMap.get(c.dataId).id,d=n.dataIdMap.get(a.dataId).id;return yZ(d,o,s,u,l),c}};var OZ={kernelName:mr,backendName:"wasm",kernelFunc:function(e){var t=e.inputs.x,n=e.backend,r=n.makeOutput(t.shape,t.dtype);return n.typedArrayFromHeap(r).fill(1),r}};var IZ,SZ={kernelName:br,backendName:"wasm",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.axis;if(1===t.length)return QX({inputs:{input:t[0]},backend:n,attrs:{dim:r}});var a=t[0].shape,i=t[0].dtype;t.forEach((function(e){Ga.assertShapesMatch(a,e.shape,"All tensors passed to stack must have matching shapes"),Ga.assert(i===e.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var o=[],s=dX({inputs:t.map((function(e){var t=QX({inputs:{input:e},backend:n,attrs:{dim:r}});return o.push(t),t})),backend:n,attrs:{axis:r}});return o.forEach((function(e){return n.disposeData(e.dataId)})),s}};var NZ,jZ={kernelName:gr,backendName:"wasm",kernelFunc:function(e){var t=e.inputs.x,n=e.backend,r=e.attrs,a=r.paddings,i=r.constantValue,o=a.map((function(e,n){return e[0]+t.shape[n]+e[1]}));if(0===Ga.sizeFromShape(t.shape))return tY({backend:n,attrs:{shape:o,value:i,dtype:t.dtype}});var s=n.dataIdMap.get(t.dataId).id,u=n.makeOutput(o,t.dtype),c=n.dataIdMap.get(u.dataId).id,l=new Uint8Array(new Int32Array(t.shape).buffer),d=a.map((function(e){return e[0]})),p=a.map((function(e){return e[1]})),f=new Uint8Array(new Int32Array(d).buffer),h=new Uint8Array(new Int32Array(p).buffer);return IZ(s,l,t.shape.length,cK[t.dtype],f,h,i,c),u},setupFunc:function(e){IZ=e.wasm.cwrap(gr,null,["number","array","number","number","array","array","number","number"])}},TZ=yK(xr);var CZ,EZ={kernelName:kr,backendName:"wasm",setupFunc:function(e){NZ=e.wasm.cwrap(kr,null,["number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=t.alpha,i=n.dataIdMap.get(r.dataId).id,o=n.dataIdMap.get(a.dataId).id,s=i,u=r,c=u;"float32"!==u.dtype&&(c=oX({backend:n,inputs:{x:r},attrs:{dtype:"float32"}}),s=n.dataIdMap.get(c.dataId).id);var l=n.makeOutput(r.shape,"float32"),d=n.dataIdMap.get(l.dataId).id;return NZ(s,o,d),"float32"!==u.dtype&&n.disposeData(c.dataId),l}};var _Z,AZ={kernelName:wr,backendName:"wasm",setupFunc:function(e){CZ=e.wasm.cwrap(wr,null,["number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.axis,i=r.keepDims,o=n.x,s=t.dataIdMap.get(o.dataId).id,u=s,c=o,l=CK(o,a,t),d=l.transposed,p=l.axes,f=l.originalAxes,h=l.inputWasTransposed,m=p;if(h){var v=t.dataIdMap.get(d.dataId).id;v!==s&&(c=d,u=v,m=Wm.getInnerMostAxes(m.length,c.shape.length))}Wm.assertAxesAreInnerMostDims("prod",m,c.shape.length);var b=Wm.computeOutAndReduceShapes(c.shape,m),g=Object(y.a)(b,2),x=g[0],k=g[1],w=Ga.sizeFromShape(k),O=t.makeOutput(x,c.dtype);if(0!==Ga.sizeFromShape(c.shape)){var I=t.dataIdMap.get(O.dataId).id;CZ(u,w,cK[O.dtype],I)}if(h&&t.disposeData(d.dataId),i){var S=Wm.expandShapeToKeepDim(O.shape,f);O.shape=S}return O}},RZ={kernelName:Nr,backendName:"wasm",kernelFunc:function(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,i=n.step,o=n.dtype,s=tA(r,a,i,o),u=t.makeOutput([s.length],o);return t.typedArrayFromHeap(u).set(s),u}},DZ=yK(ln),FZ=mK(Tr),MZ=mK(Cr),zZ=mK(Fr);var LZ,PZ={kernelName:Rr,backendName:"wasm",setupFunc:function(e){_Z=e.wasm.cwrap(Rr,null,["number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t,n=e.backend,r=e.inputs,a=e.attrs,i=r.images,o=a.alignCorners,s=a.halfPixelCenters,u=a.size,c=Object(y.a)(u,2),l=c[0],d=c[1],p=Object(y.a)(i.shape,4),f=p[0],h=p[1],m=p[2],v=p[3],b=[f,l,d,v],g=n.dataIdMap.get(i.dataId);"float32"!==g.dtype&&(t=oX({backend:n,inputs:{x:i},attrs:{dtype:"float32"}}),g=n.dataIdMap.get(t.dataId));var x=g.id,k=n.makeOutput(b,"float32");if(0===Ga.sizeFromShape(i.shape))return k;var w=n.dataIdMap.get(k.dataId).id;return _Z(x,f,h,m,v,l,d,o?1:0,s?1:0,w),null!=t&&n.disposeData(t.dataId),k}};var BZ,WZ={kernelName:Dr,backendName:"wasm",setupFunc:function(e){LZ=e.wasm.cwrap(Dr,null,["number","number","number","array","array","boolean"])},kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.images,o=n.dy,s=a.alignCorners,u=r.makeOutput(i.shape,"float32"),c=r.dataIdMap.get(i.dataId);return"float32"!==c.dtype&&(t=oX({backend:r,inputs:{x:i},attrs:{dtype:"float32"}}),c=r.dataIdMap.get(t.dataId)),LZ(r.dataIdMap.get(i.dataId).id,r.dataIdMap.get(o.dataId).id,r.dataIdMap.get(u.dataId).id,new Uint8Array(new Int32Array(i.shape).buffer),new Uint8Array(new Int32Array(o.shape).buffer),s),null!=t&&r.disposeData(t.dataId),u}};var UZ,VZ={kernelName:_r,backendName:"wasm",setupFunc:function(e){BZ=e.wasm.cwrap(_r,null,["number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=n.images,i=r.alignCorners,o=r.halfPixelCenters,s=r.size,u=Object(y.a)(s,2),c=u[0],l=u[1],d=Object(y.a)(a.shape,4),p=d[0],f=d[1],h=d[2],m=d[3],v=[p,c,l,m],b=t.makeOutput(v,"float32");if(0===Ga.sizeFromShape(a.shape))return b;var g,x=t.dataIdMap.get(a.dataId);"float32"!==x.dtype&&(g=oX({backend:t,inputs:{x:a},attrs:{dtype:"float32"}}),x=t.dataIdMap.get(g.dataId));var k=x.id,w=t.dataIdMap.get(b.dataId).id;return BZ(k,p,f,h,m,c,l,i?1:0,o?1:0,w),null!=g&&t.disposeData(g.dataId),b}};var GZ,HZ={kernelName:Ar,backendName:"wasm",setupFunc:function(e){UZ=e.wasm.cwrap(Ar,null,["number","number","number","array","array","boolean"])},kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.images,o=n.dy,s=a.alignCorners,u=r.makeOutput(i.shape,"float32"),c=r.dataIdMap.get(i.dataId);return"float32"!==c.dtype&&(t=oX({backend:r,inputs:{x:i},attrs:{dtype:"float32"}}),c=r.dataIdMap.get(t.dataId)),UZ(r.dataIdMap.get(i.dataId).id,r.dataIdMap.get(o.dataId).id,r.dataIdMap.get(u.dataId).id,new Uint8Array(new Int32Array(i.shape).buffer),new Uint8Array(new Int32Array(o.shape).buffer),s),null!=t&&r.disposeData(t.dataId),u}};var qZ,KZ={kernelName:Mr,backendName:"wasm",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.dims,o=Ga.parseAxisParam(i,a.shape);if(0===a.shape.length)return OK({inputs:{x:a},backend:n});var s=n.makeOutput(a.shape,a.dtype),u=n.dataIdMap.get(a.dataId).id,c=n.dataIdMap.get(s.dataId).id,l=new Uint8Array(new Int32Array(o).buffer),d=new Uint8Array(new Int32Array(a.shape).buffer);GZ(u,l,o.length,d,a.shape.length,c);var p=YK({inputs:{x:s},attrs:{shape:a.shape},backend:n});return n.disposeData(s.dataId),p},setupFunc:function(e){GZ=e.wasm.cwrap(Mr,null,["number","array","number","array","number","number"])}};var XZ,YZ={kernelName:ja,backendName:"wasm",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.image,i=r.radians,o=r.fillValue,s=r.center,u=n.makeOutput(a.shape,a.dtype),c=n.dataIdMap.get(a.dataId).id,l=n.dataIdMap.get(u.dataId).id,d=Object(y.a)(a.shape,4),p=d[0],f=d[1],h=d[2],m=d[3],v=Wm.getImageCenter(s,f,h),b=Object(y.a)(v,2),g=b[0],x=b[1],k="number"==typeof o?[o,o,o,0===o?0:255]:[].concat(Object(S.a)(o),[255]),w=new Uint8Array(new Int32Array(k).buffer);return qZ(c,p,f,h,m,i,g,x,w,k.length,l),u},setupFunc:function(e){qZ=e.wasm.cwrap(ja,null,["number","number","number","number","number","number","number","number","array","number","number"])}},ZZ=mK(zr),JZ=mK(Lr);var QZ,$Z={kernelName:Pr,backendName:"wasm",setupFunc:function(e){XZ=e.wasm.cwrap(Pr,null,["number","number","number","number","number","number","array","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=n.indices,i=n.updates,o=r.shape,s=t.makeOutput(o,i.dtype);if(0===Ga.sizeFromShape(o))return s;var u=Op.calculateShapes(i,a,o),c=u.sliceRank,l=u.numUpdates,d=u.sliceSize,p=u.strides,f=u.outputSize,h=t.dataIdMap.get(a.dataId).id,m=t.dataIdMap.get(i.dataId).id,v=new Uint8Array(new Int32Array(p).buffer),b=t.dataIdMap.get(s.dataId).id;return XZ(h,m,cK[i.dtype],c,l,d,v,f,b),s}};var eJ,tJ={kernelName:Wr,backendName:"wasm",setupFunc:function(e){QZ=e.wasm.cwrap(Wr,null,["number","number","number","number","number","number","bool","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.sortedSequence,i=t.values,o=r.side;if(a.dtype!==i.dtype)throw new Error("SearchSorted error: sorted_sequence must have the same dtype as values. Got ".concat(a.dtype," and ").concat(i.dtype));var s=n.makeOutput(i.shape,"int32");function u(e){return n.dataIdMap.get(e.dataId).id}return QZ(u(a),u(i),a.shape[0],a.shape[1],i.shape[1],cK[a.dtype],"left"===o,u(s)),s}};var nJ,rJ={kernelName:Ur,backendName:"wasm",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.condition,a=t.t,i=t.e,o=n.dataIdMap.get(r.dataId).id,s=n.dataIdMap.get(a.dataId).id,u=n.dataIdMap.get(i.dataId).id,c=n.makeOutput(a.shape,a.dtype),l=n.dataIdMap.get(c.dataId).id,d=r.shape.length,p=a.shape.length,f=0===d||d>1||1===p?1:Ga.sizeFromShape(a.shape.slice(1));return eJ(o,s,u,f,l),c},setupFunc:function(e){eJ=e.wasm.cwrap("SelectV2",null,["number","number","number","number","number"])}},aJ=mK(Vr);var iJ={kernelName:"Sigmoid",backendName:"wasm",setupFunc:function(e){nJ=e.wasm.cwrap(Xr,null,["number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs.x,r=t.dataIdMap.get(n.dataId).id,a=t.makeOutput(n.shape,n.dtype),i=t.dataIdMap.get(a.dataId).id;return 0===Ga.sizeFromShape(a.shape)||nJ(r,i),a}},oJ=mK(Kr),sJ=mK(Hr),uJ=mK(qr),cJ=mK(Yr);var lJ,dJ={kernelName:Qr,backendName:"wasm",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.paddings,s=Ga.sizeFromShape(i),u=[[0,0]];u.push.apply(u,Object(S.a)(o));for(var c=1+i.length;c<a.shape.length;++c)u.push([0,0]);var l=jZ.kernelFunc({inputs:{x:a},backend:n,attrs:{paddings:u,constantValue:0}}),d=Wm.getReshaped(l.shape,i,s,!1),p=Wm.getPermuted(d.length,i.length,!1),f=Wm.getReshapedPermuted(l.shape,i,s,!1),h=YK({inputs:{x:l},backend:n,attrs:{shape:d}}),m=NK({inputs:{x:h},backend:n,attrs:{perm:p}}),v=YK({inputs:{x:m},backend:n,attrs:{shape:f}});return n.disposeData(l.dataId),n.disposeData(h.dataId),n.disposeData(m.dataId),v}};var pJ,fJ={kernelName:ta,backendName:"wasm",setupFunc:function(e){lJ=e.wasm.cwrap("SparseFillEmptyRows","number",["number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t,n=e.backend,r=e.inputs,a=r.indices,i=r.values,o=r.denseShape,s=r.defaultValue,u=a.shape[0],c=a.shape[1],l=n.readSync(o.dataId)[0],d=[u+l,c],p=n.dataIdMap.get(a.dataId).id,f=n.dataIdMap.get(i.dataId).id,h=n.dataIdMap.get(s.dataId).id,m=n.makeOutput(d,a.dtype),v=n.dataIdMap.get(m.dataId).id,b=n.makeOutput(d.slice(0,1),i.dtype),g=n.dataIdMap.get(b.dataId).id,y=n.makeOutput([l],"bool"),x=n.dataIdMap.get(y.dataId).id,k=n.makeOutput([u],a.dtype),w=n.dataIdMap.get(k.dataId).id,O=n.makeOutput([4],"int32"),I=n.dataIdMap.get(O.dataId).id,S=lJ(p,f,cK[i.dtype],u,l,c,h,v,g,x,w,I),N=n.readSync(O.dataId);switch(N[0]){case 1:t=Wm.getSparseFillEmptyRowsIndicesDenseShapeMismatch(N[1]);break;case 2:t=Wm.getSparseFillEmptyRowsNegativeIndexErrorMessage(N[1],N[2]);break;case 3:t=Wm.getSparseFillEmptyRowsOutOfRangeIndexErrorMessage(N[1],N[2],N[3]);break;default:t=""}if(n.disposeData(O.dataId),t)throw n.disposeData(m.dataId),n.disposeData(b.dataId),n.disposeData(y.dataId),n.disposeData(k.dataId),new Error(t);var j=m,T=b;return S!==d[0]&&(j=$K({inputs:{x:m},attrs:{begin:0,size:[S,c]},backend:n}),T=$K({inputs:{x:b},attrs:{begin:0,size:S},backend:n}),n.disposeData(m.dataId),n.disposeData(b.dataId)),[j,T,y,k]}};var hJ,mJ={kernelName:na,backendName:"wasm",setupFunc:function(e){pJ=e.wasm.cwrap(na,null,["number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=n.inputIndices,a=n.inputShape,i=n.newShape;if(2!==r.shape.length)throw new Error("Input indices should be a matrix but received shape\n        ".concat(r.shape));if(1!==a.shape.length)throw new Error("Input shape should be a vector but received shape\n        ".concat(a.shape));if(1!==i.shape.length)throw new Error("Target shape should be a vector but received shape ".concat(i.shape));var o=t.dataIdMap.get(r.dataId).id,s=t.dataIdMap.get(a.dataId).id,u=t.dataIdMap.get(i.dataId).id,c=r.shape[0],l=Ga.sizeFromShape(i.shape),d=t.makeOutput([c,l],r.dtype),p=t.dataIdMap.get(d.dataId).id,f=t.makeOutput([l],i.dtype),h=t.dataIdMap.get(f.dataId).id,m=t.makeOutput([3],"int32"),v=t.dataIdMap.get(m.dataId).id;pJ(o,s,u,c,p,h,v);var b,g=t.readSync(m.dataId);switch(g[0]){case 0:b=Wm.getSparseReshapeMultipleNegativeOneOutputDimErrorMessage(g[1],g[2]);break;case 1:b=Wm.getSparseReshapeNegativeOutputDimErrorMessage(g[1],g[2]);break;case 2:b=Wm.getSparseReshapeEmptyTensorZeroOutputDimErrorMessage();break;case 3:var y=Array.from(t.readSync(a.dataId)),x=Array.from(t.readSync(f.dataId));b=Wm.getSparseReshapeInputOutputMultipleErrorMessage(y,x);break;case 4:var k=Array.from(t.readSync(a.dataId)),w=Array.from(t.readSync(f.dataId));b=Wm.getSparseReshapeInputOutputMismatchErrorMessage(k,w);break;default:b=""}if(t.disposeData(m.dataId),b)throw t.disposeData(d.dataId),t.disposeData(f.dataId),new Error(b);return[d,f]}};function vJ(e){hJ=e.wasm.cwrap("SparseSegmentReduction",null,["number","number","number","number","number","number","number","number","number"])}function bJ(e,t){var n=e.backend,r=e.inputs,a=r.data,i=r.indices,o=r.segmentIds,s=i.shape[0],u=n.readSync(o.dataId,s-1,s)[0],c=s>0?u+1:0;if(c<0)throw new Error(Wm.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());var l=a.shape.slice();l[0]=c;var d=n.dataIdMap.get(a.dataId).id,p=n.dataIdMap.get(i.dataId).id,f=n.dataIdMap.get(o.dataId).id,h=n.makeOutput(l,a.dtype),m=n.dataIdMap.get(h.dataId).id,v=n.makeOutput([4],"int32"),b=n.dataIdMap.get(v.dataId).id;hJ(d,cK[a.dtype],a.shape[0],p,f,m,b,t,0);var g,y=n.readSync(v.dataId);switch(y[0]){case 0:g=Wm.getSparseSegmentReductionNegativeSegmentIdsErrorMessage();break;case 1:g=Wm.getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage();break;case 2:g=Wm.getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage(y[1],y[2]);break;case 3:g=Wm.getSparseSegmentReductionIndicesOutOfRangeErrorMessage(y[1],y[2],y[3]);break;default:g=""}if(n.disposeData(v.dataId),g)throw n.disposeData(h.dataId),new Error(g);return h}var gJ={kernelName:ra,backendName:"wasm",setupFunc:vJ,kernelFunc:function(e){return bJ(e,!0)}};var yJ,xJ={kernelName:aa,backendName:"wasm",setupFunc:vJ,kernelFunc:function(e){return bJ(e,!1)}};var kJ={kernelName:ia,backendName:"wasm",setupFunc:function(e){yJ=e.wasm.cwrap(ia,null,["number","number","number","number","number","number","number","number","array","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=n.sparseIndices,i=n.sparseValues,o=n.defaultValue,s=r.outputShape,u=t.makeOutput(s,o.dtype);if(0===Ga.sizeFromShape(s))return u;var c=Wm.calculateShapes(i,a,s),l=c.sliceRank,d=c.numUpdates,p=c.sliceSize,f=c.strides,h=c.outputSize,m=t.dataIdMap.get(a.dataId).id,v=t.dataIdMap.get(i.dataId).id,b=t.dataIdMap.get(o.dataId).id,g=new Uint8Array(new Int32Array(f).buffer),y=t.dataIdMap.get(u.dataId).id;return yJ(m,v,i.shape.length,b,cK[o.dtype],l,d,p,g,h,y),u}};var wJ,OJ={kernelName:$r,backendName:"wasm",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.numOrSizeSplits,o=n.axis,s=Ga.parseAxisParam(o,a.shape)[0],u=Wm.prepareSplitSize(a,i,s),c=new Array(a.shape.length).fill(0),l=a.shape.slice();return u.map((function(e){var t=Object(S.a)(l);t[s]=e;var n=$K({inputs:{x:a},attrs:{begin:c,size:t},backend:r});return c[s]+=e,n}))}},IJ=mK(Zr),SJ=mK(sa),NJ=yK(oa);var jJ,TJ={kernelName:Sa,backendName:"wasm",setupFunc:function(e){wJ=e.wasm.cwrap(Sa,null,["number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs.alpha,a=n.x,i=t.dataIdMap.get(a.dataId).id,o=t.makeOutput(a.shape,a.dtype),s=t.dataIdMap.get(o.dataId).id;return wJ(i,r,cK[a.dtype],s),o}};var CJ={kernelName:ca,backendName:"wasm",setupFunc:function(e){jJ=e.wasm.cwrap(ca,null,["number","array","number","array","array","array","array","array","number","number"])},kernelFunc:function(e){var t,n=e.backend,r=e.inputs,a=e.attrs,i=r.x,o=a.begin,s=a.end,u=a.strides,c=a.beginMask,l=a.endMask,d=a.ellipsisMask,p=a.newAxisMask,f=a.shrinkAxisMask,h=bm.sliceInfo(i.shape,o,s,u,c,l,d,p,f),m=h.finalShapeSparse,v=h.finalShape,b=h.isIdentity,g=h.sliceDim0,y=h.isSimpleSlice,x=h.begin,k=h.end,w=h.strides;if(b)t=YK({inputs:{x:i},backend:n,attrs:{shape:v}});else if(g||y){Ga.assert(i.shape.length>=1,(function(){return"Input must have rank at least 1, got: ".concat(i.shape.length)}));var O=bm.computeOutShape(x,k,w),I=$K({inputs:{x:i},backend:n,attrs:{begin:x,size:O}});t=YK({inputs:{x:I},backend:n,attrs:{shape:v}}),n.disposeData(I.dataId)}else{var S=n.makeOutput(m,"float32"),N=n.dataIdMap.get(i.dataId).id,j=new Uint8Array(new Int32Array(Ga.computeStrides(i.shape)).buffer),T=new Uint8Array(new Int32Array(x).buffer),C=new Uint8Array(new Int32Array(k).buffer),E=new Uint8Array(new Int32Array(w).buffer),_=new Uint8Array(new Int32Array(m).buffer),A=new Uint8Array(new Int32Array(Ga.computeStrides(m)).buffer),R=n.dataIdMap.get(S.dataId).id;jJ(N,j,i.shape.length,T,C,E,_,A,m.length,R),t=YK({inputs:{x:S},backend:n,attrs:{shape:v}}),n.disposeData(S.dataId)}return t}};var EJ={kernelName:la,backendName:"wasm",kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=n.data,i=n.dataSplits,o=r.separator,s=r.nGramWidths,u=r.leftPad,c=r.rightPad,l=r.padWidth,d=r.preserveShortSequences,p=NA(t.readSync(a.dataId),t.readSync(i.dataId),o,s,u,c,l,d),f=Object(y.a)(p,2),h=f[0],m=f[1],v=t.makeOutput([h.length],"string");t.dataIdMap.get(v.dataId).stringBytes=h;var b=t.makeOutput(i.shape,"int32");return t.typedArrayFromHeap(b).set(m),[v,b]}};var _J={kernelName:da,backendName:"wasm",kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=n.input,i=n.delimiter,o=r.skipEmpty,s=TA(t.readSync(a.dataId),t.readSync(i.dataId)[0],o),u=Object(y.a)(s,3),c=u[0],l=u[1],d=u[2],p=l.length,f=t.makeOutput([p,2],"int32");t.typedArrayFromHeap(f).set(c);var h=t.makeOutput([p],"string");t.dataIdMap.get(h.dataId).stringBytes=l;var m=t.makeOutput([2],"int32");return t.typedArrayFromHeap(m).set(d),[f,h,m]}};var AJ,RJ={kernelName:pa,backendName:"wasm",kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=n.input,i=r.numBuckets,o=CA(t.readSync(a.dataId),i),s=t.makeOutput(a.shape,"int32");return t.typedArrayFromHeap(s).set(o),s}},DJ=yK(fa);var FJ,MJ,zJ,LJ={kernelName:Jr,backendName:"wasm",setupFunc:function(e){AJ=e.wasm.cwrap(Jr,null,["number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.axis,i=r.keepDims,o=n.x,s=t.dataIdMap.get(o.dataId).id,u=s,c=o,l=CK(o,a,t),d=l.transposed,p=l.axes,f=l.originalAxes,h=l.inputWasTransposed,m=p;if(h){var v=t.dataIdMap.get(d.dataId).id;v!==s&&(c=d,u=v,m=Wm.getInnerMostAxes(m.length,c.shape.length))}Wm.assertAxesAreInnerMostDims("sum",m,c.shape.length);var b=Wm.computeOutAndReduceShapes(c.shape,m),g=Object(y.a)(b,2),x=g[0],k=g[1],w=Ga.sizeFromShape(k),O=t.makeOutput(x,c.dtype);if(0!==Ga.sizeFromShape(c.shape)){var I=t.dataIdMap.get(O.dataId).id;AJ(u,w,cK[O.dtype],I)}if(h&&t.disposeData(d.dataId),i){var S=Wm.expandShapeToKeepDim(O.shape,f);O.shape=S}return O}},PJ=mK(ha),BJ=mK(ma);var WJ;for(var UJ=0,VJ=[hK,vK,bK,gK,kK,wK,_K,AK,FK,MK,zK,LK,PK,BK,WK,VK,XK,HK,KK,QK,nX,rX,aX,iX,uX,cX,lX,fX,mX,bX,yX,kX,IX,SX,NX,TX,EX,AX,DX,MX,LX,BX,UX,GX,qX,KX,XX,YX,ZX,JX,$X,eY,rY,iY,oY,sY,cY,dY,fY,mY,bY,gY,yY,SK,xY,kY,wY,IY,SY,NY,TY,EY,CY,_Y,AY,RY,DY,MY,LY,BY,WY,VY,HY,KY,YY,JY,$Y,nZ,rZ,iZ,lZ,dZ,pZ,fZ,vZ,gZ,xZ,kZ,wZ,OZ,SZ,jZ,TZ,EZ,AZ,RZ,DZ,FZ,MZ,zZ,JK,PZ,WZ,VZ,HZ,KZ,YZ,ZZ,JZ,$Z,tJ,rJ,aJ,iJ,oJ,sJ,uJ,eX,uZ,cJ,dJ,fJ,mJ,gJ,xJ,kJ,OJ,IJ,SJ,NJ,TJ,CJ,EJ,_J,RJ,DJ,LJ,PJ,BJ,{kernelName:Br,backendName:"wasm",setupFunc:function(e){FJ=e.wasm.cwrap(Br,null,["number","number","number","number","number","number","array","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=n.tensor,i=n.indices,o=n.updates;Object(c.a)(r);var s=t.makeOutput(a.shape,a.dtype);if(0===Ga.sizeFromShape(a.shape))return s;var u=Op.calculateShapes(o,i,a.shape),l=u.sliceRank,d=u.numUpdates,p=u.sliceSize,f=u.strides,h=u.outputSize,m=t.dataIdMap.get(i.dataId).id,v=t.dataIdMap.get(o.dataId).id,b=t.dataIdMap.get(a.dataId).id,g=new Uint8Array(new Int32Array(f).buffer),y=t.dataIdMap.get(s.dataId).id;return FJ(m,v,cK[o.dtype],l,d,p,g,h,y,b),s}},{kernelName:va,backendName:"wasm",setupFunc:function(e){MJ=e.wasm.cwrap(va,null,["number","array","number","array","number","number"])},kernelFunc:function(e){for(var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=n.dataIdMap.get(a.dataId).id,o=r.reps,s=new Array(a.shape.length),u=0;u<s.length;u++)s[u]=a.shape[u]*o[u];var c=new Uint8Array(new Int32Array(a.shape).buffer),l=new Uint8Array(new Int32Array(s).buffer),d=n.makeOutput(s,a.dtype),p=n.dataIdMap.get(d.dataId).id;return MJ(i,c,a.shape.length,l,s.length,cK[d.dtype],p),d}},{kernelName:ba,backendName:"wasm",setupFunc:function(e){zJ=e.wasm.cwrap(ba,null,["number","array","number","number","number","bool","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.k,o=r.sorted,s=n.dataIdMap.get(a.dataId).id,u=new Uint8Array(new Int32Array(a.shape).buffer),c=a.shape.slice();c[c.length-1]=i;var l=n.makeOutput(c,a.dtype),d=n.dataIdMap.get(l.dataId).id,p=n.makeOutput(c,"int32"),f=n.dataIdMap.get(p.dataId).id;return zJ(s,u,a.shape.length,cK[a.dtype],i,o,d,f),[l,p]}},{kernelName:ga,backendName:"wasm",setupFunc:function(e){WJ=e.wasm.cwrap(ga,null,["number","number","bool","number","number","number","number","number","number","array","number","array","number","number","number","number","number"])},kernelFunc:function(e){var t,n=e.backend,r=e.inputs,a=e.attrs,i=r.image,o=r.transforms,s=a.interpolation,u=a.fillMode,c=a.fillValue,l=a.outputShape,d=Object(y.a)(i.shape,4),p=d[0],f=d[1],h=d[2],m=d[3],v=null!=l?l:[f,h],b=Object(y.a)(v,2),g=b[0],x=b[1],k=[p,g,x,m],w=new Uint8Array(new Int32Array(Ga.computeStrides(i.shape)).buffer),O=new Uint8Array(new Int32Array(Ga.computeStrides(k)).buffer),I=n.makeOutput(k,i.dtype),S=n.dataIdMap.get(I.dataId).id,N=n.dataIdMap.get(i.dataId).id,j=n.dataIdMap.get(o.dataId).id,T="nearest"===s?1:2;switch(u){case"constant":t=1;break;case"reflect":t=2;break;case"wrap":t=3;break;case"nearest":t=4;break;default:t=1}return WJ(N,j,o.shape[0]>1,p,g,x,m,h,f,w,i.shape.length-1,O,k.length-1,T,t,c,S),I}},TK,{kernelName:xa,backendName:"wasm",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=n.axis,i=t.x,o=zA(r.readSync(i.dataId),a,i.shape,i.dtype),s=o.outputValues,u=o.outputShape,c=o.indices;return[r.makeOutput(u,i.dtype,void 0,s),r.makeOutput([c.length],"int32",void 0,c)]}},{kernelName:ka,backendName:"wasm",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.value,i=r.axis;i<0&&(i+=a.shape.length);for(var o=a.shape[i],s=a.shape.length,u=new Array(s-1),c=0,l=0;l<s;l++)l!==i&&(u[c++]=a.shape[l]);var d=new Array(o),p=new Array(s).fill(0),f=a.shape.slice();f[i]=1;for(var h=0;h<d.length;h++)p[i]=h,d[h]=$K({inputs:{x:a},attrs:{begin:p,size:f},backend:n});return d.map((function(e){return{dataId:e.dataId,dtype:e.dtype,shape:u}}))}},{kernelName:Ia,backendName:"wasm",kernelFunc:function(e){var t=e.inputs.x,n=e.backend,r=n.makeOutput(t.shape,t.dtype);return n.typedArrayFromHeap(r).fill(0),r}}];UJ<VJ.length;UJ++){La(VJ[UJ])}var GJ=st();GJ.registerFlag("WASM_HAS_SIMD_SUPPORT",Object(w.a)(k.a.mark((function e(){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.abrupt("return",WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11])));case 4:return e.prev=4,e.t0=e.catch(0),e.abrupt("return",!1);case 7:case"end":return e.stop()}}),e,null,[[0,4]])})))),GJ.registerFlag("WASM_HAS_MULTITHREAD_SUPPORT",Object(w.a)(k.a.mark((function e(){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!GJ.get("IS_NODE")){e.next=2;break}return e.abrupt("return",!1);case 2:return e.prev=2,e.abrupt("return",((new MessageChannel).port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))));case 6:return e.prev=6,e.t0=e.catch(2),e.abrupt("return",!1);case 9:case"end":return e.stop()}}),e,null,[[2,6]])}))));var HJ=L(re()),qJ=L(ae()),KJ=L(ie()),XJ=HJ.default||HJ,YJ=KJ.default||KJ,ZJ=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(O.a)(this,n),(r=t.call(this)).wasm=e,r.dataIdNextNumber=1,r.wasm.tfjs.initWithThreadsCount(cQ),lQ=r.wasm.tfjs.getThreadsCount(),r.dataIdMap=new oe(Object(f.a)(r),Ds()),r}return Object(I.a)(n,[{key:"write",value:function(e,t,n){var r={id:this.dataIdNextNumber++};return this.move(r,e,t,n,1),r}},{key:"numDataIds",value:function(){return this.dataIdMap.numDataIds()}},{key:"time",value:function(){var e=Object(w.a)(k.a.mark((function e(t){var n;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Ga.now(),e.abrupt("return",(t(),{kernelMs:Ga.now()-n}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"move",value:function(e,t,n,r,a){var i=this.dataIdNextNumber++;if("string"!==r){var o=Ga.sizeFromShape(n),s=o*Ga.bytesPerElement(r),u=this.wasm._malloc(s)>>>0;this.dataIdMap.set(e,{id:i,memoryOffset:u,shape:n,dtype:r,refCount:a}),this.wasm.tfjs.registerTensor(i,o,u),null!=t&&this.wasm.HEAPU8.set(new Uint8Array(t.buffer,t.byteOffset,s),u)}else{var c=t;this.dataIdMap.set(e,{id:i,stringBytes:c,shape:n,dtype:r,memoryOffset:null,refCount:a})}}},{key:"read",value:function(){var e=Object(w.a)(k.a.mark((function e(t){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.readSync(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"readSync",value:function(e,t,n){var r=this.dataIdMap.get(e),a=r.memoryOffset,i=r.dtype,o=r.shape,s=r.stringBytes;if("string"===i)return null!=t&&0!==t||!(null==n||n>=s.length)?s.slice(t,n):s;t=t||0,n=n||Ga.sizeFromShape(o);var u=Ga.bytesPerElement(i);return function(e,t){switch(t){case"float32":return new Float32Array(e);case"int32":return new Int32Array(e);case"bool":return new Uint8Array(e);default:throw new Error("Unknown dtype ".concat(t))}}(this.wasm.HEAPU8.slice(a+t*u,a+n*u).buffer,i)}},{key:"disposeData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.dataIdMap.has(e)){var n=this.dataIdMap.get(e);if(n.refCount--,!t&&n.refCount>0)return!1;this.wasm._free(n.memoryOffset),this.wasm.tfjs.disposeData(n.id),this.dataIdMap.delete(e)}return!0}},{key:"refCount",value:function(e){return this.dataIdMap.has(e)?this.dataIdMap.get(e).refCount:0}},{key:"incRef",value:function(e){var t=this.dataIdMap.get(e);null!=t&&t.refCount++}},{key:"floatPrecision",value:function(){return 32}},{key:"getMemoryOffset",value:function(e){return this.dataIdMap.get(e).memoryOffset}},{key:"dispose",value:function(){this.wasm.tfjs.dispose(),"PThread"in this.wasm&&this.wasm.PThread.terminateAllThreads(),this.wasm=null}},{key:"memory",value:function(){return{unreliable:!1}}},{key:"makeOutput",value:function(e,t,n,r){var a;if(null==n)a=this.write(null!=r?r:null,e,t);else{var i=this.dataIdNextNumber++;a={id:i},this.dataIdMap.set(a,{id:i,memoryOffset:n,shape:e,dtype:t,refCount:1});var o=Ga.sizeFromShape(e);this.wasm.tfjs.registerTensor(i,o,n)}return{dataId:a,shape:e,dtype:t}}},{key:"typedArrayFromHeap",value:function(e){var t=e.shape,n=e.dtype,r=e.dataId,a=this.wasm.HEAPU8.buffer,i=this.dataIdMap.get(r).memoryOffset,o=Ga.sizeFromShape(t);switch(n){case"float32":return new Float32Array(a,i,o);case"int32":return new Int32Array(a,i,o);case"bool":return new Uint8Array(a,i,o);default:throw new Error("Unknown dtype ".concat(n))}}}]),n}(se);function JJ(e){return function(t,n){return Ga.fetch(e,{credentials:"same-origin"}).then((function(r){r.ok||t.env.a("failed to load wasm binary file at '".concat(e,"'")),r.arrayBuffer().then((function(e){WebAssembly.instantiate(e,t).then((function(e){n(e.instance,e.module)}))}))})),{}}}function QJ(e,t,n){if(null!=nQ)return nQ;var r="tfjs-backend-wasm.wasm";return e&&t?r="tfjs-backend-wasm-threaded-simd.wasm":e&&(r="tfjs-backend-wasm-simd.wasm"),null!=aQ&&null!=aQ[r]?aQ[r]:n+r}function $J(){return eQ.apply(this,arguments)}function eQ(){return(eQ=Object(w.a)(k.a.mark((function e(){var t,n,r,a;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([st().getAsync("WASM_HAS_SIMD_SUPPORT"),st().getAsync("WASM_HAS_MULTITHREAD_SUPPORT")]);case 2:return t=e.sent,n=Object(y.a)(t,2),r=n[0],a=n[1],e.abrupt("return",new Promise((function(e,t){var n={locateFile:function(e,t){if(e.endsWith(".worker.js")){var n=qJ.wasmWorkerContents.replace(/\n/g,"\\n"),i=new Blob([n],{type:"application/javascript"});return URL.createObjectURL(i)}return e.endsWith(".wasm")?QJ(r,a,null!=rQ?rQ:t):t+e}};oQ&&(n.instantiateWasm=JJ(QJ(r,a,null!=rQ?rQ:"")));var i,o=!1;n.onAbort=function(){o||iQ||(iQ=!0,t({message:"Make sure the server can serve the `.wasm` file relative to the bundled js file. For more details see https://github.com/tensorflow/tfjs/blob/master/tfjs-backend-wasm/README.md#using-bundlers"}))},a&&r&&null==nQ?(n.mainScriptUrlOrBlob=new Blob(["var WasmBackendModuleThreadedSimd = "+XJ.toString()],{type:"text/javascript"}),i=XJ(n)):i=YJ(n),i.then((function(t){o=!0,iQ=!1;t.tfjs={init:t.cwrap("init",null,[]),initWithThreadsCount:t.cwrap("init_with_threads_count",null,["number"]),getThreadsCount:t.cwrap("get_threads_count","number",[]),registerTensor:t.cwrap("register_tensor",null,["number","number","number"]),disposeData:t.cwrap("dispose_data",null,["number"]),dispose:t.cwrap("dispose",null,[])},e({wasm:t})})).catch(t)})));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var tQ=["tfjs-backend-wasm.wasm","tfjs-backend-wasm-simd.wasm","tfjs-backend-wasm-threaded-simd.wasm"],nQ=null,rQ=null,aQ={},iQ=!1,oQ=!1;function sQ(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(As("setWasmPath has been deprecated in favor of setWasmPaths and will be removed in a future release."),iQ)throw new Error("The WASM backend was already initialized. Make sure you call `setWasmPath()` before you call `tf.setBackend()` or `tf.ready()`");nQ=e,oQ=t}function uQ(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(iQ)throw new Error("The WASM backend was already initialized. Make sure you call `setWasmPaths()` before you call `tf.setBackend()` or `tf.ready()`");if("string"==typeof e)rQ=e;else{aQ=e;var n=tQ.filter((function(e){return null==aQ[e]}));if(n.length>0)throw new Error("There were no entries found for the following binaries: ".concat(n.join(","),". Please either call setWasmPaths with a map providing a path for each binary, or with a string indicating the directory where all the binaries can be found."))}oQ=t}var cQ=-1,lQ=-1;function dQ(e){cQ=e}function pQ(){if(-1===lQ)throw new Error("WASM backend not initialized.");return lQ}var fQ="4.7.0";Ks("wasm",Object(w.a)(k.a.mark((function e(){var t,n;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$J();case 2:return t=e.sent,n=t.wasm,e.abrupt("return",new ZJ(n));case 5:case"end":return e.stop()}}),e)}))),2);var hQ={tfjs:"4.7.0","tfjs-core":"4.7.0","tfjs-converter":"4.7.0","tfjs-backend-cpu":"4.7.0","tfjs-backend-webgl":"4.7.0","tfjs-backend-wasm":"4.7.0"},mQ={};function vQ(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e.beginPath(),t.slice(1).forEach((function(n,r){var a=n.x,i=n.y,o=t[r];e.moveTo(o.x,o.y),e.lineTo(a,i)})),n){var r=t[t.length-1],a=t[0];if(!r||!a)return;e.moveTo(r.x,r.y),e.lineTo(a.x,a.y)}e.stroke()}C(mQ,{AnchorPosition:function(){return s$},DrawBox:function(){return d$},DrawBoxOptions:function(){return l$},DrawFaceLandmarks:function(){return m0},DrawFaceLandmarksOptions:function(){return h0},DrawTextField:function(){return c$},DrawTextFieldOptions:function(){return u$},drawContour:function(){return vQ},drawDetections:function(){return p$},drawFaceExpressions:function(){return d0},drawFaceLandmarks:function(){return v0}});C({},{computeReshapedDimensions:function(){return jQ},getCenterPoint:function(){return TQ},isDimensions:function(){return NQ},isEven:function(){return IQ},isFloat:function(){return OQ},isTensor:function(){return gQ},isTensor1D:function(){return yQ},isTensor2D:function(){return xQ},isTensor3D:function(){return kQ},isTensor4D:function(){return wQ},isValidNumber:function(){return EQ},isValidProbablitiy:function(){return _Q},range:function(){return CQ},round:function(){return SQ}});var bQ=function(){function e(t,n){if(Object(O.a)(this,e),!EQ(t)||!EQ(n))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have ".concat(JSON.stringify({width:t,height:n})));this._width=t,this._height=n}return Object(I.a)(e,[{key:"reverse",value:function(){return new e(1/this.width,1/this.height)}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}}]),e}();function gQ(e,t){return e instanceof Ti&&e.shape.length===t}function yQ(e){return gQ(e,1)}function xQ(e){return gQ(e,2)}function kQ(e){return gQ(e,3)}function wQ(e){return gQ(e,4)}function OQ(e){return e%1!==0}function IQ(e){return e%2===0}function SQ(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=Math.pow(10,t);return Math.floor(e*n)/n}function NQ(e){return e&&e.width&&e.height}function jQ(e,t){var n=e.width,r=e.height,a=t/Math.max(r,n);return new bQ(Math.round(n*a),Math.round(r*a))}function TQ(e){return e.reduce((function(e,t){return e.add(t)}),new AQ(0,0)).div(new AQ(e.length,e.length))}function CQ(e,t,n){return Array(e).fill(0).map((function(e,r){return t+r*n}))}function EQ(e){return!!e&&e!==1/0&&e!==-1/0&&!Number.isNaN(e)||0===e}function _Q(e){return EQ(e)&&e>=0&&e<=1}var AQ=function(){function e(t,n){Object(O.a)(this,e),this._x=t,this._y=n}return Object(I.a)(e,[{key:"add",value:function(t){return new e(this.x+t.x,this.y+t.y)}},{key:"sub",value:function(t){return new e(this.x-t.x,this.y-t.y)}},{key:"mul",value:function(t){return new e(this.x*t.x,this.y*t.y)}},{key:"div",value:function(t){return new e(this.x/t.x,this.y/t.y)}},{key:"abs",value:function(){return new e(Math.abs(this.x),Math.abs(this.y))}},{key:"magnitude",value:function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))}},{key:"floor",value:function(){return new e(Math.floor(this.x),Math.floor(this.y))}},{key:"x",get:function(){return this._x}},{key:"y",get:function(){return this._y}}]),e}(),RQ=function(){function e(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];Object(O.a)(this,e);var r=t||{},a=[r.left,r.top,r.right,r.bottom].every(EQ),i=[r.x,r.y,r.width,r.height].every(EQ);if(!i&&!a)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have ".concat(JSON.stringify(r)));var o=i?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top],s=Object(y.a)(o,4),u=s[0],c=s[1],l=s[2],d=s[3];e.assertIsValidBox({x:u,y:c,width:l,height:d},"Box.constructor",n),this._x=u,this._y=c,this._width=l,this._height=d}return Object(I.a)(e,null,[{key:"isRect",value:function(e){return!!e&&[e.x,e.y,e.width,e.height].every(EQ)}},{key:"assertIsValidBox",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!e.isRect(t))throw new Error("".concat(n," - invalid box: ").concat(JSON.stringify(t),", expected object with properties x, y, width, height"));if(!r&&(t.width<0||t.height<0))throw new Error("".concat(n," - width (").concat(t.width,") and height (").concat(t.height,") must be positive numbers"))}}]),Object(I.a)(e,[{key:"round",value:function(){var t=[this.x,this.y,this.width,this.height].map((function(e){return Math.round(e)})),n=Object(y.a)(t,4);return new e({x:n[0],y:n[1],width:n[2],height:n[3]})}},{key:"floor",value:function(){var t=[this.x,this.y,this.width,this.height].map((function(e){return Math.floor(e)})),n=Object(y.a)(t,4);return new e({x:n[0],y:n[1],width:n[2],height:n[3]})}},{key:"toSquare",value:function(){var t=this.x,n=this.y,r=this.width,a=this.height,i=Math.abs(r-a);return r<a&&(t-=i/2,r+=i),a<r&&(n-=i/2,a+=i),new e({x:t,y:n,width:r,height:a})}},{key:"rescale",value:function(t){var n=NQ(t)?t.width:t,r=NQ(t)?t.height:t;return new e({x:this.x*n,y:this.y*r,width:this.width*n,height:this.height*r})}},{key:"pad",value:function(t,n){return new e({x:this.x-t/2,y:this.y-n/2,width:this.width+t,height:this.height+n})}},{key:"clipAtImageBorders",value:function(t,n){var r=this.x,a=this.y,i=this.right,o=this.bottom,s=Math.max(r,0),u=Math.max(a,0),c=i-s,l=o-u;return new e({x:s,y:u,width:Math.min(c,t-s),height:Math.min(l,n-u)}).floor()}},{key:"shift",value:function(t,n){var r=this.width,a=this.height;return new e({x:this.x+t,y:this.y+n,width:r,height:a})}},{key:"padAtBorders",value:function(e,t){var n=this.width+1,r=this.height+1,a=n,i=r,o=this.left,s=this.top,u=this.right,c=this.bottom;return u>t&&(a=-u+t+n,u=t),c>e&&(i=-c+e+r,c=e),o<1&&(i=2-o,o=1),s<1&&(i=2-s,s=1),{dy:1,edy:i,dx:1,edx:a,y:s,ey:c,x:o,ex:u,w:n,h:r}}},{key:"calibrate",value:function(t){return new e({left:this.left+t.left*this.width,top:this.top+t.top*this.height,right:this.right+t.right*this.width,bottom:this.bottom+t.bottom*this.height}).toSquare().round()}},{key:"x",get:function(){return this._x}},{key:"y",get:function(){return this._y}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"left",get:function(){return this.x}},{key:"top",get:function(){return this.y}},{key:"right",get:function(){return this.x+this.width}},{key:"bottom",get:function(){return this.y+this.height}},{key:"area",get:function(){return this.width*this.height}},{key:"topLeft",get:function(){return new AQ(this.left,this.top)}},{key:"topRight",get:function(){return new AQ(this.right,this.top)}},{key:"bottomLeft",get:function(){return new AQ(this.left,this.bottom)}},{key:"bottomRight",get:function(){return new AQ(this.right,this.bottom)}}]),e}(),DQ=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e,r,a,i){var o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return Object(O.a)(this,n),t.call(this,{left:e,top:r,right:a,bottom:i},o)}return n}(RQ),FQ=function(){function e(t,n,r,a,i){Object(O.a)(this,e),this._imageDims=new bQ(i.width,i.height),this._score=t,this._classScore=n,this._className=r,this._box=new RQ(a).rescale(this._imageDims)}return Object(I.a)(e,[{key:"forSize",value:function(t,n){return new e(this.score,this.classScore,this.className,this.relativeBox,{width:t,height:n})}},{key:"score",get:function(){return this._score}},{key:"classScore",get:function(){return this._classScore}},{key:"className",get:function(){return this._className}},{key:"box",get:function(){return this._box}},{key:"imageDims",get:function(){return this._imageDims}},{key:"imageWidth",get:function(){return this.imageDims.width}},{key:"imageHeight",get:function(){return this.imageDims.height}},{key:"relativeBox",get:function(){return new RQ(this._box).rescale(this.imageDims.reverse())}}]),e}(),MQ=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e,r,a){return Object(O.a)(this,n),t.call(this,e,e,"",r,a)}return Object(I.a)(n,[{key:"forSize",value:function(e,t){var r=Object(d.a)(Object(p.a)(n.prototype),"forSize",this).call(this,e,t);return new n(r.score,r.relativeBox,r.imageDims)}}]),n}(FQ);function zQ(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=Math.max(0,Math.min(e.right,t.right)-Math.max(e.left,t.left)),a=Math.max(0,Math.min(e.bottom,t.bottom)-Math.max(e.top,t.top)),i=r*a;return n?i/(e.area+t.area-i):i/Math.min(e.area,t.area)}function LQ(e,t,n){for(var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=t.map((function(e,t){return{score:e,boxIndex:t}})).sort((function(e,t){return e.score-t.score})).map((function(e){return e.boxIndex})),i=[],o=function(){var t=a.pop();i.push(t);for(var o=a,s=[],u=0;u<o.length;u++){var c=o[u],l=e[t],d=e[c];s.push(zQ(l,d,r))}a=a.filter((function(e,t){return s[t]<=n}))};a.length>0;)o();return i}function PQ(e,t){return zs((function(){var n=Object(y.a)(t,3),r=n[0],a=n[1],i=n[2],o=Zu([].concat(Object(S.a)(e.shape.slice(0,3)),[1]),r,"float32"),s=Zu([].concat(Object(S.a)(e.shape.slice(0,3)),[1]),a,"float32"),u=Zu([].concat(Object(S.a)(e.shape.slice(0,3)),[1]),i,"float32"),c=Ru([o,s,u],3);return Sl(e,c)}))}function BQ(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return zs((function(){var n=e.shape.slice(1),r=Object(y.a)(n,2),a=r[0],i=r[1];if(a===i)return e;var o=Math.abs(a-i),s=Math.round(o*(t?.5:1)),u=a>i?2:1,c=function(t){var n=e.shape.slice();return n[u]=t,Zu(n,0,"float32")},l=c(s),d=o-l.shape[u],p=[t&&d?c(d):null,e,l].filter((function(e){return!!e})).map((function(e){return Ns(e,"float32")}));return Ru(p,u)}))}function WQ(e){return 1/(1+Math.exp(-e))}var UQ,VQ=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e,r,a,i){var o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return Object(O.a)(this,n),t.call(this,{x:e,y:r,width:a,height:i},o)}return n}(RQ),GQ=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new AQ(0,0);Object(O.a)(this,e);var a=n.width,i=n.height;this._imgDims=new bQ(a,i),this._shift=r,this._positions=t.map((function(e){return e.mul(new AQ(a,i)).add(r)}))}return Object(I.a)(e,[{key:"forSize",value:function(e,t){return new this.constructor(this.relativePositions,{width:e,height:t})}},{key:"shiftBy",value:function(e,t){return new this.constructor(this.relativePositions,this._imgDims,new AQ(e,t))}},{key:"shiftByPoint",value:function(e){return this.shiftBy(e.x,e.y)}},{key:"align",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e){var n=e instanceof MQ?e.box.floor():new RQ(e);return this.shiftBy(n.x,n.y).align(null,t)}var r=Object(u.a)({useDlibAlignment:!1,minBoxPadding:.2},t),a=r.useDlibAlignment,i=r.minBoxPadding;return a?this.alignDlib():this.alignMinBbox(i)}},{key:"alignDlib",value:function(){var e=this.getRefPointsForAlignment(),t=Object(y.a)(e,3),n=t[0],r=t[1],a=t[2],i=function(e){return a.sub(e).magnitude()},o=(i(n)+i(r))/2,s=Math.floor(o/.45),u=TQ(e),c=Math.floor(Math.max(0,u.x-.5*s)),l=Math.floor(Math.max(0,u.y-.43*s));return new VQ(c,l,Math.min(s,this.imageWidth+c),Math.min(s,this.imageHeight+l))}},{key:"alignMinBbox",value:function(e){var t=function(e){var t=e.map((function(e){return e.x})),n=e.map((function(e){return e.y})),r=t.reduce((function(e,t){return t<e?t:e}),1/0),a=n.reduce((function(e,t){return t<e?t:e}),1/0),i=t.reduce((function(e,t){return e<t?t:e}),0),o=n.reduce((function(e,t){return e<t?t:e}),0);return new DQ(r,a,i,o)}(this.positions);return t.pad(t.width*e,t.height*e)}},{key:"getRefPointsForAlignment",value:function(){throw new Error("getRefPointsForAlignment not implemented by base class")}},{key:"shift",get:function(){return new AQ(this._shift.x,this._shift.y)}},{key:"imageWidth",get:function(){return this._imgDims.width}},{key:"imageHeight",get:function(){return this._imgDims.height}},{key:"positions",get:function(){return this._positions}},{key:"relativePositions",get:function(){var e=this;return this._positions.map((function(t){return t.sub(e._shift).div(new AQ(e.imageWidth,e.imageHeight))}))}}]),e}(),HQ=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){return Object(O.a)(this,n),t.apply(this,arguments)}return Object(I.a)(n,[{key:"getJawOutline",value:function(){return this.positions.slice(0,17)}},{key:"getLeftEyeBrow",value:function(){return this.positions.slice(17,22)}},{key:"getRightEyeBrow",value:function(){return this.positions.slice(22,27)}},{key:"getNose",value:function(){return this.positions.slice(27,36)}},{key:"getLeftEye",value:function(){return this.positions.slice(36,42)}},{key:"getRightEye",value:function(){return this.positions.slice(42,48)}},{key:"getMouth",value:function(){return this.positions.slice(48,68)}},{key:"getRefPointsForAlignment",value:function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(TQ)}}]),n}(GQ),qQ=function(){function e(t,n){Object(O.a)(this,e),this._label=t,this._distance=n}return Object(I.a)(e,[{key:"toString",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return"".concat(this.label).concat(e?" (".concat(SQ(this.distance),")"):"")}},{key:"label",get:function(){return this._label}},{key:"distance",get:function(){return this._distance}}]),e}(),KQ=function(){function e(t,n){if(Object(O.a)(this,e),"string"!=typeof t)throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(n)||n.some((function(e){return!(e instanceof Float32Array)})))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=t,this._descriptors=n}return Object(I.a)(e,[{key:"toJSON",value:function(){return{label:this.label,descriptors:this.descriptors.map((function(e){return Array.from(e)}))}}},{key:"label",get:function(){return this._label}},{key:"descriptors",get:function(){return this._descriptors}}],[{key:"fromJSON",value:function(t){var n=t.descriptors.map((function(e){return new Float32Array(e)}));return new e(t.label,n)}}]),e}();function XQ(e){return e.detection instanceof MQ}function YQ(e,t){return Object(u.a)(Object(u.a)({},e),{detection:t})}function ZQ(){var e=window.fetch;if(!e)throw new Error("fetch - missing fetch implementation for browser environment");return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D:CanvasRenderingContext2D,Image:HTMLImageElement,ImageData:ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},createVideoElement:function(){return document.createElement("video")},fetch:e,readFile:function(){throw new Error("readFile - filesystem not available for browser environment")}}}function JQ(){return"object"==typeof i&&"undefined"!=typeof r&&null!=r.versions&&null!=r.versions.node}function QQ(e){var t="";if(!e&&JQ())try{e=T("fs")}catch(n){t=n.toString()}return{readFile:e?function(t){return new Promise((function(n,r){e.readFile(t,(function(e,t){return e?r(e):n(t)}))}))}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: ".concat(t))}}}function $Q(){var e=i.Canvas||i.HTMLCanvasElement,t=i.Image||i.HTMLImageElement,n=i.Video||i.HTMLVideoElement,r=i.fetch,a=QQ();return Object(u.a)({Canvas:e||function(){return function e(){Object(O.a)(this,e)}}(),CanvasRenderingContext2D:i.CanvasRenderingContext2D||function(){return function e(){Object(O.a)(this,e)}}(),Image:t||function(){return function e(){Object(O.a)(this,e)}}(),ImageData:i.ImageData||function(){return function e(){Object(O.a)(this,e)}}(),Video:i.HTMLVideoElement||function(){return function e(){Object(O.a)(this,e)}}(),createCanvasElement:function(){if(e)return new e;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},createImageElement:function(){if(t)return new t;throw new Error("createImageElement - missing Image implementation for nodejs environment")},createVideoElement:function(){if(n)return new n;throw new Error("createVideoElement - missing Video implementation for nodejs environment")},fetch:r},a)}function e$(){return"object"==typeof window&&"undefined"!=typeof document&&"undefined"!=typeof HTMLImageElement&&"undefined"!=typeof HTMLCanvasElement&&"undefined"!=typeof HTMLVideoElement&&"undefined"!=typeof ImageData&&"undefined"!=typeof CanvasRenderingContext2D}function t$(e){UQ=e}function n$(){return e$()?t$(ZQ()):JQ()?t$($Q()):null}var r$={getEnv:function(){if(!UQ)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return UQ},setEnv:t$,initialize:n$,createBrowserEnv:ZQ,createFileSystem:QQ,createNodejsEnv:$Q,monkeyPatch:function(e){if(UQ||n$(),!UQ)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var t=e.Canvas,n=void 0===t?UQ.Canvas:t,r=e.Image,a=void 0===r?UQ.Image:r;UQ.Canvas=n,UQ.Image=a,UQ.createCanvasElement=e.createCanvasElement||function(){return new n},UQ.createImageElement=e.createImageElement||function(){return new a},UQ.ImageData=e.ImageData||UQ.ImageData,UQ.Video=e.Video||UQ.Video,UQ.fetch=e.fetch||UQ.fetch,UQ.readFile=e.readFile||UQ.readFile},isBrowser:e$,isNodejs:JQ};function a$(e){return r$.isNodejs()||"string"!=typeof e?e:document.getElementById(e)}function i$(e){var t=r$.getEnv(),n=t.Canvas;if(e instanceof t.CanvasRenderingContext2D)return e;var r=a$(e);if(!(r instanceof n))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var a=r.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("resolveContext2d - canvas 2d context is null");return a}n$();var o$,s$=((o$=s$||{}).TOP_LEFT="TOP_LEFT",o$.TOP_RIGHT="TOP_RIGHT",o$.BOTTOM_LEFT="BOTTOM_LEFT",o$.BOTTOM_RIGHT="BOTTOM_RIGHT",o$),u$=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(O.a)(this,e);var n=t.anchorPosition,r=t.backgroundColor,a=t.fontColor,i=t.fontSize,o=t.fontStyle,s=t.padding;this.anchorPosition=n||"TOP_LEFT",this.backgroundColor=r||"rgba(0, 0, 0, 0.5)",this.fontColor=a||"rgba(255, 255, 255, 1)",this.fontSize=i||14,this.fontStyle=o||"Georgia",this.padding=s||4},c$=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object(O.a)(this,e),this.text="string"==typeof t?[t]:t instanceof e?t.text:t,this.anchor=n,this.options=new u$(r)}return Object(I.a)(e,[{key:"measureWidth",value:function(e){var t=this.options.padding;return this.text.map((function(t){return e.measureText(t).width})).reduce((function(e,t){return e<t?t:e}),0)+2*t}},{key:"measureHeight",value:function(){var e=this.options,t=e.fontSize,n=e.padding;return this.text.length*t+2*n}},{key:"getUpperLeft",value:function(e,t){var n=this.options.anchorPosition,r="BOTTOM_RIGHT"===n||"TOP_RIGHT"===n,a="BOTTOM_LEFT"===n||"BOTTOM_RIGHT"===n,i=this.measureWidth(e),o=this.measureHeight(),s=r?this.anchor.x-i:this.anchor.x,u=a?this.anchor.y-o:this.anchor.y;if(t){var c=t.width,l=t.height;return{x:Math.max(Math.min(s,c-i),0),y:Math.max(Math.min(u,l-o),0)}}return{x:s,y:u}}},{key:"draw",value:function(e){var t=a$(e),n=i$(t),r=this.options,a=r.backgroundColor,i=r.fontColor,o=r.fontSize,s=r.fontStyle,u=r.padding;n.font="".concat(o,"px ").concat(s);var c=this.measureWidth(n),l=this.measureHeight();n.fillStyle=a;var d=this.getUpperLeft(n,t);n.fillRect(d.x,d.y,c,l),n.fillStyle=i,this.text.forEach((function(e,t){var r=u+d.x,a=u+d.y+(t+1)*o;n.fillText(e,r,a)}))}}]),e}(),l$=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(O.a)(this,e);var n=t.boxColor,r=t.lineWidth,a=t.label,i=t.drawLabelOptions;this.boxColor=n||"rgba(0, 0, 255, 1)",this.lineWidth=r||2,this.label=a;var o={anchorPosition:"BOTTOM_LEFT",backgroundColor:this.boxColor};this.drawLabelOptions=new u$(Object(u.a)(Object(u.a)({},o),i))},d$=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(O.a)(this,e),this.box=new RQ(t),this.options=new l$(n)}return Object(I.a)(e,[{key:"draw",value:function(e){var t=i$(e),n=this.options,r=n.boxColor,a=n.lineWidth,i=this.box,o=i.x,s=i.y,u=i.width,c=i.height;t.strokeStyle=r,t.lineWidth=a,t.strokeRect(o,s,u,c);var l=this.options.label;l&&new c$([l],{x:o-a/2,y:s},this.options.drawLabelOptions).draw(e)}}]),e}();function p$(e,t){(Array.isArray(t)?t:[t]).forEach((function(t){var n=t instanceof MQ?t.score:XQ(t)?t.detection.score:void 0,r=t instanceof MQ?t.box:XQ(t)?t.detection.box:new RQ(t),a=n?"".concat(SQ(n)):void 0;new d$(r,{label:a}).draw(e)}))}function f$(e){var t=r$.getEnv(),n=t.Image,r=t.Video;return e instanceof n&&e.complete||e instanceof r&&e.readyState>=3}function h$(e){return new Promise((function(t,n){function r(e){e.currentTarget&&(e.currentTarget.removeEventListener("load",a),e.currentTarget.removeEventListener("error",r),n(e))}function a(e){e.currentTarget&&(e.currentTarget.removeEventListener("load",a),e.currentTarget.removeEventListener("error",r),t(e))}(e instanceof r$.getEnv().Canvas||f$(e))&&t(null),e.addEventListener("load",a),e.addEventListener("error",r)}))}function m$(e){return new Promise((function(t,n){e instanceof Blob||n(new Error("bufferToImage - expected buf to be of type: Blob"));var r=new FileReader;r.onload=function(){"string"!=typeof r.result&&n(new Error("bufferToImage - expected reader.result to be a string, in onload"));var e=r$.getEnv().createImageElement();e.onload=function(){return t(e)},e.onerror=n,e.src=r.result},r.onerror=n,r.readAsDataURL(e)}))}function v$(e){var t=r$.getEnv(),n=t.Image,r=t.Video;return e instanceof n?new bQ(e.naturalWidth,e.naturalHeight):e instanceof r?new bQ(e.videoWidth,e.videoHeight):new bQ(e.width,e.height)}function b$(e){var t=e.width,n=e.height,r=(0,r$.getEnv().createCanvasElement)();return r.width=t,r.height=n,r}function g$(e,t){var n=r$.getEnv().ImageData;if(!(e instanceof n)&&!f$(e))throw new Error("createCanvasFromMedia - media has not finished loading yet");var r=t||v$(e),a=r.width,i=r.height,o=b$({width:a,height:i});return e instanceof n?i$(o).putImageData(e,0,0):i$(o).drawImage(e,0,0,a,i),o}function y$(e,t){return x$.apply(this,arguments)}function x$(){return(x$=Object(w.a)(k.a.mark((function e(t,n){var r,a,i,o,s,u,c;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n||r$.getEnv().createCanvasElement(),a=t.shape.slice(wQ(t)?1:0),i=Object(y.a)(a,3),o=i[0],s=i[1],u=i[2],c=zs((function(){return t.as3D(o,s,u).toInt()})),e.next=3,rm.toPixels(c,r);case 3:return c.dispose(),e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k$(e){var t=r$.getEnv(),n=t.Image,r=t.Canvas,a=t.Video;return e instanceof n||e instanceof r||e instanceof a}function w$(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=r$.getEnv(),a=r.Image,i=r.Canvas;if(!(e instanceof a||e instanceof i))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");if(t<=0)return b$({width:1,height:1});var o=v$(e),s=t/Math.max(o.height,o.width),u=s*o.width,c=s*o.height,l=b$({width:t,height:t}),d=e instanceof i?e:g$(e),p=Math.abs(u-c)/2,f=n&&u<c?p:0,h=n&&c<u?p:0;return d.width>0&&d.height>0&&i$(l).drawImage(d,f,h,u,c),l}var O$=function(){function e(t){var n=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(Object(O.a)(this,e),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],this._inputSize=0,!Array.isArray(t))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have ".concat(t));this._treatAsBatchInput=r,this._batchSize=t.length,t.forEach((function(e,t){if(kQ(e))return n._imageTensors[t]=e,void(n._inputDimensions[t]=e.shape);if(wQ(e)){var r=e.shape[0];if(1!==r)throw new Error("NetInput - tf.Tensor4D with batchSize ".concat(r," passed, but not supported in input array"));return n._imageTensors[t]=e,void(n._inputDimensions[t]=e.shape.slice(1))}var a=e instanceof r$.getEnv().Canvas?e:g$(e);n._canvases[t]=a,n._inputDimensions[t]=[a.height,a.width,3]}))}return Object(I.a)(e,[{key:"getInput",value:function(e){return this.canvases[e]||this.imageTensors[e]}},{key:"getInputDimensions",value:function(e){return this._inputDimensions[e]}},{key:"getInputHeight",value:function(e){return this._inputDimensions[e][0]}},{key:"getInputWidth",value:function(e){return this._inputDimensions[e][1]}},{key:"getReshapedInputDimensions",value:function(e){if("number"!=typeof this.inputSize)throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");return jQ({width:this.getInputWidth(e),height:this.getInputHeight(e)},this.inputSize)}},{key:"toBatchTensor",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._inputSize=e,zs((function(){var r=CQ(t.batchSize,0,1).map((function(r){var a=t.getInput(r);if(a instanceof Ti){var i=wQ(a)?a:Zc(a);return((i=BQ(i,n)).shape[1]!==e||i.shape[2]!==e)&&(i=fh.resizeBilinear(i,[e,e],!1,!1)),i.as3D(e,e,3)}if(a instanceof r$.getEnv().Canvas)return rm.fromPixels(w$(a,e,n));throw new Error("toBatchTensor - at batchIdx ".concat(r,", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have ").concat(a))}));return fp(r.map((function(e){return Ns(e,"float32")}))).as4D(t.batchSize,e,e,3)}))}},{key:"imageTensors",get:function(){return this._imageTensors}},{key:"canvases",get:function(){return this._canvases}},{key:"isBatchInput",get:function(){return this.batchSize>1||this._treatAsBatchInput}},{key:"batchSize",get:function(){return this._batchSize}},{key:"inputDimensions",get:function(){return this._inputDimensions}},{key:"inputSize",get:function(){return this._inputSize}},{key:"reshapedInputDimensions",get:function(){var e=this;return CQ(this.batchSize,0,1).map((function(t,n){return e.getReshapedInputDimensions(n)}))}}]),e}();function I$(e){return S$.apply(this,arguments)}function S$(){return(S$=Object(w.a)(k.a.mark((function e(t){var n,r,a;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t instanceof O$)){e.next=2;break}return e.abrupt("return",t);case 2:if((n=Array.isArray(t)?t:[t]).length){e.next=5;break}throw new Error("toNetInput - empty array passed as input");case 5:return r=function(e){return Array.isArray(t)?" at input index ".concat(e,":"):""},(a=n.map(a$)).forEach((function(e,t){if(!k$(e)&&!kQ(e)&&!wQ(e))throw"string"==typeof n[t]?new Error("toNetInput -".concat(r(t)," string passed, but could not resolve HTMLElement for element id ").concat(n[t])):new Error("toNetInput -".concat(r(t)," expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id"));if(wQ(e)){var a=e.shape[0];if(1!==a)throw new Error("toNetInput -".concat(r(t)," tf.Tensor4D with batchSize ").concat(a," passed, but not supported in input array"))}})),e.next=9,Promise.all(a.map((function(e){return k$(e)&&h$(e)})));case 9:return e.abrupt("return",new O$(a,Array.isArray(t)));case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function N$(e,t){return j$.apply(this,arguments)}function j$(){return(j$=Object(w.a)(k.a.mark((function e(t,n){var r,a,i,o,s,u;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=r$.getEnv(),a=r.Canvas,i=t,t instanceof a){e.next=16;break}return e.next=4,I$(t);case 4:if(!((o=e.sent).batchSize>1)){e.next=7;break}throw new Error("extractFaces - batchSize > 1 not supported");case 7:if(!((s=o.getInput(0))instanceof a)){e.next=12;break}e.t0=s,e.next=15;break;case 12:return e.next=14,y$(s);case 14:e.t0=e.sent;case 15:i=e.t0;case 16:return u=i$(i),e.abrupt("return",n.map((function(e){return e instanceof MQ?e.forSize(i.width,i.height).box.floor():e})).map((function(e){return e.clipAtImageBorders(i.width,i.height)})).map((function(e){var t=e.x,n=e.y,r=e.width,a=e.height,i=b$({width:r,height:a});return r>0&&a>0&&i$(i).putImageData(u.getImageData(t,n,r,a),0,0),i})));case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T$(e,t){return C$.apply(this,arguments)}function C$(){return(C$=Object(w.a)(k.a.mark((function e(t,n){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(kQ(t)||wQ(t)){e.next=2;break}throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");case 2:if(!(wQ(t)&&t.shape[0]>1)){e.next=4;break}throw new Error("extractFaceTensors - batchSize > 1 not supported");case 4:return e.abrupt("return",zs((function(){var e=t.shape.slice(wQ(t)?1:0),r=Object(y.a)(e,3),a=r[0],i=r[1],o=r[2];return n.map((function(e){return e instanceof MQ?e.forSize(i,a).box:e})).map((function(e){return e.clipAtImageBorders(i,a)})).filter((function(e){return e.width>0&&e.height>0})).map((function(e){var n=e.x,r=e.y,s=e.width,u=e.height;return rp(t.as3D(a,i,o),[r,n,0],[u,s,o])}))})));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function E$(e,t){return _$.apply(this,arguments)}function _$(){return(_$=Object(w.a)(k.a.mark((function e(t,n){var r,a,i;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=r$.getEnv(),a=r.fetch,e.next=4,a(t,n);case 4:if((i=e.sent).status<400){e.next=7;break}throw new Error("failed to fetch: (".concat(i.status,") ").concat(i.statusText,", from url: ").concat(i.url));case 7:return e.abrupt("return",i);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function A$(e){return R$.apply(this,arguments)}function R$(){return(R$=Object(w.a)(k.a.mark((function e(t){var n,r;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E$(t);case 2:return n=e.sent,e.next=5,n.blob();case 5:if((r=e.sent).type.startsWith("image/")){e.next=8;break}throw new Error("fetchImage - expected blob type to be of type image/*, instead have: ".concat(r.type,", for url: ").concat(n.url));case 8:return e.abrupt("return",m$(r));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function D$(e){return F$.apply(this,arguments)}function F$(){return(F$=Object(w.a)(k.a.mark((function e(t){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E$(t);case 2:return e.abrupt("return",e.sent.json());case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M$(e,t){var n="".concat(t,"-weights_manifest.json");if(!e)return{modelBaseUri:"",manifestUri:n};if("/"===e)return{modelBaseUri:"/",manifestUri:"/".concat(n)};var r=e.startsWith("http://")?"http://":e.startsWith("https://")?"https://":"",a=(e=e.replace(r,"")).split("/").filter((function(e){return e})),i=e.endsWith(".json")?a[a.length-1]:n,o=r+(e.endsWith(".json")?a.slice(0,a.length-1):a).join("/");return{modelBaseUri:o=e.startsWith("/")?"/".concat(o):o,manifestUri:"/"===o?"/".concat(i):"".concat(o,"/").concat(i)}}function z$(e,t){return L$.apply(this,arguments)}function L$(){return(L$=Object(w.a)(k.a.mark((function e(t,n){var r,a,i,o;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=M$(t,n),a=r.manifestUri,i=r.modelBaseUri,e.next=5,D$(a);case 5:return o=e.sent,e.abrupt("return",_h.loadWeights(o,i));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function P$(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=n?v$(t):t,a=r.width,i=r.height;return e.width=a,e.height=i,{width:a,height:i}}var B$=function(){function e(t){Object(O.a)(this,e),this._params=void 0,this._paramMappings=[],this._name=t}return Object(I.a)(e,[{key:"getParamFromPath",value:function(e){var t=this.traversePropertyPath(e);return t.obj[t.objProp]}},{key:"reassignParamFromPath",value:function(e,t){var n=this.traversePropertyPath(e),r=n.obj,a=n.objProp;r[a].dispose(),r[a]=t}},{key:"getParamList",value:function(){var e=this;return this._paramMappings.map((function(t){var n=t.paramPath;return{path:n,tensor:e.getParamFromPath(n)}}))}},{key:"getTrainableParams",value:function(){return this.getParamList().filter((function(e){return e.tensor instanceof Ei}))}},{key:"getFrozenParams",value:function(){return this.getParamList().filter((function(e){return!(e.tensor instanceof Ei)}))}},{key:"variable",value:function(){var e=this;this.getFrozenParams().forEach((function(t){var n=t.path,r=t.tensor;e.reassignParamFromPath(n,r.variable())}))}},{key:"freeze",value:function(){var e=this;this.getTrainableParams().forEach((function(t){var n=t.path,r=t.tensor,a=ho(r.dataSync());r.dispose(),e.reassignParamFromPath(n,a)}))}},{key:"dispose",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.getParamList().forEach((function(t){if(e&&t.tensor.isDisposed)throw new Error("param tensor has already been disposed for path ".concat(t.path));t.tensor.dispose()})),this._params=void 0}},{key:"serializeParams",value:function(){return new Float32Array(this.getParamList().map((function(e){var t=e.tensor;return Array.from(t.dataSync())})).reduce((function(e,t){return e.concat(t)})))}},{key:"load",value:function(){var e=Object(w.a)(k.a.mark((function e(t){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t instanceof Float32Array)){e.next=3;break}return this.extractWeights(t),e.abrupt("return");case 3:return e.next=5,this.loadFromUri(t);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"loadFromUri",value:function(){var e=Object(w.a)(k.a.mark((function e(t){var n;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t||"string"==typeof t){e.next=2;break}throw new Error("".concat(this._name,".loadFromUri - expected model uri"));case 2:return e.next=4,z$(t,this.getDefaultModelName());case 4:n=e.sent,this.loadFromWeightMap(n);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"loadFromDisk",value:function(){var e=Object(w.a)(k.a.mark((function e(t){var n,r,a,i,o,s,u,c,l;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t||"string"==typeof t){e.next=2;break}throw new Error("".concat(this._name,".loadFromDisk - expected model file path"));case 2:return n=r$.getEnv(),r=n.readFile,a=M$(t,this.getDefaultModelName()),i=a.manifestUri,o=a.modelBaseUri,s=function(e){return Promise.all(e.map((function(e){return r(e).then((function(e){return e.buffer}))})))},u=_h.weightsLoaderFactory(s),e.t0=JSON,e.next=12,r(i);case 12:return e.t1=e.sent.toString(),c=e.t0.parse.call(e.t0,e.t1),e.next=16,u(c,o);case 16:l=e.sent,this.loadFromWeightMap(l);case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"loadFromWeightMap",value:function(e){var t=this.extractParamsFromWeightMap(e),n=t.paramMappings,r=t.params;this._paramMappings=n,this._params=r}},{key:"extractWeights",value:function(e){var t=this.extractParams(e),n=t.paramMappings,r=t.params;this._paramMappings=n,this._params=r}},{key:"traversePropertyPath",value:function(e){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var t=e.split("/").reduce((function(t,n){if(!t.nextObj.hasOwnProperty(n))throw new Error("traversePropertyPath - object does not have property ".concat(n,", for path ").concat(e));return{obj:t.nextObj,objProp:n,nextObj:t.nextObj[n]}}),{nextObj:this.params}),n=t.obj,r=t.objProp;if(!n||!r||!(n[r]instanceof Ti))throw new Error("traversePropertyPath - parameter is not a tensor, for path ".concat(e));return{obj:n,objProp:r}}},{key:"params",get:function(){return this._params}},{key:"paramMappings",get:function(){return this._paramMappings}},{key:"isLoaded",get:function(){return!!this.params}}]),e}();function W$(e,t,n){return zs((function(){var r=Yd(e,t.depthwise_filter,t.pointwise_filter,n,"same");return r=Zs(r,t.bias)}))}function U$(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return zs((function(){var r=Pd(n?Zs(nc(e,t.conv0.filters,[2,2],"same"),t.conv0.bias):W$(e,t.conv0,[2,2])),a=W$(r,t.conv1,[1,1]),i=W$(Pd(Zs(r,a)),t.conv2,[1,1]);return Pd(Zs(r,Zs(a,i)))}))}function V$(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return zs((function(){var a=Pd(n?Zs(nc(e,t.conv0.filters,r?[2,2]:[1,1],"same"),t.conv0.bias):W$(e,t.conv0,r?[2,2]:[1,1])),i=W$(a,t.conv1,[1,1]),o=W$(Pd(Zs(a,i)),t.conv2,[1,1]),s=W$(Pd(Zs(a,Zs(i,o))),t.conv3,[1,1]);return Pd(Zs(a,Zs(i,Zs(o,s))))}))}function G$(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"same",r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return zs((function(){var a=Zs(nc(e,t.filters,[1,1],n),t.bias);return r?Pd(a):a}))}function H$(e,t){Object.keys(e).forEach((function(n){t.some((function(e){return e.originalPath===n}))||e[n].dispose()}))}function q$(e,t){return function(n,r,a,i){var o=xp(e(n*r*a*a),[a,a,n,r]),s=bp(e(r));return t.push({paramPath:"".concat(i,"/filters")},{paramPath:"".concat(i,"/bias")}),{filters:o,bias:s}}}function K$(e,t){return function(n,r,a){var i=gp(e(n*r),[n,r]),o=bp(e(r));return t.push({paramPath:"".concat(a,"/weights")},{paramPath:"".concat(a,"/bias")}),{weights:i,bias:o}}}var X$=function e(t,n,r){Object(O.a)(this,e),this.depthwise_filter=t,this.pointwise_filter=n,this.bias=r};function Y$(e,t){return function(n,r,a){var i=xp(e(9*n),[3,3,n,1]),o=xp(e(n*r),[1,1,n,r]),s=bp(e(r));return t.push({paramPath:"".concat(a,"/depthwise_filter")},{paramPath:"".concat(a,"/pointwise_filter")},{paramPath:"".concat(a,"/bias")}),new X$(i,o,s)}}function Z$(e){return function(t){var n=e("".concat(t,"/depthwise_filter"),4),r=e("".concat(t,"/pointwise_filter"),4),a=e("".concat(t,"/bias"),1);return new X$(n,r,a)}}function J$(e,t){return function(n,r,a){var i=e[n];if(!gQ(i,r))throw new Error("expected weightMap[".concat(n,"] to be a Tensor").concat(r,"D, instead have ").concat(i));return t.push({originalPath:n,paramPath:a||n}),i}}function Q$(e){var t=e;return{extractWeights:function(e){var n=t.slice(0,e);return t=t.slice(e),n},getRemainingWeights:function(){return t}}}function $$(e,t){var n=q$(e,t),r=Y$(e,t);function a(e,t,a){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=i?n(e,t,3,"".concat(a,"/conv0")):r(e,t,"".concat(a,"/conv0")),s=r(t,t,"".concat(a,"/conv1")),u=r(t,t,"".concat(a,"/conv2"));return{conv0:o,conv1:s,conv2:u}}return{extractDenseBlock3Params:a,extractDenseBlock4Params:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=a(e,t,n,i),s=o.conv0,u=o.conv1,c=o.conv2,l=r(t,t,"".concat(n,"/conv3"));return{conv0:s,conv1:u,conv2:c,conv3:l}}}}function e0(e){return function(t){return{filters:e("".concat(t,"/filters"),4),bias:e("".concat(t,"/bias"),1)}}}function t0(e,t){var n=J$(e,t),r=e0(n),a=Z$(n);return{extractDenseBlock3Params:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=t?r("".concat(e,"/conv0")):a("".concat(e,"/conv0")),i=a("".concat(e,"/conv1")),o=a("".concat(e,"/conv2"));return{conv0:n,conv1:i,conv2:o}},extractDenseBlock4Params:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=t?r("".concat(e,"/conv0")):a("".concat(e,"/conv0")),i=a("".concat(e,"/conv1")),o=a("".concat(e,"/conv2")),s=a("".concat(e,"/conv3"));return{conv0:n,conv1:i,conv2:o,conv3:s}}}}var n0=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){return Object(O.a)(this,n),t.call(this,"FaceFeatureExtractor")}return Object(I.a)(n,[{key:"forwardInput",value:function(e){var t=this.params;if(!t)throw new Error("FaceFeatureExtractor - load model before inference");return zs((function(){var n=V$(PQ(Ns(e.toBatchTensor(112,!0),"float32"),[122.782,117.001,104.298]).div(255),t.dense0,!0);return n=V$(n,t.dense1),n=V$(n,t.dense2),n=V$(n,t.dense3),n=_u(n,[7,7],[2,2],"valid")}))}},{key:"forward",value:function(){var e=Object(w.a)(k.a.mark((function e(t){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,I$(t);case 3:return e.t1=e.sent,e.abrupt("return",e.t0.forwardInput.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDefaultModelName",value:function(){return"face_feature_extractor_model"}},{key:"extractParamsFromWeightMap",value:function(e){return function(e){var t=[],n=t0(e,t).extractDenseBlock4Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2"),dense3:n("dense3")};return H$(e,t),{params:r,paramMappings:t}}(e)}},{key:"extractParams",value:function(e){return function(e){var t=[],n=Q$(e),r=n.extractWeights,a=n.getRemainingWeights,i=$$(r,t).extractDenseBlock4Params,o=i(3,32,"dense0",!0),s=i(32,64,"dense1"),u=i(64,128,"dense2"),c=i(128,256,"dense3");if(0!==a().length)throw new Error("weights remaing after extract: ".concat(a().length));return{paramMappings:t,params:{dense0:o,dense1:s,dense2:u,dense3:c}}}(e)}}]),n}(B$);function r0(e,t){return zs((function(){return Zs(Du(e,t.weights),t.bias)}))}function a0(e){var t={},n={};return Object.keys(e).forEach((function(r){(r.startsWith("fc")?n:t)[r]=e[r]})),{featureExtractorMap:t,classifierMap:n}}var i0=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e,r){var a;return Object(O.a)(this,n),(a=t.call(this,e))._faceFeatureExtractor=r,a}return Object(I.a)(n,[{key:"runNet",value:function(e){var t=this,n=this.params;if(!n)throw new Error("".concat(this._name," - load model before inference"));return zs((function(){var r=e instanceof O$?t.faceFeatureExtractor.forwardInput(e):e;return r0(r.as2D(r.shape[0],-1),n.fc)}))}},{key:"dispose",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.faceFeatureExtractor.dispose(e),Object(d.a)(Object(p.a)(n.prototype),"dispose",this).call(this,e)}},{key:"loadClassifierParams",value:function(e){var t=this.extractClassifierParams(e),n=t.params,r=t.paramMappings;this._params=n,this._paramMappings=r}},{key:"extractClassifierParams",value:function(e){return function(e,t,n){var r=[],a=Q$(e),i=a.extractWeights,o=a.getRemainingWeights,s=K$(i,r)(t,n,"fc");if(0!==o().length)throw new Error("weights remaing after extract: ".concat(o().length));return{paramMappings:r,params:{fc:s}}}(e,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())}},{key:"extractParamsFromWeightMap",value:function(e){var t=a0(e),n=t.featureExtractorMap,r=t.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(n),function(e){var t,n=[],r=J$(e,n),a={fc:(t="fc",{weights:r("".concat(t,"/weights"),2),bias:r("".concat(t,"/bias"),1)})};return H$(e,n),{params:a,paramMappings:n}}(r)}},{key:"extractParams",value:function(e){var t=this.getClassifierChannelsIn(),n=this.getClassifierChannelsOut(),r=n*t+n,a=e.slice(0,e.length-r),i=e.slice(e.length-r);return this.faceFeatureExtractor.extractWeights(a),this.extractClassifierParams(i)}},{key:"faceFeatureExtractor",get:function(){return this._faceFeatureExtractor}}]),n}(B$),o0=["neutral","happy","sad","angry","fearful","disgusted","surprised"],s0=function(){function e(t){var n=this;if(Object(O.a)(this,e),this.neutral=0,this.happy=0,this.sad=0,this.angry=0,this.fearful=0,this.disgusted=0,this.surprised=0,7!==t.length)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: ".concat(t.length));o0.forEach((function(e,r){n[e]=t[r]}))}return Object(I.a)(e,[{key:"asSortedArray",value:function(){var e=this;return o0.map((function(t){return{expression:t,probability:e[t]}})).sort((function(e,t){return t.probability-e.probability}))}}]),e}(),u0=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new n0;return Object(O.a)(this,n),t.call(this,"FaceExpressionNet",e)}return Object(I.a)(n,[{key:"forwardInput",value:function(e){var t=this;return zs((function(){return ip(t.runNet(e))}))}},{key:"forward",value:function(){var e=Object(w.a)(k.a.mark((function e(t){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,I$(t);case 3:return e.t1=e.sent,e.abrupt("return",e.t0.forwardInput.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"predictExpressions",value:function(){var e=Object(w.a)(k.a.mark((function e(t){var n,r,a,i;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I$(t);case 2:return n=e.sent,e.next=5,this.forwardInput(n);case 5:return r=e.sent,e.next=8,Promise.all(Ap(r).map(function(){var e=Object(w.a)(k.a.mark((function e(t){var n;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.dataSync(),e.abrupt("return",(t.dispose(),n));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 8:return a=e.sent,r.dispose(),i=a.map((function(e){return new s0(e)})),e.abrupt("return",n.isBatchInput?i:i[0]);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDefaultModelName",value:function(){return"face_expression_model"}},{key:"getClassifierChannelsIn",value:function(){return 256}},{key:"getClassifierChannelsOut",value:function(){return 7}}]),n}(i0);function c0(e){return e.expressions instanceof s0}function l0(e,t){return Object(u.a)(Object(u.a)({},e),{expressions:t})}function d0(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,r=arguments.length>3?arguments[3]:void 0;(Array.isArray(t)?t:[t]).forEach((function(t){var a=t instanceof s0?t:c0(t)?t.expressions:void 0;if(!a)throw new Error("drawFaceExpressions - expected faceExpressions to be FaceExpressions | WithFaceExpressions<{}> or array thereof");var i=a.asSortedArray().filter((function(e){return e.probability>n})),o=XQ(t)?t.detection.box.bottomLeft:r||new AQ(0,0);new c$(i.map((function(e){return"".concat(e.expression," (").concat(SQ(e.probability),")")})),o).draw(e)}))}function p0(e){return XQ(e)&&e.landmarks instanceof GQ&&e.unshiftedLandmarks instanceof GQ&&e.alignedRect instanceof MQ}function f0(e,t){var n=e.detection.box,r=t.shiftBy(n.x,n.y),a=r.align(),i=e.detection.imageDims,o=new MQ(e.detection.score,a.rescale(i.reverse()),i),s=function(e){var t=function(e){return 180*e/Math.PI},n=function(e,t){return Math.sqrt(Math.pow(e._x-t._x,2)+Math.pow(e._y-t._y,2))},r={roll:void 0,pitch:void 0,yaw:void 0};if(!e||!e._positions||68!==e._positions.length)return r;var a,i,o,s=e._positions;return r.roll=function(e,n){var r=Math.hypot(n._x-e._x,n._y-e._y),a=n._y-e._y,i=Math.asin(a/r),o=t(i);return Math.floor(90-o)*(n._x-e._x<0?-1:1)}(s[27],s[66]),r.pitch=function(e,r,a){var i=n(e,a),o={_x:(e._x+a._x)/2,_y:(e._y+a._y)/2},s=n(r,o),u=Math.atan(s/i);return Math.floor(t(u))*(o._y-r._y<0?-1:1)}(s[14],s[30],s[2]),r.yaw=(a=s[14],i=s[33],o=s[2],Math.floor(a._x-i._x)-Math.floor(i._x-o._x)),r}(t);return Object(u.a)(Object(u.a)({},e),{landmarks:r,unshiftedLandmarks:t,alignedRect:o,angle:s})}var h0=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(O.a)(this,e);var n=t.drawLines,r=void 0===n||n,a=t.drawPoints,i=void 0===a||a,o=t.lineWidth,s=t.lineColor,u=t.pointSize,c=t.pointColor;this.drawLines=r,this.drawPoints=i,this.lineWidth=o||1,this.pointSize=u||2,this.lineColor=s||"rgba(0, 255, 255, 1)",this.pointColor=c||"rgba(255, 0, 255, 1)"},m0=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(O.a)(this,e),this.faceLandmarks=t,this.options=new h0(n)}return Object(I.a)(e,[{key:"draw",value:function(e){var t=i$(e),n=this.options,r=n.drawLines,a=n.drawPoints,i=n.lineWidth,o=n.lineColor,s=n.pointSize,u=n.pointColor;if(r&&this.faceLandmarks instanceof HQ&&(t.strokeStyle=o,t.lineWidth=i,vQ(t,this.faceLandmarks.getJawOutline()),vQ(t,this.faceLandmarks.getLeftEyeBrow()),vQ(t,this.faceLandmarks.getRightEyeBrow()),vQ(t,this.faceLandmarks.getNose()),vQ(t,this.faceLandmarks.getLeftEye(),!0),vQ(t,this.faceLandmarks.getRightEye(),!0),vQ(t,this.faceLandmarks.getMouth(),!0)),a){t.strokeStyle=u,t.fillStyle=u;this.faceLandmarks.positions.forEach((function(e){t.beginPath(),t.arc(e.x,e.y,s,0,2*Math.PI),t.fill()}))}}}]),e}();function v0(e,t){(Array.isArray(t)?t:[t]).forEach((function(t){var n=t instanceof GQ?t:p0(t)?t.landmarks:void 0;if(!n)throw new Error("drawFaceLandmarks - expected faceExpressions to be FaceLandmarks | WithFaceLandmarks<WithFaceDetection<{}>> or array thereof");new m0(n).draw(e)}))}function b0(e,t){var n=[],r=Q$(e),a=r.extractWeights,i=r.getRemainingWeights,o=function(e,t){var n=q$(e,t),r=Y$(e,t);return{extractConvParams:n,extractSeparableConvParams:r,extractReductionBlockParams:function(e,t,a){return{separable_conv0:r(e,t,"".concat(a,"/separable_conv0")),separable_conv1:r(t,t,"".concat(a,"/separable_conv1")),expansion_conv:n(e,t,1,"".concat(a,"/expansion_conv"))}},extractMainBlockParams:function(e,t){return{separable_conv0:r(e,e,"".concat(t,"/separable_conv0")),separable_conv1:r(e,e,"".concat(t,"/separable_conv1")),separable_conv2:r(e,e,"".concat(t,"/separable_conv2"))}}}}(a,n),s=o.extractConvParams,u=o.extractSeparableConvParams,c=o.extractReductionBlockParams,l=o.extractMainBlockParams,d={conv_in:s(3,32,3,"entry_flow/conv_in"),reduction_block_0:c(32,64,"entry_flow/reduction_block_0"),reduction_block_1:c(64,128,"entry_flow/reduction_block_1")},p={};CQ(t,0,1).forEach((function(e){p["main_block_".concat(e)]=l(128,"middle_flow/main_block_".concat(e))}));var f={reduction_block:c(128,256,"exit_flow/reduction_block"),separable_conv:u(256,512,"exit_flow/separable_conv")};if(0!==i().length)throw new Error("weights remaing after extract: ".concat(i().length));return{paramMappings:n,params:{entry_flow:d,middle_flow:p,exit_flow:f}}}function g0(e,t){var n=[],r=function(e,t){var n=J$(e,t),r=e0(n),a=Z$(n);return{extractConvParams:r,extractSeparableConvParams:a,extractReductionBlockParams:function(e){return{separable_conv0:a("".concat(e,"/separable_conv0")),separable_conv1:a("".concat(e,"/separable_conv1")),expansion_conv:r("".concat(e,"/expansion_conv"))}},extractMainBlockParams:function(e){return{separable_conv0:a("".concat(e,"/separable_conv0")),separable_conv1:a("".concat(e,"/separable_conv1")),separable_conv2:a("".concat(e,"/separable_conv2"))}}}}(e,n),a=r.extractConvParams,i=r.extractSeparableConvParams,o=r.extractReductionBlockParams,s=r.extractMainBlockParams,u={conv_in:a("entry_flow/conv_in"),reduction_block_0:o("entry_flow/reduction_block_0"),reduction_block_1:o("entry_flow/reduction_block_1")},c={};CQ(t,0,1).forEach((function(e){c["main_block_".concat(e)]=s("middle_flow/main_block_".concat(e))}));var l={reduction_block:o("exit_flow/reduction_block"),separable_conv:i("exit_flow/separable_conv")};return H$(e,n),{params:{entry_flow:u,middle_flow:c,exit_flow:l},paramMappings:n}}function y0(e,t,n){return Zs(nc(e,t.filters,n,"same"),t.bias)}function x0(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=n?Pd(e):e;return r=W$(r,t.separable_conv0,[1,1]),r=W$(Pd(r),t.separable_conv1,[1,1]),r=Fl(r,[3,3],[2,2],"same"),r=Zs(r,y0(e,t.expansion_conv,[2,2]))}var k0=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(O.a)(this,n),(r=t.call(this,"TinyXception"))._numMainBlocks=e,r}return Object(I.a)(n,[{key:"forwardInput",value:function(e){var t=this,n=this.params;if(!n)throw new Error("TinyXception - load model before inference");return zs((function(){var r=PQ(Ns(e.toBatchTensor(112,!0),"float32"),[122.782,117.001,104.298]).div(255),a=Pd(y0(r,n.entry_flow.conv_in,[2,2]));return a=x0(a,n.entry_flow.reduction_block_0,!1),a=x0(a,n.entry_flow.reduction_block_1),CQ(t._numMainBlocks,0,1).forEach((function(e){a=function(e,t){var n=W$(Pd(e),t.separable_conv0,[1,1]);return n=W$(Pd(n),t.separable_conv1,[1,1]),n=W$(Pd(n),t.separable_conv2,[1,1]),n=Zs(n,e)}(a,n.middle_flow["main_block_".concat(e)])})),a=x0(a,n.exit_flow.reduction_block),a=Pd(W$(a,n.exit_flow.separable_conv,[1,1]))}))}},{key:"forward",value:function(){var e=Object(w.a)(k.a.mark((function e(t){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,I$(t);case 3:return e.t1=e.sent,e.abrupt("return",e.t0.forwardInput.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDefaultModelName",value:function(){return"tiny_xception_model"}},{key:"extractParamsFromWeightMap",value:function(e){return g0(e,this._numMainBlocks)}},{key:"extractParams",value:function(e){return b0(e,this._numMainBlocks)}}]),n}(B$);var w0,O0=((w0=O0||{}).FEMALE="female",w0.MALE="male",w0),I0=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new k0(2);return Object(O.a)(this,n),(e=t.call(this,"AgeGenderNet"))._faceFeatureExtractor=r,e}return Object(I.a)(n,[{key:"runNet",value:function(e){var t=this,n=this.params;if(!n)throw new Error("".concat(this._name," - load model before inference"));return zs((function(){var r=e instanceof O$?t.faceFeatureExtractor.forwardInput(e):e,a=_u(r,[7,7],[2,2],"valid").as2D(r.shape[0],-1);return{age:r0(a,n.fc.age).as1D(),gender:r0(a,n.fc.gender)}}))}},{key:"forwardInput",value:function(e){var t=this;return zs((function(){var n=t.runNet(e),r=n.age,a=n.gender;return{age:r,gender:ip(a)}}))}},{key:"forward",value:function(){var e=Object(w.a)(k.a.mark((function e(t){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,I$(t);case 3:return e.t1=e.sent,e.abrupt("return",e.t0.forwardInput.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"predictAgeAndGender",value:function(){var e=Object(w.a)(k.a.mark((function e(t){var n,r,a,i,o,s;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I$(t);case 2:return n=e.sent,e.next=5,this.forwardInput(n);case 5:return r=e.sent,a=Ap(r.age),i=Ap(r.gender),o=a.map((function(e,t){return{ageTensor:e,genderTensor:i[t]}})),e.next=11,Promise.all(o.map(function(){var e=Object(w.a)(k.a.mark((function e(t){var n,r,a,i,o,s,u;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.ageTensor,r=t.genderTensor,a=n.dataSync()[0],i=r.dataSync()[0],s=(o=i>.5)?"male":"female",u=o?i:1-i,e.abrupt("return",(n.dispose(),r.dispose(),{age:a,gender:s,genderProbability:u}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 11:return s=e.sent,e.abrupt("return",(r.age.dispose(),r.gender.dispose(),n.isBatchInput?s:s[0]));case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDefaultModelName",value:function(){return"age_gender_model"}},{key:"dispose",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.faceFeatureExtractor.dispose(e),Object(d.a)(Object(p.a)(n.prototype),"dispose",this).call(this,e)}},{key:"loadClassifierParams",value:function(e){var t=this.extractClassifierParams(e),n=t.params,r=t.paramMappings;this._params=n,this._paramMappings=r}},{key:"extractClassifierParams",value:function(e){return function(e){var t=[],n=Q$(e),r=n.extractWeights,a=n.getRemainingWeights,i=K$(r,t),o=i(512,1,"fc/age"),s=i(512,2,"fc/gender");if(0!==a().length)throw new Error("weights remaing after extract: ".concat(a().length));return{paramMappings:t,params:{fc:{age:o,gender:s}}}}(e)}},{key:"extractParamsFromWeightMap",value:function(e){var t=a0(e),n=t.featureExtractorMap,r=t.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(n),function(e){var t=[],n=J$(e,t);function r(e){return{weights:n("".concat(e,"/weights"),2),bias:n("".concat(e,"/bias"),1)}}var a={fc:{age:r("fc/age"),gender:r("fc/gender")}};return H$(e,t),{params:a,paramMappings:t}}(r)}},{key:"extractParams",value:function(e){var t=e.slice(0,e.length-1539),n=e.slice(e.length-1539);return this.faceFeatureExtractor.extractWeights(t),this.extractClassifierParams(n)}},{key:"faceFeatureExtractor",get:function(){return this._faceFeatureExtractor}}]),n}(B$),S0=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){return Object(O.a)(this,n),t.apply(this,arguments)}return Object(I.a)(n,[{key:"postProcess",value:function(e,t,n){var r=n.map((function(e){var n=e.width,r=e.height,a=t/Math.max(r,n);return{width:n*a,height:r*a}})),a=r.length;return zs((function(){var n=function(e,t){return fp([Zu([68],e,"float32"),Zu([68],t,"float32")],1).as2D(1,136).as1D()},i=function(e,t){var n=r[e],a=n.width,i=n.height;return t(a,i)?Math.abs(a-i)/2:0};return e.mul(Zu([a,136],t,"float32")).sub(fp(Array.from(Array(a),(function(e,t){return n(function(e){return i(e,(function(e,t){return e<t}))}(t),function(e){return i(e,(function(e,t){return t<e}))}(t))})))).div(fp(Array.from(Array(a),(function(e,t){return n(r[t].width,r[t].height)}))))}))}},{key:"forwardInput",value:function(e){var t=this;return zs((function(){var n=t.runNet(e);return t.postProcess(n,e.inputSize,e.inputDimensions.map((function(e){var t=Object(y.a)(e,2);return{height:t[0],width:t[1]}})))}))}},{key:"forward",value:function(){var e=Object(w.a)(k.a.mark((function e(t){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,I$(t);case 3:return e.t1=e.sent,e.abrupt("return",e.t0.forwardInput.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"detectLandmarks",value:function(){var e=Object(w.a)(k.a.mark((function e(t){var n,r,a,i=this;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I$(t);case 2:return n=e.sent,r=zs((function(){return Ap(i.forwardInput(n))})),e.next=6,Promise.all(r.map(function(){var e=Object(w.a)(k.a.mark((function e(t,r){var a,i,o;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Array.from(t.dataSync()),i=a.filter((function(e,t){return IQ(t)})),o=a.filter((function(e,t){return!IQ(t)})),e.abrupt("return",new HQ(Array(68).fill(0).map((function(e,t){return new AQ(i[t],o[t])})),{height:n.getInputHeight(r),width:n.getInputWidth(r)}));case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 6:return a=e.sent,e.abrupt("return",(r.forEach((function(e){return e.dispose()})),n.isBatchInput?a:a[0]));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getClassifierChannelsOut",value:function(){return 136}}]),n}(i0),N0=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new n0;return Object(O.a)(this,n),t.call(this,"FaceLandmark68Net",e)}return Object(I.a)(n,[{key:"getDefaultModelName",value:function(){return"face_landmark_68_model"}},{key:"getClassifierChannelsIn",value:function(){return 256}}]),n}(S0);var j0=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){return Object(O.a)(this,n),t.call(this,"TinyFaceFeatureExtractor")}return Object(I.a)(n,[{key:"forwardInput",value:function(e){var t=this.params;if(!t)throw new Error("TinyFaceFeatureExtractor - load model before inference");return zs((function(){var n=U$(PQ(Ns(e.toBatchTensor(112,!0),"float32"),[122.782,117.001,104.298]).div(255),t.dense0,!0);return n=U$(n,t.dense1),n=U$(n,t.dense2),n=_u(n,[14,14],[2,2],"valid")}))}},{key:"forward",value:function(){var e=Object(w.a)(k.a.mark((function e(t){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,I$(t);case 3:return e.t1=e.sent,e.abrupt("return",e.t0.forwardInput.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDefaultModelName",value:function(){return"face_feature_extractor_tiny_model"}},{key:"extractParamsFromWeightMap",value:function(e){return function(e){var t=[],n=t0(e,t).extractDenseBlock3Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2")};return H$(e,t),{params:r,paramMappings:t}}(e)}},{key:"extractParams",value:function(e){return function(e){var t=[],n=Q$(e),r=n.extractWeights,a=n.getRemainingWeights,i=$$(r,t).extractDenseBlock3Params,o=i(3,32,"dense0",!0),s=i(32,64,"dense1"),u=i(64,128,"dense2");if(0!==a().length)throw new Error("weights remaing after extract: ".concat(a().length));return{paramMappings:t,params:{dense0:o,dense1:s,dense2:u}}}(e)}}]),n}(B$),T0=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new j0;return Object(O.a)(this,n),t.call(this,"FaceLandmark68TinyNet",e)}return Object(I.a)(n,[{key:"getDefaultModelName",value:function(){return"face_landmark_68_tiny_model"}},{key:"getClassifierChannelsIn",value:function(){return 128}}]),n}(S0);function C0(e,t){return Zs($s(e,t.weights),t.biases)}function E0(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"same",i=t.conv,o=i.filters,s=i.bias,u=nc(e,o,n,a);return u=C0(u=Zs(u,s),t.scale),r?Pd(u):u}function _0(e,t){return E0(e,t,[1,1],!1)}function A0(e,t){return E0(e,t,[2,2],!0,"valid")}function R0(e,t){function n(n,r,a,i){var o=function(t,n,r){var a=e(t),i=a.length/(n*r*r);if(OQ(i))throw new Error("depth has to be an integer: ".concat(i,", weights.length: ").concat(a.length,", numFilters: ").concat(n,", filterSize: ").concat(r));return zs((function(){return Bp(xp(a,[n,i,r,r]),[2,3,1,0])}))}(n,r,a),s=bp(e(r));return t.push({paramPath:"".concat(i,"/filters")},{paramPath:"".concat(i,"/bias")}),{filters:o,bias:s}}function r(r,a,i,o){return{conv:n(r,a,i,"".concat(o,"/conv")),scale:function(n,r){var a=bp(e(n)),i=bp(e(n));return t.push({paramPath:"".concat(r,"/weights")},{paramPath:"".concat(r,"/biases")}),{weights:a,biases:i}}(a,"".concat(o,"/scale"))}}return{extractConvLayerParams:r,extractResidualLayerParams:function(e,t,n,a){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=r((i?.5:1)*e,t,n,"".concat(a,"/conv1")),s=r(e,t,n,"".concat(a,"/conv2"));return{conv1:o,conv2:s}}}}function D0(e,t){var n=J$(e,t);function r(e){return{conv:{filters:n("".concat(e,"/conv/filters"),4),bias:n("".concat(e,"/conv/bias"),1)},scale:function(e){return{weights:n("".concat(e,"/scale/weights"),1),biases:n("".concat(e,"/scale/biases"),1)}}(e)}}return{extractConvLayerParams:r,extractResidualLayerParams:function(e){return{conv1:r("".concat(e,"/conv1")),conv2:r("".concat(e,"/conv2"))}}}}function F0(e,t){var n=function(e,t){return E0(e,t,[1,1],!0)}(e,t.conv1);return n=_0(n,t.conv2),n=Zs(n,e),n=Pd(n)}function M0(e,t){var n=A0(e,t.conv1);n=_0(n,t.conv2);var r=_u(e,2,2,"valid"),a=Bl(r.shape),i=r.shape[3]!==n.shape[3];if(r.shape[1]!==n.shape[1]||r.shape[2]!==n.shape[2]){var o=Object(S.a)(n.shape);o[1]=1;var s=Bl(o);n=Ru([n,s],1);var u=Object(S.a)(n.shape);u[2]=1;var c=Bl(u);n=Ru([n,c],2)}return r=i?Ru([r,a],3):r,n=Zs(r,n),n=Pd(n)}var z0=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){return Object(O.a)(this,n),t.call(this,"FaceRecognitionNet")}return Object(I.a)(n,[{key:"forwardInput",value:function(e){var t=this.params;if(!t)throw new Error("FaceRecognitionNet - load model before inference");return zs((function(){var n=A0(PQ(Ns(e.toBatchTensor(150,!0),"float32"),[122.782,117.001,104.298]).div(255),t.conv32_down);n=F0(n=Fl(n,3,2,"valid"),t.conv32_1),n=F0(n,t.conv32_2),n=F0(n,t.conv32_3),n=F0(n=M0(n,t.conv64_down),t.conv64_1),n=F0(n,t.conv64_2),n=F0(n,t.conv64_3),n=F0(n=M0(n,t.conv128_down),t.conv128_1),n=F0(n,t.conv128_2),n=F0(n=M0(n,t.conv256_down),t.conv256_1);var r=(n=M0(n=F0(n,t.conv256_2),t.conv256_down_out)).mean([1,2]);return Du(r,t.fc)}))}},{key:"forward",value:function(){var e=Object(w.a)(k.a.mark((function e(t){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,I$(t);case 3:return e.t1=e.sent,e.abrupt("return",e.t0.forwardInput.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"computeFaceDescriptor",value:function(){var e=Object(w.a)(k.a.mark((function e(t){var n,r,a,i,o=this;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==(n=null==t?void 0:t.shape)||!n.some((function(e){return e<=0}))){e.next=2;break}return e.abrupt("return",new Float32Array(128));case 2:return e.next=4,I$(t);case 4:return r=e.sent,a=zs((function(){return Ap(o.forwardInput(r))})),e.next=8,Promise.all(a.map((function(e){return e.data()})));case 8:return i=e.sent,e.abrupt("return",(a.forEach((function(e){return e.dispose()})),r.isBatchInput?i:i[0]));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDefaultModelName",value:function(){return"face_recognition_model"}},{key:"extractParamsFromWeightMap",value:function(e){return function(e){var t=[],n=D0(e,t),r=n.extractConvLayerParams,a=n.extractResidualLayerParams,i=r("conv32_down"),o=a("conv32_1"),s=a("conv32_2"),u=a("conv32_3"),c=a("conv64_down"),l=a("conv64_1"),d=a("conv64_2"),p=a("conv64_3"),f=a("conv128_down"),h=a("conv128_1"),m=a("conv128_2"),v=a("conv256_down"),b=a("conv256_1"),g=a("conv256_2"),y=a("conv256_down_out"),x=e.fc;if(t.push({originalPath:"fc",paramPath:"fc"}),!xQ(x))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have ".concat(x));var k={conv32_down:i,conv32_1:o,conv32_2:s,conv32_3:u,conv64_down:c,conv64_1:l,conv64_2:d,conv64_3:p,conv128_down:f,conv128_1:h,conv128_2:m,conv256_down:v,conv256_1:b,conv256_2:g,conv256_down_out:y,fc:x};return H$(e,t),{params:k,paramMappings:t}}(e)}},{key:"extractParams",value:function(e){return function(e){var t=Q$(e),n=t.extractWeights,r=t.getRemainingWeights,a=[],i=R0(n,a),o=i.extractConvLayerParams,s=i.extractResidualLayerParams,u=o(4704,32,7,"conv32_down"),c=s(9216,32,3,"conv32_1"),l=s(9216,32,3,"conv32_2"),d=s(9216,32,3,"conv32_3"),p=s(36864,64,3,"conv64_down",!0),f=s(36864,64,3,"conv64_1"),h=s(36864,64,3,"conv64_2"),m=s(36864,64,3,"conv64_3"),v=s(147456,128,3,"conv128_down",!0),b=s(147456,128,3,"conv128_1"),g=s(147456,128,3,"conv128_2"),y=s(589824,256,3,"conv256_down",!0),x=s(589824,256,3,"conv256_1"),k=s(589824,256,3,"conv256_2"),w=s(589824,256,3,"conv256_down_out"),O=zs((function(){return Bp(gp(n(32768),[128,256]),[1,0])}));if(a.push({paramPath:"fc"}),0!==r().length)throw new Error("weights remaing after extract: ".concat(r().length));return{params:{conv32_down:u,conv32_1:c,conv32_2:l,conv32_3:d,conv64_down:p,conv64_1:f,conv64_2:h,conv64_3:m,conv128_down:v,conv128_1:b,conv128_2:g,conv256_down:y,conv256_1:x,conv256_2:k,conv256_down_out:w,fc:O},paramMappings:a}}(e)}}]),n}(B$);function L0(e,t){return Object(u.a)(Object(u.a)({},e),{descriptor:t})}function P0(e,t){return Object(u.a)(Object(u.a)({},e),{age:t})}function B0(e,t,n){return Object(u.a)(Object(u.a)({},e),{gender:t,genderProbability:n})}function W0(e,t){function n(n,r,a,i,o){var s=xp(e(n*r*a*a),[a,a,n,r]),u=bp(e(r));return t.push({paramPath:"".concat(i,"/filters")},{paramPath:"".concat(i,"/").concat(o?"batch_norm_offset":"bias")}),{filters:s,bias:u}}function r(e,t,r,a){var i=n(e,t,r,a,!0);return{filters:i.filters,batch_norm_offset:i.bias}}function a(n,a,i){return{depthwise_conv:function(n,r){var a=xp(e(9*n),[3,3,n,1]),i=bp(e(n)),o=bp(e(n)),s=bp(e(n)),u=bp(e(n));return t.push({paramPath:"".concat(r,"/filters")},{paramPath:"".concat(r,"/batch_norm_scale")},{paramPath:"".concat(r,"/batch_norm_offset")},{paramPath:"".concat(r,"/batch_norm_mean")},{paramPath:"".concat(r,"/batch_norm_variance")}),{filters:a,batch_norm_scale:i,batch_norm_offset:o,batch_norm_mean:s,batch_norm_variance:u}}(n,"".concat(i,"/depthwise_conv")),pointwise_conv:r(n,a,1,"".concat(i,"/pointwise_conv"))}}return{extractMobilenetV1Params:function(){return{conv_0:r(3,32,3,"mobilenetv1/conv_0"),conv_1:a(32,64,"mobilenetv1/conv_1"),conv_2:a(64,128,"mobilenetv1/conv_2"),conv_3:a(128,128,"mobilenetv1/conv_3"),conv_4:a(128,256,"mobilenetv1/conv_4"),conv_5:a(256,256,"mobilenetv1/conv_5"),conv_6:a(256,512,"mobilenetv1/conv_6"),conv_7:a(512,512,"mobilenetv1/conv_7"),conv_8:a(512,512,"mobilenetv1/conv_8"),conv_9:a(512,512,"mobilenetv1/conv_9"),conv_10:a(512,512,"mobilenetv1/conv_10"),conv_11:a(512,512,"mobilenetv1/conv_11"),conv_12:a(512,1024,"mobilenetv1/conv_12"),conv_13:a(1024,1024,"mobilenetv1/conv_13")}},extractPredictionLayerParams:function(){return{conv_0:r(1024,256,1,"prediction_layer/conv_0"),conv_1:r(256,512,3,"prediction_layer/conv_1"),conv_2:r(512,128,1,"prediction_layer/conv_2"),conv_3:r(128,256,3,"prediction_layer/conv_3"),conv_4:r(256,128,1,"prediction_layer/conv_4"),conv_5:r(128,256,3,"prediction_layer/conv_5"),conv_6:r(256,64,1,"prediction_layer/conv_6"),conv_7:r(64,128,3,"prediction_layer/conv_7"),box_predictor_0:{box_encoding_predictor:n(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),class_predictor:n(512,9,1,"prediction_layer/box_predictor_0/class_predictor")},box_predictor_1:{box_encoding_predictor:n(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),class_predictor:n(1024,18,1,"prediction_layer/box_predictor_1/class_predictor")},box_predictor_2:{box_encoding_predictor:n(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),class_predictor:n(512,18,1,"prediction_layer/box_predictor_2/class_predictor")},box_predictor_3:{box_encoding_predictor:n(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),class_predictor:n(256,18,1,"prediction_layer/box_predictor_3/class_predictor")},box_predictor_4:{box_encoding_predictor:n(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),class_predictor:n(256,18,1,"prediction_layer/box_predictor_4/class_predictor")},box_predictor_5:{box_encoding_predictor:n(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),class_predictor:n(128,18,1,"prediction_layer/box_predictor_5/class_predictor")}}}}}function U0(e){var t=[],n=function(e,t){var n=J$(e,t);function r(e,t,r){return{filters:n("".concat(e,"/Conv2d_").concat(t,"_pointwise/weights"),4,"".concat(r,"/filters")),batch_norm_offset:n("".concat(e,"/Conv2d_").concat(t,"_pointwise/convolution_bn_offset"),1,"".concat(r,"/batch_norm_offset"))}}function a(e){var t="mobilenetv1/conv_".concat(e),a="MobilenetV1/Conv2d_".concat(e,"_depthwise"),i="".concat(t,"/depthwise_conv"),o="".concat(t,"/pointwise_conv");return{depthwise_conv:{filters:n("".concat(a,"/depthwise_weights"),4,"".concat(i,"/filters")),batch_norm_scale:n("".concat(a,"/BatchNorm/gamma"),1,"".concat(i,"/batch_norm_scale")),batch_norm_offset:n("".concat(a,"/BatchNorm/beta"),1,"".concat(i,"/batch_norm_offset")),batch_norm_mean:n("".concat(a,"/BatchNorm/moving_mean"),1,"".concat(i,"/batch_norm_mean")),batch_norm_variance:n("".concat(a,"/BatchNorm/moving_variance"),1,"".concat(i,"/batch_norm_variance"))},pointwise_conv:r("MobilenetV1",e,o)}}function i(e,t){return{filters:n("".concat(e,"/weights"),4,"".concat(t,"/filters")),bias:n("".concat(e,"/biases"),1,"".concat(t,"/bias"))}}function o(e){return{box_encoding_predictor:i("Prediction/BoxPredictor_".concat(e,"/BoxEncodingPredictor"),"prediction_layer/box_predictor_".concat(e,"/box_encoding_predictor")),class_predictor:i("Prediction/BoxPredictor_".concat(e,"/ClassPredictor"),"prediction_layer/box_predictor_".concat(e,"/class_predictor"))}}return{extractMobilenetV1Params:function(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:a(1),conv_2:a(2),conv_3:a(3),conv_4:a(4),conv_5:a(5),conv_6:a(6),conv_7:a(7),conv_8:a(8),conv_9:a(9),conv_10:a(10),conv_11:a(11),conv_12:a(12),conv_13:a(13)}},extractPredictionLayerParams:function(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:o(0),box_predictor_1:o(1),box_predictor_2:o(2),box_predictor_3:o(3),box_predictor_4:o(4),box_predictor_5:o(5)}}}}(e,t),r=n.extractMobilenetV1Params,a=n.extractPredictionLayerParams,i=e["Output/extra_dim"];if(t.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!kQ(i))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have ".concat(i));var o={mobilenetv1:r(),prediction_layer:a(),output_layer:{extra_dim:i}};return H$(e,t),{params:o,paramMappings:t}}function V0(e,t,n){return zs((function(){var r=nc(e,t.filters,n,"same");return r=Zs(r,t.batch_norm_offset),Ju(r,0,6)}))}function G0(e,t){return zs((function(){var n,r=V0(e,t.conv_0,[2,2]);if([t.conv_1,t.conv_2,t.conv_3,t.conv_4,t.conv_5,t.conv_6,t.conv_7,t.conv_8,t.conv_9,t.conv_10,t.conv_11,t.conv_12,t.conv_13].forEach((function(e,t){var a=t+1,i=function(e){return[2,4,6,12].some((function(t){return t===e}))?[2,2]:[1,1]}(a);r=V0(r=function(e,t,n){return zs((function(){var r=mc(e,t.filters,n,"same");return r=Wu(r,t.batch_norm_mean,t.batch_norm_variance,t.batch_norm_offset,t.batch_norm_scale,.0010000000474974513),Ju(r,0,6)}))}(r,e.depthwise_conv,i),e.pointwise_conv,[1,1]),11===a&&(n=r)})),null===n)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:n}}))}function H0(e,t,n){var r=e.arraySync(),a=Math.min(r[t][0],r[t][2]),i=Math.min(r[t][1],r[t][3]),o=Math.max(r[t][0],r[t][2]),s=Math.max(r[t][1],r[t][3]),u=Math.min(r[n][0],r[n][2]),c=Math.min(r[n][1],r[n][3]),l=Math.max(r[n][0],r[n][2]),d=Math.max(r[n][1],r[n][3]),p=(o-a)*(s-i),f=(l-u)*(d-c);if(p<=0||f<=0)return 0;var h=Math.max(a,u),m=Math.max(i,c),v=Math.min(o,l),b=Math.min(s,d),g=Math.max(v-h,0)*Math.max(b-m,0);return g/(p+f-g)}function q0(e,t,n,r,a){var i=e.shape[0],o=Math.min(n,i),s=t.map((function(e,t){return{score:e,boxIndex:t}})).filter((function(e){return e.score>a})).sort((function(e,t){return t.score-e.score})),u=function(e){return e<=r?1:0},c=[];return s.forEach((function(t){if(!(c.length>=o)){for(var n=t.score,r=c.length-1;r>=0;--r){var i=H0(e,t.boxIndex,c[r]);if(0!==i&&(t.score*=u(i),t.score<=a))break}n===t.score&&c.push(t.boxIndex)}})),c}function K0(e,t){var n=function(e){var t=Ap(Bp(e,[1,0])),n=[Sl(t[2],t[0]),Sl(t[3],t[1])];return{sizes:n,centers:[Zs(t[0],Qs(n[0],2)),Zs(t[1],Qs(n[1],2))]}}(e),r=n.sizes,a=n.centers,i=Ap(Bp(t,[1,0])),o=Qs($s(Yc(Qs(i[2],5)),r[0]),2),s=Zs($s(Qs(i[0],10),r[0]),a[0]),u=Qs($s(Yc(Qs(i[3],5)),r[1]),2),c=Zs($s(Qs(i[1],10),r[1]),a[1]);return Bp(fp([Sl(s,o),Sl(c,u),Zs(s,o),Zs(c,u)]),[1,0])}function X0(e,t){return zs((function(){var n=e.shape[0];return{boxPredictionEncoding:Eu(G$(e,t.box_encoding_predictor),[n,-1,1,4]),classPrediction:Eu(G$(e,t.class_predictor),[n,-1,3])}}))}var Y0=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.minConfidence,r=t.maxResults;if(Object(O.a)(this,e),this._name="SsdMobilenetv1Options",this._minConfidence=n||.5,this._maxResults=r||100,"number"!=typeof this._minConfidence||this._minConfidence<=0||this._minConfidence>=1)throw new Error("".concat(this._name," - expected minConfidence to be a number between 0 and 1"));if("number"!=typeof this._maxResults)throw new Error("".concat(this._name," - expected maxResults to be a number"))}return Object(I.a)(e,[{key:"minConfidence",get:function(){return this._minConfidence}},{key:"maxResults",get:function(){return this._maxResults}}]),e}(),Z0=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){return Object(O.a)(this,n),t.call(this,"SsdMobilenetv1")}return Object(I.a)(n,[{key:"forwardInput",value:function(e){var t=this.params;if(!t)throw new Error("SsdMobilenetv1 - load model before inference");return zs((function(){var n=Ns(e.toBatchTensor(512,!1),"float32"),r=G0(Sl(Qs(n,127.5),1),t.mobilenetv1),a=function(e,t,n){return zs((function(){var r=V0(e,n.conv_0,[1,1]),a=V0(r,n.conv_1,[2,2]),i=V0(a,n.conv_2,[1,1]),o=V0(i,n.conv_3,[2,2]),s=V0(o,n.conv_4,[1,1]),u=V0(s,n.conv_5,[2,2]),c=V0(u,n.conv_6,[1,1]),l=V0(c,n.conv_7,[2,2]),d=X0(t,n.box_predictor_0),p=X0(e,n.box_predictor_1),f=X0(a,n.box_predictor_2),h=X0(o,n.box_predictor_3),m=X0(u,n.box_predictor_4),v=X0(l,n.box_predictor_5);return{boxPredictions:Ru([d.boxPredictionEncoding,p.boxPredictionEncoding,f.boxPredictionEncoding,h.boxPredictionEncoding,m.boxPredictionEncoding,v.boxPredictionEncoding],1),classPredictions:Ru([d.classPrediction,p.classPrediction,f.classPrediction,h.classPrediction,m.classPrediction,v.classPrediction],1)}}))}(r.out,r.conv11,t.prediction_layer);return function(e,t,n){return zs((function(){var r=e.shape[0],a=K0(Eu(Qc(n.extra_dim,[r,1,1]),[-1,4]),Eu(e,[-1,4]));a=Eu(a,[r,a.shape[0]/r,4]);var i=Fu(Mu(t,[0,0,1],[-1,-1,-1])),o=Mu(i,[0,0,0],[-1,-1,1]);return o=Eu(o,[r,o.shape[1]]),{boxes:Ap(a),scores:Ap(o)}}))}(a.boxPredictions,a.classPredictions,t.output_layer)}))}},{key:"forward",value:function(){var e=Object(w.a)(k.a.mark((function e(t){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,I$(t);case 3:return e.t1=e.sent,e.abrupt("return",e.t0.forwardInput.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"locateFaces",value:function(){var e=Object(w.a)(k.a.mark((function e(t){var n,r,a,i,o,s,u,c,l,d,p,f,h,m,v,b,g,x,w,O=arguments;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=O.length>1&&void 0!==O[1]?O[1]:{},r=new Y0(n),a=r.maxResults,i=r.minConfidence,e.next=6,I$(t);case 6:for(o=e.sent,s=this.forwardInput(o),u=s.boxes,c=s.scores,l=u[0],d=c[0],p=1;p<u.length;p++)u[p].dispose(),c[p].dispose();return f=Array.from(d.dataSync()),h=q0(l,f,a,.5,i),m=o.getReshapedInputDimensions(0),v=o.inputSize,b=v/m.width,g=v/m.height,x=l.arraySync(),w=h.map((function(e){var t=[Math.max(0,x[e][0]),Math.min(1,x[e][2])].map((function(e){return e*g})),n=Object(y.a)(t,2),r=n[0],a=n[1],i=[Math.max(0,x[e][1]),Math.min(1,x[e][3])].map((function(e){return e*b})),s=Object(y.a)(i,2),u=s[0],c=s[1];return new MQ(f[e],new VQ(u,r,c-u,a-r),{height:o.getInputHeight(0),width:o.getInputWidth(0)})})),e.abrupt("return",(l.dispose(),d.dispose(),w));case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDefaultModelName",value:function(){return"ssd_mobilenetv1_model"}},{key:"extractParamsFromWeightMap",value:function(e){return U0(e)}},{key:"extractParams",value:function(e){return function(e){var t=[],n=Q$(e),r=n.extractWeights,a=n.getRemainingWeights,i=W0(r,t),o=i.extractMobilenetV1Params,s=i.extractPredictionLayerParams,u=o(),c=s(),l={extra_dim:yp(r(20472),[1,5118,4])};if(t.push({paramPath:"output_layer/extra_dim"}),0!==a().length)throw new Error("weights remaing after extract: ".concat(a().length));return{params:{mobilenetv1:u,prediction_layer:c,output_layer:l},paramMappings:t}}(e)}}]),n}(B$);var J0=[new AQ(.738768,.874946),new AQ(2.42204,2.65704),new AQ(4.30971,7.04493),new AQ(10.246,4.59428),new AQ(12.6868,11.8741)],Q0=[new AQ(1.603231,2.094468),new AQ(6.041143,7.080126),new AQ(2.882459,3.518061),new AQ(4.266906,5.178857),new AQ(9.041765,10.66308)],$0=[117.001,114.697,97.404],e1=function(e){return"number"==typeof e};function t1(e){return zs((function(){var t=$s(e,Uc(.10000000149011612));return Zs(Pd(Sl(e,t)),t)}))}function n1(e,t){return zs((function(){var n=$l(e,[[0,0],[1,1],[1,1],[0,0]]);return n=nc(n,t.conv.filters,[1,1],"valid"),n=Sl(n,t.bn.sub),n=$s(n,t.bn.truediv),t1(n=Zs(n,t.conv.bias))}))}function r1(e,t){return zs((function(){var n=$l(e,[[0,0],[1,1],[1,1],[0,0]]);return n=Yd(n,t.depthwise_filter,t.pointwise_filter,[1,1],"valid"),t1(n=Zs(n,t.bias))}))}function a1(e,t){var n=q$(e,t);var r=Y$(e,t);return{extractConvParams:n,extractConvWithBatchNormParams:function(r,a,i){return{conv:n(r,a,3,"".concat(i,"/conv")),bn:function(n,r){var a=bp(e(n)),i=bp(e(n));return t.push({paramPath:"".concat(r,"/sub")},{paramPath:"".concat(r,"/truediv")}),{sub:a,truediv:i}}(a,"".concat(i,"/bn"))}},extractSeparableConvParams:r}}function i1(e,t){var n=J$(e,t);function r(e){return{filters:n("".concat(e,"/filters"),4),bias:n("".concat(e,"/bias"),1)}}return{extractConvParams:r,extractConvWithBatchNormParams:function(e){return{conv:r("".concat(e,"/conv")),bn:function(e){return{sub:n("".concat(e,"/sub"),1),truediv:n("".concat(e,"/truediv"),1)}}("".concat(e,"/bn"))}},extractSeparableConvParams:Z$(n)}}var o1=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.inputSize,r=t.scoreThreshold;if(Object(O.a)(this,e),this._name="TinyYolov2Options",this._inputSize=n||416,this._scoreThreshold=r||.5,"number"!=typeof this._inputSize||this._inputSize%32!==0)throw new Error("".concat(this._name," - expected inputSize to be a number divisible by 32"));if("number"!=typeof this._scoreThreshold||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error("".concat(this._name," - expected scoreThreshold to be a number between 0 and 1"))}return Object(I.a)(e,[{key:"inputSize",get:function(){return this._inputSize}},{key:"scoreThreshold",get:function(){return this._scoreThreshold}}]),e}(),s1=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(O.a)(this,n),r=t.call(this,"TinyYolov2"),function(e){if(!e)throw new Error("invalid config: ".concat(e));if("boolean"!=typeof e.withSeparableConvs)throw new Error("config.withSeparableConvs has to be a boolean, have: ".concat(e.withSeparableConvs));if(!e1(e.iouThreshold)||e.iouThreshold<0||e.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: ".concat(e.iouThreshold));if(!Array.isArray(e.classes)||!e.classes.length||!e.classes.every((function(e){return"string"==typeof e})))throw new Error("config.classes has to be an array class names: string[], have: ".concat(JSON.stringify(e.classes)));if(!Array.isArray(e.anchors)||!e.anchors.length||!e.anchors.map((function(e){return e||{}})).every((function(e){return e1(e.x)&&e1(e.y)})))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: ".concat(JSON.stringify(e.anchors)));if(e.meanRgb&&(!Array.isArray(e.meanRgb)||3!==e.meanRgb.length||!e.meanRgb.every(e1)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: ".concat(JSON.stringify(e.meanRgb)))}(e),r._config=e,r}return Object(I.a)(n,[{key:"runTinyYolov2",value:function(e,t){var n=n1(e,t.conv0);return n=n1(n=Fl(n,[2,2],[2,2],"same"),t.conv1),n=n1(n=Fl(n,[2,2],[2,2],"same"),t.conv2),n=n1(n=Fl(n,[2,2],[2,2],"same"),t.conv3),n=n1(n=Fl(n,[2,2],[2,2],"same"),t.conv4),n=n1(n=Fl(n,[2,2],[2,2],"same"),t.conv5),n=n1(n=Fl(n,[2,2],[1,1],"same"),t.conv6),G$(n=n1(n,t.conv7),t.conv8,"valid",!1)}},{key:"runMobilenet",value:function(e,t){var n=this.config.isFirstLayerConv2d?t1(G$(e,t.conv0,"valid",!1)):r1(e,t.conv0);return n=r1(n=Fl(n,[2,2],[2,2],"same"),t.conv1),n=r1(n=Fl(n,[2,2],[2,2],"same"),t.conv2),n=r1(n=Fl(n,[2,2],[2,2],"same"),t.conv3),n=r1(n=Fl(n,[2,2],[2,2],"same"),t.conv4),n=r1(n=Fl(n,[2,2],[2,2],"same"),t.conv5),n=Fl(n,[2,2],[1,1],"same"),n=t.conv6?r1(n,t.conv6):n,G$(n=t.conv7?r1(n,t.conv7):n,t.conv8,"valid",!1)}},{key:"forwardInput",value:function(e,t){var n=this,r=this.params;if(!r)throw new Error("TinyYolov2 - load model before inference");return zs((function(){var a=Ns(e.toBatchTensor(t,!1),"float32");return a=(a=n.config.meanRgb?PQ(a,n.config.meanRgb):a).div(255),n.config.withSeparableConvs?n.runMobilenet(a,r):n.runTinyYolov2(a,r)}))}},{key:"forward",value:function(){var e=Object(w.a)(k.a.mark((function e(t,n){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,I$(t);case 3:return e.t1=e.sent,e.t2=n,e.abrupt("return",e.t0.forwardInput.call(e.t0,e.t1,e.t2));case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"detect",value:function(){var e=Object(w.a)(k.a.mark((function e(t){var n,r,a,i,o,s,u,c,l,d,p,f,h,m=this,v=arguments;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=v.length>1&&void 0!==v[1]?v[1]:{},r=new o1(n),a=r.inputSize,i=r.scoreThreshold,e.next=6,I$(t);case 6:return o=e.sent,e.next=9,this.forwardInput(o,a);case 9:return s=e.sent,u=zs((function(){return Ap(s)[0].expandDims()})),c={width:o.getInputWidth(0),height:o.getInputHeight(0)},e.next=14,this.extractBoxes(u,o.getReshapedInputDimensions(0),i);case 14:return l=e.sent,s.dispose(),u.dispose(),d=l.map((function(e){return e.box})),p=l.map((function(e){return e.score})),f=l.map((function(e){return e.classScore})),h=l.map((function(e){return m.config.classes[e.label]})),e.abrupt("return",LQ(d.map((function(e){return e.rescale(a)})),p,this.config.iouThreshold,!0).map((function(e){return new FQ(p[e],f[e],h[e],d[e],c)})));case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDefaultModelName",value:function(){return""}},{key:"extractParamsFromWeightMap",value:function(e){return function(e,t){var n,r=[],a=i1(e,r),i=a.extractConvParams,o=a.extractConvWithBatchNormParams,s=a.extractSeparableConvParams;if(t.withSeparableConvs){var u=t.filterSizes&&t.filterSizes.length||9;n={conv0:t.isFirstLayerConv2d?i("conv0"):s("conv0"),conv1:s("conv1"),conv2:s("conv2"),conv3:s("conv3"),conv4:s("conv4"),conv5:s("conv5"),conv6:u>7?s("conv6"):void 0,conv7:u>8?s("conv7"):void 0,conv8:i("conv8")}}else n={conv0:o("conv0"),conv1:o("conv1"),conv2:o("conv2"),conv3:o("conv3"),conv4:o("conv4"),conv5:o("conv5"),conv6:o("conv6"),conv7:o("conv7"),conv8:i("conv8")};return H$(e,r),{params:n,paramMappings:r}}(e,this.config)}},{key:"extractParams",value:function(e){var t=this.config.filterSizes||n.DEFAULT_FILTER_SIZES,r=t?t.length:void 0;if(7!==r&&8!==r&&9!==r)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found ".concat(r," filterSizes in config"));return function(e,t,n,r){var a,i=Q$(e),o=i.extractWeights,s=i.getRemainingWeights,u=[],c=a1(o,u),l=c.extractConvParams,d=c.extractConvWithBatchNormParams,p=c.extractSeparableConvParams;if(t.withSeparableConvs){var f=Object(y.a)(r,9),h=f[0],m=f[1],v=f[2],b=f[3],g=f[4],x=f[5],k=f[6],w=f[7],O=f[8];a={conv0:t.isFirstLayerConv2d?l(h,m,3,"conv0"):p(h,m,"conv0"),conv1:p(m,v,"conv1"),conv2:p(v,b,"conv2"),conv3:p(b,g,"conv3"),conv4:p(g,x,"conv4"),conv5:p(x,k,"conv5"),conv6:w?p(k,w,"conv6"):void 0,conv7:O?p(w,O,"conv7"):void 0,conv8:l(O||w||k,5*n,1,"conv8")}}else{var I=Object(y.a)(r,9),S=I[0],N=I[1],j=I[2],T=I[3],C=I[4],E=I[5],_=I[6],A=I[7],R=I[8];a={conv0:d(S,N,"conv0"),conv1:d(N,j,"conv1"),conv2:d(j,T,"conv2"),conv3:d(T,C,"conv3"),conv4:d(C,E,"conv4"),conv5:d(E,_,"conv5"),conv6:d(_,A,"conv6"),conv7:d(A,R,"conv7"),conv8:l(R,5*n,1,"conv8")}}if(0!==s().length)throw new Error("weights remaing after extract: ".concat(s().length));return{params:a,paramMappings:u}}(e,this.config,this.boxEncodingSize,t)}},{key:"extractBoxes",value:function(){var e=Object(w.a)(k.a.mark((function e(t,n,r){var a,i,o,s,c,l,d,p,f,h,m,v,b,g,x,w,O,I,S,N,j,T,C,E,_,A,R,D,F,M=this;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.width,i=n.height,o=Math.max(a,i),s=o/a,c=o/i,l=t.shape[1],d=this.config.anchors.length,p=zs((function(){var e=t.reshape([l,l,d,M.boxEncodingSize]);return[e.slice([0,0,0,0],[l,l,d,4]),e.slice([0,0,0,4],[l,l,d,1]),M.withClassScores?ip(e.slice([0,0,0,5],[l,l,d,M.config.classes.length]),3):Uc(0)]})),f=Object(y.a)(p,3),h=f[0],m=f[1],v=f[2],b=[],e.next=15,m.array();case 15:return g=e.sent,e.next=18,h.array();case 18:x=e.sent,w=0;case 20:if(!(w<l)){e.next=54;break}O=0;case 22:if(!(O<l)){e.next=51;break}I=0;case 24:if(!(I<d)){e.next=48;break}if(S=WQ(g[w][O][I][0]),r&&!(S>r)){e.next=45;break}if(N=(O+WQ(x[w][O][I][0]))/l*s,j=(w+WQ(x[w][O][I][1]))/l*c,T=Math.exp(x[w][O][I][2])*this.config.anchors[I].x/l*s,C=Math.exp(x[w][O][I][3])*this.config.anchors[I].y/l*c,E=N-T/2,_=j-C/2,A={row:w,col:O,anchor:I},!this.withClassScores){e.next=40;break}return e.next=37,this.extractPredictedClass(v,A);case 37:e.t0=e.sent,e.next=41;break;case 40:e.t0={classScore:1,label:0};case 41:R=e.t0,D=R.classScore,F=R.label,b.push(Object(u.a)({box:new DQ(E,_,E+T,_+C),score:S,classScore:S*D,label:F},A));case 45:I++,e.next=24;break;case 48:O++,e.next=22;break;case 51:w++,e.next=20;break;case 54:return e.abrupt("return",(h.dispose(),m.dispose(),v.dispose(),b));case 55:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"extractPredictedClass",value:function(){var e=Object(w.a)(k.a.mark((function e(t,n){var r,a,i,o;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.row,a=n.col,i=n.anchor,e.next=5,t.array();case 5:return o=e.sent,e.abrupt("return",Array(this.config.classes.length).fill(0).map((function(e,t){return o[r][a][i][t]})).map((function(e,t){return{classScore:e,label:t}})).reduce((function(e,t){return e.classScore>t.classScore?e:t})));case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"config",get:function(){return this._config}},{key:"withClassScores",get:function(){return this.config.withClassScores||this.config.classes.length>1}},{key:"boxEncodingSize",get:function(){return 5+(this.withClassScores?this.config.classes.length:0)}}]),n}(B$);s1.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024];var u1=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];Object(O.a)(this,n);var r=Object(u.a)({withSeparableConvs:e,iouThreshold:.4,classes:["face"]},e?{anchors:Q0,meanRgb:$0}:{anchors:J0,withClassScores:!0});return t.call(this,r)}return Object(I.a)(n,[{key:"locateFaces",value:function(){var e=Object(w.a)(k.a.mark((function e(t,n){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.detect(t,n);case 2:return e.abrupt("return",e.sent.map((function(e){return new MQ(e.score,e.relativeBox,{width:e.imageWidth,height:e.imageHeight})})));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getDefaultModelName",value:function(){return this.withSeparableConvs?"tiny_yolov2_separable_conv_model":"tiny_yolov2_model"}},{key:"extractParamsFromWeightMap",value:function(e){return Object(d.a)(Object(p.a)(n.prototype),"extractParamsFromWeightMap",this).call(this,e)}},{key:"withSeparableConvs",get:function(){return this.config.withSeparableConvs}},{key:"anchors",get:function(){return this.config.anchors}}]),n}(s1);var c1=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){var e;return Object(O.a)(this,n),(e=t.apply(this,arguments))._name="TinyFaceDetectorOptions",e}return n}(o1),l1=function(){function e(){Object(O.a)(this,e)}return Object(I.a)(e,[{key:"then",value:function(){var e=Object(w.a)(k.a.mark((function e(t){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=t,e.next=3,this.run();case 3:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"run",value:function(){var e=Object(w.a)(k.a.mark((function e(){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("ComposableTask - run is not implemented");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),e}();function d1(e,t,n,r){return p1.apply(this,arguments)}function p1(){return(p1=Object(w.a)(k.a.mark((function e(t,n,r,a){var i,o,s,u,c=arguments;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=c.length>4&&void 0!==c[4]?c[4]:function(e){return e.alignedRect},o=t.map((function(e){return p0(e)?i(e):e.detection})),e.t0=a,e.t0){e.next=14;break}if(!(n instanceof Ti)){e.next=10;break}return e.next=7,T$(n,o);case 7:e.t1=e.sent,e.next=13;break;case 10:return e.next=12,N$(n,o);case 12:e.t1=e.sent;case 13:e.t0=e.t1;case 14:return s=e.t0,e.next=17,r(s);case 17:return u=e.sent,e.abrupt("return",(s.forEach((function(e){return e instanceof Ti&&e.dispose()})),u));case 19:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f1(e,t,n,r,a){return h1.apply(this,arguments)}function h1(){return(h1=Object(w.a)(k.a.mark((function e(t,n,r,a,i){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",d1([t],n,function(){var e=Object(w.a)(k.a.mark((function e(t){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",r(t[0]));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a,i));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var m1=[new AQ(1.603231,2.094468),new AQ(6.041143,7.080126),new AQ(2.882459,3.518061),new AQ(4.266906,5.178857),new AQ(9.041765,10.66308)],v1=[117.001,114.697,97.404],b1=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){Object(O.a)(this,n);var e={withSeparableConvs:!0,iouThreshold:.4,classes:["face"],anchors:m1,meanRgb:v1,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return t.call(this,e)}return Object(I.a)(n,[{key:"locateFaces",value:function(){var e=Object(w.a)(k.a.mark((function e(t,n){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.detect(t,n);case 2:return e.abrupt("return",e.sent.map((function(e){return new MQ(e.score,e.relativeBox,{width:e.imageWidth,height:e.imageHeight})})));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getDefaultModelName",value:function(){return"tiny_face_detector_model"}},{key:"extractParamsFromWeightMap",value:function(e){return Object(d.a)(Object(p.a)(n.prototype),"extractParamsFromWeightMap",this).call(this,e)}},{key:"anchors",get:function(){return this.config.anchors}}]),n}(s1),g1={ssdMobilenetv1:new Z0,tinyFaceDetector:new b1,tinyYolov2:new u1,faceLandmark68Net:new N0,faceLandmark68TinyNet:new T0,faceRecognitionNet:new z0,faceExpressionNet:new u0,ageGenderNet:new I0},y1=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e,r,a){var i;return Object(O.a)(this,n),(i=t.call(this)).parentTask=e,i.input=r,i.extractedFaces=a,i}return n}(l1),x1=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){return Object(O.a)(this,n),t.apply(this,arguments)}return Object(I.a)(n,[{key:"run",value:function(){var e=Object(w.a)(k.a.mark((function e(){var t,n;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.parentTask;case 2:return t=e.sent,e.next=5,d1(t,this.input,function(){var e=Object(w.a)(k.a.mark((function e(t){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all(t.map((function(e){return g1.faceExpressionNet.predictExpressions(e)}))));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.extractedFaces);case 5:return n=e.sent,e.abrupt("return",t.map((function(e,t){return l0(e,n[t])})));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"withAgeAndGender",value:function(){return new S1(this,this.input)}}]),n}(y1),k1=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){return Object(O.a)(this,n),t.apply(this,arguments)}return Object(I.a)(n,[{key:"run",value:function(){var e=Object(w.a)(k.a.mark((function e(){var t,n;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.parentTask;case 2:if(t=e.sent){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,f1(t,this.input,(function(e){return g1.faceExpressionNet.predictExpressions(e)}),this.extractedFaces);case 7:return n=e.sent,e.abrupt("return",l0(t,n));case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"withAgeAndGender",value:function(){return new N1(this,this.input)}}]),n}(y1),w1=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){return Object(O.a)(this,n),t.apply(this,arguments)}return Object(I.a)(n,[{key:"withAgeAndGender",value:function(){return new j1(this,this.input)}},{key:"withFaceDescriptors",value:function(){return new E1(this,this.input)}}]),n}(x1),O1=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){return Object(O.a)(this,n),t.apply(this,arguments)}return Object(I.a)(n,[{key:"withAgeAndGender",value:function(){return new T1(this,this.input)}},{key:"withFaceDescriptor",value:function(){return new _1(this,this.input)}}]),n}(k1),I1=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e,r,a){var i;return Object(O.a)(this,n),(i=t.call(this)).parentTask=e,i.input=r,i.extractedFaces=a,i}return n}(l1),S1=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){return Object(O.a)(this,n),t.apply(this,arguments)}return Object(I.a)(n,[{key:"run",value:function(){var e=Object(w.a)(k.a.mark((function e(){var t,n;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.parentTask;case 2:return t=e.sent,e.next=5,d1(t,this.input,function(){var e=Object(w.a)(k.a.mark((function e(t){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all(t.map((function(e){return g1.ageGenderNet.predictAgeAndGender(e)}))));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.extractedFaces);case 5:return n=e.sent,e.abrupt("return",t.map((function(e,t){var r=n[t],a=r.age;return P0(B0(e,r.gender,r.genderProbability),a)})));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"withFaceExpressions",value:function(){return new x1(this,this.input)}}]),n}(I1),N1=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){return Object(O.a)(this,n),t.apply(this,arguments)}return Object(I.a)(n,[{key:"run",value:function(){var e=Object(w.a)(k.a.mark((function e(){var t,n,r,a,i;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.parentTask;case 2:if(t=e.sent){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,f1(t,this.input,(function(e){return g1.ageGenderNet.predictAgeAndGender(e)}),this.extractedFaces);case 7:return n=e.sent,r=n.age,a=n.gender,i=n.genderProbability,e.abrupt("return",P0(B0(t,a,i),r));case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"withFaceExpressions",value:function(){return new k1(this,this.input)}}]),n}(I1),j1=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){return Object(O.a)(this,n),t.apply(this,arguments)}return Object(I.a)(n,[{key:"withFaceExpressions",value:function(){return new w1(this,this.input)}},{key:"withFaceDescriptors",value:function(){return new E1(this,this.input)}}]),n}(S1),T1=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){return Object(O.a)(this,n),t.apply(this,arguments)}return Object(I.a)(n,[{key:"withFaceExpressions",value:function(){return new O1(this,this.input)}},{key:"withFaceDescriptor",value:function(){return new _1(this,this.input)}}]),n}(N1),C1=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e,r){var a;return Object(O.a)(this,n),(a=t.call(this)).parentTask=e,a.input=r,a}return n}(l1),E1=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){return Object(O.a)(this,n),t.apply(this,arguments)}return Object(I.a)(n,[{key:"run",value:function(){var e=Object(w.a)(k.a.mark((function e(){var t;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.parentTask;case 2:return t=e.sent,e.next=5,d1(t,this.input,(function(e){return Promise.all(e.map((function(e){return g1.faceRecognitionNet.computeFaceDescriptor(e)})))}),null,(function(e){return e.landmarks.align(null,{useDlibAlignment:!0})}));case 5:return e.abrupt("return",e.sent.map((function(e,n){return L0(t[n],e)})));case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"withFaceExpressions",value:function(){return new w1(this,this.input)}},{key:"withAgeAndGender",value:function(){return new j1(this,this.input)}}]),n}(C1),_1=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){return Object(O.a)(this,n),t.apply(this,arguments)}return Object(I.a)(n,[{key:"run",value:function(){var e=Object(w.a)(k.a.mark((function e(){var t,n;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.parentTask;case 2:if(t=e.sent){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,f1(t,this.input,(function(e){return g1.faceRecognitionNet.computeFaceDescriptor(e)}),null,(function(e){return e.landmarks.align(null,{useDlibAlignment:!0})}));case 7:return n=e.sent,e.abrupt("return",L0(t,n));case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"withFaceExpressions",value:function(){return new O1(this,this.input)}},{key:"withAgeAndGender",value:function(){return new T1(this,this.input)}}]),n}(C1),A1=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e,r,a){var i;return Object(O.a)(this,n),(i=t.call(this)).parentTask=e,i.input=r,i.useTinyLandmarkNet=a,i}return Object(I.a)(n,[{key:"landmarkNet",get:function(){return this.useTinyLandmarkNet?g1.faceLandmark68TinyNet:g1.faceLandmark68Net}}]),n}(l1),R1=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){return Object(O.a)(this,n),t.apply(this,arguments)}return Object(I.a)(n,[{key:"run",value:function(){var e=Object(w.a)(k.a.mark((function e(){var t,n,r,a,i=this;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.parentTask;case 2:if(t=e.sent,n=t.map((function(e){return e.detection})),!(this.input instanceof Ti)){e.next=10;break}return e.next=7,T$(this.input,n);case 7:e.t0=e.sent,e.next=13;break;case 10:return e.next=12,N$(this.input,n);case 12:e.t0=e.sent;case 13:return r=e.t0,e.next=16,Promise.all(r.map((function(e){return i.landmarkNet.detectLandmarks(e)})));case 16:return a=e.sent,e.abrupt("return",(r.forEach((function(e){return e instanceof Ti&&e.dispose()})),t.filter((function(e,t){return a[t]})).map((function(e,t){return f0(e,a[t])}))));case 18:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"withFaceExpressions",value:function(){return new w1(this,this.input)}},{key:"withAgeAndGender",value:function(){return new j1(this,this.input)}},{key:"withFaceDescriptors",value:function(){return new E1(this,this.input)}}]),n}(A1),D1=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){return Object(O.a)(this,n),t.apply(this,arguments)}return Object(I.a)(n,[{key:"run",value:function(){var e=Object(w.a)(k.a.mark((function e(){var t,n,r,a;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.parentTask;case 2:if(t=e.sent){e.next=5;break}return e.abrupt("return");case 5:if(n=t.detection,!(this.input instanceof Ti)){e.next=12;break}return e.next=9,T$(this.input,[n]);case 9:e.t0=e.sent,e.next=15;break;case 12:return e.next=14,N$(this.input,[n]);case 14:e.t0=e.sent;case 15:return r=e.t0,e.next=18,this.landmarkNet.detectLandmarks(r[0]);case 18:return a=e.sent,e.abrupt("return",(r.forEach((function(e){return e instanceof Ti&&e.dispose()})),f0(t,a)));case 20:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"withFaceExpressions",value:function(){return new O1(this,this.input)}},{key:"withAgeAndGender",value:function(){return new T1(this,this.input)}},{key:"withFaceDescriptor",value:function(){return new _1(this,this.input)}}]),n}(A1),F1=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Y0;return Object(O.a)(this,n),(r=t.call(this)).input=e,r.options=a,r}return n}(l1),M1=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){return Object(O.a)(this,n),t.apply(this,arguments)}return Object(I.a)(n,[{key:"run",value:function(){var e=Object(w.a)(k.a.mark((function e(){var t,n,r;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.input,!((n=this.options)instanceof c1)){e.next=5;break}r=g1.tinyFaceDetector.locateFaces(t,n),e.next=14;break;case 5:if(!(n instanceof Y0)){e.next=9;break}r=g1.ssdMobilenetv1.locateFaces(t,n),e.next=14;break;case 9:if(!(n instanceof o1)){e.next=13;break}r=g1.tinyYolov2.locateFaces(t,n),e.next=14;break;case 13:throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | TinyYolov2Options");case 14:return e.abrupt("return",r);case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"runAndExtendWithFaceDetections",value:function(){var e=this;return new Promise((function(t,n){e.run().then((function(e){return t(e.map((function(e){return YQ({},e)})))})).catch((function(e){return n(e)}))}))}},{key:"withFaceLandmarks",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new R1(this.runAndExtendWithFaceDetections(),this.input,e)}},{key:"withFaceExpressions",value:function(){return new x1(this.runAndExtendWithFaceDetections(),this.input)}},{key:"withAgeAndGender",value:function(){return new S1(this.runAndExtendWithFaceDetections(),this.input)}}]),n}(F1),z1=function(e){Object(b.a)(n,e);var t=Object(g.a)(n);function n(){return Object(O.a)(this,n),t.apply(this,arguments)}return Object(I.a)(n,[{key:"run",value:function(){var e=Object(w.a)(k.a.mark((function e(){var t,n;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new M1(this.input,this.options);case 2:return t=e.sent,n=t[0],e.abrupt("return",(t.forEach((function(e){e.score>n.score&&(n=e)})),n));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"runAndExtendWithFaceDetection",value:function(){var e=this;return new Promise(function(){var t=Object(w.a)(k.a.mark((function t(n){var r;return k.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.run();case 2:r=t.sent,n(r?YQ({},r):void 0);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},{key:"withFaceLandmarks",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new D1(this.runAndExtendWithFaceDetection(),this.input,e)}},{key:"withFaceExpressions",value:function(){return new k1(this.runAndExtendWithFaceDetection(),this.input)}},{key:"withAgeAndGender",value:function(){return new N1(this.runAndExtendWithFaceDetection(),this.input)}}]),n}(F1);function L1(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Y0;return new z1(e,t)}function P1(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Y0;return new M1(e,t)}var B1=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.6;Object(O.a)(this,e),this._distanceThreshold=n;var r=Array.isArray(t)?t:[t];if(!r.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var a=1,i=function(){return"person ".concat(a++)};this._labeledDescriptors=r.map((function(e){if(e instanceof KQ)return e;if(e instanceof Float32Array)return new KQ(i(),[e]);if(e.descriptor&&e.descriptor instanceof Float32Array)return new KQ(i(),[e.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")}))}return Object(I.a)(e,[{key:"computeMeanDistance",value:function(e,t){return t.map((function(t){return function(e,t){if(e.length!==t.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var n=Array.from(e),r=Array.from(t);return Math.sqrt(n.map((function(e,t){return e-r[t]})).reduce((function(e,t){return e+t*t}),0))}(t,e)})).reduce((function(e,t){return e+t}),0)/(t.length||1)}},{key:"matchDescriptor",value:function(e){var t=this;return this.labeledDescriptors.map((function(n){var r=n.descriptors,a=n.label;return new qQ(a,t.computeMeanDistance(e,r))})).reduce((function(e,t){return e.distance<t.distance?e:t}))}},{key:"findBestMatch",value:function(e){var t=this.matchDescriptor(e);return t.distance<this._distanceThreshold?t:new qQ("unknown",t.distance)}},{key:"toJSON",value:function(){return{distanceThreshold:this._distanceThreshold,labeledDescriptors:this._labeledDescriptors.map((function(e){return e.toJSON()}))}}},{key:"labeledDescriptors",get:function(){return this._labeledDescriptors}},{key:"distanceThreshold",get:function(){return this._distanceThreshold}}],[{key:"fromJSON",value:function(t){return new e(t.labeledDescriptors.map((function(e){return KQ.fromJSON(e)})),t.distanceThreshold)}}]),e}();function W1(e,t){var n=new bQ(t.width,t.height),r=n.width,a=n.height;if(r<=0||a<=0)throw new Error("resizeResults - invalid dimensions: ".concat(JSON.stringify({width:r,height:a})));if(Array.isArray(e))return e.map((function(e){return W1(e,{width:r,height:a})}));if(p0(e)){var i=e.detection.forSize(r,a),o=e.unshiftedLandmarks.forSize(i.box.width,i.box.height);return f0(YQ(e,i),o)}return XQ(e)?YQ(e,e.detection.forSize(r,a)):e instanceof GQ||e instanceof MQ?e.forSize(r,a):e}}).call(this,"/index.js",n(144),"/",n(143),n(152).Buffer,n(227).setImmediate)},function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var r=n(12),a=n(7),i=n(6),o=n(18),s=n(33),u=n(9),c=n(16);var l=Object(u.b)({conv2d_:function(e,t,n,u){var l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],p=arguments.length>6?arguments[6]:void 0,f=Object(i.a)(e,"x","conv2d","float32"),h=Object(i.a)(t,"filter","conv2d","float32"),m=f,v=!1;3===f.rank&&(v=!0,m=Object(c.a)(f,[1,f.shape[0],f.shape[1],f.shape[2]])),o.b(4===m.rank,(function(){return"Error in conv2d: input must be rank 4, but got rank ".concat(m.rank,".")})),o.b(4===h.rank,(function(){return"Error in conv2d: filter must be rank 4, but got rank "+"".concat(h.rank,".")})),s.a("conv2d",u,p);var b="NHWC"===l?m.shape[3]:m.shape[1];o.b(b===h.shape[2],(function(){return"Error in conv2d: depth of input (".concat(b,") must match ")+"input depth for filter ".concat(h.shape[2],".")})),o.b(s.i(n,d),(function(){return"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(d,"'")}));var g={x:m,filter:h},y={strides:n,pad:u,dataFormat:l,dilations:d,dimRoundingMode:p},x=r.a.runKernel(a.D,g,y);return v?Object(c.a)(x,[x.shape[1],x.shape[2],x.shape[3]]):x}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var r=n(3),a=n(12),i=n(7),o=n(32),s=n(6),u=n(26),c=n(9);var l=Object(c.b)({greaterEqual_:function(e,t){var n=Object(s.a)(e,"a","greaterEqual","string_or_numeric"),c=Object(s.a)(t,"b","greaterEqual","string_or_numeric"),l=Object(o.makeTypesMatch)(n,c),d=Object(r.a)(l,2);n=d[0],c=d[1],Object(u.assertAndGetBroadcastShape)(n.shape,c.shape);var p={a:n,b:c};return a.a.runKernel(i.rb,p)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(7),i=n(6),o=n(9);var s=Object(o.b)({clone_:function(e){var t={x:Object(i.a)(e,"x","clone","string_or_numeric")};return r.a.runKernel(a.tb,t)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(7),i=n(6),o=n(9);var s=Object(o.b)({sigmoid_:function(e){var t={x:Object(i.a)(e,"x","sigmoid","float32")};return r.a.runKernel(a.Fc,t)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(7),i=n(6),o=n(9);var s=Object(o.b)({max_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=Object(i.a)(e,"x","max"),s={x:o},u={reductionIndices:t,keepDims:n};return r.a.runKernel(a.Kb,s,u)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(12),a=n(7),i=n(6),o=n(18),s=n(9);var u=Object(s.b)({tile_:function(e,t){var n=Object(i.a)(e,"x","tile","string_or_numeric");o.b(n.rank===t.length,(function(){return"Error in transpose: rank of input ".concat(n.rank," ")+"must match length of reps ".concat(t,".")}));var s={x:n},u={reps:t};return r.a.runKernel(a.fd,s,u)}})},function(e,t,n){"use strict";n.d(t,"b",(function(){return s})),n.d(t,"d",(function(){return c})),n.d(t,"f",(function(){return d})),n.d(t,"c",(function(){return p})),n.d(t,"e",(function(){return h})),n.d(t,"a",(function(){return m}));var r=n(1),a=n.n(r),i=n(8),o=n(0);function s(e,t){return u(e,t)}function u(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Map,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Set;if(null==e)return null;if("function"===typeof Blob&&e instanceof Blob)return e.slice();if(r.has(e))throw new Error("Circular references are not supported.");if(n.has(e))return n.get(e);var a=t(e);if(a.recurse&&null!==a.value)throw new Error("A deep map function may not return both a value and recurse=true.");if(a.recurse){if(h(e)){var i=Array.isArray(e)?[]:{};for(var o in r.add(e),e){var s=e[o],c=u(s,t,n,r);i[o]=c}return r.delete(e),e.__proto__&&(i.__proto__=e.__proto__),i}throw new Error("Can't recurse into non-iterable type: ".concat(e))}return n.set(e,a.value),a.value}function c(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:d;return l(e,t)}function l(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Set,r=e[0];if(n.has(r))throw new Error("Circular references are not supported.");var a=t(e);if(a.recurse&&null!==a.value)throw new Error("A deep zip function may not return both a value and recurse=true.");if(a.recurse){if(h(r)){var i=Array.isArray(r)?[]:{};n.add(r);var o=function(r){var a=l(e.map((function(e){return e[r]})),t,n);i[r]=a};for(var s in r)o(s);return n.delete(r),i}throw new Error("Can't recurse into non-iterable type: ".concat(r))}return a.value}function d(e){return null===e?null:h(e[0])?{value:null,recurse:!0}:{value:e,recurse:!1}}function p(e,t){return f.apply(this,arguments)}function f(){return(f=Object(i.a)(a.a.mark((function e(t,n){var r,i,s,c,l,d,p;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=new Map,u(t,n,r),i=0,s=Array.from(r.keys());case 3:if(!(i<s.length)){e.next=14;break}if(c=s[i],l=r.get(c),!o.Df.isPromise(l)){e.next=11;break}return e.next=9,l;case 9:d=e.sent,r.set(c,d);case 11:i++,e.next=3;break;case 14:return p=u(t,n,r),e.abrupt("return",p);case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){var t=!1;o.be().get("IS_BROWSER")?t=e instanceof TextDecoder:t=e instanceof n(284).StringDecoder;return null!=e&&!ArrayBuffer.isView(e)&&(Array.isArray(e)||"object"===typeof e&&!(e instanceof o.gd)&&!(e instanceof Promise)&&!t)}function m(e){return null==e||(null===(t=e)||"object"!==typeof t&&"function"!==typeof t)||Array.isArray(e)||"object"===typeof e&&e instanceof o.gd||o.Df.isTypedArray(e);var t}},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(7),i=n(6),o=n(9);var s=Object(o.b)({log_:function(e){var t={x:Object(i.a)(e,"x","log","float32")};return r.a.runKernel(a.Eb,t)}})},function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return i}));var r=n(30);function a(){var e;Object(r.b)().getBool("IS_TEST")||Object(r.b)().getBool("PROD")||(e=console).warn.apply(e,arguments)}function i(){var e;Object(r.b)().getBool("IS_TEST")||Object(r.b)().getBool("PROD")||(e=console).log.apply(e,arguments)}},function(e,t,n){"use strict";var r,a;n.d(t,"a",(function(){return r})),function(e){e[e.DT_INVALID=0]="DT_INVALID",e[e.DT_FLOAT=1]="DT_FLOAT",e[e.DT_DOUBLE=2]="DT_DOUBLE",e[e.DT_INT32=3]="DT_INT32",e[e.DT_UINT8=4]="DT_UINT8",e[e.DT_INT16=5]="DT_INT16",e[e.DT_INT8=6]="DT_INT8",e[e.DT_STRING=7]="DT_STRING",e[e.DT_COMPLEX64=8]="DT_COMPLEX64",e[e.DT_INT64=9]="DT_INT64",e[e.DT_BOOL=10]="DT_BOOL",e[e.DT_QINT8=11]="DT_QINT8",e[e.DT_QUINT8=12]="DT_QUINT8",e[e.DT_QINT32=13]="DT_QINT32",e[e.DT_BFLOAT16=14]="DT_BFLOAT16",e[e.DT_QINT16=15]="DT_QINT16",e[e.DT_QUINT16=16]="DT_QUINT16",e[e.DT_UINT16=17]="DT_UINT16",e[e.DT_COMPLEX128=18]="DT_COMPLEX128",e[e.DT_HALF=19]="DT_HALF",e[e.DT_RESOURCE=20]="DT_RESOURCE",e[e.DT_VARIANT=21]="DT_VARIANT",e[e.DT_UINT32=22]="DT_UINT32",e[e.DT_UINT64=23]="DT_UINT64",e[e.DT_FLOAT_REF=101]="DT_FLOAT_REF",e[e.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",e[e.DT_INT32_REF=103]="DT_INT32_REF",e[e.DT_UINT8_REF=104]="DT_UINT8_REF",e[e.DT_INT16_REF=105]="DT_INT16_REF",e[e.DT_INT8_REF=106]="DT_INT8_REF",e[e.DT_STRING_REF=107]="DT_STRING_REF",e[e.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",e[e.DT_INT64_REF=109]="DT_INT64_REF",e[e.DT_BOOL_REF=110]="DT_BOOL_REF",e[e.DT_QINT8_REF=111]="DT_QINT8_REF",e[e.DT_QUINT8_REF=112]="DT_QUINT8_REF",e[e.DT_QINT32_REF=113]="DT_QINT32_REF",e[e.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",e[e.DT_QINT16_REF=115]="DT_QINT16_REF",e[e.DT_QUINT16_REF=116]="DT_QUINT16_REF",e[e.DT_UINT16_REF=117]="DT_UINT16_REF",e[e.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",e[e.DT_HALF_REF=119]="DT_HALF_REF",e[e.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",e[e.DT_VARIANT_REF=121]="DT_VARIANT_REF",e[e.DT_UINT32_REF=122]="DT_UINT32_REF",e[e.DT_UINT64_REF=123]="DT_UINT64_REF"}(r||(r={})),function(e){!function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"}(e.CheckpointFormatVersion||(e.CheckpointFormatVersion={}))}(a||(a={}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return s})),n.d(t,"c",(function(){return u}));var r=n(15);function a(e,t,n){var r=function(e,t,n){return function(e,t,n){var r=0,a=e.length,i=0,o=!1;for(;r<a;){var s=n(t,e[i=r+(a-r>>>1)]);s>0?r=i+1:(a=i,o=!s)}return o?r:-r-1}(e,t,n||i)}(e,t,n),a=r<0?-(r+1):r;e.splice(a,0,t)}function i(e,t){return e>t?1:e<t?-1:0}function o(e,t,n,r,a){return c(e,t,n,r,a,0)}function s(e,t,n,r,a,i){return c(e,t,n,r,a,0,!1,i,!0)}function u(e,t,n,r,a,i){return c(e,t,n,r,a,i,!0)}function c(e,t,n,i,o,s){for(var u=arguments.length>6&&void 0!==arguments[6]&&arguments[6],c=arguments.length>7&&void 0!==arguments[7]&&arguments[7],f=arguments.length>8&&void 0!==arguments[8]&&arguments[8],h=[],m=0;m<t.length;m++)t[m]>o&&h.push({score:t[m],boxIndex:m,suppressBeginIndex:0});h.sort(p);for(var v=s>0?-.5/s:0,b=[],g=[];b.length<n&&h.length>0;){var y=h.pop(),x=y.score,k=y.boxIndex,w=y.suppressBeginIndex;if(x<o)break;for(var O=!1,I=b.length-1;I>=w;--I){var S=l(e,k,b[I]);if(S>=i){O=!0;break}if(y.score=y.score*d(i,v,S),y.score<=o)break}y.suppressBeginIndex=b.length,O||(y.score===x?(b.push(k),g.push(y.score)):y.score>o&&a(h,y,p))}var N=b.length,j=n-N;c&&j>0&&(b.push.apply(b,Object(r.a)(new Array(j).fill(0))),g.push.apply(g,Object(r.a)(new Array(j).fill(0))));var T={selectedIndices:b};return u&&(T.selectedScores=g),f&&(T.validOutputs=N),T}function l(e,t,n){var r=e.subarray(4*t,4*t+4),a=e.subarray(4*n,4*n+4),i=Math.min(r[0],r[2]),o=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(a[0],a[2]),l=Math.min(a[1],a[3]),d=Math.max(a[0],a[2]),p=Math.max(a[1],a[3]),f=(s-i)*(u-o),h=(d-c)*(p-l);if(f<=0||h<=0)return 0;var m=Math.max(i,c),v=Math.max(o,l),b=Math.min(s,d),g=Math.min(u,p),y=Math.max(b-m,0)*Math.max(g-v,0);return y/(f+h-y)}function d(e,t,n){var r=Math.exp(t*n*n);return n<=e?r:0}function p(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(12),a=n(7);function i(e,t,n){var i={shape:e,value:t,dtype:n};return r.a.runKernel(a.gb,{},i)}},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(12),a=n(18),i=n(63);function o(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32";if("complex64"===t){var n=o(e,"float32"),s=o(e,"float32");return Object(i.a)(n,s)}var u=Object(a.F)(Object(a.O)(e),t);return r.a.makeTensor(u,e,t)}},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(7),i=n(6),o=n(9);var s=Object(o.b)({relu_:function(e){var t={x:Object(i.a)(e,"x","relu")};return r.a.runKernel(a.qc,t)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(7),i=n(6),o=n(9);var s=Object(o.b)({step_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Object(i.a)(e,"x","step"),o={x:n},s={alpha:t};return r.a.runKernel(a.Wc,o,s)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(12),a=n(7),i=n(6),o=n(18),s=n(9);var u=Object(s.b)({unstack_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Object(i.a)(e,"x","unstack","string_or_numeric");o.b(t>=-n.shape.length&&t<n.shape.length,(function(){return"Axis = ".concat(t," is not in [-").concat(n.shape.length,", ").concat(n.shape.length,")")}));var s={value:n},u={axis:t};return r.a.runKernel(a.kd,s,u)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(12),a=n(7),i=n(6),o=n(18),s=n(16);var u=n(9);var c=Object(u.b)({batchNorm_:function(e,t,n,u,c,l){null==l&&(l=.001);var d,p,f=Object(i.a)(e,"x","batchNorm"),h=Object(i.a)(t,"mean","batchNorm"),m=Object(i.a)(n,"variance","batchNorm");null!=c&&(d=Object(i.a)(c,"scale","batchNorm")),null!=u&&(p=Object(i.a)(u,"offset","batchNorm")),o.b(h.rank===m.rank,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),o.b(null==p||h.rank===p.rank,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),o.b(null==d||h.rank===d.rank,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}));var v={x:function(e){return 0===e.rank||1===e.rank?Object(s.a)(e,[1,1,1,e.size]):2===e.rank?Object(s.a)(e,[1,1,e.shape[0],e.shape[1]]):3===e.rank?Object(s.a)(e,[1,e.shape[0],e.shape[1],e.shape[2]]):e}(f),scale:d,offset:p,mean:h,variance:m},b={varianceEpsilon:l},g=r.a.runKernel(a.lb,v,b);return Object(s.a)(g,f.shape)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(6),a=n(62);function i(e,t,n){var i=Object(r.c)(e,n);return Object(a.a)(e,t,i,n)}},function(e,t,n){"use strict";n.d(t,"c",(function(){return a.me})),n.d(t,"b",(function(){return a.Wd})),n.d(t,"a",(function(){return a.Fd})),n.d(t,"d",(function(){return nd}));var r={};n.r(r),n.d(r,"abs",(function(){return dl.b})),n.d(r,"acos",(function(){return dl.c})),n.d(r,"acosh",(function(){return dl.d})),n.d(r,"add",(function(){return dl.e})),n.d(r,"addN",(function(){return dl.f})),n.d(r,"all",(function(){return dl.g})),n.d(r,"any",(function(){return dl.h})),n.d(r,"argMax",(function(){return dl.i})),n.d(r,"argMin",(function(){return dl.j})),n.d(r,"asin",(function(){return dl.k})),n.d(r,"asinh",(function(){return dl.l})),n.d(r,"atan",(function(){return dl.m})),n.d(r,"atan2",(function(){return dl.n})),n.d(r,"atanh",(function(){return dl.o})),n.d(r,"avgPool",(function(){return dl.p})),n.d(r,"avgPool3d",(function(){return dl.q})),n.d(r,"basicLSTMCell",(function(){return dl.r})),n.d(r,"batchToSpaceND",(function(){return dl.w})),n.d(r,"batchNorm",(function(){return dl.s})),n.d(r,"batchNorm2d",(function(){return dl.t})),n.d(r,"batchNorm3d",(function(){return dl.u})),n.d(r,"batchNorm4d",(function(){return dl.v})),n.d(r,"bincount",(function(){return dl.x})),n.d(r,"broadcastArgs",(function(){return dl.z})),n.d(r,"broadcastTo",(function(){return dl.A})),n.d(r,"buffer",(function(){return dl.B})),n.d(r,"cast",(function(){return dl.C})),n.d(r,"ceil",(function(){return dl.D})),n.d(r,"clipByValue",(function(){return dl.E})),n.d(r,"clone",(function(){return dl.F})),n.d(r,"complex",(function(){return dl.G})),n.d(r,"concat",(function(){return dl.H})),n.d(r,"concat1d",(function(){return dl.I})),n.d(r,"concat2d",(function(){return dl.J})),n.d(r,"concat3d",(function(){return dl.K})),n.d(r,"concat4d",(function(){return dl.L})),n.d(r,"conv1d",(function(){return dl.M})),n.d(r,"conv2d",(function(){return dl.N})),n.d(r,"conv2dTranspose",(function(){return dl.O})),n.d(r,"conv3d",(function(){return dl.P})),n.d(r,"conv3dTranspose",(function(){return dl.Q})),n.d(r,"cos",(function(){return dl.R})),n.d(r,"cosh",(function(){return dl.S})),n.d(r,"cumprod",(function(){return dl.U})),n.d(r,"cumsum",(function(){return dl.V})),n.d(r,"denseBincount",(function(){return dl.W})),n.d(r,"depthToSpace",(function(){return dl.X})),n.d(r,"depthwiseConv2d",(function(){return dl.Y})),n.d(r,"diag",(function(){return dl.Z})),n.d(r,"dilation2d",(function(){return dl.ab})),n.d(r,"div",(function(){return dl.bb})),n.d(r,"divNoNan",(function(){return dl.cb})),n.d(r,"dot",(function(){return dl.db})),n.d(r,"einsum",(function(){return dl.fb})),n.d(r,"elu",(function(){return dl.gb})),n.d(r,"equal",(function(){return dl.ib})),n.d(r,"erf",(function(){return dl.jb})),n.d(r,"euclideanNorm",(function(){return dl.kb})),n.d(r,"exp",(function(){return dl.lb})),n.d(r,"expandDims",(function(){return dl.mb})),n.d(r,"expm1",(function(){return dl.nb})),n.d(r,"eye",(function(){return dl.ob})),n.d(r,"fill",(function(){return dl.qb})),n.d(r,"floor",(function(){return dl.rb})),n.d(r,"floorDiv",(function(){return dl.sb})),n.d(r,"gather",(function(){return dl.ub})),n.d(r,"greater",(function(){return dl.wb})),n.d(r,"greaterEqual",(function(){return dl.xb})),n.d(r,"imag",(function(){return dl.zb})),n.d(r,"isFinite",(function(){return dl.Db})),n.d(r,"isInf",(function(){return dl.Eb})),n.d(r,"isNaN",(function(){return dl.Fb})),n.d(r,"leakyRelu",(function(){return dl.Gb})),n.d(r,"less",(function(){return dl.Hb})),n.d(r,"lessEqual",(function(){return dl.Ib})),n.d(r,"linspace",(function(){return dl.Kb})),n.d(r,"localResponseNormalization",(function(){return dl.Lb})),n.d(r,"log",(function(){return dl.Mb})),n.d(r,"log1p",(function(){return dl.Nb})),n.d(r,"logSigmoid",(function(){return dl.Ob})),n.d(r,"logSoftmax",(function(){return dl.Pb})),n.d(r,"logSumExp",(function(){return dl.Qb})),n.d(r,"logicalAnd",(function(){return dl.Rb})),n.d(r,"logicalNot",(function(){return dl.Sb})),n.d(r,"logicalOr",(function(){return dl.Tb})),n.d(r,"logicalXor",(function(){return dl.Ub})),n.d(r,"lowerBound",(function(){return dl.Wb})),n.d(r,"matMul",(function(){return dl.Xb})),n.d(r,"max",(function(){return dl.Yb})),n.d(r,"maxPool",(function(){return dl.Zb})),n.d(r,"maxPool3d",(function(){return dl.ac})),n.d(r,"maxPoolWithArgmax",(function(){return dl.bc})),n.d(r,"maximum",(function(){return dl.cc})),n.d(r,"mean",(function(){return dl.dc})),n.d(r,"meshgrid",(function(){return dl.ec})),n.d(r,"min",(function(){return dl.fc})),n.d(r,"minimum",(function(){return dl.gc})),n.d(r,"mirrorPad",(function(){return dl.hc})),n.d(r,"mod",(function(){return dl.ic})),n.d(r,"moments",(function(){return dl.jc})),n.d(r,"mul",(function(){return dl.lc})),n.d(r,"multiRNNCell",(function(){return dl.mc})),n.d(r,"multinomial",(function(){return dl.nc})),n.d(r,"neg",(function(){return dl.oc})),n.d(r,"notEqual",(function(){return dl.qc})),n.d(r,"oneHot",(function(){return dl.rc})),n.d(r,"ones",(function(){return dl.sc})),n.d(r,"onesLike",(function(){return dl.tc})),n.d(r,"outerProduct",(function(){return dl.vc})),n.d(r,"pad",(function(){return dl.wc})),n.d(r,"pad1d",(function(){return dl.xc})),n.d(r,"pad2d",(function(){return dl.yc})),n.d(r,"pad3d",(function(){return dl.zc})),n.d(r,"pad4d",(function(){return dl.Ac})),n.d(r,"pool",(function(){return dl.Bc})),n.d(r,"pow",(function(){return dl.Cc})),n.d(r,"prelu",(function(){return dl.Dc})),n.d(r,"print",(function(){return dl.Ec})),n.d(r,"prod",(function(){return dl.Fc})),n.d(r,"raggedGather",(function(){return dl.Gc})),n.d(r,"raggedTensorToTensor",(function(){return dl.Hc})),n.d(r,"rand",(function(){return dl.Ic})),n.d(r,"randomGamma",(function(){return dl.Jc})),n.d(r,"randomNormal",(function(){return dl.Kc})),n.d(r,"randomStandardNormal",(function(){return dl.Lc})),n.d(r,"randomUniform",(function(){return dl.Mc})),n.d(r,"range",(function(){return dl.Nc})),n.d(r,"real",(function(){return dl.Oc})),n.d(r,"reciprocal",(function(){return dl.Pc})),n.d(r,"relu",(function(){return dl.Qc})),n.d(r,"relu6",(function(){return dl.Rc})),n.d(r,"reshape",(function(){return dl.Sc})),n.d(r,"reverse",(function(){return dl.Tc})),n.d(r,"reverse1d",(function(){return dl.Uc})),n.d(r,"reverse2d",(function(){return dl.Vc})),n.d(r,"reverse3d",(function(){return dl.Wc})),n.d(r,"reverse4d",(function(){return dl.Xc})),n.d(r,"round",(function(){return dl.Zc})),n.d(r,"rsqrt",(function(){return dl.ad})),n.d(r,"scalar",(function(){return dl.bd})),n.d(r,"selu",(function(){return dl.ed})),n.d(r,"separableConv2d",(function(){return dl.fd})),n.d(r,"setdiff1dAsync",(function(){return dl.gd})),n.d(r,"sigmoid",(function(){return dl.hd})),n.d(r,"sign",(function(){return dl.id})),n.d(r,"sin",(function(){return dl.kd})),n.d(r,"sinh",(function(){return dl.ld})),n.d(r,"slice",(function(){return dl.md})),n.d(r,"slice1d",(function(){return dl.nd})),n.d(r,"slice2d",(function(){return dl.od})),n.d(r,"slice3d",(function(){return dl.pd})),n.d(r,"slice4d",(function(){return dl.qd})),n.d(r,"softmax",(function(){return dl.rd})),n.d(r,"softplus",(function(){return dl.sd})),n.d(r,"spaceToBatchND",(function(){return dl.td})),n.d(r,"fft",(function(){return dl.pb})),n.d(r,"ifft",(function(){return dl.yb})),n.d(r,"irfft",(function(){return dl.Cb})),n.d(r,"rfft",(function(){return dl.Yc})),n.d(r,"split",(function(){return dl.xd})),n.d(r,"sqrt",(function(){return dl.yd})),n.d(r,"square",(function(){return dl.zd})),n.d(r,"squaredDifference",(function(){return dl.Ad})),n.d(r,"squeeze",(function(){return dl.Bd})),n.d(r,"stack",(function(){return dl.Cd})),n.d(r,"step",(function(){return dl.Dd})),n.d(r,"stridedSlice",(function(){return dl.Ed})),n.d(r,"sub",(function(){return dl.Gd})),n.d(r,"sum",(function(){return dl.Hd})),n.d(r,"tan",(function(){return dl.Id})),n.d(r,"tanh",(function(){return dl.Jd})),n.d(r,"tensor",(function(){return dl.Kd})),n.d(r,"tensor1d",(function(){return dl.Ld})),n.d(r,"tensor2d",(function(){return dl.Md})),n.d(r,"tensor3d",(function(){return dl.Nd})),n.d(r,"tensor4d",(function(){return dl.Od})),n.d(r,"tensor5d",(function(){return dl.Pd})),n.d(r,"tensor6d",(function(){return dl.Qd})),n.d(r,"tile",(function(){return dl.Rd})),n.d(r,"topk",(function(){return dl.Sd})),n.d(r,"truncatedNormal",(function(){return dl.Ud})),n.d(r,"unique",(function(){return dl.Vd})),n.d(r,"unsortedSegmentSum",(function(){return dl.Wd})),n.d(r,"unstack",(function(){return dl.Xd})),n.d(r,"upperBound",(function(){return dl.Yd})),n.d(r,"variable",(function(){return dl.Zd})),n.d(r,"where",(function(){return dl.ae})),n.d(r,"whereAsync",(function(){return dl.be})),n.d(r,"zeros",(function(){return dl.ce})),n.d(r,"zerosLike",(function(){return dl.de})),n.d(r,"booleanMaskAsync",(function(){return dl.y})),n.d(r,"transpose",(function(){return dl.Td})),n.d(r,"norm",(function(){return dl.pc})),n.d(r,"movingAverage",(function(){return dl.kc})),n.d(r,"scatterND",(function(){return dl.cd})),n.d(r,"searchSorted",(function(){return dl.dd})),n.d(r,"sparseToDense",(function(){return dl.vd})),n.d(r,"gatherND",(function(){return dl.vb})),n.d(r,"dropout",(function(){return dl.eb})),n.d(r,"enclosingPowerOfTwo",(function(){return dl.hb})),n.d(r,"cosineWindow",(function(){return dl.T})),n.d(r,"inTopKAsync",(function(){return dl.Bb})),n.d(r,"op",(function(){return dl.uc})),n.d(r,"OP_SCOPE_SUFFIX",(function(){return dl.a})),n.d(r,"image",(function(){return dl.Ab})),n.d(r,"linalg",(function(){return dl.Jb})),n.d(r,"losses",(function(){return dl.Vb})),n.d(r,"spectral",(function(){return dl.wd})),n.d(r,"fused",(function(){return dl.tb})),n.d(r,"signal",(function(){return dl.jd})),n.d(r,"sparse",(function(){return dl.ud})),n.d(r,"string",(function(){return dl.Fd}));var a=n(0),i=n(3),o=n(7),s=n(22),u=n(17),c=n(91),l={kernelName:o.a,inputsToSave:["x"],gradFunc:function(e,t){var n=Object(i.a)(t,1)[0];return{x:function(){return Object(u.a)(e,Object(c.a)(Object(s.a)(n,"float32"),-1))}}}},d=n(25),p=n(38),f=n(28),h=n(47),m=n(34),v=n(24),b={kernelName:o.b,inputsToSave:["x"],gradFunc:function(e,t){var n=Object(i.a)(t,1)[0];return{x:function(){var t=Object(m.a)(Object(s.a)(n,"float32")),r=Object(h.a)(Object(v.a)(Object(f.a)(1),t));return Object(p.a)(Object(d.a)(e,r))}}}},g={kernelName:o.c,inputsToSave:["x"],gradFunc:function(e,t){var n=Object(i.a)(t,1)[0];return{x:function(){var t=Object(h.a)(Object(v.a)(Object(m.a)(Object(s.a)(n,"float32")),1));return Object(d.a)(e,t)}}}},y=n(26),x=n(16),k=n(27),w={kernelName:o.d,inputsToSave:["a","b"],gradFunc:function(e,t){var n=Object(i.a)(t,2),r=n[0],a=n[1],o=y.assertAndGetBroadcastShape(r.shape,a.shape);return{a:function(){var t=e,n=y.getReductionAxes(r.shape,o);return n.length>0&&(t=Object(k.a)(t,n)),Object(x.a)(t,r.shape)},b:function(){var t=e,n=y.getReductionAxes(a.shape,o);return n.length>0&&(t=Object(k.a)(t,n)),Object(x.a)(t,a.shape)}}}},O={kernelName:o.e,saveAllInputs:!0,gradFunc:function(e,t){var n={};return t.forEach((function(t,r){n[r]=function(){return e.clone()}})),n}},I=n(29),S={kernelName:o.h,inputsToSave:["x"],gradFunc:function(e,t){var n=Object(i.a)(t,1)[0];return{x:function(){return Object(I.a)(n)}}}},N={kernelName:o.i,inputsToSave:["x"],gradFunc:function(e,t){var n=Object(i.a)(t,1)[0];return{x:function(){return Object(I.a)(n)}}}},j={kernelName:o.j,inputsToSave:["x"],gradFunc:function(e,t){var n=Object(i.a)(t,1)[0];return{x:function(){return Object(d.a)(e,Object(h.a)(Object(v.a)(Object(f.a)(1),Object(m.a)(Object(s.a)(n,"float32")))))}}}},T=n(23),C={kernelName:o.k,inputsToSave:["x"],gradFunc:function(e,t){var n=Object(i.a)(t,1)[0];return{x:function(){var t=Object(h.a)(Object(T.a)(Object(f.a)(1),Object(m.a)(Object(s.a)(n,"float32"))));return Object(d.a)(e,t)}}}},E={kernelName:o.m,inputsToSave:["a","b"],gradFunc:function(e,t){var n=Object(i.a)(t,2),r=n[0],a=n[1],o=Object(y.assertAndGetBroadcastShape)(r.shape,a.shape);return{a:function(){var t=Object(T.a)(Object(m.a)(r),Object(m.a)(a)),n=Object(u.a)(e,Object(d.a)(a,t)),i=Object(y.getReductionAxes)(r.shape,o);return i.length>0&&(n=Object(k.a)(n,i)),Object(x.a)(n,r.shape)},b:function(){var t=Object(T.a)(Object(m.a)(r),Object(m.a)(a)),n=Object(p.a)(Object(u.a)(e,Object(d.a)(r,t))),i=Object(y.getReductionAxes)(a.shape,o);return i.length>0&&(n=Object(k.a)(n,i)),Object(x.a)(n,a.shape)}}}},_={kernelName:o.l,inputsToSave:["x"],gradFunc:function(e,t){var n=Object(i.a)(t,1)[0];return{x:function(){return Object(d.a)(e,Object(T.a)(Object(m.a)(Object(s.a)(n,"float32")),1))}}}},A={kernelName:o.n,inputsToSave:["x"],gradFunc:function(e,t){var n=Object(i.a)(t,1)[0];return{x:function(){return Object(d.a)(e,Object(v.a)(Object(f.a)(1),Object(m.a)(Object(s.a)(n,"float32"))))}}}},R=n(12),D=n(6),F=n(18),M=n(33),z=n(9);var L=Object(z.b)({avgPool3dGrad_:function(e,t,n,r,a,i){var s=Object(D.a)(e,"dy","avgPool3dGrad"),u=Object(D.a)(t,"input","avgPool3dGrad"),c=s,l=u,d=!1;4===u.rank&&(d=!0,c=Object(x.a)(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]]),l=Object(x.a)(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]])),F.b(5===c.rank,(function(){return"Error in avgPool3dGrad: dy must be rank 5 but got rank "+"".concat(c.rank,".")})),F.b(5===l.rank,(function(){return"Error in avgPool3dGrad: input must be rank 5 but got rank "+"".concat(l.rank,".")})),Object(M.a)("avgPool3dGrad",a,i);var p={dy:c,input:l},f={filterSize:n,strides:r,pad:a,dimRoundingMode:i},h=R.a.runKernel(o.q,p,f);return d?Object(x.a)(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}}),P={kernelName:o.p,inputsToSave:["x"],gradFunc:function(e,t,n){var r=Object(i.a)(t,1)[0],a=n.filterSize,o=n.strides,s=n.pad,u=n.dimRoundingMode;return{x:function(){return L(e,r,a,o,s,u)}}}};var B=Object(z.b)({avgPoolGrad_:function(e,t,n,r,a){var i=Object(D.a)(e,"dy","avgPoolGrad"),s=Object(D.a)(t,"input","avgPoolGrad");F.b(s.rank===i.rank,(function(){return"Rank of input (".concat(s.rank,") does not match rank of dy (").concat(i.rank,")")}));var u=s,c=i,l=!1;3===s.rank&&(l=!0,u=Object(x.a)(s,[1,s.shape[0],s.shape[1],s.shape[2]]),c=Object(x.a)(i,[1,i.shape[0],i.shape[1],i.shape[2]])),F.b(4===c.rank,(function(){return"Error in avgPoolGrad: dy must be rank 4 but got rank "+"".concat(c.rank,".")})),F.b(4===u.rank,(function(){return"Error in avgPoolGrad: input must be rank 4 but got rank "+"".concat(u.rank,".")}));var d={dy:c,input:u},p={filterSize:n,strides:r,pad:a},f=R.a.runKernel(o.r,d,p);return l?Object(x.a)(f,[f.shape[1],f.shape[2],f.shape[3]]):f}}),W={kernelName:o.o,inputsToSave:["x"],gradFunc:function(e,t,n){var r=Object(i.a)(t,1)[0],a=n.filterSize,o=n.strides,s=n.pad;return{x:function(){return B(e,r,a,o,s)}}}},U=n(36),V={kernelName:o.s,inputsToSave:["a","b"],gradFunc:function(e,t,n){var r=Object(i.a)(t,2),a=r[0],o=r[1],s=n.transposeA,u=n.transposeB;return s||u?!s&&u?{a:function(){return Object(U.a)(e,o,!1,!1)},b:function(){return Object(U.a)(e,a,!0,!1)}}:s&&!u?{a:function(){return Object(U.a)(o,e,!1,!0)},b:function(){return Object(U.a)(a,e,!1,!1)}}:{a:function(){return Object(U.a)(o,e,!0,!0)},b:function(){return Object(U.a)(e,a,!0,!0)}}:{a:function(){return Object(U.a)(e,o,!1,!0)},b:function(){return Object(U.a)(a,e,!0,!1)}}}},G=n(108),H={kernelName:o.t,gradFunc:function(e,t,n){var r=n.blockShape,a=n.crops;return{x:function(){return Object(G.a)(e,r,a)}}}},q={kernelName:o.w,gradFunc:function(e,t,n){for(var r=n,a=r.inputShape,i=r.shape,o=Array.from(i),s=a.length-1;s>=0;s--)if(a[s]===i[s])o[s]=1;else if(1!==a[s])throw new Error("broadcastTo(): [".concat(a,"] cannot be broadcast to [").concat(i,"]."));for(var u=[],c=0;c<o.length;c++)o[c]>1&&u.push(c);return{x:function(){return Object(k.a)(e,u,!0)}}}},K={kernelName:o.x,gradFunc:function(e){return{x:function(){return e.clone()}}}},X={kernelName:o.y,gradFunc:function(e){return{x:function(){return Object(I.a)(e)}}}},Y=n(78),Z=n(66),J=n(70),Q=n(44),$={kernelName:o.z,inputsToSave:["x"],gradFunc:function(e,t,n){var r=Object(i.a)(t,1)[0],a=n.clipValueMin,o=n.clipValueMax;return{x:function(){return Object(Q.a)(Object(J.a)(Object(Y.a)(r,a),Object(Z.a)(r,o)),e,Object(I.a)(e))}}}},ee={kernelName:o.B,inputsToSave:["x"],gradFunc:l.gradFunc},te=n(71),ne={kernelName:o.C,saveAllInputs:!0,gradFunc:function(e,t,n){var r=t.map((function(e){return e.shape})),a=n.axis,i=Object(F.I)(a,t[0].shape)[0],o=r.map((function(e){return e[i]}));return Object(te.a)(e,o,i).map((function(e){return function(){return e}}))}},re=n(142),ae=n(140),ie={kernelName:o.D,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=Object(i.a)(t,2),a=r[0],o=r[1],s=n.dilations,u=n.strides,c=n.pad,l=n.dataFormat;return F.b(M.j(s),(function(){return"Error in gradient of conv2D: dilation rates greater than 1 "+"are not yet supported in gradients. Got dilations '".concat(s,"'")})),{x:function(){return Object(ae.a)(a.shape,e,o,u,c,l)},filter:function(){return Object(re.a)(a,e,o.shape,u,c,l)}}}},oe=n(77),se={kernelName:o.F,inputsToSave:["dy","filter"],gradFunc:function(e,t,n){var r=Object(i.a)(t,2),a=r[0],o=r[1],s=n.strides,u=n.pad,c=n.dataFormat,l=n.dimRoundingMode;return{dy:function(){return Object(oe.a)(e,o,s,u,c,1,l)},filter:function(){return Object(re.a)(e,a,o.shape,s,u,c,l)}}}};var ue=Object(z.b)({conv3DBackpropFilter_:function(e,t,n,r,a){var i=e;4===e.rank&&(i=Object(x.a)(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]));var s=t;4===s.rank&&(s=Object(x.a)(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]])),F.b(5===i.rank,(function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+"".concat(i.shape,".")})),F.b(5===s.rank,(function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+"".concat(s.shape,".")})),F.b(5===n.length,(function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+"".concat(n,".")})),F.b(i.shape[4]===n[3],(function(){return"Error in conv3dDerFilter: depth of input ".concat(i.shape[4],") must ")+"match input depth in filter (".concat(n[3],".")})),F.b(s.shape[4]===n[4],(function(){return"Error in conv3dDerFilter: depth of dy (".concat(s.shape[4],") must ")+"match output depth for filter (".concat(n[4],").")}));var u={x:i,dy:s},c={strides:r,pad:a,filterShape:n};return R.a.runKernel(o.H,u,c)}}),ce=n(194),le={kernelName:o.G,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=n.dilations,a=n.strides,o=n.pad;F.b(Object(M.j)(r),(function(){return"Error in gradient of conv3D: dilation rates greater than 1 are "+"not yet supported in gradients. Got dilations '".concat(r,"'")}));var s=Object(i.a)(t,2),u=s[0],c=s[1];return{x:function(){return Object(ce.a)(u.shape,e,c,a,o)},filter:function(){return ue(u,e,c.shape,a,o)}}}},de=n(181),pe={kernelName:o.J,inputsToSave:["x"],gradFunc:function(e,t){var n=Object(i.a)(t,1)[0];return{x:function(){return Object(u.a)(Object(p.a)(Object(de.a)(Object(s.a)(n,"float32"))),e)}}}},fe=n(182),he={kernelName:o.K,inputsToSave:["x"],gradFunc:function(e,t){var n=Object(i.a)(t,1)[0];return{x:function(){return Object(u.a)(Object(fe.a)(Object(s.a)(n,"float32")),e)}}}},me=n(49),ve=n(122),be=n(61),ge={kernelName:o.N,inputsToSave:["x"],gradFunc:function(e,t,n){var r=Object(i.a)(t,1)[0],a=n.axis,o=n.exclusive,s=n.reverse;return{x:function(){var t=Object(me.f)([a],r.rank),n=Object(ve.a)(e,a,o,!s);return null!=t&&(n=Object(be.a)(n,t)),n}}}},ye=n(198),xe=n(197),ke={kernelName:o.Q,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=n.dilations,a=n.strides,o=n.pad,s=n.dimRoundingMode,u=null==r?[1,1]:r;F.b(M.j(u),(function(){return"Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations "+"'".concat(u,"'")}));var c=Object(i.a)(t,2),l=c[0],d=c[1];return F.b(4===l.rank,(function(){return"Error in gradient of depthwiseConv2dNative: input must be "+"rank 4, but got rank ".concat(l.rank,".")})),F.b(4===d.rank,(function(){return"Error in gradient of depthwiseConv2dNative: filter must be "+"rank 4, but got rank ".concat(d.rank,".")})),F.b(l.shape[3]===d.shape[2],(function(){return"Error in gradient of depthwiseConv2d: number of input "+"channels (".concat(l.shape[3],") must match the inChannels dimension ")+"in filter ".concat(d.shape[2],".")})),F.b(M.i(a,u),(function(){return"Error in gradient of depthwiseConv2d: Either strides or "+"dilations must be  1. Got strides ".concat(a," and dilations ")+"'".concat(u,"'.")})),M.a("depthwiseConv2d",o,s),{x:function(){return Object(xe.a)(l.shape,e,d,a,o,u,s)},filter:function(){return Object(ye.a)(l,e,d.shape,a,o,u,s)}}}},we={kernelName:o.U,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=Object(i.a)(t,2),a=r[0],s=r[1],u={x:a,filter:s,dy:e},c={x:a,filter:s,dy:e};return{x:function(){return R.a.runKernel(o.W,u,n)},filter:function(){return R.a.runKernel(o.V,c,n)}}}},Oe={kernelName:o.Y,outputsToSave:[!0],gradFunc:function(e,t){var n={dy:e,y:Object(i.a)(t,1)[0]};return{x:function(){return R.a.runKernel(o.Z,n)}}}},Ie=n(50),Se={kernelName:o.bb,inputsToSave:["x"],gradFunc:function(e,t){var n=Object(i.a)(t,1)[0],r=Object(u.a)(Object(Ie.a)(Object(p.a)(Object(m.a)(n))),2/Math.sqrt(Math.PI));return{x:function(){return Object(u.a)(e,r)}}}},Ne={kernelName:o.cb,outputsToSave:[!0],gradFunc:function(e,t){var n=Object(i.a)(t,1)[0];return{x:function(){return Object(u.a)(e,n)}}}},je={kernelName:o.db,inputsToSave:["input"],gradFunc:function(e,t){var n=Object(i.a)(t,1)[0];return{input:function(){return Object(x.a)(e,n.shape)}}}},Te={kernelName:o.eb,inputsToSave:["x"],gradFunc:function(e,t){var n=Object(i.a)(t,1)[0];return{x:function(){return Object(u.a)(e,Object(Ie.a)(n))}}}},Ce={kernelName:o.ib,gradFunc:function(e){return{x:function(){return Object(I.a)(e)}}}},Ee={kernelName:o.jb,inputsToSave:["a","b"],gradFunc:function(e,t){var n=Object(i.a)(t,2),r=n[0],a=n[1],o=Object(y.assertAndGetBroadcastShape)(r.shape,a.shape);return{a:function(){var t=Object(d.a)(e,Object(s.a)(a,"float32")),n=Object(y.getReductionAxes)(r.shape,o);return n.length>0?Object(x.a)(Object(k.a)(t,n),r.shape):t},b:function(){var t=Object(u.a)(e,Object(s.a)(r,"float32")),n=Object(y.getReductionAxes)(a.shape,o);n.length>0&&(t=Object(x.a)(Object(k.a)(t,n),a.shape));var i=Object(m.a)(a);return Object(p.a)(Object(d.a)(t,Object(s.a)(i,"float32")))}}}},_e=n(178),Ae=n(82),Re={kernelName:o.lb,inputsToSave:["x","mean","variance","scale"],gradFunc:function(e,t,n){var r=n.varianceEpsilon,a=Object(i.a)(t,4),o=a[0],s=a[1],c=a[2],l=a[3],d=null==l?Object(f.a)(1):l,p=Object(y.getReductionAxes)(s.shape,o.shape),h=[];if(1===s.rank){for(var m=0;m<o.shape.length-1;++m)h.push(o.shape[m]);h.push(1)}var b=Object(v.a)(o,s),g=Object(u.a)(e,d),w=Object(_e.a)(Object(T.a)(c,Object(f.a)(r))),O=Object(u.a)(Object(u.a)(Object(u.a)(w,w),w),Object(f.a)(-.5));return{x:function(){return 1===s.rank?Object(x.a)(Object(u.a)(Object(u.a)(e,Object(Ae.a)(Object(x.a)(w,[1,1,1,s.shape[0]]),h)),d),o.shape):Object(x.a)(Object(u.a)(Object(u.a)(e,w),d),o.shape)},mean:function(){var e=Object(u.a)(Object(u.a)(w,Object(f.a)(-1)),g);return 1===s.rank&&(e=Object(k.a)(e,p)),Object(x.a)(e,s.shape)},variance:function(){var e=Object(u.a)(Object(u.a)(O,b),g);return 1===s.rank&&(e=Object(k.a)(e,p)),Object(x.a)(e,s.shape)},scale:function(){var t=Object(u.a)(b,w),n=Object(u.a)(e,t);return 1===s.rank&&(n=Object(k.a)(n,p)),Object(x.a)(n,s.shape)},offset:function(){var t=e;return 1===s.rank&&(t=Object(k.a)(t,p)),Object(x.a)(t,s.shape)}}}},De=n(138),Fe={kernelName:o.pb,inputsToSave:["x","indices"],gradFunc:function(e,t,n){var r=Object(i.a)(t,2),a=r[0],o=r[1],s=n.axis,u=Object(F.I)(s,a.shape)[0];return{x:function(){var t=a.shape,n=o.size,r=t.slice(0,u),i=r.length,c=t.slice(s,t.length).slice(1),l=c.length,d=Me(0,i),p=Me(i+1,i+1+l),f=ze([r,[n],c]),h=Object(x.a)(e,f),m=Object(x.a)(o,[n]),v=ze([[i],d,p]),b=Object(be.a)(h,v),g=Object(De.a)(b,m,a.shape[u]),y=Object(me.h)(v);return g=Object(be.a)(g,y)},indices:function(){return o}}}};function Me(e,t){for(var n=[],r=e;r<t;++r)n.push(r);return n}function ze(e){for(var t=[],n=0;n<e.length;++n)for(var r=0;r<e[n].length;++r)t.push(e[n][r]);return t}var Le={kernelName:o.rb,inputsToSave:["a","b"],gradFunc:function(e,t){var n=Object(i.a)(t,2),r=n[0],a=n[1];return{a:function(){return Object(I.a)(r)},b:function(){return Object(I.a)(a)}}}},Pe={kernelName:o.tb,gradFunc:function(e){return{x:function(){return Object(s.a)(e,"float32")}}}},Be={kernelName:o.vb,gradFunc:function(e){return{x:function(){return Object(I.a)(e)}}}},We={kernelName:o.wb,gradFunc:function(e){return{x:function(){return Object(I.a)(e)}}}},Ue={kernelName:o.xb,gradFunc:function(e){return{x:function(){return Object(I.a)(e)}}}},Ve=n(52),Ge={kernelName:o.Ab,inputsToSave:["x"],gradFunc:function(e,t,n){var r=Object(i.a)(t,1)[0],a=n.alpha,o=Object(Ve.a)(r,0);return{x:function(){return Object(Q.a)(o,e,Object(u.a)(e,a))}}}},He={kernelName:o.Fb,inputsToSave:["x"],gradFunc:function(e,t){var n=Object(i.a)(t,1)[0];return{x:function(){return Object(d.a)(e,Object(T.a)(n,1))}}}},qe={kernelName:o.Eb,inputsToSave:["x"],gradFunc:function(e,t){var n=Object(i.a)(t,1)[0];return{x:function(){return Object(d.a)(e,Object(s.a)(n,"float32"))}}}},Ke={kernelName:o.Gb,inputsToSave:[],outputsToSave:[!0],gradFunc:function(e,t,n){var r=Object(i.a)(t,1)[0],a=n.axis;return{logits:function(){var t=Object(Ie.a)(r);return Object(v.a)(e,Object(u.a)(Object(k.a)(e,a,!0),t))}}}};var Xe=Object(z.b)({localResponseNormalizationBackprop_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:.5,u={x:e,y:t,dy:n},c={depthRadius:r,bias:a,alpha:i,beta:s};return R.a.runKernel(o.zb,u,c)}}),Ye={kernelName:o.yb,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=Object(i.a)(t,2),a=r[0],o=r[1],s=n.depthRadius,u=n.bias,c=n.alpha,l=n.beta;return{x:function(){return Xe(a,o,e,s,u,c,l)}}}},Ze=n(102);function Je(e,t,n,r){return t.rank<n.rank&&(t=Object(x.a)(t,me.e(t.shape,r))),e.rank<n.rank&&(e=Object(x.a)(e,me.e(e.shape,r))),{x:function(){return Object(u.a)(e,Object(s.a)(Object(Ze.a)(n,t),e.dtype))}}}var Qe={kernelName:o.Kb,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=n.reductionIndices,a=t[0],i=Je(e,t[1],a,F.I(r,a.shape));return{x:function(){return i.x()}}}},$e=n(127),et={kernelName:o.Qb,inputsToSave:["a","b"],gradFunc:function(e,t){var n=Object(i.a)(t,2),r=n[0],a=n[1];return{a:function(){return Object(u.a)(e,Object(s.a)(Object(Y.a)(r,a),"float32"))},b:function(){return Object(u.a)(e,Object(s.a)(Object($e.a)(r,a),"float32"))}}}};var tt=Object(z.b)({maxPool3dGrad_:function(e,t,n,r,a,i,s){var u=Object(D.a)(e,"dy","maxPool3dGrad"),c=Object(D.a)(t,"input","maxPool3dGrad"),l=Object(D.a)(n,"output","maxPool3dGrad"),d=u,p=c,f=l,h=!1;4===c.rank&&(h=!0,d=Object(x.a)(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]]),p=Object(x.a)(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]]),f=Object(x.a)(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]])),F.b(5===d.rank,(function(){return"Error in maxPool3dGrad: dy must be rank 5 but got rank "+"".concat(d.rank,".")})),F.b(5===p.rank,(function(){return"Error in maxPool3dGrad: input must be rank 5 but got rank "+"".concat(p.rank,".")})),F.b(5===f.rank,(function(){return"Error in maxPool3dGrad: output must be rank 5 but got rank "+"".concat(f.rank,".")})),Object(M.a)("maxPool3dGrad",i,s);var m={dy:d,input:p,output:f},v={filterSize:r,strides:a,pad:i,dimRoundingMode:s},b=R.a.runKernel(o.Nb,m,v);return h?Object(x.a)(b,[b.shape[1],b.shape[2],b.shape[3],b.shape[4]]):b}}),nt={kernelName:o.Mb,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=Object(i.a)(t,2),a=r[0],o=r[1],s=n.filterSize,u=n.strides,c=n.pad,l=n.dimRoundingMode;return{x:function(){return tt(e,a,o,s,u,c,l)}}}};var rt=Object(z.b)({maxPoolGrad_:function(e,t,n,r,a,i,s){var u=Object(D.a)(e,"dy","maxPoolGrad"),c=Object(D.a)(t,"input","maxPoolGrad"),l=Object(D.a)(n,"output","maxPoolGrad");F.b(c.rank===u.rank,(function(){return"Rank of input (".concat(c.rank,") does not match rank of dy ")+"(".concat(u.rank,")")})),F.b(4===u.rank,(function(){return"Error in maxPoolGrad: dy must be rank 4 but got rank "+"".concat(u.rank,".")})),F.b(4===c.rank,(function(){return"Error in maxPoolGrad: input must be rank 4 but got rank "+"".concat(c.rank,".")})),M.a("maxPoolGrad",i,s);var d={dy:u,input:c,output:l},p={filterSize:r,strides:a,pad:i,dimRoundingMode:s};return R.a.runKernel(o.Ob,d,p)}}),at={kernelName:o.Lb,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=Object(i.a)(t,2),a=r[0],o=r[1],s=n.filterSize,u=n.strides,c=n.pad;return{x:function(){return rt(e,a,o,s,u,c)}}}},it=n(65),ot={kernelName:o.Rb,inputsToSave:["x"],gradFunc:function(e,t,n){var r=Object(i.a)(t,1)[0],a=n.axis,o=F.I(a,r.shape),s=Object(me.d)(r.shape,o)[1],c=F.O(s);return{x:function(){var t=r.shape.slice();o.forEach((function(e){t[e]=1}));var n=Object(x.a)(e,t);return Object(d.a)(Object(u.a)(n,Object(it.a)(r.shape,"float32")),c)}}}},st={kernelName:o.Sb,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=n.axis,a=Object(i.a)(t,2),o=a[0],s=Je(e,a[1],o,F.I(r,o.shape));return{x:function(){return s.x()}}}},ut={kernelName:o.Tb,inputsToSave:["a","b"],gradFunc:function(e,t){var n=Object(i.a)(t,2),r=n[0],a=n[1];return{a:function(){return Object(u.a)(e,Object(s.a)(Object(Z.a)(r,a),"float32"))},b:function(){return Object(u.a)(e,Object(s.a)(Object(Ve.a)(r,a),"float32"))}}}},ct=n(37),lt={kernelName:o.Ub,inputsToSave:["x"],gradFunc:function(e,t,n){var r=t[0],a=n.paddings.map((function(e){return e[0]}));return{x:function(){return Object(ct.a)(e,a,r.shape)}}}},dt=n(125),pt={kernelName:o.Vb,inputsToSave:["a","b"],gradFunc:function(e,t){var n=Object(i.a)(t,2),r=n[0],a=n[1],o=Object(y.assertAndGetBroadcastShape)(r.shape,a.shape);return{a:function(){var t=Object(y.getReductionAxes)(r.shape,o);return t.length>0?Object(x.a)(Object(k.a)(e,t),r.shape):e},b:function(){var t=Object(u.a)(e,Object(p.a)(Object(dt.a)(Object(d.a)(r,a)))),n=Object(y.getReductionAxes)(a.shape,o);return n.length>0?Object(x.a)(Object(k.a)(t,n),a.shape):t}}}},ft={kernelName:o.Xb,inputsToSave:["a","b"],gradFunc:function(e,t){var n=Object(i.a)(t,2),r=n[0],a=n[1],o=Object(y.assertAndGetBroadcastShape)(r.shape,a.shape);return{a:function(){var t=Object(u.a)(e,Object(s.a)(a,"float32")),n=Object(y.getReductionAxes)(r.shape,o);return n.length>0?Object(x.a)(Object(k.a)(t,n),r.shape):t},b:function(){var t=Object(u.a)(e,Object(s.a)(r,"float32")),n=Object(y.getReductionAxes)(a.shape,o);return n.length>0?Object(x.a)(Object(k.a)(t,n),a.shape):t}}}},ht={kernelName:o.Yb,gradFunc:function(e){return{x:function(){return Object(p.a)(e)}}}},mt=n(89),vt={kernelName:o.dc,inputsToSave:["indices"],gradFunc:function(e,t){var n=t[0];return{indices:function(){return Object(mt.a)(n.shape,"float32")}}}},bt={kernelName:o.ec,gradFunc:function(e){return{x:function(){return Object(I.a)(e)}}}},gt=n(92),yt={kernelName:o.fc,saveAllInputs:!0,gradFunc:function(e,t,n){var r=n.axis;return Object(gt.a)(e,r).map((function(e){return function(){return e}}))}},xt={kernelName:o.gc,inputsToSave:["x"],gradFunc:function(e,t,n){var r=t[0],a=n.paddings.map((function(e){return e[0]}));return{x:function(){return Object(ct.a)(e,a,r.shape)}}}},kt=n(84),wt=n(64),Ot={kernelName:o.hc,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:function(e,t){var n=Object(i.a)(t,3),r=n[0],a=n[1],o=n[2],c=r,l=a,d=y.assertAndGetBroadcastShape(c.shape,l.shape);return{a:function(){var t=Object(s.a)(l,"float32"),n=Object(u.a)(e,Object(u.a)(t,Object(wt.a)(c,Object(v.a)(t,Object(f.a)(1))))),r=y.getReductionAxes(c.shape,d);return r.length>0&&(n=Object(k.a)(n,r)),Object(x.a)(n,c.shape)},b:function(){var t=Object(Ve.a)(c,0),n=Object(Q.a)(t,Object(kt.a)(c),Object(I.a)(c)),r=Object(u.a)(e,Object(u.a)(o,n)),a=y.getReductionAxes(l.shape,d);return a.length>0&&(r=Object(k.a)(r,a)),Object(x.a)(r,l.shape)}}}},It={kernelName:o.ic,inputsToSave:["x","alpha"],gradFunc:function(e,t){var n=Object(i.a)(t,2),r=n[0],a=n[1],o=Object(Ve.a)(r,0);return{x:function(){return Object(Q.a)(o,e,Object(u.a)(e,a))},alpha:function(){var t=Object(Q.a)(o,Object(I.a)(e),Object(u.a)(e,r)),n=Object(y.getReductionAxes)(a.shape,e.shape);return n.length>0&&(t=Object(k.a)(t,n)),Object(x.a)(t,a.shape)}}}},St=n(149),Nt=n(113);function jt(e,t,n){var r=e.shape.length,a=r-n.length,i=St.zd.getAxesPermutation(n,r),o=e;null!=i&&(o=Object(be.a)(e,i));var s=o.shape.slice(),c=s.splice(r-n.length,n.length).reduce((function(e,t){return e*t}),1);s.push(c);var l=function(e,t,n){var r=e.shape.slice();r[n]=1;var a=Object(x.a)(t,r),i=Object(Nt.a)(e,n,!0,!1),o=Object(Nt.a)(e,n,!0,!0),s=Object(u.a)(i,o);return Object(u.a)(a,s)}(o.reshape(s),t,a);if(l=l.reshape(o.shape),null!=i){var d=St.zd.getUndoAxesPermutation(i);l=Object(be.a)(l,d)}return l}var Tt={kernelName:o.jc,inputsToSave:["x"],gradFunc:function(e,t,n){var r=Object(i.a)(t,1)[0],a=n.axis,o=[];return o=void 0===a||null===a?r.shape.map((function(e,t){return t})):"number"===typeof a?[a]:a,{x:function(){return jt(r,e,o)}}}},Ct={kernelName:o.oc,inputsToSave:["a","b"],gradFunc:function(e,t){var n=Object(i.a)(t,2),r=n[0],a=n[1],o=y.assertAndGetBroadcastShape(r.shape,a.shape);return{a:function(){var t=Object(d.a)(e,Object(s.a)(a,"float32")),n=y.getReductionAxes(r.shape,o);return n.length>0?Object(x.a)(Object(k.a)(t,n),r.shape):t},b:function(){var t=Object(u.a)(e,Object(s.a)(r,"float32")),n=y.getReductionAxes(a.shape,o);n.length>0&&(t=Object(x.a)(Object(k.a)(t,n),a.shape));var i=Object(m.a)(a);return Object(p.a)(Object(d.a)(t,Object(s.a)(i,"float32")))}}}},Et={kernelName:o.pc,inputsToSave:["x"],gradFunc:function(e,t){var n=Object(i.a)(t,1)[0];return{x:function(){return Object(d.a)(e,Object(p.a)(Object(m.a)(n)))}}}},_t={kernelName:o.rc,inputsToSave:["x"],gradFunc:function(e,t){var n=Object(i.a)(t,1)[0],r=Object(u.a)(Object(Z.a)(n,6),Object(c.a)(n));return{x:function(){return Object(u.a)(e,Object(s.a)(r,"float32"))}}}},At={kernelName:o.qc,inputsToSave:["x"],gradFunc:function(e,t){var n=Object(i.a)(t,1)[0];return{x:function(){return Object(u.a)(e,Object(s.a)(Object(c.a)(n),"float32"))}}}},Rt={kernelName:o.sc,inputsToSave:["x"],gradFunc:function(e,t){var n=Object(i.a)(t,1)[0];return{x:function(){return Object(x.a)(e,n.shape)}}}},Dt={kernelName:o.tc,inputsToSave:["images"],gradFunc:function(e,t,n){var r={dy:e,images:Object(i.a)(t,1)[0]};return{images:function(){return R.a.runKernel(o.uc,r,n)}}}},Ft={kernelName:o.vc,inputsToSave:["images"],gradFunc:function(e,t,n){var r={dy:e,images:Object(i.a)(t,1)[0]};return{images:function(){return R.a.runKernel(o.wc,r,n)}}}},Mt=n(60),zt={kernelName:o.xc,gradFunc:function(e,t,n){var r=n.dims,a=Object(F.I)(r,e.shape);return{x:function(){return Object(Mt.a)(e,a)}}}},Lt={kernelName:o.zc,gradFunc:function(e){return{x:function(){return Object(I.a)(e)}}}},Pt={kernelName:o.Ac,inputsToSave:["x"],gradFunc:function(e,t){var n=Object(i.a)(t,1)[0];return{x:function(){return Object(p.a)(Object(d.a)(e,Object(u.a)(Object(wt.a)(n,1.5),2)))}}}},Bt=n(106),Wt={kernelName:o.Dc,inputsToSave:["condition"],gradFunc:function(e,t){var n=Object(i.a)(t,1)[0];return{condition:function(){return Object(s.a)(Object(I.a)(n),"float32")},t:function(){return Object(u.a)(e,Object(s.a)(n,e.dtype))},e:function(){return Object(u.a)(e,Object(s.a)(Object(Bt.a)(n),e.dtype))}}}},Ut=n(148),Vt={kernelName:o.Ec,inputsToSave:["x"],gradFunc:function(e,t){var n=Object(i.a)(t,1)[0];return{x:function(){var t=Object(Ve.a)(n,Object(f.a)(0)),r=Object(f.a)(Ut.b),a=Object(f.a)(Ut.a),i=Object(u.a)(e,a),o=Object(u.a)(Object(u.a)(e,r),Object(Ie.a)(Object(s.a)(n,"float32")));return Object(Q.a)(t,i,o)}}}},Gt={kernelName:o.Fc,outputsToSave:[!0],gradFunc:function(e,t){var n=Object(i.a)(t,1)[0];return{x:function(){return Object(u.a)(e,Object(u.a)(n,Object(v.a)(Object(f.a)(1),n)))}}}},Ht={kernelName:o.Gc,gradFunc:function(e){return{x:function(){return Object(I.a)(e)}}}},qt=n(121),Kt={kernelName:o.Hc,inputsToSave:["x"],gradFunc:function(e,t){var n=Object(i.a)(t,1)[0];return{x:function(){return Object(u.a)(Object(qt.a)(Object(s.a)(n,"float32")),e)}}}},Xt=n(162),Yt={kernelName:o.Ic,inputsToSave:["x"],gradFunc:function(e,t){var n=Object(i.a)(t,1)[0];return{x:function(){return Object(u.a)(Object(Xt.a)(Object(s.a)(n,"float32")),e)}}}},Zt=n(67),Jt=n(119),Qt={kernelName:o.Jc,inputsToSave:["x"],gradFunc:function(e,t,n){for(var r=Object(i.a)(t,1)[0],a=n.begin,o=n.size,s=r.shape,u=Object(Jt.parseSliceParams)(r,a,o),c=Object(i.a)(u,2),l=c[0],d=c[1],p=[],f=0;f<e.rank;f++)p.push([l[f],s[f]-l[f]-d[f]]);return{x:function(){return Object(Zt.a)(e,p)}}}},$t={kernelName:o.Kc,outputsToSave:[!0],gradFunc:function(e,t,n){var r=Object(i.a)(t,1)[0],a=n.dim,o=Object(u.a)(e,r);return{logits:function(){return Object(v.a)(o,Object(u.a)(Object(k.a)(o,[a],!0),r))}}}},en=n(80),tn={kernelName:o.Lc,inputsToSave:["x"],gradFunc:function(e,t){var n=Object(i.a)(t,1)[0];return{x:function(){return Object(u.a)(e,Object(en.a)(n))}}}},nn=n(100),rn={kernelName:o.Mc,gradFunc:function(e,t,n){var r=n.blockShape,a=n.paddings;return{x:function(){return Object(nn.a)(e,r,a)}}}},an=n(43),on={kernelName:o.Sc,gradFunc:function(e,t,n){var r=n.axis;return{x:function(){return Object(an.a)(e,r)}}}},sn={kernelName:o.Tc,inputsToSave:["x"],gradFunc:function(e,t){var n=Object(i.a)(t,1)[0];return{x:function(){return Object(d.a)(e,Object(u.a)(Object(h.a)(Object(s.a)(n,"float32")),2))}}}},un={kernelName:o.Uc,inputsToSave:["x"],gradFunc:function(e,t){var n=Object(i.a)(t,1)[0];return{x:function(){return Object(u.a)(e,Object(u.a)(Object(s.a)(n,"float32"),2))}}}},cn={kernelName:o.Vc,inputsToSave:["a","b"],gradFunc:function(e,t){var n=Object(i.a)(t,2),r=n[0],a=n[1],o=Object(f.a)(2);return{a:function(){return Object(u.a)(e,Object(u.a)(o,Object(v.a)(r,a)))},b:function(){return Object(u.a)(e,Object(u.a)(o,Object(v.a)(a,r)))}}}},ln={kernelName:o.Wc,gradFunc:function(e){return{x:function(){return Object(I.a)(e)}}}},dn={kernelName:o.bd,inputsToSave:["a","b"],gradFunc:function(e,t){var n=Object(i.a)(t,2),r=n[0],a=n[1],o=y.assertAndGetBroadcastShape(r.shape,a.shape);return{a:function(){var t=e,n=y.getReductionAxes(r.shape,o);return n.length>0&&(t=Object(k.a)(t,n)),Object(x.a)(t,r.shape)},b:function(){var t=e,n=y.getReductionAxes(a.shape,o);return n.length>0&&(t=Object(k.a)(t,n)),Object(x.a)(Object(p.a)(t),a.shape)}}}},pn={kernelName:o.cd,inputsToSave:["x"],gradFunc:function(e,t,n){var r=Object(i.a)(t,1)[0],a=r.shape.slice(),o=n.axis;Object(F.I)(o,r.shape).forEach((function(e){a[e]=1}));var s=Object(x.a)(e,a),c=Object(u.a)(s,Object(it.a)(r.shape,"float32"));return{x:function(){return c}}}},fn={kernelName:o.dd,inputsToSave:["x"],gradFunc:function(e,t){var n=Object(i.a)(t,1)[0];return{x:function(){return Object(d.a)(e,Object(m.a)(Object(qt.a)(n)))}}}},hn={kernelName:o.ed,outputsToSave:[!0],gradFunc:function(e,t){var n=Object(i.a)(t,1)[0];return{x:function(){return Object(u.a)(Object(v.a)(Object(f.a)(1),Object(m.a)(n)),e)}}}},mn={kernelName:o.fd,inputsToSave:["x"],gradFunc:function(e,t,n){var r=Object(i.a)(t,1)[0],a=n.reps;return{x:function(){var t=Object(I.a)(r);if(1===r.rank)for(var n=0;n<a[0];++n)t=Object(T.a)(t,Object(ct.a)(e,[n*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(var i=0;i<a[0];++i)for(var o=0;o<a[1];++o)t=Object(T.a)(t,Object(ct.a)(e,[i*r.shape[0],o*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(var s=0;s<a[0];++s)for(var u=0;u<a[1];++u)for(var c=0;c<a[2];++c)t=Object(T.a)(t,Object(ct.a)(e,[s*r.shape[0],u*r.shape[1],c*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(4!==r.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+"".concat(r.rank," tensors yet."));for(var l=0;l<a[0];++l)for(var d=0;d<a[1];++d)for(var p=0;p<a[2];++p)for(var f=0;f<a[3];++f)t=Object(T.a)(t,Object(ct.a)(e,[l*r.shape[0],d*r.shape[1],p*r.shape[2],f*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return t}}}},vn={kernelName:o.id,gradFunc:function(e,t,n){var r=n.perm,a=me.h(r);return{x:function(){return Object(be.a)(e,a)}}}},bn=n(72),gn={kernelName:o.kd,gradFunc:function(e,t,n){var r=n.axis;return{value:function(){return Object(bn.a)(e,r)}}}},yn=n(74),xn=n(104),kn=n(107),wn={kernelName:o.ld,inputsToSave:["segmentIds"],gradFunc:function(e,t){var n=Object(i.a)(t,1)[0];return{x:function(){return function(e,t){for(var n=Object(kn.a)(t,Object(I.a)(t)),r=Object(xn.a)(e,n),a=Object(Y.a)(t,Object(f.a)(0,"int32")),i=r.rank-a.rank,o=0;o<i;++o)a=Object(yn.a)(a,o+1);a=Object(J.a)(a,Object(it.a)(r.shape,"bool"));var s=Object(I.a)(r);return Object(Q.a)(a,r,s)}(e,n)}}}};for(var On={kernelName:o.md,gradFunc:function(e){return{x:function(){return Object(I.a)(e)}}}},In=n(73),Sn=0,Nn=[l,b,g,w,O,S,N,j,C,E,_,A,P,W,V,H,q,K,X,$,ee,ne,se,ie,le,pe,he,ge,ke,we,Ct,Oe,Se,Ne,je,Te,Ee,Ce,Re,Fe,Le,Pe,Be,We,Ue,Ge,He,qe,Ke,Ye,Qe,Qe,et,nt,at,ot,st,ut,lt,pt,ft,ht,vt,bt,yt,xt,xt,Ot,It,Tt,Et,_t,At,Rt,Dt,Ft,zt,Lt,Pt,Wt,Vt,Gt,Ht,Kt,Yt,Qt,$t,tn,rn,rn,on,on,sn,cn,un,ln,dn,pn,fn,hn,mn,vn,gn,wn,On];Sn<Nn.length;Sn++){var jn=Nn[Sn];Object(In.d)(jn)}var Tn=n(53),Cn=n(13);Object(Cn.d)().prototype.abs=function(){return this.throwIfDisposed(),Object(Tn.a)(this)};var En=n(205);Object(Cn.d)().prototype.acos=function(){return this.throwIfDisposed(),Object(En.a)(this)};var _n=n(206);Object(Cn.d)().prototype.acosh=function(){return this.throwIfDisposed(),Object(_n.a)(this)},Object(Cn.d)().prototype.add=function(e){return this.throwIfDisposed(),Object(T.a)(this,e)};var An=n(155);Object(Cn.d)().prototype.all=function(e,t){return this.throwIfDisposed(),Object(An.a)(this,e,t)};var Rn=n(156);Object(Cn.d)().prototype.any=function(e,t){return this.throwIfDisposed(),Object(Rn.a)(this,e,t)};var Dn=n(157);Object(Cn.d)().prototype.argMax=function(e){return this.throwIfDisposed(),Object(Dn.a)(this,e)};var Fn=n(158);Object(Cn.d)().prototype.argMin=function(e){return this.throwIfDisposed(),Object(Fn.a)(this,e)},Object(Cn.d)().prototype.asScalar=function(){return this.throwIfDisposed(),Object(F.b)(1===this.size,(function(){return"The array must have only 1 element."})),Object(x.a)(this,[])},Object(Cn.d)().prototype.asType=function(e){return this.throwIfDisposed(),Object(s.a)(this,e)},Object(Cn.d)().prototype.as1D=function(){return this.throwIfDisposed(),Object(x.a)(this,[this.size])},Object(Cn.d)().prototype.as2D=function(e,t){return this.throwIfDisposed(),Object(x.a)(this,[e,t])},Object(Cn.d)().prototype.as3D=function(e,t,n){return this.throwIfDisposed(),Object(x.a)(this,[e,t,n])},Object(Cn.d)().prototype.as4D=function(e,t,n,r){return this.throwIfDisposed(),Object(x.a)(this,[e,t,n,r])},Object(Cn.d)().prototype.as5D=function(e,t,n,r,a){return this.throwIfDisposed(),Object(x.a)(this,[e,t,n,r,a])};var Mn=n(207);Object(Cn.d)().prototype.asin=function(){return this.throwIfDisposed(),Object(Mn.a)(this)};var zn=n(208);Object(Cn.d)().prototype.asinh=function(){return this.throwIfDisposed(),Object(zn.a)(this)};var Ln=n(209);Object(Cn.d)().prototype.atan=function(){return this.throwIfDisposed(),Object(Ln.a)(this)};var Pn=n(159);Object(Cn.d)().prototype.atan2=function(e){return this.throwIfDisposed(),Object(Pn.a)(this,e)};var Bn=n(210);Object(Cn.d)().prototype.atanh=function(){return this.throwIfDisposed(),Object(Bn.a)(this)};var Wn=n(120);Object(Cn.d)().prototype.avgPool=function(e,t,n,r){return this.throwIfDisposed(),Object(Wn.a)(this,e,t,n,r)},Object(Cn.d)().prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),Object(nn.a)(this,e,t)};var Un=n(93);Object(Cn.d)().prototype.batchNorm=function(e,t,n,r,a){return this.throwIfDisposed(),Object(Un.a)(this,e,t,n,r,a)};var Vn=n(111);Object(Cn.d)().prototype.broadcastTo=function(e){return this.throwIfDisposed(),Object(Vn.a)(this,e)},Object(Cn.d)().prototype.cast=function(e){return this.throwIfDisposed(),Object(s.a)(this,e)};var Gn=n(211);Object(Cn.d)().prototype.ceil=function(){return this.throwIfDisposed(),Object(Gn.a)(this)};var Hn=n(212);Object(Cn.d)().prototype.clipByValue=function(e,t){return this.throwIfDisposed(),Object(Hn.a)(this,e,t)};var qn=n(15);Object(Cn.d)().prototype.concat=function(e,t){return this.throwIfDisposed(),e instanceof Cn.a&&(e=[e]),Object(an.a)([this].concat(Object(qn.a)(e)),t)};var Kn=n(160);Object(Cn.d)().prototype.conv1d=function(e,t,n,r,a,i){return this.throwIfDisposed(),Object(Kn.a)(this,e,t,n,r,a,i)};var Xn=n(161);Object(Cn.d)().prototype.conv2dTranspose=function(e,t,n,r,a){return this.throwIfDisposed(),Object(Xn.a)(this,e,t,n,r,a)},Object(Cn.d)().prototype.conv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),Object(oe.a)(this,e,t,n,r,a,i)},Object(Cn.d)().prototype.cos=function(){return this.throwIfDisposed(),Object(qt.a)(this)},Object(Cn.d)().prototype.cosh=function(){return this.throwIfDisposed(),Object(Xt.a)(this)},Object(Cn.d)().prototype.cumprod=function(e,t,n){return this.throwIfDisposed(),Object(Nt.a)(this,e,t,n)},Object(Cn.d)().prototype.cumsum=function(e,t,n){return this.throwIfDisposed(),Object(ve.a)(this,e,t,n)};var Yn=n(163);Object(Cn.d)().prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),Object(Yn.a)(this,e,t)};var Zn=n(101);Object(Cn.d)().prototype.depthwiseConv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),Object(Zn.a)(this,e,t,n,r,a,i)};var Jn=n(164);Object(Cn.d)().prototype.dilation2d=function(e,t,n,r,a){return this.throwIfDisposed(),Object(Jn.a)(this,e,t,n,r,a)};var Qn=n(165);Object(Cn.d)().prototype.divNoNan=function(e){return this.throwIfDisposed(),Object(Qn.a)(this,e)},Object(Cn.d)().prototype.div=function(e){return this.throwIfDisposed(),Object(d.a)(this,e)};var $n=n(166);Object(Cn.d)().prototype.dot=function(e){return this.throwIfDisposed(),Object($n.a)(this,e)};var er=n(124);Object(Cn.d)().prototype.elu=function(){return this.throwIfDisposed(),Object(er.a)(this)},Object(Cn.d)().prototype.equal=function(e){return this.throwIfDisposed(),Object(Ze.a)(this,e)};var tr=n(213);Object(Cn.d)().prototype.erf=function(){return this.throwIfDisposed(),Object(tr.a)(this)};var nr=n(167);Object(Cn.d)().prototype.euclideanNorm=function(e,t){return this.throwIfDisposed(),Object(nr.a)(this,e,t)},Object(Cn.d)().prototype.exp=function(){return this.throwIfDisposed(),Object(Ie.a)(this)},Object(Cn.d)().prototype.expandDims=function(e){return this.throwIfDisposed(),Object(yn.a)(this,e)};var rr=n(214);Object(Cn.d)().prototype.expm1=function(){return this.throwIfDisposed(),Object(rr.a)(this)};var ar=n(135);Object(Cn.d)().prototype.fft=function(){return this.throwIfDisposed(),Object(ar.a)(this)},Object(Cn.d)().prototype.flatten=function(){return this.throwIfDisposed(),Object(x.a)(this,[this.size])},Object(Cn.d)().prototype.floor=function(){return this.throwIfDisposed(),Object(dt.a)(this)};var ir=n(123);Object(Cn.d)().prototype.floorDiv=function(e){return this.throwIfDisposed(),Object(ir.a)(this,e)},Object(Cn.d)().prototype.gather=function(e,t){return this.throwIfDisposed(),Object(xn.a)(this,e,t)},Object(Cn.d)().prototype.greaterEqual=function(e){return this.throwIfDisposed(),Object(Y.a)(this,e)},Object(Cn.d)().prototype.greater=function(e){return this.throwIfDisposed(),Object(Ve.a)(this,e)};var or=n(115);Object(Cn.d)().prototype.ifft=function(){return this.throwIfDisposed(),Object(or.a)(this)};var sr=n(183);Object(Cn.d)().prototype.irfft=function(){return this.throwIfDisposed(),Object(sr.a)(this)};var ur=n(215);Object(Cn.d)().prototype.isFinite=function(){return this.throwIfDisposed(),Object(ur.a)(this)};var cr=n(216);Object(Cn.d)().prototype.isInf=function(){return this.throwIfDisposed(),Object(cr.a)(this)};var lr=n(217);Object(Cn.d)().prototype.isNaN=function(){return this.throwIfDisposed(),Object(lr.a)(this)};var dr=n(126);Object(Cn.d)().prototype.leakyRelu=function(e){return this.throwIfDisposed(),Object(dr.a)(this,e)},Object(Cn.d)().prototype.lessEqual=function(e){return this.throwIfDisposed(),Object(Z.a)(this,e)},Object(Cn.d)().prototype.less=function(e){return this.throwIfDisposed(),Object($e.a)(this,e)};var pr=n(168);Object(Cn.d)().prototype.localResponseNormalization=function(e,t,n,r){return this.throwIfDisposed(),Object(pr.a)(this,e,t,n,r)};var fr=n(218);Object(Cn.d)().prototype.logSigmoid=function(){return this.throwIfDisposed(),Object(fr.a)(this)};var hr=n(219);Object(Cn.d)().prototype.logSoftmax=function(e){return this.throwIfDisposed(),Object(hr.a)(this,e)};var mr=n(128);Object(Cn.d)().prototype.logSumExp=function(e,t){return this.throwIfDisposed(),Object(mr.a)(this,e,t)},Object(Cn.d)().prototype.log=function(){return this.throwIfDisposed(),Object(kt.a)(this)};var vr=n(169);Object(Cn.d)().prototype.log1p=function(){return this.throwIfDisposed(),Object(vr.a)(this)},Object(Cn.d)().prototype.logicalAnd=function(e){return this.throwIfDisposed(),Object(J.a)(this,e)},Object(Cn.d)().prototype.logicalNot=function(){return this.throwIfDisposed(),Object(Bt.a)(this)};var br=n(129);Object(Cn.d)().prototype.logicalOr=function(e){return this.throwIfDisposed(),Object(br.a)(this,e)};var gr=n(171);Object(Cn.d)().prototype.logicalXor=function(e){return this.throwIfDisposed(),Object(gr.a)(this,e)},Object(Cn.d)().prototype.matMul=function(e,t,n){return this.throwIfDisposed(),Object(U.a)(this,e,t,n)};var yr=n(130);Object(Cn.d)().prototype.maxPool=function(e,t,n,r){return this.throwIfDisposed(),Object(yr.a)(this,e,t,n,r)};var xr=n(81);Object(Cn.d)().prototype.max=function(e,t){return this.throwIfDisposed(),Object(xr.a)(this,e,t)},Object(Cn.d)().prototype.maximum=function(e){return this.throwIfDisposed(),Object(kn.a)(this,e)};var kr=n(96);Object(Cn.d)().prototype.mean=function(e,t){return this.throwIfDisposed(),Object(kr.a)(this,e,t)};var wr=n(114);Object(Cn.d)().prototype.min=function(e,t){return this.throwIfDisposed(),Object(wr.a)(this,e,t)};var Or=n(131);Object(Cn.d)().prototype.minimum=function(e){return this.throwIfDisposed(),Object(Or.a)(this,e)};var Ir=n(172);Object(Cn.d)().prototype.mirrorPad=function(e,t){return this.throwIfDisposed(),Object(Ir.a)(this,e,t)};var Sr=n(173);Object(Cn.d)().prototype.mod=function(e){return this.throwIfDisposed(),Object(Sr.a)(this,e)},Object(Cn.d)().prototype.mul=function(e){return this.throwIfDisposed(),Object(u.a)(this,e)},Object(Cn.d)().prototype.neg=function(){return this.throwIfDisposed(),Object(p.a)(this)};var Nr=n(103);Object(Cn.d)().prototype.norm=function(e,t,n){return this.throwIfDisposed(),Object(Nr.a)(this,e,t,n)};var jr=n(132);Object(Cn.d)().prototype.notEqual=function(e){return this.throwIfDisposed(),Object(jr.a)(this,e)};var Tr=n(174);Object(Cn.d)().prototype.oneHot=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.throwIfDisposed(),Object(Tr.a)(this,e,t,n)};var Cr=n(220);Object(Cn.d)().prototype.onesLike=function(){return this.throwIfDisposed(),Object(Cr.a)(this)},Object(Cn.d)().prototype.pad=function(e,t){return this.throwIfDisposed(),Object(Zt.a)(this,e,t)};var Er=n(175);Object(Cn.d)().prototype.pool=function(e,t,n,r,a,i){return this.throwIfDisposed(),Object(Er.a)(this,e,t,n,r,a,i)},Object(Cn.d)().prototype.pow=function(e){return this.throwIfDisposed(),Object(wt.a)(this,e)};var _r=n(133);Object(Cn.d)().prototype.prelu=function(e){return this.throwIfDisposed(),Object(_r.a)(this,e)};var Ar=n(176);Object(Cn.d)().prototype.prod=function(e,t){return this.throwIfDisposed(),Object(Ar.a)(this,e,t)};var Rr=n(221);Object(Cn.d)().prototype.reciprocal=function(){return this.throwIfDisposed(),Object(Rr.a)(this)};var Dr=n(90);Object(Cn.d)().prototype.relu=function(){return this.throwIfDisposed(),Object(Dr.a)(this)};var Fr=n(134);Object(Cn.d)().prototype.relu6=function(){return this.throwIfDisposed(),Object(Fr.a)(this)},Object(Cn.d)().prototype.reshapeAs=function(e){return this.throwIfDisposed(),Object(x.a)(this,e.shape)},Object(Cn.d)().prototype.reshape=function(e){return this.throwIfDisposed(),Object(x.a)(this,e)};var Mr=n(196);Object(Cn.d)().prototype.resizeBilinear=function(e,t,n){return this.throwIfDisposed(),Object(Mr.a)(this,e,t,n)};var zr=n(195);Object(Cn.d)().prototype.resizeNearestNeighbor=function(e,t,n){return this.throwIfDisposed(),Object(zr.a)(this,e,t,n)},Object(Cn.d)().prototype.reverse=function(e){return this.throwIfDisposed(),Object(Mt.a)(this,e)};var Lr=n(136);Object(Cn.d)().prototype.rfft=function(){return this.throwIfDisposed(),Object(Lr.a)(this)};var Pr=n(177);Object(Cn.d)().prototype.round=function(){return this.throwIfDisposed(),Object(Pr.a)(this)},Object(Cn.d)().prototype.rsqrt=function(){return this.throwIfDisposed(),Object(_e.a)(this)};var Br=n(179);Object(Cn.d)().prototype.selu=function(){return this.throwIfDisposed(),Object(Br.a)(this)};var Wr=n(180);Object(Cn.d)().prototype.separableConv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),Object(Wr.a)(this,e,t,n,r,a,i)},Object(Cn.d)().prototype.sigmoid=function(){return this.throwIfDisposed(),Object(en.a)(this)};var Ur=n(222);Object(Cn.d)().prototype.sign=function(){return this.throwIfDisposed(),Object(Ur.a)(this)},Object(Cn.d)().prototype.sin=function(){return this.throwIfDisposed(),Object(de.a)(this)},Object(Cn.d)().prototype.sinh=function(){return this.throwIfDisposed(),Object(fe.a)(this)},Object(Cn.d)().prototype.slice=function(e,t){return this.throwIfDisposed(),Object(ct.a)(this,e,t)};var Vr=n(223);Object(Cn.d)().prototype.softmax=function(e){return this.throwIfDisposed(),Object(Vr.a)(this,e)};var Gr=n(170);Object(Cn.d)().prototype.softplus=function(){return this.throwIfDisposed(),Object(Gr.a)(this)},Object(Cn.d)().prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),Object(G.a)(this,e,t)},Object(Cn.d)().prototype.split=function(e,t){return this.throwIfDisposed(),Object(te.a)(this,e,t)},Object(Cn.d)().prototype.sqrt=function(){return this.throwIfDisposed(),Object(h.a)(this)},Object(Cn.d)().prototype.square=function(){return this.throwIfDisposed(),Object(m.a)(this)};var Hr=n(137);Object(Cn.d)().prototype.squaredDifference=function(e){return this.throwIfDisposed(),Object(Hr.a)(this,e)};var qr=n(109);Object(Cn.d)().prototype.squeeze=function(e){return this.throwIfDisposed(),Object(qr.a)(this,e)},Object(Cn.d)().prototype.stack=function(e,t){this.throwIfDisposed();var n=e instanceof Cn.a?[this,e]:[this].concat(Object(qn.a)(e));return Object(bn.a)(n,t)},Object(Cn.d)().prototype.step=function(e){return this.throwIfDisposed(),Object(c.a)(this,e)};var Kr=n(224);Object(Cn.d)().prototype.stridedSlice=function(e,t,n,r,a,i,o,s){return this.throwIfDisposed(),Object(Kr.a)(this,e,t,n,r,a,i,o,s)},Object(Cn.d)().prototype.sub=function(e){return this.throwIfDisposed(),Object(v.a)(this,e)},Object(Cn.d)().prototype.sum=function(e,t){return this.throwIfDisposed(),Object(k.a)(this,e,t)};var Xr=n(225);Object(Cn.d)().prototype.tan=function(){return this.throwIfDisposed(),Object(Xr.a)(this)};var Yr=n(147);Object(Cn.d)().prototype.tanh=function(){return this.throwIfDisposed(),Object(Yr.a)(this)},Object(Cn.d)().prototype.tile=function(e){return this.throwIfDisposed(),Object(Ae.a)(this,e)},Object(Cn.d)().prototype.toBool=function(){return this.throwIfDisposed(),Object(s.a)(this,"bool")},Object(Cn.d)().prototype.toFloat=function(){return this.throwIfDisposed(),Object(s.a)(this,"float32")},Object(Cn.d)().prototype.toInt=function(){return this.throwIfDisposed(),Object(s.a)(this,"int32")};var Zr=n(185);Object(Cn.d)().prototype.topk=function(e,t){return this.throwIfDisposed(),Object(Zr.a)(this,e,t)},Object(Cn.d)().prototype.transpose=function(e){return this.throwIfDisposed(),Object(be.a)(this,e)};var Jr=n(186);Object(Cn.d)().prototype.unique=function(e){return this.throwIfDisposed(),Object(Jr.a)(this,e)},Object(Cn.d)().prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),Object(De.a)(this,e,t)},Object(Cn.d)().prototype.unstack=function(e){return this.throwIfDisposed(),Object(gt.a)(this,e)},Object(Cn.d)().prototype.where=function(e,t){return this.throwIfDisposed(),Object(Q.a)(e,this,t)},Object(Cn.d)().prototype.zerosLike=function(){return this.throwIfDisposed(),Object(I.a)(this)};var Qr=n(14),$r=n(2),ea=n(4),ta=n(40),na=n(10),ra=n(11),aa=n(69),ia=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;return Object($r.a)(this,n),r=t.call(this,e),Object.setPrototypeOf(Object(ta.a)(r),n.prototype),r}return n}(Object(aa.a)(Error)),oa=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;return Object($r.a)(this,n),r=t.call(this,e),Object.setPrototypeOf(Object(ta.a)(r),n.prototype),r}return n}(Object(aa.a)(Error)),sa=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;return Object($r.a)(this,n),r=t.call(this,e),Object.setPrototypeOf(Object(ta.a)(r),n.prototype),r}return n}(Object(aa.a)(Error)),ua=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;return Object($r.a)(this,n),r=t.call(this,e),Object.setPrototypeOf(Object(ta.a)(r),n.prototype),r}return n}(Object(aa.a)(Error)),ca=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;return Object($r.a)(this,n),r=t.call(this,e),Object.setPrototypeOf(Object(ta.a)(r),n.prototype),r}return n}(Object(aa.a)(Error)),la=(Error,function(){function e(t){Object($r.a)(this,e),this.maxEntries=t||100,this.cache=new Map}return Object(ea.a)(e,[{key:"get",value:function(e){var t;return this.cache.has(e)&&(t=this.cache.get(e),this.cache.delete(e),this.cache.set(e,t)),t}},{key:"put",value:function(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){var n=this.cache.keys().next().value;this.cache.delete(n)}this.cache.set(e,t)}},{key:"getMaxEntries",value:function(){return this.maxEntries}},{key:"setMaxEntries",value:function(e){if(e<0)throw new Error("The maxEntries of LRU caches must be at least 0, but got ".concat(e,"."));if(this.maxEntries>e)for(var t=0;t<this.maxEntries-e;t++){var n=this.cache.keys().next().value;this.cache.delete(n)}this.maxEntries=e}}]),e}());function da(e,t){if(Array.isArray(e)){for(var n=[],r=0;r<t;r++)n=n.concat(e);return n}var a=new Array(t);return a.fill(e),a}function pa(e,t){if(!e)throw new ca(t)}function fa(e,t){var n,r=0,a=Object(Qr.a)(e);try{for(a.s();!(n=a.n()).done;){n.value===t&&r++}}catch(i){a.e(i)}finally{a.f()}return r}function ha(e){return 1===e.length?e[0]:e}function ma(e){return Array.isArray(e)?e:[e]}function va(e){var t=e.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return"_"!==t[0]?t:"private"+t}function ba(e){return e.length<=1||-1===e.indexOf("_")?e:e.replace(/[_]+(\w|$)/g,(function(e,t){return t.toUpperCase()}))}var ga={};function ya(e){if(null===e||void 0===e)return null;var t={};return t.className=e.getClassName(),t.config=e.getConfig(),t}function xa(e){if(null!=e&&"object"===typeof e)if(Array.isArray(e))e.forEach((function(e){return xa(e)}));else for(var t=0,n=Object.keys(e);t<n.length;t++){var r=n[t],a=e[r];null!=a&&"object"===typeof a&&(Array.isArray(a)||"ndarray"!==a.type||"number"!==typeof a.value?xa(a):e[r]=a.value)}}function ka(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"object",a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if("string"===typeof e){var o,s=e;if(s in n)o=n[s];else if(s in ga)o=ga[s];else if(null==(o=t[s]))throw new sa("Unknown ".concat(r,": ").concat(e,". ")+"This may be due to one of the following reasons:\n"+"1. The ".concat(r," is defined in Python, in which ")+"case it needs to be ported to TensorFlow.js or your JavaScript code.\n"+"2. The custom ".concat(r," is defined in JavaScript, ")+"but is not registered properly with tf.serialization.registerClass().");return o}var u=e;if(null==u.className||null==u.config)throw new sa("".concat(r,": Improper config format: ")+"".concat(JSON.stringify(u),".\n")+"'className' and 'config' must set.");var c,l,d=u.className;if(d in n){var p=Object(i.a)(n[d],2);c=p[0],l=p[1]}else if(d in ga){var f=Object(i.a)(ga.className,2);c=f[0],l=f[1]}else if(d in t){var h=Object(i.a)(t[d],2);c=h[0],l=h[1]}if(null==c)throw new sa("Unknown ".concat(r,": ").concat(d,". ")+"This may be due to one of the following reasons:\n"+"1. The ".concat(r," is defined in Python, in which ")+"case it needs to be ported to TensorFlow.js or your JavaScript code.\n"+"2. The custom ".concat(r," is defined in JavaScript, ")+"but is not registered properly with tf.serialization.registerClass().");if(null!=l){for(var m={},v=0,b=Object.keys(ga);v<b.length;v++){var g=b[v];m[g]=ga[g]}for(var y=0,x=Object.keys(n);y<x.length;y++){var k=x[y];m[k]=n[k]}var w=u.config;w.customObjects=m;for(var O=Object.assign({},ga),I=0,S=Object.keys(n);I<S.length;I++){var N=S[I];ga[N]=n[N]}xa(u.config);var j=l(c,u.config,n,a);return ga=Object.assign({},O),j}for(var T=Object.assign({},ga),C=0,E=Object.keys(n);C<E.length;C++){var _=E[C];ga[_]=n[_]}var A=new c(u.config);return ga=Object.assign({},T),A}function wa(e,t){return-1*function(e,t){return e<t?-1:e>t?1:0}(e,t)}function Oa(e){if(null==e)return e;var t,n=[],r=Object(Qr.a)(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;-1===n.indexOf(a)&&n.push(a)}}catch(i){r.e(i)}finally{r.f()}return n}function Ia(e){if(null==e)throw new sa("Invalid value in obj: ".concat(JSON.stringify(e)));for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function Sa(e,t,n){if(null!=n&&e.indexOf(n)<0)throw new sa("".concat(n," is not a valid ").concat(t,".  Valid values are ").concat(e," or null/undefined."))}function Na(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;return pa(n>=0),pa(r>=n),Array.isArray(e)&&e.length>=n&&e.length<=r&&e.every((function(e){return typeof e===t}))}function ja(e,t){Array.isArray(e)?(a.Df.assert(e.length>0,(function(){return"".concat(t," is unexpectedly an empty array.")})),e.forEach((function(e,n){return ja(e,"element ".concat(n+1," of ").concat(t))}))):a.Df.assert(Number.isInteger(e)&&e>0,(function(){return"Expected ".concat(t," to be a positive integer, but got ")+"".concat(function e(t){return null===t?"null":Array.isArray(t)?"["+t.map((function(t){return e(t)})).join(",")+"]":"string"===typeof t?'"'.concat(t,'"'):"".concat(t)}(e),".")}))}function Ta(e){return"relu"===e?"relu":"linear"===e?"linear":"elu"===e?"elu":null}var Ca=0;function Ea(){return Ca++}var _a={};function Aa(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e in _a||(_a[e]=0),_a[e]+=1,e+_a[e].toString()}var Ra=["channelsFirst","channelsLast"],Da=["nearest","bilinear"],Fa=["valid","same","causal"],Ma=["max","avg"],za=["sum","mul","concat","ave"],La=new Map;function Pa(e){Sa(Ra,"DataFormat",e)}function Ba(e){Sa(Fa,"PaddingMode",e)}function Wa(e){Sa(Ma,"PoolMode",e)}var Ua=[];function Va(e,t){Ua.push(e);try{var n=t();return Ua.pop(),n}catch(r){throw Ua.pop(),r}}function Ga(e){if(!Xa(e))throw new Error("Not a valid tensor name: '"+e+"'");return(0===Ua.length?"":Ua.join("/")+"/")+e}function Ha(e){if(!Xa(e))throw new Error("Not a valid tensor name: '"+e+"'");La.has(e)||La.set(e,0);var t=La.get(e);if(La.set(e,La.get(e)+1),t>0){var n="".concat(e,"_").concat(t);return La.set(n,1),n}return e}var qa,Ka=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function Xa(e){return!!e.match(Ka)}function Ya(e,t,n){null==t&&(t=0),null==n&&(n=e.length);for(var r=1,a=t;a<n;++a)r*=e[a];return r}function Za(e){if(0===e.length)return Number.NaN;for(var t=Number.POSITIVE_INFINITY,n=0;n<e.length;n++){var r=e[n];r<t&&(t=r)}return t}function Ja(e){if(0===e.length)return Number.NaN;for(var t=Number.NEGATIVE_INFINITY,n=0;n<e.length;n++){var r=e[n];r>t&&(t=r)}return t}function Qa(e,t){if(t<e)throw new sa("end (".concat(t,") < begin (").concat(e,") is forbidden."));for(var n=[],r=e;r<t;++r)n.push(r);return n}function $a(){return null==qa&&(qa=Object(a.yd)().epsilon()),qa}function ei(e,t){return a.Hd(e,t)}function ti(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=e.shape.slice();return t<0&&(t=n.length+t+1),n.splice(t,0,1),a.Ue(e,n)}function ni(e){var t=[Ya(e.shape)];return a.Ue(e,t)}function ri(e,t,n){return Object(a.wf)((function(){switch(e.rank){case 1:return a.df(e,t,n);case 2:return a.ef(e,[t,0],[n,e.shape[1]]);case 3:return a.ff(e,[t,0,0],[n,e.shape[1],e.shape[2]]);case 4:return a.gf(e,[t,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3]]);case 5:return a.cf(e,[t,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4]]);case 6:return a.cf(e,[t,0,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4],e.shape[5]]);default:throw new sa("sliceAlongFirstAxis() received an unsupported tensor rank: "+"".concat(e.rank))}}))}function ai(e,t,n){return Object(a.wf)((function(){switch(e.rank){case 1:return a.df(e,t,n);case 2:return a.ef(e,[0,t],[e.shape[0],n]);case 3:return a.ff(e,[0,0,t],[e.shape[0],e.shape[1],n]);case 4:return a.gf(e,[0,0,0,t],[e.shape[0],e.shape[1],e.shape[2],n]);default:throw new sa("sliceAlongLastAxis() received an unsupported tensor rank: "+"".concat(e.rank))}}))}function ii(e,t,n,r){return Object(a.wf)((function(){switch(e.rank){case 1:return a.df(e,t,n);case 2:switch(r){case 1:return ri(e,t,n);case 2:return ai(e,t,n);default:throw new sa("The axis is not within the rank of the tensor "+"".concat(r))}case 3:switch(r){case 1:return ri(e,t,n);case 2:return a.ff(e,[0,t,0],[e.shape[0],n,e.shape[2]]);case 3:return ai(e,t,n);default:throw new sa("The axis is not within the rank of the tensor "+"".concat(r))}case 4:switch(r){case 1:return ri(e,t,n);case 2:return a.gf(e,[0,t,0,0],[e.shape[0],n,e.shape[2],e.shape[3]]);case 3:return a.gf(e,[0,0,t,0],[e.shape[0],e.shape[1],n,e.shape[3]]);case 4:return ai(e,t,n);default:throw new sa("The axis is not within the rank of the tensor "+"".concat(r))}default:throw new sa("sliceAlongLastAxis() received an unsupported tensor rank: "+"".concat(e.rank))}}))}function oi(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return n<0&&(n=0!==(t=e[0].rank)?t:0),n===e[0].rank&&(n=-1),a.Kd(e,n)}function si(e,t){switch(e.rank){case 1:return a.Ld([e,t]);case 2:return a.Md([e,t],0);case 3:return a.Nd([e,t],0);case 4:return a.Od([e,t],0);default:throw new sa("concatAlongFirstAxis() received an unsupported "+"tensor rank: ".concat(e.rank))}}function ui(e,t){if(Array.isArray(t)||(t=[t]),e.rank!==t.length)throw new sa("The length of input n (".concat(t.length,") does not match ")+"the number of dimensions in input x (".concat(e.rank,")"));return a.xf(e,t)}function ci(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;return a.Pe(e,t,n,r,i)}function li(e,t,n,r){if(e.rank<2||t.rank<2)throw new ua("dot requires both inputs to be rank >= 2"+" but got x shape = ".concat(e.shape," and y shape = ").concat(t.shape));if(t.rank>=3&&e.shape.slice(-1)[0]!==t.shape.slice(-2)[0])throw new ua("If rank y >= 3, then the second last dim"+" of y must equal the last dim of x but got x shape = ".concat(e.shape," and ")+" y shape = ".concat(t.shape));if(2===e.rank&&2===t.rank){return a.ie.matMul({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?fi(e.rank,r,"channelsLast"):null,activation:n})}var i=e.shape.slice(),o=i.pop();e=a.Ue(e,[-1,o]);var s=t.shape.slice(),u=s.pop(),c=s.pop(),l=[].concat(Object(qn.a)(s),[u]),d=Array.from({length:t.rank},(function(e,n){return 0===n?t.rank-2:n<=t.rank-2?n-1:n}));t=a.Ue(a.zf(t,d),[c,-1]);var p=[].concat(Object(qn.a)(i),Object(qn.a)(l));return a.Ue(a.ie.matMul({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?fi(e.rank,r,"channelsLast"):null,activation:n}),p)}function di(e,t,n){return Object(a.wf)((function(){return t=Array.isArray(t)?Object(a.tf)(t,"int32"):a.Hd(t,"int32"),a.je(e,t,n)}))}function pi(e){return a.Fe(e,e)}function fi(e,t,n){var r=t.shape;if(1!==t.rank&&t.rank!==e)throw new sa("Unexpected bias dimensions: ".concat(t.rank)+"; expected it to be 1 or ".concat(e));if(5===e){if("channelsFirst"===n)return 1===r.length?a.Ue(t,[1,r[0],1,1,1]):a.Ue(t,[1,r[3],r[0],r[1],r[2]]);if("channelsLast"===n)return 1===r.length?a.Ue(t,[1,1,1,1,r[0]]):a.Ue(t,[1].concat(r))}else if(4===e){if("channelsFirst"===n)return 1===r.length?a.Ue(t,[1,r[0],1,1]):a.Ue(t,[1,r[2],r[0],r[1]]);if("channelsLast"===n)return 1===r.length?a.Ue(t,[1,1,1,r[0]]):a.Ue(t,[1].concat(r))}else if(3===e){if("channelsFirst"===n)return 1===r.length?a.Ue(t,[1,r[0],1]):a.Ue(t,[1,r[1],r[0]]);if("channelsLast"===n)return 1===r.length?a.Ue(t,[1,1,r[0]]):a.Ue(t,[1].concat(r))}else if(e<3)return t;throw new sa("Unsupported input rank by biasAdd: ".concat(t.rank))}function hi(e,t,n){return Object(a.wf)((function(){return null==n&&(n="channelsLast"),Pa(n),a.sd(e,fi(e.rank,t,n))}))}function mi(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(1!==t)throw new ua("Support for alpha values other than 1 (".concat(t,") is not implemented ")+"yet.");return a.Zd(e)}function vi(e,t,n,r){return Object(a.wf)((function(){return a.Yd(e,t,n,r)}))}function bi(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return n?e():t()}var gi=["fanIn","fanOut","fanAvg"],yi=["normal","uniform","truncatedNormal"];var xi=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(){return Object($r.a)(this,n),t.apply(this,arguments)}return Object(ea.a)(n,[{key:"fromConfigUsesCustomObjects",value:function(){return!1}},{key:"getConfig",value:function(){return{}}}]),n}(a.Ze.Serializable),ki=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(){return Object($r.a)(this,n),t.apply(this,arguments)}return Object(ea.a)(n,[{key:"apply",value:function(e,t){return Object(a.If)(e,t)}}]),n}(xi);ki.className="Zeros",a.Ze.registerClass(ki);var wi=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(){return Object($r.a)(this,n),t.apply(this,arguments)}return Object(ea.a)(n,[{key:"apply",value:function(e,t){return Object(a.Ke)(e,t)}}]),n}(xi);wi.className="Ones",a.Ze.registerClass(wi);var Oi=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;if(Object($r.a)(this,n),r=t.call(this),"object"!==typeof e)throw new sa("Expected argument of type ConstantConfig but got ".concat(e));if(void 0===e.value)throw new sa("config must have value set but got ".concat(e));return r.value=e.value,r}return Object(ea.a)(n,[{key:"apply",value:function(e,t){var n=this;return Object(a.wf)((function(){return Object(a.Fe)(Object(a.We)(n.value),Object(a.Ke)(e,t))}))}},{key:"getConfig",value:function(){return{value:this.value}}}]),n}(xi);Oi.className="Constant",a.Ze.registerClass(Oi);var Ii=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;return Object($r.a)(this,n),(r=t.call(this)).DEFAULT_MINVAL=-.05,r.DEFAULT_MAXVAL=.05,r.minval=e.minval||r.DEFAULT_MINVAL,r.maxval=e.maxval||r.DEFAULT_MAXVAL,r.seed=e.seed,r}return Object(ea.a)(n,[{key:"apply",value:function(e,t){return Object(a.Qe)(e,this.minval,this.maxval,t)}},{key:"getConfig",value:function(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}]),n}(xi);Ii.className="RandomUniform",a.Ze.registerClass(Ii);var Si=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;return Object($r.a)(this,n),(r=t.call(this)).DEFAULT_MEAN=0,r.DEFAULT_STDDEV=.05,r.mean=e.mean||r.DEFAULT_MEAN,r.stddev=e.stddev||r.DEFAULT_STDDEV,r.seed=e.seed,r}return Object(ea.a)(n,[{key:"apply",value:function(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new ua("randomNormal does not support dType ".concat(t,"."));return ci(e,this.mean,this.stddev,t,this.seed)}},{key:"getConfig",value:function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}]),n}(xi);Si.className="RandomNormal",a.Ze.registerClass(Si);var Ni=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;return Object($r.a)(this,n),(r=t.call(this)).DEFAULT_MEAN=0,r.DEFAULT_STDDEV=.05,r.mean=e.mean||r.DEFAULT_MEAN,r.stddev=e.stddev||r.DEFAULT_STDDEV,r.seed=e.seed,r}return Object(ea.a)(n,[{key:"apply",value:function(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new ua("truncatedNormal does not support dType ".concat(t,"."));return Object(a.Af)(e,this.mean,this.stddev,t,this.seed)}},{key:"getConfig",value:function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}]),n}(xi);Ni.className="TruncatedNormal",a.Ze.registerClass(Ni);var ji=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;return Object($r.a)(this,n),(r=t.call(this)).gain=null!=e.gain?e.gain:1,r}return Object(ea.a)(n,[{key:"apply",value:function(e,t){var n=this;return Object(a.wf)((function(){if(2!==e.length||e[0]!==e[1])throw new sa("Identity matrix initializer can only be used for 2D square matrices.");return Object(a.Fe)(n.gain,Object(a.fe)(e[0]))}))}},{key:"getConfig",value:function(){return{gain:this.gain}}}]),n}(xi);ji.className="Identity",a.Ze.registerClass(ji);var Ti=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r,a;if(Object($r.a)(this,n),r=t.call(this),e.scale<0)throw new sa("scale must be a positive float. Got: ".concat(e.scale));return r.scale=null==e.scale?1:e.scale,r.mode=null==e.mode?"fanIn":e.mode,a=r.mode,Sa(gi,"FanMode",a),r.distribution=null==e.distribution?"normal":e.distribution,function(e){Sa(yi,"Distribution",e)}(r.distribution),r.seed=e.seed,r}return Object(ea.a)(n,[{key:"apply",value:function(e,t){var n=function(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"channelsLast";if(Pa(r),2===e.length)t=e[0],n=e[1];else if(-1!==[3,4,5].indexOf(e.length)){if("channelsFirst"===r){var a=Ya(e,2);t=e[1]*a,n=e[0]*a}else if("channelsLast"===r){var i=Ya(e,0,e.length-2);t=e[e.length-2]*i,n=e[e.length-1]*i}}else{var o=Ya(e);t=Math.sqrt(o),n=Math.sqrt(o)}return[t,n]}(e),r=n[0],i=n[1],o=this.scale;if("fanIn"===this.mode?o/=Math.max(1,r):"fanOut"===this.mode?o/=Math.max(1,i):o/=Math.max(1,(r+i)/2),"normal"===this.distribution){var s=Math.sqrt(o);if("float32"!==(t=t||"float32")&&"int32"!==t)throw new ua("".concat(this.getClassName()," does not support dType ").concat(t,"."));return Object(a.Af)(e,0,s,t,this.seed)}var u=Math.sqrt(3*o);return Object(a.Qe)(e,-u,u,t)}},{key:"getConfig",value:function(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}]),n}(xi);Ti.className="VarianceScaling",a.Ze.registerClass(Ti);var Ci=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){return Object($r.a)(this,n),t.call(this,{scale:1,mode:"fanAvg",distribution:"uniform",seed:null==e?null:e.seed})}return Object(ea.a)(n,[{key:"getClassName",value:function(){return Ti.className}}]),n}(Ti);Ci.className="GlorotUniform",a.Ze.registerClass(Ci);var Ei=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){return Object($r.a)(this,n),t.call(this,{scale:1,mode:"fanAvg",distribution:"normal",seed:null==e?null:e.seed})}return Object(ea.a)(n,[{key:"getClassName",value:function(){return Ti.className}}]),n}(Ti);Ei.className="GlorotNormal",a.Ze.registerClass(Ei);var _i=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){return Object($r.a)(this,n),t.call(this,{scale:2,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})}return Object(ea.a)(n,[{key:"getClassName",value:function(){return Ti.className}}]),n}(Ti);_i.className="HeNormal",a.Ze.registerClass(_i);var Ai=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){return Object($r.a)(this,n),t.call(this,{scale:2,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})}return Object(ea.a)(n,[{key:"getClassName",value:function(){return Ti.className}}]),n}(Ti);Ai.className="HeUniform",a.Ze.registerClass(Ai);var Ri=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){return Object($r.a)(this,n),t.call(this,{scale:1,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})}return Object(ea.a)(n,[{key:"getClassName",value:function(){return Ti.className}}]),n}(Ti);Ri.className="LeCunNormal",a.Ze.registerClass(Ri);var Di=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){return Object($r.a)(this,n),t.call(this,{scale:1,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})}return Object(ea.a)(n,[{key:"getClassName",value:function(){return Ti.className}}]),n}(Ti);Di.className="LeCunNormal",a.Ze.registerClass(Di);var Fi=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;if(Object($r.a)(this,n),(r=t.call(this)).DEFAULT_GAIN=1,r.gain=null==e.gain?r.DEFAULT_GAIN:e.gain,r.seed=e.seed,null!=r.seed)throw new ua("Random seed is not implemented for Orthogonal Initializer yet.");return r}return Object(ea.a)(n,[{key:"apply",value:function(e,t){var n=this;return Object(a.wf)((function(){if(e.length<2)throw new ua("Shape must be at least 2D.");e[0]*e[1]>2e3&&console.warn("Orthogonal initializer is being called on a matrix with more "+"than 2000 (".concat(e[0]*e[1],") elements: ")+"Slowness may result.");var t=ci(e[0]>e[1]?[e[1],e[0]]:e,0,1,"float32"),r=a.re.gramSchmidt(t);return e[0]>e[1]&&(r=Object(a.zf)(r)),Object(a.Fe)(n.gain,r)}))}},{key:"getConfig",value:function(){return{gain:this.gain,seed:this.seed}}}]),n}(xi);Fi.className="Orthogonal",a.Ze.registerClass(Fi);var Mi={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function zi(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return ka(e,a.Ze.SerializationMap.getMap().classNameMap,t,"initializer")}function Li(e){return ya(e)}function Pi(e){if("string"===typeof e){var t=e in Mi?Mi[e]:e;if("GlorotNormal"===t)return new Ei;if("GlorotUniform"===t)return new Ci;if("HeNormal"===t)return new _i;if("HeUniform"===t)return new Ai;if("LeCunNormal"===t)return new Ri;if("LeCunUniform"===t)return new Di;var n={};return n.className=t,n.config={},zi(n)}return e instanceof xi?e:zi(e)}function Bi(e){return Array.isArray(e)&&Array.isArray(e[0])}function Wi(e){return 0===e.length?[]:Array.isArray(e[0])?e:[e]}function Ui(e){var t;if(Array.isArray(e)){if(1!==e.length)throw new sa("Expected Tensor length to be 1; got ".concat(e.length));t=e[0]}else t=e;return t}function Vi(e){if(Array.isArray(e)&&Array.isArray(e[0])){if(1===e.length)return(e=e)[0];throw new sa("Expected exactly 1 Shape; got ".concat(e.length))}return e}function Gi(e){var t,n=0,r=Object(Qr.a)(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;0===a.shape.length?n+=1:n+=a.shape.reduce((function(e,t){return e*t}))}}catch(i){r.e(i)}finally{r.f()}return n}var Hi=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Variable",i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;Object($r.a)(this,e),this.dtype=null==n?"float32":n,this.shape=t.shape,this.id=Ea(),r=null==r?"Variable":r,this.originalName=Ga(r),this.name=Ha(this.originalName),this.trainable_=i,this.constraint=o,this.val=a.Ef(t,this.trainable_,this.name,this.dtype)}return Object(ea.a)(e,[{key:"read",value:function(){return this.assertNotDisposed(),this.val}},{key:"write",value:function(e){return this.assertNotDisposed(),function(e,t){if(e.shape.toString()!==t.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(e.shape)+" vs. "+JSON.stringify(t.shape))}(this.val,e),this.val.id!==e.id&&(this.val.assign(e),null!=this.constraint&&this.val.assign(this.constraint.apply(this.val))),this}},{key:"dispose",value:function(){this.assertNotDisposed(),this.val.dispose()}},{key:"assertNotDisposed",value:function(){if(this.val.isDisposed)throw new Error("LayersVariable ".concat(this.name," is already disposed."))}},{key:"trainable",get:function(){return this.trainable_},set:function(e){this.trainable_=e,this.val.trainable=e}}]),e}();function qi(e){return e.map((function(e){return e.read()}))}function Ki(e){e.forEach((function(e){e[0].write(e[1])}))}var Xi=function e(t){Object($r.a)(this,e),this.dtype=t.dtype,this.shape=t.shape,null!=t.shape?this.ndim=t.shape.length:this.ndim=t.ndim,this.maxNDim=t.maxNDim,this.minNDim=t.minNDim,this.axes=t.axes||{}},Yi=function e(t,n,r,a,i,o,s){Object($r.a)(this,e),this.dtype=t,this.shape=n,this.sourceLayer=r,this.inputs=a,this.callArgs=i,this.outputTensorIndex=s,this.id=Ea(),null!=o&&(this.originalName=Ga(o),this.name=Ha(this.originalName)),this.rank=n.length},Zi=0,Ji=function(){function e(t,n){Object($r.a)(this,e),this.callArgs=n,this.id=Zi++,this.outboundLayer=t.outboundLayer,this.inboundLayers=t.inboundLayers,this.nodeIndices=t.nodeIndices,this.tensorIndices=t.tensorIndices,this.inputTensors=t.inputTensors,this.outputTensors=t.outputTensors,this.inputMasks=t.inputMasks,this.outputMasks=t.outputMasks,this.inputShapes=t.inputShapes,this.outputShapes=t.outputShapes;var r,a=Object(Qr.a)(t.inboundLayers);try{for(a.s();!(r=a.n()).done;){var i=r.value;null!=i&&i.outboundNodes.push(this)}}catch(o){a.e(o)}finally{a.f()}t.outboundLayer.inboundNodes.push(this)}return Object(ea.a)(e,[{key:"getConfig",value:function(){var e,t=[],n=Object(Qr.a)(this.inboundLayers);try{for(n.s();!(e=n.n()).done;){var r=e.value;null!=r?t.push(r.name):t.push(null)}}catch(a){n.e(a)}finally{n.f()}return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:t,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}]),e}(),Qi=0,$i=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object($r.a)(this,n),(e=t.call(this))._callHook=null,e._addedWeightNames=[],e._stateful=!1,e.id=Qi++,e.activityRegularizer=null,e.inputSpec=null,e.supportsMasking=!1,e._trainableWeights=[],e._nonTrainableWeights=[],e._losses=[],e._updates=[],e._built=!1,e.inboundNodes=[],e.outboundNodes=[];var a=r.name;if(!a){var i=e.getClassName();a=va(i)+"_"+Aa(i)}if(e.name=a,e.trainable_=null==r.trainable||r.trainable,null!=r.inputShape||null!=r.batchInputShape){var o;if(null!=r.batchInputShape)o=r.batchInputShape;else if(null!=r.inputShape){var s=null;null!=r.batchSize&&(s=r.batchSize),o=[s].concat(r.inputShape)}e.batchInputShape=o;var u=r.dtype;null==u&&(u=r.inputDType),null==u&&(u="float32"),e.dtype=u}return null!=r.weights?e.initialWeights=r.weights:e.initialWeights=null,e._refCount=null,e.fastWeightInitDuringBuild=!1,e}return Object(ea.a)(n,[{key:"getNodeAtIndex",value:function(e,t){if(0===this.inboundNodes.length)throw new oa("The layer has never been called "+"and thus has no defined ".concat(t,"."));if(this.inboundNodes.length<=e)throw new sa("Asked to get ".concat(t," at node ").concat(e,", ")+"but the layer has only ".concat(this.inboundNodes.length," inbound nodes."));return this.inboundNodes[e]}},{key:"getInputAt",value:function(e){return ha(this.getNodeAtIndex(e,"input").inputTensors)}},{key:"getOutputAt",value:function(e){return ha(this.getNodeAtIndex(e,"output").outputTensors)}},{key:"calculateLosses",value:function(){return this.losses.map((function(e){return e()}))}},{key:"resetStates",value:function(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}},{key:"assertInputCompatibility",value:function(e){if(e=ma(e),null!=this.inputSpec&&0!==this.inputSpec.length){var t=ma(this.inputSpec);if(e.length!==t.length)throw new sa("Layer ".concat(this.name," expects ").concat(t.length," inputs, ")+"but it received ".concat(e.length," input tensors. ")+"Input received: ".concat(e));for(var n=0;n<e.length;n++){var r=e[n],a=t[n];if(null!=a){var i=r.rank;if(null!=a.ndim&&i!==a.ndim)throw new sa("Input ".concat(n," is incompatible with layer ").concat(this.name,": ")+"expected ndim=".concat(a.ndim,", found ndim=").concat(i));if(null!=a.maxNDim&&i>a.maxNDim)throw new sa("Input ".concat(n," is incompatible with layer ").concat(this.name)+": expected max_ndim=".concat(a.maxNDim,", found ndim=").concat(i));if(null!=a.minNDim&&i<a.minNDim)throw new sa("Input ".concat(n," is incompatible with layer ").concat(this.name)+": expected min_ndim=".concat(a.minNDim,", found ndim=").concat(i,"."));if(null!=a.dtype&&r.dtype!==a.dtype)throw new sa("Input ".concat(n," is incompatible with layer ").concat(this.name," ")+": expected dtype=".concat(a.dtype,", found dtype=").concat(r.dtype,"."));if(a.axes){var o=r.shape;for(var s in a.axes){var u=Number(s),c=a.axes[s],l=u>=0?o[u]:o[o.length+u];if(null!=c&&-1===[c,null].indexOf(l))throw new sa("Input ".concat(n," is incompatible with layer ")+"".concat(this.name,": expected axis ").concat(u," of input shape to ")+"have value ".concat(c," but got shape ").concat(o,"."))}}if(null!=a.shape)for(var d=0;d<a.shape.length;++d){var p=a.shape[d],f=r.shape[d];if(null!=p&&null!=f&&p!==f)throw new sa("Input ".concat(n," is incompatible with layer ")+"".concat(this.name,": expected shape=").concat(a.shape,", ")+"found shape=".concat(r.shape,"."))}}}}}},{key:"call",value:function(e,t){return e}},{key:"invokeCallHook",value:function(e,t){null!=this._callHook&&this._callHook(e,t)}},{key:"setCallHook",value:function(e){this._callHook=e}},{key:"clearCallHook",value:function(){this._callHook=null}},{key:"apply",value:function(e,t){var n=this;t=t||{},this.assertNotDisposed();var r,a=ma(e),i=!0,o=Object(Qr.a)(a);try{for(o.s();!(r=o.n()).done;){if(!(r.value instanceof Yi)){i=!1;break}}}catch(l){o.e(l)}finally{o.f()}var s,u=!0,c=Object(Qr.a)(a);try{for(c.s();!(s=c.n()).done;){if(s.value instanceof Yi){u=!1;break}}}catch(l){c.e(l)}finally{c.f()}if(i===u)throw new sa("Arguments to apply() must be all SymbolicTensors or all Tensors");return Va(this.name,(function(){if(!n.built){n.assertInputCompatibility(e);var r,i=[],o=Object(Qr.a)(ma(e));try{for(o.s();!(r=o.n()).done;){var s=r.value;i.push(s.shape)}}catch(l){o.e(l)}finally{o.f()}n.build(ha(i)),n.built=!0,n.initialWeights&&n.setWeights(n.initialWeights),null===n._refCount&&u&&(n._refCount=1)}if(n.assertInputCompatibility(e),u){var c,d=n.call(e,t),p=ma(d),f=[],h=Object(Qr.a)(p);try{for(h.s();!(c=h.n()).done;){var m=c.value;-1!==a.indexOf(m)&&(m=m.clone()),f.push(m)}}catch(l){h.e(l)}finally{h.f()}if(d=ha(f),null!=n.activityRegularizer)throw new ua("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return d}var v,b=function(e){e=ma(e);var t,n=[],r=Object(Qr.a)(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;n.push(a.shape)}}catch(l){r.e(l)}finally{r.f()}return ha(n)}(e),g=n.computeOutputShape(b);if(n.warnOnIncompatibleInputShape(Array.isArray(e)?b[0]:b),v=null!=g&&g.length>0&&Array.isArray(g[0])?g.map((function(r,a){return new Yi("float32",r,n,ma(e),t,n.name,a)})):new Yi("float32",g,n,ma(e),t,n.name),n.addInboundNode(e,v,null,null,b,g,t),n._refCount++,null!=n.activityRegularizer)throw new ua("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return v}))}},{key:"warnOnIncompatibleInputShape",value:function(e){if(null!=this.batchInputShape)if(e.length!==this.batchInputShape.length)console.warn("The rank of the input tensor provided (shape: "+"".concat(JSON.stringify(e),") does not match that of the ")+"batchInputShape (".concat(JSON.stringify(this.batchInputShape),") ")+"of the layer ".concat(this.name));else{var t=!1;this.batchInputShape.forEach((function(n,r){null!=n&&null!=e[r]&&e[r]!==n&&(t=!0)})),t&&console.warn("The shape of the input tensor "+"(".concat(JSON.stringify(e),") does not ")+"match the expectation of layer ".concat(this.name,": ")+"".concat(JSON.stringify(this.batchInputShape)))}}},{key:"countParams",value:function(){if(!this.built)throw new oa("You tried to call countParams() on ".concat(this.name,", ")+"but the layer is not built yet. Build it first by calling build(batchInputShape).");return Gi(this.weights)}},{key:"build",value:function(e){this.built=!0}},{key:"getWeights",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return qi(e?this.trainableWeights:this.weights)}},{key:"setWeights",value:function(e){var t=this;Object(a.wf)((function(){var n=t.weights;if(n.length!==e.length)throw new sa('You called setWeights(weights) on layer "'.concat(t.name,'" ')+"with a weight list of length ".concat(e.length,", ")+"but the layer was expecting ".concat(n.length," weights. ")+"Provided weights: ".concat(e,"..."));if(0!==n.length){for(var r=[],i=qi(n),o=0;o<i.length;++o){var s=i[o],u=n[o],c=e[o];if(!a.Df.arraysEqual(s.shape,c.shape))throw new sa("Layer weight shape ".concat(s.shape," ")+"not compatible with provided weight shape ".concat(c.shape));r.push([u,c])}Ki(r)}}))}},{key:"addWeight",value:function(e,t,n,r,a,i,o,s){if(-1!==this._addedWeightNames.indexOf(e))throw new sa("Duplicate weight name ".concat(e," for layer ").concat(this.name));this._addedWeightNames.push(e),null==n&&(n="float32"),this.fastWeightInitDuringBuild&&(r=null!=s?s():Pi("zeros"));var u=r.apply(t,n),c=new Hi(u,n,e,i,o);return u.dispose(),null!=a&&this.addLoss((function(){return a.apply(c.read())})),null==i&&(i=!0),i?this._trainableWeights.push(c):this._nonTrainableWeights.push(c),c}},{key:"setFastWeightInitDuringBuild",value:function(e){this.fastWeightInitDuringBuild=e}},{key:"addLoss",value:function(e){var t;null==e||Array.isArray(e)&&0===e.length||(e=ma(e),void 0!==this._losses&&null!==this._losses&&(t=this.losses).push.apply(t,Object(qn.a)(e)))}},{key:"computeOutputShape",value:function(e){return e}},{key:"computeMask",value:function(e,t){var n=this;if(!this.supportsMasking){if(null!=t){if(!Array.isArray(t))throw new TypeError("Layer ".concat(this.name," does not support masking, ")+"but was passed an inputMask.");t.forEach((function(e){if(null!=e)throw new TypeError("Layer ".concat(n.name," does not support masking, ")+"but was passed an inputMask.")}))}return null}return t}},{key:"addInboundNode",value:function(e,t,n,r,a,i){var o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=ma(e);t=ma(t),n=ma(n),r=ma(r),a=Wi(a),i=Wi(i);var u,c=[],l=[],d=[],p=Object(Qr.a)(s);try{for(p.s();!(u=p.n()).done;){var f=u.value;c.push(f.sourceLayer),l.push(f.nodeIndex),d.push(f.tensorIndex)}}catch(m){p.e(m)}finally{p.f()}new Ji({outboundLayer:this,inboundLayers:c,nodeIndices:l,tensorIndices:d,inputTensors:s,outputTensors:t,inputMasks:n,outputMasks:r,inputShapes:a,outputShapes:i},o);for(var h=0;h<t.length;h++)t[h].sourceLayer=this,t[h].nodeIndex=this.inboundNodes.length-1,t[h].tensorIndex=h}},{key:"getConfig",value:function(){var e={name:this.name,trainable:this.trainable};return null!=this.batchInputShape&&(e.batchInputShape=this.batchInputShape),null!=this.dtype&&(e.dtype=this.dtype),e}},{key:"disposeWeights",value:function(){return this.weights.forEach((function(e){return e.dispose()})),this.weights.length}},{key:"assertNotDisposed",value:function(){if(0===this._refCount)throw new Error("Layer '".concat(this.name,"' is already disposed."))}},{key:"dispose",value:function(){if(!this.built)throw new Error("Cannot dispose Layer ".concat(this.name," because it has not been ")+"built yet.");if(null===this._refCount)throw new Error("Cannot dispose Layer ".concat(this.name," because it has not been used ")+"yet.");this.assertNotDisposed();var e=0;return 0===--this._refCount&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}},{key:"input",get:function(){if(this.inboundNodes.length>1)throw new ia("Layer ".concat(this.name)+' has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use `getInputAt(nodeIndex)` instead.');if(0===this.inboundNodes.length)throw new ia("Layer ".concat(this.name)+" is not connected, no input to return.");return ha(this.getNodeAtIndex(0,"input").inputTensors)}},{key:"output",get:function(){if(0===this.inboundNodes.length)throw new ia("Layer ".concat(this.name)+" has no inbound nodes.");if(this.inboundNodes.length>1)throw new ia("Layer ".concat(this.name)+' has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use `getOutputAt(nodeIndex)` instead.');return ha(this.getNodeAtIndex(0,"output").outputTensors)}},{key:"losses",get:function(){return this._losses}},{key:"updates",get:function(){return this._updates}},{key:"built",get:function(){return this._built},set:function(e){this._built=e}},{key:"trainable",get:function(){return this.trainable_},set:function(e){this._trainableWeights.forEach((function(t){return t.trainable=e})),this.trainable_=e}},{key:"trainableWeights",get:function(){return this.trainable_?this._trainableWeights.filter((function(e){return e.trainable})):[]},set:function(e){this._trainableWeights=e}},{key:"nonTrainableWeights",get:function(){return this.trainable?this._trainableWeights.filter((function(e){return!e.trainable})).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)},set:function(e){this._nonTrainableWeights=e}},{key:"weights",get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)}},{key:"stateful",get:function(){return this._stateful}},{key:"outputShape",get:function(){if(null==this.inboundNodes||0===this.inboundNodes.length)throw new ia("The layer ".concat(this.name," has never been called and thus has no ")+"defined output shape.");var e,t=[],n=Object(Qr.a)(this.inboundNodes);try{for(n.s();!(e=n.n()).done;){var r=e.value,a=JSON.stringify(r.outputShapes);-1===t.indexOf(a)&&t.push(a)}}catch(o){n.e(o)}finally{n.f()}if(1===t.length){var i=this.inboundNodes[0].outputShapes;return Array.isArray(i)&&Array.isArray(i[0])&&1===i.length?i[0]:i}throw new ia("The layer ".concat(this.name," has multiple inbound nodes with different ")+'output shapes. Hence the notion of "output shape" is ill-defined for the layer.')}}],[{key:"nodeKey",value:function(e,t){return e.name+"_ib-"+t.toString()}}]),n}(a.Ze.Serializable);var eo=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;if(Object($r.a)(this,n),r=t.call(this,{dtype:e.dtype,name:null!=e.name?e.name:Aa("input").toString()}),null==e.batchSize&&(e.batchSize=null),null==e.sparse&&(e.sparse=!1),r.trainable=!1,r.built=!0,r.sparse=e.sparse,null!=e.inputShape&&null!=e.batchInputShape)throw new sa("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");var a=e.batchInputShape;if(null==a){if(null==e.inputShape)throw new sa("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");a=[e.batchSize].concat(e.inputShape)}else if(null!=e.batchSize)throw new sa("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");var i=e.dtype||"float32";r.batchInputShape=a,r.dtype=i,r.inputSpec=[{shape:a}];var o=new Yi(r.dtype,r.batchInputShape,Object(ta.a)(r),[],{},r.name);return o.nodeIndex=0,o.tensorIndex=0,new Ji({outboundLayer:Object(ta.a)(r),inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[o],outputTensors:[o],inputMasks:[null],outputMasks:[null],inputShapes:[a],outputShapes:[a]}),r}return Object(ea.a)(n,[{key:"apply",value:function(e,t){throw new sa("Cannot pass any input to an "+"InputLayer's apply() method. InputLayer name: ".concat(this.name))}},{key:"dispose",value:function(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}},{key:"getConfig",value:function(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}]),n}($i);function to(e){if(null==e.batchShape&&null==e.shape)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(null!=e.batchShape&&null!=e.shape)throw new sa("Please provide either a `shape` or `batchShape` argument to Input, but not both.");var t=e.batchShape;null!=e.shape&&null==t&&(t=[null].concat(e.shape));var n=e.dtype;return null==n&&(n="float32"),new eo({batchInputShape:t,name:e.name,dtype:n,sparse:e.sparse}).inboundNodes[0].outputTensors[0]}eo.className="InputLayer",a.Ze.registerClass(eo);var no=function(){function e(t){if(Object($r.a)(this,e),this.id2Value={},this.id2Mask={},this.name2Id={},t instanceof e)for(var n in t.id2Value)this.id2Value[n]=t.id2Value[n],n in t.id2Mask&&(this.id2Mask[n]=t.id2Mask[n]);else{if(null==t)return;var r,a=Object(Qr.a)(t);try{for(a.s();!(r=a.n()).done;){var i=r.value;this.add(i.key,i.value)}}catch(o){a.e(o)}finally{a.f()}}}return Object(ea.a)(e,[{key:"add",value:function(e,t,n){if(null!=this.id2Value[e.id])throw new sa("Duplicate key: name=".concat(e.name,", id=").concat(e.id));return this.id2Value[e.id]=function(e,t){if(null==e.dtype||e.dtype===t.dtype)return t;try{return Object(a.Hd)(t,e.dtype)}catch(n){throw new sa("The dtype of the feed (".concat(t.dtype,") can not be cast to the dtype ")+"of the key '".concat(e.name,"' (").concat(e.dtype,")."))}}(e,t),this.name2Id[e.name]=e.id,null!=n&&(this.id2Mask[e.id]=n),this}},{key:"addFeed",value:function(e){this.add(e.key,e.value)}},{key:"hasKey",value:function(e){return null!=this.id2Value[e.id]}},{key:"names",value:function(){return Object.keys(this.name2Id)}},{key:"getValue",value:function(e){if(e instanceof Yi){if(null==this.id2Value[e.id])throw new sa("Nonexistent key: ".concat(e.name));return this.id2Value[e.id]}var t=this.name2Id[e];if(null==t)throw new sa("Feed dict has no SymbolicTensor name: ".concat(e));return this.id2Value[t]}},{key:"getMask",value:function(e){if(e instanceof Yi){if(null==this.id2Value[e.id])throw new sa("Nonexistent key: ".concat(e.name));return this.id2Mask[e.id]}var t=this.name2Id[e];if(null==t)throw new sa("Feed dict has no SymbolicTensor name: ".concat(e));return this.id2Mask[t]}},{key:"disposeMasks",value:function(){null!=this.id2Mask&&Object(a.Wd)(this.id2Mask)}}]),e}(),ro=new la,ao=new la;function io(e,t,n,r){var i,o=null!=n&&n.training,s=Array.isArray(e),u=s?e:[e],c=u.map((function(e){return e.name})),l=[],d=t.names(),p=Object(Qr.a)(c);try{for(p.s();!(i=p.n()).done;){var f=i.value;-1!==d.indexOf(f)?l.push(t.getValue(f)):l.push(null)}}catch(L){p.e(L)}finally{p.f()}null!=r&&(r.maxNumTensors=-1/0,r.minNumTensors=1/0);var h,m=c.join(",")+"|"+t.names().sort().join(","),v=ro.get(m);if(null==v){var b=function(e,t){a.Df.assert(null!=e&&e.length>0,(function(){return"Expected at least one fetch, got none"}));var n=[],r={};if(1===e.length){var i=so(e[0],t);n=i.sorted,r=i.recipientMap}else{var o,s=new Set,u=Object(Qr.a)(e);try{for(u.s();!(o=u.n()).done;){var c,l=so(o.value,t),d=l.sorted,p=l.recipientMap,f=Object(Qr.a)(d);try{for(f.s();!(c=f.n()).done;){var h=c.value;s.has(h.name)||(n.push(h),s.add(h.name))}}catch(L){f.e(L)}finally{f.f()}var m=function(e){null==r[e]&&(r[e]=new Set),p[e].forEach((function(t){return r[e].add(t)}))};for(var v in p)m(v)}}catch(L){u.e(L)}finally{u.f()}}return{sorted:n,recipientCounts:oo(r)}}(u,t);v=b.sorted,h=b.recipientCounts,ro.put(m,v),ao.put(m,h)}h={},o||Object.assign(h,ao.get(m));for(var g=new no(t),y=0;y<v.length;++y){if(null!=r){var x=Object(a.Ce)().numTensors;x>r.maxNumTensors&&(r.maxNumTensors=x),x<r.minNumTensors&&(r.minNumTensors=x)}var k=v[y],w=k.sourceLayer;if(!(w instanceof eo)){var O,I=[],S=[],N=[],j=!1,T=Object(Qr.a)(k.inputs);try{for(T.s();!(O=T.n()).done;){var C=O.value,E=g.getValue(C),_=g.getMask(C);I.push(E),S.push(_),null!=_&&(j=!0),o||(h[C.name]--,0!==h[C.name]||t.hasKey(C)||-1!==c.indexOf(C.name)||E.isDisposed||!0===C.sourceLayer.stateful||N.push(E))}}catch(L){T.e(L)}finally{T.f()}j&&((n=n||{}).mask=S[0]);var A=ma(w.apply(I,n)),R=null;w.supportsMasking&&(R=w.computeMask(I,S));for(var D=uo(k),F=Array.isArray(D)?D:[D],M=0;M<F.length;++M){g.hasKey(F[M])||g.add(F[M],A[M],Array.isArray(R)?R[0]:R);var z=c.indexOf(F[M].name);-1!==z&&(l[z]=A[M])}o||Object(a.Wd)(N)}}return g.disposeMasks(),s?l:l[0]}function oo(e){var t={};for(var n in e)t[n]=e[n].size;return t}function so(e,t){var n,r=new Set,a=[],i={},o=Object(Qr.a)(t.names());try{for(o.s();!(n=o.n()).done;){var s=n.value;r.add(s)}}catch(m){o.e(m)}finally{o.f()}var u=[],c=[];for(u.push(e);u.length>0;){var l=u[u.length-1];if(r.has(l.name))u.pop();else{var d=c[c.length-1]===u.length-1;if(0===l.inputs.length||d)u.pop(),a.push(l),r.add(l.name),d&&c.pop();else{c.push(u.length-1);var p,f=Object(Qr.a)(l.inputs);try{for(f.s();!(p=f.n()).done;){var h=p.value;null==i[h.name]&&(i[h.name]=new Set),i[h.name].add(l.name),r.has(h.name)||u.push(h)}}catch(m){f.e(m)}finally{f.f()}}}}return{sorted:a,recipientMap:i}}function uo(e){var t;if(1===e.sourceLayer.inboundNodes.length)t=e.sourceLayer.output;else{for(var n=null,r=0;r<e.sourceLayer.inboundNodes.length;++r){var a,i=Object(Qr.a)(e.sourceLayer.inboundNodes[r].outputTensors);try{for(i.s();!(a=i.n()).done;){if(a.value.id===e.id){n=r;break}}}catch(o){i.e(o)}finally{i.f()}}t=e.sourceLayer.getOutputAt(n)}return t}function co(e,t){return Object(a.wf)((function(){return a.lf(a.pf(a.Fe(e,e),t,!0))}))}Object(a.be)().registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",(function(){return 100}),(function(e){null!=ro&&ro.setMaxEntries(e),null!=ao&&ao.setMaxEntries(e)}));var lo=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(){return Object($r.a)(this,n),t.apply(this,arguments)}return Object(ea.a)(n,[{key:"getConfig",value:function(){return{}}}]),n}(a.Ze.Serializable),po=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;return Object($r.a)(this,n),(r=t.call(this)).defaultMaxValue=2,r.defaultAxis=0,r.maxValue=null!=e.maxValue?e.maxValue:r.defaultMaxValue,r.axis=null!=e.axis?e.axis:r.defaultAxis,r}return Object(ea.a)(n,[{key:"apply",value:function(e){var t=this;return Object(a.wf)((function(){var n=co(e,t.axis),r=a.Id(n,0,t.maxValue);return a.Fe(e,a.Xd(r,a.sd($a(),n)))}))}},{key:"getConfig",value:function(){return{maxValue:this.maxValue,axis:this.axis}}}]),n}(lo);po.className="MaxNorm",a.Ze.registerClass(po);var fo=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;return Object($r.a)(this,n),(r=t.call(this)).defaultAxis=0,r.axis=null!=e.axis?e.axis:r.defaultAxis,r}return Object(ea.a)(n,[{key:"apply",value:function(e){var t=this;return Object(a.wf)((function(){return a.Xd(e,a.sd($a(),co(e,t.axis)))}))}},{key:"getConfig",value:function(){return{axis:this.axis}}}]),n}(lo);fo.className="UnitNorm",a.Ze.registerClass(fo);var ho=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(){return Object($r.a)(this,n),t.apply(this,arguments)}return Object(ea.a)(n,[{key:"apply",value:function(e){return a.Te(e)}}]),n}(lo);ho.className="NonNeg",a.Ze.registerClass(ho);var mo=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;return Object($r.a)(this,n),(r=t.call(this)).defaultMinValue=0,r.defaultMaxValue=1,r.defaultRate=1,r.defaultAxis=0,r.minValue=null!=e.minValue?e.minValue:r.defaultMinValue,r.maxValue=null!=e.maxValue?e.maxValue:r.defaultMaxValue,r.rate=null!=e.rate?e.rate:r.defaultRate,r.axis=null!=e.axis?e.axis:r.defaultAxis,r}return Object(ea.a)(n,[{key:"apply",value:function(e){var t=this;return Object(a.wf)((function(){var n=co(e,t.axis),r=a.sd(a.Fe(t.rate,a.Id(n,t.minValue,t.maxValue)),a.Fe(1-t.rate,n));return a.Fe(e,a.Xd(r,a.sd($a(),n)))}))}},{key:"getConfig",value:function(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}]),n}(lo);mo.className="MinMaxNorm",a.Ze.registerClass(mo);var vo={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function bo(e){return ya(e)}function go(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return ka(e,a.Ze.SerializationMap.getMap().classNameMap,t,"constraint")}function yo(e){return null==e?null:"string"===typeof e?go({className:e in vo?vo[e]:e,config:{}}):e instanceof lo?e:go(e)}var xo,ko=n(1),wo=n.n(ko),Oo=n(8);function Io(e){return So.apply(this,arguments)}function So(){return(So=Object(Oo.a)(wo.a.mark((function e(t){var n,r,i,o,s,u,c,l;return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t){e.next=2;break}return e.abrupt("return");case 2:for(o in n=[],r=[],i=[],t)"number"!==typeof(s=t[o])&&(u=s,n.push(u.data()),r.push(o),i.push(u));if(!(n.length>0)){e.next=12;break}return e.next=9,Promise.all(n);case 9:for(c=e.sent,l=0;l<c.length;++l)t[r[l]]=c[l][0];Object(a.Wd)(i);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function No(e){if(null!=e)for(var t in e){var n=e[t];"number"!==typeof n&&n.dispose()}}!function(e){e[e.SILENT=0]="SILENT",e[e.VERBOSE=1]="VERBOSE"}(xo||(xo={}));var jo=function(){function e(){Object($r.a)(this,e),this.validationData=null}return Object(ea.a)(e,[{key:"setParams",value:function(e){this.params=e}},{key:"onEpochBegin",value:function(){var e=Object(Oo.a)(wo.a.mark((function e(t,n){return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=Object(Oo.a)(wo.a.mark((function e(t,n){return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchBegin",value:function(){var e=Object(Oo.a)(wo.a.mark((function e(t,n){return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchEnd",value:function(){var e=Object(Oo.a)(wo.a.mark((function e(t,n){return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onTrainBegin",value:function(){var e=Object(Oo.a)(wo.a.mark((function e(t){return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"onTrainEnd",value:function(){var e=Object(Oo.a)(wo.a.mark((function e(t){return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"setModel",value:function(e){}}]),e}(),To=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;Object($r.a)(this,e),null==t&&(t=[]),this.callbacks=t,this.queueLength=n}return Object(ea.a)(e,[{key:"append",value:function(e){this.callbacks.push(e)}},{key:"setParams",value:function(e){var t,n=Object(Qr.a)(this.callbacks);try{for(n.s();!(t=n.n()).done;){t.value.setParams(e)}}catch(r){n.e(r)}finally{n.f()}}},{key:"setModel",value:function(e){var t,n=Object(Qr.a)(this.callbacks);try{for(n.s();!(t=n.n()).done;){t.value.setModel(e)}}catch(r){n.e(r)}finally{n.f()}}},{key:"onEpochBegin",value:function(){var e=Object(Oo.a)(wo.a.mark((function e(t,n){var r,a,i;return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=Object(Qr.a)(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onEpochBegin(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=Object(Oo.a)(wo.a.mark((function e(t,n){var r,a,i;return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=Object(Qr.a)(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onEpochEnd(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchBegin",value:function(){var e=Object(Oo.a)(wo.a.mark((function e(t,n){var r,a,i;return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=Object(Qr.a)(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onBatchBegin(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchEnd",value:function(){var e=Object(Oo.a)(wo.a.mark((function e(t,n){var r,a,i;return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=Object(Qr.a)(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onBatchEnd(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onTrainBegin",value:function(){var e=Object(Oo.a)(wo.a.mark((function e(t){var n,r,a;return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==t&&(t={}),n=Object(Qr.a)(this.callbacks),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=10;break}return a=r.value,e.next=8,a.onTrainBegin(t);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),n.e(e.t0);case 15:return e.prev=15,n.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t){return e.apply(this,arguments)}}()},{key:"onTrainEnd",value:function(){var e=Object(Oo.a)(wo.a.mark((function e(t){var n,r,a;return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==t&&(t={}),n=Object(Qr.a)(this.callbacks),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=10;break}return a=r.value,e.next=8,a.onTrainEnd(t);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),n.e(e.t0);case 15:return e.prev=15,n.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t){return e.apply(this,arguments)}}()}]),e}(),Co=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(){return Object($r.a)(this,n),t.call(this)}return Object(ea.a)(n,[{key:"onEpochBegin",value:function(){var e=Object(Oo.a)(wo.a.mark((function e(t){return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.seen=0,this.totals={};case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onBatchEnd",value:function(){var e=Object(Oo.a)(wo.a.mark((function e(t,n){var r,i,o,s=this;return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(o in null==n&&(n={}),r=null==n.size?0:n.size,this.seen+=r,i=function(e){var t=n[e];if("number"===typeof t)s.totals.hasOwnProperty(e)||(s.totals[e]=0),s.totals[e]=s.totals[e]+t*r;else{var i;e in s.totals?i=s.totals[e]:s.totals[e]=0;var o=Object(a.wf)((function(){return Object(a.sd)(s.totals[e],Object(a.Fe)(t,r))}));s.totals[e]=o,null!=i&&i.dispose()}},n)i(o);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=Object(Oo.a)(wo.a.mark((function e(t,n){var r,i,o,s=this;return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n){e.next=19;break}r=Object(Qr.a)(this.params.metrics),e.prev=2,o=function(){var e=i.value;if(null==s.totals[e])return"continue";"number"===typeof s.totals[e]?n[e]=s.totals[e]/s.seen:Object(a.wf)((function(){var t=Object(a.Fe)(Object(a.Xd)(1,s.seen),s.totals[e]);n[e]=t,s.totals[e].dispose(),Object(a.oe)(n[e])}))},r.s();case 5:if((i=r.n()).done){e.next=11;break}if("continue"!==o()){e.next=9;break}return e.abrupt("continue",9);case 9:e.next=5;break;case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(2),r.e(e.t0);case 16:return e.prev=16,r.f(),e.finish(16);case 19:case"end":return e.stop()}}),e,this,[[2,13,16,19]])})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(jo),Eo=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(){return Object($r.a)(this,n),t.apply(this,arguments)}return Object(ea.a)(n,[{key:"onTrainBegin",value:function(){var e=Object(Oo.a)(wo.a.mark((function e(t){return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.epoch=[],this.history={};case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=Object(Oo.a)(wo.a.mark((function e(t,n){var r;return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r in null==n&&(n={}),this.epoch.push(t),n)null==this.history[r]&&(this.history[r]=[]),this.history[r].push(n[r]);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"syncData",value:function(){var e=Object(Oo.a)(wo.a.mark((function e(){var t,n,r,a,i,o,s,u,c;return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a in t=[],n=[],r=[],this.history)for(i=this.history[a],o=0;o<i.length;++o)"number"!==typeof i[o]&&(s=i[o],t.push(s.data()),n.push(a),r.push(o));return e.next=6,Promise.all(t);case 6:for(u=e.sent,c=0;c<u.length;++c)this.history[n[c]][r[c]].dispose(),this.history[n[c]][r[c]]=u[c][0];case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(jo),_o=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e,r){var i;if(Object($r.a)(this,n),(i=t.call(this)).currentEpoch=0,i.nowFunc=e.nowFunc,i.nextFrameFunc=e.nextFrameFunc||a.He,i.yieldEvery=r||"auto","auto"===i.yieldEvery&&(i.yieldEvery=125),"never"===i.yieldEvery&&null!=e.onYield)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");return a.Df.isNumber(i.yieldEvery)&&(i.maybeWait=function(e,t,n){var r,i=null!=n?n():a.Df.now();return function(){var o=null!=n?n():a.Df.now();return o-i<t?r:(i=o,r=e.apply(void 0,arguments))}}(i.maybeWait.bind(Object(ta.a)(i)),i.yieldEvery,i.nowFunc)),i.trainBegin=e.onTrainBegin,i.trainEnd=e.onTrainEnd,i.epochBegin=e.onEpochBegin,i.epochEnd=e.onEpochEnd,i.batchBegin=e.onBatchBegin,i.batchEnd=e.onBatchEnd,i.yield=e.onYield,i}return Object(ea.a)(n,[{key:"maybeWait",value:function(){var e=Object(Oo.a)(wo.a.mark((function e(t,n,r){var a;return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=[],null==this.yield){e.next=5;break}return e.next=4,Io(r);case 4:a.push(this.yield(t,n,r));case 5:return a.push(this.nextFrameFunc()),e.next=8,Promise.all(a);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"onEpochBegin",value:function(){var e=Object(Oo.a)(wo.a.mark((function e(t,n){return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.currentEpoch=t,null==this.epochBegin){e.next=6;break}return e.next=4,Io(n);case 4:return e.next=6,this.epochBegin(t,n);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=Object(Oo.a)(wo.a.mark((function e(t,n){var r;return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=[],null==this.epochEnd){e.next=5;break}return e.next=4,Io(n);case 4:r.push(this.epochEnd(t,n));case 5:return"epoch"===this.yieldEvery&&r.push(this.nextFrameFunc()),e.next=8,Promise.all(r);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchBegin",value:function(){var e=Object(Oo.a)(wo.a.mark((function e(t,n){return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.batchBegin){e.next=5;break}return e.next=3,Io(n);case 3:return e.next=5,this.batchBegin(t,n);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchEnd",value:function(){var e=Object(Oo.a)(wo.a.mark((function e(t,n){var r;return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=[],null==this.batchEnd){e.next=5;break}return e.next=4,Io(n);case 4:r.push(this.batchEnd(t,n));case 5:return"batch"===this.yieldEvery?r.push(this.nextFrameFunc()):a.Df.isNumber(this.yieldEvery)&&r.push(this.maybeWait(this.currentEpoch,t,n)),e.next=8,Promise.all(r);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onTrainBegin",value:function(){var e=Object(Oo.a)(wo.a.mark((function e(t){return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.trainBegin){e.next=5;break}return e.next=3,Io(t);case 3:return e.next=5,this.trainBegin(t);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onTrainEnd",value:function(){var e=Object(Oo.a)(wo.a.mark((function e(t){return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.trainEnd){e.next=5;break}return e.next=3,Io(t);case 3:return e.next=5,this.trainEnd(t);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(jo);function Ao(e,t){return null==e&&(e={}),e instanceof jo?[e]:Array.isArray(e)&&e[0]instanceof jo?e:ma(e).map((function(e){return new _o(e,t)}))}var Ro=function(){function e(){Object($r.a)(this,e)}return Object(ea.a)(e,null,[{key:"registerCallbackConstructor",value:function(t,n){a.Df.assert(t>=0&&Number.isInteger(t),(function(){return"Verbosity level is expected to be an integer >= 0, "+"but got ".concat(t)})),e.checkForDuplicate(n),null==e.constructors[t]&&(e.constructors[t]=[]),e.constructors[t].push(n)}},{key:"checkForDuplicate",value:function(t){for(var n in e.constructors){e.constructors[+n].forEach((function(e){if(e===t)throw new sa("Duplicate callback constructor.")}))}}},{key:"clear",value:function(){e.constructors={}}},{key:"createCallbacks",value:function(t){var n=[];for(var r in e.constructors){var a=+r;t>=a&&n.push.apply(n,Object(qn.a)(e.constructors[a]))}return n.map((function(e){return new e}))}}]),e}();function Do(e,t,n,r,a,i,o,s,u){var c=new Eo,l=[new Co].concat(Object(qn.a)(Ro.createCallbacks(t)));null!=e&&l.push.apply(l,Object(qn.a)(e)),l.push(c);var d=new To(l);return d.setParams({epochs:n,initialEpoch:r,samples:a,steps:i,batchSize:o,verbose:t,doValidation:s,metrics:u}),{callbackList:d,history:c}}Ro.constructors={};var Fo=n(20),Mo=n(19);function zo(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return ka(e,a.Ze.SerializationMap.getMap().classNameMap,t,"layer",n)}function Lo(e,t){return Object(a.wf)((function(){"float32"!==e.dtype&&(e=a.Hd(e,"float32"));var n=a.pf(pi(e),t,!0),r=a.ge(n.shape,$a()),i=a.lf(a.Ae(n,r));return a.Xd(e,i)}))}function Po(e,t){return Object(a.wf)((function(){return a.Be(pi(a.of(t,e)),-1)}))}function Bo(e,t){return Object(a.wf)((function(){return a.Be(a.rd(a.of(t,e)),-1)}))}function Wo(e,t){return Object(a.wf)((function(){var n=a.of(e,t),r=a.Id(a.rd(e),$a(),Number.MAX_VALUE),i=a.rd(a.Xd(n,r));return a.Fe(100,a.Be(i,-1))}))}function Uo(e,t){return Object(a.wf)((function(){var n=a.Id(t,$a(),Number.MAX_VALUE),r=a.se(a.sd(1,n)),i=a.Id(e,$a(),Number.MAX_VALUE),o=a.se(a.sd(1,i));return a.Be(pi(a.of(r,o)),-1)}))}function Vo(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Object(a.wf)((function(){if(n)t=a.if(t);else{var r=a.pf(t,t.shape.length-1,!0);t=a.Xd(t,r)}return t=a.Id(t,$a(),1-$a()),a.Ge(a.pf(a.Fe(a.Hd(e,"float32"),a.se(t)),t.shape.length-1))}))}function Go(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Object(a.wf)((function(){var r=a.Hd(a.he(ni(e)),"int32"),i=(t=a.Id(t,$a(),1-$a())).shape;return Vo(a.Ue(a.Je(r,i[i.length-1]),i),t,n)}))}function Ho(e,t){return Object(a.wf)((function(){var n;return n=a.Id(t,$a(),1-$a()),n=a.se(a.Xd(n,a.of(1,n))),a.Be(function(e,t){if(!a.Df.arraysEqual(e.shape,t.shape))throw new sa("logits and labels must have the same shape, but got shapes "+"".concat(JSON.stringify(e.shape)," and ").concat(JSON.stringify(t.shape)));return Object(a.wf)((function(){var n=a.Te(t),r=a.Ge(a.rd(t));return a.sd(a.of(n,a.Fe(t,e)),a.te(a.de(r)))}))}(e,n),-1)}))}function qo(e,t){return Object(a.wf)((function(){var n=a.Id(e,$a(),1),r=a.Id(t,$a(),1);return a.pf(a.Fe(e,a.se(a.Xd(n,r))),-1)}))}function Ko(e,t){return Object(a.wf)((function(){var n=Lo(e,-1),r=Lo(t,-1),i=a.Fe(n,r);return a.Ge(a.pf(i,-1))}))}var Xo={meanSquaredError:Po,meanAbsoluteError:Bo,meanAbsolutePercentageError:Wo,meanSquaredLogarithmicError:Uo,squaredHinge:function(e,t){return Object(a.wf)((function(){var n=a.Ae(0,a.of(1,a.Fe(e,t)));return a.Be(pi(n),-1)}))},hinge:function(e,t){return Object(a.wf)((function(){var n=a.Ae(0,a.of(1,a.Fe(e,t)));return a.Be(n,-1)}))},categoricalHinge:function(e,t){return Object(a.wf)((function(){var n=a.pf(a.Fe(e,t),-1),r=a.xe(a.Fe(a.of(1,e),t),-1);return a.Ae(0,a.sd(1,a.of(r,n)))}))},logcosh:function(e,t){return Object(a.wf)((function(){var n=Math.log(2),r=a.of(t,e),i=a.of(a.sd(r,a.jf(a.Fe(-2,r))),n);return a.Be(i,-1)}))},categoricalCrossentropy:Vo,sparseCategoricalCrossentropy:Go,binaryCrossentropy:Ho,kullbackLeiblerDivergence:qo,poisson:function(e,t){return Object(a.wf)((function(){var n=a.se(a.sd($a(),t));return a.Be(a.of(t,a.Fe(e,n)),-1)}))},cosineProximity:Ko};function Yo(e){if("string"===typeof e){if(e in Xo)return Xo[e];var t="Unknown loss ".concat(e);throw e.toLowerCase().includes("softmaxcrossentropy")&&(t="Unknown loss ".concat(e,". ")+'Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy'),new sa(t)}return e}function Zo(e,t){return Object(a.wf)((function(){var n=a.Fe(.5,a.Le(t)),r=ei(a.ke(t,n),e.dtype);return a.Be(a.ce(e,r),-1)}))}function Jo(e,t){return Object(a.wf)((function(){return ei(a.ce(a.vd(e,-1),a.vd(t,-1)),"float32")}))}function Qo(e,t){return Object(a.wf)((function(){return a.Hd(a.pf(a.ve(a.ce(e,1),a.ce(t,1))),"float32")}))}function $o(e,t){return Object(a.wf)((function(){var n=Qo(e,t),r=function(e,t){return Object(a.wf)((function(){return a.Hd(a.pf(a.ve(a.ce(e,0),a.ce(t,1))),"float32")}))}(e,t),i=a.sd(n,r);return a.Hd(a.Hf(a.ke(i,0),a.Xd(n,i),0),"float32")}))}function es(e,t){return Ho(e,t)}function ts(e,t){return e.rank===t.rank&&(e=a.mf(e,[e.rank-1])),(t=a.vd(t,-1)).dtype!==e.dtype&&(t=a.Hd(t,e.dtype)),a.Hd(a.ce(e,t),"float32")}var ns=Vo,rs=Go,as={binaryAccuracy:Zo,categoricalAccuracy:Jo,precision:$o,categoricalCrossentropy:ns,sparseCategoricalCrossentropy:rs,mse:Po,MSE:Po,mae:Bo,MAE:Bo,mape:Wo,MAPE:Wo,cosine:Ko};function is(e){if("string"===typeof e&&e in as)return as[e];if("string"!==typeof e&&null!=e)return e;throw new sa("Unknown metric ".concat(e))}function os(e){if(pa(null!==e,"Unknown LossOrMetricFn ".concat(e)),"string"===typeof e)return e;for(var t,n=0,r=Object.keys(Xo);n<r.length;n++){var a=r[n];if(Xo[a]===e){t=a;break}}if(void 0!==t)return t;for(var i=0,o=Object.keys(as);i<o.length;i++){var s=o[i];if(as[s]===e){t=s;break}}return void 0!==t?t:e.name}function ss(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==e||"object"!==typeof e||Object.getPrototypeOf(e)!==Object.prototype||!us(e))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){var r=JSON.stringify(e);r.length>1048576&&console.warn('User-defined metadata of model "'.concat(t,'" is too large in ')+"size (length=".concat(r.length," when serialized). It is not ")+"recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= "+"".concat(1048576,"."))}}function us(e){if(null===e)return!0;if("object"===typeof e){if(Object.getPrototypeOf(e)===Object.prototype){for(var t=0,n=Object.keys(e);t<n.length;t++){var r=n[t];if("string"!==typeof r)return!1;if(!us(e[r]))return!1}return!0}if(Array.isArray(e)){var a,i=Object(Qr.a)(e);try{for(i.s();!(a=i.n()).done;){if(!us(a.value))return!1}}catch(s){i.e(s)}finally{i.f()}return!0}return!1}var o=typeof e;return"string"===o||"number"===o||"boolean"===o}function cs(e,t,n){var r,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:console.log,i=ds(e),o=["Layer (type)","Input Shape","Output shape","Param #"];if(i?(t=t||90,n=n||[.32,.61,.89,1]):(t=t||115,n=n||[.24,.48,.7,.8,1]),n[n.length-1]<=1&&(n=n.map((function(e){return Math.floor(t*e)}))),!i)for(var s in o.push("Receives inputs"),r=[],e.nodesByDepth){var u;(u=r).push.apply(u,Object(qn.a)(e.nodesByDepth[s]))}a("_".repeat(t)),ps(o,n,a),a("=".repeat(t));for(var c=e.layers,l=0;l<c.length;++l)i?fs(c[l],n,a):hs(c[l],n,r,a),a((l===c.length-1?"=":"_").repeat(t));e.checkTrainableWeightsConsistency();var d=ls(e),p=Gi(e.nonTrainableWeights);a("Total params: ".concat(d+p)),a("Trainable params: ".concat(d)),a("Non-trainable params: ".concat(p)),a("_".repeat(t))}function ls(e){return null!=e.collectedTrainableWeights?Gi(e.collectedTrainableWeights):Gi(e.trainableWeights)}function ds(e){var t=!0,n=[],r=[];for(var a in e.nodesByDepth)n.push(e.nodesByDepth[a]);for(var i=0,o=n;i<o.length;i++){var s=o[i];if(s.length>1||1===s.length&&s[0].inboundLayers.length>1){t=!1;break}r.push.apply(r,Object(qn.a)(s))}if(t){var u,c=Object(Qr.a)(e.layers);try{for(c.s();!(u=c.n()).done;){var l,d=u.value,p=!1,f=Object(Qr.a)(d.inboundNodes);try{for(f.s();!(l=f.n()).done;){var h=l.value;if(-1!==r.indexOf(h)){if(p){t=!1;break}p=!0}}}catch(m){f.e(m)}finally{f.f()}if(!t)break}}catch(m){c.e(m)}finally{c.f()}}return t}function ps(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log,r="",a=0;a<e.length;++a)a>0&&(r=r.slice(0,r.length-1)+" "),r=(r+=e[a]).slice(0,t[a]),r+=" ".repeat(t[a]-r.length);n(r)}function fs(e,t,n){var r,a;try{a=e.inboundNodes.map((function(e){return JSON.stringify(e.inputShapes)})).join(",")}catch(s){a="multiple"}try{r=JSON.stringify(e.outputShape)}catch(s){r="multiple"}var i=e.name,o=e.getClassName();ps(["".concat(i," (").concat(o,")"),a,r,e.countParams().toString()],t,n)}function hs(e,t,n,r){var a,i;try{i=e.inboundNodes.map((function(e){return JSON.stringify(e.inputShapes)})).join(",")}catch(g){i="multiple"}try{a=JSON.stringify(e.outputShape)}catch(g){a="multiple"}var o,s=[],u=Object(Qr.a)(e.inboundNodes);try{for(u.s();!(o=u.n()).done;){var c=o.value;if(!(null!=n&&n.length>0&&-1===n.indexOf(c)))for(var l=0;l<c.inboundLayers.length;++l){var d=c.inboundLayers[l].name,p=c.nodeIndices[l],f=c.tensorIndices[l];s.push("".concat(d,"[").concat(p,"][").concat(f,"]"))}}}catch(g){u.e(g)}finally{u.f()}var h=e.name,m=e.getClassName(),v=0===s.length?"":s[0];ps(["".concat(h," (").concat(m,")"),i,a,e.countParams().toString(),v],t,r);for(var b=1;b<s.length;++b)ps(["","","","",s[b]],t,r)}function ms(e,t,n){return("inboundNodes"===e||"outputLayers"===e||"inputLayers"===e)&&0===t&&"string"===typeof n}function vs(e,t){if(null===e)return null;if("string"===typeof e)return ba(e);if("number"===typeof e||"boolean"===typeof e)return e;if(e instanceof Array){for(var n=[],r=e.length,a=0;a<r;++a){var i=e[a];ms(t,a,i)?n.push(i):n.push(vs(i,t))}return n}for(var o={},s=0,u=Object.keys(e);s<u.length;s++){var c=u[s],l=e[c];if("name"===c&&"string"===typeof l)o[c]=l;else{var d=ba(c);o[d]=vs(l,d)}}return o}function bs(e,t){if(null===e||void 0===e)return null;if("string"===typeof e)return va(e);if("number"===typeof e||"boolean"===typeof e)return e;if(e instanceof Array){for(var n=[],r=e.length,a=0;a<r;++a){var i=e[a];ms(t,a,i)?n.push(i):n.push(bs(i,t))}return n}for(var o={},s=0,u=Object.keys(e);s<u.length;s++){var c=u[s],l=e[c],d=va(c);o[d]="name"!==c&&"className"!==c||"string"!==typeof l?bs(l,c):l}return o}function gs(e,t,n){var r=t.length;if(null==e||Array.isArray(e)&&0===e.length)return t.map((function(e){return null}));if(1===r)return Array.isArray(e)&&1===e.length?e:"object"===typeof e&&t[0]in e?[e[t[0]]]:[e];if(Array.isArray(e)){if(e.length!==r)throw new Error("Provided ".concat(n," is an array of ").concat(e.length," ")+"element(s), but the model has ".concat(r," outputs. ")+"Make sure a set of weights is provided for each model output.");return e}if("object"===typeof e&&Object.keys(e).length>0&&"object"===typeof e[Object.keys(e)[0]]){var a=[];return t.forEach((function(t){t in e?a.push(e[t]):a.push(null)})),a}throw new Error("The model has multiple (".concat(r,") outputs, ")+"so ".concat(n," must be either an array with ")+"".concat(r," elements or an object with ").concat(t," keys. ")+"Provided ".concat(n," not understood: ").concat(JSON.stringify(e)))}function ys(e,t){return gs(e,t,"classWeight")}function xs(e,t,n,r){return ks.apply(this,arguments)}function ks(){return(ks=Object(Oo.a)(wo.a.mark((function e(t,n,r,i){var o,s,u;return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n&&null==i){e.next=2;break}throw new Error("Support sampleWeight is not implemented yet");case 2:if(null==r){e.next=15;break}return o=Object(a.wf)((function(){if(1===t.shape.length)return Object(a.Jd)(t);if(2===t.shape.length){if(t.shape[1]>1){return Object(a.vd)(t,1)}if(1===t.shape[1])return Object(a.Ue)(t,[t.shape[0]]);throw new Error("Encountered unexpected last-dimension size (".concat(t.shape[1],") ")+"during handling of class weights. The size is expected to be >= 1.")}throw new Error("Unexpected rank of target (y) tensor (".concat(t.rank,") during ")+"handling of class weights. The rank is expected to be 1 or 2.")})),e.t0=Array,e.next=7,o.data();case 7:return e.t1=e.sent,s=e.t0.from.call(e.t0,e.t1),Object(a.Wd)(o),u=[],s.forEach((function(e){if(null==r[e])throw new Error("classWeight must contain all classes in the training data. "+"The class ".concat(e," exists in the data but not in ")+"classWeight");u.push(r[e])})),e.abrupt("return",Object(a.tf)(u,"float32"));case 15:return e.abrupt("return",null);case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ws(e,t){return Object(a.Fe)(e,t)}function Os(e,t){var n,r,i=t;n=i.xs,r=i.ys,a.Df.assert(null!=n&&null!=r,(function(){return"A Dataset iterator for fitDataset() is expected to generate objects of the form `{xs: xVal, ys: yVal}`, where the two values may be `tf.Tensor`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates "+"".concat(t)}));var o=Is("input",e.inputNames,n),s=Is("output",e.outputNames,r),u=o[0].shape[0];a.Df.assert(o.length===e.inputs.length,(function(){return"LayersModel has ".concat(e.inputs.length," inputs, but the dataset ")+"provides ".concat(o.length," inputs.  (Expected input keys: ")+"".concat(JSON.stringify(e.inputNames),")")})),a.Df.assert(s.length===e.outputs.length,(function(){return"LayersModel has ".concat(e.outputs.length," outputs, but the dataset ")+"provides ".concat(s.length," outputs.  (Expected output keys: ")+"".concat(JSON.stringify(e.outputNames),")")}));for(var c=function(t){a.Df.assert(o[t].shape[0]===u,(function(){return"Batch size mismatch: input "+"".concat(e.inputNames[t]," has ").concat(o[t].shape[0],"; ")+"expected  ".concat(u," based on input ").concat(e.inputNames[0],".")}))},l=0;l<o.length;l++)c(l);for(var d=function(t){a.Df.assert(s[t].shape[0]===u,(function(){return"Batch size mismatch: output "+"".concat(e.outputNames[t]," has ").concat(s[t].shape[0],"; ")+"expected  ".concat(u," based on input ").concat(e.inputNames[0],".")}))},p=0;p<s.length;p++)d(p);return{xs:o,ys:s}}function Is(e,t,n){if(n instanceof a.gd)return[n];if(Array.isArray(n))return a.Df.assert(n.length===t.length,(function(){return"Received an array of ".concat(n.length," Tensors, but expected ").concat(t.length," to match the ").concat(e," keys ").concat(t,".")})),n;var r,i=[],o=Object(Qr.a)(t);try{for(o.s();!(r=o.n()).done;){var s=r.value;if(null==n[s])throw new sa("The feature data generated by the dataset lacks the required "+"".concat(e," key '").concat(s,"'."));i.push(n[s])}}catch(u){o.e(u)}finally{o.f()}return i}function Ss(e){if(3===e.length)throw new ua("Validation with sample weights is not implemented yet.");return{xs:e[0],ys:e[1]}}function Ns(e,t,n){return js.apply(this,arguments)}function js(){return(js=Object(Oo.a)(wo.a.mark((function e(t,n,r){var i,o,s,u,c,l,d,p,f,h,m,v,b,g,y,x,k,w,O,I,S,N,j,T,C,E,_,A,R,D,F,M,z;return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=null!=r.batchesPerEpoch,a.Df.assert(null!=t.optimizer,(function(){return"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."})),a.Df.assert(null!=r,(function(){return"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."})),a.Df.assert(null!=r.epochs&&r.epochs>0&&Number.isInteger(r.epochs),(function(){return"For fitDataset(), config.epochs is expected to be a positive "+"integer, but got ".concat(r.epochs)})),a.Df.assert(!i||r.batchesPerEpoch>0&&Number.isInteger(r.batchesPerEpoch),(function(){return"For fitDataset(), config.batchesPerEpoch is expected to be a "+"positive integer if specified, but got ".concat(r.batchesPerEpoch)})),a.Df.assert(null==r.validationSplit,(function(){return"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."})),!t.isTraining){e.next=8;break}throw new Error("Cannot start training because another fit() call is ongoing.");case 8:return t.isTraining=!0,e.prev=9,(o=null!=r.validationData)&&(Cs(r.validationData)?a.Df.assert(null==r.validationBatches||r.validationBatches>0&&Number.isInteger(r.validationBatches),(function(){return"For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, "+"but got ".concat(r.validationBatches)})):(c=Ss(r.validationData),s=c.xs,u=c.ys)),l=t.makeTrainFunction(),d=t.getDedupedMetricsNames(),p=o?d.slice().concat(d.map((function(e){return"val_"+e}))):d.slice(),f=Ao(r.callbacks,r.yieldEvery),h=null==r.verbose?1:r.verbose,m=Do(f,h,r.epochs,null,null,Ts(n,r),null,o,p),v=m.callbackList,b=m.history,v.setModel(t),t.history=b,e.next=22,v.onTrainBegin();case 22:return t.stopTraining_=!1,g=null==r.initialEpoch?0:r.initialEpoch,e.next=26,n.iterator();case 26:y=e.sent;case 27:if(!(g<r.epochs)){e.next=98;break}return x={},e.next=31,v.onEpochBegin(g);case 31:if(k=0,w=0,i){e.next=37;break}return e.next=36,n.iterator();case 36:y=e.sent;case 37:if(i&&!(k<r.batchesPerEpoch)){e.next=91;break}return e.next=40,y.next();case 40:if(O=e.sent,!i||!O.done){e.next=44;break}return console.warn("You provided `batchesPerEpoch` as "+"".concat(r.batchesPerEpoch,", ")+"but your dataset iterator ran out of data after "+"".concat(k," batches; ")+"interrupting training. Make sure that your dataset can generate at least `batchesPerEpoch * epochs` batches (in this case, "+"".concat(r.batchesPerEpoch*r.epochs," batches). ")+"You may need to use the repeat() function when building your dataset."),e.abrupt("break",91);case 44:if(null==O.value){e.next=73;break}return I=Os(t,O.value),S=I.xs,N=I.ys,(j={}).batch=w,j.size=S[0].shape[0],e.next=51,v.onBatchBegin(w,j);case 51:if(T=[],null==r.classWeight){e.next=64;break}C=ys(r.classWeight,t.outputNames),E=0;case 55:if(!(E<C.length)){e.next=64;break}return e.t0=T,e.next=59,xs(N[E],null,C[E]);case 59:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 61:++E,e.next=55;break;case 64:for(_=S.concat(N).concat(T),A=l(_),a.Wd(_),R=0;R<d.length;++R)D=d[R],F=A[R],j[D]=F,a.oe(F);return e.next=70,v.onBatchEnd(w,j);case 70:No(j),w++,k++;case 73:if(!(i?k>=r.batchesPerEpoch:O.done)){e.next=87;break}if(!o){e.next=86;break}if(M=void 0,!Cs(r.validationData)){e.next=84;break}return e.t2=ma,e.next=80,t.evaluateDataset(r.validationData,{batches:r.validationBatches});case 80:e.t3=e.sent,M=(0,e.t2)(e.t3),e.next=85;break;case 84:M=ma(t.evaluate(s,u,{batchSize:null==r.validationBatchSize?32:r.validationBatchSize,verbose:0}));case 85:for(z=0;z<t.metricsNames.length;++z)x["val_".concat(t.metricsNames[z])]=M[z];case 86:return e.abrupt("break",91);case 87:if(!t.stopTraining_){e.next=89;break}return e.abrupt("break",91);case 89:e.next=37;break;case 91:return e.next=93,v.onEpochEnd(g,x);case 93:if(g++,!t.stopTraining_){e.next=96;break}return e.abrupt("break",98);case 96:e.next=27;break;case 98:return e.next=100,v.onTrainEnd();case 100:return e.next=102,t.history.syncData();case 102:return e.abrupt("return",t.history);case 103:return e.prev=103,t.isTraining=!1,e.finish(103);case 106:case"end":return e.stop()}}),e,null,[[9,,103,106]])})))).apply(this,arguments)}function Ts(e,t){var n=null;return null!=t.batchesPerEpoch?n=t.batchesPerEpoch:Number.isFinite(e.size)&&(n=e.size),n}function Cs(e){return"function"===typeof e.iterator}function Es(e){return"function"===typeof e.next}function _s(e,t,n){return As.apply(this,arguments)}function As(){return(As=Object(Oo.a)(wo.a.mark((function e(t,n,r){var i,o,s,u,c,l,d,p,f;return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=null!=(r=r||{}).batches,o=t.testFunction,s=[],!(r.verbose>0)){e.next=6;break}throw new ua("Verbose mode is not implemented yet.");case 6:if(a.Df.assert(!i||r.batches>0&&Number.isInteger(r.batches),(function(){return"Test loop expects `batches` to be a positive integer, but "+"received ".concat(JSON.stringify(r.batches))})),!Es(n)){e.next=11;break}e.t0=n,e.next=14;break;case 11:return e.next=13,n.iterator();case 13:e.t0=e.sent;case 14:u=e.t0,c=0,l=0,d=wo.a.mark((function e(){var n;return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.next();case 2:if(n=e.sent,s=a.wf((function(){return n.value&&function(){var e=Os(t,n.value),r=e.xs,i=e.ys,u=r.concat(i),d=a.wf((function(){return o(u)}));if(a.Wd(u),0===l)for(var p=0;p<d.length;++p)s.push(Object(a.We)(0));for(var f=u[0].shape[0],h=function(e){var t=d[e],n=s[e];s[e]=a.wf((function(){return a.sd(s[e],a.Fe(f,t))})),l>0&&a.Wd(n)},m=0;m<d.length;++m)h(m);a.Wd(d),c+=f,++l}(),s})),!n.done){e.next=7;break}return i&&console.warn("Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least `batches` "+"batches (in this case, ".concat(r.batches," batches). ")+"You may need to use the repeat() function when building your dataset."),e.abrupt("return","break");case 7:case"end":return e.stop()}}),e)}));case 18:if(i&&!(l<r.batches)){e.next=25;break}return e.delegateYield(d(),"t1",20);case 20:if("break"!==e.t1){e.next=23;break}return e.abrupt("break",25);case 23:e.next=18;break;case 25:for(p=0;p<s.length;++p)f=s[p],s[p]=a.Xd(s[p],c),a.Wd(f);return e.abrupt("return",ha(s));case 27:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Rs(e){a.Df.assert(e>0&&Number.isInteger(e),(function(){return"batchSize is required to be a positive integer, but got ".concat(e)}))}function Ds(e,t,n){return null==e?[null]:Array.isArray(e)?e.map((function(e){return ri(e,t,n-t)})):ri(e,t,n-t)}function Fs(e,t){return a.wf((function(){return null==e?null:Array.isArray(e)?e.map((function(e){return Fs(e,t)})):di(e,"int32"===t.dtype?t:a.Hd(t,"int32"))}))}function Ms(e,t){for(var n=[],r=0,a=null;r<e;)(a=r+t)>=e&&(a=e),n.push([r,a]),r=a;return n}function zs(e,t,n,r,a,i,o,s,u,c,l,d,p,f,h){return Ls.apply(this,arguments)}function Ls(){return(Ls=Object(Oo.a)(wo.a.mark((function e(t,n,r,i,o,s,u,c,l,d,p,f,h,m,v){var b,g,y,x,k,w,O,I;return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==o&&(o=32),null==s&&(s=1),null==p&&(p=!0),null==h&&(h=0),b=!1,null!=l&&null!=d&&(b=!0),null==v){e.next=10;break}if(b=!0,null!=m){e.next=10;break}throw new sa("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");case 10:return null!=(g=t.checkNumSamples(r,o,m,"steps_per_epoch"))&&(y=Qa(0,g)),null==u&&(u=1),x=Do(c,u,s,h,g,m,o,b,f),k=x.callbackList,w=x.history,k.setModel(t),t.history=w,e.next=18,k.onTrainBegin();case 18:t.stopTraining_=!1,O=wo.a.mark((function e(s){var u;return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k.onEpochBegin(s);case 2:if(u={},null==m){e.next=7;break}throw new ua("stepsPerEpoch mode is not implemented yet.");case 7:return e.delegateYield(wo.a.mark((function e(){var s,c,f,h;return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("batch"!==p){e.next=4;break}throw new ua("batch shuffling is not implemneted yet");case 4:p&&a.Df.shuffle(y);case 5:s=Object(a.tf)(y),c=Ms(g,o),f=wo.a.mark((function e(p){var f;return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f={},e.next=3,k.onBatchBegin(p,f);case 3:return a.wf((function(){var e=c[p][0],h=c[p][1],m=ri(s,e,h-e);f.batch=p,f.size=h-e;for(var v=Fs(r,m),g=n(v),y=0;y<i.length;++y){var x=i[y],k=g[y];f[x]=k,a.oe(k)}if(p===c.length-1&&b)for(var w=t.testLoop(l,d,o),O=0;O<i.length;++O){var I=i[O],S=w[O];a.oe(S),u["val_"+I]=S}})),e.next=6,k.onBatchEnd(p,f);case 6:if(No(f),!t.stopTraining_){e.next=9;break}return e.abrupt("return","break");case 9:case"end":return e.stop()}}),e)})),h=0;case 9:if(!(h<c.length)){e.next=17;break}return e.delegateYield(f(h),"t0",11);case 11:if("break"!==e.t0){e.next=14;break}return e.abrupt("break",17);case 14:++h,e.next=9;break;case 17:s.dispose();case 18:case"end":return e.stop()}}),e)}))(),"t0",8);case 8:return e.next=10,k.onEpochEnd(s,u);case 10:if(!t.stopTraining_){e.next=12;break}return e.abrupt("return","break");case 12:case"end":return e.stop()}}),e)})),I=h;case 21:if(!(I<s)){e.next=29;break}return e.delegateYield(O(I),"t0",23);case 23:if("break"!==e.t0){e.next=26;break}return e.abrupt("break",29);case 26:++I,e.next=21;break;case 29:return e.next=31,k.onTrainEnd();case 31:return e.next=33,t.history.syncData();case 33:return e.abrupt("return",t.history);case 34:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ps(e,t,n){return Bs.apply(this,arguments)}function Bs(){return(Bs=Object(Oo.a)(wo.a.mark((function e(t,n,r){var i,o,s,u,c,l,d,p,f,h,m,v,b,g,y,x,k,w,O,I,S,N,j,T,C,E,_=arguments;return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=_.length>3&&void 0!==_[3]?_[3]:{},!t.isTraining){e.next=3;break}throw new Error("Cannot start training because another fit() call is ongoing.");case 3:return t.isTraining=!0,e.prev=4,Rs(m=null==i.batchSize?32:i.batchSize),v=!1,e.next=10,t.standardizeUserData(n,r,i.sampleWeight,i.classWeight,v,m);case 10:if(b=e.sent,o=b[0],s=b[1],h=b[2],g=!1,!(null!=i.validationData&&i.validationData.length>0)){e.next=36;break}if(g=!0,2!==i.validationData.length){e.next=22;break}l=i.validationData[0],d=i.validationData[1],e.next=27;break;case 22:if(3!==i.validationData.length){e.next=26;break}throw new ua("validationData including sample weights is not supported yet.");case 26:throw new sa("When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; "+"".concat(i.validationData," is invalid."));case 27:return x=!0,e.next=30,t.standardizeUserData(l,d,null,null,x,m);case 30:k=e.sent,p=k[0],f=k[1],y=p.concat(f),e.next=37;break;case 36:null!=i.validationSplit&&i.validationSplit>0&&i.validationSplit<1?(g=!0,w=Math.floor(o[0].shape[0]*(1-i.validationSplit)),O=o[0].shape[0],p=Ds(o,w,O),u=o,o=Ds(o,0,w),f=Ds(s,w,O),c=s,s=Ds(s,0,w),y=p.concat(f)):null!=i.validationSteps&&(g=!0);case 37:return I=o.concat(s).concat(h),t.checkTrainableWeightsConsistency(),S=t.makeTrainFunction(),N=t.getDedupedMetricsNames(),g?(t.makeTestFunction(),j=t.testFunction,T=N.slice().concat(N.map((function(e){return"val_"+e})))):(j=null,y=[],T=N.slice()),C=Ao(i.callbacks,i.yieldEvery),e.next=45,zs(t,S,I,N,m,i.epochs,i.verbose,C,j,y,i.shuffle,T,i.initialEpoch,null,null);case 45:return E=e.sent,e.abrupt("return",E);case 47:return e.prev=47,t.isTraining=!1,Us(o,n),Us(s,r),Us(u,n),Us(c,r),Us(p,l),Us(f,d),null!=h&&a.Wd(h),e.finish(47);case 57:case"end":return e.stop()}}),e,null,[[4,,47,57]])})))).apply(this,arguments)}function Ws(e){var t=[];e instanceof a.gd&&(e=[e]);for(var n=0;n<e.length;++n){var r=e[n];if(1===r.rank)t.push(ti(r,1));else{if(0===r.rank)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");t.push(r)}}return t}function Us(e,t){if(null!=e){var n=[];if(t instanceof a.gd)n.push(t.id);else if(Array.isArray(t))t.forEach((function(e){return n.push(e.id)}));else if(null!=t)for(var r in t){var i=t[r];n.push(i.id)}var o=[];if(e instanceof a.gd)-1===n.indexOf(e.id)&&o.push(e);else if(Array.isArray(e))e.forEach((function(e){-1===n.indexOf(e.id)&&o.push(e)}));else if(null!=e)for(var s in e){var u=e[s];-1===n.indexOf(u.id)&&o.push(u)}o.forEach((function(e){e.isDisposed||e.dispose()}))}}function Vs(e){return Array.isArray(e)}function Gs(e){return!function(e){return e instanceof a.gd}(e)&&!Vs(e)}function Hs(e,t,n){var r,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";if(null==t||0===t.length){if(null!=e){var o=!1;if(Vs(e)&&e.length>0)o=!0;else if(Gs(e)){for(var s in e)if(e.hasOwnProperty(s)){o=!0;break}}else o=!0;if(o)throw new sa("Error when checking model ".concat(i," expected no data, ")+"but got ".concat(e))}return[]}if(null==e)return t.map((function(e){return null}));if(Gs(e)){e=e,r=[];var u,c=Object(Qr.a)(t);try{for(c.s();!(u=c.n()).done;){var l=u.value;if(null==e[l])throw new sa('No data provided for "'.concat(l,'". Need data for each key in: ')+"".concat(t));r.push(e[l])}}catch(v){c.e(v)}finally{c.f()}}else if(Vs(e)){if((e=e).length!==t.length)throw new sa("Error when checking model ".concat(i,": the Array of ")+"Tensors that you are passing to your model is not the size the "+"model expected. Expected to see ".concat(t.length," Tensor(s), but ")+"instead got the following list of Tensor(s): ".concat(e));r=e}else{if(e=e,t.length>1)throw new sa("The model ".concat(i," expects ").concat(t.length," Tensor(s), ")+"but only received one Tensor. Found: Tensor with shape ".concat(e.shape));r=[e]}if(r=Ws(r),null!=n)for(var d=0;d<t.length;++d)if(null!=n[d]){var p=r[d];if(p.shape.length!==n[d].length)throw new sa("Error when checking ".concat(i,": expected ").concat(t[d]," ")+"to have ".concat(n[d].length," dimension(s). but got array with ")+"shape ".concat(p.shape));for(var f=0;f<n[d].length;++f)if(0!==f||a){var h=p.shape[f],m=n[d][f];if(null!=m&&m>=0&&h!==m)throw new sa("".concat(i," expected a batch of elements where each ")+"example has shape [".concat(n[d].slice(1,n[d].length),"] ")+"(i.e.,tensor shape [*,".concat(n[d].slice(1,n[d].length),"])")+" but the ".concat(i," received an input with ").concat(p.shape[0])+" examples, each with shape [".concat(p.shape.slice(1,p.shape.length),"]")+" (tensor shape [".concat(p.shape,"])"))}}return r}function qs(e,t,n){var r=Oa(e.map((function(e){return e.shape[0]})));r.sort();var i=Oa(t.map((function(e){return e.shape[0]})));if(i.sort(),r.length>1)throw new sa("All input Tensors (x) should have the same number of samples. Got array shapes: "+"".concat(JSON.stringify(e.map((function(e){return e.shape})))));if(i.length>1)throw new sa("All target Tensors (y) should have the same number of samples. Got array shapes: "+"".concat(JSON.stringify(t.map((function(e){return e.shape})))));if(r.length>0&&i.length>0&&!a.Df.arraysEqual(r,i))throw new sa("Input Tensors should have the same number of samples as target "+"Tensors. Found ".concat(r[0]," input sample(s) and ").concat(i[0]," target ")+"sample(s).")}function Ks(e,t,n){for(var r=[Po,Ho,Vo],a=0;a<e.length;++a){var i=e[a],o=t[a],s=n[a];if(null!=o){if(o===Vo&&1===i.shape[i.shape.length-1])throw new sa("You are passing a target array of shape ".concat(i.shape," while using ")+"a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].");if(-1!==r.indexOf(o))for(var u=i.shape.slice(1),c=s.slice(1),l=0;l<u.length;++l){var d=u[l],p=c[l];if(null!=p&&d!==p)throw new sa("A target Tensor with shape ".concat(i.shape," was passed for an ")+"output of shape ".concat(s,", while using a loss function that ")+"expects targets to have the same shape as the output.")}}}}function Xs(e,t,n){var r,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";if(Array.isArray(e)){if(e.length!==t.length)throw new sa("Error when checking model ".concat(i,": the Array of ")+"Tensors that you are passing to your model is not the size the "+"the model expected. Expected to see ".concat(t.length," Tensor(s),")+" but instead got ".concat(e.length," Tensors(s)."));r=e}else{if(t.length>1)throw new sa("The model expects ".concat(t.length," ").concat(i," Tensors, ")+"but only received one Tensor. Found: array with shape "+"".concat(JSON.stringify(e.shape),"."));r=[e]}if(null!=n)for(var o=0;o<t.length;++o)if(null!=n[o]){var s=r[o];if(s.shape.length!==n[o].length)throw new sa("Error when checking ".concat(i,": expected ").concat(t[o]," ")+"to have ".concat(n[o].length," dimension(s), but got array with ")+"shape ".concat(JSON.stringify(s.shape)));for(var u=0;u<n[o].length;++u)if(0!==u||a){var c=s.shape[u],l=n[o][u];if(null!=l&&l!==c)throw new sa("Error when checking ".concat(i,": expected ")+"".concat(t[o]," to have shape ").concat(JSON.stringify(n[o])," but ")+"got array with shape ".concat(JSON.stringify(s.shape),"."))}}}var Ys=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;return Object($r.a)(this,n),(r=t.call(this,e)).isTraining=!1,r}return Object(ea.a)(n,[{key:"summary",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log;if(!this.built)throw new sa("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");cs(this,e,t,n)}},{key:"compile",value:function(e){var t=this;if(null==e.loss&&(e.loss=[]),this.loss=e.loss,"string"===typeof e.optimizer)this.optimizer_=function(e){var t={Adagrad:function(){return a.yf.adagrad(.01)},Adadelta:function(){return a.yf.adadelta(1,.95,$a())},Adam:function(){return a.yf.adam(.001,.9,.999,$a())},Adamax:function(){return a.yf.adamax(.002,.9,.999,$a(),0)},RMSProp:function(){return a.yf.rmsprop(.001,.9,0,$a())},SGD:function(){return a.yf.sgd(.01)}};if(t.adagrad=t.Adagrad,t.adadelta=t.Adadelta,t.adam=t.Adam,t.adamax=t.Adamax,t.rmsprop=t.RMSProp,t.sgd=t.SGD,e in t)return t[e]();throw new sa("Unknown Optimizer ".concat(e))}(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof a.fc))throw new sa("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}var n=[];if(Array.isArray(e.loss)||"string"===typeof e.loss||"function"===typeof e.loss)if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new sa("When passing an Array as loss, it should have one entry per "+"model output. The model has ".concat(this.outputs.length," output(s), ")+"but you passed loss=".concat(e.loss,"."));var r=e.loss;n=r.map((function(e){return Yo(e)}))}else{var i=Yo(e.loss);this.outputs.forEach((function(e){n.push(i)}))}else{for(var o in e.loss=e.loss,e.loss)if(-1===this.outputNames.indexOf(o))throw new sa('Unknown entry in loss dictionary: "'.concat(o,'". ')+"Only expected the following keys: ".concat(this.outputNames));var s,u=Object(Qr.a)(this.outputNames);try{for(u.s();!(s=u.n()).done;){var c=s.value;null==e.loss[c]&&console.warn('Output "'.concat(c,'" is missing from loss dictionary. We assume ')+"this was done on purpose, and we will not be expecting data "+"to be passed to ".concat(c," during training")),n.push(Yo(e.loss[c]))}}catch(v){u.e(v)}finally{u.f()}}this.lossFunctions=n,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(var l=0;l<this.outputs.length;++l){var d=this.internalOutputShapes[l],p=this.outputNames[l];this.feedOutputNames.push(p),this.feedOutputShapes.push(d),this.feedLossFns.push(this.lossFunctions[l])}var f=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],Va("loss",(function(){for(var e=0;e<t.outputs.length;++e)if(-1===f.indexOf(e)){var n=t.lossFunctions[e];t.outputs.length>1&&(t.metricsTensors.push([n,e]),t.metricsNames.push(t.outputNames[e]+"_loss"))}}));var h=function(e,t){if(null==e||Array.isArray(e)&&0===e.length)return t.map((function(e){return[]}));var n;if("string"===typeof e||"function"===typeof e)n=[e];else{if(!Array.isArray(e)&&"object"!==typeof e)throw new TypeError("Type of metrics argument not understood. Expected an string,"+"function, Array, or Object, found: ".concat(e));n=e}if(Array.isArray(n))return t.map((function(e){return n}));var r,a=[],i=Object(Qr.a)(t);try{for(i.s();!(r=i.n()).done;){var o=r.value,s=n.hasOwnProperty(o)?n[o]:[];Array.isArray(s)||(s=[s]),a.push(s)}}catch(v){i.e(v)}finally{i.f()}return a}(e.metrics,this.outputNames),m=function(e,n,r){t.outputNames.length>1&&(n=t.outputNames[e]+"_"+n),t.metricsNames.push(n),t.metricsTensors.push([r,e])};Va("metric",(function(){for(var e=function(e){if(-1!==f.indexOf(e))return"continue";!function(n){var r,a,i,o,s=Object(Qr.a)(n);try{for(s.s();!(o=s.n()).done;){var u=o.value;if("string"===typeof u&&-1!==["accuracy","acc","crossentropy","ce"].indexOf(u)){var c=t.internalOutputShapes[e];1===c[c.length-1]||t.lossFunctions[e]===Ho?-1!==["accuracy","acc"].indexOf(u)?a=Zo:-1!==["crossentropy","ce"].indexOf(u)&&(a=es):t.lossFunctions[e]===Go?-1!==["accuracy","acc"].indexOf(u)?a=ts:-1!==["crossentropy","ce"].indexOf(u)&&(a=rs):-1!==["accuracy","acc"].indexOf(u)?a=Jo:-1!==["crossentropy","ce"].indexOf(u)&&(a=ns);var l=void 0;-1!==["accuracy","acc"].indexOf(u)?l="acc":-1!==["crossentropy","ce"].indexOf(u)&&(l="ce"),i=a,r=""+l}else{var d=is(u);i=d,r=""+os(u)}var p=void 0;Va(r,(function(){p=i})),m(e,r,p)}}catch(v){s.e(v)}finally{s.f()}}(h[e])},n=0;n<t.outputs.length;++n)e(n)})),this.collectedTrainableWeights=this.trainableWeights}},{key:"checkTrainableWeightsConsistency",value:function(){null!=this.collectedTrainableWeights&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}},{key:"evaluate",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=null==n.batchSize?32:n.batchSize;Rs(r);var a=!0,i=this.standardizeUserDataXY(e,t,a,r);try{var o=i[0].concat(i[1]);this.makeTestFunction();var s=this.testFunction,u=this.testLoop(s,o,r,n.verbose,n.steps);return ha(u)}finally{Us(i[0],e),Us(i[1],t)}}},{key:"evaluateDataset",value:function(){var e=Object(Oo.a)(wo.a.mark((function e(t,n){return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.makeTestFunction(),e.abrupt("return",_s(this,t,n));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"checkNumSamples",value:function(e,t,n){var r,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"steps";if(null!=n){if(r=null,null!=t)throw new sa("If ".concat(a," is set, batchSize must be null or undefined.")+"Got batchSize = ".concat(t))}else{if(null==e)throw new sa("Either the input data should have a defined shape, or "+"".concat(a," shoud be specified."));r=Array.isArray(e)?e[0].shape[0]:e.shape[0]}return r}},{key:"execute",value:function(e,t){if(Array.isArray(t)&&0===t.length)throw new sa("`outputs` is an empty Array, which is not allowed.");var n=Array.isArray(t),r=n?t:[t],i=this.retrieveSymbolicTensors(r),o=new no;if(e instanceof a.gd&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new sa("The number of inputs provided (".concat(e.length,") ")+"does not match the number of inputs of this model "+"(".concat(this.inputs.length,")."));for(var s=0;s<this.inputs.length;++s)o.add(this.inputs[s],e[s])}else{var u,c=Object(Qr.a)(this.inputs);try{for(c.s();!(u=c.n()).done;){var l=u.value,d=e[l.name];if(null==d)throw new sa("No value is provided for the model's input ".concat(l.name));o.add(l,d)}}catch(f){c.e(f)}finally{c.f()}}var p=io(i,o);return n?p:p[0]}},{key:"retrieveSymbolicTensors",value:function(e){var t,n=da(null,e.length),r=e.length,a=Object(Qr.a)(this.layers);try{for(a.s();!(t=a.n()).done;){for(var i=t.value,o=Array.isArray(i.output)?i.output:[i.output],s=o.map((function(e){return e.name})),u=0;u<e.length;++u){var c=s.indexOf(e[u]);if(-1!==c&&(n[u]=o[c],r--),0===r)break}if(0===r)break}}catch(d){a.e(d)}finally{a.f()}if(r>0){var l=[];throw n.forEach((function(t,n){null==t&&l.push(e[n])})),new sa("Cannot find SymbolicTensors for output name(s): "+"".concat(JSON.stringify(l)))}return n}},{key:"predictLoop",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return a.wf((function(){var i=t.checkNumSamples(e);if(r)throw new ua("Verbose predictLoop() is not implemented yet.");for(var o=Ms(i,n),s=t.outputs.map((function(e){return[]})),u=function(n){a.wf((function(){var r=o[n][0],a=o[n][1],i=Ds(e,r,a),s=[];if(Array.isArray(i))for(var u=0;u<i.length;++u)s.push({key:t.inputs[u],value:i[u]});else s.push({key:t.inputs[0],value:i});var c=new no(s);return io(t.outputs,c)})).forEach((function(e,t){return s[t].push(e)}))},c=0;c<o.length;++c)u(c);return ha(s.map((function(e){return a.Kd(e,0)})))}))}},{key:"predict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Ws(e);Xs(n,this.inputNames,this.feedInputShapes,!1);try{var r=null==t.batchSize?32:t.batchSize;return Rs(r),this.predictLoop(n,r)}finally{Us(n,e)}}},{key:"predictOnBatch",value:function(e){Xs(e,this.inputNames,this.feedInputShapes,!0);var t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)}},{key:"standardizeUserDataXY",value:function(e,t){var n=arguments.length>3?arguments[3]:void 0;if(null==this.optimizer_)throw new oa("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");for(var r=[],a=0;a<this.feedOutputShapes.length;++a){var i=this.feedOutputShapes[a],o=this.feedLossFns[a];o===Go?r.push(i.slice(0,i.length-1).concat([1])):r.push(i)}if(qs(e=Hs(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=Hs(t,this.feedOutputNames,r,!1,"target")),Ks(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&null!=n&&n>0&&e[0].shape[0]%n!==0)throw new sa("In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size "+"".concat(n,". Found: ").concat(e[0].shape[0]," sample(s)."));return[e,t]}},{key:"standardizeUserData",value:function(){var e=Object(Oo.a)(wo.a.mark((function e(t,n,r,a){var o,s,u,c,l,d,p,f,h,m=arguments;return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=!(m.length>4&&void 0!==m[4])||m[4],s=m.length>5?m[5]:void 0,u=this.standardizeUserDataXY(t,n,o,s),c=Object(i.a)(u,2),l=c[0],d=c[1],null==r){e.next=5;break}throw new Error("sample weight is not supported yet.");case 5:if(p=null,null==a){e.next=19;break}f=ys(a,this.outputNames),p=[],h=0;case 10:if(!(h<f.length)){e.next=19;break}return e.t0=p,e.next=14,xs(d[h],null,f[h]);case 14:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 16:++h,e.next=10;break;case 19:return e.abrupt("return",[l,d,p]);case 20:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"testLoop",value:function(e,t,n){var r=this,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4?arguments[4]:void 0;return a.wf((function(){var s=r.checkNumSamples(t,n,o,"steps"),u=[];if(i>0)throw new ua("Verbose mode is not implemented yet.");if(null!=o)throw new ua("steps mode in testLoop() is not implemented yet");for(var c=Ms(s,n),l=Object(a.tf)(Qa(0,s)),d=0;d<c.length;++d){var p=c[d][0],f=c[d][1],h=ri(l,p,f-p),m=Fs(t,h),v=e(m);if(0===d)for(var b=0;b<v.length;++b)u.push(Object(a.We)(0));for(var g=0;g<v.length;++g){var y=v[g];u[g]=a.sd(u[g],a.Fe(f-p,y))}}for(var x=0;x<u.length;++x)u[x]=a.Xd(u[x],s);return u}))}},{key:"getDedupedMetricsNames",value:function(){for(var e=this.metricsNames,t=[],n=0;n<e.length;++n){var r=e[n],a=r;if(fa(e,r)>1){var i=fa(e.slice(0,n),r);a+="_".concat(i)}t.push(a)}return t}},{key:"makeTrainFunction",value:function(){var e=this;return function(t){var n=[],r=t.slice(0,e.inputs.length),i=t.slice(e.inputs.length,e.inputs.length+e.outputs.length),o=t.slice(e.inputs.length+e.outputs.length,e.inputs.length+2*e.outputs.length),s=[],u=e.collectedTrainableWeights.map((function(e){return e.read()}));return[e.optimizer_.minimize((function(){for(var t=[],u=0;u<e.inputs.length;++u)t.push({key:e.inputs[u],value:r[u]});for(var c,l=new no(t),d=io(e.outputs,l,{training:!0}),p=0;p<e.lossFunctions.length;++p){var f=(0,e.lossFunctions[p])(i[p],d[p]);null!=o[p]&&(f=ws(f,o[p]));var h=a.Be(f);n.push(h),c=0===p?f:a.sd(c,f)}for(var m=0;m<e.metricsTensors.length;++m){var v=void 0;if(e.outputs.length>1&&m<e.outputs.length)v=n[m];else{var b=e.metricsTensors[m][0],g=e.metricsTensors[m][1];v=a.Be(b(i[g],d[g]))}a.oe(v),s.push(v)}return c=a.Be(c),e.calculateLosses().forEach((function(e){c=a.sd(c,e)})),c}),!0,u)].concat(s)}}},{key:"makeTestFunction",value:function(){var e=this;this.testFunction=function(t){return a.wf((function(){for(var n,r=[],i=t.slice(0,e.inputs.length),o=t.slice(e.inputs.length,e.inputs.length+e.outputs.length),s=[],u=0;u<e.inputs.length;++u)s.push({key:e.inputs[u],value:i[u]});for(var c=new no(s),l=io(e.outputs,c),d=0;d<e.lossFunctions.length;++d){var p=e.lossFunctions[d],f=a.Be(p(o[d],l[d]));n=0===d?f:a.sd(n,f),r.push(n)}for(var h=0;h<e.metricsTensors.length;++h){var m=e.metricsTensors[h][0],v=e.metricsTensors[h][1],b=a.Be(m(o[v],l[v]));r.push(b)}return r}))}}},{key:"fit",value:function(){var e=Object(Oo.a)(wo.a.mark((function e(t,n){var r,a=arguments;return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>2&&void 0!==a[2]?a[2]:{},e.abrupt("return",Ps(this,t,n,r));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"fitDataset",value:function(){var e=Object(Oo.a)(wo.a.mark((function e(t,n){return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Ns(this,t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"trainOnBatch",value:function(){var e=Object(Oo.a)(wo.a.mark((function e(t,n){var r,i,o,s,u,c,l,d,p,f;return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.standardizeUserData(t,n);case 2:r=e.sent,i=r[0],o=r[1],s=this.makeTrainFunction(),u=s(i.concat(o)),c=[],l=Object(Qr.a)(u),e.prev=9,l.s();case 11:if((d=l.n()).done){e.next=19;break}return p=d.value,e.next=15,p.data();case 15:f=e.sent,c.push(f[0]);case 17:e.next=11;break;case 19:e.next=24;break;case 21:e.prev=21,e.t0=e.catch(9),l.e(e.t0);case 24:return e.prev=24,l.f(),e.finish(24);case 27:return a.Wd(u),Us(r[0],t),Us(r[1],n),e.abrupt("return",ha(c));case 31:case"end":return e.stop()}}),e,this,[[9,21,24,27]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getNamedWeights",value:function(e){for(var t=[],n=null!=e&&e.trainableOnly,r=n?this.trainableWeights:this.weights,a=this.getWeights(n),i=0;i<r.length;++i)n&&!r[i].trainable||t.push({name:r[i].originalName,tensor:a[i]});return t}},{key:"dispose",value:function(){var e=Object(Fo.a)(Object(Mo.a)(n.prototype),"dispose",this).call(this);if(0===e.refCountAfterDispose&&null!=this.optimizer&&this.isOptimizerOwned){var t=a.Ce().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=t-a.Ce().numTensors}return e}},{key:"getLossIdentifiers",value:function(){var e;if("string"===typeof this.loss)e=va(this.loss);else if(Array.isArray(this.loss)){var t,n=Object(Qr.a)(this.loss);try{for(n.s();!(t=n.n()).done;){if("string"!==typeof t.value)throw new Error("Serialization of non-string loss is not supported.")}}catch(u){n.e(u)}finally{n.f()}e=this.loss.map((function(e){return va(e)}))}else{var r=Object.keys(this.loss);e={};for(var a=this.loss,i=0,o=r;i<o.length;i++){var s=o[i];if("string"!==typeof a[s])throw new Error("Serialization of non-string loss is not supported.");e[s]=va(a[s])}}return e}},{key:"getMetricIdentifiers",value:function(){if("string"===typeof this.metrics||"function"===typeof this.metrics)return[va(os(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map((function(e){return va(os(e))}));var e={};for(var t in this.metrics)e[t]=va(os(this.metrics[t]));return e}},{key:"getTrainingConfig",value:function(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}},{key:"loadTrainingConfig",value:function(e){if(null!=e.weighted_metrics)throw new Error("Loading weight_metrics is not supported yet.");if(null!=e.loss_weights)throw new Error("Loading loss_weights is not supported yet.");if(null!=e.sample_weight_mode)throw new Error("Loading sample_weight_mode is not supported yet.");var t,n,r=zo(vs(e.optimizer_config));if("string"===typeof e.loss)t=ba(e.loss);else if(Array.isArray(e.loss))t=e.loss.map((function(e){return ba(e)}));else if(null!=e.loss)for(var a in t={},e.loss)t[a]=ba(e.loss[a]);if(Array.isArray(e.metrics))n=e.metrics.map((function(e){return ba(e)}));else if(null!=e.metrics)for(var i in n={},e.metrics)n[i]=ba(e.metrics[i]);this.compile({loss:t,metrics:n,optimizer:r})}},{key:"save",value:function(){var e=Object(Oo.a)(wo.a.mark((function e(t,n){var r,i,o,s,u,c,l,d,p;return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!==typeof t){e.next=9;break}if(0!==(r=a.ne.getSaveHandlers(t)).length){e.next=6;break}throw new sa("Cannot find any save handlers for URL '".concat(t,"'"));case 6:if(!(r.length>1)){e.next=8;break}throw new sa("Found more than one (".concat(r.length,") save handlers for ")+"URL '".concat(t,"'"));case 8:t=r[0];case 9:if(null!=t.save){e.next=11;break}throw new sa("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");case 11:return e.next=13,a.ne.encodeWeights(this.getNamedWeights(n));case 13:if(i=e.sent,!1,null,o=this.toJSON(null,!1),s={modelTopology:o,format:"layers-model",generatedBy:"TensorFlow.js tfjs-layers v".concat("3.21.0"),convertedBy:null},!(null!=n&&n.includeOptimizer)||null==this.optimizer){e.next=34;break}return s.trainingConfig=this.getTrainingConfig(),c="optimizer",e.t0=a.ne,e.next=25,this.optimizer.getWeights();case 25:return e.t1=e.sent,e.t2=c,e.next=29,e.t0.encodeWeights.call(e.t0,e.t1,e.t2);case 29:l=e.sent,d=l.data,p=l.specs,(u=i.specs).push.apply(u,Object(qn.a)(p)),i.data=a.ne.concatenateArrayBuffers([i.data,d]);case 34:return null!=this.userDefinedMetadata&&(!0,ss(this.userDefinedMetadata,this.name,!0),s.userDefinedMetadata=this.userDefinedMetadata),s.weightData=i.data,s.weightSpecs=i.specs,e.abrupt("return",t.save(s));case 38:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"setUserDefinedMetadata",value:function(e){ss(e,this.name),this.userDefinedMetadata=e}},{key:"getUserDefinedMetadata",value:function(){return this.userDefinedMetadata}},{key:"stopTraining",set:function(e){this.stopTraining_=e},get:function(){return this.stopTraining_}},{key:"optimizer",get:function(){return this.optimizer_},set:function(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}}]),n}(function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;if(Object($r.a)(this,n),(r=t.call(this,{})).containerNodes=new Set,r.name=e.name,null==r.name){var a=r.getClassName().toLowerCase();r.name=Aa(a)}if(r.supportsMasking=!1,r.trainable_=!0,Array.isArray(e.inputs)?r.inputs=e.inputs.slice():r.inputs=[e.inputs],Array.isArray(e.outputs)?r.outputs=e.outputs.slice():r.outputs=[e.outputs],Oa(r.inputs).length!==r.inputs.length)throw new sa("The list of inputs passed to the model is redundant. All inputs should only appear once. Found: "+"".concat(r.inputs.map((function(e){return e.name}))));Oa(r.outputs).length!==r.outputs.length&&console.warn("The list of outputs passed to the model is redundant. All outputs should only appear once. Found: "+"".concat(r.outputs.map((function(e){return e.name})))),r.inputLayers=[],r.inputLayersNodeIndices=[],r.inputLayersTensorIndices=[],r.outputLayers=[],r.outputLayersNodeIndices=[],r.outputLayersTensorIndices=[],r.layers=[],r.internalContainerRefs=[];var i,o=Object(Qr.a)(r.outputs);try{for(o.s();!(i=o.n()).done;){var s=i.value,u=s.sourceLayer,c=s.nodeIndex,l=s.tensorIndex;r.outputLayers.push(u),r.outputLayersNodeIndices.push(c),r.outputLayersTensorIndices.push(l)}}catch(we){o.e(we)}finally{o.f()}var d,p=Object(Qr.a)(r.inputs);try{for(p.s();!(d=p.n()).done;){var f=d.value,h=f.sourceLayer,m=f.nodeIndex,v=f.tensorIndex;pa(0===m,"input layer has >1 nodes"),pa(0===v,"input layer has >1 tensors"),r.inputLayers.push(h),r.inputLayersNodeIndices.push(m),r.inputLayersTensorIndices.push(v)}}catch(we){p.e(we)}finally{p.f()}r.inputNames=[],r.outputNames=[],r.feedInputShapes=[],r.feedInputNames=[],r.feedOutputNames=[];for(var b=0;b<r.inputLayers.length;b++){var g=r.inputLayers[b];if(!(g instanceof eo))throw new TypeError("Input layers to a LayersModel must be InputLayer objects. "+"Received inputs: ".concat(e.inputs,". ")+"Input ".concat(b," (0-based) originates ")+"from layer type ".concat(g.getClassName(),"."));r.inputNames.push(g.name),r.feedInputShapes.push(g.batchInputShape),r.feedInputNames.push(g.name)}var y,x=Object(Qr.a)(r.outputLayers);try{for(x.s();!(y=x.n()).done;){var k=y.value;r.outputNames.push(k.name)}}catch(we){x.e(we)}finally{x.f()}r.internalInputShapes=r.inputs.map((function(e){return e.shape})),r.internalOutputShapes=r.outputs.map((function(e){return e.shape}));var w,O={},I={},S={},N={},j={},T=[],C=function e(t,a,i,o,s,u){null!=o&&null!=s&&null!=u||(o=t.sourceLayer,s=t.nodeIndex,u=t.tensorIndex);var c=o.inboundNodes[s];if(-1!==i.indexOf(c))throw new oa("The tensor ".concat(t.name,' at layer "').concat(o.name,'" ')+"is part of a cycle.");if(-1===a.indexOf(c)){r.containerNodes.add(n.nodeKey(o,s)),o.id in j||(j[o.id]=Object.keys(j).length),-1===i.indexOf(c)&&i.push(c);for(var l=c.inboundLayers.length,d=0;d<l;d++){e(c.inputTensors[d],a,i,c.inboundLayers[d],c.nodeIndices[d],c.tensorIndices[d])}for(a.push(c);i.indexOf(c)>=0;)i.splice(i.indexOf(c),1);T.push(c)}},E=[],_=[],A=Object(Qr.a)(r.outputs);try{for(A.s();!(w=A.n()).done;){C(w.value,E,_)}}catch(we){A.e(we)}finally{A.f()}var R,D=T.slice().reverse(),F=Object(Qr.a)(D);try{for(F.s();!(R=F.n()).done;){var M=R.value;I[M.id]=M,M.id in O||(O[M.id]=0);var z=O[M.id],L=null==S[M.outboundLayer.id]?0:S[M.outboundLayer.id];z=Math.max(z,L),S[M.outboundLayer.id]=z,N[M.outboundLayer.id]=M.outboundLayer,O[M.id]=z;for(var P=0;P<M.inboundLayers.length;P++){var B=M.inboundLayers[P],W=M.nodeIndices[P],U=B.inboundNodes[W],V=null==O[U.id]?0:O[U.id];O[U.id]=Math.max(z+1,V),I[U.id]=U}}}catch(we){F.e(we)}finally{F.f()}var G={};for(var H in O){var q=O[H];q in G||(G[q]=[]),G[q].push(I[H])}var K={};for(var X in S){var Y=S[X];Y in K||(K[Y]=[]),K[Y].push(N[X])}var Z=Object.keys(K).map((function(e){return parseInt(e,10)})).sort(wa);r.layers=[];var J,Q=Object(Qr.a)(Z);try{for(Q.s();!(J=Q.n()).done;){var $=K[J.value];$.sort((function(e,t){var n=j[e.id],r=j[t.id];return n<r?-1:n>r?1:0}));var ee,te=Object(Qr.a)($);try{for(te.s();!(ee=te.n()).done;){var ne=ee.value;ne instanceof n&&r.internalContainerRefs.push(ne),r.layers.push(ne)}}catch(we){te.e(we)}finally{te.f()}}}catch(we){Q.e(we)}finally{Q.f()}r.layersByDepth=K,Z=Object.keys(G).map((function(e){return parseInt(e,10)})).sort(wa);var re,ae=r.inputs.slice(),ie=[],oe=Object(Qr.a)(Z);try{for(oe.s();!(re=oe.n()).done;){var se,ue=re.value,ce=Object(Qr.a)(G[ue]);try{for(ce.s();!(se=ce.n()).done;){var le=se.value,de=le.outboundLayer;if(null!=de){var pe,fe=Object(Qr.a)(le.inputTensors);try{for(fe.s();!(pe=fe.n()).done;){var he=pe.value;if(-1===ae.indexOf(he))throw new oa("Graph disconnected: cannot obtain value for tensor ".concat(he)+' at layer "'.concat(de.name,'". ')+"The following previous layers were accessed without "+"issue: ".concat(ie))}}catch(we){fe.e(we)}finally{fe.f()}var me,ve=Object(Qr.a)(le.outputTensors);try{for(ve.s();!(me=ve.n()).done;){var be=me.value;ae.push(be)}}catch(we){ve.e(we)}finally{ve.f()}ie.push(de.name)}}}catch(we){ce.e(we)}finally{ce.f()}}}catch(we){oe.e(we)}finally{oe.f()}r.nodesByDepth=G;var ge,ye=r.layers.map((function(e){return e.name})),xe=Object(Qr.a)(ye);try{var ke=function(){var e=ge.value,t=ye.filter((function(t){return t===e})).length;if(1!==t)throw new oa('The name "'.concat(e,'" is used ').concat(t," times ")+"in the model. All layer names should be unique. Layer names: "+JSON.stringify(ye))};for(xe.s();!(ge=xe.n()).done;)ke()}catch(we){xe.e(we)}finally{xe.f()}return r.outboundNodes=[],r.inboundNodes=[],new Ji({outboundLayer:Object(ta.a)(r),inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:r.inputs,outputTensors:r.outputs,inputMasks:r.inputs.map((function(e){return null})),outputMasks:r.outputs.map((function(e){return null})),inputShapes:r.inputs.map((function(e){return e.shape})),outputShapes:r.outputs.map((function(e){return e.shape}))}),r.built=!0,r._refCount=1,r}return Object(ea.a)(n,[{key:"assertNotDisposed",value:function(){if(0===this._refCount)throw new Error("Container '".concat(this.name,"' is already disposed."))}},{key:"dispose",value:function(){this.assertNotDisposed();var e={refCountAfterDispose:null,numDisposedVariables:0};if(0===--this._refCount){var t,n=Object(Qr.a)(this.layers);try{for(n.s();!(t=n.n()).done;){var r=t.value;e.numDisposedVariables+=r.dispose().numDisposedVariables}}catch(s){n.e(s)}finally{n.f()}var a,i=Object(Qr.a)(this.internalContainerRefs);try{for(i.s();!(a=i.n()).done;){var o=a.value;e.numDisposedVariables+=o.dispose().numDisposedVariables}}catch(s){i.e(s)}finally{i.f()}}return e.refCountAfterDispose=this._refCount,e}},{key:"loadWeights",value:function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r={},a=0,i=Object(Qr.a)(this.layers);try{for(i.s();!(t=i.n()).done;){var o,s=t.value,u=Object(Qr.a)(s.weights);try{for(u.s();!(o=u.n()).done;){var c=o.value;if(null!=r[c.originalName])throw new sa("Duplicate weight name: ".concat(c.originalName));r[c.originalName]=c,a++}}catch(b){u.e(b)}finally{u.f()}}}catch(b){i.e(b)}finally{i.f()}var l=[];for(var d in e){var p=d;if(null==r[d]){var f=d.split("/"),h=f.slice(0,-2).concat([f[f.length-1]]);p=h.join("/")}if(null!=r[p])l.push([r[p],e[d]]);else if(n)throw new sa("Provided weight data has no target variable: ".concat(d));delete r[p]}if(n){var m=[];for(var v in r)m.push(v);if(m.length>0)throw new sa("".concat(m.length," of ").concat(a," weights are not set: ")+"".concat(m))}Ki(l)}},{key:"updatedConfig",value:function(){var e=this.getConfig(),t={};return t.className=this.getClassName(),t.config=e,t.kerasVersion="tfjs-layers ".concat("3.21.0"),t.backend="TensorFlow.js",t}},{key:"toJSON",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=bs(this.updatedConfig());return t?JSON.stringify(n):n}},{key:"call",value:function(e,t){var n=this;return Object(a.wf)((function(){e=ma(e);for(var r=new no,a=0;a<n.inputs.length;++a)r.add(n.inputs[a],e[a]);return io(n.outputs,r,t)}))}},{key:"computeMask",value:function(e,t){var n=this;return Object(a.wf)((function(){var r;return e=ma(e),r=null==t?da(null,e.length):ma(t),n.runInternalGraph(e,r)[1]}))}},{key:"computeOutputShape",value:function(e){var t=Wi(e);if(t.length!==this.inputLayers.length)throw new sa("Invalid inputShape argument ".concat(e,": ")+"model has ".concat(this.inputLayers.length," tensor inputs."));for(var n={},r=0;r<t.length;r++){var a=this.inputLayers[r],i=t[r];n[a.name+"_0_0"]=i}var o=Object.keys(this.nodesByDepth).map((function(e){return parseInt(e,10)})).sort(wa);if(o.length>1){var s,u=Object(Qr.a)(o);try{for(u.s();!(s=u.n()).done;){var c,l=s.value,d=this.nodesByDepth[l],p=Object(Qr.a)(d);try{for(p.s();!(c=p.n()).done;){var f=c.value,h=f.outboundLayer;if(-1===this.inputLayers.map((function(e){return e.id})).indexOf(h.id)){for(var m=[],v=0;v<f.inboundLayers.length;v++){var b=f.inboundLayers[v],g=f.nodeIndices[v],y=f.tensorIndices[v],x=n["".concat(b.name,"_").concat(g,"_").concat(y)];m.push(x)}for(var k=Wi(h.computeOutputShape(ha(m))),w=h.inboundNodes.indexOf(f),O=0;O<k.length;O++){n["".concat(h.name,"_").concat(w,"_").concat(O)]=k[O]}}}}catch(R){p.e(R)}finally{p.f()}}}catch(R){u.e(R)}finally{u.f()}}for(var I=[],S=[],N=0;N<this.outputLayers.length;N++){var j=this.outputLayers[N],T=this.outputLayersNodeIndices[N],C=this.outputLayersTensorIndices[N],E="".concat(j.name,"_").concat(T,"_").concat(C);S.push(E)}for(var _=0;_<S.length;_++){var A=S[_];pa(A in n),I.push(n[A])}return ha(I)}},{key:"runInternalGraph",value:function(e,t){null==t&&(t=da(null,e.length));for(var n={},r=0;r<this.inputs.length;++r){var a=this.inputs[r],o=e[r],s=t[r];n[a.id]=[o,s]}var u,c=Object.keys(this.nodesByDepth).map((function(e){return parseInt(e,10)})).sort(wa),l=Object(Qr.a)(c);try{for(l.s();!(u=l.n()).done;){var d,p=u.value,f=this.nodesByDepth[p],h=Object(Qr.a)(f);try{for(h.s();!(d=h.n()).done;){var m,v=d.value,b=v.outboundLayer,g=v.inputTensors,y=v.outputTensors,x=new Array,k=Object(Qr.a)(g);try{for(k.s();!(m=k.n()).done;){var w=m.value;w.id in n&&x.push(n[w.id])}}catch(G){k.e(G)}finally{k.f()}if(x.length===g.length){var O={},I=void 0,S=void 0,N=void 0,j=void 0;if(null!=v.callArgs&&(O=v.callArgs),1===x.length){var T=Object(i.a)(x[0],2),C=T[0],E=T[1];null==O.mask&&(O.mask=E),N=ma(b.call(C,O)),j=ma(b.computeMask(C,E)),I=[C],S=[E]}else I=x.map((function(e){return e[0]})),S=x.map((function(e){return e[1]})),null==O.mask&&(O.mask=S),N=ma(b.call(I,O)),j=ma(b.computeMask(I,S));if(b.activityRegularizer)throw new ua("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(var _=0;_<y.length;++_){var A=y[_],R=N[_],D=j[_];n[A.id]=[R,D]}}}}catch(G){h.e(G)}finally{h.f()}}}catch(G){l.e(G)}finally{l.f()}var F,M=[],z=[],L=[],P=Object(Qr.a)(this.outputs);try{for(P.s();!(F=P.n()).done;){var B=F.value;pa(B.id in n,"Could not compute output ".concat(B.name," : ").concat(B.id));var W=Object(i.a)(n[B.id],2),U=W[0],V=W[1];L.push(U.shape),M.push(U),z.push(V)}}catch(G){P.e(G)}finally{P.f()}return[M,z,L]}},{key:"buildNodeConversionMap",value:function(e){var t,r,a={},i=Object(Qr.a)(this.layers);try{for(i.s();!(r=i.n()).done;){var o=r.value;t=o instanceof n?1:0;for(var s=0;s<o.inboundNodes.length;s++){var u=n.nodeKey(o,s);this.containerNodes.has(u)&&(a[u]=t,t+=1)}}}catch(c){i.e(c)}finally{i.f()}return a}},{key:"getLayer",value:function(e,t){if(null!=t){if(this.layers.length<=t)throw new sa("Was asked to retrieve layer at index ".concat(t,", but model only ")+"has ".concat(this.layers.length," layer(s)."));return this.layers[t]}if(null==e)throw new sa("Provide either a layer name or layer index");var n,r=Object(Qr.a)(this.layers);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(a.name===e)return a}}catch(i){r.e(i)}finally{r.f()}throw new sa("No such layer: ".concat(e))}},{key:"calculateLosses",value:function(){var e=this;return Object(a.wf)((function(){var t,r=[],a=Object(Qr.a)(e.layers);try{for(a.s();!(t=a.n()).done;)for(var i=t.value,o=0;o<i.inboundNodes.length;++o){var s=n.nodeKey(i,o);e.containerNodes.has(s)&&r.push.apply(r,Object(qn.a)(i.calculateLosses()))}}catch(u){a.e(u)}finally{a.f()}return r}))}},{key:"getConfig",value:function(){var e,t={name:this.name},r=this.buildNodeConversionMap(this.layers),a=[],i=Object(Qr.a)(this.layers);try{for(i.s();!(e=i.n()).done;){for(var o=e.value,s=o.getClassName(),u=o.getConfig(),c=[],l=0;l<o.inboundNodes.length;l++){var d=o.inboundNodes[l],p=n.nodeKey(o,l),f={};if(this.containerNodes.has(p)){if(d.callArgs)try{JSON.stringify(d.callArgs),f=d.callArgs}catch(F){console.warn("Layer ".concat(o.name," was passed ")+"non-serializable keyword arguments: "+"".concat(d.callArgs,". They will not be included ")+"in the serialized model (and thus will be missing at deserialization time)."),f={}}if(d.inboundLayers.length>0){for(var h=[],m=0;m<d.inboundLayers.length;m++){var v=d.inboundLayers[m],b=d.nodeIndices[m],g=d.tensorIndices[m],y=r[n.nodeKey(v,b)];null==y&&(y=0),h.push([v.name,y,g,f])}c.push(h)}}}var x={};x.name=o.name,x.className=s,x.config=u,x.inboundNodes=c,a.push(x)}}catch(F){i.e(F)}finally{i.f()}t.layers=a;for(var k=[],w=0;w<this.inputLayers.length;w++){var O=this.inputLayers[w],I=this.inputLayersNodeIndices[w],S=n.nodeKey(O,I);if(this.containerNodes.has(S)){var N=r[S];null!==N&&void 0!==N||(N=0);var j=this.inputLayersTensorIndices[w];k.push([O.name,N,j])}}t.inputLayers=k;for(var T=[],C=0;C<this.outputLayers.length;C++){var E=this.outputLayers[C],_=this.outputLayersNodeIndices[C],A=n.nodeKey(E,_);if(this.containerNodes.has(A)){var R=r[A];null!==R&&void 0!==R||(R=0);var D=this.outputLayersTensorIndices[C];T.push([E.name,R,D])}}return t.outputLayers=T,t}},{key:"resetStates",value:function(){var e=this;Object(a.wf)((function(){e.layers.forEach((function(e){e.stateful&&e.resetStates()}))}))}},{key:"trainable",get:function(){return this.trainable_},set:function(e){this.layers.forEach((function(t){t._trainableWeights.forEach((function(t){return t.trainable=e}))})),this.trainable_=e}},{key:"trainableWeights",get:function(){if(this._trainableWeights.length>0)throw new sa("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];var e,t=[],n=Object(Qr.a)(this.layers);try{for(n.s();!(e=n.n()).done;){var r=e.value;t=t.concat(r.trainableWeights)}}catch(a){n.e(a)}finally{n.f()}return t}},{key:"nonTrainableWeights",get:function(){var e,t=[],n=Object(Qr.a)(this.layers);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,Object(qn.a)(r.nonTrainableWeights))}}catch(u){n.e(u)}finally{n.f()}if(!this.trainable){var a,i=[],o=Object(Qr.a)(this.layers);try{for(o.s();!(a=o.n()).done;){var s=a.value;i.push.apply(i,Object(qn.a)(s.trainableWeights))}}catch(u){o.e(u)}finally{o.f()}return i.concat(t)}return t}},{key:"weights",get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)}},{key:"stateful",get:function(){if(this._stateful)throw new sa("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");var e,t=Object(Qr.a)(this.layers);try{for(t.s();!(e=t.n()).done;){if(e.value.stateful)return!0}}catch(n){t.e(n)}finally{t.f()}return!1}}],[{key:"fromConfig",value:function(e,t){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r={},a={};function i(e,t){e.name in a?a[e.name].push(t):a[e.name]=[t]}function o(e,t){var n,a,o=[],s=Object(Qr.a)(t);try{for(s.s();!(a=s.n()).done;){var u=a.value,c=u[0],l=u[1],d=u[2];if(n=null==u[3]?{}:u[3],!(c in r))return void i(e,t);var p=r[c];if(p.inboundNodes.length<=l)return void i(e,t);var f=p.inboundNodes[l];o.push(f.outputTensors[d])}}catch(h){s.e(h)}finally{s.f()}o.length>0&&e.apply(ha(o),n)}function s(e){var a=e.name,o=zo(e,null!=t.customObjects?t.customObjects:{});o.setFastWeightInitDuringBuild(n),r[a]=o,e.inboundNodes.forEach((function(e){if(!(e instanceof Array))throw new sa("Corrupted configuration, expected array for nodeData: ".concat(e));i(o,e)}))}var u,c=t.name,l=t.layers,d=Object(Qr.a)(l);try{for(d.s();!(u=d.n()).done;){var p=u.value;s(p)}}catch(W){d.e(W)}finally{d.f()}for(;!Ia(a);){var f,h=Object(Qr.a)(l);try{for(h.s();!(f=h.n()).done;){var m=f.value,v=r[m.name];if(v.name in a){var b=a[v.name];delete a[v.name];var g,y=Object(Qr.a)(b);try{for(y.s();!(g=y.n()).done;){var x=g.value;o(v,x)}}catch(W){y.e(W)}finally{y.f()}}}}catch(W){h.e(W)}finally{h.f()}}var k,w=[],O=[],I=t.inputLayers,S=Object(Qr.a)(I);try{for(S.s();!(k=S.n()).done;){var N=k.value,j=N[0],T=N[1],C=N[2];pa(j in r);var E=r[j],_=E.inboundNodes[T].outputTensors;w.push(_[C])}}catch(W){S.e(W)}finally{S.f()}var A,R=t.outputLayers,D=Object(Qr.a)(R);try{for(D.s();!(A=D.n()).done;){var F=A.value,M=F[0],z=F[1],L=F[2];pa(M in r);var P=r[M],B=P.inboundNodes[z].outputTensors;O.push(B[L])}}catch(W){D.e(W)}finally{D.f()}return new e({inputs:w,outputs:O,name:c})}}]),n}($i));Ys.className="Model",a.Ze.registerClass(Ys);var Zs=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(){return Object($r.a)(this,n),t.apply(this,arguments)}return n}(Ys);Zs.className="Functional",a.Ze.registerClass(Zs);var Js=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;if(Object($r.a)(this,n),e=e||{},(r=t.call(this,{inputs:[],outputs:[]})).trainable=!0,r.built=!1,r.name=null!=e.name?e.name:Aa("sequential_"),null!=e.layers){var a,i=Object(Qr.a)(e.layers);try{for(i.s();!(a=i.n()).done;){var o=a.value;r.add(o)}}catch(s){i.e(s)}finally{i.f()}}return r}return Object(ea.a)(n,[{key:"checkShape",value:function(e){if(e.inboundNodes[0].outputTensors[0].shape.some((function(e){return e<0})))throw new sa("Negative dimension size caused by adding layer "+"".concat(e.name," with input shape [")+"".concat(e.inboundNodes[0].inputTensors[0].shape,"]"))}},{key:"add",value:function(e){var t,r=e instanceof n||e instanceof Ys;if(r){if(1!==(t=e).outputs.length)throw new sa("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(1!==t.inputs.length)throw new sa("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(0===this.outputs.length){if(0===e.inboundNodes.length){if(null==e.batchInputShape)throw new sa("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");var a=to({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(a)}if(r)this.outputs=t.outputs,this.inputs=t.inputs;else{if(1!==e.inboundNodes.length)throw new sa("A layer added to a Sequential model must not already be "+"connected somewhere else. LayersModel received layer ".concat(e.name," ")+"which has ".concat(e.inboundNodes.length," pre-existing inbound ")+"connections.");if(1!==e.inboundNodes[0].outputTensors.length)throw new sa("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=function e(t,n,r){if((null==n||null!=r&&r>0)&&(n=t.sourceLayer,r=t.nodeIndex),0===n.inboundNodes.length)return[t];var a=n.inboundNodes[r];if(0===a.inboundLayers.length)return a.inputTensors;for(var i=[],o=0;o<a.inboundLayers.length;o++){var s,u=e(a.inputTensors[o],a.inboundLayers[o],a.nodeIndices[o]),c=Object(Qr.a)(u);try{for(c.s();!(s=c.n()).done;){var l=s.value;-1===i.indexOf(l)&&i.push(l)}}catch(d){c.e(d)}finally{c.f()}}return i}(this.outputs[0])}this.inboundNodes=[],new Ji({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:da(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map((function(e){return e.shape})),outputShapes:this.outputs[0].shape})}else{var i=e.apply(this.outputs[0]);if(Array.isArray(i))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[i],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}},{key:"pop",value:function(){if(0===this.layers.length)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),0===this.layers.length)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{var e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}},{key:"call",value:function(e,t){return null==this.model&&this.build(),this.model.call(e,t)}},{key:"build",value:function(e){if(Vi(e),0===this.inputs.length||0===this.outputs.length)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new Ys({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}},{key:"countParams",value:function(){return this.built||this.build(),Object(Fo.a)(Object(Mo.a)(n.prototype),"countParams",this).call(this)}},{key:"summary",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log;this.built||this.build(),Object(Fo.a)(Object(Mo.a)(n.prototype),"summary",this).call(this,e,t,r)}},{key:"setWeights",value:function(e){null==this.model&&this.build(),this.model.setWeights(e)}},{key:"evaluate",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!this.built)throw new oa("The model needs to be compiled before being used.");return this.model.evaluate(e,t,n)}},{key:"evaluateDataset",value:function(){var e=Object(Oo.a)(wo.a.mark((function e(t,n){return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.built){e.next=2;break}throw new oa("The model needs to be compiled before being used.");case 2:return e.abrupt("return",this.model.evaluateDataset(t,n));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"predict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return null==this.model&&this.build(),this.model.predict(e,t)}},{key:"predictOnBatch",value:function(e){return null==this.model&&this.build(),this.model.predictOnBatch(e)}},{key:"compile",value:function(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}},{key:"fit",value:function(){var e=Object(Oo.a)(wo.a.mark((function e(t,n){var r,a=arguments;return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a.length>2&&void 0!==a[2]?a[2]:{},this.built){e.next=3;break}throw new oa("The model needs to be compiled before being used.");case 3:return e.abrupt("return",this.model.fit(t,n,r));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"fitDataset",value:function(){var e=Object(Oo.a)(wo.a.mark((function e(t,n){return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.built){e.next=2;break}throw new oa("The model needs to be compiled before being used.");case 2:return e.abrupt("return",this.model.fitDataset(t,n));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"trainOnBatch",value:function(){var e=Object(Oo.a)(wo.a.mark((function e(t,n){return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.model.trainOnBatch(t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){var e,t=[],n=Object(Qr.a)(this.layers);try{for(n.s();!(e=n.n()).done;){var r=e.value,a={};a.className=r.getClassName(),a.config=r.getConfig(),t.push(a)}}catch(i){n.e(i)}finally{n.f()}return{name:this.name,layers:t}}},{key:"optimizer",get:function(){return null==this.model?void 0:this.model.optimizer},set:function(e){this.model.optimizer=e}},{key:"stopTraining",set:function(e){if(null==this.model)throw new sa("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e},get:function(){if(null==this.model)throw new sa("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}}],[{key:"fromConfig",value:function(e,t){var r,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o={};if(t instanceof Array){if(null==t[0].className||"Merge"===t[0].className)throw new sa("Legacy serialization format not supported yet.");r=t}else a.Df.assert(null!=t.layers,(function(){return"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."})),r=t.layers,delete t.layers,o=t;var s=new e(o);if(!(s instanceof n))throw new ua("Sequential.fromConfig called on non-Sequential input: ".concat(s));var u,c=Object(Qr.a)(r);try{for(c.s();!(u=c.n()).done;){var l=u.value,d=void 0,p=zo(l,d,i);i&&p.setFastWeightInitDuringBuild(!0),s.add(p)}}catch(f){c.e(f)}finally{c.f()}return s}}]),n}(Ys);Js.className="Sequential",a.Ze.registerClass(Js);var Qs=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(){return Object($r.a)(this,n),t.apply(this,arguments)}return Object(ea.a)(n,[{key:"getConfig",value:function(){return{}}}]),n}(a.Ze.Serializable),$s=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(){return Object($r.a)(this,n),t.apply(this,arguments)}return Object(ea.a)(n,[{key:"apply",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return mi(e,t)}}]),n}(Qs);$s.className="elu",a.Ze.registerClass($s);var eu=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(){return Object($r.a)(this,n),t.apply(this,arguments)}return Object(ea.a)(n,[{key:"apply",value:function(e){return a.Xe(e)}}]),n}(Qs);eu.className="selu",a.Ze.registerClass(eu);var tu=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(){return Object($r.a)(this,n),t.apply(this,arguments)}return Object(ea.a)(n,[{key:"apply",value:function(e){return a.Te(e)}}]),n}(Qs);tu.className="relu",a.Ze.registerClass(tu);var nu=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(){return Object($r.a)(this,n),t.apply(this,arguments)}return Object(ea.a)(n,[{key:"apply",value:function(e){return Object(a.wf)((function(){return a.De(6,a.Te(e))}))}}]),n}(Qs);nu.className="relu6",a.Ze.registerClass(nu);var ru=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(){return Object($r.a)(this,n),t.apply(this,arguments)}return Object(ea.a)(n,[{key:"apply",value:function(e){return e}}]),n}(Qs);ru.className="linear",a.Ze.registerClass(ru);var au=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(){return Object($r.a)(this,n),t.apply(this,arguments)}return Object(ea.a)(n,[{key:"apply",value:function(e){return a.bf(e)}}]),n}(Qs);au.className="sigmoid",a.Ze.registerClass(au);var iu=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(){return Object($r.a)(this,n),t.apply(this,arguments)}return Object(ea.a)(n,[{key:"apply",value:function(e){return function(e){return Object(a.wf)((function(){var t=a.sd(.5,a.Fe(.2,e));return a.Id(t,0,1)}))}(e)}}]),n}(Qs);iu.className="hardSigmoid",a.Ze.registerClass(iu);var ou=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(){return Object($r.a)(this,n),t.apply(this,arguments)}return Object(ea.a)(n,[{key:"apply",value:function(e){return a.jf(e)}}]),n}(Qs);ou.className="softplus",a.Ze.registerClass(ou);var su=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(){return Object($r.a)(this,n),t.apply(this,arguments)}return Object(ea.a)(n,[{key:"apply",value:function(e){return function(e){return Object(a.wf)((function(){return a.Xd(e,a.sd(a.rd(e),1))}))}(e)}}]),n}(Qs);su.className="softsign",a.Ze.registerClass(su);var uu=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(){return Object($r.a)(this,n),t.apply(this,arguments)}return Object(ea.a)(n,[{key:"apply",value:function(e){return a.rf(e)}}]),n}(Qs);uu.className="tanh",a.Ze.registerClass(uu);var cu=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(){return Object($r.a)(this,n),t.apply(this,arguments)}return Object(ea.a)(n,[{key:"apply",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return a.if(e,t)}}]),n}(Qs);cu.className="softmax",a.Ze.registerClass(cu);var lu=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(){return Object($r.a)(this,n),t.apply(this,arguments)}return Object(ea.a)(n,[{key:"apply",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return a.ue(e,t)}}]),n}(Qs);lu.className="logSoftmax",a.Ze.registerClass(lu);var du=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(){return Object($r.a)(this,n),t.apply(this,arguments)}return Object(ea.a)(n,[{key:"apply",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return Object(a.wf)((function(){return a.Fe(a.bf(a.Fe(e,t)),e)}))}}]),n}(Qs);du.className="swish",a.Ze.registerClass(du);var pu=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(){return Object($r.a)(this,n),t.apply(this,arguments)}return Object(ea.a)(n,[{key:"apply",value:function(e){return Object(a.wf)((function(){return a.Fe(e,a.rf(a.jf(e)))}))}}]),n}(Qs);function fu(e){return e.getClassName()}function hu(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return ka(e,a.Ze.SerializationMap.getMap().classNameMap,t,"activation")}function mu(e){if(null==e){var t={className:"linear",config:{}};return hu(t)}if("string"===typeof e){var n={};return n.className=e,n.config={},hu(n)}return e instanceof Qs?e:hu(e)}function vu(e){if(null!=e&&"object"!==typeof e)throw new Error("Argument to L1L2 regularizer's constructor is expected to be an "+"object, but received: ".concat(e))}pu.className="mish",a.Ze.registerClass(pu);var bu=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(){return Object($r.a)(this,n),t.apply(this,arguments)}return n}(a.Ze.Serializable),gu=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;return Object($r.a)(this,n),r=t.call(this),vu(e),r.l1=null==e||null==e.l1?.01:e.l1,r.l2=null==e||null==e.l2?.01:e.l2,r.hasL1=0!==r.l1,r.hasL2=0!==r.l2,r}return Object(ea.a)(n,[{key:"apply",value:function(e){var t=this;return Object(a.wf)((function(){var n=Object(a.If)([1]);return t.hasL1&&(n=Object(a.sd)(n,Object(a.pf)(a.Fe(t.l1,Object(a.rd)(e))))),t.hasL2&&(n=Object(a.sd)(n,Object(a.pf)(a.Fe(t.l2,pi(e))))),a.Ue(n,[])}))}},{key:"getConfig",value:function(){return{l1:this.l1,l2:this.l2}}}],[{key:"fromConfig",value:function(e,t){return new e({l1:t.l1,l2:t.l2})}}]),n}(bu);gu.className="L1L2",a.Ze.registerClass(gu);var yu={l1l2:"L1L2"};function xu(e){return ya(e)}function ku(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return ka(e,a.Ze.SerializationMap.getMap().classNameMap,t,"regularizer")}function wu(e){return null==e?null:"string"===typeof e?ku({className:e in yu?yu[e]:e,config:{}}):e instanceof bu?e:ku(e)}var Ou=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;return Object($r.a)(this,n),(r=t.call(this,null==e?{}:e)).supportsMasking=!0,null!=e&&(r.maxValue=e.maxValue),r}return Object(ea.a)(n,[{key:"call",value:function(e,t){e=Ui(e);var n=Object(a.Te)(e);return null!=this.maxValue&&(n=Object(a.Id)(n,0,this.maxValue)),n}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={maxValue:this.maxValue},t=Object(Fo.a)(Object(Mo.a)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}($i);Ou.className="ReLU",a.Ze.registerClass(Ou);var Iu=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;return Object($r.a)(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_ALPHA=.3,null==e&&(e={}),r.alpha=null==e.alpha?r.DEFAULT_ALPHA:e.alpha,r}return Object(ea.a)(n,[{key:"call",value:function(e,t){var n=Ui(e);return Object(a.qe)(n,this.alpha)}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={alpha:this.alpha},t=Object(Fo.a)(Object(Mo.a)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}($i);Iu.className="LeakyReLU",a.Ze.registerClass(Iu);var Su=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;if(Object($r.a)(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_ALPHA_INITIALIZER="zeros",null==e&&(e={}),r.supportsMasking=!0,r.alphaInitializer=Pi(e.alphaInitializer||r.DEFAULT_ALPHA_INITIALIZER),r.alphaRegularizer=wu(e.alphaRegularizer),r.alphaConstraint=yo(e.alphaConstraint),null==e.sharedAxes)r.sharedAxes=null;else if(Array.isArray(e.sharedAxes))r.sharedAxes=e.sharedAxes;else{if("number"!==typeof e.sharedAxes)throw new sa("Expected sharedAxes to be a number or an array of numbers, "+"but got ".concat(e.sharedAxes));r.sharedAxes=[e.sharedAxes]}return r}return Object(ea.a)(n,[{key:"build",value:function(e){var t=(e=Vi(e)).slice(1);if(null!=this.sharedAxes){var n,r=Object(Qr.a)(this.sharedAxes);try{for(r.s();!(n=r.n()).done;){t[n.value-1]=1}}catch(o){r.e(o)}finally{r.f()}}this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);var a={};if(null!=this.sharedAxes)for(var i=1;i<e.length;++i)a[i]=e[i];this.inputSpec=[new Xi({ndim:e.length,axes:a})],this.built=!0}},{key:"call",value:function(e,t){return e=Ui(e),Object(a.Oe)(e,this.alpha.read())}},{key:"getConfig",value:function(){var e={alphaInitializer:Li(this.alphaInitializer),alphaRegularizer:xu(this.alphaRegularizer),alphaConstraint:bo(this.alphaConstraint),sharedAxes:this.sharedAxes},t=Object(Fo.a)(Object(Mo.a)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}($i);Su.className="PReLU",a.Ze.registerClass(Su);var Nu=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;if(Object($r.a)(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_ALPHA=1,null==e&&(e={}),null!=e.alpha&&e.alpha!==r.DEFAULT_ALPHA)throw new ua("Non-default alpha value (".concat(e.alpha,") is not supported by the ")+"ELU layer yet.");return r.alpha=null==e.alpha?r.DEFAULT_ALPHA:e.alpha,r}return Object(ea.a)(n,[{key:"call",value:function(e,t){var n=Ui(e);return Object(a.Zd)(n)}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={alpha:this.alpha},t=Object(Fo.a)(Object(Mo.a)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}($i);Nu.className="ELU",a.Ze.registerClass(Nu);var ju=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;return Object($r.a)(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_THETA=1,null==e&&(e={}),r.theta=null==e.theta?r.DEFAULT_THETA:e.theta,r}return Object(ea.a)(n,[{key:"call",value:function(e,t){var n=Ui(e);return Object(a.Fe)(n,Object(a.Hd)(Object(a.ke)(n,this.theta),"float32"))}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={theta:this.theta},t=Object(Fo.a)(Object(Mo.a)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}($i);ju.className="ThresholdedReLU",a.Ze.registerClass(ju);var Tu=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;return Object($r.a)(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_AXIS=1,null==e&&(e={}),r.softmax=(new cu).apply,r.axis=null==e.axis?r.DEFAULT_AXIS:e.axis,r}return Object(ea.a)(n,[{key:"call",value:function(e,t){var n=Ui(e);return this.softmax(n,this.axis)}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={axis:this.axis},t=Object(Fo.a)(Object(Mo.a)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}($i);Tu.className="Softmax",a.Ze.registerClass(Tu);var Cu=n(58);function Eu(e,t,n){if("number"===typeof e)return da(e,t);if(e.length!==t)throw new sa("The ".concat(n," argument must be an integer or tuple of ").concat(t," integers.")+" Received: ".concat(e.length," elements."));for(var r=0;r<t;++r){var a=e[r];if((i=a)!==parseInt(i.toString(),10))throw new sa("The ".concat(n," argument must be an integer or tuple of ").concat(t)+" integers. Received: ".concat(JSON.stringify(e)," including a")+" non-integer number ".concat(a))}return e;var i}function _u(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;if(null==e)return e;var i,o=t+(t-1)*(a-1);return i="same"===n?e:e-o+1,Math.floor((i+r-1)/r)}function Au(e,t,n,r){if(null==e)return null;if("valid"===r)e=e*t+Ja([n-t,0]);else{if("same"!==r)throw new sa("Unsupport padding mode: ".concat(r,"."));e*=t}return e}function Ru(e,t){return Object(a.wf)((function(){return Pa(t),"channelsFirst"===t?a.zf(e,[0,2,3,1]):e}))}function Du(e,t){return Object(a.wf)((function(){return Pa(t),"channelsFirst"===t?a.zf(e,[0,2,3,4,1]):e}))}function Fu(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",o=arguments.length>5?arguments[5]:void 0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;return Object(a.wf)((function(){if(null==o&&(o="channelsLast"),Pa(o),3!==e.shape.length)throw new sa("The input of a conv1dWithBias operation should be 3, but is "+"".concat(e.shape.length," instead."));if(3!==t.shape.length)throw new sa("The kernel for a conv1dWithBias operation should be 3, but is "+"".concat(t.shape.length," instead"));if(null!=n&&1!==n.shape.length)throw new sa("The bias for a conv1dWithBias operation should be 1, but is "+"".concat(t.shape.length," instead"));if("channelsFirst"===o&&(e=a.zf(e,[0,2,1])),"causal"===i)throw new ua("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");var u=a.Pd(e,t,r,"same"===i?"same":"valid","NWC",s);return null!=n&&(u=hi(u,n)),u}))}function Mu(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",o=arguments.length>5?arguments[5]:void 0,s=arguments.length>6?arguments[6]:void 0,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;return Object(a.wf)((function(){if(null==o&&(o="channelsLast"),Pa(o),3!==e.rank&&4!==e.rank)throw new sa("conv2dWithBiasActivation expects input to be of rank 3 or 4, "+"but received ".concat(e.rank,"."));if(3!==t.rank&&4!==t.rank)throw new sa("conv2dWithBiasActivation expects kernel to be of rank 3 or 4, "+"but received ".concat(e.rank,"."));var c=Ru(e,o);if("causal"===i)throw new ua("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return c=a.ie.conv2d({x:c,filter:t,strides:r,pad:"same"===i?"same":"valid",dilations:s,dataFormat:"NHWC",bias:n,activation:u}),"channelsFirst"===o&&(c=a.zf(c,[0,3,1,2])),c}))}function zu(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",o=arguments.length>5?arguments[5]:void 0,s=arguments.length>6?arguments[6]:void 0;return Object(a.wf)((function(){if(null==o&&(o="channelsLast"),Pa(o),4!==e.rank&&5!==e.rank)throw new sa("conv3dWithBias expects input to be of rank 4 or 5, but received "+"".concat(e.rank,"."));if(4!==t.rank&&5!==t.rank)throw new sa("conv3dWithBias expects kernel to be of rank 4 or 5, but received "+"".concat(e.rank,"."));var u=Du(e,o);if("causal"===i)throw new ua("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return u=a.Sd(u,t,r,"same"===i?"same":"valid","NDHWC",s),null!=n&&(u=hi(u,n)),"channelsFirst"===o&&(u=a.zf(u,[0,4,1,2,3])),u}))}var Lu=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e,r){var a;if(Object($r.a)(this,n),(a=t.call(this,r)).bias=null,a.DEFAULT_KERNEL_INITIALIZER="glorotNormal",a.DEFAULT_BIAS_INITIALIZER="zeros",n.verifyArgs(r),a.rank=e,ja(a.rank,"rank"),1!==a.rank&&2!==a.rank&&3!==a.rank)throw new ua("Convolution layer for rank other than 1, 2, or 3 (".concat(a.rank,") is ")+"not implemented yet.");if(a.kernelSize=Eu(r.kernelSize,e,"kernelSize"),a.strides=Eu(null==r.strides?1:r.strides,e,"strides"),a.padding=null==r.padding?"valid":r.padding,Ba(a.padding),a.dataFormat=null==r.dataFormat?"channelsLast":r.dataFormat,Pa(a.dataFormat),a.activation=mu(r.activation),a.useBias=null==r.useBias||r.useBias,a.biasInitializer=Pi(r.biasInitializer||a.DEFAULT_BIAS_INITIALIZER),a.biasConstraint=yo(r.biasConstraint),a.biasRegularizer=wu(r.biasRegularizer),a.activityRegularizer=wu(r.activityRegularizer),a.dilationRate=Eu(null==r.dilationRate?1:r.dilationRate,e,"dilationRate"),1===a.rank&&Array.isArray(a.dilationRate)&&1!==a.dilationRate.length)throw new sa("dilationRate must be a number or an array of a single number for 1D convolution, but received "+"".concat(JSON.stringify(a.dilationRate)));if(2===a.rank){if("number"===typeof a.dilationRate)a.dilationRate=[a.dilationRate,a.dilationRate];else if(2!==a.dilationRate.length)throw new sa("dilationRate must be a number or array of two numbers for 2D "+"convolution, but received ".concat(JSON.stringify(a.dilationRate)))}else if(3===a.rank)if("number"===typeof a.dilationRate)a.dilationRate=[a.dilationRate,a.dilationRate,a.dilationRate];else if(3!==a.dilationRate.length)throw new sa("dilationRate must be a number or array of three numbers for 3D "+"convolution, but received ".concat(JSON.stringify(a.dilationRate)));return a}return Object(ea.a)(n,[{key:"getConfig",value:function(){var e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:fu(this.activation),useBias:this.useBias,biasInitializer:Li(this.biasInitializer),biasRegularizer:xu(this.biasRegularizer),activityRegularizer:xu(this.activityRegularizer),biasConstraint:bo(this.biasConstraint)},t=Object(Fo.a)(Object(Mo.a)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}],[{key:"verifyArgs",value:function(e){if(pa("kernelSize"in e,"required key 'kernelSize' not in config"),"number"!==typeof e.kernelSize&&!Na(e.kernelSize,"number",1,3))throw new sa("BaseConv expects config.kernelSize to be number or number[] with "+"length 1, 2, or 3, but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}($i),Pu=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e,r){var a;return Object($r.a)(this,n),(a=t.call(this,e,r)).kernel=null,n.verifyArgs(r),a.filters=r.filters,ja(a.filters,"filters"),a.kernelInitializer=Pi(r.kernelInitializer||a.DEFAULT_KERNEL_INITIALIZER),a.kernelConstraint=yo(r.kernelConstraint),a.kernelRegularizer=wu(r.kernelRegularizer),a}return Object(ea.a)(n,[{key:"build",value:function(e){e=Vi(e);var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new sa("The channel dimension of the input should be defined. "+"Found ".concat(e[t]));var n=e[t],r=this.kernelSize.concat([n,this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:Object(Cu.a)({},t,n)}],this.built=!0}},{key:"call",value:function(e,t){var n=this;return Object(a.wf)((function(){var t;e=Ui(e);var r=null==n.bias?null:n.bias.read(),a=Ta(n.activation.getClassName());if(null!=a&&2===n.rank)t=Mu(e,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate,a);else{if(1===n.rank)t=Fu(e,n.kernel.read(),r,n.strides[0],n.padding,n.dataFormat,n.dilationRate[0]);else if(2===n.rank)t=Mu(e,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate);else{if(3!==n.rank)throw new ua("convolutions greater than 3D are not implemented yet.");t=zu(e,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate)}null!=n.activation&&(t=n.activation.apply(t))}return t}))}},{key:"computeOutputShape",value:function(e){e=Vi(e);for(var t=[],n="channelsLast"===this.dataFormat?e.slice(1,e.length-1):e.slice(2),r=0;r<n.length;++r){var a=_u(n[r],this.kernelSize[r],this.padding,this.strides[r],"number"===typeof this.dilationRate?this.dilationRate:this.dilationRate[r]);t.push(a)}var i=[e[0]];return"channelsLast"===this.dataFormat?(i=i.concat(t)).push(this.filters):(i.push(this.filters),i=i.concat(t)),i}},{key:"getConfig",value:function(){var e={filters:this.filters,kernelInitializer:Li(this.kernelInitializer),kernelRegularizer:xu(this.kernelRegularizer),kernelConstraint:bo(this.kernelConstraint)},t=Object(Fo.a)(Object(Mo.a)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}],[{key:"verifyArgs",value:function(e){if(!("filters"in e)||"number"!==typeof e.filters||e.filters<1)throw new sa("Convolution layer expected config.filters to be a 'number' > 0 "+"but got ".concat(JSON.stringify(e.filters)))}}]),n}(Lu),Bu=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;return Object($r.a)(this,n),r=t.call(this,2,e),n.verifyArgs(e),r}return Object(ea.a)(n,[{key:"getConfig",value:function(){var e=Object(Fo.a)(Object(Mo.a)(n.prototype),"getConfig",this).call(this);return delete e.rank,e}}],[{key:"verifyArgs",value:function(e){if("number"!==typeof e.kernelSize&&!Na(e.kernelSize,"number",1,2))throw new sa("Conv2D expects config.kernelSize to be number or number[] with "+"length 1 or 2, but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(Pu);Bu.className="Conv2D",a.Ze.registerClass(Bu);var Wu=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;return Object($r.a)(this,n),r=t.call(this,3,e),n.verifyArgs(e),r}return Object(ea.a)(n,[{key:"getConfig",value:function(){var e=Object(Fo.a)(Object(Mo.a)(n.prototype),"getConfig",this).call(this);return delete e.rank,e}}],[{key:"verifyArgs",value:function(e){if("number"!==typeof e.kernelSize&&(!Array.isArray(e.kernelSize)||1!==e.kernelSize.length&&3!==e.kernelSize.length))throw new sa("Conv3D expects config.kernelSize to be number or"+" [number, number, number], but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(Pu);Wu.className="Conv3D",a.Ze.registerClass(Wu);var Uu=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;if(Object($r.a)(this,n),(r=t.call(this,e)).inputSpec=[new Xi({ndim:4})],"same"!==r.padding&&"valid"!==r.padding)throw new sa("Conv2DTranspose currently supports only padding modes 'same' "+"and 'valid', but received padding mode ".concat(r.padding));return r}return Object(ea.a)(n,[{key:"build",value:function(e){if(4!==(e=Vi(e)).length)throw new sa("Input should have rank 4; Received input shape: "+JSON.stringify(e));var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new sa("The channel dimension of the inputs should be defined. Found `None`.");var n=e[t],r=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Xi({ndim:4,axes:Object(Cu.a)({},t,n)})],this.built=!0}},{key:"call",value:function(e,t){var n=this;return a.wf((function(){var t=Ui(e);if(4!==t.shape.length)throw new sa("Conv2DTranspose.call() expects input tensor to be rank-4, but "+"received a tensor of rank-".concat(t.shape.length));var r,i,o=t.shape,s=o[0];"channelsFirst"===n.dataFormat?(r=2,i=3):(r=1,i=2);var u=o[r],c=o[i],l=n.kernelSize[0],d=n.kernelSize[1],p=n.strides[0],f=n.strides[1],h=[s,Au(u,p,l,n.padding),Au(c,f,d,n.padding),n.filters];"channelsLast"!==n.dataFormat&&(t=a.zf(t,[0,2,3,1]));var m=a.Rd(t,n.kernel.read(),h,n.strides,n.padding);return"channelsLast"!==n.dataFormat&&(m=a.zf(m,[0,3,1,2])),null!=n.bias&&(m=hi(m,n.bias.read(),n.dataFormat)),null!=n.activation&&(m=n.activation.apply(m)),m}))}},{key:"computeOutputShape",value:function(e){var t,n,r,a=(e=Vi(e)).slice();"channelsFirst"===this.dataFormat?(t=1,n=2,r=3):(t=3,n=1,r=2);var i=this.kernelSize[0],o=this.kernelSize[1],s=this.strides[0],u=this.strides[1];return a[t]=this.filters,a[n]=Au(a[n],s,i,this.padding),a[r]=Au(a[r],u,o,this.padding),a}},{key:"getConfig",value:function(){var e=Object(Fo.a)(Object(Mo.a)(n.prototype),"getConfig",this).call(this);return delete e.dilationRate,e}}]),n}(Bu);Uu.className="Conv2DTranspose",a.Ze.registerClass(Uu);var Vu=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;if(Object($r.a)(this,n),(r=t.call(this,e)).inputSpec=[new Xi({ndim:5})],"same"!==r.padding&&"valid"!==r.padding)throw new sa("Conv3DTranspose currently supports only padding modes 'same' "+"and 'valid', but received padding mode ".concat(r.padding));return r}return Object(ea.a)(n,[{key:"build",value:function(e){if(5!==(e=Vi(e)).length)throw new sa("Input should have rank 5; Received input shape: "+JSON.stringify(e));var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new sa("The channel dimension of the inputs should be defined. Found `None`.");var n=e[t],r=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Xi({ndim:5,axes:Object(Cu.a)({},t,n)})],this.built=!0}},{key:"call",value:function(e,t){var n=this;return a.wf((function(){var t=Ui(e);if(5!==t.shape.length)throw new sa("Conv3DTranspose.call() expects input tensor to be rank-4, but "+"received a tensor of rank-".concat(t.shape.length));var r,i,o,s=t.shape,u=s[0];"channelsFirst"===n.dataFormat?(o=2,r=3,i=4):(o=1,r=2,i=3);var c=s[o],l=s[r],d=s[i],p=n.kernelSize[0],f=n.kernelSize[1],h=n.kernelSize[2],m=n.strides[0],v=n.strides[1],b=n.strides[2],g=[u,Au(c,m,p,n.padding),Au(l,v,f,n.padding),Au(d,b,h,n.padding),n.filters];"channelsLast"!==n.dataFormat&&(t=a.zf(t,[0,2,3,4,1]));var y=a.Td(t,n.kernel.read(),g,n.strides,n.padding);return"channelsLast"!==n.dataFormat&&(y=a.zf(y,[0,4,1,2,3])),null!==n.bias&&(y=hi(y,n.bias.read(),n.dataFormat)),null!==n.activation&&(y=n.activation.apply(y)),y}))}},{key:"computeOutputShape",value:function(e){var t,n,r,a,i=(e=Vi(e)).slice();"channelsFirst"===this.dataFormat?(t=1,n=2,r=3,a=4):(t=4,n=1,r=2,a=3);var o=this.kernelSize[0],s=this.kernelSize[1],u=this.kernelSize[2],c=this.strides[0],l=this.strides[1],d=this.strides[2];return i[t]=this.filters,i[n]=Au(i[n],c,o,this.padding),i[r]=Au(i[r],l,s,this.padding),i[a]=Au(i[a],d,u,this.padding),i}},{key:"getConfig",value:function(){var e=Object(Fo.a)(Object(Mo.a)(n.prototype),"getConfig",this).call(this);return delete e.dilationRate,e}}]),n}(Wu);Vu.className="Conv3DTranspose",a.Ze.registerClass(Vu);var Gu=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e,r){var a;if(Object($r.a)(this,n),(a=t.call(this,e,r)).DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",a.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",a.depthwiseKernel=null,a.pointwiseKernel=null,null==r.filters)throw new sa("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(null!=r.kernelInitializer||null!=r.kernelRegularizer||null!=r.kernelConstraint)throw new sa("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(null!=r.padding&&"same"!==r.padding&&"valid"!==r.padding)throw new sa("SeparableConv".concat(a.rank,"D supports only padding modes: ")+"'same' and 'valid', but received ".concat(JSON.stringify(r.padding)));return a.depthMultiplier=null==r.depthMultiplier?1:r.depthMultiplier,a.depthwiseInitializer=Pi(r.depthwiseInitializer||a.DEFAULT_DEPTHWISE_INITIALIZER),a.depthwiseRegularizer=wu(r.depthwiseRegularizer),a.depthwiseConstraint=yo(r.depthwiseConstraint),a.pointwiseInitializer=Pi(r.depthwiseInitializer||a.DEFAULT_POINTWISE_INITIALIZER),a.pointwiseRegularizer=wu(r.pointwiseRegularizer),a.pointwiseConstraint=yo(r.pointwiseConstraint),a}return Object(ea.a)(n,[{key:"build",value:function(e){if((e=Vi(e)).length<this.rank+2)throw new sa("Inputs to SeparableConv".concat(this.rank,"D should have rank ")+"".concat(this.rank+2,", but received input shape: ")+"".concat(JSON.stringify(e)));var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t]||e[t]<0)throw new sa("The channel dimension of the inputs should be defined, "+"but found ".concat(JSON.stringify(e[t])));for(var n=e[t],r=this.kernelSize.concat([n,this.depthMultiplier]),a=[],i=0;i<this.rank;++i)a.push(1);a.push(n*this.depthMultiplier,this.filters);this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",a,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,!0,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.inputSpec=[new Xi({ndim:this.rank+2,axes:Object(Cu.a)({},t,n)})],this.built=!0}},{key:"call",value:function(e,t){var n=this;return Object(a.wf)((function(){var t;if(e=Ui(e),1===n.rank)throw new ua("1D separable convolution is not implemented yet.");return 2===n.rank&&("channelsFirst"===n.dataFormat&&(e=a.zf(e,[0,2,3,1])),t=a.Ye(e,n.depthwiseKernel.read(),n.pointwiseKernel.read(),n.strides,n.padding,n.dilationRate,"NHWC")),n.useBias&&(t=hi(t,n.bias.read(),n.dataFormat)),null!=n.activation&&(t=n.activation.apply(t)),"channelsFirst"===n.dataFormat&&(t=a.zf(t,[0,3,1,2])),t}))}},{key:"getConfig",value:function(){var e=Object(Fo.a)(Object(Mo.a)(n.prototype),"getConfig",this).call(this);return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=Li(this.depthwiseInitializer),e.pointwiseInitializer=Li(this.pointwiseInitializer),e.depthwiseRegularizer=xu(this.depthwiseRegularizer),e.pointwiseRegularizer=xu(this.pointwiseRegularizer),e.depthwiseConstraint=bo(this.depthwiseConstraint),e.pointwiseConstraint=bo(this.pointwiseConstraint),e}}]),n}(Pu);Gu.className="SeparableConv";var Hu=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){return Object($r.a)(this,n),t.call(this,2,e)}return n}(Gu);Hu.className="SeparableConv2D",a.Ze.registerClass(Hu);var qu=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;return Object($r.a)(this,n),r=t.call(this,1,e),n.verifyArgs(e),r.inputSpec=[{ndim:3}],r}return Object(ea.a)(n,[{key:"getConfig",value:function(){var e=Object(Fo.a)(Object(Mo.a)(n.prototype),"getConfig",this).call(this);return delete e.rank,delete e.dataFormat,e}}],[{key:"verifyArgs",value:function(e){if("number"!==typeof e.kernelSize&&!Na(e.kernelSize,"number",1,1))throw new sa("Conv1D expects config.kernelSize to be number or number[] with "+"length 1, but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(Pu);qu.className="Conv1D",a.Ze.registerClass(qu);var Ku=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;return Object($r.a)(this,n),r=t.call(this,e),"number"===typeof e.cropping?r.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:"number"===typeof e.cropping[0]?r.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:r.cropping=e.cropping,r.dataFormat=void 0===e.dataFormat?"channelsLast":e.dataFormat,r.inputSpec=[{ndim:4}],r}return Object(ea.a)(n,[{key:"computeOutputShape",value:function(e){return"channelsFirst"===this.dataFormat?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}},{key:"call",value:function(e,t){var n=this;return Object(a.wf)((function(){if(e=Ui(e),"channelsLast"===n.dataFormat){var t=ii(e,n.cropping[0][0],e.shape[1]-n.cropping[0][0]-n.cropping[0][1],2);return ii(t,n.cropping[1][0],e.shape[2]-n.cropping[1][1]-n.cropping[1][0],3)}var r=ii(e,n.cropping[0][0],e.shape[2]-n.cropping[0][0]-n.cropping[0][1],3);return ii(r,n.cropping[1][0],e.shape[3]-n.cropping[1][1]-n.cropping[1][0],4)}))}},{key:"getConfig",value:function(){var e={cropping:this.cropping,dataFormat:this.dataFormat},t=Object(Fo.a)(Object(Mo.a)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}($i);Ku.className="Cropping2D",a.Ze.registerClass(Ku);var Xu=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r,a;return Object($r.a)(this,n),(r=t.call(this,e)).DEFAULT_SIZE=[2,2],r.inputSpec=[{ndim:4}],r.size=null==e.size?r.DEFAULT_SIZE:e.size,r.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,Pa(r.dataFormat),r.interpolation=null==e.interpolation?"nearest":e.interpolation,a=r.interpolation,Sa(Da,"InterpolationFormat",a),r}return Object(ea.a)(n,[{key:"computeOutputShape",value:function(e){if("channelsFirst"===this.dataFormat){var t=null==e[2]?null:this.size[0]*e[2],n=null==e[3]?null:this.size[1]*e[3];return[e[0],e[1],t,n]}var r=null==e[1]?null:this.size[0]*e[1],a=null==e[2]?null:this.size[1]*e[2];return[e[0],r,a,e[3]]}},{key:"call",value:function(e,t){var n=this;return a.wf((function(){var t=Ui(e),r=t.shape;if("channelsFirst"===n.dataFormat){t=a.zf(t,[0,2,3,1]);var i=n.size[0]*r[2],o=n.size[1]*r[3],s="nearest"===n.interpolation?a.me.resizeNearestNeighbor(t,[i,o]):a.me.resizeBilinear(t,[i,o]);return a.zf(s,[0,3,1,2])}var u=n.size[0]*r[1],c=n.size[1]*r[2];return"nearest"===n.interpolation?a.me.resizeNearestNeighbor(t,[u,c]):a.me.resizeBilinear(t,[u,c])}))}},{key:"getConfig",value:function(){var e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},t=Object(Fo.a)(Object(Mo.a)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}($i);Xu.className="UpSampling2D",a.Ze.registerClass(Xu);var Yu=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;return Object($r.a)(this,n),(r=t.call(this,2,e)).depthwiseKernel=null,r.depthMultiplier=null==e.depthMultiplier?1:e.depthMultiplier,r.depthwiseInitializer=Pi(e.depthwiseInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.depthwiseConstraint=yo(e.depthwiseConstraint),r.depthwiseRegularizer=wu(e.depthwiseRegularizer),r}return Object(ea.a)(n,[{key:"build",value:function(e){if((e=Vi(e)).length<4)throw new sa("Inputs to DepthwiseConv2D should have rank 4. "+"Received input shape: ".concat(JSON.stringify(e),"."));var t="channelsFirst"===this.dataFormat?1:3;if(null==e[t]||e[t]<0)throw new sa("The channel dimension of the inputs to DepthwiseConv2D should "+"be defined, but is not (".concat(e[t],")."));var n=e[t],r=[this.kernelSize[0],this.kernelSize[1],n,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[n*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}},{key:"call",value:function(e,t){var n=this;return Object(a.wf)((function(){var t=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[1,1],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"valid",i=arguments.length>4?arguments[4]:void 0,o=arguments.length>5?arguments[5]:void 0;return Object(a.wf)((function(){null==i&&(i="channelsLast"),Pa(i);var s=Ru(e,i);if(4!==e.rank)throw new sa("Input for depthwiseConv2d is required to be 4-D, but is instead "+"".concat(e.rank,"-D"));if(4!==t.rank)throw new sa("depthwiseKernel is required to be 4-D, but is instead "+"".concat(t.rank,"-D"));return s=a.Ud(s,t,n,"same"===r?"same":"valid","NHWC",o),"channelsFirst"===i&&(s=a.zf(s,[0,3,1,2])),s}))}(e=Ui(e),n.depthwiseKernel.read(),n.strides,n.padding,n.dataFormat,null);return n.useBias&&(t=hi(t,n.bias.read(),n.dataFormat)),null!=n.activation&&(t=n.activation.apply(t)),t}))}},{key:"computeOutputShape",value:function(e){e=Vi(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],r="channelsFirst"===this.dataFormat?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,a=_u(t,this.kernelSize[0],this.padding,this.strides[0]),i=_u(n,this.kernelSize[1],this.padding,this.strides[1]);return"channelsFirst"===this.dataFormat?[e[0],r,a,i]:[e[0],a,i,r]}},{key:"getConfig",value:function(){var e=Object(Fo.a)(Object(Mo.a)(n.prototype),"getConfig",this).call(this);return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=Li(this.depthwiseInitializer),e.depthwiseRegularizer=xu(this.depthwiseRegularizer),e.depthwiseConstraint=bo(this.depthwiseRegularizer),e}}]),n}(Lu);function Zu(e,t,n,r){if(Array.isArray(e)){if(null!=t||null!=n)throw new sa("When inputs is an array, neither initialState or constants should be provided");null!=r&&(n=e.slice(e.length-r,e.length),e=e.slice(0,e.length-r)),e.length>1&&(t=e.slice(1,e.length)),e=e[0]}function a(e){return null==e||Array.isArray(e)?e:[e]}return{inputs:e,initialState:t=a(t),constants:n=a(n)}}function Ju(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4?arguments[4]:void 0,o=arguments.length>5?arguments[5]:void 0,s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],u=arguments.length>7&&void 0!==arguments[7]&&arguments[7];return a.wf((function(){var c=t.shape.length;if(c<3)throw new sa("Input should be at least 3D, but is ".concat(c,"D."));var l=[1,0].concat(Qa(2,c));if(t=a.zf(t,l),null!=o)throw new ua("The rnn() functoin of the deeplearn.js backend does not support constants yet.");s&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),null!=i&&((i=a.Hd(a.Hd(i,"bool"),"float32")).rank===c-1&&(i=a.ee(i,-1)),i=a.zf(i,l)),r&&(t=a.Ve(t,0),null!=i&&(i=a.Ve(i,0)));var d,p,f=[],h=n,m=t.shape[0],v=a.Bf(t);null!=i&&(p=a.Bf(i));for(var b,g=function(t){var n=v[t],r=a.wf((function(){return e(n,h)}));if(null==i)d=r[0],h=r[1];else{var o=a.wf((function(){var e=p[t],n=a.of(a.Le(e),e);return{output:a.sd(a.Fe(r[0],e),a.Fe(h[0],n)),newStates:h.map((function(t,i){return a.sd(a.Fe(r[1][i],e),a.Fe(t,n))}))}}));d=o.output,h=o.newStates}u&&f.push(d)},y=0;y<m;++y)g(y);if(u){b=a.nf(f,1)}return[d,b,h]}))}Yu.className="DepthwiseConv2D",a.Ze.registerClass(Yu);var Qu=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r,a;if(Object($r.a)(this,n),r=t.call(this,e),null==e.cell)throw new sa("cell property is missing for the constructor of RNN.");if(null==(a=Array.isArray(e.cell)?new oc({cells:e.cell}):e.cell).stateSize)throw new sa("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");return r.cell=a,r.returnSequences=null!=e.returnSequences&&e.returnSequences,r.returnState=null!=e.returnState&&e.returnState,r.goBackwards=null!=e.goBackwards&&e.goBackwards,r._stateful=null!=e.stateful&&e.stateful,r.unroll=null!=e.unroll&&e.unroll,r.supportsMasking=!0,r.inputSpec=[new Xi({ndim:3})],r.stateSpec=null,r.states_=null,r.numConstants=null,r.keptStates=[],r}return Object(ea.a)(n,[{key:"getStates",value:function(){return null==this.states_?Qa(0,Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1).map((function(e){return null})):this.states_}},{key:"setStates",value:function(e){this.states_=e}},{key:"computeOutputShape",value:function(e){Bi(e)&&(e=e[0]),e=e;var t=this.cell.stateSize;Array.isArray(t)||(t=[t]);var n,r=t[0];if(n=this.returnSequences?[e[0],e[1],r]:[e[0],r],this.returnState){var a,i=[],o=Object(Qr.a)(t);try{for(o.s();!(a=o.n()).done;){var s=a.value;i.push([e[0],s])}}catch(u){o.e(u)}finally{o.f()}return[n].concat(i)}return n}},{key:"computeMask",value:function(e,t){var n=this;return a.wf((function(){Array.isArray(t)&&(t=t[0]);var e=n.returnSequences?t:null;if(n.returnState){var r=n.states.map((function(e){return null}));return[e].concat(r)}return e}))}},{key:"build",value:function(e){if(null!=this.numConstants)throw new ua("Constants support is not implemented in RNN yet.");Bi(e)&&(e=e[0]),e=e;var t=this.stateful?e[0]:null,n=e.slice(2);this.inputSpec[0]=new Xi({shape:[t,null].concat(Object(qn.a)(n))});var r,i=[e[0]].concat(e.slice(2));if(this.cell.build(i),r=Array.isArray(this.cell.stateSize)?this.cell.stateSize:[this.cell.stateSize],null!=this.stateSpec){if(!a.Df.arraysEqual(this.stateSpec.map((function(e){return e.shape[e.shape.length-1]})),r))throw new sa("An initialState was passed that is not compatible with "+"cell.stateSize. Received stateSpec=".concat(this.stateSpec,"; ")+"However cell.stateSize is ".concat(this.cell.stateSize))}else this.stateSpec=r.map((function(e){return new Xi({shape:[null,e]})}));this.stateful&&this.resetStates()}},{key:"resetStates",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Object(a.wf)((function(){if(!t.stateful)throw new ia("Cannot call resetStates() on an RNN Layer that is not stateful.");var r=t.inputSpec[0].shape[0];if(null==r)throw new sa("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==t.states_)Array.isArray(t.cell.stateSize)?t.states_=t.cell.stateSize.map((function(e){return a.If([r,e])})):t.states_=[a.If([r,t.cell.stateSize])];else if(null==e)a.Wd(t.states_),null!=t.keptStates&&(a.Wd(t.keptStates),t.keptStates=[]),Array.isArray(t.cell.stateSize)?t.states_=t.cell.stateSize.map((function(e){return a.If([r,e])})):t.states_[0]=a.If([r,t.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==t.states_.length)throw new sa("Layer ".concat(t.name," expects ").concat(t.states_.length," state(s), ")+"but it received ".concat(e.length," state value(s). Input ")+"received: ".concat(e));!0===n?t.keptStates.push(t.states_.slice()):a.Wd(t.states_);for(var i=0;i<t.states_.length;++i){var o=e[i],s=Array.isArray(t.cell.stateSize)?t.cell.stateSize[i]:t.cell.stateSize,u=[r,s];if(!a.Df.arraysEqual(o.shape,u))throw new sa("State ".concat(i," is incompatible with layer ").concat(t.name,": ")+"expected shape=".concat(u,", received shape=").concat(o.shape));t.states_[i]=o}}t.states_=t.states_.map((function(e){return a.oe(e.clone())}))}))}},{key:"apply",value:function(e,t){var r=null==t?null:t.initialState,a=null==t?null:t.constants;null==t&&(t={});var i=Zu(e,r,a,this.numConstants);e=i.inputs,r=i.initialState,a=i.constants;var o=[],s=[];if(null!=r){t.initialState=r,o=o.concat(r),this.stateSpec=[];var u,c=Object(Qr.a)(r);try{for(c.s();!(u=c.n()).done;){var l=u.value;this.stateSpec.push(new Xi({shape:l.shape}))}}catch(m){c.e(m)}finally{c.f()}s=s.concat(this.stateSpec)}if(null!=a&&(t.constants=a,o=o.concat(a),this.numConstants=a.length),o[0]instanceof Yi){var d=[e].concat(o),p=this.inputSpec.concat(s),f=this.inputSpec;this.inputSpec=p;var h=Object(Fo.a)(Object(Mo.a)(n.prototype),"apply",this).call(this,d,t);return this.inputSpec=f,h}return Object(Fo.a)(Object(Mo.a)(n.prototype),"apply",this).call(this,e,t)}},{key:"call",value:function(e,t){var n=this;return Object(a.wf)((function(){var r=null==t?null:t.mask,a=null==t?null:t.training,i=null==t?null:t.initialState;e=Ui(e),null==i&&(i=n.stateful?n.states_:n.getInitialState(e));var o=Array.isArray(n.cell.stateSize)?n.cell.stateSize.length:1;if(i.length!==o)throw new sa("RNN Layer has ".concat(o," state(s) but was passed ")+"".concat(i.length," initial state(s)."));n.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");var s={training:a},u=Ju((function(e,t){var r=n.cell.call([e].concat(t),s);return[r[0],r.slice(1)]}),e,i,n.goBackwards,r,null,n.unroll,n.returnSequences),c=u[0],l=u[1],d=u[2];n.stateful&&n.resetStates(d,a);var p=n.returnSequences?l:c;return n.returnState?[p].concat(d):p}))}},{key:"getInitialState",value:function(e){var t=this;return Object(a.wf)((function(){var n=a.If(e.shape);return n=ti(n=a.pf(n,[1,2])),Array.isArray(t.cell.stateSize)?t.cell.stateSize.map((function(e){return e>1?ui(n,[1,e]):n})):t.cell.stateSize>1?[ui(n,[1,t.cell.stateSize])]:[n]}))}},{key:"setFastWeightInitDuringBuild",value:function(e){Object(Fo.a)(Object(Mo.a)(n.prototype),"setFastWeightInitDuringBuild",this).call(this,e),null!=this.cell&&this.cell.setFastWeightInitDuringBuild(e)}},{key:"getConfig",value:function(){var e=Object(Fo.a)(Object(Mo.a)(n.prototype),"getConfig",this).call(this),t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};null!=this.numConstants&&(t.numConstants=this.numConstants);var r=this.cell.getConfig();return this.getClassName()===n.className&&(t.cell={className:this.cell.getClassName(),config:r}),Object.assign({},r,e,t)}},{key:"states",get:function(){if(null==this.states_){for(var e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,t=[],n=0;n<e;++n)t.push(null);return t}return this.states_},set:function(e){this.states_=e}},{key:"trainableWeights",get:function(){return this.trainable?this.cell.trainableWeights:[]}},{key:"nonTrainableWeights",get:function(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}}],[{key:"fromConfig",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=t.cell,a=zo(r,n);return new e(Object.assign(t,{cell:a}))}}]),n}($i);Qu.className="RNN",a.Ze.registerClass(Qu);var $u=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(){return Object($r.a)(this,n),t.apply(this,arguments)}return n}($i),ec=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;return Object($r.a)(this,n),(r=t.call(this,e)).DEFAULT_ACTIVATION="tanh",r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_RECURRENT_INITIALIZER="orthogonal",r.DEFAULT_BIAS_INITIALIZER="zeros",r.units=e.units,ja(r.units,"units"),r.activation=mu(null==e.activation?r.DEFAULT_ACTIVATION:e.activation),r.useBias=null==e.useBias||e.useBias,r.kernelInitializer=Pi(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.recurrentInitializer=Pi(e.recurrentInitializer||r.DEFAULT_RECURRENT_INITIALIZER),r.biasInitializer=Pi(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.kernelRegularizer=wu(e.kernelRegularizer),r.recurrentRegularizer=wu(e.recurrentRegularizer),r.biasRegularizer=wu(e.biasRegularizer),r.kernelConstraint=yo(e.kernelConstraint),r.recurrentConstraint=yo(e.recurrentConstraint),r.biasConstraint=yo(e.biasConstraint),r.dropout=Za([1,Ja([0,null==e.dropout?0:e.dropout])]),r.recurrentDropout=Za([1,Ja([0,null==e.recurrentDropout?0:e.recurrentDropout])]),r.dropoutFunc=e.dropoutFunc,r.stateSize=r.units,r.dropoutMask=null,r.recurrentDropoutMask=null,r}return Object(ea.a)(n,[{key:"build",value:function(e){e=Vi(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}},{key:"call",value:function(e,t){var n=this;return Object(a.wf)((function(){if(2!==(e=e).length)throw new sa("SimpleRNNCell expects 2 input Tensors, got ".concat(e.length,"."));var r=e[1];e=e[0];var i,o=null!=t.training&&t.training;0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=sc({ones:function(){return a.Le(e)},rate:n.dropout,training:o,dropoutFunc:n.dropoutFunc})),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=sc({ones:function(){return a.Le(r)},rate:n.recurrentDropout,training:o,dropoutFunc:n.dropoutFunc}));var s=n.dropoutMask,u=n.recurrentDropoutMask;i=li(null!=s?a.Fe(e,s):e,n.kernel.read()),null!=n.bias&&(i=hi(i,n.bias.read())),null!=u&&(r=a.Fe(r,u));var c=a.sd(i,li(r,n.recurrentKernel.read()));return null!=n.activation&&(c=n.activation.apply(c)),[c,c]}))}},{key:"getConfig",value:function(){var e=Object(Fo.a)(Object(Mo.a)(n.prototype),"getConfig",this).call(this),t={units:this.units,activation:fu(this.activation),useBias:this.useBias,kernelInitializer:Li(this.kernelInitializer),recurrentInitializer:Li(this.recurrentInitializer),biasInitializer:Li(this.biasInitializer),kernelRegularizer:xu(this.kernelRegularizer),recurrentRegularizer:xu(this.recurrentRegularizer),biasRegularizer:xu(this.biasRegularizer),activityRegularizer:xu(this.activityRegularizer),kernelConstraint:bo(this.kernelConstraint),recurrentConstraint:bo(this.recurrentConstraint),biasConstraint:bo(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign({},e,t)}}]),n}($u);ec.className="SimpleRNNCell",a.Ze.registerClass(ec);var tc=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){return Object($r.a)(this,n),e.cell=new ec(e),t.call(this,e)}return Object(ea.a)(n,[{key:"call",value:function(e,t){var r=this;return Object(a.wf)((function(){null!=r.cell.dropoutMask&&(a.Wd(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(a.Wd(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null);var i=null==t?null:t.mask,o=null==t?null:t.training,s=null==t?null:t.initialState;return Object(Fo.a)(Object(Mo.a)(n.prototype),"call",r).call(r,e,{mask:i,training:o,initialState:s})}))}}],[{key:"fromConfig",value:function(e,t){return new e(t)}}]),n}(Qu);tc.className="SimpleRNN",a.Ze.registerClass(tc);var nc=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;if(Object($r.a)(this,n),(r=t.call(this,e)).DEFAULT_ACTIVATION="tanh",r.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_RECURRENT_INITIALIZER="orthogonal",r.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new sa("GRUCell does not support reset_after parameter set to true.");return r.units=e.units,ja(r.units,"units"),r.activation=mu(void 0===e.activation?r.DEFAULT_ACTIVATION:e.activation),r.recurrentActivation=mu(void 0===e.recurrentActivation?r.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),r.useBias=null==e.useBias||e.useBias,r.kernelInitializer=Pi(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.recurrentInitializer=Pi(e.recurrentInitializer||r.DEFAULT_RECURRENT_INITIALIZER),r.biasInitializer=Pi(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.kernelRegularizer=wu(e.kernelRegularizer),r.recurrentRegularizer=wu(e.recurrentRegularizer),r.biasRegularizer=wu(e.biasRegularizer),r.kernelConstraint=yo(e.kernelConstraint),r.recurrentConstraint=yo(e.recurrentConstraint),r.biasConstraint=yo(e.biasConstraint),r.dropout=Za([1,Ja([0,null==e.dropout?0:e.dropout])]),r.recurrentDropout=Za([1,Ja([0,null==e.recurrentDropout?0:e.recurrentDropout])]),r.dropoutFunc=e.dropoutFunc,r.implementation=e.implementation,r.stateSize=r.units,r.dropoutMask=null,r.recurrentDropoutMask=null,r}return Object(ea.a)(n,[{key:"build",value:function(e){var t=(e=Vi(e))[e.length-1];this.kernel=this.addWeight("kernel",[t,3*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,3*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[3*this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}},{key:"call",value:function(e,t){var n=this;return Object(a.wf)((function(){if(2!==(e=e).length)throw new sa("GRUCell expects 2 input Tensors (inputs, h, c), got "+"".concat(e.length,"."));var r=null!=t.training&&t.training,o=e[1];e=e[0],0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=sc({ones:function(){return a.Le(e)},rate:n.dropout,training:r,count:3,dropoutFunc:n.dropoutFunc})),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=sc({ones:function(){return a.Le(o)},rate:n.recurrentDropout,training:r,count:3,dropoutFunc:n.dropoutFunc}));var s,u,c,l=n.dropoutMask,d=n.recurrentDropoutMask;0<n.dropout&&n.dropout<1&&(e=a.Fe(e,l[0]));var p=li(e,n.kernel.read());n.useBias&&(p=hi(p,n.bias.read())),0<n.recurrentDropout&&n.recurrentDropout<1&&(o=a.Fe(o,d[0]));var f=n.recurrentKernel.read(),h=a.kf(f,[2*n.units,n.units],f.rank-1),m=Object(i.a)(h,2),v=m[0],b=m[1],g=li(o,v),y=a.kf(p,3,p.rank-1),x=Object(i.a)(y,3),k=x[0],w=x[1],O=x[2],I=a.kf(g,2,g.rank-1),S=Object(i.a)(I,2),N=S[0],j=S[1];s=n.recurrentActivation.apply(a.sd(k,N)),u=n.recurrentActivation.apply(a.sd(w,j));var T=li(a.Fe(u,o),b);c=n.activation.apply(a.sd(O,T));var C=a.sd(a.Fe(s,o),a.Fe(a.sd(1,a.Ge(s)),c));return[C,C]}))}},{key:"getConfig",value:function(){var e=Object(Fo.a)(Object(Mo.a)(n.prototype),"getConfig",this).call(this),t={units:this.units,activation:fu(this.activation),recurrentActivation:fu(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Li(this.kernelInitializer),recurrentInitializer:Li(this.recurrentInitializer),biasInitializer:Li(this.biasInitializer),kernelRegularizer:xu(this.kernelRegularizer),recurrentRegularizer:xu(this.recurrentRegularizer),biasRegularizer:xu(this.biasRegularizer),activityRegularizer:xu(this.activityRegularizer),kernelConstraint:bo(this.kernelConstraint),recurrentConstraint:bo(this.recurrentConstraint),biasConstraint:bo(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign({},e,t)}}]),n}($u);nc.className="GRUCell",a.Ze.registerClass(nc);var rc=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){return Object($r.a)(this,n),0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new nc(e),t.call(this,e)}return Object(ea.a)(n,[{key:"call",value:function(e,t){var r=this;return Object(a.wf)((function(){null!=r.cell.dropoutMask&&(a.Wd(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(a.Wd(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null);var i=null==t?null:t.mask,o=null==t?null:t.training,s=null==t?null:t.initialState;return Object(Fo.a)(Object(Mo.a)(n.prototype),"call",r).call(r,e,{mask:i,training:o,initialState:s})}))}}],[{key:"fromConfig",value:function(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)}}]),n}(Qu);rc.className="GRU",a.Ze.registerClass(rc);var ac=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;return Object($r.a)(this,n),(r=t.call(this,e)).DEFAULT_ACTIVATION="tanh",r.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_RECURRENT_INITIALIZER="orthogonal",r.DEFAULT_BIAS_INITIALIZER="zeros",r.units=e.units,ja(r.units,"units"),r.activation=mu(void 0===e.activation?r.DEFAULT_ACTIVATION:e.activation),r.recurrentActivation=mu(void 0===e.recurrentActivation?r.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),r.useBias=null==e.useBias||e.useBias,r.kernelInitializer=Pi(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.recurrentInitializer=Pi(e.recurrentInitializer||r.DEFAULT_RECURRENT_INITIALIZER),r.biasInitializer=Pi(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.unitForgetBias=e.unitForgetBias,r.kernelRegularizer=wu(e.kernelRegularizer),r.recurrentRegularizer=wu(e.recurrentRegularizer),r.biasRegularizer=wu(e.biasRegularizer),r.kernelConstraint=yo(e.kernelConstraint),r.recurrentConstraint=yo(e.recurrentConstraint),r.biasConstraint=yo(e.biasConstraint),r.dropout=Za([1,Ja([0,null==e.dropout?0:e.dropout])]),r.recurrentDropout=Za([1,Ja([0,null==e.recurrentDropout?0:e.recurrentDropout])]),r.dropoutFunc=e.dropoutFunc,r.implementation=e.implementation,r.stateSize=[r.units,r.units],r.dropoutMask=null,r.recurrentDropoutMask=null,r}return Object(ea.a)(n,[{key:"build",value:function(e){var t,n,r=(e=Vi(e))[e.length-1];if(this.kernel=this.addWeight("kernel",[r,4*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,4*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){if(this.unitForgetBias){var a=this.biasInitializer,i=this.units;n=new((t=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(){return Object($r.a)(this,n),t.apply(this,arguments)}return Object(ea.a)(n,[{key:"apply",value:function(e,t){var n=a.apply([i]),r=(new wi).apply([i]),o=a.apply([2*i]);return si(si(n,r),o)}}]),n}(xi)).className="CustomInit",t)}else n=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.units],null,n,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}},{key:"call",value:function(e,t){var n=this;return Object(a.wf)((function(){var r=null!=t.training&&t.training;if(3!==(e=e).length)throw new sa("LSTMCell expects 3 input Tensors (inputs, h, c), got "+"".concat(e.length,"."));var o=e[1],s=e[2];e=e[0],0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=sc({ones:function(){return a.Le(e)},rate:n.dropout,training:r,count:4,dropoutFunc:n.dropoutFunc})),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=sc({ones:function(){return a.Le(o)},rate:n.recurrentDropout,training:r,count:4,dropoutFunc:n.dropoutFunc}));var u,c,l,d,p=n.dropoutMask,f=n.recurrentDropoutMask;0<n.dropout&&n.dropout<1&&(e=a.Fe(e,p[0]));var h=li(e,n.kernel.read());0<n.recurrentDropout&&n.recurrentDropout<1&&(o=a.Fe(o,f[0])),h=a.sd(h,li(o,n.recurrentKernel.read())),n.useBias&&(h=hi(h,n.bias.read()));var m=a.kf(h,4,h.rank-1),v=Object(i.a)(m,4),b=v[0],g=v[1],y=v[2],x=v[3];u=n.recurrentActivation.apply(b),c=n.recurrentActivation.apply(g),l=a.sd(a.Fe(c,s),a.Fe(u,n.activation.apply(y))),d=n.recurrentActivation.apply(x);var k=a.Fe(d,n.activation.apply(l));return[k,k,l]}))}},{key:"getConfig",value:function(){var e=Object(Fo.a)(Object(Mo.a)(n.prototype),"getConfig",this).call(this),t={units:this.units,activation:fu(this.activation),recurrentActivation:fu(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Li(this.kernelInitializer),recurrentInitializer:Li(this.recurrentInitializer),biasInitializer:Li(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:xu(this.kernelRegularizer),recurrentRegularizer:xu(this.recurrentRegularizer),biasRegularizer:xu(this.biasRegularizer),activityRegularizer:xu(this.activityRegularizer),kernelConstraint:bo(this.kernelConstraint),recurrentConstraint:bo(this.recurrentConstraint),biasConstraint:bo(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign({},e,t)}}]),n}($u);ac.className="LSTMCell",a.Ze.registerClass(ac);var ic=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){return Object($r.a)(this,n),0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new ac(e),t.call(this,e)}return Object(ea.a)(n,[{key:"call",value:function(e,t){var r=this;return Object(a.wf)((function(){null!=r.cell.dropoutMask&&(a.Wd(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(a.Wd(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null);var i=null==t?null:t.mask,o=null==t?null:t.training,s=null==t?null:t.initialState;return Object(Fo.a)(Object(Mo.a)(n.prototype),"call",r).call(r,e,{mask:i,training:o,initialState:s})}))}}],[{key:"fromConfig",value:function(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)}}]),n}(Qu);ic.className="LSTM",a.Ze.registerClass(ic);var oc=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;return Object($r.a)(this,n),(r=t.call(this,e)).cells=e.cells,r}return Object(ea.a)(n,[{key:"call",value:function(e,t){var n=this;return Object(a.wf)((function(){var r,a=(e=e).slice(1),i=[],o=Object(Qr.a)(n.cells.slice().reverse());try{for(o.s();!(r=o.n()).done;){var s=r.value;Array.isArray(s.stateSize)?i.push(a.splice(0,s.stateSize.length)):i.push(a.splice(0,1))}}catch(v){o.e(v)}finally{o.f()}i.reverse();for(var u,c=[],l=0;l<n.cells.length;++l){var d=n.cells[l];a=i[l],u=0===l?[e[0]].concat(a):[u[0]].concat(a),u=d.call(u,t),c.push(u.slice(1))}a=[];var p,f=Object(Qr.a)(c.slice().reverse());try{for(f.s();!(p=f.n()).done;){var h,m=p.value;(h=a).push.apply(h,Object(qn.a)(m))}}catch(v){f.e(v)}finally{f.f()}return[u[0]].concat(a)}))}},{key:"build",value:function(e){var t;Bi(e)&&(e=e[0]),e=e,this.cells.forEach((function(n,r){Va("RNNCell_".concat(r),(function(){n.build(e),t=Array.isArray(n.stateSize)?n.stateSize[0]:n.stateSize,e=[e[0],t]}))})),this.built=!0}},{key:"getConfig",value:function(){var e=Object(Fo.a)(Object(Mo.a)(n.prototype),"getConfig",this).call(this),t={cells:this.cells.map((function(e){return{className:e.getClassName(),config:e.getConfig()}}))};return Object.assign({},e,t)}},{key:"getWeights",value:function(){var e,t=[],n=Object(Qr.a)(this.cells);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,Object(qn.a)(r.weights))}}catch(a){n.e(a)}finally{n.f()}return qi(t)}},{key:"setWeights",value:function(e){var t,n=[],r=Object(Qr.a)(this.cells);try{for(r.s();!(t=r.n()).done;)for(var a=t.value,i=a.weights.length,o=e.splice(i),s=0;s<a.weights.length;++s)n.push([a.weights[s],o[s]])}catch(u){r.e(u)}finally{r.f()}Ki(n)}},{key:"stateSize",get:function(){var e,t=[],n=Object(Qr.a)(this.cells.slice().reverse());try{for(n.s();!(e=n.n()).done;){var r=e.value;Array.isArray(r.stateSize)?t.push.apply(t,Object(qn.a)(r.stateSize)):t.push(r.stateSize)}}catch(a){n.e(a)}finally{n.f()}return t}},{key:"trainableWeights",get:function(){if(!this.trainable)return[];var e,t=[],n=Object(Qr.a)(this.cells);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,Object(qn.a)(r.trainableWeights))}}catch(a){n.e(a)}finally{n.f()}return t}},{key:"nonTrainableWeights",get:function(){var e,t=[],n=Object(Qr.a)(this.cells);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,Object(qn.a)(r.nonTrainableWeights))}}catch(u){n.e(u)}finally{n.f()}if(!this.trainable){var a,i=[],o=Object(Qr.a)(this.cells);try{for(o.s();!(a=o.n()).done;){var s=a.value;i.push.apply(i,Object(qn.a)(s.trainableWeights))}}catch(u){o.e(u)}finally{o.f()}return i.concat(t)}return t}}],[{key:"fromConfig",value:function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=[],i=Object(Qr.a)(t.cells);try{for(i.s();!(n=i.n()).done;){var o=n.value;a.push(zo(o,r))}}catch(s){i.e(s)}finally{i.f()}return new e({cells:a})}}]),n}($u);function sc(e){var t=e.ones,n=e.rate,r=e.training,i=void 0!==r&&r,o=e.count,s=void 0===o?1:o,u=e.dropoutFunc,c=function(){return null!=u?u(t(),n):vi(t(),n)},l=function(){return bi(c,t,i)};return!s||s<=1?a.oe(l().clone()):Array(s).fill(void 0).map(l).map((function(e){return a.oe(e.clone())}))}oc.className="StackedRNNCells",a.Ze.registerClass(oc);var uc=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n},cc=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;if(Object($r.a)(this,n),e.unroll)throw new ua("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new ua("It is not possible at the moment to stack convolutional cells.");return(r=t.call(this,e)).inputSpec=[new Xi({ndim:5})],r}return Object(ea.a)(n,[{key:"call",value:function(e,t){var r=this;return a.wf((function(){if(null!=r.cell.dropoutMask&&(a.Wd(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(a.Wd(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null),t&&t.constants)throw new sa("ConvRNN2D cell does not support constants");var i=null==t?null:t.mask,o=null==t?null:t.training,s=null==t?null:t.initialState;return Object(Fo.a)(Object(Mo.a)(n.prototype),"call",r).call(r,e,{mask:i,training:o,initialState:s})}))}},{key:"computeOutputShape",value:function(e){var t=this.computeSingleOutputShape(e);return this.returnSequences||(t=[t[0]].concat(Object(qn.a)(t.slice(2)))),this.returnState&&(t=[t].concat(Object(qn.a)(Array(2).fill([e[0]].concat(Object(qn.a)(t.slice(-3))))))),t}},{key:"getInitialState",value:function(e){var t=this;return a.wf((function(){var n=t.cell.stateSize,r=e.shape,i=t.computeSingleOutputShape(r),o=[i[0]].concat(Object(qn.a)(i.slice(2))),s=a.If(o);return Array.isArray(n)?Array(n.length).fill(s):[s]}))}},{key:"resetStates",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];a.wf((function(){if(!t.stateful)throw new ia("Cannot call resetStates() on an RNN Layer that is not stateful.");var r=t.inputSpec[0].shape,i=t.computeSingleOutputShape(r),o=[i[0]].concat(Object(qn.a)(i.slice(2)));if(null==r[0])throw new sa("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==t.getStates())Array.isArray(t.cell.stateSize)?t.states_=t.cell.stateSize.map((function(){return a.If(o)})):t.states_=[a.If(o)];else if(null==e)a.Wd(t.states_),null!=t.keptStates&&(a.Wd(t.keptStates),t.keptStates=[]),Array.isArray(t.cell.stateSize)?t.states_=t.cell.stateSize.map((function(){return a.If(o)})):t.states_[0]=a.If(o);else{if(Array.isArray(e)||(e=[e]),e.length!==t.states_.length)throw new sa("Layer ".concat(t.name," expects ").concat(t.states_.length," state(s), ")+"but it received ".concat(e.length," state value(s). Input ")+"received: ".concat(e));n?t.keptStates.push(t.states_.slice()):a.Wd(t.states_);for(var s=0;s<t.states_.length;++s){var u=e[s],c=o;if(!a.Df.arraysEqual(u.shape,c))throw new sa("State ".concat(s," is incompatible with layer ").concat(t.name,": ")+"expected shape=".concat(c,", received shape=").concat(u.shape));t.states_[s]=u}}t.states_=t.states_.map((function(e){return a.oe(e.clone())}))}))}},{key:"computeSingleOutputShape",value:function(e){var t=this.cell,n=t.dataFormat,r=t.filters,a=t.kernelSize,i=t.padding,o=t.strides,s=t.dilationRate,u="channelsFirst"===n,c=e[u?3:2],l=e[u?4:3],d=_u(c,a[0],i,o[0],s[0]),p=_u(l,a[1],i,o[1],s[1]);return[].concat(Object(qn.a)(e.slice(0,2)),Object(qn.a)(u?[r,d,p]:[d,p,r]))}}]),n}(Qu);cc.className="ConvRNN2D";var lc=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;Object($r.a)(this,n);var a=e.filters,i=e.kernelSize,o=e.strides,s=e.padding,u=e.dataFormat,c=e.dilationRate;return(r=t.call(this,Object.assign({},e,{units:a}))).filters=a,ja(r.filters,"filters"),r.kernelSize=Eu(i,2,"kernelSize"),r.kernelSize.forEach((function(e){return ja(e,"kernelSize")})),r.strides=Eu(o||1,2,"strides"),r.strides.forEach((function(e){return ja(e,"strides")})),r.padding=s||"valid",Ba(r.padding),r.dataFormat=u||"channelsLast",Pa(r.dataFormat),r.dilationRate=Eu(c||1,2,"dilationRate"),r.dilationRate.forEach((function(e){return ja(e,"dilationRate")})),r}return Object(ea.a)(n,[{key:"build",value:function(e){var t;e=Vi(e);var n="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[n])throw new sa("The channel dimension of the input should be defined. "+"Found ".concat(e[n]));var r=e[n],i=this.kernelSize.concat([r,4*this.filters]);this.kernel=this.addWeight("kernel",i,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);var o=this.kernelSize.concat([this.filters,4*this.filters]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",o,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){var s;if(this.unitForgetBias){var u=this.biasInitializer,c=this.filters;s=new((t=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(){return Object($r.a)(this,n),t.apply(this,arguments)}return Object(ea.a)(n,[{key:"apply",value:function(e,t){return oi([u.apply([c]),a.Ke([c]),u.apply([2*c])])}}]),n}(xi)).className="CustomInit",t)}else s=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.filters],null,s,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}},{key:"call",value:function(e,t){var n=this;return a.wf((function(){if(3!==e.length)throw new sa("ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got "+"".concat(e.length,"."));var r=t.training||!1,o=e[0],s=e[1],u=e[2];0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=sc({ones:function(){return a.Le(o)},rate:n.dropout,training:r,count:4,dropoutFunc:n.dropoutFunc}));var c=n.dropoutMask,l=function(e,t,n){return t&&t[n]?a.Fe(t[n],e):e},d=l(o,c,0),p=l(o,c,1),f=l(o,c,2),h=l(o,c,3);0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=sc({ones:function(){return a.Le(s)},rate:n.recurrentDropout,training:r,count:4,dropoutFunc:n.dropoutFunc}));var m=n.recurrentDropoutMask,v=l(s,m,0),b=l(s,m,1),g=l(s,m,2),y=l(s,m,3),x=a.kf(n.kernel.read(),4,3),k=Object(i.a)(x,4),w=k[0],O=k[1],I=k[2],S=k[3],N=n.useBias?a.kf(n.bias.read(),4):[null,null,null,null],j=Object(i.a)(N,4),T=j[0],C=j[1],E=j[2],_=j[3];d=n.inputConv(d,w,T,n.padding),p=n.inputConv(p,O,C,n.padding),f=n.inputConv(f,I,E,n.padding),h=n.inputConv(h,S,_,n.padding);var A=a.kf(n.recurrentKernel.read(),4,3),R=Object(i.a)(A,4),D=R[0],F=R[1],M=R[2],z=R[3];v=n.recurrentConv(v,D),b=n.recurrentConv(b,F),g=n.recurrentConv(g,M),y=n.recurrentConv(y,z);var L=n.recurrentActivation.apply(a.sd(d,v)),P=n.recurrentActivation.apply(a.sd(p,b)),B=a.sd(a.Fe(P,u),a.Fe(L,n.activation.apply(a.sd(f,g)))),W=a.Fe(n.recurrentActivation.apply(a.sd(h,y)),n.activation.apply(B));return[W,W,B]}))}},{key:"getConfig",value:function(){var e=Object(Fo.a)(Object(Mo.a)(n.prototype),"getConfig",this).call(this),t=(e.units,uc(e,["units"])),r={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign({},t,r)}},{key:"inputConv",value:function(e,t,n,r){var i=a.Qd(e,t,this.strides,r||"valid","channelsFirst"===this.dataFormat?"NCHW":"NHWC",this.dilationRate);return n?hi(i,n,this.dataFormat):i}},{key:"recurrentConv",value:function(e,t){return a.Qd(e,t,1,"same","channelsFirst"===this.dataFormat?"NCHW":"NHWC")}}]),n}(ac);lc.className="ConvLSTM2DCell",a.Ze.registerClass(lc);var dc=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){Object($r.a)(this,n);var r=new lc(e);return t.call(this,Object.assign({},e,{cell:r}))}return Object(ea.a)(n,null,[{key:"fromConfig",value:function(e,t){return new e(t)}}]),n}(cc);dc.className="ConvLSTM2D",a.Ze.registerClass(dc);var pc=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;return Object($r.a)(this,n),(r=t.call(this,e)).rate=Math.max(Math.min(e.rate,1),0),r.noiseShape=e.noiseShape,r.seed=e.seed,r.supportsMasking=!0,r}return Object(ea.a)(n,[{key:"getNoiseShape",value:function(e){if(null==this.noiseShape)return this.noiseShape;for(var t=e.shape,n=[],r=0;r<this.noiseShape.length;++r)n.push(null==this.noiseShape[r]?t[r]:this.noiseShape[r]);return n}},{key:"call",value:function(e,t){var n=this;return Object(a.wf)((function(){n.invokeCallHook(e,t);var r=Ui(e);if(0<n.rate&&n.rate<1){var a=null!=t.training&&t.training,i=n.getNoiseShape(r);return bi((function(){return vi(r,n.rate,i,n.seed)}),(function(){return r}),a)}return e}))}},{key:"getConfig",value:function(){var e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},t=Object(Fo.a)(Object(Mo.a)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"dispose",value:function(){return Object(Fo.a)(Object(Mo.a)(n.prototype),"dispose",this).call(this)}}]),n}($i);pc.className="Dropout",a.Ze.registerClass(pc);var fc=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;return Object($r.a)(this,n),(r=t.call(this,e)).inputSpec=[{ndim:3}],r}return Object(ea.a)(n,[{key:"getNoiseShape",value:function(e){var t=e.shape;return[t[0],1,t[2]]}}]),n}(pc);fc.className="SpatialDropout1D",a.Ze.registerClass(fc);var hc=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;if(Object($r.a)(this,n),(r=t.call(this,e)).activation=null,r.useBias=!0,r.kernel=null,r.bias=null,r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_BIAS_INITIALIZER="zeros",null==e.batchInputShape&&null==e.inputShape&&null!=e.inputDim){var a=null;null!=e.batchSize&&(a=e.batchSize),r.batchInputShape=[a,e.inputDim]}return r.units=e.units,ja(r.units,"units"),r.activation=mu(e.activation),null!=e.useBias&&(r.useBias=e.useBias),r.kernelInitializer=Pi(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.biasInitializer=Pi(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.kernelConstraint=yo(e.kernelConstraint),r.biasConstraint=yo(e.biasConstraint),r.kernelRegularizer=wu(e.kernelRegularizer),r.biasRegularizer=wu(e.biasRegularizer),r.activityRegularizer=wu(e.activityRegularizer),r.supportsMasking=!0,r.inputSpec=[{minNDim:2}],r}return Object(ea.a)(n,[{key:"build",value:function(e){var t=(e=Vi(e))[e.length-1];null==this.kernel&&(this.kernel=this.addWeight("kernel",[t,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:Object(Cu.a)({},-1,t)}],this.built=!0}},{key:"computeOutputShape",value:function(e){var t=(e=Vi(e)).slice();return t[t.length-1]=this.units,t}},{key:"call",value:function(e,t){var n=this;return Object(a.wf)((function(){n.invokeCallHook(e,t);var r,a=Ui(e),i=Ta(n.activation.getClassName());return null!=i?r=li(a,n.kernel.read(),i,n.bias?n.bias.read():null):(r=li(a,n.kernel.read()),null!=n.bias&&(r=hi(r,n.bias.read())),null!=n.activation&&(r=n.activation.apply(r))),r}))}},{key:"getConfig",value:function(){var e={units:this.units,activation:fu(this.activation),useBias:this.useBias,kernelInitializer:Li(this.kernelInitializer),biasInitializer:Li(this.biasInitializer),kernelRegularizer:xu(this.kernelRegularizer),biasRegularizer:xu(this.biasRegularizer),activityRegularizer:xu(this.activityRegularizer),kernelConstraint:bo(this.kernelConstraint),biasConstraint:bo(this.biasConstraint)},t=Object(Fo.a)(Object(Mo.a)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}($i);hc.className="Dense",a.Ze.registerClass(hc);var mc=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;return Object($r.a)(this,n),e=e||{},(r=t.call(this,e)).inputSpec=[{minNDim:3}],r.dataFormat=e.dataFormat,r}return Object(ea.a)(n,[{key:"computeOutputShape",value:function(e){e=Vi(e);var t,n=Object(Qr.a)(e.slice(1));try{for(n.s();!(t=n.n()).done;){if(null==t.value)throw new sa('The shape of the input to "Flatten" is not fully defined '+"(got ".concat(e.slice(1),"). Make sure to pass a complete ")+'"input_shape" or "batch_input_shape" argument to the first layer in your model.')}}catch(r){n.e(r)}finally{n.f()}return[e[0],Ya(e,1)]}},{key:"call",value:function(e,t){var n=this;return Object(a.wf)((function(){n.invokeCallHook(e,t);var r=Ui(e);if("channelsFirst"===n.dataFormat&&r.rank>1){for(var i=[0],o=2;o<r.rank;++o)i.push(o);i.push(1),r=Object(a.zf)(r,i)}return function(e){if(e.rank<=1)throw new sa("batchFlatten requires a minimum rank of 2. Got rank: ".concat(e.rank,"."));var t=[e.shape[0],Ya(e.shape,1)];return a.Ue(e,t)}(r)}))}},{key:"getConfig",value:function(){var e={};null!=this.dataFormat&&(e.dataFormat=this.dataFormat);var t=Object(Fo.a)(Object(Mo.a)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}($i);mc.className="Flatten",a.Ze.registerClass(mc);var vc=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;return Object($r.a)(this,n),(r=t.call(this,e)).supportsMasking=!0,r.activation=mu(e.activation),r}return Object(ea.a)(n,[{key:"call",value:function(e,t){var n=this;return Object(a.wf)((function(){n.invokeCallHook(e,t);var r=Ui(e);return n.activation.apply(r)}))}},{key:"getConfig",value:function(){var e={activation:fu(this.activation)},t=Object(Fo.a)(Object(Mo.a)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}($i);vc.className="Activation",a.Ze.registerClass(vc);var bc=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;return Object($r.a)(this,n),(r=t.call(this,e)).n=e.n,r.inputSpec=[{ndim:2}],r}return Object(ea.a)(n,[{key:"computeOutputShape",value:function(e){return[e[0],this.n,e[1]]}},{key:"call",value:function(e,t){var n=this;return Object(a.wf)((function(){return e=Ui(e),t=e,r=n.n,Object(a.wf)((function(){if(2!==t.shape.length)throw new sa("repeat() expects a rank-2 tensor, but received a "+"rank-".concat(t.shape.length," tensor."));return ui(ti(t,1),[1,r,1])}));var t,r}))}},{key:"getConfig",value:function(){var e={n:this.n},t=Object(Fo.a)(Object(Mo.a)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}($i);bc.className="RepeatVector",a.Ze.registerClass(bc);var gc=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;Object($r.a)(this,n),(r=t.call(this,e)).targetShape=e.targetShape;for(var a=0;a<r.targetShape.length;++a)r.isUnknown(r.targetShape[a])&&(r.targetShape[a]=null);return r}return Object(ea.a)(n,[{key:"isUnknown",value:function(e){return e<0||null==e}},{key:"fixUnknownDimension",value:function(e,t){for(var n="Total size of new array must be unchanged.",r=t.slice(),a=1,i=null,o=0;o<r.length;++o){var s=r[o];if(this.isUnknown(s)){if(null!==i)throw new sa("Can only specifiy one unknown dimension.");i=o}else a*=s}var u=Ya(e);if(null!==i){if(0===a||u%a!==0)throw new sa(n);r[i]=u/a}else if(u!==a)throw new sa(n);return r}},{key:"computeOutputShape",value:function(e){for(var t=!1,n=0;n<e.length;++n)if(this.isUnknown(e[n])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}},{key:"call",value:function(e,t){var n=this;return Object(a.wf)((function(){n.invokeCallHook(e,t);var r=Ui(e),i=r.shape,o=i.slice(0,1).concat(n.fixUnknownDimension(i.slice(1),n.targetShape));return Object(a.Ue)(r,o)}))}},{key:"getConfig",value:function(){var e={targetShape:this.targetShape},t=Object(Fo.a)(Object(Mo.a)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}($i);gc.className="Reshape",a.Ze.registerClass(gc);var yc=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;if(Object($r.a)(this,n),r=t.call(this,e),null==e.dims)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error("Permute constructor requires `dims` to be an Array, but received "+"".concat(e.dims," instead."));var i=Qa(1,e.dims.length+1);if(!a.Df.arraysEqual(e.dims.slice().sort(),i))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");return r.dims=e.dims,r.dimsIncludingBatch=[0].concat(r.dims),r.inputSpec=[new Xi({ndim:r.dims.length+1})],r}return Object(ea.a)(n,[{key:"computeOutputShape",value:function(e){var t=(e=Vi(e)).slice();return this.dims.forEach((function(n,r){t[r+1]=e[n]})),t}},{key:"call",value:function(e,t){return Object(a.zf)(Ui(e),this.dimsIncludingBatch)}},{key:"getConfig",value:function(){var e={dims:this.dims},t=Object(Fo.a)(Object(Mo.a)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}($i);yc.className="Permute",a.Ze.registerClass(yc);var xc=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;return Object($r.a)(this,n),(r=t.call(this,null==e?{}:e)).supportsMasking=!0,r.maskValue=null!=e?null==e.maskValue?0:e.maskValue:0,r}return Object(ea.a)(n,[{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=Object(Fo.a)(Object(Mo.a)(n.prototype),"getConfig",this).call(this),t={maskValue:this.maskValue};return Object.assign(t,e),t}},{key:"computeMask",value:function(e,t){var n=Ui(e);return Object(a.ud)(Object(a.Ie)(n,this.maskValue),-1)}},{key:"call",value:function(e,t){var n=this;return Object(a.wf)((function(){n.invokeCallHook(e,t);var r=Ui(e),i=Object(a.ud)(Object(a.Ie)(r,n.maskValue),-1,!0);return Object(a.Fe)(r,Object(a.Hd)(i,r.dtype))}))}}]),n}($i);xc.className="Masking",a.Ze.registerClass(xc);var kc=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;if(Object($r.a)(this,n),(r=t.call(this,e)).embeddings=null,r.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",null==e.batchInputShape&&null==e.inputShape){var a=null;null!=e.batchSize&&(a=e.batchSize),null==e.inputLength?r.batchInputShape=[a,null]:r.batchInputShape=[a].concat(ma(e.inputLength))}return r.inputDim=e.inputDim,ja(r.inputDim,"inputDim"),r.outputDim=e.outputDim,ja(r.outputDim,"outputDim"),r.embeddingsInitializer=Pi(e.embeddingsInitializer||r.DEFAULT_EMBEDDINGS_INITIALIZER),r.embeddingsRegularizer=wu(e.embeddingsRegularizer),r.activityRegularizer=wu(e.activityRegularizer),r.embeddingsConstraint=yo(e.embeddingsConstraint),r.maskZero=e.maskZero,r.supportsMasking=e.maskZero,r.inputLength=e.inputLength,r}return Object(ea.a)(n,[{key:"build",value:function(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}},{key:"warnOnIncompatibleInputShape",value:function(e){}},{key:"computeMask",value:function(e,t){var n=this;return Object(a.wf)((function(){return n.maskZero?(e=Ui(e),Object(a.Ie)(e,Object(a.Jf)(e))):null}))}},{key:"computeOutputShape",value:function(e){if(e=Vi(e),null==this.inputLength)return[].concat(Object(qn.a)(e),[this.outputDim]);var t=ma(this.inputLength);if(t.length!==e.length-1)throw new sa('"inputLength" is '.concat(this.inputLength,", but received ")+"input shape has shape ".concat(e));for(var n=0,r=0;r<t.length;++r){var a=t[r],i=e[r+1];if(null!=a&&null!=i&&a!==i)throw new sa('"inputLength" is '.concat(this.inputLength,", but received ")+"input shape has shape ".concat(e));null==a&&(t[n]=i),n++}return[e[0]].concat(Object(qn.a)(t),[this.outputDim])}},{key:"call",value:function(e,t){var n=this;return Object(a.wf)((function(){n.invokeCallHook(e,t);var r=Ui(e);"int32"!==r.dtype&&(r=ei(r,"int32"));var i=di(n.embeddings.read(),Object(a.Ue)(r,[r.size]));return Object(a.Ue)(i,Vi(n.computeOutputShape(r.shape)))}))}},{key:"getConfig",value:function(){var e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:Li(this.embeddingsInitializer),embeddingsRegularizer:xu(this.embeddingsRegularizer),activityRegularizer:xu(this.activityRegularizer),embeddingsConstraint:bo(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},t=Object(Fo.a)(Object(Mo.a)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}($i);kc.className="Embedding",a.Ze.registerClass(kc);var wc=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;return Object($r.a)(this,n),(r=t.call(this,e||{})).supportsMasking=!0,r}return Object(ea.a)(n,[{key:"mergeFunction",value:function(e){throw new ua}},{key:"computeElementwiseOpOutputShape",value:function(e,t){if(null==e||null==t)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(0===t.length)return e;for(var n=e.slice(0,e.length-t.length),r=0;r<t.length;++r){var a=e[e.length-t.length+r],i=t[r];if(null==a||null==i||a<0||i<0)n.push(null);else if(1===a)n.push(i);else if(1===i)n.push(a);else{if(a!==i)throw new sa("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));n.push(a)}}return n}},{key:"build",value:function(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[Vi(e)]),(e=e).length<2)throw new sa("A merge layer should be called on an Array of at least 2 inputs."+" Got ".concat(e.length," input(s)."));var t,n=[],r=Object(Qr.a)(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;null!=a&&null!==a[0]&&n.push(a[0])}}catch(c){r.e(c)}finally{r.f()}if((n=Oa(n)).length>1)throw new sa("Can not merge tensors with different batch sizes. "+"Got tensors with shapes: ".concat(JSON.stringify(e),"."));for(var i=null==e[0]?null:e[0].slice(1),o=1;o<e.length;++o){var s=null==e[o]?null:e[o].slice(1);i=this.computeElementwiseOpOutputShape(i,s)}var u=e.map((function(e){return e.length}));-1===e.indexOf(null)&&1===Oa(u).length?this.reshapeRequired=!1:this.reshapeRequired=!0}},{key:"call",value:function(e,t){var n=this;return Object(a.wf)((function(){if(e=e,n.reshapeRequired){var t=[],r=e.map((function(e){return e.rank}));if(-1===r.indexOf(null)){var i,o=Ja(r),s=Object(Qr.a)(e);try{for(s.s();!(i=s.n()).done;){for(var u=i.value,c=u.rank,l=0;l<o-c;++l)u=ti(u,1);t.push(u)}}catch(j){s.e(j)}finally{s.f()}return n.mergeFunction(t)}var d,p=!1,f=Object(Qr.a)(e);try{for(f.s();!(d=f.n()).done;){var h=d.value,m=h.rank;if(null==m){var v=h.shape,b=v[0],g=v.slice(1).concat([b]),y=a.Ue(h,[b].concat(Ya(v.slice(1))));y=a.zf(y,[1,0]),y=a.Ue(y,g),t.push(y),p=!0}else if(m>1){var x=Qa(1,m).concat([0]);t.push(a.zf(h,x)),p=!0}else t.push(h)}}catch(j){f.e(j)}finally{f.f()}var k=n.mergeFunction(t),w=k.rank;if(p)if(null==w){var O=k.shape,I=O[O.length-1],S=[I].concat(O.slice(0,O.length-1));k=a.Ue(a.zf(a.Ue(k,[-1,I]),[1,0]),S)}else if(w>1){var N=[w-1].concat(Qa(0,w-1));k=a.zf(k,N)}return k}return n.mergeFunction(e)}))}},{key:"computeOutputShape",value:function(e){var t;t=null==(e=e)[0]?null:e[0].slice(1);for(var n=1;n<e.length;++n){var r=null==e[n]?null:e[n].slice(1);t=this.computeElementwiseOpOutputShape(t,r)}var a,i=[],o=Object(Qr.a)(e);try{for(o.s();!(a=o.n()).done;){var s=a.value;null!=s&&null!==s[0]&&i.push(s[0])}}catch(u){o.e(u)}finally{o.f()}return t=1===(i=Oa(i)).length?i.concat(t):[null].concat(t)}},{key:"computeMask",value:function(e,t){return a.wf((function(){if(null==t)return null;if(!Array.isArray(t))throw new sa("`mask` should be an Array");if(!Array.isArray(e))throw new sa("`inputs` should be an Array");if(t.length!==e.length)throw new sa("The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths "+"(".concat(e.length," vs ").concat(t.length,")"));if(t.every((function(e){return null==e})))return null;for(var n=(t=t.map((function(e){return null==e?e:a.ee(e,0)})))[0],r=1;r<t.length-1;++r)n=a.ve(n,t[r]);return n}))}}]),n}($i),Oc=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){return Object($r.a)(this,n),t.call(this,e)}return Object(ea.a)(n,[{key:"mergeFunction",value:function(e){return Object(a.wf)((function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=a.sd(t,e[n]);return t}))}}]),n}(wc);Oc.className="Add",a.Ze.registerClass(Oc);var Ic=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){return Object($r.a)(this,n),t.call(this,e)}return Object(ea.a)(n,[{key:"mergeFunction",value:function(e){return Object(a.wf)((function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=a.Fe(t,e[n]);return t}))}}]),n}(wc);Ic.className="Multiply",a.Ze.registerClass(Ic);var Sc=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){return Object($r.a)(this,n),t.call(this,e)}return Object(ea.a)(n,[{key:"mergeFunction",value:function(e){return Object(a.wf)((function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=a.sd(t,e[n]);return a.Fe(1/e.length,t)}))}}]),n}(wc);Sc.className="Average",a.Ze.registerClass(Sc);var Nc=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){return Object($r.a)(this,n),t.call(this,e)}return Object(ea.a)(n,[{key:"mergeFunction",value:function(e){return Object(a.wf)((function(){for(var t=e[0],n=1;n<e.length;++n)t=a.Ae(t,e[n]);return t}))}}]),n}(wc);Nc.className="Maximum",a.Ze.registerClass(Nc);var jc=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){return Object($r.a)(this,n),t.call(this,e)}return Object(ea.a)(n,[{key:"mergeFunction",value:function(e){return Object(a.wf)((function(){for(var t=e[0],n=1;n<e.length;++n)t=a.De(t,e[n]);return t}))}}]),n}(wc);jc.className="Minimum",a.Ze.registerClass(jc);var Tc=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;return Object($r.a)(this,n),(r=t.call(this,e)).DEFAULT_AXIS=-1,null==e&&(e={}),r.axis=null==e.axis?r.DEFAULT_AXIS:e.axis,r.supportsMasking=!0,r.reshapeRequired=!1,r}return Object(ea.a)(n,[{key:"build",value:function(e){if(!Array.isArray(e)||!Array.isArray(e[0])||1===e.length)throw new sa("A `Concatenate` layer should be called on a list of at least 2 inputs");e=e;var t,n=!0,r=Object(Qr.a)(e);try{for(r.s();!(t=r.n()).done;){if(null!=t.value){n=!1;break}}}catch(p){r.e(p)}finally{r.f()}if(!n){for(var i=[],o=0;o<e.length;++o){var s=e[o].slice();s.splice(this.axis,1);var u,c=!1,l=Object(Qr.a)(i);try{for(l.s();!(u=l.n()).done;){var d=u.value;if(a.Df.arraysEqual(d,s)){c=!0;break}}}catch(p){l.e(p)}finally{l.f()}c||i.push(s)}if(i.length>1)throw new sa("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}}},{key:"mergeFunction",value:function(e){var t=this;return Object(a.wf)((function(){return oi(e,t.axis)}))}},{key:"computeOutputShape",value:function(e){if(!Array.isArray(e)||!Array.isArray(e[0]))throw new sa("A `Concatenate` layer should be called on a list of inputs.");var t,n=e,r=n[0].slice(),a=this.axis<0?r.length+this.axis:this.axis,i=Object(Qr.a)(n.slice(1));try{for(i.s();!(t=i.n()).done;){var o=t.value;if(null==r[a]||null==o[a]){r[a]=null;break}r[a]+=o[a]}}catch(s){i.e(s)}finally{i.f()}return r}},{key:"computeMask",value:function(e,t){var n=this;if(null==t)return null;if(!Array.isArray(t))throw new sa("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new sa("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new sa("Mismatch in the length of mask (".concat(t.length,") ")+"and the legnth of inputs (".concat(e.length,")"));return a.wf((function(){var r=!0;if(t.forEach((function(e){null==e||(r=!1)})),r)return null;for(var i=[],o=0;o<e.length;++o)null==t[o]?i.push(a.Hd(a.Le(e[o]),"bool")):t[o].rank<e[o].rank?i.push(a.ee(t[o],-1)):i.push(t[o]);var s=a.Kd(i,n.axis);return a.td(s,-1,!1)}))}},{key:"getConfig",value:function(){var e={axis:this.axis},t=Object(Fo.a)(Object(Mo.a)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(wc);function Cc(e,t){for(;e<0;)e+=t;return e}Tc.className="Concatenate",a.Ze.registerClass(Tc);var Ec=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;return Object($r.a)(this,n),(r=t.call(this,e)).axes=e.axes,r.normalize=null!=e.normalize&&e.normalize,r.supportsMasking=!0,r.reshapeRequired=!1,r}return Object(ea.a)(n,[{key:"build",value:function(e){a.Df.assert(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),(function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."}));var t=e[0],n=e[1];if(t.length>3||n.length>3)throw new ua("Dot layer does not support tensors of 4D or higher rank yet.");var r=this.interpretAxes(t,n);if(t[r[0]]!==n[r[1]])throw new sa("Dimension incompatibility: "+"".concat(t[r[0]]," !== ").concat(n[r[1]]))}},{key:"mergeFunction",value:function(e){if(2!==e.length)throw new sa("A `Dot` layer must be called on exactly 2 inputs, "+"but received ".concat(e.length," input(s)."));var t,n=e[0],r=e[1];return t=Array.isArray(this.axes)?this.axes.map((function(t,n){return Cc(t,e[n].shape.length)})):[Cc(this.axes,n.shape.length),Cc(this.axes,r.shape.length)],this.normalize&&(n=Lo(n,t[0]),r=Lo(r,t[1])),function(e,t,n){if(e.shape.length>3||t.shape.length>3)throw new ua("batchDot is not implemented for tensors of 4D or higher rank yet");if(a.Df.assert(e.shape.length>=2,(function(){return"batchDot requires the rank of x to be >= 2, "+"but got ".concat(e.shape.length)})),a.Df.assert(e.shape.length>=2,(function(){return"batchDot requires the rank of y to be >= 2, "+"but got ".concat(t.shape.length)})),"number"===typeof n&&(n=[n,n]),"complex64"===e.dtype||"complex64"===t.dtype)throw new ua("batchDot is not implemented for complex64-type Tensors yet.");var r=e.shape.length,i=t.shape.length;null==n&&(n=[r-1,i-2]);var o=n;return a.wf((function(){var n,s;if(r>i){n=r-i;for(var u=[],c=0;c<n;++c)u.push(1);t=a.Ue(t,t.shape.concat(u))}else if(i>r){n=i-r;for(var l=[],d=0;d<n;++d)l.push(1);e=a.Ue(e,e.shape.concat(l))}else n=0;if(2===e.shape.length&&2===t.shape.length)s=o[0]===o[1]?a.pf(a.Fe(e,t),o[0]):a.pf(a.Fe(a.zf(e,[1,0]),t),o[1]);else{var p=o[0]!==e.shape.length-1,f=o[1]===t.shape.length-1;s=a.we(e,t,p,f)}if(n>0){for(var h,m=[],v=h=r>i?r+i-3:r-1;v<h+n;++v)m.push(v);s=a.mf(s,m)}return 1===s.shape.length&&(s=a.ee(s,1)),s}))}(n,r,t)}},{key:"interpretAxes",value:function(e,t){return Array.isArray(this.axes)?this.axes:[Cc(this.axes,e.length),Cc(this.axes,t.length)]}},{key:"computeOutputShape",value:function(e){a.Df.assert(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),(function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."}));var t=e[0].slice(),n=e[1].slice();if(t.length>3||n.length>3)throw new ua("Dot layer does not support tensors of 4D or higher rank yet.");var r=this.interpretAxes(t,n);t.splice(r[0],1),n.splice(r[1],1),n.splice(0,1);var i=t.concat(n);return 1===i.length&&i.push(1),i}},{key:"computeMask",value:function(e,t){return null}},{key:"getConfig",value:function(){var e={axes:this.axes,normalize:this.normalize},t=Object(Fo.a)(Object(Mo.a)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(wc);Ec.className="Dot",a.Ze.registerClass(Ec);var _c=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;return Object($r.a)(this,n),(r=t.call(this,e)).supportsMasking=!0,r.stddev=e.stddev,r}return Object(ea.a)(n,[{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=Object(Fo.a)(Object(Mo.a)(n.prototype),"getConfig",this).call(this),t={stddev:this.stddev};return Object.assign(t,e),t}},{key:"call",value:function(e,t){var n=this;return Object(a.wf)((function(){n.invokeCallHook(e,t);var r=Ui(e);return bi((function(){return Object(a.sd)(ci(r.shape,0,n.stddev),r)}),(function(){return r}),t.training||!1)}))}}]),n}($i);_c.className="GaussianNoise",a.Ze.registerClass(_c);var Ac=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;return Object($r.a)(this,n),(r=t.call(this,e)).supportsMasking=!0,r.rate=e.rate,r}return Object(ea.a)(n,[{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=Object(Fo.a)(Object(Mo.a)(n.prototype),"getConfig",this).call(this),t={rate:this.rate};return Object.assign(t,e),t}},{key:"call",value:function(e,t){var n=this;return Object(a.wf)((function(){n.invokeCallHook(e,t);var r=Ui(e);if(n.rate>0&&n.rate<1){return bi((function(){var e=Math.sqrt(n.rate/(1-n.rate));return Object(a.Fe)(r,ci(r.shape,1,e))}),(function(){return r}),t.training||!1)}return r}))}}]),n}($i);Ac.className="GaussianDropout",a.Ze.registerClass(Ac);var Rc=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;return Object($r.a)(this,n),(r=t.call(this,e)).supportsMasking=!0,r.rate=e.rate,r.noiseShape=e.noiseShape,r}return Object(ea.a)(n,[{key:"_getNoiseShape",value:function(e){return this.noiseShape||Ui(e).shape}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=Object(Fo.a)(Object(Mo.a)(n.prototype),"getConfig",this).call(this),t={rate:this.rate};return Object.assign(t,e),t}},{key:"call",value:function(e,t){var n=this;return Object(a.wf)((function(){if(n.rate<1&&n.rate>0){var r=n._getNoiseShape(e);return bi((function(){var t=Ui(e),i=-1.7580993408473766,o=Object(a.le)(Object(a.Qe)(r),n.rate);o=ei(o,"float32");var s=Math.pow((1-n.rate)*(1+n.rate*Math.pow(i,2)),-.5),u=-s*i*n.rate,c=Object(a.sd)(Object(a.Fe)(t,o),Object(a.Fe)(Object(a.sd)(o,-1),i));return Object(a.sd)(Object(a.Fe)(c,s),u)}),(function(){return Ui(e)}),t.training||!1)}return e}))}}]),n}($i);function Dc(e,t,n,r,i){var o,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.001;if(2===e.rank)o=a.Ad(e,t,n,r,i,s);else if(3===e.rank)o=a.Bd(e,t,n,r,i,s);else{if(4!==e.rank)throw new ua("batchNormalization is not implemented for array of rank ".concat(e.rank," ")+"yet");o=a.Cd(e,t,n,r,i,s)}return o}function Fc(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return Object(a.wf)((function(){var o=a.Ee(e,r),s=o.mean,u=o.variance;return[Dc(e,s,u,n,t,i),s,u]}))}function Mc(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return Object(a.wf)((function(){var o,s=a.Ee(e,r),u=s.mean,c=s.variance,l=[],d=Object(Qr.a)(Qa(0,e.rank));try{for(d.s();!(o=d.n()).done;){var p=o.value;-1!==r.indexOf(p)?l.push(1):l.push(e.shape[p])}}catch(b){d.e(b)}finally{d.f()}var f=Object(a.Ue)(u,l),h=Object(a.Ue)(c,l),m=null==t?null:Object(a.Ue)(t,l),v=null==n?null:Object(a.Ue)(n,l);return[Dc(e,f,h,v,m,i),u,c]}))}Rc.className="AlphaDropout",a.Ze.registerClass(Rc);var zc=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;return Object($r.a)(this,n),null==e&&(e={}),(r=t.call(this,e)).supportsMasking=!0,r.axis=null==e.axis?-1:e.axis,r.momentum=null==e.momentum?.99:e.momentum,r.epsilon=null==e.epsilon?.001:e.epsilon,r.center=null==e.center||e.center,r.scale=null==e.scale||e.scale,r.betaInitializer=Pi(e.betaInitializer||"zeros"),r.gammaInitializer=Pi(e.gammaInitializer||"ones"),r.movingMeanInitializer=Pi(e.movingMeanInitializer||"zeros"),r.movingVarianceInitializer=Pi(e.movingVarianceInitializer||"ones"),r.betaConstraint=yo(e.betaConstraint),r.gammaConstraint=yo(e.gammaConstraint),r.betaRegularizer=wu(e.betaRegularizer),r.gammaRegularizer=wu(e.gammaRegularizer),r}return Object(ea.a)(n,[{key:"build",value:function(e){e=Vi(e);var t=this.axis>=0?this.axis:this.axis+e.length,n=e[t];if(null==n)throw new sa("Axis ".concat(t," of input tensor should have a defined dimension but ")+"the layer received an input with shape "+"".concat(JSON.stringify(e),"."));this.inputSpec=[new Xi({ndim:e.length,axes:Object(Cu.a)({},t,n)})];var r=[n];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}},{key:"call",value:function(e,t){var n=this;return Object(a.wf)((function(){var r=null!=t.training&&t.training,o=Ui(e),s=o.shape,u=s.length,c=Qa(0,u),l=n.axis>=0?n.axis:n.axis+u;c.splice(l,1);var d=da(1,u);d[l]=s[l];var p=c.slice();p.sort();var f=!a.Df.arraysEqual(p,Qa(0,u).slice(0,u-1));if(!r)return function(){if(f){var e=Object(a.Ue)(n.movingMean.read(),d),t=Object(a.Ue)(n.movingVariance.read(),d),r=n.center?Object(a.Ue)(n.beta.read(),d):null,i=n.scale?Object(a.Ue)(n.gamma.read(),d):null;return Dc(o,e,t,r,i,n.epsilon)}return Dc(o,n.movingMean.read(),n.movingVariance.read(),null==n.beta?null:n.beta.read(),null==n.gamma?null:n.gamma.read(),n.epsilon)}();var h=function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return a.Df.arraysEqual(r.slice().sort(),Qa(0,e.rank-1))?Fc(e,t,n,r,i):Mc(e,t,n,r,i)}(o,n.gamma.read(),n.beta.read(),c,n.epsilon),m=Object(i.a)(h,3),v=m[0],b=m[1],g=m[2],y=function(e,t,n){a.wf((function(){var r=1-n,i=e.read(),o=a.Fe(a.of(i,t),r);e.write(a.of(i,o))}))};return y(n.movingMean,b,n.momentum),y(n.movingVariance,g,n.momentum),v}))}},{key:"getConfig",value:function(){var e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Li(this.betaInitializer),gammaInitializer:Li(this.gammaInitializer),movingMeanInitializer:Li(this.movingMeanInitializer),movingVarianceInitializer:Li(this.movingVarianceInitializer),betaRegularizer:xu(this.betaRegularizer),gammaRegularizer:xu(this.gammaRegularizer),betaConstraint:bo(this.betaConstraint),gammaConstraint:bo(this.gammaConstraint)},t=Object(Fo.a)(Object(Mo.a)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}($i);zc.className="BatchNormalization",a.Ze.registerClass(zc);var Lc=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;if(Object($r.a)(this,n),null==e&&(e={}),(r=t.call(this,e)).axis=null==e.axis?-1:e.axis,"number"===typeof r.axis){if(!Number.isInteger(r.axis))throw new Error("Expected axis to be an integer, but received ".concat(r.axis))}else{if(!Array.isArray(r.axis))throw new Error("Expected axis to be an integer or an array of integers, "+"but received ".concat(JSON.stringify(r.axis)));var a,i=Object(Qr.a)(r.axis);try{for(i.s();!(a=i.n()).done;){var o=a.value;if(!Number.isInteger(o))throw new Error("Expected axis to be an array of integers, "+"but received ".concat(JSON.stringify(r.axis)))}}catch(s){i.e(s)}finally{i.f()}}return r.epsilon=null==e.epsilon?.001:e.epsilon,r.center=null==e.center||e.center,r.scale=null==e.scale||e.scale,r.betaInitializer=Pi(e.betaInitializer||"zeros"),r.gammaInitializer=Pi(e.gammaInitializer||"ones"),r.betaRegularizer=wu(e.betaRegularizer),r.gammaRegularizer=wu(e.gammaRegularizer),r.supportsMasking=!0,r}return Object(ea.a)(n,[{key:"build",value:function(e){var t=(e=Vi(e)).length;"number"===typeof this.axis&&(this.axis=[this.axis]);for(var n=0;n<this.axis.length;++n)this.axis[n]<0&&(this.axis[n]+=t);var r,a=Object(Qr.a)(this.axis);try{for(a.s();!(r=a.n()).done;){var i=r.value;if(i<0||i>=t)throw new Error("Invalid axis: ".concat(i))}}catch(s){a.e(s)}finally{a.f()}if(this.axis.length!==Oa(this.axis).length)throw new Error("Found duplicate axes in: ".concat(this.axis));var o=this.axis.map((function(t){return e[t]}));this.scale?this.gamma=this.addWeight("gamma",o,"float32",this.gammaInitializer,this.gammaRegularizer,!0):this.gamma=null,this.center?this.beta=this.addWeight("beta",o,"float32",this.betaInitializer,this.betaRegularizer,!0):this.beta=null,this.built=!0}},{key:"call",value:function(e,t){var n=this,r=Ui(e),i=r.shape,o=i.length;return Object(a.wf)((function(){var e,t=Object(a.Ee)(r,n.axis,!0),s=t.mean,u=t.variance,c=da(1,o),l=Object(Qr.a)(n.axis);try{for(l.s();!(e=l.n()).done;){var d=e.value;c[d]=i[d]}}catch(g){l.e(g)}finally{l.f()}for(var p=function(e){return null!=e&&e.shape.length!==o?a.Ue(e,c):e},f=n.scale?p(n.gamma.read()):null,h=n.center?p(n.beta.read()):null,m=[],v=[],b=0;b<o;++b)-1!==n.axis.indexOf(b)?(m.push(i[b]),v.push(1)):(m.push(1),v.push(i[b]));return s=a.xf(s,m),u=a.xf(u,m),null!=f&&(f=a.xf(f,v)),null!=h&&(h=a.xf(h,v)),Dc(r,s,u,h,f,n.epsilon)}))}},{key:"getConfig",value:function(){var e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Li(this.betaInitializer),gammaInitializer:Li(this.gammaInitializer),betaRegularizer:xu(this.betaRegularizer),gammaRegularizer:xu(this.gammaRegularizer)},t=Object(Fo.a)(Object(Mo.a)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}($i);Lc.className="LayerNormalization",a.Ze.registerClass(Lc);var Pc=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;if(Object($r.a)(this,n),null==e&&(e={}),(r=t.call(this,e)).dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,null==e.padding)r.padding=[[1,1],[1,1]];else if("number"===typeof e.padding)r.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,2!==e.padding.length)throw new sa("ZeroPadding2D expects padding to be a length-2 array, but "+"received a length-".concat(e.padding.length," array."));var a,i;if("number"===typeof e.padding[0])a=[e.padding[0],e.padding[0]],i=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,2!==e.padding[0].length)throw new sa("ZeroPadding2D expects height padding to be a length-2 array, "+"but received a length-".concat(e.padding[0].length," array."));if(a=e.padding[0],2!==e.padding[1].length)throw new sa("ZeroPadding2D expects width padding to be a length-2 array, "+"but received a length-".concat(e.padding[1].length," array."));i=e.padding[1]}r.padding=[a,i]}return r.inputSpec=[new Xi({ndim:4})],r}return Object(ea.a)(n,[{key:"computeOutputShape",value:function(e){var t,n;return e=Vi(e),"channelsFirst"===this.dataFormat?(t=null!=e[2]&&e[2]>=0?e[2]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[3]&&e[3]>=0?e[3]+this.padding[1][0]+this.padding[1][1]:null,[e[0],e[1],t,n]):(t=null!=e[1]&&e[1]>=0?e[1]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[2]&&e[2]>=0?e[2]+this.padding[1][0]+this.padding[1][1]:null,[e[0],t,n,e[3]])}},{key:"call",value:function(e,t){var n=this;return Object(a.wf)((function(){return t=Ui(e),r=n.padding,i=n.dataFormat,Object(a.wf)((function(){if(4!==t.rank)throw new sa("temporalPadding expects input tensor to be 4-D, but received a "+"".concat(t.rank,"-D tensor."));if(null==r&&(r=[[1,1],[1,1]]),2!==r.length||2!==r[0].length||2!==r[1].length)throw new sa("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(null==i&&(i="channelsLast"),"channelsLast"!==i&&"channelsFirst"!==i)throw new sa("Unknown data format: ".concat(i,". ")+"Supported data formats are 'channelsLast' and 'channelsFirst.");var e;return e="channelsFirst"===i?[[0,0],[0,0],r[0],r[1]]:[[0,0],r[0],r[1],[0,0]],a.Me(t,e)}));var t,r,i}))}},{key:"getConfig",value:function(){var e={padding:this.padding,dataFormat:this.dataFormat},t=Object(Fo.a)(Object(Mo.a)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}($i);function Bc(e,t,n,r,i,o){return Object(a.wf)((function(){var s;Pa(i),Wa(o),Ba(r),null==n&&(n=[1,1]),null==r&&(r="valid"),null==i&&(i="channelsLast"),null==o&&(o="max"),e=Ru(e,i);var u="same"===r?"same":"valid";return s="max"===o?a.ye(e,t,n,u):a.wd(e,t,n,u),"channelsFirst"===i&&(s=a.zf(s,[0,3,1,2])),s}))}function Wc(e,t,n,r,i,o){return Object(a.wf)((function(){var s;Pa(i),Wa(o),Ba(r),null==n&&(n=[1,1,1]),null==r&&(r="valid"),null==i&&(i="channelsLast"),null==o&&(o="max"),e=Du(e,i);var u="same"===r?"same":"valid";return s="max"===o?a.ze(e,t,n,u):a.xd(e,t,n,u),"channelsFirst"===i&&(s=a.zf(s,[0,4,1,2,3])),s}))}Pc.className="ZeroPadding2D",a.Ze.registerClass(Pc);var Uc=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;if(Object($r.a)(this,n),null==e.poolSize&&(e.poolSize=2),r=t.call(this,e),"number"===typeof e.poolSize)r.poolSize=[e.poolSize];else{if(!Array.isArray(e.poolSize)||1!==e.poolSize.length||"number"!==typeof e.poolSize[0])throw new sa("poolSize for 1D convolutional layer must be a number or an Array of a single number, but received "+"".concat(JSON.stringify(e.poolSize)));r.poolSize=e.poolSize}if(ja(r.poolSize,"poolSize"),null==e.strides)r.strides=r.poolSize;else if("number"===typeof e.strides)r.strides=[e.strides];else{if(!Array.isArray(e.strides)||1!==e.strides.length||"number"!==typeof e.strides[0])throw new sa("strides for 1D convolutional layer must be a number or an Array of a single number, but received "+"".concat(JSON.stringify(e.strides)));r.strides=e.strides}return ja(r.strides,"strides"),r.padding=null==e.padding?"valid":e.padding,Ba(r.padding),r.inputSpec=[new Xi({ndim:3})],r}return Object(ea.a)(n,[{key:"computeOutputShape",value:function(e){var t=_u((e=Vi(e))[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]}},{key:"call",value:function(e,t){var n=this;return Object(a.wf)((function(){n.invokeCallHook(e,t),e=ti(Ui(e),2);var r=n.poolingFunction(Ui(e),[n.poolSize[0],1],[n.strides[0],1],n.padding,"channelsLast");return a.mf(r,[2])}))}},{key:"getConfig",value:function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},t=Object(Fo.a)(Object(Mo.a)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}($i),Vc=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){return Object($r.a)(this,n),t.call(this,e)}return Object(ea.a)(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return Pa(a),Ba(r),Bc(e,t,n,r,a,"max")}}]),n}(Uc);Vc.className="MaxPooling1D",a.Ze.registerClass(Vc);var Gc=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){return Object($r.a)(this,n),t.call(this,e)}return Object(ea.a)(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return Pa(a),Ba(r),Bc(e,t,n,r,a,"avg")}}]),n}(Uc);Gc.className="AveragePooling1D",a.Ze.registerClass(Gc);var Hc=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;if(Object($r.a)(this,n),null==e.poolSize&&(e.poolSize=[2,2]),(r=t.call(this,e)).poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],null==e.strides)r.strides=r.poolSize;else if(Array.isArray(e.strides)){if(2!==e.strides.length)throw new sa("If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length "+"".concat(e.strides.length,"."));r.strides=e.strides}else r.strides=[e.strides,e.strides];return ja(r.poolSize,"poolSize"),ja(r.strides,"strides"),r.padding=null==e.padding?"valid":e.padding,r.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,Pa(r.dataFormat),Ba(r.padding),r.inputSpec=[new Xi({ndim:4})],r}return Object(ea.a)(n,[{key:"computeOutputShape",value:function(e){e=Vi(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2];return t=_u(t,this.poolSize[0],this.padding,this.strides[0]),n=_u(n,this.poolSize[1],this.padding,this.strides[1]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n]:[e[0],t,n,e[3]]}},{key:"call",value:function(e,t){var n=this;return Object(a.wf)((function(){return n.invokeCallHook(e,t),n.poolingFunction(Ui(e),n.poolSize,n.strides,n.padding,n.dataFormat)}))}},{key:"getConfig",value:function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=Object(Fo.a)(Object(Mo.a)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}($i),qc=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){return Object($r.a)(this,n),t.call(this,e)}return Object(ea.a)(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return Pa(a),Ba(r),Bc(e,t,n,r,a,"max")}}]),n}(Hc);qc.className="MaxPooling2D",a.Ze.registerClass(qc);var Kc=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){return Object($r.a)(this,n),t.call(this,e)}return Object(ea.a)(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return Pa(a),Ba(r),Bc(e,t,n,r,a,"avg")}}]),n}(Hc);Kc.className="AveragePooling2D",a.Ze.registerClass(Kc);var Xc=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;if(Object($r.a)(this,n),null==e.poolSize&&(e.poolSize=[2,2,2]),(r=t.call(this,e)).poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],null==e.strides)r.strides=r.poolSize;else if(Array.isArray(e.strides)){if(3!==e.strides.length)throw new sa("If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length "+"".concat(e.strides.length,"."));r.strides=e.strides}else r.strides=[e.strides,e.strides,e.strides];return ja(r.poolSize,"poolSize"),ja(r.strides,"strides"),r.padding=null==e.padding?"valid":e.padding,r.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,Pa(r.dataFormat),Ba(r.padding),r.inputSpec=[new Xi({ndim:5})],r}return Object(ea.a)(n,[{key:"computeOutputShape",value:function(e){e=Vi(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],r="channelsFirst"===this.dataFormat?e[4]:e[3];return t=_u(t,this.poolSize[0],this.padding,this.strides[0]),n=_u(n,this.poolSize[1],this.padding,this.strides[1]),r=_u(r,this.poolSize[2],this.padding,this.strides[2]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n,r]:[e[0],t,n,r,e[4]]}},{key:"call",value:function(e,t){var n=this;return Object(a.wf)((function(){return n.invokeCallHook(e,t),n.poolingFunction(Ui(e),n.poolSize,n.strides,n.padding,n.dataFormat)}))}},{key:"getConfig",value:function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=Object(Fo.a)(Object(Mo.a)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}($i),Yc=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){return Object($r.a)(this,n),t.call(this,e)}return Object(ea.a)(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return Pa(a),Ba(r),Wc(e,t,n,r,a,"max")}}]),n}(Xc);Yc.className="MaxPooling3D",a.Ze.registerClass(Yc);var Zc=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){return Object($r.a)(this,n),t.call(this,e)}return Object(ea.a)(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return Pa(a),Ba(r),Wc(e,t,n,r,a,"avg")}}]),n}(Xc);Zc.className="AveragePooling3D",a.Ze.registerClass(Zc);var Jc=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;return Object($r.a)(this,n),(r=t.call(this,e)).inputSpec=[new Xi({ndim:3})],r}return Object(ea.a)(n,[{key:"computeOutputShape",value:function(e){return[e[0],e[2]]}},{key:"call",value:function(e,t){throw new ua}}]),n}($i),Qc=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){return Object($r.a)(this,n),t.call(this,e||{})}return Object(ea.a)(n,[{key:"call",value:function(e,t){return Object(a.wf)((function(){var t=Ui(e);return a.Be(t,1)}))}}]),n}(Jc);Qc.className="GlobalAveragePooling1D",a.Ze.registerClass(Qc);var $c=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){return Object($r.a)(this,n),t.call(this,e||{})}return Object(ea.a)(n,[{key:"call",value:function(e,t){return Object(a.wf)((function(){var t=Ui(e);return a.xe(t,1)}))}}]),n}(Jc);$c.className="GlobalMaxPooling1D",a.Ze.registerClass($c);var el=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;return Object($r.a)(this,n),(r=t.call(this,e)).dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,Pa(r.dataFormat),r.inputSpec=[new Xi({ndim:4})],r}return Object(ea.a)(n,[{key:"computeOutputShape",value:function(e){return e=e,"channelsLast"===this.dataFormat?[e[0],e[3]]:[e[0],e[1]]}},{key:"call",value:function(e,t){throw new ua}},{key:"getConfig",value:function(){var e={dataFormat:this.dataFormat},t=Object(Fo.a)(Object(Mo.a)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}($i),tl=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(){return Object($r.a)(this,n),t.apply(this,arguments)}return Object(ea.a)(n,[{key:"call",value:function(e,t){var n=this;return Object(a.wf)((function(){var t=Ui(e);return"channelsLast"===n.dataFormat?a.Be(t,[1,2]):a.Be(t,[2,3])}))}}]),n}(el);tl.className="GlobalAveragePooling2D",a.Ze.registerClass(tl);var nl=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(){return Object($r.a)(this,n),t.apply(this,arguments)}return Object(ea.a)(n,[{key:"call",value:function(e,t){var n=this;return Object(a.wf)((function(){var t=Ui(e);return"channelsLast"===n.dataFormat?a.xe(t,[1,2]):a.xe(t,[2,3])}))}}]),n}(el);nl.className="GlobalMaxPooling2D",a.Ze.registerClass(nl);var rl=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;return Object($r.a)(this,n),(r=t.call(this,e)).layer=e.layer,r}return Object(ea.a)(n,[{key:"build",value:function(e){this.built=!0}},{key:"getWeights",value:function(){return this.layer.getWeights()}},{key:"setWeights",value:function(e){this.layer.setWeights(e)}},{key:"getConfig",value:function(){var e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},t=Object(Fo.a)(Object(Mo.a)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"setFastWeightInitDuringBuild",value:function(e){Object(Fo.a)(Object(Mo.a)(n.prototype),"setFastWeightInitDuringBuild",this).call(this,e),null!=this.layer&&this.layer.setFastWeightInitDuringBuild(e)}},{key:"trainable",get:function(){return null!=this.layer&&this.layer.trainable},set:function(e){null!=this.layer&&(this.layer.trainable=e)}},{key:"trainableWeights",get:function(){return this.layer.trainableWeights}},{key:"nonTrainableWeights",get:function(){return this.layer.nonTrainableWeights}},{key:"updates",get:function(){return this.layer._updates}},{key:"losses",get:function(){return this.layer.losses}}],[{key:"fromConfig",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=t.layer,a=zo(r,n);delete t.layer;var i={layer:a};return Object.assign(i,t),new e(i)}}]),n}($i),al=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;return Object($r.a)(this,n),(r=t.call(this,e)).supportsMasking=!0,r}return Object(ea.a)(n,[{key:"build",value:function(e){if((e=Vi(e)).length<3)throw new sa("TimeDistributed layer expects an input shape >= 3D, but received "+"input shape ".concat(JSON.stringify(e)));this.inputSpec=[{shape:e}];var t=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(t),this.layer.built=!0),Object(Fo.a)(Object(Mo.a)(n.prototype),"build",this).call(this,e)}},{key:"computeOutputShape",value:function(e){var t=[(e=Vi(e))[0]].concat(e.slice(2)),n=this.layer.computeOutputShape(t),r=e[1];return[n[0],r].concat(n.slice(1))}},{key:"call",value:function(e,t){var n=this;return Object(a.wf)((function(){return Ju((function(e,r){return[Ui(n.layer.call(e,t)),[]]}),e=Ui(e),[],!1,null,null,!1,!0)[1]}))}}]),n}(rl);al.className="TimeDistributed",a.Ze.registerClass(al);var il=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;Object($r.a)(this,n),r=t.call(this,e);var a=e.layer.getConfig(),i={};i.className=e.layer.getClassName(),i.config=a,r.forwardLayer=zo(i),a.goBackwards=!0!==a.goBackwards;var o,s={};if(s.className=e.layer.getClassName(),s.config=a,r.backwardLayer=zo(s),r.forwardLayer.name="forward_"+r.forwardLayer.name,r.backwardLayer.name="backward_"+r.backwardLayer.name,r.mergeMode=void 0===e.mergeMode?"concat":e.mergeMode,o=r.mergeMode,Sa(za,"BidirectionalMergeMode",o),e.weights)throw new ua("weights support is not implemented for Bidirectional layer yet.");return r._stateful=e.layer.stateful,r.returnSequences=e.layer.returnSequences,r.returnState=e.layer.returnState,r.supportsMasking=!0,r._trainable=!0,r.inputSpec=e.layer.inputSpec,r.numConstants=null,r}return Object(ea.a)(n,[{key:"getWeights",value:function(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}},{key:"setWeights",value:function(e){var t=e.length,n=Math.floor(t/2);this.forwardLayer.setWeights(e.slice(0,n)),this.backwardLayer.setWeights(e.slice(n))}},{key:"computeOutputShape",value:function(e){var t,n,r,a=this.forwardLayer.computeOutputShape(e);return Array.isArray(a)&&Array.isArray(a[0])||(a=[a]),a=a,this.returnState?(r=a.slice(1),t=a[0]):t=a[0],t=t,"concat"===this.mergeMode?(t[t.length-1]*=2,n=[t]):n=null==this.mergeMode?[t,t.slice()]:[t],this.returnState?null==this.mergeMode?n.concat(r).concat(r.slice()):[t].concat(r).concat(r.slice()):ha(n)}},{key:"apply",value:function(e,t){var r=null==t?null:t.initialState,a=null==t?null:t.constants;null==t&&(t={});var i=Zu(e,r,a,this.numConstants);if(e=i.inputs,r=i.initialState,a=i.constants,Array.isArray(e)&&(r=e.slice(1),e=e[0]),(null==r||0===r.length)&&null==a)return Object(Fo.a)(Object(Mo.a)(n.prototype),"apply",this).call(this,e,t);var o=[],s=[];if(null!=r){var u=r.length;if(u%2>0)throw new sa("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");t.initialState=r,o.push.apply(o,Object(qn.a)(r));var c=r.map((function(e){return new Xi({shape:e.shape})}));this.forwardLayer.stateSpec=c.slice(0,u/2),this.backwardLayer.stateSpec=c.slice(u/2),s.push.apply(s,Object(qn.a)(c))}if(null!=a)throw new ua("Support for constants in Bidirectional layers is not implemented yet.");for(var l=o[0]instanceof Yi,d=0,p=o;d<p.length;d++){if(p[d]instanceof Yi!==l)throw new sa("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors")}if(l){var f=[e].concat(o),h=this.inputSpec.concat(s),m=this.inputSpec;this.inputSpec=h;var v=Object(Fo.a)(Object(Mo.a)(n.prototype),"apply",this).call(this,f,t);return this.inputSpec=m,v}return Object(Fo.a)(Object(Mo.a)(n.prototype),"apply",this).call(this,e,t)}},{key:"call",value:function(e,t){var n=this;return Object(a.wf)((function(){var r,i,o,s,u=t.initialState;if(null==u)r=n.forwardLayer.call(e,t),i=n.backwardLayer.call(e,t);else{var c=u.slice(0,u.length/2),l=u.slice(u.length/2);r=n.forwardLayer.call(e,Object.assign(t,{initialState:c})),i=n.backwardLayer.call(e,Object.assign(t,{initialState:l}))}return n.returnState&&(Array.isArray(r)&&(o=r.slice(1).concat(i.slice(1))),r=r[0],i=i[0]),n.returnSequences&&(i=a.Ve(i,1)),"concat"===n.mergeMode?s=oi([r,i]):"sum"===n.mergeMode?s=a.sd(r,i):"ave"===n.mergeMode?s=a.Fe(.5,a.sd(r,i)):"mul"===n.mergeMode?s=a.Fe(r,i):null==n.mergeMode&&(s=[r,i]),n.returnState?null==n.mergeMode?s.concat(o):[s].concat(o):s}))}},{key:"resetStates",value:function(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}},{key:"build",value:function(e){var t=this;Va(this.forwardLayer.name,(function(){t.forwardLayer.build(e)})),Va(this.backwardLayer.name,(function(){t.backwardLayer.build(e)})),this.built=!0}},{key:"computeMask",value:function(e,t){var n;if(Array.isArray(t)&&(t=t[0]),n=this.returnSequences?null==this.mergeMode?[t,t]:t:null==this.mergeMode?[null,null]:null,this.returnState){var r=this.forwardLayer.states.map((function(e){return null}));return Array.isArray(n)?n.concat(r).concat(r):[n].concat(r).concat(r)}return n}},{key:"setFastWeightInitDuringBuild",value:function(e){Object(Fo.a)(Object(Mo.a)(n.prototype),"setFastWeightInitDuringBuild",this).call(this,e),null!=this.forwardLayer&&this.forwardLayer.setFastWeightInitDuringBuild(e),null!=this.backwardLayer&&this.backwardLayer.setFastWeightInitDuringBuild(e)}},{key:"getConfig",value:function(){var e={mergeMode:this.mergeMode},t=Object(Fo.a)(Object(Mo.a)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"trainable",get:function(){return this._trainable},set:function(e){this._trainable=e,null!=this.forwardLayer&&(this.forwardLayer.trainable=e),null!=this.backwardLayer&&(this.backwardLayer.trainable=e)}},{key:"trainableWeights",get:function(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}},{key:"nonTrainableWeights",get:function(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}}],[{key:"fromConfig",value:function(e,t){var n=zo(t.layer);if(delete t.layer,null!=t.numConstants)throw new ua("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");var r=t;return r.layer=n,new e(r)}}]),n}(rl);il.className="Bidirectional",a.Ze.registerClass(il);var ol=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r;return Object($r.a)(this,n),(r=t.call(this,e)).scale=e.scale,e.offset?r.offset=e.offset:r.offset=0,r}return Object(ea.a)(n,[{key:"getConfig",value:function(){var e={scale:this.scale,offset:this.offset},t=Object(Fo.a)(Object(Mo.a)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"call",value:function(e,t){var n=this;return Object(a.wf)((function(){return"float32"!==(e=Ui(e)).dtype&&(e=ei(e,"float32")),Object(a.sd)(Object(a.Fe)(e,n.scale),n.offset)}))}}]),n}($i);ol.className="Rescaling",a.Ze.registerClass(ol);Object(a.be)().registerFlag("KEEP_INTERMEDIATE_TENSORS",(function(){return!1}),(function(e){e&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")}));var sl=n(68),ul=n(5),cl=function(){function e(t,n,r){var a=this;Object($r.a)(this,e),this.node=t,this.tensorMap=n,this.context=r,this.inputs=[],this.attrs={},this.inputs=t.inputNames.map((function(e){return a.getInput(e)})),null!=t.rawAttrs&&(this.attrs=Object.keys(t.rawAttrs).reduce((function(e,t){return e[t]=a.getAttr(t),e}),{}))}return Object(ea.a)(e,[{key:"getInput",value:function(e){return Object(ul.e)(e,this.tensorMap,this.context)}},{key:"getAttr",value:function(e,t){var n=this.node.rawAttrs[e];if(null!=n.tensor)return Object(ul.e)(e,this.tensorMap,this.context);if(null!=n.i||null!=n.f)return Object(sl.f)(this.node.rawAttrs,e,t);if(null!=n.s)return Object(sl.i)(this.node.rawAttrs,e,t);if(null!=n.b)return Object(sl.c)(this.node.rawAttrs,e,t);if(null!=n.shape)return Object(sl.k)(this.node.rawAttrs,e,t);if(null!=n.type)return Object(sl.e)(this.node.rawAttrs,e,t);if(null!=n.list){if(null!=n.list.i||null!=n.list.f)return Object(sl.g)(this.node.rawAttrs,e,t);if(null!=n.list.s)return Object(sl.h)(this.node.rawAttrs,e,t);if(null!=n.list.shape)return Object(sl.j)(this.node.rawAttrs,e,t);if(null!=n.list.b)return Object(sl.b)(this.node.rawAttrs,e,t);if(null!=n.list.type)return Object(sl.d)(this.node.rawAttrs,e,t)}return t}}]),e}(),ll=n(112),dl=n(31),pl=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r;switch(e.op){case"BiasAdd":case"AddV2":case"Add":return[a.add(Object(ul.d)("a",e,t,n),Object(ul.d)("b",e,t,n))];case"AddN":return[a.addN(Object(ul.d)("tensors",e,t,n))];case"FloorMod":case"Mod":return[a.mod(Object(ul.d)("a",e,t,n),Object(ul.d)("b",e,t,n))];case"Mul":return[a.mul(Object(ul.d)("a",e,t,n),Object(ul.d)("b",e,t,n))];case"RealDiv":case"Div":return[a.div(Object(ul.d)("a",e,t,n),Object(ul.d)("b",e,t,n))];case"DivNoNan":return[a.divNoNan(Object(ul.d)("a",e,t,n),Object(ul.d)("b",e,t,n))];case"FloorDiv":return[a.floorDiv(Object(ul.d)("a",e,t,n),Object(ul.d)("b",e,t,n))];case"Sub":return[a.sub(Object(ul.d)("a",e,t,n),Object(ul.d)("b",e,t,n))];case"Minimum":return[a.minimum(Object(ul.d)("a",e,t,n),Object(ul.d)("b",e,t,n))];case"Maximum":return[a.maximum(Object(ul.d)("a",e,t,n),Object(ul.d)("b",e,t,n))];case"Pow":return[a.pow(Object(ul.d)("a",e,t,n),Object(ul.d)("b",e,t,n))];case"SquaredDifference":return[a.squaredDifference(Object(ul.d)("a",e,t,n),Object(ul.d)("b",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},fl=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r;switch(e.op){case"Abs":case"ComplexAbs":return[a.abs(Object(ul.d)("x",e,t,n))];case"Acos":return[a.acos(Object(ul.d)("x",e,t,n))];case"Acosh":return[a.acosh(Object(ul.d)("x",e,t,n))];case"Asin":return[a.asin(Object(ul.d)("x",e,t,n))];case"Asinh":return[a.asinh(Object(ul.d)("x",e,t,n))];case"Atan":return[a.atan(Object(ul.d)("x",e,t,n))];case"Atan2":return[a.atan2(Object(ul.d)("x",e,t,n),Object(ul.d)("y",e,t,n))];case"Atanh":return[a.atanh(Object(ul.d)("x",e,t,n))];case"Ceil":return[a.ceil(Object(ul.d)("x",e,t,n))];case"Complex":return[a.complex(Object(ul.d)("real",e,t,n),Object(ul.d)("imag",e,t,n))];case"Cos":return[a.cos(Object(ul.d)("x",e,t,n))];case"Cosh":return[a.cosh(Object(ul.d)("x",e,t,n))];case"Elu":return[a.elu(Object(ul.d)("x",e,t,n))];case"Erf":return[a.erf(Object(ul.d)("x",e,t,n))];case"Exp":return[a.exp(Object(ul.d)("x",e,t,n))];case"Expm1":return[a.expm1(Object(ul.d)("x",e,t,n))];case"Floor":return[a.floor(Object(ul.d)("x",e,t,n))];case"Log":return[a.log(Object(ul.d)("x",e,t,n))];case"Log1p":return[a.log1p(Object(ul.d)("x",e,t,n))];case"Imag":return[a.imag(Object(ul.d)("x",e,t,n))];case"Neg":return[a.neg(Object(ul.d)("x",e,t,n))];case"Reciprocal":return[a.reciprocal(Object(ul.d)("x",e,t,n))];case"Real":return[a.real(Object(ul.d)("x",e,t,n))];case"Relu":return[a.relu(Object(ul.d)("x",e,t,n))];case"Round":return[a.round(Object(ul.d)("x",e,t,n))];case"Selu":return[a.selu(Object(ul.d)("x",e,t,n))];case"Sigmoid":return[a.sigmoid(Object(ul.d)("x",e,t,n))];case"Sin":return[a.sin(Object(ul.d)("x",e,t,n))];case"Sign":return[a.sign(Object(ul.d)("x",e,t,n))];case"Sinh":return[a.sinh(Object(ul.d)("x",e,t,n))];case"Softplus":return[a.softplus(Object(ul.d)("x",e,t,n))];case"Sqrt":return[a.sqrt(Object(ul.d)("x",e,t,n))];case"Square":return[a.square(Object(ul.d)("x",e,t,n))];case"Tanh":return[a.tanh(Object(ul.d)("x",e,t,n))];case"Tan":return[a.tan(Object(ul.d)("x",e,t,n))];case"ClipByValue":return[a.clipByValue(Object(ul.d)("x",e,t,n),Object(ul.d)("clipValueMin",e,t,n),Object(ul.d)("clipValueMax",e,t,n))];case"Relu6":return[a.relu6(Object(ul.d)("x",e,t,n))];case"Rsqrt":return[a.rsqrt(Object(ul.e)(e.inputNames[0],t,n))];case"Prod":return[a.prod(Object(ul.d)("x",e,t,n),Object(ul.d)("axes",e,t,n))];case"LeakyRelu":return[a.leakyRelu(Object(ul.d)("x",e,t,n),Object(ul.d)("alpha",e,t,n))];case"Prelu":return[a.prelu(Object(ul.d)("x",e,t,n),Object(ul.d)("alpha",e,t,n))];case"IsNan":return[a.isNaN(Object(ul.e)(e.inputNames[0],t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}};function hl(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if("number"!==typeof e&&"number"!==typeof t){a.Df.assert(e.length===t.length,(function(){return n+" Shapes ".concat(e," and ").concat(t," must match")}));for(var r=0;r<e.length;r++){var i=e[r],o=t[r];a.Df.assert(i<0||o<0||i===o,(function(){return n+" Shapes ".concat(e," and ").concat(t," must match")}))}}}function ml(e){return"number"!==typeof e&&!e.some((function(e){return e<0}))}function vl(e,t,n){var r=bl(e,n),a=!ml(r);if(a&&0===t.length)throw new Error("Tried to calculate elements of an empty list"+" with non-fully-defined elementShape: ".concat(r));if(a&&t.forEach((function(e){r=bl(e.shape,r)})),!ml(r))throw new Error("Non-fully-defined elementShape: ".concat(r));return r}function bl(e,t){if("number"===typeof e)return t;if("number"===typeof t)return e;if(e.length!==t.length)throw new Error("Incompatible ranks during merge: ".concat(e," vs. ").concat(t));for(var n=[],r=0;r<e.length;++r){var a=e[r],i=t[r];if(a>=0&&i>=0&&a!==i)throw new Error("Incompatible shape during merge: ".concat(e," vs. ").concat(t));n[r]=a>=0?a:i}return n}var gl=function(){function e(t,n,r,i,o,s,u){Object($r.a)(this,e),this.name=t,this.dtype=n,this.maxSize=r,this.elementShape=i,this.identicalElementShapes=o,this.dynamicSize=s,this.clearAfterRead=u,this.tensors=[],this.closed_=!1,this.idTensor=Object(a.We)(0),Object(a.oe)(this.idTensor)}return Object(ea.a)(e,[{key:"clearAndClose",value:function(e){this.tensors.forEach((function(t){null!=e&&e.has(t.tensor.id)||t.tensor.dispose()})),this.tensors=[],this.closed_=!0,this.idTensor.dispose()}},{key:"size",value:function(){return this.tensors.length}},{key:"read",value:function(e){if(this.closed_)throw new Error("TensorArray ".concat(this.name," has already been closed."));if(e<0||e>=this.size())throw new Error("Tried to read from index ".concat(e,", but array size is: ").concat(this.size()));var t=this.tensors[e];if(t.cleared)throw new Error("TensorArray ".concat(this.name,": Could not read index ").concat(e," twice because it was cleared after a previous read ")+"(perhaps try setting clear_after_read = false?).");return this.clearAfterRead&&(t.cleared=!0),t.read=!0,t.tensor}},{key:"readMany",value:function(e){var t=this;return e.map((function(e){return t.read(e)}))}},{key:"write",value:function(e,t){if(this.closed_)throw new Error("TensorArray ".concat(this.name," has already been closed."));if(e<0||!this.dynamicSize&&e>=this.maxSize)throw new Error("Tried to write to index ".concat(e,", but array is not resizeable and size is: ").concat(this.maxSize));var n=this.tensors[e]||{};if(t.dtype!==this.dtype)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,",\n          because the value dtype is ").concat(t.dtype,", but TensorArray dtype is ").concat(this.dtype,"."));if(0!==this.size()||null!=this.elementShape&&0!==this.elementShape.length||(this.elementShape=t.shape),hl(this.elementShape,t.shape,"TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,".")),n.read)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,", because it has already been read."));if(n.written)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,", because it has already been written."));n.tensor=t,Object(a.oe)(t),n.written=!0,this.tensors[e]=n}},{key:"writeMany",value:function(e,t){var n=this;if(e.length!==t.length)throw new Error("TensorArray ".concat(this.name,": could not write multiple tensors,")+"because the index size: ".concat(e.length," is not the same as tensors size: ").concat(t.length,"."));e.forEach((function(e,r){return n.write(e,t[r])}))}},{key:"gather",value:function(e,t){if(t&&t!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but gather requested dtype ").concat(t));if(e)e=e.slice(0,this.size());else{e=[];for(var n=0;n<this.size();n++)e.push(n)}if(0===e.length)return Object(a.sf)([],[0].concat(this.elementShape));var r=this.readMany(e);return hl(this.elementShape,r[0].shape,"TensorArray shape mismatch: "),Object(a.nf)(r,0)}},{key:"concat",value:function(e){if(e&&e!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but concat requested dtype ").concat(e));if(0===this.size())return Object(a.sf)([],[0].concat(this.elementShape));for(var t=[],n=0;n<this.size();n++)t.push(n);var r=this.readMany(t);return hl(this.elementShape,r[0].shape,"TensorArray shape mismatch: tensor array shape (".concat(this.elementShape,") vs first tensor shape (").concat(r[0].shape,")")),Object(a.Kd)(r,0)}},{key:"scatter",value:function(e,t){if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but tensor has dtype ").concat(t.dtype));if(e.length!==t.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: ".concat(e.length," vs. ").concat(t.shape[0]));var n=Math.max.apply(Math,Object(qn.a)(e));if(!this.dynamicSize&&n>=this.maxSize)throw new Error("Max index must be < array size (".concat(n,"  vs. ").concat(this.maxSize,")"));this.writeMany(e,Object(a.Bf)(t,0))}},{key:"split",value:function(e,t){var n=this;if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but tensor has dtype ").concat(t.dtype));var r=0,i=e.map((function(e){return r+=e}));if(r!==t.shape[0])throw new Error("Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ".concat(r,", and tensor's shape is: ").concat(t.shape));if(!this.dynamicSize&&e.length!==this.maxSize)throw new Error("TensorArray's size is not equal to the size of lengths (".concat(this.maxSize," vs. ").concat(e.length,"), ")+"and the TensorArray is not marked as dynamically resizeable");var o=0===r?0:t.size/r,s=[];Object(a.wf)((function(){t=Object(a.Ue)(t,[1,r,o]);for(var u=0;u<e.length;++u){var c=[0,0===u?0:i[u-1],0],l=[1,e[u],o];s[u]=Object(a.Ue)(Object(a.cf)(t,c,l),n.elementShape)}return s}));for(var u=[],c=0;c<e.length;c++)u[c]=c;this.writeMany(u,s)}},{key:"id",get:function(){return this.idTensor.id}},{key:"closed",get:function(){return this.closed_}}]),e}(),yl=function(){function e(t,n,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1;Object($r.a)(this,e),this.tensors=t,this.elementShape=n,this.elementDtype=r,null!=t&&t.forEach((function(e){if(r!==e.dtype)throw new Error("Invalid data types; op elements ".concat(r,", but list elements ").concat(e.dtype));hl(n,e.shape,"TensorList shape mismatch: "),Object(a.oe)(e)})),this.idTensor=Object(a.We)(0),this.maxNumElements=i,Object(a.oe)(this.idTensor)}return Object(ea.a)(e,[{key:"copy",value:function(){return new e(Object(qn.a)(this.tensors),this.elementShape,this.elementDtype)}},{key:"clearAndClose",value:function(e){this.tensors.forEach((function(t){null!=e&&e.has(t.id)||t.dispose()})),this.tensors.length=0,this.idTensor.dispose()}},{key:"size",value:function(){return this.tensors.length}},{key:"stack",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));if(-1!==r&&this.tensors.length!==r)throw new Error("Operation expected a list with ".concat(r," elements but got a list with ").concat(this.tensors.length," elements."));hl(e,this.elementShape,"TensorList shape mismatch: ");var i=vl(this.elementShape,this.tensors,e);return Object(a.wf)((function(){var e=n.tensors.map((function(e){return Object(a.Ue)(e,i)}));return Object(a.nf)(e,0)}))}},{key:"popBack",value:function(e,t){if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));if(0===this.size())throw new Error("Trying to pop from an empty list.");var n=vl(this.elementShape,this.tensors,e),r=this.tensors.pop();return r.kept=!1,hl(r.shape,e,"TensorList shape mismatch: "),Object(a.Ue)(r,n)}},{key:"pushBack",value:function(e){if(e.dtype!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(e.dtype,", but list elements ").concat(this.elementDtype));if(hl(e.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");Object(a.oe)(e),this.tensors.push(e)}},{key:"resize",value:function(t){if(t<0)throw new Error("TensorListResize expects size to be non-negative. Got: ".concat(t));if(-1!==this.maxNumElements&&t>this.maxNumElements)throw new Error("TensorListResize input size ".concat(t," is greater maxNumElement ").concat(this.maxNumElements,"."));var n=new e([],this.elementShape,this.elementDtype,this.maxNumElements);n.tensors.length=t;for(var r=0;r<Math.min(this.tensors.length,t);++r)n.tensors[r]=this.tensors[r];return n}},{key:"getItem",value:function(e,t,n){if(n!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(n,", but list elements ").concat(this.elementDtype));if(e<0||e>this.tensors.length)throw new Error("Trying to access element ".concat(e," in a list with ").concat(this.tensors.length," elements."));if(null==this.tensors[e])throw new Error("element at index ".concat(e," is null."));hl(this.tensors[e].shape,t,"TensorList shape mismatch: ");var r=vl(this.elementShape,this.tensors,t);return Object(a.Ue)(this.tensors[e],r)}},{key:"setItem",value:function(e,t){if(t.dtype!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t.dtype,", but list elements ").concat(this.elementDtype));if(e<0||-1!==this.maxNumElements&&e>=this.maxNumElements)throw new Error("Trying to set element ".concat(e," in a list with max ").concat(this.maxNumElements," elements."));hl(this.elementShape,t.shape,"TensorList shape mismatch: "),Object(a.oe)(t),null!=this.tensors[e]&&(this.tensors[e].kept=!1),this.tensors[e]=t}},{key:"gather",value:function(e,t,n){var r=this;if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));hl(this.elementShape,n,"TensorList shape mismatch: "),e=e.slice(0,this.size());var i=vl(this.elementShape,this.tensors,n);return 0===e.length?Object(a.sf)([],[0].concat(i)):Object(a.wf)((function(){var t=e.map((function(e){return Object(a.Ue)(r.tensors[e],i)}));return Object(a.nf)(t,0)}))}},{key:"concat",value:function(e,t){var n=this;if(e&&e!==this.elementDtype)throw new Error("TensorList dtype is ".concat(this.elementDtype," but concat requested dtype ").concat(e));hl(this.elementShape,t,"TensorList shape mismatch: ");var r=vl(this.elementShape,this.tensors,t);return 0===this.size()?Object(a.sf)([],[0].concat(r)):Object(a.wf)((function(){var e=n.tensors.map((function(e){return Object(a.Ue)(e,r)}));return Object(a.Kd)(e,0)}))}},{key:"id",get:function(){return this.idTensor.id}}]),e}();function xl(e,t,n){var r=e.dtype;if(e.shape.length<1)throw new Error("Tensor must be at least a vector, but saw shape: ".concat(e.shape));if(e.dtype!==n)throw new Error("Invalid data types; op elements ".concat(e.dtype,", but list elements ").concat(n));hl(e.shape.slice(1),t,"TensorList shape mismatch: ");var i=Object(a.Bf)(e);return new yl(i,t,r)}function kl(e,t,n,r){return new yl([],e,t,r)}function wl(e,t,n,r){if(t.length!==e.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: ".concat(t.length," vs. ").concat(e.shape[0]));var i=Math.max.apply(Math,Object(qn.a)(t));if(null!=r&&-1!==r&&i>=r)throw new Error("Max index must be < array size (".concat(i,"  vs. ").concat(r,")"));var o=new yl([],n,e.dtype,r),s=Object(a.Bf)(e,0);return t.forEach((function(e,t){o.setItem(e,s[t])})),o}function Ol(e,t,n){var r=0,i=t.map((function(e){return r+=e}));if(r!==e.shape[0])throw new Error("Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ".concat(r,", and tensor's shape is: ").concat(e.shape));for(var o=bl(e.shape.slice(1),n),s=0===r?0:e.size/r,u=Object(a.wf)((function(){var n=[];e=Object(a.Ue)(e,[1,r,s]);for(var u=0;u<t.length;++u){var c=[0,0===u?0:i[u-1],0],l=[1,t[u],s];n[u]=Object(a.Ue)(Object(a.cf)(e,c,l),o)}return e.dispose(),n})),c=new yl([],n,e.dtype,t.length),l=0;l<u.length;l++)c.setItem(l,u[l]);return c}var Il=function(){var e=Object(Oo.a)(wo.a.mark((function e(t,n,r){var i,o,s,u,c,l,d,p,f,h,m,v,b,g,y,x,k,w,O,I,S,N,j,T,C,E,_,A,R,D,F,M,z,L,P,B,W,U,V,G,H,q,K,X,Y,Z,J,Q,$,ee,te,ne,re,ae,ie,oe,se,ue,ce,le,de,pe,fe,he,me,ve,be,ge,ye,xe,ke,we,Oe,Ie,Se,Ne,je,Te,Ce,Ee,_e,Ae,Re,De,Fe,Me,ze,Le,Pe,Be,We,Ue,Ve,Ge,He,qe,Ke,Xe,Ye,Ze,Je,Qe,$e;return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.op,e.next="If"===e.t0||"StatelessIf"===e.t0?3:"While"===e.t0||"StatelessWhile"===e.t0?15:"LoopCond"===e.t0?19:"Switch"===e.t0?21:"Merge"===e.t0?32:"Enter"===e.t0?37:"Exit"===e.t0?41:"NextIteration"===e.t0?44:"TensorArrayV3"===e.t0?47:"TensorArrayWriteV3"===e.t0?57:"TensorArrayReadV3"===e.t0?63:"TensorArrayGatherV3"===e.t0?67:"TensorArrayScatterV3"===e.t0?72:"TensorArrayConcatV3"===e.t0?78:"TensorArraySplitV3"===e.t0?82:"TensorArraySizeV3"===e.t0?88:"TensorArrayCloseV3"===e.t0?91:"TensorListSetItem"===e.t0?95:"TensorListGetItem"===e.t0?101:"TensorListScatterV2"===e.t0||"TensorListScatter"===e.t0?107:"TensorListReserve"===e.t0||"EmptyTensorList"===e.t0?114:"TensorListGather"===e.t0?122:"TensorListStack"===e.t0?128:"TensorListFromTensor"===e.t0?134:"TensorListConcat"===e.t0||"TensorListConcatV2"===e.t0?140:"TensorListPushBack"===e.t0?145:"TensorListPopBack"===e.t0?150:"TensorListSplit"===e.t0?155:"TensorListLength"===e.t0?161:"TensorListResize"===e.t0?164:170;break;case 3:return i=Object(ul.d)("thenBranch",t,n,r),o=Object(ul.d)("elseBranch",t,n,r),s=Object(ul.d)("cond",t,n,r),u=Object(ul.d)("args",t,n,r),e.next=9,s.data();case 9:if(!e.sent[0]){e.next=14;break}return e.abrupt("return",r.functionMap[i].executeFunctionAsync(u,r.tensorArrayMap,r.tensorListMap));case 14:return e.abrupt("return",r.functionMap[o].executeFunctionAsync(u,r.tensorArrayMap,r.tensorListMap));case 15:return e.delegateYield(wo.a.mark((function e(){var a,i,o,s,u,c,l,d;return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Object(ul.d)("body",t,n,r),i=Object(ul.d)("cond",t,n,r),o=Object(ul.d)("args",t,n,r),e.next=5,r.functionMap[i].executeFunctionAsync(o,r.tensorArrayMap,r.tensorListMap);case 5:return s=e.sent,u=o.map((function(e){return e.id})),e.next=9,s[0].data();case 9:c=e.sent,s.forEach((function(e){e.kept||-1!==u.indexOf(e.id)||e.dispose()})),l=o,d=wo.a.mark((function e(){var t,n,o;return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=l,e.next=3,r.functionMap[a].executeFunctionAsync(l,r.tensorArrayMap,r.tensorListMap);case 3:return l=e.sent,n=l.map((function(e){return e.id})),t.forEach((function(e){e.kept||-1!==u.indexOf(e.id)||-1!==n.indexOf(e.id)||e.dispose()})),e.next=8,r.functionMap[i].executeFunctionAsync(l,r.tensorArrayMap,r.tensorListMap);case 8:return o=e.sent,e.next=11,o[0].data();case 11:c=e.sent,o.forEach((function(e){e.kept||-1!==u.indexOf(e.id)||-1!==n.indexOf(e.id)||e.dispose()}));case 13:case"end":return e.stop()}}),e)}));case 13:if(!c[0]){e.next=17;break}return e.delegateYield(d(),"t0",15);case 15:e.next=13;break;case 17:return e.abrupt("return",{v:l});case 18:case"end":return e.stop()}}),e)}))(),"t1",16);case 16:if("object"!==typeof(c=e.t1)){e.next=19;break}return e.abrupt("return",c.v);case 19:return l=Object(ul.d)("pred",t,n,r),e.abrupt("return",[Object(ul.a)(l)]);case 21:return d=Object(ul.d)("pred",t,n,r),(p=Object(ul.d)("data",t,n,r)).kept||(p=Object(ul.a)(p)),e.next=26,d.data();case 26:if(!e.sent[0]){e.next=30;break}e.t2=[void 0,p],e.next=31;break;case 30:e.t2=[p,void 0];case 31:return e.abrupt("return",e.t2);case 32:if(!(f=t.inputNames.find((function(e){return void 0!==Object(ul.e)(e,n,r)})))){e.next=36;break}return h=Object(ul.e)(f,n,r),e.abrupt("return",[Object(ul.a)(h)]);case 36:return e.abrupt("return",void 0);case 37:return m=Object(ul.d)("frameName",t,n,r),v=Object(ul.d)("tensor",t,n,r),r.enterFrame(m),e.abrupt("return",[Object(ul.a)(v)]);case 41:return b=Object(ul.d)("tensor",t,n,r),r.exitFrame(),e.abrupt("return",[Object(ul.a)(b)]);case 44:return g=Object(ul.d)("tensor",t,n,r),r.nextIteration(),e.abrupt("return",[Object(ul.a)(g)]);case 47:return y=Object(ul.d)("size",t,n,r),x=Object(ul.d)("dtype",t,n,r),k=Object(ul.d)("elementShape",t,n,r),w=Object(ul.d)("dynamicSize",t,n,r),O=Object(ul.d)("clearAfterRead",t,n,r),I=Object(ul.d)("identicalElementShapes",t,n,r),S=Object(ul.d)("name",t,n,r),N=new gl(S,x,y,k,I,w,O),r.addTensorArray(N),e.abrupt("return",[N.idTensor,Object(a.We)(1)]);case 57:return j=Object(ul.d)("tensorArrayId",t,n,r),T=Object(ul.d)("index",t,n,r),C=Object(ul.d)("tensor",t,n,r),(E=r.getTensorArray(j.id)).write(T,C),e.abrupt("return",[E.idTensor]);case 63:return _=Object(ul.d)("tensorArrayId",t,n,r),A=Object(ul.d)("index",t,n,r),R=r.getTensorArray(_.id),e.abrupt("return",[R.read(A)]);case 67:return D=Object(ul.d)("tensorArrayId",t,n,r),F=Object(ul.d)("indices",t,n,r),M=Object(ul.d)("dtype",t,n,r),z=r.getTensorArray(D.id),e.abrupt("return",[z.gather(F,M)]);case 72:return L=Object(ul.d)("tensorArrayId",t,n,r),P=Object(ul.d)("indices",t,n,r),B=Object(ul.d)("tensor",t,n,r),(W=r.getTensorArray(L.id)).scatter(P,B),e.abrupt("return",[W.idTensor]);case 78:return U=Object(ul.d)("tensorArrayId",t,n,r),V=r.getTensorArray(U.id),G=Object(ul.d)("dtype",t,n,r),e.abrupt("return",[V.concat(G)]);case 82:return H=Object(ul.d)("tensorArrayId",t,n,r),q=Object(ul.d)("tensor",t,n,r),K=Object(ul.d)("lengths",t,n,r),(X=r.getTensorArray(H.id)).split(K,q),e.abrupt("return",[X.idTensor]);case 88:return Y=Object(ul.d)("tensorArrayId",t,n,r),Z=r.getTensorArray(Y.id),e.abrupt("return",[Object(a.We)(Z.size(),"int32")]);case 91:return J=Object(ul.d)("tensorArrayId",t,n,r),(Q=r.getTensorArray(J.id)).clearAndClose(),e.abrupt("return",[Q.idTensor]);case 95:return $=Object(ul.d)("tensorListId",t,n,r),ee=Object(ul.d)("index",t,n,r),te=Object(ul.d)("tensor",t,n,r),(ne=r.getTensorList($.id)).setItem(ee,te),e.abrupt("return",[ne.idTensor]);case 101:return re=Object(ul.d)("tensorListId",t,n,r),ae=Object(ul.d)("index",t,n,r),ie=Object(ul.d)("elementShape",t,n,r),oe=Object(ul.d)("elementDType",t,n,r),se=r.getTensorList(re.id),e.abrupt("return",[se.getItem(ae,ie,oe)]);case 107:return ue=Object(ul.d)("indices",t,n,r),ce=Object(ul.d)("tensor",t,n,r),le=Object(ul.d)("elementShape",t,n,r),de=Object(ul.d)("numElements",t,n,r),pe=wl(ce,ue,le,de),r.addTensorList(pe),e.abrupt("return",[pe.idTensor]);case 114:return fe=Object(ul.d)("elementShape",t,n,r),he=Object(ul.d)("elementDType",t,n,r),me="TensorListReserve"===t.op?"numElements":"maxNumElements",ve=Object(ul.d)(me,t,n,r),be="TensorListReserve"===t.op?-1:ve,ge=kl(fe,he,0,be),r.addTensorList(ge),e.abrupt("return",[ge.idTensor]);case 122:return ye=Object(ul.d)("tensorListId",t,n,r),xe=Object(ul.d)("indices",t,n,r),ke=Object(ul.d)("elementShape",t,n,r),we=Object(ul.d)("elementDType",t,n,r),Oe=r.getTensorList(ye.id),e.abrupt("return",[Oe.gather(xe,we,ke)]);case 128:return Ie=Object(ul.d)("tensorListId",t,n,r),Se=Object(ul.d)("elementShape",t,n,r),Ne=Object(ul.d)("elementDType",t,n,r),je=Object(ul.d)("numElements",t,n,r),Te=r.getTensorList(Ie.id),e.abrupt("return",[Te.stack(Se,Ne,je)]);case 134:return Ce=Object(ul.d)("tensor",t,n,r),Ee=Object(ul.d)("elementShape",t,n,r),_e=Object(ul.d)("elementDType",t,n,r),Ae=xl(Ce,Ee,_e),r.addTensorList(Ae),e.abrupt("return",[Ae.idTensor]);case 140:return Re=Object(ul.d)("tensorListId",t,n,r),De=r.getTensorList(Re.id),Fe=Object(ul.d)("dtype",t,n,r),Me=Object(ul.d)("elementShape",t,n,r),e.abrupt("return",[De.concat(Fe,Me)]);case 145:return ze=Object(ul.d)("tensorListId",t,n,r),Le=Object(ul.d)("tensor",t,n,r),(Pe=r.getTensorList(ze.id)).pushBack(Le),e.abrupt("return",[Pe.idTensor]);case 150:return Be=Object(ul.d)("tensorListId",t,n,r),We=Object(ul.d)("elementShape",t,n,r),Ue=Object(ul.d)("elementDType",t,n,r),Ve=r.getTensorList(Be.id),e.abrupt("return",[Ve.popBack(We,Ue)]);case 155:return Ge=Object(ul.d)("tensor",t,n,r),He=Object(ul.d)("elementShape",t,n,r),qe=Object(ul.d)("lengths",t,n,r),Ke=Ol(Ge,qe,He),r.addTensorList(Ke),e.abrupt("return",[Ke.idTensor]);case 161:return Xe=Object(ul.d)("tensorListId",t,n,r),Ye=r.getTensorList(Xe.id),e.abrupt("return",[Object(a.We)(Ye.size(),"int32")]);case 164:return Ze=Object(ul.d)("tensorListId",t,n,r),Je=Object(ul.d)("size",t,n,r),Qe=r.getTensorList(Ze.id),$e=Qe.resize(Je),r.addTensorList($e),e.abrupt("return",[$e.idTensor]);case 170:throw TypeError("Node type ".concat(t.op," is not implemented"));case 171:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}();function Sl(e,t,n){var r=Object(ul.d)("fusedOps",e,t,n),a=Object(i.a)(r,2),o=a[0],s=a[1],u="biasadd"===o,c=!u,l="prelu"===s,d="fusedbatchnorm"===o,p=Object(ul.d)("numArgs",e,t,n);if(u){if(l&&2!==p)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!l&&u&&1!==p)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(d)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported");var f=Object(ul.d)("strides",e,t,n),h=Object(ul.c)(e,t,n),m=Object(ul.d)("dataFormat",e,t,n).toUpperCase(),v=Object(ul.d)("dilations",e,t,n),b=Object(ul.d)("args",e,t,n),g=Object(i.a)(b,2),y=g[0],x=g[1];return c&&(x=y,y=void 0),{stride:f,pad:h,dataFormat:m,dilations:v,biasArg:y,preluArg:x,activationFunc:s,leakyreluAlpha:Object(ul.d)("leakyreluAlpha",e,t,n)}}var Nl=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r;switch(e.op){case"Conv1D":var i=Object(ul.d)("stride",e,t,n),o=Object(ul.d)("pad",e,t,n),s=Object(ul.d)("dataFormat",e,t,n).toUpperCase(),u=Object(ul.d)("dilation",e,t,n);return[a.conv1d(Object(ul.d)("x",e,t,n),Object(ul.d)("filter",e,t,n),i,o,s,u)];case"Conv2D":var c=Object(ul.d)("strides",e,t,n),l=Object(ul.c)(e,t,n),d=Object(ul.d)("dataFormat",e,t,n).toUpperCase(),p=Object(ul.d)("dilations",e,t,n);return[a.conv2d(Object(ul.d)("x",e,t,n),Object(ul.d)("filter",e,t,n),[c[1],c[2]],l,d,[p[1],p[2]])];case"_FusedConv2D":var f=Sl(e,t,n),h=f.stride,m=f.pad,v=f.dataFormat,b=f.dilations,g=f.biasArg,y=f.preluArg,x=f.activationFunc,k=f.leakyreluAlpha;return[a.fused.conv2d({x:Object(ul.d)("x",e,t,n),filter:Object(ul.d)("filter",e,t,n),strides:[h[1],h[2]],pad:m,dataFormat:v,dilations:[b[1],b[2]],bias:g,activation:x,preluActivationWeights:y,leakyreluAlpha:k})];case"FusedDepthwiseConv2dNative":var w=Sl(e,t,n),O=w.stride,I=w.pad,S=w.dataFormat,N=w.dilations,j=w.biasArg,T=w.preluArg,C=w.activationFunc,E=w.leakyreluAlpha;return[a.fused.depthwiseConv2d({x:Object(ul.d)("x",e,t,n),filter:Object(ul.d)("filter",e,t,n),strides:[O[1],O[2]],pad:I,dataFormat:S,dilations:[N[1],N[2]],bias:j,activation:C,preluActivationWeights:T,leakyreluAlpha:E})];case"Conv2DBackpropInput":case"Conv2dTranspose":var _=Object(ul.d)("outputShape",e,t,n),A=Object(ul.d)("strides",e,t,n),R=Object(ul.c)(e,t,n);return[a.conv2dTranspose(Object(ul.d)("x",e,t,n),Object(ul.d)("filter",e,t,n),_,[A[1],A[2]],R)];case"DepthwiseConv2dNative":case"DepthwiseConv2d":var D=Object(ul.d)("strides",e,t,n),F=Object(ul.c)(e,t,n),M=Object(ul.d)("dilations",e,t,n),z=Object(ul.d)("dataFormat",e,t,n).toUpperCase();return[a.depthwiseConv2d(Object(ul.d)("input",e,t,n),Object(ul.d)("filter",e,t,n),[D[1],D[2]],F,z,[M[1],M[2]])];case"Conv3D":var L=Object(ul.d)("strides",e,t,n),P=Object(ul.d)("pad",e,t,n),B=Object(ul.d)("dataFormat",e,t,n).toUpperCase(),W=Object(ul.d)("dilations",e,t,n);return[a.conv3d(Object(ul.d)("x",e,t,n),Object(ul.d)("filter",e,t,n),[L[1],L[2],L[3]],P,B,[W[1],W[2],W[3]])];case"AvgPool":var U=Object(ul.d)("strides",e,t,n),V=Object(ul.d)("pad",e,t,n),G=Object(ul.d)("kernelSize",e,t,n);return[a.avgPool(Object(ul.d)("x",e,t,n),[G[1],G[2]],[U[1],U[2]],V)];case"MaxPool":var H=Object(ul.d)("strides",e,t,n),q=Object(ul.d)("pad",e,t,n),K=Object(ul.d)("kernelSize",e,t,n);return[a.maxPool(Object(ul.d)("x",e,t,n),[K[1],K[2]],[H[1],H[2]],q)];case"MaxPoolWithArgmax":var X=Object(ul.d)("strides",e,t,n),Y=Object(ul.d)("pad",e,t,n),Z=Object(ul.d)("kernelSize",e,t,n),J=Object(ul.d)("includeBatchInIndex",e,t,n),Q=a.maxPoolWithArgmax(Object(ul.d)("x",e,t,n),[Z[1],Z[2]],[X[1],X[2]],Y,J),$=Q.result,ee=Q.indexes;return[$,ee];case"AvgPool3D":var te=Object(ul.d)("strides",e,t,n),ne=Object(ul.d)("pad",e,t,n),re=Object(ul.d)("kernelSize",e,t,n);return[a.avgPool3d(Object(ul.d)("x",e,t,n),[re[1],re[2],re[3]],[te[1],te[2],te[3]],ne)];case"MaxPool3D":var ae=Object(ul.d)("strides",e,t,n),ie=Object(ul.d)("pad",e,t,n),oe=Object(ul.d)("kernelSize",e,t,n);return[a.maxPool3d(Object(ul.d)("x",e,t,n),[oe[1],oe[2],oe[3]],[ae[1],ae[2],ae[3]],ie)];case"Dilation2D":var se=Object(ul.d)("strides",e,t,n),ue=Object(ul.d)("pad",e,t,n),ce=Object(ul.d)("dilations",e,t,n),le=se[1],de=se[2],pe=ce[1],fe=ce[2];return[a.dilation2d(Object(ul.d)("x",e,t,n),Object(ul.d)("filter",e,t,n),[le,de],ue,[pe,fe],"NHWC")];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},jl=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r;switch(e.op){case"Fill":var i=Object(ul.d)("shape",e,t,n),o=Object(ul.d)("dtype",e,t,n),s=Object(ul.d)("value",e,t,n);return[a.fill(i,s,o)];case"LinSpace":var u=Object(ul.d)("start",e,t,n),c=Object(ul.d)("stop",e,t,n),l=Object(ul.d)("num",e,t,n);return[a.linspace(u,c,l)];case"Multinomial":var d=Object(ul.d)("logits",e,t,n),p=Object(ul.d)("numSamples",e,t,n),f=Object(ul.d)("seed",e,t,n);return[a.multinomial(d,p,f)];case"OneHot":var h=Object(ul.d)("indices",e,t,n),m=Object(ul.d)("depth",e,t,n),v=Object(ul.d)("onValue",e,t,n),b=Object(ul.d)("offValue",e,t,n),g=Object(ul.d)("dtype",e,t,n);return[a.oneHot(h,m,v,b,g)];case"Ones":return[a.ones(Object(ul.d)("shape",e,t,n),Object(ul.d)("dtype",e,t,n))];case"OnesLike":return[a.onesLike(Object(ul.d)("x",e,t,n))];case"RandomStandardNormal":return[a.randomStandardNormal(Object(ul.d)("shape",e,t,n),Object(ul.d)("dtype",e,t,n),Object(ul.d)("seed",e,t,n))];case"RandomUniform":return[a.randomUniform(Object(ul.d)("shape",e,t,n),Object(ul.d)("minval",e,t,n),Object(ul.d)("maxval",e,t,n),Object(ul.d)("dtype",e,t,n))];case"Range":var y=Object(ul.d)("start",e,t,n),x=Object(ul.d)("stop",e,t,n),k=Object(ul.d)("step",e,t,n);return[a.range(y,x,k,Object(ul.d)("dtype",e,t,n))];case"TruncatedNormal":var w=Object(ul.d)("shape",e,t,n),O=Object(ul.d)("mean",e,t,n),I=Object(ul.d)("stdDev",e,t,n),S=Object(ul.d)("seed",e,t,n);return[a.truncatedNormal(w,O,I,Object(ul.d)("dtype",e,t,n),S)];case"Zeros":return[a.zeros(Object(ul.d)("shape",e,t,n),Object(ul.d)("dtype",e,t,n))];case"ZerosLike":return[a.zerosLike(Object(ul.d)("x",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}};function Tl(e,t,n){return{boxes:Object(ul.d)("boxes",e,t,n),scores:Object(ul.d)("scores",e,t,n),maxOutputSize:Object(ul.d)("maxOutputSize",e,t,n),iouThreshold:Object(ul.d)("iouThreshold",e,t,n),scoreThreshold:Object(ul.d)("scoreThreshold",e,t,n),softNmsSigma:Object(ul.d)("softNmsSigma",e,t,n)}}var Cl=function(){var e=Object(Oo.a)(wo.a.mark((function e(t,n,a,i){var o,s,u,c,l,d,p,f,h,m,v,b,g,y,x,k,w,O,I,S,N,j,T,C,E,_=arguments;return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=_.length>4&&void 0!==_[4]?_[4]:r,e.t0=t.op,e.next="NonMaxSuppressionV5"===e.t0?4:"NonMaxSuppressionV4"===e.t0?9:"NonMaxSuppressionV3"===e.t0||"NonMaxSuppressionV2"===e.t0?15:"Where"===e.t0?20:"ListDiff"===e.t0?27:28;break;case 4:return s=Tl(t,n,a),u=s.boxes,c=s.scores,l=s.maxOutputSize,d=s.iouThreshold,p=s.scoreThreshold,f=s.softNmsSigma,e.next=7,o.image.nonMaxSuppressionWithScoreAsync(u,c,l,d,p,f);case 7:return h=e.sent,e.abrupt("return",[h.selectedIndices,h.selectedScores]);case 9:return m=Tl(t,n,a),v=m.boxes,b=m.scores,g=m.maxOutputSize,y=m.iouThreshold,x=m.scoreThreshold,k=Object(ul.d)("padToMaxOutputSize",t,n,a),e.next=13,o.image.nonMaxSuppressionPaddedAsync(v,b,g,y,x,k);case 13:return w=e.sent,e.abrupt("return",[w.selectedIndices,w.validOutputs]);case 15:return O=Tl(t,n,a),I=O.boxes,S=O.scores,N=O.maxOutputSize,j=O.iouThreshold,T=O.scoreThreshold,e.next=18,o.image.nonMaxSuppressionAsync(I,S,N,j,T);case 18:return e.t1=e.sent,e.abrupt("return",[e.t1]);case 20:return C=o.cast(Object(ul.d)("condition",t,n,a),"bool"),e.next=23,o.whereAsync(C);case 23:return e.t2=e.sent,E=[e.t2],C.dispose(),e.abrupt("return",E);case 27:return e.abrupt("return",o.setdiff1dAsync(Object(ul.d)("x",t,n,a),Object(ul.d)("y",t,n,a)));case 28:throw TypeError("Node type ".concat(t.op," is not implemented"));case 29:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}(),El=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r;switch(e.op){case"LowerBound":var i=Object(ul.d)("sortedSequence",e,t,n),o=Object(ul.d)("values",e,t,n);return[a.lowerBound(i,o)];case"TopKV2":var s=Object(ul.d)("x",e,t,n),u=Object(ul.d)("k",e,t,n),c=Object(ul.d)("sorted",e,t,n),l=a.topk(s,u,c);return[l.values,l.indices];case"UpperBound":var d=Object(ul.d)("sortedSequence",e,t,n),p=Object(ul.d)("values",e,t,n);return[a.upperBound(d,p)];case"Unique":var f=Object(ul.d)("x",e,t,n),h=a.unique(f);return[h.values,h.indices];case"UniqueV2":var m=Object(ul.d)("x",e,t,n),v=Object(ul.d)("axis",e,t,n),b=a.unique(m,v);return[b.values,b.indices];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},_l=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r;switch(e.op){case"Const":return t[e.name];case"PlaceholderWithDefault":var i=Object(ul.d)("default",e,t,n);return[Object(ul.e)(e.name,t,n)||i];case"Placeholder":return[Object(ul.e)(e.name,t,n)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":var o=Object(ul.d)("x",e,t,n);return[Object(ul.a)(o)];case"IdentityN":return Object(ul.d)("x",e,t,n).map((function(e){return Object(ul.a)(e)}));case"Snapshot":var s=Object(ul.d)("x",e,t,n);return[Object(ul.a)(s)];case"Shape":return[a.tensor1d(Object(ul.d)("x",e,t,n).shape,"int32")];case"ShapeN":return Object(ul.d)("x",e,t,n).map((function(e){return a.tensor1d(e.shape)}));case"Size":return[a.scalar(Object(ul.d)("x",e,t,n).size,"int32")];case"Rank":return[a.scalar(Object(ul.d)("x",e,t,n).rank,"int32")];case"NoOp":return[a.scalar(1)];case"Print":var u=Object(ul.d)("x",e,t,n),c=Object(ul.d)("data",e,t,n),l=Object(ul.d)("message",e,t,n),d=Object(ul.d)("summarize",e,t,n);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(l);for(var p=0;p<c.length;p++)console.log(Array.prototype.slice.call(c[p].dataSync()).slice(0,d));return[u];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},Al=function(){function e(t,n){Object($r.a)(this,e),this.keyDType=t,this.valueDType=n,this.handle=Object(a.We)(0),this.tensorMap=new Map,Object(a.oe)(this.handle)}return Object(ea.a)(e,[{key:"clearAndClose",value:function(){this.tensorMap.forEach((function(e){return e.dispose()})),this.tensorMap.clear(),this.handle.dispose()}},{key:"size",value:function(){return this.tensorMap.size}},{key:"tensorSize",value:function(){return f.a(this.size(),"int32")}},{key:"import",value:function(){var e=Object(Oo.a)(wo.a.mark((function e(t,n){var r,i=this;return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkKeyAndValueTensor(t,n),e.next=3,t.data();case 3:return r=e.sent,this.tensorMap.forEach((function(e){return e.dispose()})),this.tensorMap.clear(),e.abrupt("return",Object(a.wf)((function(){var e=Object(a.Bf)(n),t=r.length,o=e.length;a.Df.assert(t===o,(function(){return"The number of elements doesn't match, keys has "+"".concat(t," elements, the values has ").concat(o," ")+"elements."}));for(var s=0;s<t;s++){var u=r[s],c=e[s];Object(a.oe)(c),i.tensorMap.set(u,c)}return i.handle})));case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"find",value:function(){var e=Object(Oo.a)(wo.a.mark((function e(t,n){var r,i=this;return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkKeyAndValueTensor(t,n),e.next=3,t.data();case 3:return r=e.sent,e.abrupt("return",Object(a.wf)((function(){for(var e=[],t=0;t<r.length;t++){var o=r[t],s=i.findWithDefault(o,n);e.push(s)}return Object(a.nf)(e)})));case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"findWithDefault",value:function(e,t){var n=this.tensorMap.get(e);return null!=n?n:t}},{key:"checkKeyAndValueTensor",value:function(e,t){if(e.dtype!==this.keyDType)throw new Error("Expect key dtype ".concat(this.keyDType,", but got ")+"".concat(e.dtype));if(t.dtype!==this.valueDType)throw new Error("Expect value dtype ".concat(this.valueDType,", but got ")+"".concat(t.dtype))}},{key:"id",get:function(){return this.handle.id}}]),e}(),Rl=function(){var e=Object(Oo.a)(wo.a.mark((function e(t,n,r,a){var i,o,s,u,c,l,d,p,f,h,m,v,b;return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.op,e.next="HashTable"===e.t0||"HashTableV2"===e.t0?3:"LookupTableImport"===e.t0||"LookupTableImportV2"===e.t0?8:"LookupTableFind"===e.t0||"LookupTableFindV2"===e.t0?16:"LookupTableSize"===e.t0||"LookupTableSizeV2"===e.t0?24:27;break;case 3:return i=Object(ul.d)("keyDType",t,n,r),o=Object(ul.d)("valueDType",t,n,r),s=new Al(i,o),a.addHashTable(t.name,s),e.abrupt("return",[s.handle]);case 8:return u=Object(ul.d)("tableHandle",t,n,r,a),c=Object(ul.d)("keys",t,n,r),l=Object(ul.d)("values",t,n,r),d=a.getHashTableById(u.id),e.next=14,d.import(c,l);case 14:return e.t1=e.sent,e.abrupt("return",[e.t1]);case 16:return p=Object(ul.d)("tableHandle",t,n,r,a),f=Object(ul.d)("keys",t,n,r),h=Object(ul.d)("defaultValue",t,n,r),m=a.getHashTableById(p.id),e.next=22,m.find(f,h);case 22:return e.t2=e.sent,e.abrupt("return",[e.t2]);case 24:return v=Object(ul.d)("tableHandle",t,n,r,a),b=a.getHashTableById(v.id),e.abrupt("return",[b.tensorSize()]);case 27:throw TypeError("Node type ".concat(t.op," is not implemented"));case 28:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}(),Dl=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r;switch(e.op){case"ResizeBilinear":var i=Object(ul.d)("images",e,t,n),o=Object(ul.d)("size",e,t,n),s=Object(ul.d)("alignCorners",e,t,n),u=Object(ul.d)("halfPixelCenters",e,t,n);return[a.image.resizeBilinear(i,[o[0],o[1]],s,u)];case"ResizeNearestNeighbor":var c=Object(ul.d)("images",e,t,n),l=Object(ul.d)("size",e,t,n),d=Object(ul.d)("alignCorners",e,t,n),p=Object(ul.d)("halfPixelCenters",e,t,n);return[a.image.resizeNearestNeighbor(c,[l[0],l[1]],d,p)];case"CropAndResize":var f=Object(ul.d)("image",e,t,n),h=Object(ul.d)("boxes",e,t,n),m=Object(ul.d)("boxInd",e,t,n),v=Object(ul.d)("cropSize",e,t,n),b=Object(ul.d)("method",e,t,n),g=Object(ul.d)("extrapolationValue",e,t,n);return[a.image.cropAndResize(f,h,m,v,b,g)];case"ImageProjectiveTransformV3":var y=Object(ul.d)("images",e,t,n),x=Object(ul.d)("transforms",e,t,n),k=Object(ul.d)("outputShape",e,t,n),w=Object(ul.d)("fillValue",e,t,n),O=Object(ul.d)("interpolation",e,t,n),I=Object(ul.d)("fillMode",e,t,n);return[a.image.transform(y,x,O.toLowerCase(),I.toLowerCase(),w,k)];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},Fl=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r;switch(e.op){case"Equal":return[a.equal(Object(ul.d)("a",e,t,n),Object(ul.d)("b",e,t,n))];case"NotEqual":return[a.notEqual(Object(ul.d)("a",e,t,n),Object(ul.d)("b",e,t,n))];case"Greater":return[a.greater(Object(ul.d)("a",e,t,n),Object(ul.d)("b",e,t,n))];case"GreaterEqual":return[a.greaterEqual(Object(ul.d)("a",e,t,n),Object(ul.d)("b",e,t,n))];case"Less":return[a.less(Object(ul.d)("a",e,t,n),Object(ul.d)("b",e,t,n))];case"LessEqual":return[a.lessEqual(Object(ul.d)("a",e,t,n),Object(ul.d)("b",e,t,n))];case"LogicalAnd":return[a.logicalAnd(Object(ul.d)("a",e,t,n),Object(ul.d)("b",e,t,n))];case"LogicalNot":return[a.logicalNot(Object(ul.d)("a",e,t,n))];case"LogicalOr":return[a.logicalOr(Object(ul.d)("a",e,t,n),Object(ul.d)("b",e,t,n))];case"Select":case"SelectV2":return[a.where(Object(ul.d)("condition",e,t,n),Object(ul.d)("a",e,t,n),Object(ul.d)("b",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},Ml=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r;switch(e.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[a.matMul(Object(ul.d)("a",e,t,n),Object(ul.d)("b",e,t,n),Object(ul.d)("transposeA",e,t,n),Object(ul.d)("transposeB",e,t,n))];case"Einsum":return[a.einsum.apply(a,[Object(ul.d)("equation",e,t,n)].concat(Object(qn.a)(Object(ul.d)("tensors",e,t,n))))];case"Transpose":return[a.transpose(Object(ul.d)("x",e,t,n),Object(ul.d)("perm",e,t,n))];case"_FusedMatMul":var o=Object(ul.d)("fusedOps",e,t,n),s=Object(i.a)(o,2),u=s[0],c=s[1],l="biasadd"===u,d="prelu"===c,p=Object(ul.d)("numArgs",e,t,n),f=Object(ul.d)("leakyreluAlpha",e,t,n);if(l){if(d&&2!==p)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!d&&1!==p)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}var h=Object(ul.d)("args",e,t,n),m=Object(i.a)(h,2),v=m[0],b=m[1];return[a.fused.matMul({a:Object(ul.d)("a",e,t,n),b:Object(ul.d)("b",e,t,n),transposeA:Object(ul.d)("transposeA",e,t,n),transposeB:Object(ul.d)("transposeB",e,t,n),bias:v,activation:c,preluActivationWeights:b,leakyreluAlpha:f})];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},zl=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r;switch(e.op){case"EuclideanNorm":return[a.euclideanNorm(Object(ul.d)("x",e,t,n),Object(ul.d)("axis",e,t,n),Object(ul.d)("keepDims",e,t,n))];case"FusedBatchNorm":case"FusedBatchNormV2":case"FusedBatchNormV3":return[a.batchNorm(Object(ul.d)("x",e,t,n),Object(ul.d)("mean",e,t,n),Object(ul.d)("variance",e,t,n),Object(ul.d)("offset",e,t,n),Object(ul.d)("scale",e,t,n),Object(ul.d)("epsilon",e,t,n))];case"LRN":return[a.localResponseNormalization(Object(ul.d)("x",e,t,n),Object(ul.d)("radius",e,t,n),Object(ul.d)("bias",e,t,n),Object(ul.d)("alpha",e,t,n),Object(ul.d)("beta",e,t,n))];case"Softmax":return[a.softmax(Object(ul.d)("x",e,t,n))];case"LogSoftmax":return[a.logSoftmax(Object(ul.d)("x",e,t,n))];case"SparseToDense":return[a.sparseToDense(Object(ul.d)("sparseIndices",e,t,n),Object(ul.d)("outputShape",e,t,n),Object(ul.d)("sparseValues",e,t,n),Object(ul.d)("defaultValue",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},Ll=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r;switch(e.op){case"Max":var i=Object(ul.d)("axis",e,t,n),o=Object(ul.d)("keepDims",e,t,n);return[a.max(Object(ul.d)("x",e,t,n),i,o)];case"Mean":var s=Object(ul.d)("axis",e,t,n),u=Object(ul.d)("keepDims",e,t,n);return[a.mean(Object(ul.d)("x",e,t,n),s,u)];case"Min":var c=Object(ul.d)("axis",e,t,n),l=Object(ul.d)("keepDims",e,t,n);return[a.min(Object(ul.d)("x",e,t,n),c,l)];case"Sum":var d=Object(ul.d)("axis",e,t,n),p=Object(ul.d)("keepDims",e,t,n);return[a.sum(Object(ul.d)("x",e,t,n),d,p)];case"All":var f=Object(ul.d)("axis",e,t,n),h=Object(ul.d)("keepDims",e,t,n);return[a.all(Object(ul.d)("x",e,t,n),f,h)];case"Any":var m=Object(ul.d)("axis",e,t,n),v=Object(ul.d)("keepDims",e,t,n);return[a.any(Object(ul.d)("x",e,t,n),m,v)];case"ArgMax":var b=Object(ul.d)("axis",e,t,n);return[a.argMax(Object(ul.d)("x",e,t,n),b)];case"ArgMin":var g=Object(ul.d)("axis",e,t,n);return[a.argMin(Object(ul.d)("x",e,t,n),g)];case"Prod":var y=Object(ul.d)("axis",e,t,n),x=Object(ul.d)("keepDims",e,t,n);return[a.prod(Object(ul.d)("x",e,t,n),y,x)];case"Cumprod":var k=Object(ul.d)("axis",e,t,n),w=Object(ul.d)("exclusive",e,t,n),O=Object(ul.d)("reverse",e,t,n);return[a.cumprod(Object(ul.d)("x",e,t,n),k,w,O)];case"Cumsum":var I=Object(ul.d)("axis",e,t,n),S=Object(ul.d)("exclusive",e,t,n),N=Object(ul.d)("reverse",e,t,n);return[a.cumsum(Object(ul.d)("x",e,t,n),I,S,N)];case"Bincount":var j=Object(ul.d)("x",e,t,n),T=Object(ul.d)("weights",e,t,n),C=Object(ul.d)("size",e,t,n);return[a.bincount(j,T,C)];case"DenseBincount":var E=Object(ul.d)("x",e,t,n),_=Object(ul.d)("weights",e,t,n),A=Object(ul.d)("size",e,t,n),R=Object(ul.d)("binaryOutput",e,t,n);return[a.denseBincount(E,_,A,R)];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},Pl=function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r;switch(e.op){case"ConcatV2":case"Concat":var o=Object(ul.d)("n",e,t,n),s=Object(ul.d)("axis",e,t,n),u=Object(ul.d)("tensors",e,t,n);return u=u.slice(0,o),[i.concat(u,s)];case"Gather":var c=Object(ul.d)("x",e,t,n),l=Object(ul.d)("indices",e,t,n);return[i.gather(c,i.cast(l,"int32"),0)];case"GatherV2":var d=Object(ul.d)("axis",e,t,n),p=Object(ul.d)("batchDims",e,t,n),f=Object(ul.d)("x",e,t,n),h=Object(ul.d)("indices",e,t,n);return[i.gather(f,i.cast(h,"int32"),d,p)];case"Reverse":for(var m=Object(ul.d)("dims",e,t,n),v=[],b=0;b<m.length;b++)m[b]&&v.push(b);var g=Object(ul.d)("x",e,t,n);return[i.reverse(g,v)];case"ReverseV2":var y=Object(ul.d)("axis",e,t,n),x=Object(ul.d)("x",e,t,n);return[i.reverse(x,y)];case"Slice":var k=Object(ul.d)("begin",e,t,n),w=Object(ul.d)("size",e,t,n);return[i.slice(Object(ul.d)("x",e,t,n),k,w)];case"StridedSlice":var O=Object(ul.d)("begin",e,t,n),I=Object(ul.d)("end",e,t,n),S=Object(ul.d)("strides",e,t,n),N=Object(ul.d)("beginMask",e,t,n),j=Object(ul.d)("endMask",e,t,n),T=Object(ul.d)("ellipsisMask",e,t,n),C=Object(ul.d)("newAxisMask",e,t,n),E=Object(ul.d)("shrinkAxisMask",e,t,n),_=Object(ul.d)("x",e,t,n);return[i.stridedSlice(_,O,I,S,N,j,T,C,E)];case"Pack":return Object(a.wf)((function(){var r=Object(ul.d)("axis",e,t,n),o=Object(ul.d)("tensors",e,t,n),s=o[0].shape,u=i.squeeze(o[0]).shape,c=o.map((function(e){var t=a.Df.arraysEqual(e.shape,s);if(!t&&!a.Df.arraysEqual(i.squeeze(e).shape,u))throw new Error("the input tensors shape does not match");return t?e:i.reshape(e,s)}));return[i.stack(c,r)]}));case"Unpack":var A=Object(ul.d)("axis",e,t,n),R=Object(ul.d)("tensor",e,t,n);return i.unstack(R,A);case"Tile":var D=Object(ul.d)("reps",e,t,n);return[i.tile(Object(ul.d)("x",e,t,n),D)];case"Split":case"SplitV":var F=Object(ul.d)("axis",e,t,n),M=Object(ul.d)("numOrSizeSplits",e,t,n),z=Object(ul.d)("x",e,t,n);return i.split(z,M,F);case"ScatterNd":var L=Object(ul.d)("indices",e,t,n),P=Object(ul.d)("values",e,t,n),B=Object(ul.d)("shape",e,t,n);return[i.scatterND(L,P,B)];case"GatherNd":var W=Object(ul.d)("x",e,t,n),U=Object(ul.d)("indices",e,t,n);return[i.gatherND(W,U)];case"SparseToDense":var V=Object(ul.d)("sparseIndices",e,t,n),G=Object(ul.d)("outputShape",e,t,n),H=Object(ul.d)("sparseValues",e,t,n),q=Object(ul.d)("defaultValue",e,t,n);return[i.sparseToDense(V,H,G,H.dtype===q.dtype?q:i.cast(q,H.dtype))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},Bl=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r;switch(e.op){case"SparseFillEmptyRows":var i=a.sparse.sparseFillEmptyRows(Object(ul.d)("indices",e,t,n),Object(ul.d)("values",e,t,n),Object(ul.d)("denseShape",e,t,n),Object(ul.d)("defaultValue",e,t,n)),o=i.outputIndices,s=i.outputValues,u=i.emptyRowIndicator,c=i.reverseIndexMap;return[o,s,u,c];case"SparseReshape":var l=a.sparse.sparseReshape(Object(ul.d)("inputIndices",e,t,n),Object(ul.d)("inputShape",e,t,n),Object(ul.d)("newShape",e,t,n)),d=l.outputIndices,p=l.outputShape;return[d,p];case"SparseSegmentMean":var f=a.sparse.sparseSegmentMean(Object(ul.d)("data",e,t,n),Object(ul.d)("indices",e,t,n),Object(ul.d)("segmentIds",e,t,n));return[f];case"SparseSegmentSum":var h=a.sparse.sparseSegmentSum(Object(ul.d)("data",e,t,n),Object(ul.d)("indices",e,t,n),Object(ul.d)("segmentIds",e,t,n));return[h];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},Wl=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r;switch(e.op){case"FFT":return[a.fft(Object(ul.d)("x",e,t,n))];case"IFFT":return[a.ifft(Object(ul.d)("x",e,t,n))];case"RFFT":return[a.rfft(Object(ul.d)("x",e,t,n))];case"IRFFT":return[a.irfft(Object(ul.d)("x",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},Ul=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r;switch(e.op){case"StringNGrams":var i=a.string.stringNGrams(Object(ul.d)("data",e,t,n),Object(ul.d)("dataSplits",e,t,n),Object(ul.d)("separator",e,t,n),Object(ul.d)("nGramWidths",e,t,n),Object(ul.d)("leftPad",e,t,n),Object(ul.d)("rightPad",e,t,n),Object(ul.d)("padWidth",e,t,n),Object(ul.d)("preserveShortSequences",e,t,n)),o=i.nGrams,s=i.nGramsSplits;return[o,s];case"StringSplit":var u=a.string.stringSplit(Object(ul.d)("input",e,t,n),Object(ul.d)("delimiter",e,t,n),Object(ul.d)("skipEmpty",e,t,n)),c=u.indices,l=u.values,d=u.shape;return[c,l,d];case"StringToHashBucketFast":var p=a.string.stringToHashBucketFast(Object(ul.d)("input",e,t,n),Object(ul.d)("numBuckets",e,t,n));return[p];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},Vl=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r;switch(e.op){case"Cast":return[a.cast(Object(ul.d)("x",e,t,n),Object(ul.d)("dtype",e,t,n))];case"ExpandDims":var i=Object(ul.d)("axis",e,t,n);return[a.expandDims(Object(ul.d)("x",e,t,n),i)];case"Squeeze":var o=Object(ul.d)("axis",e,t,n);return[a.squeeze(Object(ul.d)("x",e,t,n),o)];case"Reshape":return[a.reshape(Object(ul.d)("x",e,t,n),Object(ul.d)("shape",e,t,n))];case"MirrorPad":return[a.mirrorPad(Object(ul.d)("x",e,t,n),Object(ul.d)("padding",e,t,n),Object(ul.d)("mode",e,t,n))];case"PadV2":case"Pad":return[a.pad(Object(ul.d)("x",e,t,n),Object(ul.d)("padding",e,t,n),Object(ul.d)("constantValue",e,t,n))];case"SpaceToBatchND":var s=Object(ul.d)("blockShape",e,t,n),u=Object(ul.d)("paddings",e,t,n);return[a.spaceToBatchND(Object(ul.d)("x",e,t,n),s,u)];case"BatchToSpaceND":var c=Object(ul.d)("blockShape",e,t,n),l=Object(ul.d)("crops",e,t,n);return[a.batchToSpaceND(Object(ul.d)("x",e,t,n),c,l)];case"DepthToSpace":var d=Object(ul.d)("blockSize",e,t,n),p=Object(ul.d)("dataFormat",e,t,n).toUpperCase();return[a.depthToSpace(Object(ul.d)("x",e,t,n),d,p)];case"BroadcastTo":return[a.broadcastTo(Object(ul.d)("x",e,t,n),Object(ul.d)("shape",e,t,n))];case"BroadcastArgs":return[a.broadcastArgs(Object(ul.d)("s0",e,t,n),Object(ul.d)("s1",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}};function Gl(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:a.wf,o=function(e,t,n){switch(e.category){case"arithmetic":return i((function(){return pl(e,t,n)}));case"basic_math":return i((function(){return fl(e,t,n)}));case"control":return Il(e,t,n);case"convolution":return i((function(){return Nl(e,t,n)}));case"creation":return i((function(){return jl(e,t,n)}));case"dynamic":return Cl(e,t,n);case"evaluation":return i((function(){return El(e,t,n)}));case"image":return i((function(){return Dl(e,t,n)}));case"graph":return i((function(){return _l(e,t,n)}));case"logical":return i((function(){return Fl(e,t,n)}));case"matrices":return i((function(){return Ml(e,t,n)}));case"normalization":return i((function(){return zl(e,t,n)}));case"reduction":return i((function(){return Ll(e,t,n)}));case"slice_join":return i((function(){return Pl(e,t,n)}));case"sparse":return i((function(){return Bl(e,t,n)}));case"spectral":return i((function(){return Wl(e,t,n)}));case"string":return i((function(){return Ul(e,t,n)}));case"transformation":return i((function(){return Vl(e,t,n)}));case"hash_table":return Rl(e,t,n,r);case"custom":var a=Object(ll.a)(e.op);if(a&&a.customExecutor)return a.customExecutor(new cl(e,t,n));throw TypeError("Custom op ".concat(e.op," is not registered."));default:throw TypeError("Unknown op '".concat(e.op,"'. File an issue at ")+"https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()")}}(e,t,n);return a.Df.isPromise(o)?o.then((function(e){return[].concat(e)})):[].concat(o)}var Hl=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};Object($r.a)(this,e),this.weightMap=t,this.tensorArrayMap=n,this.tensorListMap=r,this.functionMap=a,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}return Object(ea.a)(e,[{key:"newFrame",value:function(e,t){return{id:e,frameName:t,iterationId:0}}},{key:"generateCurrentContextIds",value:function(){for(var e=[],t=0;t<this.contexts.length-1;t++){var n=this.contexts.slice(0,this.contexts.length-t);e.push(this.contextIdforContexts(n))}e.push(""),this._currentContextIds=e}},{key:"contextIdforContexts",value:function(e){return e?e.map((function(e){return 0===e.id&&0===e.iterationId?"":"".concat(e.frameName,"-").concat(e.iterationId)})).join("/"):""}},{key:"enterFrame",value:function(e){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,e)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))}},{key:"exitFrame",value:function(){if(!(this.contexts&&this.contexts.length>1))throw new Error("Cannot exit frame, the context is empty");this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift()}},{key:"nextIteration",value:function(){if(!(this.contexts&&this.contexts.length>0))throw new Error("Cannot increase frame iteration, the context is empty");this.contexts=this.contexts.slice(),this.lastId++;var e=Object.assign({},this.contexts[this.contexts.length-1]);e.iterationId+=1,e.id=this.lastId,this.contexts.splice(-1,1,e),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}},{key:"getWeight",value:function(e){return this.weightMap[e]}},{key:"addTensorArray",value:function(e){this.tensorArrayMap[e.id]=e}},{key:"getTensorArray",value:function(e){return this.tensorArrayMap[e]}},{key:"addTensorList",value:function(e){this.tensorListMap[e.id]=e}},{key:"getTensorList",value:function(e){return this.tensorListMap[e]}},{key:"dispose",value:function(e){for(var t in this.tensorArrayMap)this.tensorArrayMap[t].clearAndClose(e);for(var n in this.tensorListMap)this.tensorListMap[n].clearAndClose(e)}},{key:"currentContext",set:function(e){this.contexts!==e&&(this.contexts=e,this.generateCurrentContextIds())},get:function(){return this.contexts}},{key:"currentContextId",get:function(){return this._currentContextIds[0]}},{key:"currentContextIds",get:function(){return this._currentContextIds}}]),e}();function ql(e,t,n,r){var a=new Set,i=[],o=null,s=null,u=new Set,c=Object.keys(e).map((function(e){return Object(ul.g)(e)[0]})),l=[];null!=r&&(l=r.map((function(e){return Object(ul.g)(e.name)[0]})));for(var d=Object(qn.a)(t);d.length>0;){var p=d.pop();(Zl(p)||Jl(p)||Ql(p))&&null==o&&(s=(o=p).children.map((function(e){return e.name})).filter((function(e){return a.has(e)}))),a.add(p.name),null==n[p.name]&&(-1===c.indexOf(p.name)&&-1===l.indexOf(p.name)&&(0!==p.inputs.length?p.inputs.forEach((function(e){u.has(e.name)||(u.add(e.name),d.push(e))})):i.push(p.name)))}return{inputs:e,outputs:t,usedNodes:a,missingInputs:i,dynamicNode:o,syncInputs:s}}var Kl=["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"],Xl=["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"],Yl=["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"];function Zl(e){return Kl.indexOf(e.op)>=0}function Jl(e){return Xl.indexOf(e.op)>=0}function Ql(e){return Yl.indexOf(e.op)>=0}var $l=function(){function e(t,n){var r=this;Object($r.a)(this,e),this.graph=t,this.parent=n,this.compiledMap=new Map,this._weightMap={},this.SEPERATOR=",",this._functions={},this._functionExecutorMap={},this.intermediateTensors={},this.keepTensorForDebug=!1,this._outputs=t.outputs,this._inputs=t.inputs,this._initNodes=t.initNodes,this._signature=t.signature,this._functions=t.functions,null!=t.functions&&Object.keys(t.functions).forEach((function(n){r._functionExecutorMap[n]=new e(t.functions[n],r)}))}return Object(ea.a)(e,[{key:"getCompilationKey",value:function(e,t){var n=e.map((function(e){return e.name})).sort(),r=t.map((function(e){return e.name})).sort();return n.join(this.SEPERATOR)+"--"+r.join(this.SEPERATOR)}},{key:"compile",value:function(e,t){var n=ql(e,t,this.weightMap,this._initNodes),r=n.missingInputs,a=n.dynamicNode,i=n.syncInputs;if(null!=a)throw new Error("This execution contains the node '".concat(a.name,"', which has ")+"the dynamic op '".concat(a.op,"'. Please use ")+"model.executeAsync() instead. Alternatively, to avoid the "+"dynamic ops, specify the inputs [".concat(i,"]"));if(r.length>0){var o=t.map((function(e){return e.name})),s=Object.keys(e);throw new Error("Cannot compute the outputs [".concat(o,"] from the provided inputs ")+"[".concat(s,"]. Missing the following inputs: [").concat(r,"]"))}return function(e,t,n){var r=n.usedNodes,a=n.inputs,i=[],o=Object.keys(a).map((function(e){return Object(ul.g)(e)[0]})).map((function(t){return e.nodes[t]})),s=e.initNodes;o.forEach((function(e){r.has(e.name)&&i.push(e)})),e.weights.forEach((function(e){r.has(e.name)&&i.push(e)})),null!=s&&s.forEach((function(e){r.has(e.name)&&i.push(e)}));for(var u=new Set,c=[];i.length>0;){var l=i.pop();u.add(l.name),t[l.name]||c.push(l),l.children.forEach((function(e){!u.has(e.name)&&r.has(e.name)&&e.inputs.every((function(e){return u.has(e.name)}))&&i.push(e)}))}return c}(this.graph,this.weightMap,n)}},{key:"execute",value:function(e,t){var n=this;e=this.mapInputs(e);var r=Object.keys(e).sort();this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t);var o=r.map((function(e){return n.graph.nodes[Object(ul.g)(e)[0]]})),s=t.map((function(e){return Object(ul.g)(e)[0]})),u=s.map((function(e){return n.graph.nodes[e]}));this.resetIntermediateTensors(),0===u.length&&(u=this._outputs);var c=this.getCompilationKey(o,u),l=this.compiledMap.get(c);null==l&&(l=this.compile(e,u),this.compiledMap.set(c,l));var d={},p={};return Object(a.wf)((function(){var r=new Hl(n.weightMap,d,p,n.functionExecutorMap),o=Object.assign({},n.weightMap);Object.keys(e).forEach((function(t){var n=Object(ul.g)(t),r=Object(i.a)(n,2),a=r[0],s=[];s[r[1]]=e[t],o[a]=s}));for(var u=n.getFrozenTensorIds(o),c={},f=0;f<l.length;f++){var h=l[f];if(!o[h.name]){var m=Gl(h,o,r,n._resourceManager);if(a.Df.isPromise(m))throw new Error("The execution of the op '".concat(h.op,"' returned a promise. ")+"Please use model.executeAsync() instead.");o[h.name]=m,n.checkTensorForDisposal(h.name,h,o,r,u,s,c)}}return null==n.parent&&r.dispose(u),t.map((function(e){return Object(ul.e)(e,o,r)}))}))}},{key:"getFrozenTensorIds",value:function(e){var t=[].concat.apply([],Object.keys(e).map((function(t){return e[t]})).map((function(e){return e.map((function(e){return e.id}))})));return new Set(t)}},{key:"checkTensorForDisposal",value:function(e,t,n,r,a,o,s){var u=this;"control"!==t.category&&-1===o.indexOf(e)&&(n[e].forEach((function(e){null!=e&&(s[e.id]=(s[e.id]||0)+t.children.length)})),t.inputs.forEach((function(e){if("control"!==e.category){var o=Object(ul.f)(e.name,n,r);null!=o&&o.forEach((function(e){if(e&&!e.kept&&!a.has(e.id)){var n=s[e.id];if(1===n){if(u.keepTensorForDebug){var o=Object(ul.b)(t.name,r),c=Object(i.a)(o,2),l=c[0],d=c[1];u.intermediateTensors[l]||(u.intermediateTensors[l]=[]),u.intermediateTensors[l][d]=e}else e.dispose();delete s[e.id]}else null!=n&&s[e.id]--}}))}})))}},{key:"executeAsync",value:function(){var e=Object(Oo.a)(wo.a.mark((function e(t,n){return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._executeAsync(t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"disposeIntermediateTensors",value:function(){var e=this;this.intermediateTensors&&(Object.keys(this.intermediateTensors).forEach((function(t){return e.intermediateTensors[t].forEach((function(e){return e.dispose()}))})),this.disposeTensorsMap())}},{key:"disposeTensorsMap",value:function(){var e=this;this.tensorsMap&&Object.keys(this.tensorsMap).forEach((function(t){e.tensorsMap[t].forEach((function(t){!t||t.kept||t.isDisposed||e.keepIds.has(t.id)||t.dispose()}))}))}},{key:"getIntermediateTensors",value:function(){return this.tensorsMap}},{key:"resetIntermediateTensors",value:function(){for(var e in this.intermediateTensors)this.intermediateTensors[e].forEach((function(e){return e.dispose()})),delete this.intermediateTensors[e]}},{key:"_executeAsync",value:function(){var e=Object(Oo.a)(wo.a.mark((function e(t,n){var r,i,o,s,u,c,l,d=this,p=arguments;return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=p.length>2&&void 0!==p[2]&&p[2],i=p.length>3&&void 0!==p[3]?p[3]:{},o=p.length>4&&void 0!==p[4]?p[4]:{},r||(t=this.mapInputs(t),this.checkInputs(t),this.checkInputShapeAndType(t),n=this.mapOutputs(n),this.checkOutputs(n));try{this.keepTensorForDebug=Object(a.be)().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(f){console.warn(f.message)}return this.resetIntermediateTensors(),s=new Hl(this.weightMap,i,o,this.functionExecutorMap),e.next=9,this.executeWithControlFlow(t,s,n,r);case 9:return this.tensorsMap=e.sent,u=n.map((function(e){return Object(ul.e)(e,d.tensorsMap,s)})),c=u.map((function(e){return e.id})),l=Object.keys(t).map((function(e){return t[e].id})),this.keepIds=new Set([].concat(Object(qn.a)(c),Object(qn.a)(l),Object(qn.a)(this.weightIds))),this.keepTensorForDebug||this.disposeTensorsMap(),null==this.parent&&s.dispose(this.keepIds),e.abrupt("return",u);case 17:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"executeFunctionAsync",value:function(){var e=Object(Oo.a)(wo.a.mark((function e(t,n,r){var a,i=this;return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.reduce((function(e,t,n){return e[i.inputs[n].name]=t,e}),{}),e.abrupt("return",this._executeAsync(a,this.outputNodes,!0,n,r));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"executeWithControlFlow",value:function(){var e=Object(Oo.a)(wo.a.mark((function e(t,n,r,a){var o,s,u,c,l,d,p,f,h,m,v,b,g,y,x,k,w,O=this;return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=Object.keys(t),s=o.map((function(e){return O.graph.nodes[Object(ul.g)(e)[0]]})),u=r.map((function(e){return Object(ul.g)(e)[0]})),0===(c=u.map((function(e){return O.graph.nodes[e]}))).length&&(c=this._outputs),l=ql(t,c,this.weightMap,this._initNodes),d=l.usedNodes,p=l.missingInputs,f=l.dynamicNode,h=l.syncInputs,m=[].concat(Object(qn.a)(s),Object(qn.a)(this.graph.weights),Object(qn.a)(this._initNodes||[])).map((function(e){return{node:e,contexts:n.currentContext}})),v=Object.assign({},this.weightMap),Object.keys(t).forEach((function(e){var n=Object(ul.g)(e),r=Object(i.a)(n,2),a=r[0],o=[];o[r[1]]=t[e],v[a]=o})),b={},g=this.getFrozenTensorIds(v),y={};case 12:if(!(m.length>0)){e.next=18;break}return x=this.processStack(s,m,n,v,y,g,u,b,d),e.next=16,Promise.all(x);case 16:e.next=12;break;case 18:if(null!=f||a||console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead."),!((k=c.filter((function(e){return!Zl(e)&&!Object(ul.e)(e.name,v,n)})).map((function(e){return e.name}))).length>0)){e.next=24;break}throw w="",null!=f&&(w="Alternatively, to avoid the dynamic ops, use model.execute() "+"and specify the inputs [".concat(h,"]")),new Error("Cannot compute the outputs [".concat(k,"] from the provided ")+"inputs [".concat(o,"]. Consider providing the following inputs: ")+"[".concat(p,"]. ").concat(w));case 24:return e.abrupt("return",v);case 25:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"processStack",value:function(e,t,n,r,o,s,u,c,l){for(var d=this,p=[],f=function(){var e=t.pop();n.currentContext=e.contexts;var f="";if("Enter"===e.node.op&&Object(ul.d)("isConstant",e.node,r,n)){var h=Object(ul.b)(e.node.name,n),m=Object(i.a)(h,1);f=m[0]}if(null==r[e.node.name]){var v=Gl(e.node,r,n,d._resourceManager);if(!f){var b=Object(ul.b)(e.node.name,n),g=Object(i.a)(b,1);f=g[0]}var y=n.currentContext;a.Df.isPromise(v)?p.push(v.then((function(a){return r[f]=a,n.currentContext=y,d.checkTensorForDisposal(f,e.node,r,n,s,u,c),d.processChildNodes(e.node,t,n,r,o,l),a}))):(r[f]=v,d.checkTensorForDisposal(f,e.node,r,n,s,u,c),d.processChildNodes(e.node,t,n,r,o,l))}else d.processChildNodes(e.node,t,n,r,o,l)};t.length>0;)f();return p}},{key:"processChildNodes",value:function(e,t,n,r,a,o){e.children.forEach((function(e){var s=Object(ul.b)(e.name,n),u=Object(i.a)(s,1)[0];!a[u]&&o.has(e.name)&&("Merge"===e.op?e.inputNames.some((function(e){return!!Object(ul.e)(e,r,n)}))&&(a[u]=!0,t.push({contexts:n.currentContext,node:e})):e.inputNames.every((function(e){return!!Object(ul.e)(e,r,n)}))&&(a[u]=!0,t.push({contexts:n.currentContext,node:e})))}))}},{key:"dispose",value:function(){var e=this;Object.keys(this.weightMap).forEach((function(t){return e.weightMap[t].forEach((function(e){return e.dispose()}))}))}},{key:"checkInputShapeAndType",value:function(e){var t=this;Object.keys(e).forEach((function(n){var r=e[n],o=Object(ul.g)(n),s=Object(i.a)(o,1)[0],u=t.graph.nodes[s];if(u.attrParams.shape&&u.attrParams.shape.value){var c=u.attrParams.shape.value,l=c.length===r.shape.length&&r.shape.every((function(e,t){return-1===c[t]||c[t]===e}));a.Df.assert(l,(function(){return"The shape of dict['".concat(u.name,"'] provided in ")+"model.execute(dict) must be [".concat(c,"], but was ")+"[".concat(r.shape,"]")}))}u.attrParams.dtype&&u.attrParams.dtype.value&&a.Df.assert(r.dtype===u.attrParams.dtype.value,(function(){return"The dtype of dict['".concat(u.name,"'] provided in ")+"model.execute(dict) must be "+"".concat(u.attrParams.dtype.value,", but was ").concat(r.dtype)}))}))}},{key:"mapInputs",value:function(e){var t={};for(var n in e){if(null!=this._signature&&null!=this._signature.inputs&&null!=this._signature.inputs[n])t[this._signature.inputs[n].name]=e[n];else t[n]=e[n]}return t}},{key:"checkInputs",value:function(e){var t=this,n=Object.keys(e).filter((function(e){var n=Object(ul.g)(e),r=Object(i.a)(n,1)[0];return null==t.graph.nodes[r]}));if(n.length>0)throw new Error("The dict provided in model.execute(dict) has "+"keys: [".concat(n,"] that are not part of graph"))}},{key:"mapOutputs",value:function(e){var t=this;return e.map((function(e){return null!=t._signature&&null!=t._signature.outputs&&null!=t._signature.outputs[e]?t._signature.outputs[e].name:e}),{})}},{key:"checkOutputs",value:function(e){var t=this;e.forEach((function(e){var n=Object(ul.g)(e),r=Object(i.a)(n,1)[0];if(!t.graph.nodes[r])throw new Error("The output '".concat(e,"' is not found in the graph"))}))}},{key:"weightIds",get:function(){return this.parent?this.parent.weightIds:this._weightIds}},{key:"functionExecutorMap",get:function(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap}},{key:"weightMap",get:function(){return this.parent?this.parent.weightMap:this._weightMap},set:function(e){var t,n=Object.keys(e).map((function(t){return e[t].map((function(e){return e.id}))}));this._weightIds=(t=[]).concat.apply(t,Object(qn.a)(n)),this._weightMap=e}},{key:"resourceManager",set:function(e){this._resourceManager=e}},{key:"inputs",get:function(){return this._inputs.map((function(e){return{name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}}))}},{key:"outputs",get:function(){return this._outputs.map((function(e){return{name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}}))}},{key:"inputNodes",get:function(){return this._inputs.map((function(e){return e.signatureKey||e.name}))}},{key:"outputNodes",get:function(){return this._outputs.map((function(e){var t=e.signatureKey||e.name;return e.defaultOutput?"".concat(t,":").concat(e.defaultOutput):t}))}},{key:"functions",get:function(){var e=this;return Object.keys(this._functions).reduce((function(t,n){return t[n]=e._functions[n].signature,t}),{})}}]),e}(),ed=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object($r.a)(this,e),this.hashTableNameToHandle=t,this.hashTableMap=n}return Object(ea.a)(e,[{key:"addHashTable",value:function(e,t){this.hashTableNameToHandle[e]=t.handle,this.hashTableMap[t.id]=t}},{key:"getHashTableHandleByName",value:function(e){return this.hashTableNameToHandle[e]}},{key:"getHashTableById",value:function(e){return this.hashTableMap[e]}},{key:"dispose",value:function(){for(var e in this.hashTableMap)this.hashTableMap[e].clearAndClose(),delete this.hashTableMap[e];for(var t in this.hashTableNameToHandle)this.hashTableNameToHandle[t].dispose(),delete this.hashTableNameToHandle[t]}}]),e}(),td=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a.ne;Object($r.a)(this,e),this.modelUrl=t,this.loadOptions=n,this.version="n/a",this.io=r,null==n&&(this.loadOptions={}),this.resourceManager=new ed}return Object(ea.a)(e,[{key:"findIOHandler",value:function(){var e=this.modelUrl;if(null!=e.load)this.handler=e;else if(null!=this.loadOptions.requestInit)this.handler=this.io.browserHTTPRequest(e,this.loadOptions);else{var t=this.io.getLoadHandlers(e,this.loadOptions);if(0===t.length)t.push(this.io.browserHTTPRequest(e,this.loadOptions));else if(t.length>1)throw new Error("Found more than one (".concat(t.length,") load handlers for ")+"URL '".concat([e],"'"));this.handler=t[0]}}},{key:"load",value:function(){var e=this;if(this.findIOHandler(),null==this.handler.load)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");var t=this.handler.load();return a.Df.isPromise(t)?t.then((function(t){return e.loadSync(t)})):this.loadSync(t)}},{key:"loadSync",value:function(e){this.artifacts=e;var t=this.artifacts.modelTopology,n=this.artifacts.signature;if(null!=this.artifacts.userDefinedMetadata){var r=this.artifacts.userDefinedMetadata;null!=r.signature&&(n=r.signature),null!=r.structuredOutputKeys&&(this.structuredOutputKeys=r.structuredOutputKeys)}this.signature=n,this.version="".concat(t.versions.producer,".").concat(t.versions.minConsumer);var a=this.io.decodeWeights(this.artifacts.weightData,this.artifacts.weightSpecs);if(this.executor=new $l(sl.a.Instance.transformGraph(t,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(a),this.executor.resourceManager=this.resourceManager,null!=e.modelInitializer&&null!=e.modelInitializer.node){var i=sl.a.Instance.transformGraph(e.modelInitializer);this.initializer=new $l(i),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializer.executeAsync({},[])}return!0}},{key:"save",value:function(){var e=Object(Oo.a)(wo.a.mark((function e(t,n){var r;return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!==typeof t){e.next=9;break}if(0!==(r=this.io.getSaveHandlers(t)).length){e.next=6;break}throw new Error("Cannot find any save handlers for URL '".concat(t,"'"));case 6:if(!(r.length>1)){e.next=8;break}throw new Error("Found more than one (".concat(r.length,") save handlers for ")+"URL '".concat(t,"'"));case 8:t=r[0];case 9:if(null!=t.save){e.next=11;break}throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");case 11:return e.abrupt("return",t.save(this.artifacts));case 12:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"predict",value:function(e,t){var n=this,r=this.execute(e,this.outputNodes);if(this.structuredOutputKeys){var i=r instanceof a.gd?[r]:r,o={};return i.forEach((function(e,t){return o[n.structuredOutputKeys[t]]=e})),o}return r}},{key:"normalizeInputs",value:function(e){if(!(e instanceof a.gd)&&!Array.isArray(e))return e;if((e=Array.isArray(e)?e:[e]).length!==this.inputNodes.length)throw new Error("Input tensor count mismatch,"+"the graph model has ".concat(this.inputNodes.length," placeholders, ")+"while there are ".concat(e.length," input tensors."));return this.inputNodes.reduce((function(t,n,r){return t[n]=e[r],t}),{})}},{key:"normalizeOutputs",value:function(e){return e=e||this.outputNodes,Array.isArray(e)?e:[e]}},{key:"execute",value:function(e,t){e=this.normalizeInputs(e),t=this.normalizeOutputs(t);var n=this.executor.execute(e,t);return n.length>1?n:n[0]}},{key:"executeAsync",value:function(){var e=Object(Oo.a)(wo.a.mark((function e(t,n){var r;return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.normalizeInputs(t),n=this.normalizeOutputs(n),e.next=4,this.executor.executeAsync(t,n);case 4:return r=e.sent,e.abrupt("return",r.length>1?r:r[0]);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getIntermediateTensors",value:function(){return this.executor.getIntermediateTensors()}},{key:"disposeIntermediateTensors",value:function(){this.executor.disposeIntermediateTensors()}},{key:"convertTensorMapToTensorsMap",value:function(e){return Object.keys(e).reduce((function(t,n){return t[n]=[e[n]],t}),{})}},{key:"dispose",value:function(){this.executor.dispose(),this.initializer&&this.initializer.dispose(),this.resourceManager.dispose()}},{key:"modelVersion",get:function(){return this.version}},{key:"inputNodes",get:function(){return this.executor.inputNodes}},{key:"outputNodes",get:function(){return this.executor.outputNodes}},{key:"inputs",get:function(){return this.executor.inputs}},{key:"outputs",get:function(){return this.executor.outputs}},{key:"weights",get:function(){return this.executor.weightMap}},{key:"metadata",get:function(){return this.artifacts.userDefinedMetadata}},{key:"modelSignature",get:function(){return this.signature}},{key:"modelStructuredOutputKeys",get:function(){return this.structuredOutputKeys}}]),e}();function nd(e){return rd.apply(this,arguments)}function rd(){return(rd=Object(Oo.a)(wo.a.mark((function e(t){var n,r,i,o=arguments;return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=o.length>1&&void 0!==o[1]?o[1]:{},r=o.length>2&&void 0!==o[2]?o[2]:a.ne,null!=t){e.next=4;break}throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");case 4:return null==n&&(n={}),n.fromTFHub&&"string"===typeof t&&(t=ad(t)),i=new td(t,n,r),e.next=9,i.load();case 9:return e.abrupt("return",i);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ad(e){return e.endsWith("/")||(e+="/"),"".concat(e).concat("model.json").concat("?tfjs-format=file")}var id=n(199),od=n(55),sd=n(83),ud=function(){function e(){Object($r.a)(this,e),this.size=null}return Object(ea.a)(e,[{key:"batch",value:function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this;return a.Df.assert(e>0,(function(){return"batchSize needs to be positive, but it is\n      ".concat(e)})),t=this.size===1/0||null==this.size?this.size:n?Math.ceil(this.size/e):Math.floor(this.size/e),cd(Object(Oo.a)(wo.a.mark((function t(){return wo.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.iterator();case 2:return t.abrupt("return",t.sent.columnMajorBatch(e,n,ld));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"concatenate",value:function(e){var t,n=this;return t=this.size===1/0||e.size===1/0?1/0:null!=this.size&&null!=e.size?this.size+e.size:null,cd(Object(Oo.a)(wo.a.mark((function t(){return wo.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.t0=t.sent,t.next=5,e.iterator();case 5:return t.t1=t.sent,t.abrupt("return",t.t0.concatenate.call(t.t0,t.t1));case 7:case"end":return t.stop()}}),t)}))),t)}},{key:"filter",value:function(e){var t,n=this;return t=this.size===1/0?1/0:null,cd(Object(Oo.a)(wo.a.mark((function t(){return wo.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.abrupt("return",t.sent.filter((function(t){return a.wf((function(){return e(t)}))})));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"forEachAsync",value:function(){var e=Object(Oo.a)(wo.a.mark((function e(t){return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.iterator();case 2:return e.abrupt("return",e.sent.forEachAsync(t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"map",value:function(e){var t=this;return cd(Object(Oo.a)(wo.a.mark((function n(){return wo.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.iterator();case 2:return n.abrupt("return",n.sent.map((function(t){return a.wf((function(){return e(t)}))})));case 3:case"end":return n.stop()}}),n)}))),this.size)}},{key:"mapAsync",value:function(e){var t=this;return cd(Object(Oo.a)(wo.a.mark((function n(){return wo.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.iterator();case 2:return n.abrupt("return",n.sent.mapAsync(e));case 3:case"end":return n.stop()}}),n)}))),this.size)}},{key:"prefetch",value:function(e){if(null==e)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");var t=this;return cd(Object(Oo.a)(wo.a.mark((function n(){return wo.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.iterator();case 2:return n.abrupt("return",n.sent.prefetch(e));case 3:case"end":return n.stop()}}),n)}))),this.size)}},{key:"repeat",value:function(e){var t,n=this;return t=null!=this.size&&e>0?this.size*e:0===e?0:null!=this.size&&(void 0===e||e<0)?1/0:null,cd(Object(Oo.a)(wo.a.mark((function t(){var r;return wo.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Object(od.e)(Object(Oo.a)(wo.a.mark((function e(){return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.iterator();case 2:return e.t0=e.sent,e.abrupt("return",{value:e.t0,done:!1});case 4:case"end":return e.stop()}}),e)})))),t.abrupt("return",Object(od.d)(r.take(e)));case 2:case"end":return t.stop()}}),t)}))),t)}},{key:"skip",value:function(e){var t,n=this;return t=null!=this.size&&e>=0&&this.size>=e?this.size-e:null!=this.size&&(this.size<e||void 0===e||e<0)?0:null,cd(Object(Oo.a)(wo.a.mark((function t(){return wo.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.abrupt("return",t.sent.skip(e));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"shuffle",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(null==e||e<0)throw null==this.size?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError("`Dataset.shuffle()` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for `tf.Tensor`s), consider setting "+"bufferSize to the dataset size (".concat(this.size," elements)"));var r=this,i=id.alea(t||a.Df.now().toString());return cd(Object(Oo.a)(wo.a.mark((function t(){var a;return wo.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=i.int32(),n&&(a+=i.int32()),t.next=4,r.iterator();case 4:return t.abrupt("return",t.sent.shuffle(e,a.toString()));case 5:case"end":return t.stop()}}),t)}))),this.size)}},{key:"take",value:function(e){var t,n=this;return t=null!=this.size&&this.size>e?e:null!=this.size&&this.size<=e?this.size:null,cd(Object(Oo.a)(wo.a.mark((function t(){return wo.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.abrupt("return",t.sent.take(e));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"toArray",value:function(){var e=Object(Oo.a)(wo.a.mark((function e(){return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.size!==1/0){e.next=2;break}throw new Error("Can not convert infinite data stream to array.");case 2:return e.next=4,this.iterator();case 4:return e.abrupt("return",e.sent.toArray());case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"toArrayForTest",value:function(){var e=Object(Oo.a)(wo.a.mark((function e(){return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.size!==1/0){e.next=2;break}throw new Error("Can not convert infinite data stream to array.");case 2:return e.next=4,this.iterator();case 4:return e.abrupt("return",e.sent.toArrayForTest());case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}();function cd(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new(function(n){Object(na.a)(a,n);var r=Object(ra.a)(a);function a(){var e;return Object($r.a)(this,a),(e=r.apply(this,arguments)).size=t,e}return Object(ea.a)(a,[{key:"iterator",value:function(){var t=Object(Oo.a)(wo.a.mark((function t(){return wo.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e());case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()}]),a}(ud))}function ld(e){if(null===e)return null;var t=e[0];return Object(sd.a)(t)?{value:function(e){if(0===e.length)throw new Error("Can't make a batch of zero elements.");return e[0]instanceof a.gd?a.nf(e):a.sf(e)}(e),recurse:!1}:{value:null,recurse:!0}}ud.MAX_BUFFER_SIZE=1e4;Symbol("out"),Symbol("field"),Symbol("quote"),Symbol("quoteafterquote"),Symbol("quoteinquote"),od.a,od.a,n(249).a;function dd(e,t){Array.isArray(e)||(e=[e]),e.forEach((function(e){null!=e&&a.Df.assert("complex64"!==e.dtype,(function(){return"".concat(t," does not support complex64 tensors in the CPU backend.")}))}))}var pd=a.pe.whereImpl,fd=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(){var e;return Object($r.a)(this,n),(e=t.call(this)).blockSize=48,e.firstUse=!0,e.data=new a.N(Object(ta.a)(e),Object(a.ae)()),e}return Object(ea.a)(n,[{key:"nextDataId",value:function(){return n.nextDataId++}},{key:"write",value:function(e,t,n){this.firstUse&&(this.firstUse=!1,Object(a.be)().get("IS_NODE")&&a.zd.warn("\n============================\nHi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. \n============================"));var r={id:this.nextDataId()};return this.data.set(r,{values:e,dtype:n,refCount:1}),r}},{key:"makeTensorInfo",value:function(e,t,n){var r;if("string"===t&&null!=n&&n.length>0&&a.Df.isString(n[0])){var i=n.map((function(e){return a.Df.encodeString(e)}));r=this.write(i,e,t)}else r=this.write(n,e,t);return{dataId:r,shape:e,dtype:t}}},{key:"refCount",value:function(e){return this.data.has(e)?this.data.get(e).refCount:0}},{key:"incRef",value:function(e){this.data.get(e).refCount++}},{key:"decRef",value:function(e){this.data.has(e)&&this.data.get(e).refCount--}},{key:"move",value:function(e,t,n,r,a){this.data.set(e,{values:t,dtype:r,refCount:a})}},{key:"numDataIds",value:function(){return this.data.numDataIds()}},{key:"read",value:function(){var e=Object(Oo.a)(wo.a.mark((function e(t){return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.readSync(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"readSync",value:function(e){var t=this.data.get(e),n=t.dtype,r=t.complexTensorInfos;if("complex64"===n){var i=this.readSync(r.real.dataId),o=this.readSync(r.imag.dataId);return a.zd.mergeRealAndImagArrays(i,o)}return this.data.get(e).values}},{key:"bufferSync",value:function(e){var t=this.readSync(e.dataId);if("string"===e.dtype)try{var n=t.map((function(e){return a.Df.decodeString(e)}));return Object(a.Gd)(e.shape,e.dtype,n)}catch(r){throw new Error("Failed to decode encoded string bytes into utf-8")}return Object(a.Gd)(e.shape,e.dtype,t)}},{key:"makeOutput",value:function(e,t,n){return Object(a.ae)().makeTensorFromTensorInfo(this.makeTensorInfo(t,n,e),this)}},{key:"disposeData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.data.has(e)){if(this.data.get(e).refCount--,!t&&this.data.get(e).refCount>0)return!1;var n=this.data.get(e),r=n.complexTensorInfos;null!=r&&(this.disposeData(r.real.dataId,!0),this.disposeData(r.imag.dataId,!0)),this.data.delete(e)}return!0}},{key:"disposeIntermediateTensorInfo",value:function(e){this.disposeData(e.dataId)}},{key:"time",value:function(){var e=Object(Oo.a)(wo.a.mark((function e(t){var n,r;return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.Df.now(),t(),r=a.Df.now()-n,e.abrupt("return",{kernelMs:r});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"memory",value:function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}},{key:"where",value:function(e){dd([e],"where");var t=this.readSync(e.dataId);return pd(e.shape,t)}},{key:"dispose",value:function(){}},{key:"floatPrecision",value:function(){return 32}},{key:"epsilon",value:function(){return Object(Fo.a)(Object(Mo.a)(n.prototype),"epsilon",this).call(this)}}]),n}(a.yb);fd.nextDataId=0;function hd(e,t,n){return function(r){var i=r.inputs,o=r.attrs,s=r.backend,u=i.x;if(dd(u,e),"string"===u.dtype||"string"===n)throw new Error("unaryKernelFunc does not support string input/output");for(var c=s,l=c.data.get(u.dataId).values,d=a.Df.sizeFromShape(u.shape),p=n||u.dtype,f=a.Df.getArrayFromDType(p,d),h=0;h<d;++h)f[h]=t(l[h],o);return c.makeTensorInfo(u.shape,p,f)}}function md(e,t,n){return function(r){var a=r.inputs,i=r.attrs,o=r.backend,s=a.x;if(dd(s,e),"string"===s.dtype||"string"===n)throw new Error("unaryKernelFunc does not support string input/output");var u=o,c=u.data.get(s.dataId).values,l=n||s.dtype,d=t(c,l,i);return u.makeTensorInfo(s.shape,l,d)}}Object(a.Re)("cpu",(function(){return new fd}),1);var vd=hd(a.Y,(function(e){return e>=0?e:Math.exp(e)-1})),bd={kernelName:a.Y,backendName:"cpu",kernelFunc:vd};function gd(e){var t=e.inputs,n=e.backend,r=t.x;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var yd={kernelName:a.tb,backendName:"cpu",kernelFunc:gd};function xd(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.x,o=r.alpha;dd([i],"leakyRelu");for(var s=a.Df.sizeFromShape(i.shape),u=n.data.get(i.dataId).values,c=a.Df.getTypedArrayFromDType("float32",s),l=0;l<u.length;l++)c[l]=u[l]<0?o*u[l]:u[l];return n.makeTensorInfo(i.shape,"float32",c)}var kd={kernelName:a.Bb,backendName:"cpu",kernelFunc:xd};function wd(e){return function(t,n,r,i,o){var s=a.zd.assertAndGetBroadcastShape(t,n),u=s.length,c=a.Df.computeStrides(s),l=a.Df.sizeFromShape(s),d=a.Df.getTypedArrayFromDType(o,l),p=t.length,f=n.length,h=a.Df.computeStrides(t),m=a.Df.computeStrides(n),v=a.zd.getBroadcastDims(t,s),b=a.zd.getBroadcastDims(n,s);if(v.length+b.length===0)for(var g=0;g<d.length;++g)d[g]=e(r[g%r.length],i[g%i.length]);else for(var y=function(t){var n=a.Df.indexToLoc(t,u,c),o=n.slice(-p);v.forEach((function(e){return o[e]=0}));var s=a.Df.locToIndex(o,p,h),l=n.slice(-f);b.forEach((function(e){return l[e]=0}));var g=a.Df.locToIndex(l,f,m);d[t]=e(r[s],i[g])},x=0;x<d.length;++x)y(x);return[d,s]}}var Od=wd((function(e,t){return e<0?t*e:e}));function Id(e){var t=e.inputs,n=e.backend,r=t.x,a=t.alpha;dd([r,a],"prelu");var o=n.data.get(r.dataId).values,s=n.data.get(a.dataId).values,u=Od(r.shape,a.shape,o,s,"float32"),c=Object(i.a)(u,2),l=c[0],d=c[1];return n.makeTensorInfo(d,"float32",l)}var Sd={kernelName:a.jc,backendName:"cpu",kernelFunc:Id},Nd=hd(a.rc,(function(e){return Math.max(0,e)})),jd={kernelName:a.rc,backendName:"cpu",kernelFunc:Nd},Td=hd(a.sc,(function(e){return Math.min(Math.max(0,e),6)})),Cd={kernelName:a.sc,backendName:"cpu",kernelFunc:Td};function Ed(e){return function(t,n,r){for(var i=a.Df.getTypedArrayFromDType(n,t.length),o=0;o<t.length;++o)i[o]=e(t[o],r);return i}}var _d=Ed((function(e){return 1/(1+Math.exp(-e))})),Ad=hd(a.Gc,(function(e){return 1/(1+Math.exp(-e))})),Rd={kernelName:a.Gc,backendName:"cpu",kernelFunc:Ad};function Dd(e,t,n,r,a){if("linear"===n)return gd({inputs:{x:t},backend:e});if("relu"===n)return Nd({inputs:{x:t},backend:e});if("elu"===n)return vd({inputs:{x:t},backend:e});if("relu6"===n)return Td({inputs:{x:t},backend:e});if("prelu"===n)return Id({inputs:{x:t,alpha:r},backend:e});if("leakyrelu"===n)return xd({inputs:{x:t},backend:e,attrs:{alpha:a}});if("sigmoid"===n)return Ad({inputs:{x:t},backend:e});throw new Error("Activation ".concat(n," has not been implemented for the CPU backend."))}function Fd(e){var t=e.inputs,n=e.backend,r=t.real,a=t.imag,i=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,s=n.makeTensorInfo(r.shape,"complex64");return n.data.get(s.dataId).complexTensorInfos={real:n.makeTensorInfo(r.shape,"float32",i),imag:n.makeTensorInfo(a.shape,"float32",o)},s}var Md={kernelName:a.z,backendName:"cpu",kernelFunc:Fd};function zd(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"float32";if("complex64"===n){var r=zd(e,t,"float32"),i=zd(e,t,"float32");return Fd({inputs:{real:r,imag:i},backend:e})}var o=a.Df.makeZerosTypedArray(a.Df.sizeFromShape(t),n);return e.makeTensorInfo(t,n,o)}function Ld(e){var t=e.inputs,n=e.backend,r=t.input,a=n.data.get(r.dataId).complexTensorInfos.real,i=n.data.get(a.dataId).values;return n.makeTensorInfo(a.shape,a.dtype,i)}var Pd={kernelName:a.oc,backendName:"cpu",kernelFunc:Ld};function Bd(e,t,n,r){if("int32"===r)return[t,"int32",Int32Array.from(e)];if("bool"===r){var o=a.Df.toTypedArray([0],n),s=wd((function(e,t){return e!==t?1:0}))(t,[],e,o,"bool"),u=Object(i.a)(s,2),c=u[0];return[u[1],"bool",c]}throw new Error("Error in Cast: failed to cast ".concat(n," to ").concat(r))}function Wd(e){var t=e.inputs,n=e.backend,r=e.attrs,o=t.x,s=r.dtype;if("complex64"===s){if("complex64"===o.dtype)return gd({inputs:{x:o},backend:n});var u=zd(n,o.shape,o.dtype),c=Wd({inputs:{x:o},backend:n,attrs:{dtype:"float32"}}),l=Fd({inputs:{real:c,imag:u},backend:n});return n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(c),l}if("complex64"===o.dtype){var d=Ld({inputs:{input:o},backend:n}),p=Wd({inputs:{x:d},backend:n,attrs:{dtype:s}});return n.disposeIntermediateTensorInfo(d),p}if(!a.Df.hasEncodingLoss(o.dtype,s)){var f=gd({inputs:{x:o},backend:n});return{dataId:f.dataId,shape:f.shape,dtype:s}}var h=Bd(n.data.get(o.dataId).values,o.shape,o.dtype,s),m=Object(i.a)(h,3),v=m[0],b=m[1],g=m[2];return n.makeTensorInfo(v,b,g)}var Ud={kernelName:a.w,backendName:"cpu",kernelFunc:Wd};function Vd(e,t,n,r){return null==n?function(n){var o=n.inputs,s=n.backend,u=o.a,c=o.b,l=s;dd([u,c],e);var d=l.data.get(u.dataId).values,p=l.data.get(c.dataId).values,f="string"===u.dtype?a.zd.fromUint8ToStringArray(d):d,h="string"===u.dtype?a.zd.fromUint8ToStringArray(p):p,m=r||u.dtype,v=t(u.shape,c.shape,f,h,m),b=Object(i.a)(v,2),g=b[0],y=b[1];return l.makeTensorInfo(y,m,g)}:function(e){var a=e.inputs,o=e.backend,s=a.a,u=a.b,c=o;if("complex64"===s.dtype||"complex64"===u.dtype){var l=Wd({inputs:{x:s},backend:c,attrs:{dtype:"complex64"}}),d=c.data.get(l.dataId),p=d.complexTensorInfos.real,f=d.complexTensorInfos.imag,h=c.data.get(p.dataId).values,m=c.data.get(f.dataId).values,v=Wd({inputs:{x:u},backend:c,attrs:{dtype:"complex64"}}),b=c.data.get(v.dataId),g=b.complexTensorInfos.real,y=b.complexTensorInfos.imag,x=c.data.get(g.dataId).values,k=c.data.get(y.dataId).values,w=n(s.shape,u.shape,h,m,x,k),O=Object(i.a)(w,3),I=O[0],S=O[1],N=O[2],j=c.makeTensorInfo(N,"float32",I),T=c.makeTensorInfo(N,"float32",S),C=Fd({inputs:{real:j,imag:T},backend:c});return c.disposeIntermediateTensorInfo(l),c.disposeIntermediateTensorInfo(v),c.disposeIntermediateTensorInfo(j),c.disposeIntermediateTensorInfo(T),C}var E=c.data.get(s.dataId).values,_=c.data.get(u.dataId).values,A=r||s.dtype,R=t(s.shape,u.shape,E,_,A),D=Object(i.a)(R,2),F=D[0],M=D[1];return c.makeTensorInfo(M,A,F)}}function Gd(e){return function(t,n,r,i,o,s){var u=a.zd.assertAndGetBroadcastShape(t,n),c=a.Df.sizeFromShape(u),l=u.length,d=a.Df.computeStrides(u),p=a.Df.getTypedArrayFromDType("float32",c),f=a.Df.getTypedArrayFromDType("float32",c),h=a.zd.getBroadcastDims(t,u),m=a.zd.getBroadcastDims(n,u),v=a.zd.mergeRealAndImagArrays(r,i),b=a.zd.mergeRealAndImagArrays(o,s),g=t.length,y=a.Df.computeStrides(t),x=n.length,k=a.Df.computeStrides(n);if(h.length+m.length===0)for(var w=0;w<p.length;w++){var O=w%v.length,I=w%b.length,S=e(v[2*O],v[2*O+1],b[2*I],b[2*I+1]);p[w]=S.real,f[w]=S.imag}else for(var N=function(t){var n=a.Df.indexToLoc(t,l,d),r=n.slice(-g);h.forEach((function(e){return r[e]=0}));var i=a.Df.locToIndex(r,g,y),o=n.slice(-x);m.forEach((function(e){return o[e]=0}));var s=a.Df.locToIndex(o,x,k),u=e(v[2*i],v[2*i+1],b[2*s],b[2*s+1]);p[t]=u.real,f[t]=u.imag},j=0;j<p.length;j++)N(j);return[p,f,u]}}var Hd=wd((function(e,t){return e+t})),qd=Gd((function(e,t,n,r){return{real:e+n,imag:t+r}})),Kd=Vd(a.d,Hd,qd),Xd={kernelName:a.d,backendName:"cpu",kernelFunc:Kd};function Yd(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.x,o=r.shape,s=a.Df.sizeFromShape(i.shape),u=a.Df.inferFromImplicitShape(o,s),c=a.Df.sizeFromShape(u);a.Df.assert(s===c,(function(){return"The new shape (".concat(u,") has ").concat(c," elements and the old ")+"shape (".concat(i.shape,") has ").concat(s," elements. The new shape and old ")+"shape must have the same number of elements."})),n.incRef(i.dataId);var l=n.data.get(i.dataId);if(null!=l.complexTensorInfos){var d=l.complexTensorInfos.real,p=l.complexTensorInfos.imag;d.shape=u,p.shape=u}return{dataId:i.dataId,shape:u,dtype:i.dtype}}var Zd={kernelName:a.tc,backendName:"cpu",kernelFunc:Yd};function Jd(e){var t=e.inputs,n=e.backend,r=e.attrs,o=t.a,s=t.b,u=r.transposeA,c=r.transposeB;dd([o,s],"matMul");var l=o.shape.length,d=s.shape.length,p=u?o.shape[l-2]:o.shape[l-1],f=c?s.shape[d-1]:s.shape[d-2],h=u?o.shape[l-1]:o.shape[l-2],m=c?s.shape[d-2]:s.shape[d-1],v=o.shape.slice(0,-2),b=s.shape.slice(0,-2),g=a.Df.sizeFromShape(v),y=a.Df.sizeFromShape(b),x=a.Ed.assertAndGetBroadcastShape(o.shape.slice(0,-2),s.shape.slice(0,-2)).concat([h,m]);a.Df.assert(p===f,(function(){return"Error in matMul: inner shapes (".concat(p,") and (")+"".concat(f,") of Tensors with shapes ").concat(o.shape," and ")+"".concat(s.shape," and transposeA=").concat(u)+" and transposeB=".concat(c," must match.")}));for(var k=c?[y,m,f]:[y,f,m],w=Yd({inputs:{x:o},backend:n,attrs:{shape:u?[g,p,h]:[g,h,p]}}),O=Yd({inputs:{x:s},backend:n,attrs:{shape:k}}),I=u?w.shape[1]:w.shape[2],S=u?w.shape[2]:w.shape[1],N=c?O.shape[1]:O.shape[2],j=Math.max(g,y),T=n.data.get(w.dataId).values,C=n.data.get(O.dataId).values,E=a.Df.computeStrides(w.shape),_=a.Df.computeStrides(O.shape),A=u?[E[0],1,E[1]]:[E[0],E[1],1],R=Object(i.a)(A,3),D=R[0],F=R[1],M=R[2],z=c?[1,_[1],_[0]]:[_[1],1,_[0]],L=Object(i.a)(z,3),P=L[0],B=L[1],W=L[2],U=S*N,V=Object(a.Gd)([j,S,N],w.dtype),G=V.values,H=n.blockSize,q=0;q<j;q++)for(var K=0;K<S;K+=H)for(var X=0;X<N;X+=H)for(var Y=0;Y<I;Y+=H)for(var Z=Math.min(K+H,S),J=Math.min(X+H,N),Q=Math.min(Y+H,I),$=K;$<Z;$++)for(var ee=X;ee<J;ee++){for(var te=0,ne=Y;ne<Q;ne++){var re=Math.min(q,g-1)*D,ae=Math.min(q,y-1)*W;te+=T[re+$*F+ne*M]*C[ne*P+ee*B+ae]}G[q*U+($*N+ee)]+=te}return n.disposeIntermediateTensorInfo(w),n.disposeIntermediateTensorInfo(O),n.makeTensorInfo(x,V.dtype,V.values)}var Qd={kernelName:a.s,backendName:"cpu",kernelFunc:Jd};var $d={kernelName:a.qd,backendName:"cpu",kernelFunc:function(e){var t,n,r,a=e.inputs,i=e.backend,o=e.attrs,s=a.a,u=a.b,c=a.bias,l=a.preluActivationWeights,d=o.transposeA,p=o.transposeB,f=o.activation,h=o.leakyreluAlpha,m=[];t=Jd({inputs:{a:s,b:u},attrs:{transposeA:d,transposeB:p},backend:i}),c&&(n=Kd({inputs:{a:t,b:c},backend:i}),m.push(t),t=n),f&&(r=Dd(i,t,f,l,h),m.push(t),t=r);for(var v=0,b=m;v<b.length;v++){var g=b[v];i.disposeIntermediateTensorInfo(g)}return t}};function ep(e){for(var t=new Float32Array(e.length),n=0;n<e.length;++n)t[n]=Math.abs(e[n]);return t}var tp={kernelName:a.a,backendName:"cpu",kernelFunc:function(e){var t=e.inputs.x,n=e.backend;dd(t,"abs");var r=new Float32Array(a.Df.sizeFromShape(t.shape));return r=ep(n.data.get(t.dataId).values),n.makeOutput(r,t.shape,t.dtype)}},np=hd(a.b,(function(e){return Math.acos(e)})),rp={kernelName:a.b,backendName:"cpu",kernelFunc:np},ap=hd(a.c,(function(e){return Math.acosh(e)})),ip={kernelName:a.c,backendName:"cpu",kernelFunc:ap};var op={kernelName:a.e,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t;dd(t,"addN");for(var i=r.map((function(e){return n.data.get(e.dataId).values})),o=Object(a.Gd)(r[0].shape,r[0].dtype),s=o.values,u=0;u<r.length;u++)for(var c=i[u],l=0;l<s.length;l++)s[l]+=c[l];return n.makeTensorInfo(o.shape,o.dtype,o.values)}};function sp(e,t,n,r,i){for(var o=t.length,s=a.Df.sizeFromShape(t),u=a.Df.computeStrides(t),c=a.Df.computeStrides(i),l=a.Df.getTypedArrayFromDType(n,a.Df.sizeFromShape(i)),d=0;d<s;++d){for(var p=a.Df.indexToLoc(d,o,u),f=new Array(p.length),h=0;h<f.length;h++)f[h]=p[r[h]];l[a.Df.locToIndex(f,o,c)]=e[d]}return l}function up(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.perm;dd(a,"transpose");for(var o=a.shape.length,s=new Array(o),u=0;u<s.length;u++)s[u]=a.shape[i[u]];var c=sp(r.data.get(a.dataId).values,a.shape,a.dtype,i,s);return{dataId:r.write(c,s,a.dtype),shape:s,dtype:a.dtype}}var cp={kernelName:a.ld,backendName:"cpu",kernelFunc:up};var lp={kernelName:a.f,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,o=t.x,s=r.axis,u=r.keepDims;dd(o,"all");var c=a.Df.parseAxisParam(s,o.shape),l=c,d=a.zd.getAxesPermutation(l,o.shape.length),p=o;null!=d&&(p=up({inputs:{x:o},backend:n,attrs:{perm:d}}),l=a.zd.getInnerMostAxes(l.length,o.shape.length)),a.zd.assertAxesAreInnerMostDims("all",l,p.shape.length);for(var f=a.zd.computeOutAndReduceShapes(p.shape,l),h=Object(i.a)(f,2),m=h[0],v=h[1],b=a.Df.sizeFromShape(v),g=a.Df.makeZerosTypedArray(a.Df.sizeFromShape(m),p.dtype),y=n.data.get(p.dataId).values,x=0;x<g.length;++x){for(var k=x*b,w=y[k],O=0;O<b;++O){var I=y[k+O];w=w&&I}g[x]=w}null!=d&&n.disposeIntermediateTensorInfo(p);var S=n.makeTensorInfo(m,p.dtype,g);if(u){var N=Yd({inputs:{x:S},backend:n,attrs:{shape:a.zd.expandShapeToKeepDim(m,c)}});return n.disposeIntermediateTensorInfo(S),N}return S}};var dp={kernelName:a.g,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,o=t.x,s=r.axis,u=r.keepDims;dd(o,"any");var c=a.Df.parseAxisParam(s,o.shape),l=c,d=a.zd.getAxesPermutation(l,o.shape.length),p=o;null!=d&&(p=up({inputs:{x:o},backend:n,attrs:{perm:d}}),l=a.zd.getInnerMostAxes(l.length,o.shape.length)),a.zd.assertAxesAreInnerMostDims("any",l,p.shape.length);for(var f=a.zd.computeOutAndReduceShapes(p.shape,l),h=Object(i.a)(f,2),m=h[0],v=h[1],b=a.Df.sizeFromShape(v),g=a.Df.makeZerosTypedArray(a.Df.sizeFromShape(m),p.dtype),y=n.data.get(p.dataId).values,x=0;x<g.length;++x){for(var k=x*b,w=y[k],O=0;O<b;++O){var I=y[k+O];w=w||I}g[x]=w}null!=d&&n.disposeIntermediateTensorInfo(p);var S=n.makeTensorInfo(m,p.dtype,g);if(u){var N=Yd({inputs:{x:S},backend:n,attrs:{shape:a.zd.expandShapeToKeepDim(m,c)}});return n.disposeIntermediateTensorInfo(S),N}return S}};var pp={kernelName:a.h,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,o=t.x,s=r.axis;dd(o,"argMax");var u=a.Df.parseAxisParam(s,o.shape),c=a.zd.getAxesPermutation(u,o.shape.length),l=o,d=[];null!=c&&(l=up({inputs:{x:o},backend:n,attrs:{perm:c}}),d.push(l),u=a.zd.getInnerMostAxes(u.length,l.shape.length)),u=[u[0]],a.zd.assertAxesAreInnerMostDims("argMax",u,l.shape.length);for(var p=a.zd.computeOutAndReduceShapes(l.shape,u),f=Object(i.a)(p,2),h=f[0],m=f[1],v=a.Df.sizeFromShape(h),b=a.Df.makeZerosTypedArray(v,"int32"),g=a.Df.sizeFromShape(m),y=n.data.get(l.dataId).values,x=0;x<b.length;++x){for(var k=x*g,w=y[k],O=0,I=0;I<g;++I){var S=y[k+I];S>w&&(w=S,O=I)}b[x]=O}return d.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(h,"int32",b)}};var fp={kernelName:a.i,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,o=t.x,s=r.axis;dd(o,"argMin");var u=a.Df.parseAxisParam(s,o.shape),c=a.zd.getAxesPermutation(u,o.shape.length),l=o,d=[];null!=c&&(l=up({inputs:{x:o},backend:n,attrs:{perm:c}}),d.push(l),u=a.zd.getInnerMostAxes(u.length,l.shape.length)),u=[u[0]],a.zd.assertAxesAreInnerMostDims("argMin",u,l.shape.length);for(var p=a.zd.computeOutAndReduceShapes(l.shape,u),f=Object(i.a)(p,2),h=f[0],m=f[1],v=a.Df.sizeFromShape(h),b=a.Df.makeZerosTypedArray(v,"int32"),g=a.Df.sizeFromShape(m),y=n.data.get(l.dataId).values,x=0;x<b.length;++x){for(var k=x*g,w=y[k],O=0,I=0;I<g;++I){var S=y[k+I];S<w&&(w=S,O=I)}b[x]=O}return d.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(h,"int32",b)}},hp=hd(a.j,(function(e){return Math.asin(e)})),mp={kernelName:a.j,backendName:"cpu",kernelFunc:hp},vp=hd(a.k,(function(e){return Math.asinh(e)})),bp={kernelName:a.k,backendName:"cpu",kernelFunc:vp},gp=hd(a.l,(function(e){return Math.atan(e)})),yp={kernelName:a.l,backendName:"cpu",kernelFunc:gp},xp=wd((function(e,t){return Math.atan2(e,t)})),kp=Vd(a.m,xp),wp={kernelName:a.m,backendName:"cpu",kernelFunc:kp},Op=hd(a.n,(function(e){return Math.atanh(e)})),Ip={kernelName:a.n,backendName:"cpu",kernelFunc:Op};function Sp(e,t,n,r,i,o){for(var s=i.strideHeight,u=i.strideWidth,c=i.dilationHeight,l=i.dilationWidth,d=i.effectiveFilterHeight,p=i.effectiveFilterWidth,f=i.padInfo.top,h=i.padInfo.left,m="max"===o?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,v=Object(a.Gd)(i.outShape,n),b=v.values,g=i.outShape[1]*i.outShape[2]*i.outShape[3],y=i.outShape[2]*i.outShape[3],x=i.outShape[3],k=0;k<i.batchSize;++k)for(var w=k*g,O=k*r[0],I=0;I<i.inChannels;++I)for(var S=0;S<i.outHeight;++S)for(var N=S*s-f,j=Math.max(0,N),T=Math.min(i.inHeight,d+N),C=w+S*y,E=0;E<i.outWidth;++E){for(var _=E*u-h,A=Math.max(0,_),R=Math.min(i.inWidth,p+_),D=m,F=0,M=0,z=j;z<T;z+=c){for(var L=O+z*r[1],P=A;P<R;P+=l){var B=e[L+P*r[2]+I];"max"===o&&B>D?D=B:"avg"===o&&(F+=B,M++)}if(isNaN(D))break}b[C+E*x+I]="avg"===o?F/M:D}return v}function Np(e,t,n,r){for(var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=Object(a.Gd)(r.outShape,"int32"),u=r.strideHeight,c=r.strideWidth,l=r.dilationHeight,d=r.dilationWidth,p=r.effectiveFilterHeight,f=r.effectiveFilterWidth,h=r.padInfo.top,m=r.padInfo.left,v=Object(a.Gd)(t,n,e),b=0;b<r.batchSize;++b)for(var g=0;g<r.inChannels;++g)for(var y=0;y<r.outHeight;++y){for(var x=y*u-h,k=x;k<0;)k+=l;for(var w=Math.min(r.inHeight,p+x),O=0;O<r.outWidth;++O){for(var I=O*c-m,S=I;S<0;)S+=d;for(var N=Math.min(r.inWidth,f+I),j=Number.NEGATIVE_INFINITY,T=-1,C=k;C<w;C+=l)for(var E=C-x,_=S;_<N;_+=d){var A=_-I,R=v.get(b,C,_,g);R>j&&(j=R,T=i?o?((b*r.inHeight+C)*r.inWidth+_)*r.inChannels+g:(C*r.inWidth+_)*r.inChannels+g:E*f+A)}s.set(T,b,y,O,g)}}return s}function jp(e,t,n,r,i,o){for(var s=i.strideDepth,u=i.strideHeight,c=i.strideWidth,l=i.dilationDepth,d=i.dilationHeight,p=i.dilationWidth,f=i.effectiveFilterDepth,h=i.effectiveFilterHeight,m=i.effectiveFilterWidth,v=i.padInfo.front,b=i.padInfo.top,g=i.padInfo.left,y="max"===o?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,x=Object(a.Gd)(i.outShape,n),k=x.values,w=i.outShape[1]*i.outShape[2]*i.outShape[3]*i.outShape[4],O=i.outShape[2]*i.outShape[3]*i.outShape[4],I=i.outShape[3]*i.outShape[4],S=i.outShape[4],N=0;N<i.batchSize;++N)for(var j=N*w,T=N*r[0],C=0;C<i.inChannels;++C)for(var E=0;E<i.outDepth;++E){for(var _=E*s-v,A=_;A<0;)A+=l;for(var R=Math.min(i.inDepth,f+_),D=j+E*O,F=0;F<i.outHeight;++F){for(var M=F*u-b,z=M;z<0;)z+=d;for(var L=Math.min(i.inHeight,h+M),P=D+F*I,B=0;B<i.outWidth;++B){for(var W=B*c-g,U=W;U<0;)U+=p;for(var V=Math.min(i.inWidth,m+W),G=P+B*S,H=y,q=0,K=0,X=A;X<R;X+=l){for(var Y=T+X*r[1],Z=z;Z<L;Z+=d){for(var J=Y+Z*r[2],Q=U;Q<V;Q+=p){var $=e[J+Q*r[3]+C];if("max"===o&&$>H?H=$:"avg"===o&&(q+=$,K++),isNaN(H))break}if(isNaN(H))break}if(isNaN(H))break}k[G+C]="avg"===o?q/K:H}}}return x}var Tp={kernelName:a.o,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.x;dd(i,"avgPool");var o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode;a.Df.assert(a.zd.eitherStridesOrDilationsAreOne(s,1),(function(){return"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(s," and dilations '").concat(1,"'")}));var l,d=a.zd.computePool2DInfo(i.shape,o,s,1,u,c);if(1===d.filterWidth&&1===d.filterHeight&&a.Df.arraysEqual(d.inShape,d.outShape))l=gd({inputs:{x:i},backend:n});else{var p=n.data.get(i.dataId).values,f=a.Df.computeStrides(i.shape),h=Sp(p,i.shape,i.dtype,f,d,"avg");l=n.makeTensorInfo(d.outShape,i.dtype,h.values)}return l}};var Cp={kernelName:a.p,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.x,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode,l=r.dataFormat;dd(i,"avgPool3d");var d=a.zd.computePool3DInfo(i.shape,o,s,1,u,c,l),p=jp(n.data.get(i.dataId).values,i.shape,i.dtype,a.Df.computeStrides(i.shape),d,"avg");return n.makeTensorInfo(p.shape,"float32",p.values)}};var Ep={kernelName:a.q,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.dy,o=t.input,s=r.filterSize,u=r.strides,c=r.pad,l=r.dimRoundingMode;dd([i,o],"avgPool3DGrad");for(var d=a.zd.computePool3DInfo(o.shape,s,u,1,c,l),p=d.strideDepth,f=d.strideHeight,h=d.strideWidth,m=d.filterDepth,v=d.filterHeight,b=d.filterWidth,g=d.dilationDepth,y=d.dilationHeight,x=d.dilationWidth,k=d.effectiveFilterDepth,w=d.effectiveFilterHeight,O=d.effectiveFilterWidth,I=k-1-d.padInfo.front,S=O-1-d.padInfo.left,N=w-1-d.padInfo.top,j=Object(a.Gd)(o.shape,"float32"),T=1/(m*v*b),C=n.bufferSync(i),E=0;E<d.batchSize;++E)for(var _=0;_<d.inChannels;++_)for(var A=0;A<d.inDepth;++A)for(var R=0;R<d.inHeight;++R)for(var D=0;D<d.inWidth;++D){for(var F=A-I,M=R-N,z=D-S,L=0,P=0;P<k;P+=g){var B=(F+P)/p;if(!(B<0||B>=d.outDepth||Math.floor(B)!==B))for(var W=0;W<w;W+=y){var U=(M+W)/f;if(!(U<0||U>=d.outHeight||Math.floor(U)!==U))for(var V=0;V<O;V+=x){var G=(z+V)/h;if(!(G<0||G>=d.outWidth||Math.floor(G)!==G))L+=C.get(E,B,U,G,_)}}}j.set(L*T,E,A,R,D,_)}return n.makeTensorInfo(j.shape,j.dtype,j.values)}};var _p={kernelName:a.r,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.dy,o=t.input,s=o;dd([i,o],"avgPoolGrad");for(var u=r.filterSize,c=r.strides,l=r.pad,d=a.zd.computePool2DInfo(s.shape,u,c,1,l),p=d.strideHeight,f=d.strideWidth,h=d.filterHeight,m=d.filterWidth,v=d.dilationHeight,b=d.dilationWidth,g=d.effectiveFilterHeight,y=d.effectiveFilterWidth,x=y-1-d.padInfo.left,k=g-1-d.padInfo.top,w=Object(a.Gd)(s.shape,"float32"),O=1/(h*m),I=n.data.get(i.dataId).values,S=Object(a.Gd)(i.shape,"float32",I),N=0;N<d.batchSize;++N)for(var j=0;j<d.inChannels;++j)for(var T=0;T<d.inHeight;++T)for(var C=0;C<d.inWidth;++C){for(var E=T-k,_=C-x,A=0,R=0;R<g;R+=v){var D=(E+R)/p;if(!(D<0||D>=d.outHeight||Math.floor(D)!==D))for(var F=0;F<y;F+=b){var M=(_+F)/f;if(!(M<0||M>=d.outWidth||Math.floor(M)!==M))A+=S.get(N,D,M,j)}}w.set(A*O,N,T,C,j)}return n.makeTensorInfo(w.shape,w.dtype,w.values)}};var Ap={kernelName:a.lb,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.x,o=t.scale,s=t.offset,u=t.mean,c=t.variance;a.Df.assert(u.shape.length===c.shape.length,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),a.Df.assert(null==s||u.shape.length===s.shape.length,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),a.Df.assert(null==o||u.shape.length===o.shape.length,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."})),dd([i,u,c,o,s],"batchNorm");var l=r.varianceEpsilon;null==l&&(l=.001);for(var d=n.data.get(i.dataId).values,p=n.data.get(u.dataId).values,f=n.data.get(c.dataId).values,h=o?n.data.get(o.dataId).values:new Float32Array([1]),m=s?n.data.get(s.dataId).values:new Float32Array([0]),v=new Float32Array(d.length),b=m.length,g=h.length,y=f.length,x=p.length,k=0,w=0,O=0,I=0,S=0;S<d.length;++S)v[S]=m[k++]+(d[S]-p[w++])*h[O++]/Math.sqrt(f[I++]+l),k>=b&&(k=0),w>=x&&(w=0),O>=g&&(O=0),I>=y&&(I=0);return n.makeTensorInfo(i.shape,i.dtype,v)}};function Rp(e,t,n,r,i){var o=a.hf.isSliceContinous(r,t,n),s=a.Df.sizeFromShape(n),u=a.Df.computeStrides(r);if(o){var c=a.hf.computeFlatOffset(t,u);return"string"===i?e.slice(c,c+s):e.subarray(c,c+s)}for(var l="string"===i?a.zd.fromUint8ToStringArray(e):e,d=Object(a.Gd)(r,i,l),p=Object(a.Gd)(n,i),f=0;f<p.size;++f){var h=p.indexToLoc(f),m=h.map((function(e,n){return e+t[n]}));p.set.apply(p,[d.get.apply(d,Object(qn.a)(m))].concat(Object(qn.a)(h)))}return"string"===i?a.zd.fromStringArrayToUint8(p.values):p.values}function Dp(e){var t=e.inputs,n=e.backend,r=e.attrs,o=t.x,s=r.begin,u=r.size;dd(o,"slice");var c=a.hf.parseSliceParams(o,s,u),l=Object(i.a)(c,2),d=l[0],p=l[1];a.hf.assertParamsValid(o,d,p);var f=Rp(n.data.get(o.dataId).values,d,p,o.shape,o.dtype);return n.makeTensorInfo(p,o.dtype,f)}var Fp={kernelName:a.Kc,backendName:"cpu",kernelFunc:Dp};var Mp={kernelName:a.t,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.x,o=r.blockShape,s=r.crops;dd([i],"batchToSpaceND");var u=o.reduce((function(e,t){return e*t})),c=a.zd.getReshaped(i.shape,o,u),l=a.zd.getPermuted(c.length,o.length),d=a.zd.getReshapedPermuted(i.shape,o,u),p=a.zd.getSliceBeginCoords(s,o.length),f=a.zd.getSliceSize(d,s,o.length),h=Yd({inputs:{x:i},backend:n,attrs:{shape:c}}),m=up({inputs:{x:h},backend:n,attrs:{perm:l}}),v=Yd({inputs:{x:m},backend:n,attrs:{shape:d}}),b=Dp({inputs:{x:v},backend:n,attrs:{begin:p,size:f}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(v),b}};function zp(e,t,n,r,i){for(var o=a.Df.sizeFromShape(r),s=a.Df.makeZerosTypedArray(i,n),u=0;u<e.length;u++){var c=e[u];if(c<0)throw new Error("Input x must be non-negative!");c>=i||(s[c]+=o>0?t[u]:1)}return s}function Lp(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=e.shape[0],o=e.shape[1],s=Object(a.Gd)([i,n],t.dtype),u=0;u<i;u++)for(var c=0;c<o;c++){var l=e.get(u,c);if(l<0)throw new Error("Input x must be non-negative!");l>=n||(r?s.set(1,u,l):t.size>0?s.set(s.get(u,l)+t.get(u,c),u,l):s.set(s.get(u,l)+1,u,l))}return s}var Pp={kernelName:a.u,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=zp(n.data.get(a.dataId).values,n.data.get(i.dataId).values,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,s)}};var Bp={kernelName:a.v,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.s0,i=t.s1,o=n.data.get(r.dataId).values,s=n.data.get(i.dataId).values,u=a.zd.assertAndGetBroadcastShape(Array.from(o),Array.from(s));return n.makeTensorInfo([u.length],"int32",Int32Array.from(u))}},Wp=Ed((function(e){return Math.ceil(e)})),Up=md(a.x,Wp),Vp={kernelName:a.x,backendName:"cpu",kernelFunc:Up},Gp=hd(a.y,(function(e,t){var n=t;return e>n.clipValueMax?n.clipValueMax:e<n.clipValueMin?n.clipValueMin:e})),Hp={kernelName:a.y,backendName:"cpu",kernelFunc:Gp},qp={kernelName:a.A,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs.x,n=e.backend,r=new Float32Array(a.Df.sizeFromShape(t.shape)),i=n.data.get(t.dataId),o=i.complexTensorInfos.real,s=i.complexTensorInfos.imag,u=n.data.get(o.dataId).values,c=n.data.get(s.dataId).values,l=0;l<u.length;l++){var d=u[l],p=c[l];r[l]=Math.hypot(d,p)}return n.makeOutput(r,t.shape,"float32")}};function Kp(e,t,n,r){var i=a.Df.getArrayFromDType(n,a.Df.sizeFromShape(t));if(r&&"string"!==n){var o=0;e.forEach((function(e){var t=a.Df.sizeFromShape(e.shape);i.set(e.vals,o),o+=t}))}else{var s=0;e.forEach((function(e){for(var r="string"===n?a.zd.fromUint8ToStringArray(e.vals):e.vals,o=0,u=0;u<e.shape[0];++u)for(var c=u*t[1]+s,l=0;l<e.shape[1];++l)i[c+l]=r[o++];s+=e.shape[1]}))}return i}function Xp(e){var t=e.inputs,n=e.backend,r=t.input,a=n.data.get(r.dataId).complexTensorInfos.imag,i=n.data.get(a.dataId).values;return n.makeTensorInfo(a.shape,a.dtype,i)}var Yp={kernelName:a.ub,backendName:"cpu",kernelFunc:Xp};function Zp(e){var t=e.inputs,n=e.backend,r=e.attrs.axis,i=a.Df.parseAxisParam(r,t[0].shape)[0],o=t.map((function(e){return e.shape}));a.zd.assertParamsConsistent(o,i);var s=a.zd.computeOutShape(t.map((function(e){return e.shape})),i);if(0===a.Df.sizeFromShape(s))return n.makeTensorInfo(s,t[0].dtype,[]);var u=t.filter((function(e){return a.Df.sizeFromShape(e.shape)>0}));if(1===u.length)return gd({inputs:{x:u[0]},backend:n});if("complex64"===u[0].dtype){var c=u.map((function(e){return Ld({inputs:{input:e},backend:n})})),l=u.map((function(e){return Xp({inputs:{input:e},backend:n})})),d=Zp({inputs:c,backend:n,attrs:{axis:i}}),p=Zp({inputs:l,backend:n,attrs:{axis:i}}),f=Fd({inputs:{real:d,imag:p},backend:n});return c.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),l.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),f}var h=u.map((function(e){var t=a.Df.sizeFromShape(e.shape.slice(i));return Yd({inputs:{x:e},backend:n,attrs:{shape:[-1,t]}})})),m=h.map((function(e){return{vals:n.data.get(e.dataId).values,shape:e.shape}}));s=a.zd.computeOutShape(h.map((function(e){return e.shape})),1);var v=1===h[0].shape[0],b=Kp(m,s,t[0].dtype,v),g=a.zd.computeOutShape(u.map((function(e){return e.shape})),i),y=n.makeTensorInfo(g,t[0].dtype,b);return h.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),y}var Jp={kernelName:a.B,backendName:"cpu",kernelFunc:Zp};function Qp(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.x,o=t.filter,s=r.strides,u=r.pad,c=r.dataFormat,l=r.dilations,d=r.dimRoundingMode;dd([i,o],"conv2d");for(var p=a.zd.convertConv2DDataFormat(c),f=a.zd.computeConv2DInfo(i.shape,o.shape,s,l,u,d,!1,p),h=f.filterHeight,m=f.filterWidth,v=f.dilationHeight,b=f.dilationWidth,g=f.padInfo.left,y=f.padInfo.top,x="channelsLast"===f.dataFormat,k=new a.hd(f.outShape,i.dtype),w=a.Df.computeStrides(i.shape),O=a.Df.computeStrides(o.shape),I=w[0],S=x?w[1]:w[2],N=x?w[2]:1,j=x?1:w[1],T=k.strides[0],C=x?k.strides[1]:k.strides[2],E=x?k.strides[2]:1,_=x?1:k.strides[1],A=n.data.get(i.dataId).values,R=n.data.get(o.dataId).values,D=k.values,F=0;F<f.batchSize;++F)for(var M=F*I,z=F*T,L=0;L<f.outHeight;++L)for(var P=z+L*C,B=L*f.strideHeight-y,W=0;W<h;++W){var U=B+W*v;if(!(U<0||U>=f.inHeight))for(var V=W*O[0],G=M+U*S,H=0;H<f.outWidth;++H)for(var q=P+H*E,K=H*f.strideWidth-g,X=0;X<m;++X){var Y=K+X*b;if(!(Y<0||Y>=f.inWidth))for(var Z=G+Y*N,J=V+X*O[1],Q=0;Q<f.inChannels;++Q){for(var $=A[Z+Q*j],ee=0;ee<f.outChannels;++ee)D[q+ee*_]+=$*R[J+ee];J+=f.outChannels}}}return n.makeTensorInfo(k.shape,k.dtype,D)}var $p={kernelName:a.C,backendName:"cpu",kernelFunc:Qp};var ef={kernelName:a.D,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.x,o=t.dy,s=r.strides,u=r.pad,c=r.dataFormat,l=r.dimRoundingMode,d=r.filterShape;dd([i,o],"conv2dBackpropFilter");for(var p=a.zd.convertConv2DDataFormat(c),f=a.zd.computeConv2DInfo(i.shape,d,s,1,u,l,!1,p),h=f.strideHeight,m=f.strideWidth,v=f.filterHeight,b=f.filterWidth,g="channelsLast"===f.dataFormat,y=new a.hd(f.filterShape,"float32"),x=f.padInfo.left,k=f.padInfo.top,w=n.data.get(i.dataId).values,O=n.data.get(o.dataId).values,I=new a.hd(i.shape,i.dtype,w),S=new a.hd(o.shape,o.dtype,O),N=0;N<v;++N)for(var j=Math.max(0,Math.ceil((k-N)/h)),T=Math.min(f.outHeight,(f.inHeight+k-N)/h),C=0;C<b;++C)for(var E=Math.max(0,Math.ceil((x-C)/m)),_=Math.min(f.outWidth,(f.inWidth+x-C)/m),A=0;A<f.inChannels;++A)for(var R=0;R<f.outChannels;++R){for(var D=0,F=0;F<f.batchSize;++F)for(var M=j;M<T;++M)for(var z=N+M*h-k,L=E;L<_;++L){var P=C+L*m-x;D+=g?I.get(F,z,P,A)*S.get(F,M,L,R):I.get(F,A,z,P)*S.get(F,R,M,L)}y.set(D,N,C,A,R)}return n.makeTensorInfo(y.shape,y.dtype,y.values)}};var tf={kernelName:a.E,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,o=t.dy,s=t.filter,u=r.inputShape,c=r.strides,l=r.pad,d=r.dataFormat,p=r.dimRoundingMode;dd([o,s],"conv2dBackpropInput");var f=a.Df.computeStrides(s.shape),h=a.Df.computeStrides(o.shape),m=a.zd.convertConv2DDataFormat(d),v=a.zd.computeConv2DInfo(u,s.shape,c,1,l,p,!1,m),b=new a.hd(v.inShape,"float32"),g=b.values,y=n.data.get(o.dataId).values,x=n.data.get(s.dataId).values,k=Object(i.a)(f,3),w=k[0],O=k[1],I=k[2],S=v.batchSize,N=v.filterHeight,j=v.filterWidth,T=v.inChannels,C=v.inHeight,E=v.inWidth,_=v.outChannels,A=v.outHeight,R=v.outWidth,D=v.strideHeight,F=v.strideWidth;m=v.dataFormat;for(var M=N-1-v.padInfo.top,z=j-1-v.padInfo.left,L="channelsLast"===m,P=b.strides[0],B=L?b.strides[1]:b.strides[2],W=L?b.strides[2]:1,U=L?1:b.strides[1],V=h[0],G=L?h[1]:h[2],H=L?h[2]:1,q=L?1:h[1],K=0;K<S;++K)for(var X=0;X<T;++X)for(var Y=0;Y<C;++Y)for(var Z=Y-M,J=Math.max(0,Math.ceil(Z/D)),Q=Math.min(A,(N+Z)/D),$=0;$<E;++$){for(var ee=$-z,te=Math.max(0,Math.ceil(ee/F)),ne=Math.min(R,(j+ee)/F),re=0,ae=J;ae<Q;++ae)for(var ie=ae*D-Z,oe=te;oe<ne;++oe)for(var se=V*K+G*ae+H*oe,ue=w*(N-1-ie)+O*(j-1-(oe*F-ee))+I*X,ce=0;ce<_;++ce){re+=y[se+q*ce]*x[ue+ce]}g[P*K+B*Y+W*$+U*X]=re}return n.makeTensorInfo(b.shape,b.dtype,b.values)}};var nf={kernelName:a.F,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.x,o=t.filter,s=r.strides,u=r.pad,c=r.dilations;dd([i,o],"conv3d");for(var l=a.zd.computeConv3DInfo(i.shape,o.shape,s,c,u),d=l.filterDepth,p=l.filterHeight,f=l.filterWidth,h=l.dilationDepth,m=l.dilationHeight,v=l.dilationWidth,b=l.padInfo,g=b.front,y=b.left,x=b.top,k=new a.hd(l.outShape,i.dtype),w=n.data.get(i.dataId).values,O=n.data.get(o.dataId).values,I=k.values,S=a.Df.computeStrides(i.shape),N=a.Df.computeStrides(o.shape),j=0;j<l.batchSize;++j)for(var T=j*S[0],C=j*k.strides[0],E=0;E<l.outDepth;++E)for(var _=C+E*k.strides[1],A=E*l.strideDepth-g,R=0;R<d;++R){var D=A+R*h;if(!(D<0||D>=l.inDepth))for(var F=R*N[0],M=T+D*S[1],z=0;z<l.outHeight;++z)for(var L=_+z*k.strides[2],P=z*l.strideHeight-x,B=0;B<p;++B){var W=P+B*m;if(!(W<0||W>=l.inHeight))for(var U=F+B*N[1],V=M+W*S[2],G=0;G<l.outWidth;++G)for(var H=L+G*l.outChannels,q=G*l.strideWidth-y,K=0;K<f;++K){var X=q+K*v;if(!(X<0||X>=l.inWidth))for(var Y=U+K*N[2],Z=V+X*l.inChannels,J=Y,Q=0;Q<l.inChannels;++Q){for(var $=w[Z+Q],ee=0;ee<l.outChannels;++ee)I[H+ee]+=$*O[J+ee];J+=l.outChannels}}}}return n.makeTensorInfo(k.shape,k.dtype,k.values)}};var rf={kernelName:a.G,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,o=t.x,s=t.dy,u=r.strides,c=r.pad,l=r.filterShape;dd([o,s],"conv3dBackpropFilterV2");for(var d=a.Df.computeStrides(o.shape),p=a.Df.computeStrides(s.shape),f=a.zd.computeConv3DInfo(o.shape,l,u,1,c),h=f.strideDepth,m=f.strideHeight,v=f.strideWidth,b=f.filterDepth,g=f.filterHeight,y=f.filterWidth,x=new a.hd(f.filterShape,"float32"),k=x.values,w=Object(i.a)(x.strides,4),O=w[0],I=w[1],S=w[2],N=w[3],j=n.data.get(s.dataId).values,T=Object(i.a)(p,4),C=T[0],E=T[1],_=T[2],A=T[3],R=n.data.get(o.dataId).values,D=Object(i.a)(d,4),F=D[0],M=D[1],z=D[2],L=D[3],P=f.padInfo.front,B=f.padInfo.left,W=f.padInfo.top,U=0;U<b;++U)for(var V=Math.max(0,Math.ceil((P-U)/h)),G=Math.min(f.outDepth,(f.inDepth+P-U)/h),H=U*O,q=0;q<g;++q)for(var K=Math.max(0,Math.ceil((W-q)/m)),X=Math.min(f.outHeight,(f.inHeight+W-q)/m),Y=q*I+H,Z=0;Z<y;++Z)for(var J=Math.max(0,Math.ceil((B-Z)/v)),Q=Math.min(f.outWidth,(f.inWidth+B-Z)/v),$=Z*S+Y,ee=0;ee<f.inChannels;++ee)for(var te=ee*N+$,ne=0;ne<f.outChannels;++ne){for(var re=0,ae=0;ae<f.batchSize;++ae)for(var ie=ae*F,oe=ae*C,se=V;se<G;++se)for(var ue=(U+se*h-P)*M+ie,ce=se*E+oe,le=K;le<X;++le)for(var de=(q+le*m-W)*z+ue,pe=le*_+ce,fe=J;fe<Q;++fe){var he=fe*A+pe;re+=R[(Z+fe*v-B)*L+de+ee]*j[he+ne]}k[te+ne]=re}return n.makeTensorInfo(x.shape,x.dtype,x.values)}};var af={kernelName:a.H,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,o=t.dy,s=t.filter,u=r.pad,c=r.strides,l=r.inputShape;dd([o],"conv3dBackpropInputV2");for(var d=a.Df.computeStrides(o.shape),p=a.Df.computeStrides(s.shape),f=a.zd.computeConv3DInfo(l,s.shape,c,1,u),h=new a.hd(f.inShape,"float32"),m=h.values,v=Object(i.a)(h.strides,4),b=v[0],g=v[1],y=v[2],x=v[3],k=n.data.get(o.dataId).values,w=Object(i.a)(d,4),O=w[0],I=w[1],S=w[2],N=w[3],j=n.data.get(s.dataId).values,T=Object(i.a)(p,4),C=T[0],E=T[1],_=T[2],A=T[3],R=f.batchSize,D=f.filterDepth,F=f.filterHeight,M=f.filterWidth,z=f.inChannels,L=f.inDepth,P=f.inHeight,B=f.inWidth,W=f.outChannels,U=f.outDepth,V=f.outHeight,G=f.outWidth,H=f.strideDepth,q=f.strideHeight,K=f.strideWidth,X=D-1-f.padInfo.front,Y=F-1-f.padInfo.top,Z=M-1-f.padInfo.left,J=0;J<R;++J)for(var Q=0;Q<z;++Q)for(var $=0;$<L;++$)for(var ee=$-X,te=Math.max(0,Math.ceil(ee/H)),ne=Math.min(U,(D+ee)/H),re=0;re<P;++re)for(var ae=re-Y,ie=Math.max(0,Math.ceil(ae/q)),oe=Math.min(V,(F+ae)/q),se=0;se<B;++se){for(var ue=se-Z,ce=Math.max(0,Math.ceil(ue/K)),le=Math.min(G,(M+ue)/K),de=0,pe=te;pe<ne;++pe)for(var fe=pe*H-ee,he=ie;he<oe;++he)for(var me=he*q-ae,ve=ce;ve<le;++ve)for(var be=O*J+I*pe+S*he+N*ve,ge=C*(D-1-fe)+E*(F-1-me)+_*(M-1-(ve*K-ue))+A*Q,ye=0;ye<W;++ye){de+=k[be+ye]*j[ge+ye]}m[b*J+g*$+y*re+x*se+Q]=de}return n.makeTensorInfo(h.shape,h.dtype,h.values)}},of=hd(a.I,(function(e){return Math.cos(e)})),sf={kernelName:a.I,backendName:"cpu",kernelFunc:of},uf=hd(a.J,(function(e){return Math.cosh(e)})),cf={kernelName:a.J,backendName:"cpu",kernelFunc:uf};var lf={kernelName:a.K,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.backend,r=e.attrs,o=t.image,s=t.boxes,u=t.boxInd,c=r.cropSize,l=r.method,d=r.extrapolationValue,p=Object(i.a)(o.shape,4),f=p[0],h=p[1],m=p[2],v=p[3],b=s.shape[0],g=Object(i.a)(c,2),y=g[0],x=g[1],k=Object(a.Gd)([b,y,x,v],"float32"),w=n.data.get(s.dataId).values,O=n.data.get(u.dataId).values,I=n.data.get(o.dataId).values,S=a.Df.computeStrides(o.shape),N=a.Df.computeStrides(k.shape),j=0;j<b;j++){var T=4*j,C=w[T],E=w[T+1],_=w[T+2],A=w[T+3],R=O[j];if(!(R>=f))for(var D=y>1?(_-C)*(h-1)/(y-1):0,F=x>1?(A-E)*(m-1)/(x-1):0,M=0;M<y;M++){var z=y>1?C*(h-1)+M*D:.5*(C+_)*(h-1);if(z<0||z>h-1)for(var L=0;L<x;L++)for(var P=0;P<v;P++){var B=P+L*N[2]+M*N[1]+j*N[0];k.values[B]=d}else if("bilinear"===l)for(var W=Math.floor(z),U=Math.ceil(z),V=z-W,G=0;G<x;G++){var H=x>1?E*(m-1)+G*F:.5*(E+A)*(m-1);if(H<0||H>m-1)for(var q=0;q<v;q++){var K=q+G*N[2]+M*N[1]+j*N[0];k.values[K]=d}else for(var X=Math.floor(H),Y=Math.ceil(H),Z=H-X,J=0;J<v;J++){var Q=J+X*S[2]+W*S[1]+R*S[0],$=I[Q],ee=I[Q=J+Y*S[2]+W*S[1]+R*S[0]],te=I[Q=J+X*S[2]+U*S[1]+R*S[0]],ne=$+(ee-$)*Z,re=te+(I[Q=J+Y*S[2]+U*S[1]+R*S[0]]-te)*Z;Q=J+G*N[2]+M*N[1]+j*N[0],k.values[Q]=ne+(re-ne)*V}}else for(var ae=0;ae<x;++ae){var ie=x>1?E*(m-1)+ae*F:.5*(E+A)*(m-1);if(ie<0||ie>m-1)for(var oe=0;oe<v;oe++){var se=oe+ae*N[2]+M*N[1]+j*N[0];k.values[se]=d}else for(var ue=Math.round(ie),ce=Math.round(z),le=0;le<v;le++){var de=le+ue*S[2]+ce*S[1]+R*S[0],pe=le+ae*N[2]+M*N[1]+j*N[0];k.values[pe]=I[de]}}}}return n.makeTensorInfo(k.shape,k.dtype,k.values)}};var df={kernelName:a.L,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.x,o=r.axis,s=r.exclusive,u=r.reverse;dd(i,"cumprod");var c=a.zd.getAxesPermutation([o],i.shape.length),l=i;null!=c&&(l=up({inputs:{x:i},backend:n,attrs:{perm:c}}));var d=a.zd.getInnerMostAxes(1,i.shape.length)[0];if(d!==l.shape.length-1)throw new Error("backend.cumprod in CPU expects an inner-most "+"axis=".concat(l.shape.length-1," but got axis=").concat(d));for(var p=Object(a.Cf)(l.dtype,"int32"),f=a.Df.makeOnesTypedArray(a.Df.sizeFromShape(l.shape),p),h=n.data.get(l.dataId).values,m=l.shape[l.shape.length-1],v=u?function(e,t){return e+m-t-1}:function(e,t){return e+t},b=0;b<h.length;b+=m)for(var g=0;g<m;g++){var y=v(b,g);if(0===g)f[y]=s?1:h[y];else{var x=v(b,g-1);f[y]=s?h[x]*f[x]:h[y]*f[x]}}var k=n.makeTensorInfo(l.shape,p,f);if(null!=c){var w=up({inputs:{x:k},backend:n,attrs:{perm:a.zd.getUndoAxesPermutation(c)}});return n.disposeIntermediateTensorInfo(k),n.disposeIntermediateTensorInfo(l),w}return k}};var pf={kernelName:a.M,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.x,o=r.axis,s=r.exclusive,u=r.reverse;dd(i,"cumsum");var c=a.zd.getAxesPermutation([o],i.shape.length),l=i;null!=c&&(l=up({inputs:{x:i},backend:n,attrs:{perm:c}}));var d=a.zd.getInnerMostAxes(1,i.shape.length)[0];if(d!==l.shape.length-1)throw new Error("backend.cumsum in CPU expects an inner-most "+"axis=".concat(l.shape.length-1," but got axis=").concat(d));for(var p=Object(a.Cf)(l.dtype,"int32"),f=a.Df.makeZerosTypedArray(a.Df.sizeFromShape(l.shape),p),h=n.data.get(l.dataId).values,m=l.shape[l.shape.length-1],v=u?function(e,t){return e+m-t-1}:function(e,t){return e+t},b=0;b<h.length;b+=m)for(var g=0;g<m;g++){var y=v(b,g);if(0===g)f[y]=s?0:h[y];else{var x=v(b,g-1);f[y]=s?h[x]+f[x]:h[y]+f[x]}}var k=n.makeTensorInfo(l.shape,p,f);if(null!=c){var w=up({inputs:{x:k},backend:n,attrs:{perm:a.zd.getUndoAxesPermutation(c)}});return n.disposeIntermediateTensorInfo(k),n.disposeIntermediateTensorInfo(l),w}return k}};var ff={kernelName:a.O,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=r.binaryOutput;if(1===a.shape.length){var u=zp(n.data.get(a.dataId).values,n.data.get(i.dataId).values,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,u)}if(2===a.shape.length){var c=Lp(n.bufferSync(a),n.bufferSync(i),o,s);return n.makeTensorInfo(c.shape,i.dtype,c.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank"+"".concat(a.shape.length,"."))}};var hf={kernelName:a.P,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.x,o=r.blockSize,s=r.dataFormat;a.Df.assert("NHWC"===s,(function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got ".concat(s)}));for(var u=i.shape[0],c=i.shape[1],l=i.shape[2],d=i.shape[3],p=c*o,f=l*o,h=d/(o*o),m=n.data.get(i.dataId).values,v=new Float32Array(u*p*f*h),b=0,g=0;g<u;++g)for(var y=0;y<p;++y)for(var x=Math.floor(y/o),k=y%o,w=0;w<f;++w)for(var O=Math.floor(w/o),I=(k*o+w%o)*h,S=0;S<h;++S){var N=S+I+d*(O+l*(x+c*g));v[b++]=m[N]}return n.makeTensorInfo([u,p,f,h],i.dtype,v)}};function mf(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.x,o=t.filter,s=r.strides,u=r.pad,c=r.dilations,l=r.dimRoundingMode;dd([i,o],"depthwiseConv2DNative");var d=a.Df.computeStrides(i.shape),p=a.Df.computeStrides(o.shape),f=c;null==f&&(f=[1,1]),a.Df.assert(a.zd.eitherStridesOrDilationsAreOne(s,f),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(s," and dilations '").concat(f,"'")}));for(var h=a.zd.computeConv2DInfo(i.shape,o.shape,s,f,u,l,!0),m=h.filterHeight,v=h.filterWidth,b=h.dilationHeight,g=h.dilationWidth,y=h.padInfo,x=y.left,k=y.top,w=h.outChannels/h.inChannels,O=new a.hd(h.outShape,i.dtype),I=n.data.get(i.dataId).values,S=n.data.get(o.dataId).values,N=O.values,j=0;j<h.batchSize;++j)for(var T=j*d[0],C=j*O.strides[0],E=0;E<h.outHeight;++E)for(var _=C+E*O.strides[1],A=E*h.strideHeight-k,R=0;R<m;++R){var D=A+R*b;if(!(D<0||D>=h.inHeight))for(var F=R*p[0],M=T+D*d[1],z=0;z<h.outWidth;++z)for(var L=_+z*O.strides[2],P=z*h.strideWidth-x,B=0;B<v;++B){var W=P+B*g;if(!(W<0||W>=h.inWidth))for(var U=F+B*p[1],V=M+W*h.inChannels,G=L,H=U,q=0;q<h.inChannels;++q){for(var K=I[V+q],X=0;X<w;++X)N[G+X]+=K*S[H+X];G+=w,H+=w}}}return n.makeTensorInfo(O.shape,O.dtype,O.values)}var vf={kernelName:a.Q,backendName:"cpu",kernelFunc:mf};var bf={kernelName:a.R,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.x,o=t.dy,s=r.strides,u=r.dilations,c=r.pad,l=r.dimRoundingMode,d=r.filterShape;dd([i,o],"depthwiseConv2dNativeBackpropFilter");for(var p=a.zd.computeConv2DInfo(i.shape,d,s,u,c,l,!0),f=p.strideHeight,h=p.strideWidth,m=p.filterHeight,v=p.filterWidth,b=new a.hd(p.filterShape,"float32"),g=p.padInfo.left,y=p.padInfo.top,x=p.outChannels/p.inChannels,k=n.data.get(i.dataId).values,w=new a.hd(i.shape,i.dtype,k),O=n.data.get(o.dataId).values,I=new a.hd(o.shape,o.dtype,O),S=0;S<m;++S)for(var N=Math.max(0,Math.ceil((y-S)/f)),j=Math.min(p.outHeight,(p.inHeight+y-S)/f),T=0;T<v;++T)for(var C=Math.max(0,Math.ceil((g-T)/h)),E=Math.min(p.outWidth,(p.inWidth+g-T)/h),_=0;_<p.outChannels;++_){for(var A=Math.trunc(_/x),R=_%x,D=0,F=0;F<p.batchSize;++F)for(var M=N;M<j;++M)for(var z=S+M*f-y,L=C;L<E;++L){var P=T+L*h-g;D+=w.get(F,z,P,A)*I.get(F,M,L,_)}b.set(D,S,T,A,R)}return n.makeTensorInfo(b.shape,b.dtype,b.values)}};var gf={kernelName:a.S,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,o=t.dy,s=t.filter,u=r.strides,c=r.dilations,l=r.pad,d=r.dimRoundingMode,p=r.inputShape;dd([o,s],"depthwiseConv2DNativeBackpropInput");for(var f=a.Df.computeStrides(o.shape),h=a.Df.computeStrides(s.shape),m=a.zd.computeConv2DInfo(p,s.shape,u,c,l,d,!0),v=new a.hd(m.inShape,"float32"),b=v.values,g=Object(i.a)(v.strides,3),y=g[0],x=g[1],k=g[2],w=n.data.get(o.dataId).values,O=Object(i.a)(f,3),I=O[0],S=O[1],N=O[2],j=n.data.get(s.dataId).values,T=Object(i.a)(h,3),C=T[0],E=T[1],_=T[2],A=m.batchSize,R=m.filterHeight,D=m.filterWidth,F=m.inChannels,M=m.inHeight,z=m.inWidth,L=m.outChannels,P=m.outHeight,B=m.outWidth,W=m.strideHeight,U=m.strideWidth,V=R-1-m.padInfo.top,G=D-1-m.padInfo.left,H=L/F,q=0;q<A;++q)for(var K=0;K<F;++K)for(var X=0;X<M;++X)for(var Y=X-V,Z=Math.max(0,Math.ceil(Y/W)),J=Math.min(P,(R+Y)/W),Q=0;Q<z;++Q){for(var $=Q-G,ee=Math.max(0,Math.ceil($/U)),te=Math.min(B,(D+$)/U),ne=0,re=Z;re<J;++re)for(var ae=re*W-Y,ie=ee;ie<te;++ie)for(var oe=I*q+S*re+N*ie,se=C*(R-1-ae)+E*(D-1-(ie*U-$))+_*K,ue=0;ue<H;++ue){ne+=w[oe+(K*H+ue)]*j[se+ue]}b[y*q+x*X+k*Q+K]=ne}return n.makeTensorInfo(v.shape,v.dtype,v.values)}};var yf={kernelName:a.T,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.backend,r=t.x,i=a.Df.sizeFromShape(r.shape),o=n.data.get(r.dataId).values,s=Object(a.Gd)([i,i],r.dtype),u=s.values,c=0;c<o.length;c++)u[c*i+c]=o[c];var l=[].concat(Object(qn.a)(r.shape),Object(qn.a)(r.shape));return n.makeTensorInfo(l,s.dtype,s.values)}},xf={kernelName:a.U,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.backend,r=e.attrs,i=t.x,o=t.filter,s=r.strides,u=r.pad,c=r.dilations,l=n,d=l.data.get(i.dataId).values,p=i.shape.length,f=l.data.get(o.dataId).values,h=o.shape.length,m=a.zd.computeDilation2DInfo(i.shape,o.shape,s,u,"NHWC",c),v=m.batchSize,b=m.inHeight,g=m.inWidth,y=m.inChannels,x=m.outHeight,k=m.outWidth,w=m.padInfo,O=m.strideHeight,I=m.strideWidth,S=m.filterHeight,N=m.filterWidth,j=m.dilationHeight,T=m.dilationWidth,C=m.outShape,E=a.Df.sizeFromShape(C),_=C.length,A=a.Df.getArrayFromDType(i.dtype,E),R=0;R<v;++R)for(var D=0;D<x;++D)for(var F=D*O-w.top,M=0;M<k;++M)for(var z=M*I-w.left,L=0;L<y;++L){for(var P=Number.MIN_SAFE_INTEGER,B=0;B<S;++B){var W=F+B*j;if(W>=0&&W<b)for(var U=0;U<N;++U){var V=z+U*T;if(V>=0&&V<g){var G=a.Df.locToIndex([R,W,V,L],p,a.Df.computeStrides(i.shape)),H=a.Df.locToIndex([B,U,L],h,a.Df.computeStrides(o.shape)),q=d[G]+f[H];q>P&&(P=q)}}}A[a.Df.locToIndex([R,D,M,L],_,a.Df.computeStrides(C))]=P}return{dataId:l.write(a.Df.toTypedArray(A,i.dtype),C,i.dtype),shape:C,dtype:i.dtype}}},kf={kernelName:a.V,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.x,o=t.filter,s=t.dy,u=r.strides,c=r.pad,l=r.dilations,d=n,p=a.Df.toNestedArray(i.shape,d.data.get(i.dataId).values),f=a.Df.toNestedArray(o.shape,d.data.get(o.dataId).values),h=a.zd.computeDilation2DInfo(i.shape,o.shape,u,c,"NHWC",l),m=h.batchSize,v=h.inHeight,b=h.inWidth,g=h.inChannels,y=h.outHeight,x=h.outWidth,k=h.padInfo,w=h.strideHeight,O=h.strideWidth,I=h.filterHeight,S=h.filterWidth,N=h.dilationHeight,j=h.dilationWidth,T=h.outShape;a.Df.assert(s.rank===T.length,(function(){return"Error in ".concat(a.V,", dy ")+"must have the same rank as output ".concat(T.length,", but got ")+"".concat(s.rank)}));for(var C=a.Df.toNestedArray(T,d.data.get(s.dataId).values),E=a.Df.makeZerosNestedTypedArray(o.shape,o.dtype),_=0;_<m;++_)for(var A=0;A<y;++A)for(var R=A*w-k.top,D=0;D<x;++D)for(var F=D*O-k.left,M=0;M<g;++M){for(var z=Number.MIN_SAFE_INTEGER,L=0,P=0,B=0;B<I;++B){var W=R+B*N;if(W>=0&&W<v)for(var U=0;U<S;++U){var V=F+U*j;if(V>=0&&V<b){var G=p[_][W][V][M]+f[B][U][M];G>z&&(z=G,L=B,P=U)}}}E[L][P][M]+=C[_][A][D][M]}return{dataId:d.write(a.Df.toTypedArray(E,i.dtype),o.shape,o.dtype),shape:o.shape,dtype:o.dtype}}},wf={kernelName:a.W,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.x,o=t.filter,s=t.dy,u=r.strides,c=r.pad,l=r.dilations,d=n,p=a.Df.toNestedArray(i.shape,d.data.get(i.dataId).values),f=a.Df.toNestedArray(o.shape,d.data.get(o.dataId).values),h=a.zd.computeDilation2DInfo(i.shape,o.shape,u,c,"NHWC",l),m=h.batchSize,v=h.inHeight,b=h.inWidth,g=h.inChannels,y=h.outHeight,x=h.outWidth,k=h.padInfo,w=h.strideHeight,O=h.strideWidth,I=h.filterHeight,S=h.filterWidth,N=h.dilationHeight,j=h.dilationWidth,T=h.outShape;a.Df.assert(s.rank===T.length,(function(){return"Error in ".concat(a.W,", dy ")+"must have the same rank as output ".concat(T.length,", but got ")+"".concat(s.rank)}));for(var C=a.Df.toNestedArray(T,d.data.get(s.dataId).values),E=a.Df.makeZerosNestedTypedArray(i.shape,i.dtype),_=0;_<m;++_)for(var A=0;A<y;++A)for(var R=A*w-k.top,D=0;D<x;++D)for(var F=D*O-k.left,M=0;M<g;++M){for(var z=Number.MIN_SAFE_INTEGER,L=R<0?0:R,P=F<0?0:F,B=0;B<I;++B){var W=R+B*N;if(W>=0&&W<v)for(var U=0;U<S;++U){var V=F+U*j;if(V>=0&&V<b){var G=p[_][W][V][M]+f[B][U][M];G>z&&(z=G,L=W,P=V)}}}E[_][L][P][M]+=C[_][A][D][M]}return{dataId:d.write(a.Df.toTypedArray(E,i.dtype),i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}},Of=wd((function(e,t){return e*t})),If=Gd((function(e,t,n,r){return{real:e*n-t*r,imag:e*r+t*n}})),Sf=Vd(a.Xb,Of,If),Nf={kernelName:a.Xb,backendName:"cpu",kernelFunc:Sf};function jf(e){var t,n=e.inputs,r=e.backend,o=e.attrs,s=n.x,u=o.axis,c=o.keepDims;dd(s,"sum");var l=(t="bool"===s.dtype?Wd({inputs:{x:s},backend:r,attrs:{dtype:"int32"}}):gd({inputs:{x:s},backend:r})).shape.length,d=a.Df.parseAxisParam(u,t.shape),p=a.zd.getAxesPermutation(d,l),f=d,h=t;null!=p&&(h=up({inputs:{x:t},backend:r,attrs:{perm:p}}),f=a.zd.getInnerMostAxes(f.length,l)),a.zd.assertAxesAreInnerMostDims("sum",f,h.shape.length);for(var m=a.zd.computeOutAndReduceShapes(h.shape,f),v=Object(i.a)(m,2),b=v[0],g=v[1],y=zd(r,b,a.zd.upcastType(h.dtype,"int32")),x=a.Df.sizeFromShape(g),k=r.data.get(y.dataId).values,w=r.data.get(h.dataId).values,O=0;O<k.length;++O){for(var I=O*x,S=0,N=0;N<x;++N)S+=w[I+N];k[O]=S}if(c){var j=y;y=Yd({inputs:{x:y},backend:r,attrs:{shape:a.zd.expandShapeToKeepDim(y.shape,d)}}),r.disposeIntermediateTensorInfo(j)}return r.disposeIntermediateTensorInfo(t),null!=p&&r.disposeIntermediateTensorInfo(h),y}var Tf={kernelName:a.dd,backendName:"cpu",kernelFunc:jf};var Cf={kernelName:a.X,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.equation,i=t,o=a.zd.decodeEinsumEquation(r,i.length),s=o.allDims,u=o.summedDims,c=o.idDims;a.zd.checkEinsumDimSizes(s.length,c,i);for(var l=a.zd.getEinsumComputePath(u,c),d=l.path,p=l.steps,f=p.length,h=null,m=s.length,v=[],b=0;b<f;++b){var g,y=Object(Qr.a)(p[b]);try{for(y.s();!(g=y.n()).done;){var x=g.value,k=a.zd.getEinsumPermutation(m,c[x]),w=k.permutationIndices,O=k.expandDims,I=void 0;a.zd.isIdentityPermutation(w)?I=i[x]:(I=up({inputs:{x:i[x]},backend:n,attrs:{perm:w}}),v.push(I));for(var S=I.shape.slice(),N=0;N<O.length;++N)S.splice(O[N],0,1);a.Df.arraysEqual(I.shape,S)||(I=Yd({inputs:{x:I},backend:n,attrs:{shape:S}}),v.push(I)),null===h?h=I:(h=Sf({inputs:{a:I,b:h},backend:n}),v.push(h))}}catch(E){y.e(E)}finally{y.f()}b<f-1&&(d[b]>=0&&(h=jf({inputs:{x:h},backend:n,attrs:{axis:d[b]-(s.length-m),keepDims:!1}}),v.push(h)),m--)}for(var j=0,T=v;j<T.length;j++){var C=T[j];C!==h&&n.disposeIntermediateTensorInfo(C)}return h}};var Ef={kernelName:a.Z,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.dy,i=t.y;dd([r,i],"eluGrad");for(var o=new Float32Array(a.Df.sizeFromShape(i.shape)),s=n.data.get(i.dataId).values,u=n.data.get(r.dataId).values,c=0;c<s.length;++c){var l=s[c];o[c]=l>=1?u[c]:u[c]*(l+1)}return n.makeTensorInfo(i.shape,"float32",o)}},_f=wd((function(e,t){return e===t?1:0})),Af=Vd(a.ab,_f,null,"bool"),Rf={kernelName:a.ab,backendName:"cpu",kernelFunc:Af},Df=a.zd.ERF_P,Ff=a.zd.ERF_A1,Mf=a.zd.ERF_A2,zf=a.zd.ERF_A3,Lf=a.zd.ERF_A4,Pf=a.zd.ERF_A5,Bf=hd(a.bb,(function(e){var t=Math.sign(e),n=Math.abs(e),r=1/(1+Df*n);return t*(1-((((Pf*r+Lf)*r+zf)*r+Mf)*r+Ff)*r*Math.exp(-n*n))})),Wf={kernelName:a.bb,backendName:"cpu",kernelFunc:Bf},Uf=Ed((function(e){return Math.exp(e)})),Vf=md(a.cb,Uf,"float32"),Gf={kernelName:a.cb,backendName:"cpu",kernelFunc:Vf};function Hf(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.input,o=r.dim,s=i.shape.length,u=i.shape.slice(),c=o;return o<0&&(a.Df.assert(-(s+1)<=o,(function(){return"Axis must be in the interval [".concat(-(s+1),", ").concat(s,"]")})),c=s+o+1),u.splice(c,0,1),Yd({inputs:{x:i},backend:n,attrs:{shape:u}})}var qf={kernelName:a.db,backendName:"cpu",kernelFunc:Hf},Kf=Ed((function(e){return Math.expm1(e)})),Xf=md(a.eb,Kf),Yf={kernelName:a.eb,backendName:"cpu",kernelFunc:Xf},Zf=wd((function(e,t){return e/t})),Jf=Vd(a.pc,Zf),Qf={kernelName:a.pc,backendName:"cpu",kernelFunc:Jf},$f=wd((function(e,t){return e-t})),eh=Gd((function(e,t,n,r){return{real:e-n,imag:t-r}})),th=Vd(a.cd,$f,eh),nh={kernelName:a.cd,backendName:"cpu",kernelFunc:th};function rh(e,t,n){for(var r=e.shape,i=r[0],o=r[1],s=n.data.get(e.dataId),u=s.complexTensorInfos.real,c=s.complexTensorInfos.imag,l=[i,o],d=a.Df.sizeFromShape(l),p=a.Df.getTypedArrayFromDType("float32",d),f=a.Df.getTypedArrayFromDType("float32",d),h=0;h<i;h++){for(var m=Dp({inputs:{x:u},backend:n,attrs:{begin:[h,0],size:[1,o]}}),v=Dp({inputs:{x:c},backend:n,attrs:{begin:[h,0],size:[1,o]}}),b=Fd({inputs:{real:m,imag:v},backend:n}),g=ah(b,t,n),y=g.real,x=g.imag,k=a.zd.mergeRealAndImagArrays(y,x),w=0;w<o;w++){var O=a.zd.getComplexWithIndex(k,w);p[h*o+w]=O.real,f[h*o+w]=O.imag}n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(b)}var I=n.makeTensorInfo(l,"float32",p),S=n.makeTensorInfo(l,"float32",f),N=Fd({inputs:{real:I,imag:S},backend:n});return n.disposeIntermediateTensorInfo(I),n.disposeIntermediateTensorInfo(S),N}function ah(e,t,n){var r=a.Df.sizeFromShape(e.shape),i=n.data.get(e.dataId),o=n.data.get(i.complexTensorInfos.real.dataId).values,s=n.data.get(i.complexTensorInfos.imag.dataId).values;if(0===((g=r)&g-1)){var u=function e(t,n,r,i,o){if(1===r)return{real:t,imag:n};var s=a.zd.mergeRealAndImagArrays(t,n),u=r/2,c=a.zd.complexWithEvenIndex(s),l=c.real,d=c.imag,p=[l.length],f=o.makeTensorInfo(p,"float32",l),h=o.makeTensorInfo(p,"float32",d),m=Fd({inputs:{real:f,imag:h},backend:o}),v=a.zd.complexWithOddIndex(s),b=v.real,g=v.imag,y=[b.length],x=o.makeTensorInfo(y,"float32",b),k=o.makeTensorInfo(y,"float32",g),w=Fd({inputs:{real:x,imag:k},backend:o}),O=e(l,d,u,i,o),I=O.real,S=O.imag,N=[I.length],j=o.makeTensorInfo(N,"float32",I),T=o.makeTensorInfo(N,"float32",S),C=Fd({inputs:{real:j,imag:T},backend:o}),E=e(b,g,u,i,o),_=E.real,A=E.imag,R=[_.length],D=o.makeTensorInfo(R,"float32",_),F=o.makeTensorInfo(R,"float32",A),M=Fd({inputs:{real:D,imag:F},backend:o}),z=a.zd.exponents(r,i),L=[z.real.length],P=o.makeTensorInfo(L,"float32",z.real),B=o.makeTensorInfo(L,"float32",z.imag),W=Fd({inputs:{real:P,imag:B},backend:o}),U=Sf({inputs:{a:W,b:M},backend:o}),V=Kd({inputs:{a:C,b:U},backend:o}),G=th({inputs:{a:C,b:U},backend:o}),H=Ld({inputs:{input:V},backend:o}),q=Ld({inputs:{input:G},backend:o}),K=Xp({inputs:{input:V},backend:o}),X=Xp({inputs:{input:G},backend:o}),Y=Zp({inputs:[H,q],backend:o,attrs:{axis:0}}),Z=Zp({inputs:[K,X],backend:o,attrs:{axis:0}}),J=o.data.get(Y.dataId).values,Q=o.data.get(Z.dataId).values;return o.disposeIntermediateTensorInfo(f),o.disposeIntermediateTensorInfo(h),o.disposeIntermediateTensorInfo(m),o.disposeIntermediateTensorInfo(x),o.disposeIntermediateTensorInfo(k),o.disposeIntermediateTensorInfo(w),o.disposeIntermediateTensorInfo(j),o.disposeIntermediateTensorInfo(T),o.disposeIntermediateTensorInfo(C),o.disposeIntermediateTensorInfo(D),o.disposeIntermediateTensorInfo(F),o.disposeIntermediateTensorInfo(M),o.disposeIntermediateTensorInfo(P),o.disposeIntermediateTensorInfo(B),o.disposeIntermediateTensorInfo(W),o.disposeIntermediateTensorInfo(U),o.disposeIntermediateTensorInfo(V),o.disposeIntermediateTensorInfo(G),o.disposeIntermediateTensorInfo(H),o.disposeIntermediateTensorInfo(K),o.disposeIntermediateTensorInfo(q),o.disposeIntermediateTensorInfo(X),o.disposeIntermediateTensorInfo(Y),o.disposeIntermediateTensorInfo(Z),{real:J,imag:Q}}(o,s,r,t,n),c=[e.shape[0],e.shape[1]];if(t){var l=n.makeTensorInfo(c,"float32",u.real),d=n.makeTensorInfo(c,"float32",u.imag),p=n.makeTensorInfo([],"float32",a.Df.createScalarValue(r,"float32")),f=gd({inputs:{x:p},backend:n}),h=Qf.kernelFunc({inputs:{a:l,b:p},backend:n}),m=Qf.kernelFunc({inputs:{a:d,b:f},backend:n}),v=n.data.get(h.dataId).values,b=n.data.get(m.dataId).values;return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(m),{real:v,imag:b}}return u}var g,y=function(e,t,n){for(var r=new Float32Array(2*t),i=0;i<t;i++){for(var o=0,s=0,u=0;u<t;u++){var c=a.zd.exponent(i*u,t,n),l=a.zd.getComplexWithIndex(e,u);o+=l.real*c.real-l.imag*c.imag,s+=l.real*c.imag+l.imag*c.real}n&&(o/=t,s/=t),a.zd.assignToTypedArray(r,o,s,i)}return r}(a.zd.mergeRealAndImagArrays(o,s),r,t);return a.zd.splitRealAndImagArrays(y)}var ih={kernelName:a.fb,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.input,i=a.Df.sizeFromShape(r.shape),o=r.shape[r.shape.length-1],s=Yd({inputs:{x:r},backend:n,attrs:{shape:[i/o,o]}}),u=rh(s,!1,n),c=Yd({inputs:{x:u},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(u),c}};function oh(e){var t=e.backend,n=e.attrs,r=n.shape,i=n.value,o=n.dtype||a.Df.inferDtype(i),s=a.Df.getArrayFromDType(o,a.Df.sizeFromShape(r));return function(e,t,n){e.fill(t)}(s,i),t.makeTensorInfo(r,o,s)}var sh={kernelName:a.gb,backendName:"cpu",kernelFunc:oh};var uh={kernelName:a.hb,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=(e.attrs,e.backend),r=t.image,o=n,s=a.Df.getTypedArrayFromDType(r.dtype,a.Df.sizeFromShape(r.shape)),u=Object(i.a)(r.shape,4),c=u[0],l=u[1],d=u[2],p=u[3],f=o.data.get(r.dataId).values,h=0;h<c;h++)for(var m=h*d*l*p,v=0;v<l;v++)for(var b=v*(d*p),g=0;g<d;g++)for(var y=g*p,x=0;x<p;x++){var k=Math.round(d-g-1),w=m+b+y+x,O=f[w];if(k>=0&&k<d)O=f[m+b+k*p+x];s[w]=O}return{dataId:o.write(s,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},ch=Ed((function(e){return Math.floor(e)})),lh=md(a.ib,ch),dh={kernelName:a.ib,backendName:"cpu",kernelFunc:lh},ph=wd((function(e,t){return Math.floor(e/t)})),fh=Vd(a.jb,ph,null,"int32"),hh={kernelName:a.jb,backendName:"cpu",kernelFunc:fh};var mh={kernelName:a.mb,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.bias,s=t.preluActivationWeights,u=r.strides,c=r.pad,l=r.dataFormat,d=r.dilations,p=r.dimRoundingMode,f=r.activation,h=r.leakyreluAlpha,m=Qp({inputs:{x:a,filter:i},backend:n,attrs:{strides:u,pad:c,dataFormat:l,dilations:d,dimRoundingMode:p}});if(o){var v=m;if("NCHW"===l&&1===o.shape.length&&1!==o.shape[0]){var b=Yd({inputs:{x:o},backend:n,attrs:{shape:[o.shape[0],1,1]}});m=Kd({inputs:{a:m,b:b},backend:n}),n.disposeIntermediateTensorInfo(b)}else m=Kd({inputs:{a:m,b:o},backend:n});n.disposeIntermediateTensorInfo(v)}if(f){var g=m;if("NCHW"===l&&"prelu"===f&&1===s.shape.length&&1!==s.shape[0]){var y=Yd({inputs:{x:s},backend:n,attrs:{shape:[s.shape[0],1,1]}});m=Dd(n,m,f,y,h),n.disposeIntermediateTensorInfo(y)}else m=Dd(n,m,f,s,h);n.disposeIntermediateTensorInfo(g)}return m}};var vh={kernelName:a.nb,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.bias,s=t.preluActivationWeights,u=r.strides,c=r.pad,l=r.dataFormat,d=r.dilations,p=r.dimRoundingMode,f=r.activation,h=r.leakyreluAlpha,m=mf({inputs:{x:a,filter:i},backend:n,attrs:{strides:u,pad:c,dataFormat:l,dilations:d,dimRoundingMode:p}});if(o){var v=m;m=Kd({inputs:{a:m,b:o},backend:n}),n.disposeIntermediateTensorInfo(v)}if(f){var b=m;m=Dd(n,m,f,s,h),n.disposeIntermediateTensorInfo(b)}return m}};function bh(e,t,n,r,i,o,s,u,c){for(var l=Object(a.Gd)([r,o],n),d=0;d<r;d++){for(var p=[],f=0,h=0;h<i;h++){var m=e[d*i+h];f+=m*s[h],p.push(m)}if(f<0||f>=c/o)throw new Error("Invalid indices: ".concat(p," does not index into ").concat(u));for(var v=0;v<o;v++)l.values[d*o+v]=t.get.apply(t,Object(qn.a)(t.indexToLoc(f*o+v)))}return l}var gh={kernelName:a.ob,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.params,o=t.indices,s=a.Df.sizeFromShape(r.shape),u=o.shape,c=u[u.length-1],l=a.zd.prepareAndValidate(r,o),d=Object(i.a)(l,4),p=d[0],f=d[1],h=d[2],m=d[3];if(0===f)return n.makeTensorInfo(p,r.dtype,[]);var v=bh(n.data.get(o.dataId).values,n.bufferSync(r),r.dtype,f,c,h,m,r.shape,s);return n.makeTensorInfo(p,r.dtype,v.values)}};function yh(e,t,n){for(var r=Object(a.Gd)(n,e.dtype),i=0;i<r.size;++i){var o=r.indexToLoc(i).slice(),s=o[0],u=o[2],c=t.locToIndex([s,u]);o[2]=t.values[c];var l=e.locToIndex(o);0<=l&&l<e.values.length&&(r.values[i]=e.values[l])}return r}var xh={kernelName:a.pb,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.x,o=t.indices,s=r.axis,u=r.batchDims;dd([i,o],"gatherV2");for(var c=a.Df.parseAxisParam(s,i.shape)[0],l=n.data.get(o.dataId).values,d=i.shape[c],p=function(e){var t=l[e];a.Df.assert(t<=d-1&&t>=0,(function(){return"GatherV2: the index value ".concat(t," is not in [0, ").concat(d-1,"]")}))},f=0;f<l.length;++f)p(f);var h=u;null==u&&(h=0);var m=a.Df.sizeFromShape(o.shape),v=a.zd.segment_util.collectGatherOpShapeInfo(i,o,c,h),b=Yd({inputs:{x:i},backend:n,attrs:{shape:[v.batchSize,v.outerSize,v.dimSize,v.sliceSize]}}),g=Yd({inputs:{x:o},backend:n,attrs:{shape:[v.batchSize,m/v.batchSize]}}),y=[v.batchSize,v.outerSize,m/v.batchSize,v.sliceSize],x=n.bufferSync(g),k=yh(n.bufferSync(b),x,y);return n.disposeIntermediateTensorInfo(b),n.disposeIntermediateTensorInfo(g),n.makeTensorInfo(v.outputShape,k.dtype,k.values)}},kh=wd((function(e,t){return e>t?1:0})),wh=Vd(a.qb,kh,null,"bool"),Oh={kernelName:a.qb,backendName:"cpu",kernelFunc:wh},Ih=wd((function(e,t){return e>=t?1:0})),Sh=Vd(a.rb,Ih,null,"bool"),Nh={kernelName:a.rb,backendName:"cpu",kernelFunc:Sh};var jh={kernelName:a.sb,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.input,i=a.Df.sizeFromShape(r.shape),o=r.shape[r.shape.length-1],s=Yd({inputs:{x:r},backend:n,attrs:{shape:[i/o,o]}}),u=rh(s,!0,n),c=Yd({inputs:{x:u},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(u),c}},Th=hd(a.vb,(function(e){return Number.isFinite(e)?1:0}),"bool"),Ch={kernelName:a.vb,backendName:"cpu",kernelFunc:Th},Eh=hd(a.wb,(function(e){return Math.abs(e)===1/0?1:0}),"bool"),_h={kernelName:a.wb,backendName:"cpu",kernelFunc:Eh},Ah=hd(a.xb,(function(e){return Number.isNaN(e)?1:0}),"bool"),Rh={kernelName:a.xb,backendName:"cpu",kernelFunc:Ah},Dh=wd((function(e,t){return e<t?1:0})),Fh=Vd(a.Cb,Dh,null,"bool"),Mh={kernelName:a.Cb,backendName:"cpu",kernelFunc:Fh},zh=wd((function(e,t){return e<=t?1:0})),Lh=Vd(a.Db,zh,null,"bool"),Ph={kernelName:a.Db,backendName:"cpu",kernelFunc:Lh};function Bh(e,t,n){var r=(t-e)/(n-1),i=a.Df.makeZerosTypedArray(n,"float32");i[0]=e;for(var o=1;o<i.length;o++)i[o]=i[o-1]+r;return i}var Wh={kernelName:a.Eb,backendName:"cpu",kernelFunc:function(e){var t=e.backend,n=e.attrs,r=Bh(n.start,n.stop,n.num);return t.makeTensorInfo([r.length],"float32",r)}},Uh=Ed((function(e){return Math.log(e)})),Vh=md(a.Fb,Uh),Gh={kernelName:a.Fb,backendName:"cpu",kernelFunc:Vh},Hh=hd(a.Gb,(function(e){return Math.log1p(e)})),qh={kernelName:a.Gb,backendName:"cpu",kernelFunc:Hh},Kh=wd((function(e,t){return e&&t})),Xh=Vd(a.Hb,Kh,null,"bool"),Yh={kernelName:a.Hb,backendName:"cpu",kernelFunc:Xh},Zh=hd(a.Ib,(function(e){return e?0:1}),"bool"),Jh={kernelName:a.Ib,backendName:"cpu",kernelFunc:Zh},Qh=wd((function(e,t){return e||t})),$h=Vd(a.Jb,Qh,null,"bool"),em={kernelName:a.Jb,backendName:"cpu",kernelFunc:$h};var tm={kernelName:a.zb,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.x,o=r.depthRadius,s=r.bias,u=r.alpha,c=r.beta;dd(i,"LRN");var l=i.shape[3],d=l-1,p=n.data.get(i.dataId).values,f=a.Df.sizeFromShape(i.shape),h=new Float32Array(f);function m(e){for(var t=e%l,n=e-t+Math.max(0,t-o),r=e-t+Math.min(t+o,d),a=0;n<=r;n++){var i=p[n];a+=i*i}return a}for(var v=0;v<f;v++){var b=m(v),g=p[v]*Math.pow(s+u*b,-c);h[v]=g}return n.makeTensorInfo(i.shape,i.dtype,h)}};var nm={kernelName:a.Ab,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.x,o=t.y,s=t.dy,u=r.depthRadius,c=r.bias,l=r.alpha,d=r.beta;dd(s,"LRNGrad");for(var p=a.Df.sizeFromShape(s.shape),f=s.shape[3],h=n.data.get(s.dataId).values,m=n.data.get(i.dataId).values,v=n.data.get(o.dataId).values,b=new Float32Array(p),g=p,y=0;y<g;y++){for(var x=y%f,k=y-x+Math.max(0,x-u),w=y-x+Math.min(f,x+u+1),O=0,I=k;I<w;I++)O+=Math.pow(m[I],2);O=l*O+c;for(var S=k;S<w;S++){var N=-2*l*d*m[S]*v[y]/O;y===S&&(N+=Math.pow(O,-d)),N*=h[y],b[S]+=N}}return n.makeTensorInfo(s.shape,i.dtype,b)}};function rm(e,t,n,r){for(var i=a.Df.getTypedArrayFromDType(r,a.Df.sizeFromShape(n)),o=0;o<i.length;++o){for(var s=o*t,u=e[s],c=0;c<t;++c){var l=e[s+c];(Number.isNaN(l)||l>u)&&(u=l)}i[o]=u}return i}function am(e){var t=e.inputs,n=e.backend,r=e.attrs,o=t.x,s=r.reductionIndices,u=r.keepDims,c=n,l=o.shape,d=l.length,p=a.Df.parseAxisParam(s,l),f=p,h=a.zd.getAxesPermutation(f,d),m=c.data.get(o.dataId).values;if(null!=h){for(var v=new Array(d),b=0;b<v.length;b++)v[b]=l[h[b]];m=sp(m,l,o.dtype,h,v),f=a.zd.getInnerMostAxes(f.length,d),l=v}dd(o,"max"),a.zd.assertAxesAreInnerMostDims("max",f,d);var g=a.zd.computeOutAndReduceShapes(l,f),y=Object(i.a)(g,2),x=y[0],k=y[1],w=rm(m,a.Df.sizeFromShape(k),x,o.dtype),O=c.write(w,x,o.dtype),I=x;u&&(I=a.zd.expandShapeToKeepDim(x,p));return{dataId:O,shape:I,dtype:o.dtype}}var im={kernelName:a.Kb,backendName:"cpu",kernelFunc:am},om=wd((function(e,t){return Math.max(e,t)})),sm=Vd(a.Qb,om),um={kernelName:a.Qb,backendName:"cpu",kernelFunc:sm};var cm={kernelName:a.Lb,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.x;dd(i,"maxPool");var o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode;a.Df.assert(a.zd.eitherStridesOrDilationsAreOne(s,1),(function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(s," and dilations '").concat(1,"'")}));var l,d=a.zd.computePool2DInfo(i.shape,o,s,1,u,c);if(1===d.filterWidth&&1===d.filterHeight&&a.Df.arraysEqual(d.inShape,d.outShape))l=gd({inputs:{x:i},backend:n});else{var p=n.data.get(i.dataId).values,f=a.Df.computeStrides(i.shape),h=Sp(p,i.shape,i.dtype,f,d,"max");l=n.makeTensorInfo(d.outShape,i.dtype,h.values)}return l}};var lm={kernelName:a.Mb,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.x,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode,l=r.dataFormat;dd(i,"maxPool3d");var d=a.zd.computePool3DInfo(i.shape,o,s,1,u,c,l),p=jp(n.data.get(i.dataId).values,i.shape,i.dtype,a.Df.computeStrides(i.shape),d,"max");return n.makeTensorInfo(p.shape,"float32",p.values)}};var dm={kernelName:a.Nb,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.dy,o=t.input,s=r.filterSize,u=r.strides,c=r.pad,l=r.dimRoundingMode;dd([i,o],"maxPool3DGrad");for(var d=a.zd.computePool3DInfo(o.shape,s,u,1,c,l),p=function(e,t){for(var n=Object(a.Gd)(t.outShape,"int32"),r=t.strideDepth,i=t.strideHeight,o=t.strideWidth,s=t.dilationDepth,u=t.dilationHeight,c=t.dilationWidth,l=t.effectiveFilterDepth,d=t.effectiveFilterHeight,p=t.effectiveFilterWidth,f=t.padInfo.front,h=t.padInfo.top,m=t.padInfo.left,v=0;v<t.batchSize;++v)for(var b=0;b<t.inChannels;++b)for(var g=0;g<t.outDepth;++g){for(var y=g*r-f,x=y;x<0;)x+=s;for(var k=Math.min(t.inDepth,l+y),w=0;w<t.outHeight;++w){for(var O=w*i-h,I=O;I<0;)I+=u;for(var S=Math.min(t.inHeight,d+O),N=0;N<t.outWidth;++N){for(var j=N*o-m,T=j;T<0;)T+=c;for(var C=Math.min(t.inWidth,p+j),E=Number.NEGATIVE_INFINITY,_=-1,A=x;A<k;A+=s)for(var R=A-y,D=I;D<S;D+=u)for(var F=D-O,M=T;M<C;M+=c){var z=M-j,L=e.get(v,A,D,M,b);L>=E&&(E=L,_=R*d*p+F*d+z)}n.set(_,v,g,w,N,b)}}}return n}(n.bufferSync(o),d),f=d.strideDepth,h=d.strideHeight,m=d.strideWidth,v=d.dilationDepth,b=d.dilationHeight,g=d.dilationWidth,y=d.effectiveFilterDepth,x=d.effectiveFilterHeight,k=d.effectiveFilterWidth,w=y-1-d.padInfo.front,O=k-1-d.padInfo.left,I=x-1-d.padInfo.top,S=Object(a.Gd)(o.shape,"float32"),N=n.bufferSync(i),j=0;j<d.batchSize;++j)for(var T=0;T<d.inChannels;++T)for(var C=0;C<d.inDepth;++C)for(var E=0;E<d.inHeight;++E)for(var _=0;_<d.inWidth;++_){for(var A=C-w,R=E-I,D=_-O,F=0,M=0;M<y;M+=v){var z=(A+M)/f;if(!(z<0||z>=d.outDepth||Math.floor(z)!==z))for(var L=0;L<x;L+=b){var P=(R+L)/h;if(!(P<0||P>=d.outHeight||Math.floor(P)!==P))for(var B=0;B<k;B+=g){var W=(D+B)/m;if(!(W<0||W>=d.outWidth||Math.floor(W)!==W)){var U=y*x*k-1-p.get(j,z,P,W,T)===M*x*k+L*k+B?1:0;if(0!==U)F+=N.get(j,z,P,W,T)*U}}}}S.set(F,j,C,E,_,T)}return n.makeTensorInfo(S.shape,S.dtype,S.values)}};var pm={kernelName:a.Ob,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.dy,o=t.input,s=o;dd([o,t.output],"maxPoolGrad");for(var u=r.filterSize,c=r.strides,l=r.pad,d=r.dimRoundingMode,p=a.zd.computePool2DInfo(s.shape,u,c,1,l,d),f=n.data.get(s.dataId).values,h=Object(a.Gd)(p.outShape,s.dtype,Np(f,s.shape,s.dtype,p).values),m=p.strideHeight,v=p.strideWidth,b=p.dilationHeight,g=p.dilationWidth,y=p.effectiveFilterHeight,x=p.effectiveFilterWidth,k=x-1-p.padInfo.left,w=y-1-p.padInfo.top,O=Object(a.Gd)(s.shape,"float32"),I=n.data.get(i.dataId).values,S=Object(a.Gd)(i.shape,"float32",I),N=0;N<p.batchSize;++N)for(var j=0;j<p.inChannels;++j)for(var T=0;T<p.inHeight;++T)for(var C=0;C<p.inWidth;++C){for(var E=T-w,_=C-k,A=0,R=0;R<y;R+=b){var D=(E+R)/m;if(!(D<0||D>=p.outHeight||Math.floor(D)!==D))for(var F=0;F<x;F+=g){var M=(_+F)/v;if(!(M<0||M>=p.outWidth||Math.floor(M)!==M)){var z=y*x-1-h.get(N,D,M,j)===R*x+F?1:0;if(0!==z)A+=S.get(N,D,M,j)*z}}}O.set(A,N,T,C,j)}return n.makeTensorInfo(O.shape,O.dtype,O.values)}};var fm={kernelName:a.Pb,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,o=t.x,s=n.filterSize,u=n.strides,c=n.pad,l=n.includeBatchInIndex,d=r;dd(o,"MaxPoolWithArgmax");var p=d.data.get(o.dataId).values,f=a.zd.computePool2DInfo(o.shape,s,u,[1,1],c),h=function(e,t,n,r,i){var o=Sp(e,0,n,a.Df.computeStrides(t),i,"max"),s=Np(e,t,n,i,!0,r);return[o.values,s.values]}(p,o.shape,o.dtype,l,f),m=Object(i.a)(h,2),v=m[0],b=m[1],g=d.write(v,f.outShape,o.dtype),y=d.write(b,f.outShape,o.dtype);return[{dataId:g,shape:f.outShape,dtype:o.dtype},{dataId:y,shape:f.outShape,dtype:"int32"}]}};var hm={kernelName:a.Rb,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.x,o=r.axis,s=r.keepDims,u=a.Df.parseAxisParam(o,i.shape),c=a.zd.computeOutAndReduceShapes(i.shape,u)[1],l=a.Df.sizeFromShape(c),d=[],p=n.makeTensorInfo([],"float32",new Float32Array([l]));d.push(p);var f=Wd({inputs:{x:i},backend:n,attrs:{dtype:"float32"}});d.push(f);var h=Jf({inputs:{a:f,b:p},backend:n});d.push(h);var m=jf({inputs:{x:h},backend:n,attrs:{axis:o,keepDims:s}});return d.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),m}};var mm={kernelName:a.Sb,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,o=t.x,s=r.axis,u=r.keepDims;dd(o,"min");var c=a.Df.parseAxisParam(s,o.shape),l=c,d=a.zd.getAxesPermutation(l,o.shape.length),p=o;null!=d&&(p=up({inputs:{x:o},backend:n,attrs:{perm:d}}),l=a.zd.getInnerMostAxes(l.length,o.shape.length)),a.zd.assertAxesAreInnerMostDims("min",l,p.shape.length);for(var f=a.zd.computeOutAndReduceShapes(p.shape,l),h=Object(i.a)(f,2),m=h[0],v=h[1],b=a.Df.sizeFromShape(v),g=a.Df.makeZerosTypedArray(a.Df.sizeFromShape(m),p.dtype),y=n.data.get(p.dataId).values,x=0;x<g.length;++x){for(var k=x*b,w=y[k],O=0;O<b;++O){var I=y[k+O];(Number.isNaN(I)||I<w)&&(w=I)}g[x]=w}null!=d&&n.disposeIntermediateTensorInfo(p);var S=n.makeTensorInfo(m,p.dtype,g);if(u){var N=Yd({inputs:{x:S},backend:n,attrs:{shape:a.zd.expandShapeToKeepDim(m,c)}});return n.disposeIntermediateTensorInfo(S),N}return S}},vm=wd((function(e,t){return Math.min(e,t)})),bm=Vd(a.Tb,vm),gm={kernelName:a.Tb,backendName:"cpu",kernelFunc:bm};var ym={kernelName:a.Ub,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.x,o=r.paddings,s=r.mode;dd(i,"mirrorPad");for(var u=o.map((function(e,t){return e[0]+i.shape[t]+e[1]})),c=o.map((function(e){return e[0]})),l=o.map((function(e,t){return e[0]+i.shape[t]})),d="reflect"===s?0:1,p=n.data.get(i.dataId).values,f=i.shape.length,h=a.Df.computeStrides(i.shape),m=a.Df.sizeFromShape(u),v=u.length,b=a.Df.computeStrides(u),g=a.Df.getTypedArrayFromDType(i.dtype,m),y=0;y<m;y++){for(var x=a.Df.indexToLoc(y,v,b),k=0;k<v;k++)x[k]<c[k]?x[k]=2*c[k]-x[k]-d:x[k]>=l[k]&&(x[k]=2*(l[k]-1)-x[k]+d);x=x.map((function(e,t){return e-c[t]}));var w=a.Df.locToIndex(x,f,h);g[y]=p[w]}return{dataId:n.write(g,u,i.dtype),shape:u,dtype:i.dtype}}},xm=wd((function(e,t){var n=e%t;return e<0&&t<0||e>=0&&t>=0?n:(n+t)%t})),km=Vd(a.Vb,xm),wm={kernelName:a.Vb,backendName:"cpu",kernelFunc:km},Om=n(251);function Im(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.logits,o=r.dim,s=i.shape.length,u=o;if(-1===u&&(u=s-1),u!==s-1)throw Error("Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(s," and dim was ").concat(u));var c=a.Df.parseAxisParam([u],i.shape),l=am({inputs:{x:i},backend:n,attrs:{reductionIndices:c,keepDims:!1}}),d=a.zd.expandShapeToKeepDim(l.shape,c),p=Yd({inputs:{x:l},backend:n,attrs:{shape:d}}),f=th({inputs:{a:i,b:p},backend:n}),h=Vf({inputs:{x:f},backend:n}),m=jf({inputs:{x:h},backend:n,attrs:{axis:c,keepDims:!1}}),v=Yd({inputs:{x:m},backend:n,attrs:{shape:d}}),b=Jf({inputs:{a:h,b:v},backend:n});return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(v),b}var Sm={kernelName:a.Lc,backendName:"cpu",kernelFunc:Im};var Nm={kernelName:a.Wb,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.logits,o=r.numSamples,s=r.seed,u=r.normalized;dd(i,"multinomial");for(var c=u?i:Im({inputs:{logits:i},backend:n,attrs:{dim:-1}}),l=c.shape[0],d=c.shape[1],p=n.data.get(c.dataId).values,f=[l,o],h=a.Df.makeZerosTypedArray(a.Df.sizeFromShape(f),"int32"),m=0;m<l;++m){var v=m*d,b=new Float32Array(d-1);b[0]=p[v];for(var g=1;g<b.length;++g)b[g]=b[g-1]+p[v+g];for(var y=Om.alea(s.toString()),x=m*o,k=0;k<o;++k){var w=y();h[x+k]=b.length;for(var O=0;O<b.length;O++)if(w<b[O]){h[x+k]=O;break}}}return u||n.disposeIntermediateTensorInfo(c),n.makeTensorInfo(f,"int32",h)}};function jm(e,t,n){var r=a.Df.createScalarValue(-1,n);return Of([],t,r,e,n)}var Tm={kernelName:a.Yb,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x;dd(r,"neg");var a=jm(n.data.get(r.dataId).values,r.shape,r.dtype),o=Object(i.a)(a,2),s=o[0],u=o[1];return n.makeTensorInfo(u,r.dtype,s)}},Cm=a.pe.nonMaxSuppressionV3Impl;var Em={kernelName:a.Zb,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold;dd(a,"NonMaxSuppression");var c=n.data.get(a.dataId).values,l=n.data.get(i.dataId).values,d=Cm(c,l,o,s,u).selectedIndices;return n.makeTensorInfo([d.length],"int32",new Int32Array(d))}},_m=a.pe.nonMaxSuppressionV4Impl;var Am={kernelName:a.ac,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.padToMaxOutputSize;dd(a,"NonMaxSuppressionPadded");var l=n.data.get(a.dataId).values,d=n.data.get(i.dataId).values,p=_m(l,d,o,s,u,c),f=p.selectedIndices,h=p.validOutputs;return[n.makeTensorInfo([f.length],"int32",new Int32Array(f)),n.makeTensorInfo([],"int32",new Int32Array([h]))]}},Rm=a.pe.nonMaxSuppressionV5Impl;var Dm={kernelName:a.bc,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.softNmsSigma;dd(a,"NonMaxSuppressionWithScore");var l=n.data.get(a.dataId).values,d=n.data.get(i.dataId).values,p=Rm(l,d,o,s,u,c),f=p.selectedIndices,h=p.selectedScores;return[n.makeTensorInfo([f.length],"int32",new Int32Array(f)),n.makeTensorInfo([h.length],"float32",new Float32Array(h))]}},Fm=wd((function(e,t){return e!==t?1:0})),Mm=Vd(a.cc,Fm,null,"bool"),zm={kernelName:a.cc,backendName:"cpu",kernelFunc:Mm};var Lm={kernelName:a.dc,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.indices,o=r.dtype,s=r.depth,u=r.onValue,c=r.offValue;dd(i,"oneHot");var l=a.Df.sizeFromShape(i.shape),d=new Float32Array(l*s);d.fill(c);for(var p=n.data.get(i.dataId).values,f=0;f<l;++f)p[f]>=0&&p[f]<s&&(d[f*s+p[f]]=u);return n.makeTensorInfo([].concat(Object(qn.a)(i.shape),[s]),o,d)}};function Pm(e){var t=e.inputs,n=e.backend,r=t.x;if("string"===r.dtype)throw new Error("zerosLike is not supported for string tensors");if("complex64"===r.dtype){var a=Ld({inputs:{input:r},backend:n}),i=Pm({inputs:{x:a},backend:n}),o=Xp({inputs:{input:r},backend:n}),s=Pm({inputs:{x:o},backend:n}),u=Fd({inputs:{real:i,imag:s},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}return oh({backend:n,attrs:{shape:r.shape,value:0,dtype:r.dtype}})}var Bm={kernelName:a.pd,backendName:"cpu",kernelFunc:Pm};var Wm={kernelName:a.ec,backendName:"cpu",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=n.x;if("string"===a.dtype)throw new Error("onesLike is not supported for string tensors");if("complex64"===a.dtype){var i=Ld({inputs:{input:a},backend:r}),o=e({inputs:{x:i},backend:r}),s=Xp({inputs:{input:a},backend:r}),u=Pm({inputs:{x:s},backend:r}),c=Fd({inputs:{real:o,imag:u},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(u),c}return oh({backend:r,attrs:{shape:a.shape,value:1,dtype:a.dtype}})}};function Um(e){var t=e.inputs,n=e.backend,r=e.attrs.axis;if(1===t.length)return Hf({inputs:{input:t[0]},backend:n,attrs:{dim:r}});var i=t[0].shape,o=t[0].dtype;t.forEach((function(e){a.Df.assertShapesMatch(i,e.shape,"All tensors passed to stack must have matching shapes"),a.Df.assert(o===e.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var s=[],u=Zp({inputs:t.map((function(e){var t=Hf({inputs:{input:e},backend:n,attrs:{dim:r}});return s.push(t),t})),backend:n,attrs:{axis:r}});return s.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),u}var Vm={kernelName:a.gc,backendName:"cpu",kernelFunc:Um};var Gm={kernelName:a.hc,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.x,o=r.paddings,s=r.constantValue;dd(i,"pad");var u=o.map((function(e,t){return e[0]+i.shape[t]+e[1]})),c=o.map((function(e){return e[0]})),l=n.data.get(i.dataId).values,d=a.Df.sizeFromShape(i.shape),p=i.shape.length,f=a.Df.computeStrides(i.shape),h=a.Df.sizeFromShape(u),m=u.length,v=a.Df.computeStrides(u),b=a.Df.getTypedArrayFromDType(i.dtype,h);0!==s&&b.fill(s);for(var g=0;g<d;g++){var y=a.Df.indexToLoc(g,p,f).map((function(e,t){return e+c[t]}));b[a.Df.locToIndex(y,m,v)]=l[g]}return{dataId:n.write(b,u,i.dtype),shape:u,dtype:i.dtype}}},Hm=wd((function(e,t){return Math.pow(e,t)})),qm=Vd(a.ic,Hm),Km={kernelName:a.ic,backendName:"cpu",kernelFunc:qm};function Xm(e,t,n,r){for(var o=a.zd.computeOutAndReduceShapes(e,r),s=Object(i.a)(o,2),u=s[0],c=s[1],l=Object(a.Cf)(t,"int32"),d=a.Df.makeZerosTypedArray(a.Df.sizeFromShape(u),l),p=a.Df.sizeFromShape(c),f=0;f<d.length;++f){for(var h=f*p,m=1,v=0;v<p;++v)m*=n[h+v];d[f]=m}return{outVals:d,outShape:u,outDtype:l}}var Ym={kernelName:a.kc,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.x,o=r.axis,s=r.keepDims;dd(i,"prod");var u=i.shape.length,c=a.Df.parseAxisParam(o,i.shape),l=a.zd.getAxesPermutation(c,u),d=c,p=i,f=[];null!=l&&(p=up({inputs:{x:i},backend:n,attrs:{perm:l}}),f.push(p),d=a.zd.getInnerMostAxes(d.length,u));var h=n.data.get(p.dataId).values,m=Xm(p.shape,p.dtype,h,d),v=m.outVals,b=m.outShape,g=m.outDtype,y=b;return s&&(y=a.zd.expandShapeToKeepDim(b,c)),f.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(y,g,v)}};function Zm(e,t,n,r){var a=[],i=0,o=t.length-1+n.length,s=new Array(o).fill(null).map((function(){return[0]}));!function(e,t){for(var n=0;n<e.length;++n){var r=e[n],a=n===e.length-1?t:e[n+1].length;if(0===r.length)throw new Error("Ragged splits may not be empty");if(r[0]<0)throw new Error("Ragged splits must be non-negative");if(r[r.length-1]>a)throw new Error("Ragged splits must not point past values");for(var i=1;i<r.length;++i)if(r[i-1]>r[i])throw new Error("Ragged splits must be sorted in ascending order")}}(n,r);for(var u=1,c=0;c<t.length-1;++c){u*=t[c];for(var l=t[c+1],d=1;d<u+1;++d)s[c].push(d*l)}for(var p=0;p<e.length;++p){for(var f=e[p],h=e[p]+1,m=0;m<n.length;++m){var v=n[m],b=m+t.length-1;if(b>=0)for(var g=s[b],y=g[g.length-1]-v[f],x=f;x<h;++x)s[b].push(v[x+1]+y);f=v[f],h=v[h]}h!==f&&(a.push([f,h]),i+=h-f)}return{outSplits:s,valueSlices:a,numValues:i}}function Jm(e,t){for(var n=e.slice(0,t);n.length<t;)n.push(1);for(var r=t;r<e.length;r++)n[t-1]*=e[r];return n}function Qm(e,t,n,r,i){var o=t.slice();o[0]=i;var s=a.Df.getArrayFromDType(n,a.Df.sizeFromShape(o)),u=e.length;return function(e,t,n,r,a,i){var o,s=Jm(t,2)[1],u=Jm(i,2)[1],c=0,l=Object(Qr.a)(n);try{for(l.s();!(o=l.n()).done;)for(var d=o.value,p=d[0];p<d[1];++p){for(var f=0;f<r;++f)a[c*u+f]=e[p*s+f];++c}}catch(h){l.e(h)}finally{l.f()}}(e,t,r,0===u?0:u/t[0],s,o),[s,o]}function $m(e,t,n,r,i,o,s,u){if(0===e.length)throw new Error("paramsNestedSplits must be non empty");if(0===t[0].length)throw new Error("Split tensors must not be scalars");if(function(e,t,n){e.forEach((function(e,r){if(e<0||e>=n){var i=a.Df.indexToLoc(r,t.length,a.Df.computeStrides(t)).join(",");throw new Error("indices[".concat(i,"] = ").concat(e," is not in [0, ").concat(n,")"))}}))}(o,s,t[0][0]-1),0===r.length)throw new Error("params.rank must be nonzero");var c=Zm(o,s,e,r[0]),l=c.outSplits,d=c.valueSlices,p=c.numValues,f=function(e){for(var t=[],n=function(n){var r=e[n].length,i=a.Df.getArrayFromDType("int32",r);t.push(i),e[n].forEach((function(e,t){return i[t]=e}))},r=0;r<e.length;++r)n(r);return t}(l),h=Qm(n,r,i,d,p);return[f,h[0],h[1]]}var ev={kernelName:a.lc,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.paramsNestedSplits,o=t.paramsDenseValues,s=t.indices,u=(r.outputRaggedRank,a.map((function(e){return n.data.get(e.dataId).values}))),c=a.map((function(e){return e.shape})),l=n.data.get(o.dataId).values,d=n.data.get(s.dataId).values,p=$m(u,c,l,o.shape,o.dtype,d,s.shape),f=Object(i.a)(p,3),h=f[0],m=f[1],v=f[2],b=h.map((function(e){return n.makeTensorInfo([e.length],"int32",e)})),g=n.makeTensorInfo(v,o.dtype,m);return b.concat([g])}},tv=a.zd.RowPartitionType,nv=function(){function e(t,n,r,i,o,s,u,c,l,d){Object($r.a)(this,e),this.shape=t,this.shapeShape=n,this.values=r,this.valuesShape=i,this.valuesDType=o,this.defaultValue=s,this.defaultValueShape=u,this.rowPartitionValues=c,this.rowPartitionValuesShapes=l,this.rowPartitionTypes=a.zd.getRowPartitionTypesHelper(d),this.raggedRank=a.zd.getRaggedRank(this.rowPartitionTypes)}return Object(ea.a)(e,[{key:"getRowPartitionTypeByDimension",value:function(e){return this.rowPartitionTypes[0]===tv.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}},{key:"getRowPartitionTensor",value:function(e){return this.rowPartitionTypes[0]===tv.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}},{key:"getMaxWidth",value:function(t){var n=this.getRowPartitionTensor(t-1);switch(this.getRowPartitionTypeByDimension(t-1)){case tv.VALUE_ROWIDS:return e.getMaxWidthValueRowID(n);case tv.ROW_SPLITS:return e.getMaxWidthRowSplit(n);default:throw new Error("Cannot handle partition type ".concat(tv[this.getRowPartitionTypeByDimension(t-1)]))}}},{key:"tensorShapeFromTensor",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(0===t.length){if(-1===e[0])return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return av(e,n)}},{key:"calculateOutputSize",value:function(e){var t=this.valuesShape,n=this.defaultValueShape;a.zd.validateDefaultValueShape(n,t);var r=this.tensorShapeFromTensor(this.shape,this.shapeShape),i=a.zd.combineRaggedTensorToTensorShapes(this.raggedRank,r,t);i[0]<0&&(i[0]=e);for(var o=1;o<=this.raggedRank;++o)i[o]<0&&(i[o]=this.getMaxWidth(o));return i}},{key:"calculateFirstParentOutputIndex",value:function(e,t,n){for(var r=Math.min(e,n),i=[],o=0,s=0;s<r;++s,o+=t)i.push(o);for(var u=r;u<e;++u)i.push(-1);return a.Df.assert(i.length===e,(function(){return"Final length of result must be equal to firstDimension."})),i}},{key:"calculateOutputIndexRowSplit",value:function(e,t,n,r){for(var a=e.length,i=[],o=0;o<a-1;++o){var s=e[o+1]-e[o],u=Math.min(r,s),c=t[o];-1===c&&(u=0);for(var l=0;l<u;++l)i.push(c),c+=n;for(var d=0;d<s-u;++d)i.push(-1)}if(a>0&&i.length!==e[a-1])throw new Error("Invalid row split size.");return i}},{key:"calculateOutputIndexValueRowID",value:function(e,t,n,r){var a=e.length,i=[];if(0===a)return[];var o=0,s=e[0];if(s>=t.length)throw new Error("Got currentValueRowId=".concat(s,", which is not less than ").concat(t.length));var u=t[s];i.push(u);for(var c=1;c<a;++c){var l=e[c];if(l===s)u>=0&&(++o<r?u+=n:u=-1);else{if(o=0,s=l,l>=t.length)throw new Error("Got nextValueRowId=".concat(l," which is not less than ").concat(t.length));u=t[l]}i.push(u)}if(i.length!==e.length)throw new Error("Invalid row ids.");return i}},{key:"calculateOutputIndex",value:function(e,t,n,r){var a=this.getRowPartitionTensor(e),i=this.getRowPartitionTypeByDimension(e);switch(i){case tv.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(a,t,n,r);case tv.ROW_SPLITS:if(a.length-1>t.length)throw new Error("Row partition size is greater than output size: ".concat(a.length-1," > ").concat(t.length));return this.calculateOutputIndexRowSplit(a,t,n,r);default:throw new Error("Unsupported partition type: ".concat(tv[i]))}}},{key:"getFirstDimensionSize",value:function(){var e=this.rowPartitionValues[0];if(0===this.rowPartitionTypes.length)throw new Error("No row_partition_types given.");var t=this.rowPartitionTypes[0];switch(t){case tv.FIRST_DIM_SIZE:return e[0];case tv.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case tv.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error("Cannot handle type ".concat(tv[t]))}}},{key:"compute",value:function(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");var e=this.getFirstDimensionSize(),t=this.calculateOutputSize(e),n=new Array(this.raggedRank+1);n[n.length-1]=1;for(var r=n.length-2;r>=0;--r)n[r]=n[r+1]*t[r+1];var i=av(t,!1),o=a.Df.getArrayFromDType(this.valuesDType,a.Df.sizeFromShape(i));if(n[0]*t[0]>0){for(var s=this.calculateFirstParentOutputIndex(e,n[0],t[0]),u=1;u<=this.raggedRank;++u){s=this.calculateOutputIndex(u-1,s,n[u],t[u])}this.setOutput(this.raggedRank,s,o,i)}return[i,o]}},{key:"setOutput",value:function(e,t,n,r){if(0!==n.length){var i=this.values,o=n,s=r.slice();s=s.slice(e+1);var u=a.Df.sizeFromShape(s),c=t.length,l=this.defaultValue;if(l.length!==u&&1!==l.length){var d=this.defaultValueShape;Object(a.wf)((function(){var e=Object(a.Ue)(l,d),t=Object(a.Dd)(e,s);l=t.dataSync()}))}for(var p=0,f=0,h=0,m=0;m<=c;++m){var v=m<c?t[m]:-1;if(v!==h){if(f<h){var b=i.subarray(p*u);rv(o.subarray(f*u),b,(h-f)*u)}if(m>=c){var g=n.length;v=Math.floor(g/u)}if(v>h)if(1===this.defaultValue.length)o.subarray(h*u,v*u).fill(this.defaultValue[0]),h=v;else for(;v>h;){rv(o.slice(h*u),l,u),++h}v<0?(p=m+1,f=h):(p=m,h=(f=h)+1)}else++h}}}}],[{key:"getMaxWidthRowSplit",value:function(e){var t=e.length;if(0===t||1===t)return 0;for(var n=0,r=0;r<t-1;++r){var a=e[r+1]-e[r];a>n&&(n=a)}return n}},{key:"getMaxWidthValueRowID",value:function(e){var t=e.length;if(0===t)return 0;for(var n=0,r=e[0],a=0,i=1;i<t;++i){var o=e[i];o!==r&&(r=o,a=Math.max(i-n,a),n=i)}return Math.max(t-n,a)}}]),e}();function rv(e,t,n){for(var r=0;r<n;r++)e[r]=t[r]}function av(e,t){var n,r=[],a=Object(Qr.a)(e);try{for(a.s();!(n=a.n()).done;){var i=n.value;if(i<0){if(!t)throw new Error("Dimension ".concat(i," must be >= 0"));if(i<-1)throw new Error("Dimension ".concat(i," must be >= -1"));i=-1}r.push(i)}}catch(o){a.e(o)}finally{a.f()}return r}function iv(e,t,n,r,a,i,o,s,u,c){return new nv(e,t,n,r,a,i,o,s,u,c).compute()}var ov={kernelName:a.mc,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.shape,o=t.values,s=t.defaultValue,u=t.rowPartitionTensors,c=r.rowPartitionTypes,l=n.data.get(a.dataId).values,d=n.data.get(o.dataId).values,p=n.data.get(s.dataId).values,f=u.map((function(e){return n.data.get(e.dataId).values})),h=u.map((function(e){return e.shape})),m=iv(l,a.shape,d,o.shape,o.dtype,p,s.shape,f,h,c),v=Object(i.a)(m,2),b=v[0],g=v[1];return n.makeTensorInfo(b,o.dtype,g)}};function sv(e,t,n,r){if(e===t||e<t&&n<0||t<e&&n>1)return a.Df.makeZerosTypedArray(0,r);var i=Math.abs(Math.ceil((t-e)/n)),o=a.Df.makeZerosTypedArray(i,r);t<e&&1===n&&(n=-1),o[0]=e;for(var s=1;s<o.length;s++)o[s]=o[s-1]+n;return o}var uv={kernelName:a.nc,backendName:"cpu",kernelFunc:function(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,i=n.dtype,o=sv(r,a,n.step,i);return t.makeTensorInfo([o.length],i,o)}},cv=hd(a.qc,(function(e){return 1/e})),lv={kernelName:a.qc,backendName:"cpu",kernelFunc:cv};var dv={kernelName:a.uc,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,o=t.images,s=r.alignCorners,u=r.halfPixelCenters,c=r.size;dd(o,"resizeBilinear");for(var l=a.Df.computeStrides(o.shape),d=Object(i.a)(c,2),p=d[0],f=d[1],h=Object(i.a)(o.shape,4),m=h[0],v=h[1],b=h[2],g=h[3],y=n.data.get(o.dataId).values,x=new Float32Array(a.Df.sizeFromShape([m,p,f,g])),k=[s&&p>1?v-1:v,s&&f>1?b-1:b],w=[s&&p>1?p-1:p,s&&f>1?f-1:f],O=0,I=k[0]/w[0],S=k[1]/w[1],N=0;N<m;N++)for(var j=0;j<p;j++){var T=void 0;T=u?I*(j+.5)-.5:I*j;for(var C=Math.max(0,Math.floor(T)),E=T-C,_=Math.min(v-1,Math.ceil(T)),A=N*l[0]+C*l[1],R=N*l[0]+_*l[1],D=0;D<f;D++){var F=void 0;F=u?S*(D+.5)-.5:S*D;for(var M=Math.max(0,Math.floor(F)),z=F-M,L=Math.min(b-1,Math.ceil(F)),P=A+M*l[2],B=R+M*l[2],W=A+L*l[2],U=R+L*l[2],V=0;V<g;V++){var G=y[P+V],H=y[B+V],q=G+(y[W+V]-G)*z,K=q+(H+(y[U+V]-H)*z-q)*E;x[O++]=K}}}return n.makeTensorInfo([m,p,f,g],"float32",x)}};var pv={kernelName:a.vc,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,o=t.images,s=t.dy,u=r.alignCorners;dd([s,o],"resizeBilinearGrad");for(var c=a.Df.computeStrides(o.shape),l=Object(i.a)(o.shape,4),d=l[0],p=l[1],f=l[2],h=l[3],m=Object(i.a)(s.shape,3),v=m[1],b=m[2],g=new Float32Array(d*p*f*h),y=[u&&v>1?p-1:p,u&&b>1?f-1:f],x=[u&&v>1?v-1:v,u&&b>1?b-1:b],k=y[0]/x[0],w=y[1]/x[1],O=n.data.get(s.dataId).values,I=0,S=0;S<d;S++)for(var N=S*c[0],j=0;j<v;j++)for(var T=j*k,C=Math.floor(T),E=Math.min(Math.ceil(T),p-1),_=N+C*c[1],A=N+E*c[1],R=T-C,D=1-R,F=0;F<b;F++)for(var M=F*w,z=Math.floor(M),L=Math.min(Math.ceil(M),f-1),P=M-z,B=1-P,W=_+z*c[2],U=_+L*c[2],V=A+z*c[2],G=A+L*c[2],H=D*B,q=D*P,K=R*B,X=R*P,Y=0;Y<h;Y++){var Z=O[I++];g[W+Y]+=Z*H,g[U+Y]+=Z*q,g[V+Y]+=Z*K,g[G+Y]+=Z*X}return n.makeTensorInfo([d,f,p,h],"float32",g)}};var fv={kernelName:a.wc,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,o=t.images,s=r.alignCorners,u=r.halfPixelCenters,c=r.size;dd(o,"resizeNearestNeighbor");for(var l=a.Df.computeStrides(o.shape),d=Object(i.a)(c,2),p=d[0],f=d[1],h=Object(i.a)(o.shape,4),m=h[0],v=h[1],b=h[2],g=h[3],y=n.data.get(o.dataId).values,x=new Float32Array(m*p*f*g),k=[s&&p>1?v-1:v,s&&f>1?b-1:b],w=[s&&p>1?p-1:p,s&&f>1?f-1:f],O=k[0]/w[0],I=k[1]/w[1],S=0,N=0;N<m;N++)for(var j=N*l[0],T=0;T<p;T++){var C=u?O*(T+.5):O*T,E=Math.min(v-1,s?Math.round(C):Math.floor(C));u&&(E=Math.max(0,E));for(var _=j+E*l[1],A=0;A<f;A++){var R=u?I*(A+.5):I*A,D=Math.min(b-1,s?Math.round(R):Math.floor(R));u&&(D=Math.max(0,D));for(var F=_+D*l[2],M=0;M<g;M++){var z=y[F+M];x[S++]=z}}}return n.makeTensorInfo([m,p,f,g],o.dtype,x)}};var hv={kernelName:a.xc,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,o=t.images,s=t.dy,u=r.alignCorners;dd([s,o],"resizeNearestNeighborGrad");for(var c=a.Df.computeStrides(o.shape),l=a.Df.computeStrides(s.shape),d=Object(i.a)(o.shape,4),p=d[0],f=d[1],h=d[2],m=d[3],v=Object(i.a)(s.shape,3),b=v[1],g=v[2],y=new Float32Array(p*f*h*m),x=n.data.get(s.dataId).values,k=[u&&b>1?f-1:f,u&&g>1?h-1:h],w=[u&&b>1?b-1:b,u&&g>1?g-1:g],O=k[0]/w[0],I=k[1]/w[1],S=1/O,N=1/I,j=2*Math.ceil(S)+2,T=2*Math.ceil(N)+2,C=0;C<p;C++)for(var E=C*c[0],_=0;_<f;_++)for(var A=E+_*c[1],R=Math.floor(_*S),D=Math.floor(R-j/2),F=0;F<h;F++)for(var M=A+F*c[2],z=Math.floor(F*N),L=Math.floor(z-T/2),P=0;P<m;P++){for(var B=0,W=0;W<j;W++){var U=W+D;if(!(U<0||U>=b)){var V=E+U*l[1],G=U*O;if(_===Math.min(f-1,u?Math.round(G):Math.floor(G)))for(var H=0;H<T;H++){var q=H+L;if(!(q<0||q>=g)){var K=V+q*l[2],X=q*I;F===Math.min(h-1,u?Math.round(X):Math.floor(X))&&(B+=x[K+P])}}}}y[M+P]=B}return n.makeTensorInfo(o.shape,o.dtype,y)}};var mv={kernelName:a.yc,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.x,o=r.dims;dd(i,"reverse");var s=i.shape.length,u=a.Df.parseAxisParam(o,i.shape);if(0===s)return gd({inputs:{x:i},backend:n});for(var c=new a.hd(i.shape,i.dtype),l=n.bufferSync(i),d=function(e){var t=c.indexToLoc(e),n=t.slice();u.forEach((function(e){return n[e]=i.shape[e]-1-n[e]})),c.set.apply(c,[l.get.apply(l,Object(qn.a)(n))].concat(Object(qn.a)(t)))},p=0;p<c.size;p++)d(p);return n.makeTensorInfo(c.shape,c.dtype,c.values)}},vv={kernelName:a.zc,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.attrs,r=e.backend,o=t.image,s=n.radians,u=n.fillValue,c=n.center,l=r,d=a.Df.getTypedArrayFromDType(o.dtype,a.Df.sizeFromShape(o.shape)),p=Object(i.a)(o.shape,4),f=p[0],h=p[1],m=p[2],v=p[3],b=a.zd.getImageCenter(c,h,m),g=Object(i.a)(b,2),y=g[0],x=g[1],k=Math.sin(s),w=Math.cos(s),O=l.data.get(o.dataId).values,I=0;I<f;I++)for(var S=I*m*h*v,N=0;N<h;N++)for(var j=N*(m*v),T=0;T<m;T++)for(var C=T*v,E=0;E<v;E++){var _=[f,N,T,E],A=_[2],R=_[1],D=(A-y)*w-(R-x)*k,F=(A-y)*k+(R-x)*w;D=Math.round(D+y),F=Math.round(F+x);var M=u;if("number"!==typeof u&&(M=3===E?255:u[E]),D>=0&&D<m&&F>=0&&F<h)M=O[S+F*(m*v)+D*v+E];d[S+j+C+E]=M}return{dataId:l.write(d,o.shape,o.dtype),shape:o.shape,dtype:o.dtype}}},bv=hd(a.Ac,(function(e){var t=Math.floor(e);return e-t<.5?Math.floor(e):e-t>.5?Math.ceil(e):t%2===0?t:t+1})),gv={kernelName:a.Ac,backendName:"cpu",kernelFunc:bv},yv=Ed((function(e){return 1/Math.sqrt(e)})),xv=md(a.Bc,yv),kv={kernelName:a.Bc,backendName:"cpu",kernelFunc:xv};function wv(e,t,n,r,i,o,s,u,c,l){var d=[r/i,i],p=e.values,f=t.values;if(0===r)return Object(a.Gd)(n,t.dtype);var h=Object(a.Gd)(d,t.dtype);"string"===typeof c||"number"===typeof c?h.values.fill(c):"boolean"===typeof c&&h.values.fill(+c);for(var m=0;m<o;m++){for(var v=[],b=0,g=0;g<s;g++){var y=p[m*s+g];v.push(y),b+=y*u[g]}if(b<0||b>=r/i)throw new Error("Invalid indices: ".concat(v," does not index into ").concat(n));for(var x=0;x<i;x++)l?h.values[b*i+x]+=f[m*i+x]:h.values[b*i+x]=0===t.rank?f[0]:f[m*i+x]}return h}var Ov={kernelName:a.Cc,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.indices,o=t.updates,s=r.shape,u=a.zd.calculateShapes(o,i,s),c=u.sliceRank,l=u.numUpdates,d=u.sliceSize,p=u.strides,f=u.outputSize,h=wv(n.bufferSync(i),n.bufferSync(o),s,f,d,l,c,p,0,!0);return n.makeTensorInfo(s,h.dtype,h.values)}};function Iv(e,t){for(var n=0,r=e.length,a=0;n<r;)e[a=Math.floor((n+r)/2)]<t?n=a+1:r=a;return r}function Sv(e,t){for(var n=0,r=e.length,a=0;n<r;)e[a=Math.floor((n+r)/2)]<=t?n=a+1:r=a;return r}var Nv={kernelName:a.Dc,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.sortedSequence,o=t.values,s=r.side,u=function(e,t,n,r,i,o){for(var s=a.Df.getArrayFromDType("int32",n*i),u=0;u<n;++u)for(var c=e.slice(u*r,(u+1)*r),l=u*i,d=0;d<i;++d)s[l+d]="left"===o?Iv(c,t[d+l]):Sv(c,t[d+l]);return s}(n.data.get(i.dataId).values,n.data.get(o.dataId).values,i.shape[0],i.shape[1],o.shape[1],s);return n.makeTensorInfo(o.shape,"int32",u)}};var jv={kernelName:a.Ec,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.condition,i=t.t,o=t.e;dd([r,i,o],"select");for(var s=r.shape.length,u=n.data.get(r.dataId).values,c=n.data.get(i.dataId).values,l=n.data.get(o.dataId).values,d=Object(a.Cf)(i.dtype,o.dtype),p=a.Df.makeZerosTypedArray(a.Df.sizeFromShape(i.shape),d),f=0,h=0===s||s>1||1===i.shape.length?1:a.Df.sizeFromShape(i.shape.slice(1)),m=0;m<u.length;m++)for(var v=0;v<h;v++)1===u[m]?p[f++]=c[m]:p[f++]=l[m];return n.makeTensorInfo(i.shape,d,p)}},Tv=a.zd.SELU_SCALEALPHA,Cv=a.zd.SELU_SCALE,Ev=hd(a.Fc,(function(e){return e>=0?Cv*e:Tv*(Math.exp(e)-1)})),_v={kernelName:a.Fc,backendName:"cpu",kernelFunc:Ev},Av=hd(a.Hc,(function(e){return e<0?-1:e>0?1:0})),Rv={kernelName:a.Hc,backendName:"cpu",kernelFunc:Av},Dv=hd(a.Ic,(function(e){return Math.sin(e)})),Fv={kernelName:a.Ic,backendName:"cpu",kernelFunc:Dv},Mv=hd(a.Jc,(function(e){return Math.sinh(e)})),zv={kernelName:a.Jc,backendName:"cpu",kernelFunc:Mv},Lv=Math.log(1.1920928955078125e-7)+2,Pv=hd(a.Mc,(function(e){var t=e>-Lv,n=e<Lv,r=Math.exp(e);return n?r:t?e:Math.log(1+r)})),Bv={kernelName:a.Mc,backendName:"cpu",kernelFunc:Pv};var Wv={kernelName:a.Nc,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.x,o=r.blockShape,s=r.paddings;dd([i],"spaceToBatchND");var u=a.Df.sizeFromShape(o),c=[[0,0]];c.push.apply(c,Object(qn.a)(s));for(var l=1+o.length;l<i.shape.length;++l)c.push([0,0]);var d=Gm.kernelFunc({inputs:{x:i},backend:n,attrs:{paddings:c,constantValue:0}}),p=a.zd.getReshaped(d.shape,o,u,!1),f=a.zd.getPermuted(p.length,o.length,!1),h=a.zd.getReshapedPermuted(d.shape,o,u,!1),m=Yd({inputs:{x:d},backend:n,attrs:{shape:p}}),v=up({inputs:{x:m},backend:n,attrs:{perm:f}}),b=Yd({inputs:{x:v},backend:n,attrs:{shape:h}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(v),b}};function Uv(e,t,n,r,i,o,s){var u=t[0],c=o[0],l=new Array(c),d=new Array(u),p=t[1];if(0===c){if(0!==u)throw new Error(a.zd.getSparseFillEmptyRowsIndicesDenseShapeMismatch(u));return[a.Df.getArrayFromDType(n,0),[0,p],a.Df.getArrayFromDType(i,0),l,d]}for(var f=!0,h=0,m=new Array(c).fill(0),v=0;v<u;++v){var b=e[v*p];if(b<0)throw new Error(a.zd.getSparseFillEmptyRowsNegativeIndexErrorMessage(v,b));if(b>=c)throw new Error(a.zd.getSparseFillEmptyRowsOutOfRangeIndexErrorMessage(v,b,c));++m[b],f=f&&b>=h,h=b}for(var g=!0,y=0;y<c;++y){var x=0===m[y];l[y]=x,g=g&&!x,m[y]=Math.max(m[y],1),y>0&&(m[y]+=m[y-1])}if(g&&f){for(var k=e,w=r,O=0;O<u;++O)d[O]=O;return[k,[u,p],w,l,d]}for(var I=m[c-1],S=a.Df.getArrayFromDType(n,I*p),N=a.Df.getArrayFromDType(i,I),j=new Array(c).fill(0),T=0;T<u;++T){var C=e[T*p],E=j[C],_=(0===C?0:m[C-1])+E;j[C]++;for(var A=0;A<p;++A)S[_*p+A]=e[T*p+A];N[_]=r[T],d[T]=_}for(var R=0;R<c;++R){if(0===j[R]){var D=0===R?0:m[R-1];S[D*p+0]=R;for(var F=1;F<p;++F)S[D*p+F]=0;N[D]=s}}return[S,[I,p],N,l,d]}var Vv={kernelName:a.Oc,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.indices,a=t.values,o=t.denseShape,s=t.defaultValue;if(1!==o.shape.length)throw new Error("Dense shape must be a vector, saw:\n        ".concat(o.shape));if(2!==r.shape.length)throw new Error("Indices must be a matrix, saw:\n        ".concat(r.shape));if(1!==a.shape.length)throw new Error("Values must be a vector, saw:\n        ".concat(a.shape));if(0!==s.shape.length)throw new Error("Default value must be a scalar, saw:\n        ".concat(s.shape));var u=n.data.get(r.dataId).values,c=n.data.get(a.dataId).values,l=n.data.get(o.dataId).values,d=n.data.get(s.dataId).values[0],p=Uv(u,r.shape,r.dtype,c,a.dtype,l,d),f=Object(i.a)(p,5),h=f[0],m=f[1],v=f[2],b=f[3],g=f[4];return[n.makeTensorInfo(m,r.dtype,h),n.makeTensorInfo([m[0]],a.dtype,v),n.makeTensorInfo([b.length],"bool",new Uint8Array(b.map((function(e){return Number(e)})))),n.makeTensorInfo([g.length],r.dtype,new Int32Array(g))]}};function Gv(e,t,n,r,i){for(var o=a.Df.sizeFromShape(r),s=t[0],u=i.length,c=[],l=1,d=-1,p=0;p<u;++p){var f=i[p];if(-1===f){if(-1!==d)throw new Error(a.zd.getSparseReshapeMultipleNegativeOneOutputDimErrorMessage(d,p));d=p,c.push(1)}else{if(f<0)throw new Error(a.zd.getSparseReshapeNegativeOutputDimErrorMessage(p,f));l*=f,c.push(f)}}if(-1!==d){if(l<=0)throw new Error(a.zd.getSparseReshapeEmptyTensorZeroOutputDimErrorMessage());var h=Math.trunc(o/l);if(l*h!==o)throw new Error(a.zd.getSparseReshapeInputOutputMultipleErrorMessage(r,c));c[d]=h}if(a.Df.sizeFromShape(c)!==o)throw new Error(a.zd.getSparseReshapeInputOutputMismatchErrorMessage(r,c));var m=r.length,v=[];if(m>0){v[m-1]=1;for(var b=m-2;b>=0;--b)v[b]=v[b+1]*r[b+1]}var g=[];if(u>0){g[u-1]=1;for(var y=u-2;y>=0;--y)g[y]=g[y+1]*c[y+1]}for(var x=a.Df.getArrayFromDType(n,s*u),k=0;k<s;++k){for(var w=0,O=0;O<m;++O)w+=e[k*m+O]*v[O];for(var I=0;I<u;++I)x[k*u+I]=Math.trunc(w/g[I]),w%=g[I]}return[x,[s,u],c]}var Hv={kernelName:a.Pc,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.inputIndices,a=t.inputShape,o=t.newShape;if(2!==r.shape.length)throw new Error("Input indices should be a matrix but received shape\n        ".concat(r.shape));if(1!==a.shape.length)throw new Error("Input shape should be a vector but received shape\n        ".concat(a.shape));if(1!==o.shape.length)throw new Error("Target shape should be a vector but received shape ".concat(o.shape));var s=Array.from(n.data.get(a.dataId).values),u=n.data.get(r.dataId).values,c=Array.from(n.data.get(o.dataId).values),l=Gv(u,r.shape,r.dtype,s,c),d=Object(i.a)(l,3),p=d[0],f=d[1],h=d[2];return[n.makeTensorInfo(f,r.dtype,p),n.makeTensorInfo([h.length],o.dtype,new Int32Array(h))]}};function qv(e,t,n,r,i){var o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,u=r.length,c=[t[0],e.length/t[0]],l=c[1],d=u>0?i[u-1]+1:0,p=d;if(p<0)throw new Error(a.zd.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());var f=t.slice();f[0]=p;var h=f.reduce((function(e,t){return e*t}),1),m=a.Df.getArrayFromDType(n,h);if(0===u)return p>0&&m.fill(s),[m,f];if(p<=0)throw new Error(a.zd.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());for(var v=0,b=1,g=0,y=i[v];;){var x=0;if(b<u){if(y===(x=i[b])){++b;continue}if(y>=x)throw new Error(a.zd.getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage())}if(y<0||y>=p)throw new Error(a.zd.getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage(y,p));y>g&&m.fill(s,g*l,y*l);for(var k=v;k<b;++k){var w=r[k];if(w<0||w>=c[0])throw new Error(a.zd.getSparseSegmentReductionIndicesOutOfRangeErrorMessage(k,r[k],c[0]));for(var O=0;O<l;O++)m[y*l+O]+=e[w*l+O]}if(o)for(var I=0;I<l;I++)m[y*l+I]/=b-v;if(v=b,g=y+1,y=x,++b>u)break}return g<p&&m.fill(s,g*l,p*l),[m,f]}var Kv={kernelName:a.Qc,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.data,a=t.indices,o=t.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n          ".concat(a.shape));if(1!==o.shape.length)throw new Error("Segment ids should be a vector but received shape\n          ".concat(o.shape));if(a.shape[0]!==o.shape[0])throw new Error("segmentIds and indices should have same size.");var s=n.data.get(r.dataId).values,u=n.data.get(a.dataId).values,c=n.data.get(o.dataId).values,l=qv(s,r.shape,r.dtype,u,c,!0),d=Object(i.a)(l,2),p=d[0],f=d[1];return n.makeTensorInfo(f,r.dtype,p)}};var Xv={kernelName:a.Rc,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.data,a=t.indices,o=t.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n         ".concat(a.shape));if(1!==o.shape.length)throw new Error("Segment ids should be a vector but received shape\n         ".concat(o.shape));if(a.shape[0]!==o.shape[0])throw new Error("segmentIds and indices should have same size.");var s=n.data.get(r.dataId).values,u=n.data.get(a.dataId).values,c=n.data.get(o.dataId).values,l=qv(s,r.shape,r.dtype,u,c),d=Object(i.a)(l,2),p=d[0],f=d[1];return n.makeTensorInfo(f,r.dtype,p)}};var Yv={kernelName:a.Sc,backendName:"cpu",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,i=e.attrs,o=n.sparseIndices,s=n.sparseValues,u=n.defaultValue,c=i.outputShape,l=a.zd.calculateShapes(s,o,c),d=l.sliceRank,p=l.numUpdates,f=l.sliceSize,h=l.strides,m=l.outputSize,v=r.bufferSync(o);switch(s.dtype){case"bool":t=wv(v,r.bufferSync(s),c,m,f,p,d,h,Boolean(r.data.get(u.dataId).values[0]),!1);break;case"float32":t=wv(v,r.bufferSync(s),c,m,f,p,d,h,r.data.get(u.dataId).values[0],!1);break;case"int32":t=wv(v,r.bufferSync(s),c,m,f,p,d,h,r.data.get(u.dataId).values[0],!1);break;case"string":t=wv(v,r.bufferSync(s),c,m,f,p,d,h,a.Df.decodeString(r.data.get(u.dataId).values[0]),!1);break;default:throw new Error("Unsupported type ".concat(s.dtype))}return r.makeTensorInfo(c,t.dtype,t.values)}};var Zv={kernelName:a.Tc,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.x,o=r.numOrSizeSplits,s=r.axis,u=a.Df.parseAxisParam(s,i.shape)[0],c=a.zd.prepareSplitSize(i,o,u),l=new Array(i.shape.length).fill(0),d=i.shape.slice();return c.map((function(e){var t=Object(qn.a)(d);t[u]=e;var r=Dp({inputs:{x:i},backend:n,attrs:{begin:l,size:t}});return l[u]+=e,r}))}},Jv=Ed((function(e){return Math.sqrt(e)})),Qv=hd(a.Uc,(function(e){return Math.sqrt(e)})),$v={kernelName:a.Uc,backendName:"cpu",kernelFunc:Qv},eb={kernelName:a.Vc,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=n;dd(r,"square");for(var i=a.data.get(r.dataId).values,o=new Float32Array(i.length),s=0;s<i.length;++s){var u=i[s];o[s]=u*u}return{dataId:a.write(o,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},tb=wd((function(e,t){var n=e-t;return n*n})),nb=Vd(a.Wc,tb),rb={kernelName:a.Wc,backendName:"cpu",kernelFunc:nb},ab=hd(a.Xc,(function(e,t){var n=t;return isNaN(e)?NaN:e>0?1:n.alpha})),ib={kernelName:a.Xc,backendName:"cpu",kernelFunc:ab};function ob(e,t,n,r){for(var i=Object(a.Gd)(e,t.dtype),o=0;o<i.size;o++){for(var s=i.indexToLoc(o),u=new Array(s.length),c=0;c<u.length;c++)u[c]=s[c]*n[c]+r[c];i.set.apply(i,[t.get.apply(t,u)].concat(Object(qn.a)(s)))}return i}var sb={kernelName:a.Yc,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.x,o=r.begin,s=r.end,u=r.strides,c=r.beginMask,l=r.endMask,d=r.ellipsisMask,p=r.newAxisMask,f=r.shrinkAxisMask;dd(i,"stridedSlice");var h,m=a.hf.sliceInfo(i.shape,o,s,u,c,l,d,p,f),v=m.finalShapeSparse,b=m.finalShape,g=m.isIdentity,y=m.sliceDim0,x=m.isSimpleSlice,k=m.begin,w=m.end,O=m.strides;if(g)h=Yd({inputs:{x:i},backend:n,attrs:{shape:b}});else if(y||x){a.Df.assert(i.shape.length>=1,(function(){return"Input must have rank at least 1, got: ".concat(i.shape.length)}));var I=a.hf.computeOutShape(k,w,O),S=Dp({inputs:{x:i},backend:n,attrs:{begin:k,size:I}});h=Yd({inputs:{x:S},backend:n,attrs:{shape:b}}),n.disposeIntermediateTensorInfo(S)}else{var N=ob(v,n.bufferSync(i),O,k);h=n.makeTensorInfo(b,N.dtype,N.values)}return h}},ub=function(){function e(t,n,r,i,o,s){Object($r.a)(this,e),this.separator=a.Df.encodeString(t),this.nGramWidths=n,this.leftPad=a.Df.encodeString(r),this.rightPad=a.Df.encodeString(i),this.padWidth=o,this.preserveShort=s}return Object(ea.a)(e,[{key:"getPadWidth",value:function(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}},{key:"getNumNGrams",value:function(e,t){var n=this.getPadWidth(t);return Math.max(0,e+2*n-t+1)}},{key:"createNGrams",value:function(e,t,n,r,a,i){for(var o=this,s=function(s){var u=o.getPadWidth(i),c=Math.max(0,u-s),l=Math.max(0,u-(a-(s+1))),d=i-(c+l),p=t+(c>0?0:s-u),f=0;f+=c*o.leftPad.length;for(var h=0;h<d;++h)f+=e[p+h].length;f+=l*o.rightPad.length,f+=(c+l+d-1)*o.separator.length,n[r+s]=new Uint8Array(f);for(var m=n[r+s],v=0,b=function(e){return e.forEach((function(e){return m[v++]=e}))},g=0;g<c;++g)b(o.leftPad),b(o.separator);for(var y=0;y<d-1;++y)b(e[p+y]),b(o.separator);if(d>0){b(e[p+d-1]);for(var x=0;x<l;++x)b(o.separator),b(o.rightPad)}else{for(var k=0;k<l-1;++k)b(o.rightPad),b(o.separator);b(o.rightPad)}},u=0;u<a;++u)s(u)}},{key:"compute",value:function(e,t){var n=this,r=e.length,i=t.length;if(i>0){var o=t[0];if(0!==o)throw new Error("First split value must be 0, got ".concat(o));for(var s=1;s<i;++s){var u=t[s]>=o;if(!(u=u&&t[s]<=r))throw new Error("Invalid split value ".concat(t[s],", must be in [").concat(o,", ").concat(r,"]"));o=t[s]}if(o!==r)throw new Error("Last split value must be data size. Expected ".concat(r,", got ").concat(o))}var c=i-1,l=a.Df.getArrayFromDType("int32",i);if(0===r||0===i){for(var d=new Array(r),p=0;p<=c;++p)l[p]=0;return[d,l]}l[0]=0;for(var f=function(e){var r=t[e]-t[e-1],a=0;n.nGramWidths.forEach((function(e){a+=n.getNumNGrams(r,e)})),n.preserveShort&&r>0&&0===a&&(a=1),l[e]=l[e-1]+a},h=1;h<=c;++h)f(h);for(var m=new Array(l[c]),v=function(r){var a=t[r],i=l[r];if(n.nGramWidths.forEach((function(o){var s=t[r+1]-t[r],u=n.getNumNGrams(s,o);n.createNGrams(e,a,m,i,u,o),i+=u})),n.preserveShort&&i===l[r]){var o=t[r+1]-t[r];if(0===o)return"continue";var s=o+2*n.padWidth;n.createNGrams(e,a,m,i,1,s)}},b=0;b<c;++b)v(b);return[m,l]}}]),e}();function cb(e,t,n,r,a,i,o,s){return new ub(n,r,a,i,o,s).compute(e,t)}var lb={kernelName:a.Zc,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=r.separator,o=r.nGramWidths,s=r.leftPad,u=r.rightPad,c=r.padWidth,l=r.preserveShortSequences,d=t.data,p=t.dataSplits,f=cb(n.data.get(d.dataId).values,n.data.get(p.dataId).values,a,o,s,u,c,l),h=Object(i.a)(f,2),m=h[0],v=h[1];return[n.makeTensorInfo([m.length],"string",m),n.makeTensorInfo(p.shape,"int32",v)]}};function db(e,t,n,r){if(e.length)if(0!==t.length)if(1!==t.length){for(var a=0,i=0;i<e.length+1;i++)if(i===e.length||-1!==t.indexOf(e[i])){var o=e.subarray(a,i);n&&0===o.length||r.push(o),a=i+1}}else{for(var s=t[0],u=e.indexOf(s);-1!==u;){var c=e.subarray(0,u);n&&0===c.length||r.push(c),u=(e=e.subarray(u+1)).indexOf(s)}n&&0===e.length||r.push(e)}else for(var l=0;l<e.length;++l)r.push(e.subarray(l,l+1))}function pb(e,t,n){for(var r=e.length,i=[],o=0,s=0,u=new Array(r),c=0;c<r;++c){var l=i.length;db(e[c],t,n,i);var d=i.length-l;u[c]=d,o+=d,s=Math.max(s,d)}for(var p=a.Df.getArrayFromDType("int32",2*o),f=new Array(o),h=[r,s],m=0,v=0;v<r;++v)for(var b=0;b<u[v];++b)p[2*m]=v,p[2*m+1]=b,f[m]=i[m],++m;return[p,f,h]}var fb={kernelName:a.ad,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.skipEmpty,a=t.input,o=t.delimiter;if("string"!==a.dtype)throw new Error("Input must be of datatype string");if(1!==a.shape.length)throw new Error("Input must be a vector, got shape: ".concat(a.shape));if(0!==o.shape.length)throw new Error("Delimiter must be a scalar, got shape: ".concat(o.shape));var s=pb(n.data.get(a.dataId).values,n.data.get(o.dataId).values[0],r),u=Object(i.a)(s,3),c=u[0],l=u[1],d=u[2],p=l.length;return[n.makeTensorInfo([p,2],"int32",c),n.makeTensorInfo([p],"string",l),n.makeTensorInfo([2],"int32",new Int32Array(d))]}};function hb(e,t){for(var n=a.Df.getArrayFromDType("int32",e.length),r=0;r<e.length;++r)n[r]=a.Df.fingerPrint64(e[r]).modulo(t).getLowBitsUnsigned();return n}var mb={kernelName:a.bd,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.numBuckets,a=t.input;if("string"!==a.dtype)throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");var i=hb(n.data.get(a.dataId).values,r);return n.makeTensorInfo(a.shape,"int32",i)}},vb=hd(a.ed,(function(e){return Math.tan(e)})),bb={kernelName:a.ed,backendName:"cpu",kernelFunc:vb},gb=hd(a.fd,(function(e){return Math.tanh(e)})),yb={kernelName:a.fd,backendName:"cpu",kernelFunc:gb};function xb(e,t){for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[r]*t[r];for(var i=Object(a.Gd)(n,e.dtype),o=0;o<i.values.length;++o){for(var s=i.indexToLoc(o),u=new Array(e.rank),c=0;c<u.length;c++)u[c]=s[c]%e.shape[c];var l=e.locToIndex(u);i.values[o]=e.values[l]}return i}var kb={kernelName:a.id,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.reps;dd(a,"tile");var o=xb(n.bufferSync(a),i);return n.makeTensorInfo(o.shape,o.dtype,o.values)}},wb=function(e,t){var n=t.value-e.value;return 0===n?e.index-t.index:n};function Ob(e,t,n,r,i){for(var o=t[t.length-1],s=e.length/o,u=o,c=a.Df.getTypedArrayFromDType(n,s*r),l=a.Df.getTypedArrayFromDType("int32",s*r),d=function(t){var n=t*u,o=e.subarray(n,n+u),s=new Array(o.length);o.forEach((function(e,t){return s[t]={value:e,index:t}})),r<s.length&&(!function e(t,n){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.length-1;i>r;){if(i-r>600){var o=i-r+1,s=n-r+1,u=Math.log(o),c=.5*Math.exp(2*u/3),l=.5*Math.sqrt(u*c*(o-c)/o)*Math.sign(s-o/2),d=Math.max(r,Math.floor(n-s*c/o+l)),p=Math.min(i,Math.floor(n+(o-s)*c/o+l));e(t,n,d,p)}var f=t[n],h=r,m=i;for(a.Df.swap(t,r,n),wb(t[i],f)>0&&a.Df.swap(t,r,i);h<m;){for(a.Df.swap(t,h,m),h++,m--;wb(t[h],f)<0;)h+=1;for(;wb(t[m],f)>0;)m-=1}0===wb(t[r],f)?a.Df.swap(t,r,m):(m+=1,a.Df.swap(t,m,i)),m<=n&&(r=m+1),n<=m&&(i=m-1)}}(s,r),s=s.slice(0,r)),i&&s.sort(wb);for(var d=t*r,p=c.subarray(d,d+r),f=l.subarray(d,d+r),h=0;h<r;h++)p[h]=s[h].value,f[h]=s[h].index},p=0;p<s;p++)d(p);var f=t.slice();return f[f.length-1]=r,[Object(a.Gd)(f,n,c),Object(a.Gd)(f,"int32",l)]}var Ib={kernelName:a.jd,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.k,s=r.sorted;dd(a,"topk");var u=Ob(n.data.get(a.dataId).values,a.shape,a.dtype,o,s),c=Object(i.a)(u,2),l=c[0],d=c[1];return[n.makeTensorInfo(l.shape,l.dtype,l.values),n.makeTensorInfo(d.shape,d.dtype,d.values)]}};var Sb={kernelName:a.kd,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,o=t.image,s=t.transforms,u=n.interpolation,c=n.fillMode,l=n.fillValue,d=n.outputShape,p=Object(i.a)(o.shape,4),f=p[0],h=p[1],m=p[2],v=p[3],b=null!=d?d:[h,m],g=Object(i.a)(b,2),y=g[0],x=g[1],k=[f,y,x,v],w=a.Df.computeStrides(o.shape),O=w[0],I=w[1],S=w[2],N=a.Df.computeStrides(k),j=N[0],T=N[1],C=N[2],E=a.Df.getTypedArrayFromDType(o.dtype,a.Df.sizeFromShape(k));E.fill(l);for(var _=r.data.get(o.dataId).values,A=r.data.get(s.dataId).values,R=0;R<f;++R){for(var D=1===s.shape[0]?A:A.subarray(8*R,8*R+8),F=0;F<y;++F)for(var M=0;M<x;++M)for(var z=0;z<v;++z){var L=void 0,P=D[6]*M+D[7]*F+1;if(0!==P){var B=(D[0]*M+D[1]*F+D[2])/P,W=(D[3]*M+D[4]*F+D[5])/P,U=Nb(B,m,c),V=Nb(W,h,c);switch(u){case"nearest":L=Tb(_,h,m,O,I,S,R,V,U,z,l);break;case"bilinear":L=Cb(_,h,m,O,I,S,R,V,U,z,l);break;default:throw new Error("Error in Transform: Expect 'nearest' or "+"'bilinear', but got ".concat(u))}E[R*j+F*T+M*C+z]=L}}return r.makeTensorInfo(k,o.dtype,E)}return{dataId:r.write(E,k,o.dtype),shape:o.shape,dtype:o.dtype}}};function Nb(e,t,n){switch(n){case"reflect":return function(e,t){var n=e;if(n<0)if(t<=1)n=0;else{var r=2*t;n<r&&(n=r*Math.trunc(-n/r)+n),n=n<-t?n+r:-n-1}else if(n>t-1)if(t<=1)n=0;else{var i=2*t;(n-=i*Math.trunc(n/i))>=t&&(n=i-n-1)}return a.Df.clamp(0,n,t-1)}(e,t);case"wrap":return function(e,t){var n=e;if(n<0)if(t<=1)n=0;else{var r=t-1;n+=t*(Math.trunc(-n/r)+1)}else if(n>t-1)if(t<=1)n=0;else{var i=t-1;n-=t*Math.trunc(n/i)}return a.Df.clamp(0,n,t-1)}(e,t);case"nearest":return function(e,t){return a.Df.clamp(0,e,t-1)}(e,t);case"constant":default:return function(e,t){return e}(e)}}function jb(e,t,n,r,a,i,o,s,u,c,l){return 0<=s&&s<t&&0<=u&&u<n?e[o*r+s*a+u*i+c]:l}function Tb(e,t,n,r,a,i,o,s,u,c,l){return jb(e,t,n,r,a,i,o,Math.round(s),Math.round(u),c,l)}function Cb(e,t,n,r,a,i,o,s,u,c,l){var d=Math.floor(s),p=Math.floor(u),f=d+1,h=p+1;return(f-s)*((h-u)*jb(e,t,n,r,a,i,o,d,p,c,l)+(u-p)*jb(e,t,n,r,a,i,o,d,h,c,l))+(s-d)*((h-u)*jb(e,t,n,r,a,i,o,f,p,c,l)+(u-p)*jb(e,t,n,r,a,i,o,f,h,c,l))}function Eb(e,t,n,r){for(var i=a.Df.parseAxisParam(t,n)[0],o=[1,n[0],1],s=0;s<i;s++)o[0]*=n[s];o[1]=n[i];for(var u=i+1;u<n.length;u++)o[2]*=n[u];for(var c={},l=new Int32Array(n[i]),d=new a.hd(o,r,e),p=[],f=1===o[0]&&1===o[2],h=0;h<n[i];h++){var m=void 0;if(f)m=e[h].toString();else{for(var v=[],b=0;b<o[0];b++)for(var g=0;g<o[2];g++)v.push(d.get(b,h,g));m=v.join(",")}if(void 0!==c[m])l[h]=c[m];else{var y=Object.keys(c).length;c[m]=y,l[h]=y,p.push(h)}}var x=o.slice();x[1]=Object.keys(c).length;var k=new a.hd(x,r);p.forEach((function(e,t){for(var n=0;n<o[0];n++)for(var r=0;r<o[2];r++)k.set(d.get(n,e,r),n,t,r)}));var w=n.slice();return w[i]=x[1],{outputValues:k.values,outputShape:w,indices:l}}var _b={kernelName:a.md,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=n.axis,i=t.x;dd(i,"unique");var o=Eb(r.data.get(i.dataId).values,a,i.shape,i.dtype),s=o.outputValues,u=o.outputShape,c=o.indices;return[r.makeTensorInfo(u,i.dtype,s),r.makeTensorInfo([c.length],"int32",c)]}};var Ab={kernelName:a.nd,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.value,i=r.axis;i<0&&(i+=a.shape.length);for(var o=a.shape.length,s=a.shape[i],u=new Array(o-1),c=0,l=0;l<o;l++)l!==i&&(u[c++]=a.shape[l]);var d=new Array(o).fill(0),p=a.shape.slice();p[i]=1;for(var f=new Array(s),h=0;h<f.length;h++){d[i]=h;var m=Dp({inputs:{x:a},backend:n,attrs:{begin:d,size:p}});f[h]=Yd({inputs:{x:m},backend:n,attrs:{shape:u}}),n.disposeIntermediateTensorInfo(m)}return f}};for(var Rb={kernelName:a.od,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.x,o=t.segmentIds,s=r.numSegments;dd(i,"unsortedSegmentSum");for(var u=[],c=[],l=i.shape.length-o.shape.length,d=o,p=0;p<l;++p){var f=Hf({inputs:{input:d},backend:n,attrs:{dim:p+1}});d=f,c.push(f)}for(var h=0;h<s;++h){var m=a.Df.createScalarValue(h,"int32"),v=n.makeTensorInfo([],"int32",m),b=Af({inputs:{a:v,b:d},backend:n}),g=Wd({inputs:{x:b},backend:n,attrs:{dtype:"float32"}}),y=Sf({inputs:{a:g,b:i},backend:n}),x=jf({inputs:{x:y},backend:n,attrs:{axis:0,keepDims:!1}});u.push(x),c.push(v),c.push(b),c.push(g),c.push(y),c.push(x)}var k=Um({inputs:u,backend:n,attrs:{axis:0}});return c.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),k}},Db=0,Fb=[$d,tp,rp,ip,Xd,op,lp,dp,pp,fp,mp,bp,yp,wp,Ip,Tp,Cp,Ep,_p,Qd,Ap,Mp,Pp,Bp,Ud,Vp,Hp,Md,qp,Jp,$p,ef,tf,nf,rf,af,sf,cf,lf,df,pf,ff,hf,vf,bf,gf,yf,xf,kf,wf,Cf,bd,Ef,Rf,Wf,Gf,qf,Yf,ih,sh,uh,dh,hh,mh,vh,gh,xh,Oh,Nh,yd,jh,Yp,Ch,_h,Rh,kd,Mh,Ph,Wh,Gh,qh,Yh,Jh,em,tm,nm,im,um,cm,lm,dm,pm,fm,hm,mm,gm,ym,wm,Nm,Nf,Tm,Em,Am,Dm,zm,Lm,Wm,Vm,Gm,Km,Sd,Ym,ev,ov,uv,Pd,Qf,lv,jd,Cd,Zd,dv,pv,fv,hv,mv,vv,gv,kv,Ov,Nv,jv,_v,Rd,Rv,Fv,zv,Fp,Sm,Bv,Wv,Vv,Hv,Kv,Xv,Yv,Zv,$v,eb,rb,ib,sb,lb,fb,mb,nh,Tf,bb,yb,kb,Ib,Sb,cp,_b,Ab,Rb,Bm];Db<Fb.length;Db++){var Mb=Fb[Db];Object(a.Se)(Mb)}var zb,Lb,Pb,Bb={},Wb={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function Ub(e,t){if(!(e in Bb)||null!=t){var n=function(e,t){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var n=null==t?function(e){if("undefined"!==typeof OffscreenCanvas&&2===e)return new OffscreenCanvas(300,150);if("undefined"!==typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(e):t;n.addEventListener("webglcontextlost",(function(t){t.preventDefault(),delete Bb[e]}),!1),Object(a.be)().getBool("SOFTWARE_WEBGL_ENABLED")&&(Wb.failIfMajorPerformanceCaveat=!1);if(1===e)return n.getContext("webgl",Wb)||n.getContext("experimental-webgl",Wb);return n.getContext("webgl2",Wb)}(e,t);if(null===n)return console.log("Could not get context for WebGL version",e),null;Bb[e]=n}var r=Bb[e];return null==r||r.isContextLost()?(delete Bb[e],Ub(e)):(r.disable(r.DEPTH_TEST),r.disable(r.STENCIL_TEST),r.disable(r.BLEND),r.disable(r.DITHER),r.disable(r.POLYGON_OFFSET_FILL),r.disable(r.SAMPLE_COVERAGE),r.enable(r.SCISSOR_TEST),r.enable(r.CULL_FACE),r.cullFace(r.BACK),Bb[e])}function Vb(e,t){return[t,e]}function Gb(e){var t=a.Df.sizeFromShape(e),n=Math.ceil(t/4);return a.Df.sizeToSquarishShape(n)}function Hb(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function qb(e,t){var n,r,i,o,s,u,c,l,d,p,f=e;return 2===Object(a.be)().getNumber("WEBGL_VERSION")?(n=f.R32F,r=f.R16F,i=f.RGBA16F,o=f.RGBA32F,s=f.RED,c=4,l=1,d=f.HALF_FLOAT,p=f.FLOAT,u=f.RGBA8):(n=e.RGBA,r=e.RGBA,i=e.RGBA,o=f.RGBA,s=e.RGBA,c=4,l=4,d=null!=t?t.HALF_FLOAT_OES:null,p=e.FLOAT,u=e.RGBA),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:o,textureFormatFloat:s,downloadTextureFormat:u,downloadUnpackNumChannels:c,defaultNumChannels:l,textureTypeHalfFloat:d,textureTypeFloat:p}}function Kb(e,t){var n=t();return Object(a.be)().getBool("DEBUG")&&function(e){var t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+function(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code ".concat(t)}}(e,t))}(e),n}!function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"}(zb||(zb={})),function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(Lb||(Lb={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(Pb||(Pb={}));function Xb(e){return!!(Object(a.be)().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===e||5.96e-8<Math.abs(e)&&Math.abs(e)<65504)}function Yb(e,t){return ug(e,(function(){return e.getExtension(t)}),'Extension "'+t+'" not supported on this browser.')}var Zb,Jb,Qb=/ERROR: [0-9]+:([0-9]+):/g;function $b(e,t){var n=Qb.exec(t);if(null==n)return console.log("Couldn't parse line number in error: ".concat(t)),void console.log(e);for(var r=+n[1],i=e.split("\n"),o=i.length.toString().length+2,s=i.map((function(e,t){return a.Df.rightPad((t+1).toString(),o)+e})),u=0,c=0;c<s.length;c++)u=Math.max(s[c].length,u);var l=s.slice(0,r-1),d=s.slice(r-1,r),p=s.slice(r);console.log(l.join("\n")),console.log(t.split("\n")[0]),console.log("%c ".concat(a.Df.rightPad(d[0],u)),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(p.join("\n"))}function eg(e,t){if(Kb(e,(function(){return e.validateProgram(t)})),!1===e.getProgramParameter(t,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function tg(e,t,n,r,a,i,o){var s=e.getAttribLocation(t,n);return-1!==s&&(Kb(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,r)})),Kb(e,(function(){return e.vertexAttribPointer(s,a,e.FLOAT,!1,i,o)})),Kb(e,(function(){return e.enableVertexAttribArray(s)})),!0)}function ng(e,t,n){return ug(e,(function(){return e.getUniformLocation(t,n)}),'uniform "'+n+'" not present in program.')}function rg(e,t,n){return e.getUniformLocation(t,n)}function ag(e,t,n,r){Kb(e,(function(){return function(e,t,n){cg(e,n),Kb(e,(function(){return e.activeTexture(e.TEXTURE0+n)})),Kb(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)}))}(e,t,r)})),Kb(e,(function(){return e.uniform1i(n,r)}))}function ig(e,t,n){Kb(e,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,n)})),Kb(e,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)}))}function og(e,t){Kb(e,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,t)})),Kb(e,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)}))}function sg(e){var t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+function(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error ".concat(t)}}(e,t))}function ug(e,t,n){var r=Kb(e,(function(){return t()}));if(null==r)throw new Error(n);return r}function cg(e,t){var n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n){var a="[gl.TEXTURE0, gl.TEXTURE".concat(n,"]");throw new Error("textureUnit must be in ".concat(a,"."))}}function lg(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return a.Df.sizeFromShape(e.slice(0,e.length-t))}function dg(e){if(0===e.length)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function pg(e){var t=[1,1,1];return 0===e.length||1===e.length&&1===e[0]||(t=[lg(e)].concat(Object(qn.a)(dg(e)))),t}function fg(e){return e%2===0}function hg(e,t){if(e=e.slice(-2),t=t.slice(-2),a.Df.arraysEqual(e,t))return!0;if(!e.length||!t.length)return!0;if(0===e[0]||0===e[1]||0===t[0]||0===t[1])return!0;if(e.length!==t.length){var n=e.slice(-1)[0],r=t.slice(-1)[0];if(n===r)return!0;if(fg(n)&&fg(r)&&(1===e[0]||1===t[0]))return!0}return e[1]===t[1]&&fg(e[0])&&fg(t[0])}function mg(e,t){return null!=e.getExtension(t)}function vg(e){try{if(null!=Ub(e))return!0}catch(t){return console.log("Error when getting WebGL context: ",t),!1}return!1}function bg(e){if(0===e)return!1;var t=Ub(e);if(1!==e){if(mg(t,"EXT_color_buffer_float"))return gg(t);if(mg(t,"EXT_color_buffer_half_float")){var n=t.getExtension("EXT_color_buffer_half_float");return function(e,t){var n=qb(e,t),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r);e.texImage2D(e.TEXTURE_2D,0,n.internalFormatHalfFloat,1,1,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);var a=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,a),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);var i=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(a),i}(t,n)}return!1}return!!mg(t,"OES_texture_float")&&(!!mg(t,"WEBGL_color_buffer_float")&&gg(t))}function gg(e){var t=qb(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n);e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);var r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);var a=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(r),a}function yg(e,t){Array.isArray(e)||(e=[e]),e.forEach((function(e){null!=e&&a.Df.assert("complex64"!==e.dtype,(function(){return"".concat(t," does not support complex64 tensors ")+"in the WebGL backend."}))}))}var xg=Object(a.be)();function kg(){var e,t,n,r,i,o,s,u,c,l;return 2===Object(a.be)().getNumber("WEBGL_VERSION")?(e="#version 300 es",t="in",n="out",r="in",i="texture",o="outputColor",s="out vec4 outputColor;",u=Object(a.be)().getBool("WEBGL2_ISNAN_CUSTOM")?"\n      bool isnan_custom(float val) {\n        uint floatToUint = floatBitsToUint(val);\n        return (floatToUint & 0x7fffffffu) > 0x7f800000u;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ":"",c="",l="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(e="",t="attribute",n="varying",r="varying",i="texture2D",o="gl_FragColor",s="",u="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",c="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",l="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:i,output:o,defineOutput:s,defineSpecialNaN:u,defineSpecialInf:c,defineRound:l}}function wg(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index",r=a.Df.computeStrides(t);return r.map((function(t,a){var i="int ".concat(e[a]," = ").concat(n," / ").concat(t),o=a===r.length-1?"int ".concat(e[a+1]," = ").concat(n," - ").concat(e[a]," * ").concat(t):"index -= ".concat(e[a]," * ").concat(t);return"".concat(i,"; ").concat(o,";")})).join("")}function Og(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index",r=a.Df.computeStrides(t);return r.map((function(t,a){var i="int ".concat(e[a]," = ").concat(n," / outShapeStrides[").concat(a,"]"),o=a===r.length-1?"int ".concat(e[a+1]," = ").concat(n," - ").concat(e[a]," * outShapeStrides[").concat(a,"]"):"index -= ".concat(e[a]," * outShapeStrides[").concat(a,"]");return"".concat(i,"; ").concat(o,";")})).join("")}function Ig(e,t){var n=e.length,r=e.map((function(e){return"".concat(t,"[").concat(e,"]")})),a=new Array(n-1);a[n-2]=r[n-1];for(var i=n-3;i>=0;--i)a[i]="(".concat(a[i+1]," * ").concat(r[i+1],")");return a}function Sg(e){var t=a.Df.computeStrides(e).map((function(e){return e.toString()}));return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * ".concat(t[0]," + coords.y * ").concat(t[1]," + coords.z;\n  }\n")}xg.registerFlag("HAS_WEBGL",(function(){return xg.getNumber("WEBGL_VERSION")>0})),xg.registerFlag("WEBGL_VERSION",(function(){return vg(2)?2:vg(1)?1:0})),xg.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",(function(){return!1})),xg.registerFlag("WEBGL_BUFFER_SUPPORTED",(function(){return 2===xg.get("WEBGL_VERSION")})),xg.registerFlag("WEBGL_CPU_FORWARD",(function(){return!0})),xg.registerFlag("WEBGL_FORCE_F16_TEXTURES",(function(){return!1})),xg.registerFlag("WEBGL_PACK",(function(){return xg.getBool("HAS_WEBGL")})),xg.registerFlag("WEBGL_PACK_NORMALIZATION",(function(){return xg.getBool("WEBGL_PACK")})),xg.registerFlag("WEBGL_PACK_CLIP",(function(){return xg.getBool("WEBGL_PACK")})),xg.registerFlag("WEBGL_PACK_DEPTHWISECONV",(function(){return xg.getBool("WEBGL_PACK")})),xg.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(function(){return xg.getBool("WEBGL_PACK")})),xg.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(function(){return xg.getBool("WEBGL_PACK")})),xg.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(function(){return xg.getBool("WEBGL_PACK")})),xg.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(function(){return xg.getBool("WEBGL_PACK")})),xg.registerFlag("WEBGL_PACK_REDUCE",(function(){return xg.getBool("WEBGL_PACK")})),xg.registerFlag("WEBGL_LAZILY_UNPACK",(function(){return xg.getBool("WEBGL_PACK")})),xg.registerFlag("WEBGL_CONV_IM2COL",(function(){return xg.getBool("WEBGL_PACK")})),xg.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(function(){return function(e){if(null==Zb){var t=Ub(e);Zb=t.getParameter(t.MAX_TEXTURE_SIZE)}return Zb}(xg.getNumber("WEBGL_VERSION"))})),xg.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(function(){return function(e){if(null==Jb){var t=Ub(e);Jb=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Jb)}(xg.getNumber("WEBGL_VERSION"))})),xg.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(function(){var e=xg.getNumber("WEBGL_VERSION");return 0===e?0:function(e){if(0===e)return 0;var t=Ub(e);return mg(t,"EXT_disjoint_timer_query_webgl2")&&2===e?2:mg(t,"EXT_disjoint_timer_query")?1:0}(e)})),xg.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(function(){return xg.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!a.Vd.isMobile()})),xg.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(function(){return function(e){if(0===e)return!1;var t=Ub(e);if(1===e){if(!mg(t,"OES_texture_float"))return!1}else if(!mg(t,"EXT_color_buffer_float"))return!1;return gg(t)}(xg.getNumber("WEBGL_VERSION"))})),xg.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(function(){return!xg.getBool("WEBGL_FORCE_F16_TEXTURES")&&xg.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")})),xg.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(function(){return bg(xg.getNumber("WEBGL_VERSION"))})),xg.registerFlag("WEBGL_FENCE_API_ENABLED",(function(){return 2===(e=xg.getNumber("WEBGL_VERSION"))&&null!=Ub(e).fenceSync;var e})),xg.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(function(){return xg.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0})),xg.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",(function(){return-1}),(function(e){if(e<0&&-1!==e)throw new Error("WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never "+"delete) or at least 0, but got ".concat(e,"."))})),xg.registerFlag("WEBGL_FLUSH_THRESHOLD",(function(){return a.Vd.isMobile()?1:-1}),(function(e){if(e<0&&-1!==e)throw new Error("WEBGL_FLUSH_THRESHOLD must be -1 (indicating never "+"manual flush) or at least 0, but got ".concat(e,"."))})),xg.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",(function(){return 128})),xg.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",(function(){return!1})),xg.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",(function(){return 1e5})),xg.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",(function(){return 128})),xg.registerFlag("WEBGL_EXP_CONV",(function(){return!1})),xg.registerFlag("SOFTWARE_WEBGL_ENABLED",(function(){return xg.getBool("IS_TEST")})),xg.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",(function(){return 1/0})),xg.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",(function(){return!1})),xg.registerFlag("WEBGL2_ISNAN_CUSTOM",(function(){return!1}));var Ng="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n",jg=a.zd.getBroadcastDims;function Tg(e,t,n){var r=[];if(e.forEach((function(e){var t=a.Df.sizeFromShape(e.shapeInfo.logicalShape);if(e.shapeInfo.isUniform?r.push("uniform float ".concat(e.name).concat(t>1?"[".concat(t,"]"):"",";")):(r.push("uniform sampler2D ".concat(e.name,";")),r.push("uniform int offset".concat(e.name,";"))),n.enableShapeUniforms){switch(Kg(n.packedInputs,e.shapeInfo.logicalShape,e.shapeInfo.texShape).uniformShape.length){case 1:r.push("uniform int ".concat(e.name,"Shape;"));break;case 2:r.push("uniform ivec2 ".concat(e.name,"Shape;"));break;case 3:r.push("uniform ivec3 ".concat(e.name,"Shape;"));break;case 4:r.push("uniform ivec4 ".concat(e.name,"Shape;"))}r.push("uniform ivec2 ".concat(e.name,"TexShape;"))}})),n.enableShapeUniforms){switch(t.logicalShape.length){case 1:r.push("uniform int outShape;");break;case 2:r.push("uniform ivec2 outShape;"),r.push("uniform int outShapeStrides;");break;case 3:r.push("uniform ivec3 outShape;"),r.push("uniform ivec2 outShapeStrides;");break;case 4:r.push("uniform ivec4 outShape;"),r.push("uniform ivec3 outShapeStrides;")}r.push("uniform ivec2 outTexShape;")}n.customUniforms&&n.customUniforms.forEach((function(e){r.push("uniform ".concat(e.type," ").concat(e.name).concat(e.arrayIndex?"[".concat(e.arrayIndex,"]"):"",";"))}));var i,o,s=r.join("\n"),u=e.map((function(e){return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0,a="";a+=n?Eg(e,r):Cg(e,r);var i=e.shapeInfo.logicalShape,o=t.logicalShape;i.length<=o.length&&(a+=n?Gg(e,t):Hg(e,t));return a}(e,t,n.packedInputs,n.enableShapeUniforms)})).join("\n"),c=t.texShape,l=kg(),d=function(e){return"\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return ".concat(e.texture2D,"(textureSampler, uv).r;\n    }\n  ")}(l),p=function(e){return"".concat(e.version,"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    ").concat(e.varyingFs," vec2 resultUV;\n    ").concat(e.defineOutput,"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    ").concat(e.defineSpecialNaN,"\n    ").concat(e.defineSpecialInf,"\n    ").concat(e.defineRound,"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    ").concat(_g,"\n    ").concat(Ag,"\n    ").concat(Rg,"\n  ")}(l);return t.isPacked?(i=function(e,t,n){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t,n){var r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(1===r[0])return n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));\n      }\n    ":"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ".concat(r[1],".0);\n      }\n    ");if(1===r[1])return n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));\n      }\n    ":"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ".concat(r[0],".0);\n      }\n    ");if(n)return"\n    int getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);\n    }\n  ";return"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(r[0],", ").concat(r[1],"));\n      return 2 * (resTexRC.x * ").concat(r[1]," + resTexRC.y);\n    }\n  ")}(0,t,n);case 2:return function(e,t,n){var r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(a.Df.arraysEqual(e,t))return n?"\n      ivec2 getOutputCoords() {\n        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2(".concat(r[0],", ").concat(r[1],"));\n      }\n    ");var i=Math.ceil(e[1]/2);if(n)return"\n    ivec2 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec2(r, c);\n    }\n  ";return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(r[0],", ").concat(r[1],"));\n\n      int index = resTexRC.x * ").concat(r[1]," + resTexRC.y;\n      int r = 2 * (index / ").concat(i,");\n      int c = imod(index, ").concat(i,") * 2;\n\n      return ivec2(r, c);\n    }\n  ")}(e,t,n);case 3:return function(e,t,n){if(n)return"\n    ivec3 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";var r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],a=Math.ceil(e[2]/2),i=a*Math.ceil(e[1]/2);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(r[0],", ").concat(r[1],"));\n      int index = resTexRC.x * ").concat(r[1]," + resTexRC.y;\n\n      int b = index / ").concat(i,";\n      index -= b * ").concat(i,";\n\n      int r = 2 * (index / ").concat(a,");\n      int c = imod(index, ").concat(a,") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ")}(e,t,n);default:return function(e,t,n){if(n)return"\n    ivec4 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatchN = texelsInBatch * outShape[1];\n\n      int b2 = index / texelsInBatchN;\n      index -= b2 * texelsInBatchN;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec4(b2, b, r, c);\n    }\n  ";for(var r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],a=Math.ceil(e[e.length-1]/2),i=a*Math.ceil(e[e.length-2]/2),o=i,s="",u="b, r, c",c=2;c<e.length-1;c++)o*=e[e.length-c-1],s="\n      int b".concat(c," = index / ").concat(o,";\n      index -= b").concat(c," * ").concat(o,";\n    ")+s,u="b".concat(c,", ")+u;return"\n    ivec".concat(e.length," getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(").concat(r[0],", ").concat(r[1],"));\n      int index = resTexRC.x * ").concat(r[1]," + resTexRC.y;\n\n      ").concat(s,"\n\n      int b = index / ").concat(i,";\n      index -= b * ").concat(i,";\n\n      int r = 2 * (index / ").concat(a,");\n      int c = imod(index, ").concat(a,") * 2;\n\n      return ivec").concat(e.length,"(").concat(u,");\n    }\n  ")}(e,t,n)}}(t.logicalShape,c,n.enableShapeUniforms),o=function(e){return"\n    void setOutput(vec4 val) {\n      ".concat(e.output," = val;\n    }\n  ")}(l)):(i=function(e,t,n){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t,n){if(1===t[0])return n?"\n      int getOutputCoords() {\n        return int(resultUV.x * float(outTexShape[1]));\n      }\n    ":"\n      int getOutputCoords() {\n        return int(resultUV.x * ".concat(t[1],".0);\n      }\n    ");if(1===t[1])return n?"\n      int getOutputCoords() {\n        return int(resultUV.y * float(outTexShape[0]));\n      }\n    ":"\n      int getOutputCoords() {\n        return int(resultUV.y * ".concat(t[0],".0);\n      }\n    ");if(n)return"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      return resTexRC.x * outTexShape[1] + resTexRC.y;\n    }\n  ";return"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      return resTexRC.x * ").concat(t[1]," + resTexRC.y;\n    }\n  ")}(0,t,n);case 2:return function(e,t,n){if(a.Df.arraysEqual(e,t))return n?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(".concat(t[0],", ").concat(t[1],"));\n      }\n    ");if(1===e[1])return n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(".concat(t[0],", ").concat(t[1],"));\n        int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ");if(1===e[0])return n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(".concat(t[0],", ").concat(t[1],"));\n        int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ");if(n)return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      int r = index / outShape[1];\n      int c = index - r * outShape[1];\n      return ivec2(r, c);\n    }\n  ";return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      int r = index / ").concat(e[1],";\n      int c = index - r * ").concat(e[1],";\n      return ivec2(r, c);\n    }\n  ")}(e,t,n);case 3:return function(e,t,n){if(n){var r=Og(["r","c","d"],e);return"\n  ivec3 getOutputCoords() {\n    ivec2 resTexRC = ivec2(resultUV.yx *\n                           vec2(outTexShape[0], outTexShape[1]));\n    int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n    ".concat(r,"\n    return ivec3(r, c, d);\n  }\n")}var a=wg(["r","c","d"],e);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      ").concat(a,"\n      return ivec3(r, c, d);\n    }\n  ")}(e,t,n);case 4:return function(e,t,n){if(n){var r=Og(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      ".concat(r,"\n      return ivec4(r, c, d, d2);\n    }\n  ")}var a=wg(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      ").concat(a,"\n      return ivec4(r, c, d, d2);\n    }\n  ")}(e,t,n);case 5:return function(e,t){var n=wg(["r","c","d","d2","d3"],e);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2(".concat(t[0],",\n                             ").concat(t[1],"));\n\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n\n      ").concat(n,"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  ")}(e,t);case 6:return function(e,t){var n=wg(["r","c","d","d2","d3","d4"],e);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n\n      ").concat(n,"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  ")}(e,t);default:throw new Error("".concat(e.length,"-D output sampling is not yet supported"))}}(t.logicalShape,c,n.enableShapeUniforms),o=function(e){return"\n    void setOutput(float val) {\n      ".concat(e.output," = vec4(val, 0, 0, 0);\n    }\n  ")}(l)),n.packedInputs&&(p+=Dg),[p,d,o,s,i,u,n.userCode].join("\n")}function Cg(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.shapeInfo.logicalShape;switch(n.length){case 0:return Mg(e,t);case 1:return zg(e,t);case 2:return Lg(e,t);case 3:return Pg(e,t);case 4:return Bg(e,t);case 5:return Wg(e);case 6:return Ug(e);default:throw new Error("".concat(n.length,"-D input sampling")+" is not yet supported")}}function Eg(e,t){switch(e.shapeInfo.logicalShape.length){case 0:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=kg();return"\n    vec4 ".concat(n,"() {\n      return ").concat(r.texture2D,"(").concat(t,", halfCR);\n    }\n  ")}(e);case 1:return function(e,t){var n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=e.shapeInfo.texShape,i=kg();if(t)return"\n    vec4 ".concat(r,"(int index) {\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(n,"TexShape[0]) / 2.0), ceil(float(").concat(n,"TexShape[1]) / 2.0));\n      vec2 uv = packedUVfrom1D(\n        packedTexShape[0], packedTexShape[1], index);\n      return ").concat(i.texture2D,"(").concat(n,", uv);\n    }\n  ");var o=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];return"\n    vec4 ".concat(r,"(int index) {\n      vec2 uv = packedUVfrom1D(\n        ").concat(o[0],", ").concat(o[1],", index);\n      return ").concat(i.texture2D,"(").concat(n,", uv);\n    }\n  ")}(e,t);case 2:return function(e,t){var n=e.shapeInfo.logicalShape,r=e.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),o=e.shapeInfo.texShape,s=o[0],u=o[1],c=kg();if(null!=o&&a.Df.arraysEqual(n,o))return t?"\n      vec4 ".concat(i,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n\n        return ").concat(c.texture2D,"(").concat(r,", uv);\n      }\n    "):"\n      vec4 ".concat(i,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(u,".0, ").concat(s,".0);\n\n        return ").concat(c.texture2D,"(").concat(r,", uv);\n      }\n    ");if(t)return"\n    vec4 ".concat(i,"(int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(r,"TexShape[0]) / 2.0), ceil(float(").concat(r,"TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(").concat(r,"Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);\n      return ").concat(c.texture2D,"(").concat(r,", uv);\n    }\n  ");var l=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)],d=Math.ceil(n[1]/2);return"\n    vec4 ".concat(i,"(int row, int col) {\n      vec2 uv = packedUVfrom2D(").concat(d,", ").concat(l[0],", ").concat(l[1],", row, col);\n      return ").concat(c.texture2D,"(").concat(r,", uv);\n    }\n  ")}(e,t);case 3:return function(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape,o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(1===n[0]){var s=n.slice(1),u=Xg(e,s);return"\n        ".concat(Eg(u,t),"\n        vec4 ").concat(a,"(int b, int row, int col) {\n          return ").concat(a,"(").concat(Yg(["b","row","col"],[1,2]),");\n        }\n      ")}var c=kg();if(t)return"\n    vec4 ".concat(a,"(int b, int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(r,"TexShape[0]) / 2.0), ceil(float(").concat(r,"TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(").concat(r,"Shape[2]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(").concat(r,"Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom3D(\n        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);\n      return ").concat(c.texture2D,"(").concat(r,", uv);\n    }\n  ");var l=o[0],d=o[1],p=Math.ceil(n[2]/2),f=p*Math.ceil(n[1]/2);return"\n    vec4 ".concat(a,"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        ").concat(l,", ").concat(d,", ").concat(f,", ").concat(p,", b, row, col);\n      return ").concat(c.texture2D,"(").concat(r,", uv);\n    }\n  ")}(e,t);default:return function(e,t){var n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=kg();if(t)return"\n    vec4 ".concat(r,"(int b2, int b, int row, int col) {\n      int valuesPerRow = int(ceil(float(").concat(n,"Shape[3]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(").concat(n,"Shape[2]) / 2.0));\n      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);\n      texelsInBatch *= ").concat(n,"Shape[1];\n      index = b2 * texelsInBatch + index;\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(n,"TexShape[0]) / 2.0), ceil(float(").concat(n,"TexShape[1]) / 2.0));\n      int texR = index / packedTexShape[1];\n      int texC = index - texR * packedTexShape[1];\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ").concat(a.texture2D,"(").concat(n,", uv);\n    }\n  ");for(var i=e.shapeInfo.logicalShape,o=i.length,s=e.shapeInfo.texShape,u=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],c=u[0],l=u[1],d=Math.ceil(i[o-1]/2),p=d*Math.ceil(i[o-2]/2),f="int b, int row, int col",h="b * ".concat(p," + (row / 2) * ").concat(d," + (col / 2)"),m=2;m<o-1;m++)f="int b".concat(m,", ")+f,p*=i[o-m-1],h="b".concat(m," * ").concat(p," + ")+h;return"\n    vec4 ".concat(r,"(").concat(f,") {\n      int index = ").concat(h,";\n      int texR = index / ").concat(l,";\n      int texC = index - texR * ").concat(l,";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(l,", ").concat(c,");\n      return ").concat(a.texture2D,"(").concat(n,", uv);\n    }\n  ")}(e,t)}}var _g="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Ag="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Rg="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Dg="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function Fg(e){return"offset".concat(e)}function Mg(e,t){var n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return"float ".concat(r,"() {return ").concat(n,";}");var a=Object(i.a)(e.shapeInfo.texShape,2),o=a[0],s=a[1];if(1===o&&1===s)return"\n      float ".concat(r,"() {\n        return sampleTexture(").concat(n,", halfCR);\n      }\n    ");var u=Fg(n);if(t)return"\n    float ".concat(r,"() {\n      vec2 uv = uvFromFlat(").concat(n,"TexShape[0], ").concat(n,"TexShape[1], ").concat(u,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ");var c=Object(i.a)(e.shapeInfo.texShape,2),l=c[0],d=c[1];return"\n    float ".concat(r,"() {\n      vec2 uv = uvFromFlat(").concat(l,", ").concat(d,", ").concat(u,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}function zg(e,t){var n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int index) {\n        ").concat(Vg(e),"\n      }\n    ");var a=e.shapeInfo.texShape,i=a[0],o=a[1];if(1===o&&1===i)return"\n      float ".concat(r,"(int index) {\n        return sampleTexture(").concat(n,", halfCR);\n      }\n    ");var s=Fg(n);return 1===o?t?"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2(0.5, (float(index + ").concat(s,") + 0.5) / float(").concat(n,"TexShape[0]));\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2(0.5, (float(index + ").concat(s,") + 0.5) / ").concat(i,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):1===i?t?"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2((float(index + ").concat(s,") + 0.5) / float(").concat(n,"TexShape[1]), 0.5);\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2((float(index + ").concat(s,") + 0.5) / ").concat(o,".0, 0.5);\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):t?"\n    float ".concat(r,"(int index) {\n      vec2 uv = uvFromFlat(").concat(n,"TexShape[0], ").concat(n,"TexShape[1], index + ").concat(s,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  "):"\n    float ".concat(r,"(int index) {\n      vec2 uv = uvFromFlat(").concat(i,", ").concat(o,", index + ").concat(s,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}function Lg(e,t){var n=e.shapeInfo.logicalShape,r=e.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),o=e.shapeInfo.texShape;if(null!=o&&a.Df.arraysEqual(n,o)){if(t)return"\n      float ".concat(i,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    ");var s=o[0],u=o[1];return"\n    float ".concat(i,"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(u,".0, ").concat(s,".0);\n      return sampleTexture(").concat(r,", uv);\n    }\n  ")}var c=a.Df.squeezeShape(n),l=c.newShape,d=c.keptDims,p=l;if(p.length<n.length){var f=Xg(e,p);return"\n      ".concat(Cg(f,t),"\n      float ").concat(i,"(int row, int col) {\n        return ").concat(i,"(").concat(Yg(["row","col"],d),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(i,"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2(").concat(n[1],", 1)));\n        ").concat(Vg(e),"\n      }\n    ");var h=o[0],m=o[1],v=Fg(r);return 1===m?t?"\n      float ".concat(i,"(int row, int col) {\n        float index = dot(vec3(row, col, ").concat(v,"), vec3(").concat(r,"Shape[1], 1, 1));\n        vec2 uv = vec2(0.5, (index + 0.5) / float(").concat(r,"TexShape[0]));\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n    float ".concat(i,"(int row, int col) {\n      float index = dot(vec3(row, col, ").concat(v,"), vec3(").concat(n[1],", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / ").concat(h,".0);\n      return sampleTexture(").concat(r,", uv);\n    }\n  "):1===h?t?"\n      float ".concat(i,"(int row, int col) {\n        float index = dot(vec3(row, col, ").concat(v,"), vec3(").concat(r,"Shape[1], 1, 1));\n        vec2 uv = vec2((index + 0.5) / float(").concat(r,"TexShape[1]), 0.5);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n    float ".concat(i,"(int row, int col) {\n      float index = dot(vec3(row, col, ").concat(v,"), vec3(").concat(n[1],", 1, 1));\n      vec2 uv = vec2((index + 0.5) / ").concat(m,".0, 0.5);\n      return sampleTexture(").concat(r,", uv);\n    }\n  "):t?"\n      float ".concat(i,"(int row, int col) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ").concat(r,"Shape[1] + col + ").concat(v,";\n        vec2 uv = uvFromFlat(").concat(r,"TexShape[0], ").concat(r,"TexShape[1], index);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n  float ".concat(i,"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * ").concat(n[1]," + col + ").concat(v,";\n    vec2 uv = uvFromFlat(").concat(h,", ").concat(m,", index);\n    return sampleTexture(").concat(r,", uv);\n  }\n")}function Pg(e,t){var n=e.shapeInfo.logicalShape,r=e.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),o=n[1]*n[2],s=n[2],u=a.Df.squeezeShape(n),c=u.newShape,l=u.keptDims,d=c;if(d.length<n.length){var p=Xg(e,d);return"\n        ".concat(Cg(p,t),"\n        float ").concat(i,"(int row, int col, int depth) {\n          return ").concat(i,"(").concat(Yg(["row","col","depth"],l),");\n        }\n      ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(i,"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3(").concat(o,", ").concat(s,", 1)));\n        ").concat(Vg(e),"\n      }\n    ");var f=e.shapeInfo.texShape,h=f[0],m=f[1],v=e.shapeInfo.flatOffset;if(m===o&&null==v)return t?"\n      float ".concat(i,"(int row, int col, int depth) {\n        int stride1 = ").concat(r,"Shape[2];\n        float texR = float(row);\n        float texC = dot(vec2(col, depth), vec2(stride1, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n        float ".concat(i,"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2(").concat(s,", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2(").concat(m,".0, ").concat(h,".0);\n          return sampleTexture(").concat(r,", uv);\n        }\n      ");if(m===s&&null==v)return t?"\n      float ".concat(i,"(int row, int col, int depth) {\n        float texR = dot(vec2(row, col), vec2(").concat(r,"Shape[1], 1));\n        float texC = float(depth);\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n    float ".concat(i,"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2(").concat(n[1],", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(m,".0, ").concat(h,".0);\n      return sampleTexture(").concat(r,", uv);\n    }\n  ");var b=Fg(r);return t?"\n    float ".concat(i,"(int row, int col, int depth) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int stride0 = ").concat(r,"Shape[1] * ").concat(r,"Shape[2];\n      int stride1 = ").concat(r,"Shape[2];\n      int index = row * stride0 + col * stride1 + depth + ").concat(b,";\n      vec2 uv = uvFromFlat(").concat(r,"TexShape[0], ").concat(r,"TexShape[1], index);\n      return sampleTexture(").concat(r,", uv);\n    }\n    "):"\n      float ".concat(i,"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ").concat(o," + col * ").concat(s," + depth + ").concat(b,";\n        vec2 uv = uvFromFlat(").concat(h,", ").concat(m,", index);\n        return sampleTexture(").concat(r,", uv);\n      }\n  ")}function Bg(e,t){var n=e.shapeInfo.logicalShape,r=e.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),o=n[3],s=n[2]*o,u=n[1]*s,c=a.Df.squeezeShape(n),l=c.newShape,d=c.keptDims;if(l.length<n.length){var p=Xg(e,l);return"\n      ".concat(Cg(p,t),"\n      float ").concat(i,"(int row, int col, int depth, int depth2) {\n        return ").concat(i,"(").concat(Yg(["row","col","depth","depth2"],d),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(i,"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4(").concat(u,", ").concat(s,", ").concat(o,", 1)));\n        ").concat(Vg(e),"\n      }\n    ");var f=e.shapeInfo.flatOffset,h=e.shapeInfo.texShape,m=h[0],v=h[1],b="int stride2 = ".concat(r,"Shape[3];"),g="int stride1 = ".concat(r,"Shape[2] * stride2;"),y="int stride0 = ".concat(r,"Shape[1] * stride1;");if(v===u&&null==f)return t?"\n      float ".concat(i,"(int row, int col, int depth, int depth2) {\n        ").concat(b,"\n        ").concat(g,"\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(stride1, stride2, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n      float ".concat(i,"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(").concat(s,", ").concat(o,", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(v,".0, ").concat(m,".0);\n        return sampleTexture(").concat(r,", uv);\n      }\n    ");if(v===o&&null==f)return t?"\n      float ".concat(i,"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(").concat(r,"Shape[1] * ").concat(r,"Shape[2], ").concat(r,"Shape[2], 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n      float ".concat(i,"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(").concat(n[1]*n[2],", ").concat(n[2],", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(v,".0, ").concat(m,".0);\n        return sampleTexture(").concat(r,", uv);\n      }\n    ");var x=Fg(r);return t?"\n    float ".concat(i,"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      ").concat(b,"\n      ").concat(g,"\n      ").concat(y,"\n      int index = row * stride0 + col * stride1 +\n          depth * stride2 + depth2;\n      vec2 uv = uvFromFlat(").concat(r,"TexShape[0], ").concat(r,"TexShape[1], index + ").concat(x,");\n      return sampleTexture(").concat(r,", uv);\n    }\n  "):"\n    float ".concat(i,"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(u," + col * ").concat(s," +\n          depth * ").concat(o," + depth2;\n      vec2 uv = uvFromFlat(").concat(m,", ").concat(v,", index + ").concat(x,");\n      return sampleTexture(").concat(r,", uv);\n    }\n  ")}function Wg(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=t[4],o=t[3]*i,s=t[2]*o,u=t[1]*s,c=a.Df.squeezeShape(t),l=c.newShape,d=c.keptDims;if(l.length<t.length){var p=Xg(e,l);return"\n      ".concat(Cg(p),"\n      float ").concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        return ").concat(r,"(").concat(Yg(["row","col","depth","depth2","depth3"],d),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(u,", ").concat(s,", ").concat(o,", ").concat(i,")) +\n          depth3;\n        ").concat(Vg(e),"\n      }\n    ");var f=e.shapeInfo.flatOffset,h=e.shapeInfo.texShape,m=h[0],v=h[1];if(v===u&&null==f)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4(").concat(s,", ").concat(o,", ").concat(i,", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(v,".0, ").concat(m,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(v===i&&null==f)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(t[1]*t[2]*t[3],",\n               ").concat(t[2]*t[3],", ").concat(t[3],", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(v,".0, ").concat(m,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");var b=Fg(n);return"\n    float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(u," + col * ").concat(s," + depth * ").concat(o," +\n          depth2 * ").concat(i," + depth3 + ").concat(b,";\n      vec2 uv = uvFromFlat(").concat(m,", ").concat(v,", index);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}function Ug(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=a.Df.squeezeShape(t),o=i.newShape,s=i.keptDims;if(o.length<t.length){var u=Xg(e,o);return"\n      ".concat(Cg(u),"\n      float ").concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return ").concat(r,"(").concat(Yg(["row","col","depth","depth2","depth3","depth4"],s),");\n      }\n    ")}var c=t[5],l=t[4]*c,d=t[3]*l,p=t[2]*d,f=t[1]*p;if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(f,", ").concat(p,", ").concat(d,", ").concat(l,")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2(").concat(c,", 1)));\n        ").concat(Vg(e),"\n      }\n    ");var h=e.shapeInfo.flatOffset,m=e.shapeInfo.texShape,v=m[0],b=m[1];if(b===f&&null==h)return"\n      float ".concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4(").concat(p,", ").concat(d,", ").concat(l,", ").concat(c,")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(b,".0, ").concat(v,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(b===c&&null==h)return"\n      float ".concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4(").concat(t[1]*t[2]*t[3]*t[4],",\n               ").concat(t[2]*t[3]*t[4],",\n               ").concat(t[3]*t[4],",\n               ").concat(t[4],")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(b,".0, ").concat(v,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");var g=Fg(n);return"\n    float ".concat(r,"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(f," + col * ").concat(p," + depth * ").concat(d," +\n          depth2 * ").concat(l," + depth3 * ").concat(c," + depth4 + ").concat(g,";\n      vec2 uv = uvFromFlat(").concat(v,", ").concat(b,", index);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}function Vg(e){var t=e.name,n=a.Df.sizeFromShape(e.shapeInfo.logicalShape);return n<2?"return ".concat(t,";"):"\n    for (int i = 0; i < ".concat(n,"; i++) {\n      if (i == index) {\n        return ").concat(t,"[i];\n      }\n    }\n  ")}function Gg(e,t){var n,r=e.name,i=r.charAt(0).toUpperCase()+r.slice(1),o="get"+i+"AtOutCoords",s=e.shapeInfo.logicalShape.length,u=t.logicalShape.length,c=jg(e.shapeInfo.logicalShape,t.logicalShape),l=qg(u),d=u-s,p=["x","y","z","w","u","v"];n=0===s?"":u<2&&c.length>=1?"coords = 0;":c.map((function(e){return"coords.".concat(p[e+d]," = 0;")})).join("\n");var f="";f=u<2&&s>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords.".concat(p[t+d])})).join(", ");var h="return outputValue;",m=1===a.Df.sizeFromShape(e.shapeInfo.logicalShape),v=1===a.Df.sizeFromShape(t.logicalShape);if(1!==s||m||v){if(m&&!v)h=1===u?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(c.length){var b=s-2,g=s-1;c.indexOf(b)>-1&&c.indexOf(g)>-1?h="return vec4(outputValue.x);":c.indexOf(b)>-1?h="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":c.indexOf(g)>-1&&(h="return vec4(outputValue.xx, outputValue.zz);")}}else h="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 ".concat(o,"() {\n      ").concat(l," coords = getOutputCoords();\n      ").concat(n,"\n      vec4 outputValue = get").concat(i,"(").concat(f,");\n      ").concat(h,"\n    }\n  ")}function Hg(e,t){var n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),i="get"+r+"AtOutCoords",o=t.texShape,s=e.shapeInfo.texShape,u=e.shapeInfo.logicalShape.length,c=t.logicalShape.length;if(!e.shapeInfo.isUniform&&u===c&&null==e.shapeInfo.flatOffset&&a.Df.arraysEqual(s,o))return"\n      float ".concat(i,"() {\n        return sampleTexture(").concat(n,", resultUV);\n      }\n    ");var l,d=qg(c),p=jg(e.shapeInfo.logicalShape,t.logicalShape),f=c-u,h=["x","y","z","w","u","v"];l=0===u?"":c<2&&p.length>=1?"coords = 0;":p.map((function(e){return"coords.".concat(h[e+f]," = 0;")})).join("\n");var m="";return m=c<2&&u>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords.".concat(h[t+f])})).join(", "),"\n    float ".concat(i,"() {\n      ").concat(d," coords = getOutputCoords();\n      ").concat(l,"\n      return get").concat(r,"(").concat(m,");\n    }\n  ")}function qg(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error("GPU for rank ".concat(e," is not yet supported"))}function Kg(e,t,n){var r=a.Df.squeezeShape(t),i=r.newShape,o=r.keptDims,s=t.length,u=e&&3===s&&1===t[0],c=u?t.slice(1):i,l=!e&&s>1&&!a.Df.arraysEqual(t,n)&&i.length<s||u;return{useSqueezeShape:l,uniformShape:l?c:t,keptDims:o}}function Xg(e,t){var n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function Yg(e,t){return t.map((function(t){return e[t]})).join(", ")}function Zg(e,t,n,r){var i=n.map((function(e,n){var r={logicalShape:e.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform,isPacked:!e.isUniform&&e.texData.isPacked,flatOffset:null};return null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0&&(r.flatOffset=e.texData.slice.flatOffset),{name:t.variableNames[n],shapeInfo:r}})),o=i.map((function(e){return e.shapeInfo})),s={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},u=Tg(i,s,t),c=function(e,t){var n=ug(e,(function(){return e.createShader(e.FRAGMENT_SHADER)}),"Unable to create fragment WebGLShader.");if(Kb(e,(function(){return e.shaderSource(n,t)})),Kb(e,(function(){return e.compileShader(n)})),Object(a.be)().get("ENGINE_COMPILE_ONLY"))return n;if(!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw $b(t,e.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}(e.gl,u),l=e.createProgram(c);return Object(a.be)().get("ENGINE_COMPILE_ONLY")?{program:t,fragmentShader:c,source:u,webGLProgram:l,inShapeInfos:o,outShapeInfo:s,uniformLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,inShapesLocations:null,inTexShapesLocations:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:Object.assign({program:t,fragmentShader:c,source:u,webGLProgram:l,inShapeInfos:o,outShapeInfo:s},Jg(e,t,l))}function Jg(e,t,n){var r,i,o,s,u={},c={},l={},d=[],p=null;s=e.getUniformLocation(n,"NAN",!1),1===Object(a.be)().getNumber("WEBGL_VERSION")&&(p=e.getUniformLocation(n,"INFINITY",!1));for(var f=0;f<t.variableNames.length;f++){var h=t.variableNames[f];u[h]=e.getUniformLocation(n,h,!1),u["offset".concat(h)]=e.getUniformLocation(n,"offset".concat(h),!1),t.enableShapeUniforms&&(c["".concat(h,"Shape")]=e.getUniformLocation(n,"".concat(h,"Shape"),!1),l["".concat(h,"TexShape")]=e.getUniformLocation(n,"".concat(h,"TexShape"),!1))}return t.enableShapeUniforms&&(r=e.getUniformLocation(n,"outShape",!1),o=e.getUniformLocation(n,"outShapeStrides",!1),i=e.getUniformLocation(n,"outTexShape",!1)),t.customUniforms&&t.customUniforms.forEach((function(t,r){d[r]=e.getUniformLocation(n,t.name,!1)})),{uniformLocations:u,customUniformLocations:d,infLoc:p,nanLoc:s,inShapesLocations:c,inTexShapesLocations:l,outShapeLocation:r,outShapeStridesLocation:o,outTexShapeLocation:i}}function Qg(e,t){if(e.length!==t.length)throw Error("Binary was compiled with ".concat(e.length," inputs, but ")+"was executed with ".concat(t.length," inputs"));e.forEach((function(e,n){var r=e.logicalShape,i=t[n],o=i.shape;if(!a.Df.arraysEqual(r,o))throw Error("Binary was compiled with different shapes than "+"the current args. Shapes ".concat(r," and ").concat(o," must match"));if(!e.isUniform||!i.isUniform){var s=e.texShape,u=i.isUniform?null:i.texData.texShape;if(!a.Df.arraysEqual(s,u))throw Error("Binary was compiled with different texture shapes than the"+" current args. Shape ".concat(s," and ").concat(u," must match"))}}))}function $g(e,t,n,r,i){t.program.enableShapeUniforms||(Qg(t.inShapeInfos,n),Qg([t.outShapeInfo],[r]));var o=r.texData.texture,s=r.texData.texShape;r.texData.isPacked?e.setOutputPackedMatrixTexture(o.texture,s[0],s[1]):e.setOutputMatrixTexture(o.texture,s[0],s[1]),e.setProgram(t.webGLProgram),1===Object(a.be)().getNumber("WEBGL_VERSION")&&null!==t.infLoc&&e.gl.uniform1f(t.infLoc,1/0),null!==t.nanLoc&&e.gl.uniform1f(t.nanLoc,NaN),n.forEach((function(n,r){var i=t.program.variableNames[r],o=t.uniformLocations[i],s=t.uniformLocations["offset".concat(i)],u=t.inShapesLocations["".concat(i,"Shape")],c=t.inTexShapesLocations["".concat(i,"TexShape")];if(u){var l=Kg(t.program.packedInputs,n.shape,n.texData.texShape).uniformShape;switch(l.length){case 1:e.gl.uniform1iv(u,new Int32Array(l));break;case 2:e.gl.uniform2iv(u,new Int32Array(l));break;case 3:e.gl.uniform3iv(u,new Int32Array(l));break;case 4:e.gl.uniform4iv(u,new Int32Array(l))}}if(c&&e.gl.uniform2i(c,n.texData.texShape[0],n.texData.texShape[1]),null!=o)if(n.isUniform)if(a.Df.sizeFromShape(n.shape)<2)e.gl.uniform1f(o,n.uniformValues[0]);else{var d=n.uniformValues;d instanceof Float32Array||(d=new Float32Array(d)),e.gl.uniform1fv(o,d)}else null!=n.texData.slice&&null!=s&&e.gl.uniform1i(s,n.texData.slice.flatOffset),e.setInputMatrixTexture(n.texData.texture.texture,o,r)}));var u=t.outShapeLocation;if(u)switch(r.shape.length){case 1:e.gl.uniform1iv(u,new Int32Array(r.shape));break;case 2:e.gl.uniform2iv(u,new Int32Array(r.shape));break;case 3:e.gl.uniform3iv(u,new Int32Array(r.shape));break;case 4:e.gl.uniform4iv(u,new Int32Array(r.shape))}if(t.outShapeStridesLocation){var c=a.Df.computeStrides(r.shape);switch(r.shape.length){case 2:e.gl.uniform1iv(t.outShapeStridesLocation,new Int32Array(c));break;case 3:e.gl.uniform2iv(t.outShapeStridesLocation,new Int32Array(c));break;case 4:e.gl.uniform3iv(t.outShapeStridesLocation,new Int32Array(c))}}t.outTexShapeLocation&&e.gl.uniform2i(t.outTexShapeLocation,r.texData.texShape[0],r.texData.texShape[1]),t.program.customUniforms&&i&&t.program.customUniforms.forEach((function(n,r){var a=t.customUniformLocations[r],o=i[r];if("float"===n.type)e.gl.uniform1fv(a,o);else if("vec2"===n.type)e.gl.uniform2fv(a,o);else if("vec3"===n.type)e.gl.uniform3fv(a,o);else if("vec4"===n.type)e.gl.uniform4fv(a,o);else if("int"===n.type)e.gl.uniform1iv(a,o);else if("ivec2"===n.type)e.gl.uniform2iv(a,o);else if("ivec3"===n.type)e.gl.uniform3iv(a,o);else{if("ivec4"!==n.type)throw Error("uniform type ".concat(n.type," is not supported yet."));e.gl.uniform4iv(a,o)}})),e.executeProgram()}function ey(e,t,n){var r="";t.concat(n).forEach((function(t){var i=null!=t.texData&&null!=t.texData.slice&&t.texData.slice.flatOffset>0;if(e.enableShapeUniforms&&!t.isUniform){var o=t.texData.texShape,s=Kg(e.packedInputs,t.shape,o),u=s.useSqueezeShape,c=s.uniformShape,l=s.keptDims,d="",p="",f="";if(1===c.length&&e.packedInputs){var h=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];d="".concat(h[0]>1,"_").concat(h[1]>1)}else if(2!==c.length||e.packedInputs){if(c.length>2&&!e.packedInputs){var m=a.Df.computeStrides(c);f="".concat(m[0]===o[1],"_").concat(m[m.length-1]===o[1])}}else p="".concat(c[0]>1,"_").concat(c[1]>1);var v=t.shape.length,b=2===c.length&&a.Df.arraysEqual(t.shape,o),g=1===a.Df.sizeFromShape(t.shape),y=a.zd.getBroadcastDims(t.shape,n.shape),x=!e.packedInputs&&v===n.shape.length&&a.Df.arraysEqual(o,n.texData.texShape),k=e.packedInputs||c.length>2?"":"".concat(o[0]>1,"_").concat(o[1]>1);r+="".concat(v,"_").concat(x,"_").concat(u?l:"","_").concat(c.length,"_").concat(g,"_").concat(y,"_").concat(b,"_").concat(d,"_").concat(p,"_").concat(f,"_").concat(k,"_").concat(i)}else{var w=t.isUniform?"uniform":t.texData.texShape;r+="".concat(t.shape,"_").concat(w,"_").concat(i)}}));var i=e.userCode,o=e.constructor.name;return o+="_"+r+"_"+i+"".concat(Object(a.be)().getNumber("WEBGL_VERSION"))}function ty(e){return Object(a.be)().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&e<=4}var ny=function e(t){Object($r.a)(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=zb.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];var n=kg();this.outputShape=t,this.enableShapeUniforms=ty(this.outputShape.length),this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ".concat(this.enableShapeUniforms?Og(["r","c","d"],t):wg(["r","c","d"],t),"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        ").concat(n.output," = result;\n      }\n    ")},ry=function e(t){Object($r.a)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=zb.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];var n=kg();this.outputShape=t,this.enableShapeUniforms=ty(this.outputShape.length),this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ".concat(this.enableShapeUniforms?Og(["r","c","d"],t):wg(["r","c","d"],t),"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        ").concat(n.output," = result;\n      }\n    ")},ay=function e(t){Object($r.a)(this,e),this.variableNames=["A"],this.outTexUsage=Lb.DOWNLOAD;var n=kg();this.outputShape=t,this.userCode="\n      ".concat(Ng,"\n\n      void main() {\n        float x = getAAtOutCoords();\n        ").concat(n.output," = encode_float(x);\n      }\n    ")},iy=function e(t){Object($r.a)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Lb.DOWNLOAD;var n=kg();this.outputShape=t,this.userCode="\n      ".concat(Ng,"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        ").concat(n.output," = encode_float(x);\n      }\n    ")},oy=function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Object($r.a)(this,e),this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];var r=kg();this.outputShape=t,this.enableShapeUniforms=ty(this.outputShape.length);var a="result";n&&(a="floor(result * 255. + 0.5)"),this.userCode="\n      ".concat(this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":Sg(t),"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n\n        int r = flatIndex / texShape[1];\n        int c = imod(flatIndex, texShape[1]);\n        vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n        vec4 values = ").concat(r.texture2D,"(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        ").concat(r.output," = vec4(").concat(a,", 0., 0., 0.);\n      }\n    ")},sy=function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Object($r.a)(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];var r=kg();this.outputShape=t,this.enableShapeUniforms=ty(this.outputShape.length);var a="",i="result";n&&(i="floor(result * 255. + 0.5)");for(var o=0;o<=1;o++)for(var s=0;s<=1;s++){var u=2*o+s;a+="\n          localCoords = coords;\n          if(localCoords[2] + ".concat(s," < ").concat(this.enableShapeUniforms?"outShape[2]":"".concat(t[2]),") {\n          localCoords[2] += ").concat(s,";\n          if (localCoords[1] + ").concat(o," < ").concat(this.enableShapeUniforms?"outShape[1]":"".concat(t[1]),") {\n            localCoords[1] += ").concat(o,";\n\n            flatIndex = getFlatIndex(localCoords);\n            offset = imod(flatIndex, 4);\n\n            flatIndex = idiv(flatIndex, 4, 1.);\n\n            int r = flatIndex / texShape[1];\n            int c = imod(flatIndex, texShape[1]);\n            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n            values = ").concat(r.texture2D,"(A, uv);\n\n            if (offset == 0) {\n              result[").concat(u,"] = values[0];\n            } else if (offset == 1) {\n              result[").concat(u,"] = values[1];\n            } else if (offset == 2) {\n              result[").concat(u,"] = values[2];\n            } else {\n              result[").concat(u,"] = values[3];\n            }\n          }\n        }\n        ")}this.userCode="\n        ".concat(this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":Sg(t),"\n\n        void main() {\n          ivec3 coords = getOutputCoords();\n\n          vec4 result = vec4(0.);\n          int flatIndex, r, c, offset;\n          ivec3 localCoords;\n          vec2 uv;\n          vec4 values;\n\n          ").concat(a,"\n\n          ").concat(r.output," = ").concat(i,";\n        }\n    ")};function uy(e){var t=kg();return function(e,t){var n=ug(e,(function(){return e.createShader(e.VERTEX_SHADER)}),"Unable to create vertex WebGLShader.");if(Kb(e,(function(){return e.shaderSource(n,t)})),Kb(e,(function(){return e.compileShader(n)})),!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}(e,"".concat(t.version,"\n    precision highp float;\n    ").concat(t.attribute," vec3 clipSpacePos;\n    ").concat(t.attribute," vec2 uv;\n    ").concat(t.varyingVs," vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }"))}function cy(e){return function(e,t){var n=ug(e,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return Kb(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,n)})),Kb(e,(function(){return e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW)})),n}(e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function ly(e){return function(e,t){var n=ug(e,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return Kb(e,(function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n)})),Kb(e,(function(){return e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW)})),n}(e,new Uint16Array([0,1,2,2,1,3]))}function dy(e,t,n,r,i,o){!function(e,t){var n=Object(a.be)().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0){var r="[".concat(e,"x").concat(t,"]");throw new Error("Requested texture size "+r+" is invalid.")}if(e>n||t>n){var i="[".concat(e,"x").concat(t,"]"),o="[".concat(n,"x").concat(n,"]");throw new Error("Requested texture size "+i+" greater than WebGL maximum on this browser / GPU "+o+".")}}(t,n);var s=function(e){return ug(e,(function(){return e.createTexture()}),"Unable to create WebGLTexture.")}(e),u=e.TEXTURE_2D;return Kb(e,(function(){return e.bindTexture(u,s)})),Kb(e,(function(){return e.texParameteri(u,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)})),Kb(e,(function(){return e.texParameteri(u,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)})),Kb(e,(function(){return e.texParameteri(u,e.TEXTURE_MIN_FILTER,e.NEAREST)})),Kb(e,(function(){return e.texParameteri(u,e.TEXTURE_MAG_FILTER,e.NEAREST)})),1===Object(a.be)().getNumber("WEBGL_VERSION")?Kb(e,(function(){return e.texImage2D(u,0,r,t,n,0,i,o,null)})):Kb(e,(function(){return e.texStorage2D(u,1,r,t,n)})),Kb(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)})),{texture:s,texShape:[n,t]}}function py(e){return e.internalFormatFloat}function fy(e){return e.internalFormatHalfFloat}function hy(e){return e.downloadTextureFormat}function my(e){return e.internalFormatPackedFloat}function vy(e){return e.internalFormatPackedHalfFloat}function by(e,t,n,r,a,o,s,u){var c=e,l=new Float32Array(function(e,t){var n=Hb(e,t),r=Object(i.a)(n,2);return r[0]*r[1]*4}(o,s));return c.bindBuffer(c.PIXEL_PACK_BUFFER,t),c.getBufferSubData(c.PIXEL_PACK_BUFFER,0,l),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),l}var gy=function(){function e(t){Object($r.a)(this,e),this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var n=Object(a.be)().getNumber("WEBGL_VERSION");null!=t?(this.gl=t,function(e,t){Bb[e]=t}(n,t)):this.gl=Ub(n);var r="WEBGL_color_buffer_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),1===Object(a.be)().getNumber("WEBGL_VERSION")){if(this.textureFloatExtension=Yb(this.gl,"OES_texture_float"),mg(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=Yb(this.gl,"OES_texture_half_float");else if(Object(a.be)().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),mg(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=Yb(this.gl,"EXT_color_buffer_half_float");else if(Object(a.be)().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",mg(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else{if(!mg(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=cy(this.gl),this.indexBuffer=ly(this.gl),this.framebuffer=function(e){return ug(e,(function(){return e.createFramebuffer()}),"Unable to create WebGLFramebuffer.")}(this.gl),this.textureConfig=qb(this.gl,this.textureHalfFloatExtension)}return Object(ea.a)(e,[{key:"dispose",value:function(){var e=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;Kb(t,(function(){return t.finish()})),Kb(t,(function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)})),Kb(t,(function(){return t.deleteFramebuffer(e.framebuffer)})),Kb(t,(function(){return t.bindBuffer(t.ARRAY_BUFFER,null)})),Kb(t,(function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)})),Kb(t,(function(){return t.deleteBuffer(e.indexBuffer)})),this.disposed=!0}}},{key:"createFloat32MatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=Vb(t,n),o=Object(i.a)(a,2);return dy(e,o[0],o[1],py(r),r.textureFormatFloat,e.FLOAT)}(this.gl,e,t,this.textureConfig)}},{key:"createFloat16MatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=Vb(t,n),o=Object(i.a)(a,2);return dy(e,o[0],o[1],fy(r),r.textureFormatFloat,r.textureTypeHalfFloat)}(this.gl,e,t,this.textureConfig)}},{key:"createUnsignedBytesMatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=Vb(t,n),o=Object(i.a)(a,2);return dy(e,o[0],o[1],hy(r),e.RGBA,e.UNSIGNED_BYTE)}(this.gl,e,t,this.textureConfig)}},{key:"uploadPixelDataToTexture",value:function(e,t){this.throwIfDisposed(),function(e,t,n){Kb(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)})),n.data instanceof Uint8Array?2===Object(a.be)().getNumber("WEBGL_VERSION")?Kb(e,(function(){return e.texSubImage2D(e.TEXTURE_2D,0,0,0,n.width,n.height,e.RGBA,e.UNSIGNED_BYTE,n.data)})):Kb(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n.width,n.height,0,e.RGBA,e.UNSIGNED_BYTE,n.data)})):2===Object(a.be)().getNumber("WEBGL_VERSION")?Kb(e,(function(){return e.texSubImage2D(e.TEXTURE_2D,0,0,0,e.RGBA,e.UNSIGNED_BYTE,n)})):Kb(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n)})),Kb(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}(this.gl,e,t)}},{key:"uploadDenseMatrixToTexture",value:function(e,t,n,r){this.throwIfDisposed(),function(e,t,n,r,i,o){var s,u,c;Kb(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)})),i instanceof Uint8Array?(s=new Uint8Array(n*r*4),u=e.UNSIGNED_BYTE,c=e.RGBA):(s=new Float32Array(n*r*4),u=e.FLOAT,c=o.internalFormatPackedFloat),s.set(i),2===Object(a.be)().getNumber("WEBGL_VERSION")?Kb(e,(function(){return e.texSubImage2D(e.TEXTURE_2D,0,0,0,n,r,e.RGBA,u,s)})):Kb(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,c,n,r,0,e.RGBA,u,s)})),Kb(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}(this.gl,e,t,n,r,this.textureConfig)}},{key:"createFloat16PackedMatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=Hb(t,n),o=Object(i.a)(a,2);return dy(e,o[0],o[1],vy(r),e.RGBA,r.textureTypeHalfFloat)}(this.gl,e,t,this.textureConfig)}},{key:"createPackedMatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=Hb(t,n),o=Object(i.a)(a,2);return dy(e,o[0],o[1],my(r),e.RGBA,e.FLOAT)}(this.gl,e,t,this.textureConfig)}},{key:"deleteMatrixTexture",value:function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(og(this.gl,this.framebuffer),this.outputTexture=null),Kb(this.gl,(function(){return t.gl.deleteTexture(e)}))}},{key:"downloadByteEncodedFloatMatrixFromOutputTexture",value:function(e,t,n){var r=this;return this.downloadMatrixDriver(e,(function(){return function(e,t,n,r){var a=Vb(t,n),o=Object(i.a)(a,2),s=o[0],u=o[1],c=new Uint8Array(t*n*4);return Kb(e,(function(){return e.readPixels(0,0,s,u,r.downloadTextureFormat,e.UNSIGNED_BYTE,c)})),new Float32Array(c.buffer)}(r.gl,t,n,r.textureConfig)}))}},{key:"downloadPackedMatrixFromBuffer",value:function(e,t,n,r,a,i){return by(this.gl,e,0,0,0,a,i,this.textureConfig)}},{key:"downloadFloat32MatrixFromBuffer",value:function(e,t){return function(e,t,n){var r=e,a=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,a),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),a}(this.gl,e,t)}},{key:"createBufferFromTexture",value:function(e,t,n){this.bindTextureToFrameBuffer(e);var r=function(e,t,n,r){var a=e.createBuffer();Kb(e,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,a)}));var i=16*t*n;return Kb(e,(function(){return e.bufferData(e.PIXEL_PACK_BUFFER,i,e.STREAM_READ)})),Kb(e,(function(){return e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,0)})),Kb(e,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,null)})),a}(this.gl,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}},{key:"createAndWaitForFence",value:function(){var e=this.createFence(this.gl);return this.pollFence(e)}},{key:"createFence",value:function(e){var t,n,r=this;if(Object(a.be)().getBool("WEBGL_FENCE_API_ENABLED")){var i=e,o=i.fenceSync(i.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=function(){var e=i.clientWaitSync(o,0,0);return e===i.ALREADY_SIGNALED||e===i.CONDITION_SATISFIED},t=o}else Object(a.be)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=function(){return r.isQueryAvailable(t,Object(a.be)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:t,isFencePassed:n}}},{key:"downloadMatrixFromPackedTexture",value:function(e,t,n){var r=this;return this.downloadMatrixDriver(e,(function(){return function(e,t,n){var r=new Float32Array(t*n*4);return Kb(e,(function(){return e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,r)})),r}(r.gl,t,n)}))}},{key:"createProgram",value:function(e){var t=this;this.throwIfDisposed();var n=this.gl;null==this.vertexShader&&(this.vertexShader=uy(n));var r=function(e){return ug(e,(function(){return e.createProgram()}),"Unable to create WebGLProgram.")}(n);return Kb(n,(function(){return n.attachShader(r,t.vertexShader)})),Kb(n,(function(){return n.attachShader(r,e)})),function(e,t){if(Kb(e,(function(){return e.linkProgram(t)})),!Object(a.be)().get("ENGINE_COMPILE_ONLY")&&!1===e.getProgramParameter(t,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}(n,r),this.debug&&eg(n,r),this.vertexAttrsAreBound||(this.setProgram(r),this.vertexAttrsAreBound=function(e,t,n){return Kb(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,n)})),tg(e,t,"clipSpacePos",n,3,20,0)&&tg(e,t,"uv",n,2,20,12)}(n,this.program,this.vertexBuffer)),r}},{key:"deleteProgram",value:function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&Kb(this.gl,(function(){return t.gl.deleteProgram(e)}))}},{key:"setProgram",value:function(e){var t=this;this.throwIfDisposed(),this.program=e,null!=this.program&&this.debug&&eg(this.gl,this.program),Kb(this.gl,(function(){return t.gl.useProgram(e)}))}},{key:"getUniformLocation",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this.throwIfDisposed(),n?ng(this.gl,e,t):rg(this.gl,e,t)}},{key:"getAttributeLocation",value:function(e,t){var n=this;return this.throwIfDisposed(),Kb(this.gl,(function(){return n.gl.getAttribLocation(e,t)}))}},{key:"getUniformLocationNoThrow",value:function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}},{key:"setInputMatrixTexture",value:function(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),ag(this.gl,e,t,n)}},{key:"setOutputMatrixTexture",value:function(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)}},{key:"setOutputPackedMatrixTexture",value:function(e,t,n){this.throwIfDisposed();var r=Hb(t,n),a=Object(i.a)(r,2),o=a[0],s=a[1];this.setOutputMatrixTextureDriver(e,o,s)}},{key:"setOutputMatrixWriteRegion",value:function(e,t,n,r){this.setOutputMatrixWriteRegionDriver(n,e,r,t)}},{key:"setOutputPackedMatrixWriteRegion",value:function(e,t,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}},{key:"debugValidate",value:function(){null!=this.program&&eg(this.gl,this.program),sg(this.gl)}},{key:"executeProgram",value:function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),Kb(e,(function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)}))}},{key:"blockUntilAllProgramsCompleted",value:function(){var e=this;this.throwIfDisposed(),Kb(this.gl,(function(){return e.gl.finish()}))}},{key:"getQueryTimerExtension",value:function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=Yb(this.gl,2===Object(a.be)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}},{key:"getQueryTimerExtensionWebGL2",value:function(){return this.getQueryTimerExtension()}},{key:"getQueryTimerExtensionWebGL1",value:function(){return this.getQueryTimerExtension()}},{key:"beginQuery",value:function(){if(2===Object(a.be)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}var r=this.getQueryTimerExtensionWebGL1(),i=r.createQueryEXT();return r.beginQueryEXT(r.TIME_ELAPSED_EXT,i),i}},{key:"endQuery",value:function(){if(2!==Object(a.be)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,n=this.getQueryTimerExtensionWebGL2();t.endQuery(n.TIME_ELAPSED_EXT)}}},{key:"waitForQueryAndGetTime",value:function(){var e=Object(Oo.a)(wo.a.mark((function e(t){var n=this;return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.Df.repeatedTry((function(){return n.disposed||n.isQueryAvailable(t,Object(a.be)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}));case 2:return e.abrupt("return",this.getQueryTime(t,Object(a.be)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getQueryTime",value:function(e,t){if(0===t)return null;if(2===t){var n=this.gl;return n.getQueryParameter(e,n.QUERY_RESULT)/1e6}var r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(e,r.QUERY_RESULT_EXT)/1e6}},{key:"isQueryAvailable",value:function(e,t){if(0===t)return!0;if(2===t){var n=this.gl,r=this.getQueryTimerExtensionWebGL2(),a=n.getQueryParameter(e,n.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),a&&!this.disjoint}var i=this.getQueryTimerExtensionWebGL1(),o=i.getQueryObjectEXT(e,i.QUERY_RESULT_AVAILABLE_EXT);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),o&&!this.disjoint}},{key:"pollFence",value:function(e){var t=this;return new Promise((function(n){t.addItemToPoll((function(){return e.isFencePassed()}),(function(){return n()}))}))}},{key:"pollItems",value:function(){for(var e=function(e){for(var t=0;t<e.length;++t){if(!e[t]())break}return t-1}(this.itemsToPoll.map((function(e){return e.isDoneFn}))),t=0;t<=e;++t){(0,this.itemsToPoll[t].resolveFn)()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}},{key:"addItemToPoll",value:function(e,t){var n=this;if(this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),!(this.itemsToPoll.length>1)){var r=void 0;"setTimeoutCustom"in Object(a.be)().platform&&(r=Object(a.be)().platform.setTimeoutCustom.bind(Object(a.be)().platform)),a.Df.repeatedTry((function(){return n.pollItems(),0===n.itemsToPoll.length}),(function(){return 0}),null,r)}}},{key:"bindTextureToFrameBuffer",value:function(e){this.throwIfDisposed(),ig(this.gl,e,this.framebuffer),this.debug&&sg(this.gl)}},{key:"unbindTextureToFrameBuffer",value:function(){null!=this.outputTexture?(ig(this.gl,this.outputTexture,this.framebuffer),this.debug&&sg(this.gl)):og(this.gl,this.framebuffer)}},{key:"downloadMatrixDriver",value:function(e,t){this.bindTextureToFrameBuffer(e);var n=t();return this.unbindTextureToFrameBuffer(),n}},{key:"setOutputMatrixTextureDriver",value:function(e,t,n){this.throwIfDisposed();var r=this.gl;ig(r,e,this.framebuffer),this.debug&&sg(r),this.outputTexture=e,Kb(r,(function(){return r.viewport(0,0,t,n)})),Kb(r,(function(){return r.scissor(0,0,t,n)}))}},{key:"setOutputMatrixWriteRegionDriver",value:function(e,t,n,r){var a=this;this.throwIfDisposed(),Kb(this.gl,(function(){return a.gl.scissor(e,t,n,r)}))}},{key:"throwIfDisposed",value:function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}},{key:"throwIfNoProgram",value:function(){if(null==this.program)throw new Error("No GPU program is currently set.")}},{key:"debug",get:function(){return Object(a.be)().getBool("DEBUG")}}]),e}();var yy=Hd,xy=zp,ky=Lp,wy=Bd,Oy=Wp,Iy=Kp,Sy=_f,Ny=Uf,jy=Kf,Ty=ch,Cy=bh,Ey=yh,_y=kh,Ay=Ih,Ry=Dh,Dy=zh,Fy=Bh,My=Uh,zy=rm,Ly=om,Py=vm,By=Of,Wy=jm,Uy=Fm,Vy=Xm,Gy=$m,Hy=iv,qy=sv,Ky=yv,Xy=wv,Yy=_d,Zy=ep,Jy=Rp,Qy=Uv,$y=Gv,ex=qv,tx=Jv,nx=ob,rx=cb,ax=pb,ix=hb,ox=$f,sx=xb,ux=Ob,cx=sp,lx=Eb;function dx(e,t){return["x","y","z","w","u","v"].slice(0,t).map((function(t){return"".concat(e,".").concat(t)}))}function px(e,t){return 1===t?[e]:dx(e,t)}var fx=function(){function e(t){if(Object($r.a)(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.enableShapeUniforms=ty(this.outputShape.length),0===this.rank)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var n=px("rc",this.rank),r=qg(this.rank),a=this.getOutOfBoundsCondition(n),i=this.getSetup(n),o=this.getOutput(n);this.userCode="\n        void main() {\n          ".concat(r," rc = getOutputCoords();\n\n          if(").concat(a,") {\n            setOutput(vec4(0));\n          } else {\n            ").concat(i,"\n\n            setOutput(vec4(").concat(o,"));\n          }\n        }\n      ")}}return Object(ea.a)(e,[{key:"getSourceCoordsArr",value:function(e){for(var t=[],n=0;n<=1;n++)for(var r=0;r<=1;r++){for(var a="".concat(0===n?"r":"rp1",", ").concat(0===r?"c":"cp1"),i=2;i<this.rank;i++)a="".concat(e[e.length-1-i],",")+a;t.push(a)}return t}},{key:"getOutOfBoundsCondition",value:function(e){if(1===this.rank)return"rc > ".concat(this.enableShapeUniforms?"outShape":this.outputShape[0]);for(var t="",n=this.rank-2;n<this.rank;n++)t+="".concat(e[n]," >= ").concat(this.enableShapeUniforms?"outShape[".concat(n,"]"):this.outputShape[n]),n<this.rank-1&&(t+="||");return t}},{key:"getSetup",value:function(e){if(1===this.rank)return"";var t=e.slice(-2),n=this.enableShapeUniforms?"outShape[".concat(this.rank," - 1]"):this.outputShape[this.rank-1],r=this.enableShapeUniforms?"outShape[".concat(this.rank," - 2]"):this.outputShape[this.rank-2];return"\n      int r = ".concat(t[0],";\n      int c = ").concat(t[1],";\n      int rp1 = r + 1;\n      int cp1 = c + 1;\n\n      bool cEdge = cp1 >= ").concat(n,";\n      bool rEdge = rp1 >= ").concat(r,";\n    ")}},{key:"getOutput",value:function(e){var t=this.getSourceCoordsArr(e);if(1===this.rank){var n=this.enableShapeUniforms?"outShape":this.outputShape[0];return"getA(rc), (rc + 1 >= ".concat(n," ? 0. : getA(rc + 1)), 0, 0")}return"getA(".concat(t[0],"),\n            cEdge ? 0. : getA(").concat(t[1],"),\n            rEdge ? 0. : getA(").concat(t[2],"),\n            rEdge || cEdge ? 0. : getA(").concat(t[3],")")}}]),e}(),hx=function e(t,n){Object($r.a)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=t,this.enableShapeUniforms=ty(this.outputShape.length);for(var r="",a=0;a<4;a++){var i="thisRC = rc;";a%2===1&&(i+="thisRC.z += 1;"),a>1&&(i+="thisRC.y += 1;"),r+="\n        ".concat(i,"\n        ").concat(a>0?"if(thisRC.y < rows && thisRC.z < cols){":"","\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result[").concat(a,"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        ").concat(a>0?"}":"","\n      ")}this.userCode="\n      ".concat(function(e,t){var n=t?function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index",r=e.map((function(e,t){return t})),a=Ig(r,t);return a.map((function(t,r){var i="int ".concat(e[r]," = ").concat(n," / ").concat(a[r]),o=r===a.length-1?"int ".concat(e[r+1]," = ").concat(n," - ").concat(e[r]," * ").concat(a[r]):"index -= ".concat(e[r]," * ").concat(a[r]);return"".concat(i,"; ").concat(o,";")})).join("")}(["r","c","d"],"inputShape"):wg(["r","c","d"],e);return"\n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      ".concat(n,"\n      return ivec3(r, c, d);\n    }\n  ")}(n,this.enableShapeUniforms),"\n      ").concat(this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":Sg(t),"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = ").concat(this.enableShapeUniforms?"outShape[1]":t[1],";\n        int cols = ").concat(this.enableShapeUniforms?"outShape[2]":t[2],";\n\n        ").concat(r,"\n\n        setOutput(result);\n      }\n    ")};var mx=function(){function e(t){Object($r.a)(this,e),this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return Object(ea.a)(e,[{key:"acquireTexture",value:function(e,t,n){var r=bx(t,n),a=gx(e,r,n);a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]);var i,o=vx(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,n);if(this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=o,this.log();var s=this.freeTextures[a].shift();return this.usedTextures[a].push(s),s}return r===Pb.PACKED_2X2_FLOAT32?i=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===Pb.PACKED_2X2_FLOAT16?i=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===Pb.UNPACKED_FLOAT32?i=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===Pb.UNPACKED_FLOAT16?i=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===Pb.PACKED_4X1_UNSIGNED_BYTE&&(i=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[a].push(i),this.numUsedTextures++,this._numBytesAllocated+=o,this.log(),i}},{key:"releaseTexture",value:function(e,t,n,r){if(null!=this.freeTextures){var i=bx(n,r),o=gx(t,i,r);o in this.freeTextures||(this.freeTextures[o]=[]);var s=vx(t,i,this.gpgpu.gl,this.gpgpu.textureConfig,r),u=Object(a.be)().get("WEBGL_DELETE_TEXTURE_THRESHOLD");-1!==u&&this._numBytesAllocated>u?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=s):(this.freeTextures[o].push(e),this.numFreeTextures++,this._numBytesFree+=s),this.numUsedTextures--;var c=this.usedTextures[o],l=c.indexOf(e);if(l<0)throw new Error("Cannot release a texture that was never provided by this texture manager");c.splice(l,1),this.log()}}},{key:"log",value:function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used","".concat(this.numFreeTextures," / ").concat(this.numUsedTextures),"(".concat(e,")"));var t=this._numBytesFree/this._numBytesAllocated;console.log("Bytes allocated: ".concat(this._numBytesAllocated)),console.log("Bytes unused: ".concat(this._numBytesFree," (").concat(Math.round(100*t),"%)"))}}},{key:"getNumUsedTextures",value:function(){return this.numUsedTextures}},{key:"getNumFreeTextures",value:function(){return this.numFreeTextures}},{key:"dispose",value:function(){var e=this;if(null!=this.freeTextures){for(var t in this.freeTextures)this.freeTextures[t].forEach((function(t){e.gpgpu.deleteMatrixTexture(t.texture)}));for(var n in this.usedTextures)this.usedTextures[n].forEach((function(t){e.gpgpu.deleteMatrixTexture(t.texture)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}},{key:"numBytesAllocated",get:function(){return this._numBytesAllocated}},{key:"numBytesFree",get:function(){return this._numBytesFree}}]),e}();function vx(e,t,n,r,a){var o,s=function(e,t){switch(e){case Pb.PACKED_2X2_FLOAT32:return my(t);case Pb.PACKED_2X2_FLOAT16:return vy(t);case Pb.UNPACKED_FLOAT32:return py(t);case Pb.UNPACKED_FLOAT16:return fy(t);case Pb.PACKED_4X1_UNSIGNED_BYTE:return hy(t);default:throw new Error("Unknown physical texture type ".concat(e))}}(t,r);if(a){var u=Hb(e[0],e[1]),c=Object(i.a)(u,2);o=c[0]*c[1]}else{var l=Vb(e[0],e[1]),d=Object(i.a)(l,2);o=d[0]*d[1]}return o*function(e,t){var n=e;if(t===n.R32F)return 4;if(t===n.R16F)return 2;if(t===n.RGBA32F)return 16;if(t===e.RGBA)return 16;if(t===n.RGBA16F)return 8;if(t===n.RGBA8)return 4;throw new Error("Unknown internal format ".concat(t))}(n,s)}function bx(e,t){if(e===Lb.UPLOAD)return Pb.PACKED_2X2_FLOAT32;if(e===Lb.RENDER||null==e)return function(e){return Object(a.be)().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?Pb.PACKED_2X2_FLOAT32:Pb.UNPACKED_FLOAT32:e?Pb.PACKED_2X2_FLOAT16:Pb.UNPACKED_FLOAT16}(t);if(e===Lb.DOWNLOAD||e===Lb.PIXELS)return Pb.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type ".concat(e))}function gx(e,t,n){return"".concat(e[0],"_").concat(e[1],"_").concat(t,"_").concat(n)}var yx=function e(t,n){Object($r.a)(this,e),this.variableNames=["A"],this.outputShape=t,this.enableShapeUniforms=ty(this.outputShape.length),this.userCode="\n      float unaryOperation(float x) {\n        ".concat(n,"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    ")},xx="if (isnan(x)) return x;",kx="return abs(x);";var wx=xx+"\n  return (x < 0.0) ? 0.0 : x;\n",Ox=xx+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",Ix="return x;",Sx="return 1.0 / (1.0 + exp(-1.0 * x));",Nx="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n",jx="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",Tx="\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",Cx=function e(t,n){Object($r.a)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.enableShapeUniforms=ty(this.outputShape.length),this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        ".concat(n,"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    ")},Ex=function e(t){Object($r.a)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=t,this.enableShapeUniforms=ty(this.outputShape.length);var n=t.length,r=px("rc",n),a=qg(n),i=function(e,t){if(1===e)return"rc";for(var n="",r=0;r<e;r++)n+=t[r],r<e-1&&(n+=",");return n}(n,r),o=r.slice(-2),s=n<=1?"rc":"vec2(".concat(o.join(","),")");this.userCode="\n      void main() {\n        ".concat(a," rc = getOutputCoords();\n        vec4 packedInput = getA(").concat(i,");\n\n        setOutput(getChannel(packedInput, ").concat(s,"));\n      }\n    ")},_x=a.pe.whereImpl,Ax={};var Rx=Object(a.be)().getNumber("CPU_HANDOFF_SIZE_THRESHOLD");var Dx=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e){var r,i,o;if(Object($r.a)(this,n),(r=t.call(this)).pendingRead=new WeakMap,r.pendingDisposal=new WeakSet,r.dataRefCount=new WeakMap,r.numBytesInGPU=0,r.uploadWaitMs=0,r.downloadWaitMs=0,r.lastGlFlushTime=0,r.warnedAboutMemory=!1,r.pendingDeletes=0,r.disposed=!1,!Object(a.be)().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null!=e){if(e instanceof gy)i=e;else{var s=Ub(Object(a.be)().getNumber("WEBGL_VERSION"),e);i=new gy(s)}r.binaryCache={},r.gpgpuCreatedLocally=!1}else{var u=Ub(Object(a.be)().getNumber("WEBGL_VERSION"));i=new gy(u),r.binaryCache=((o=Object(a.be)().getNumber("WEBGL_VERSION"))in Ax||(Ax[o]={}),Ax[o]),r.gpgpuCreatedLocally=!0}return r.gpgpu=i,r.canvas=r.gpgpu.gl.canvas,r.textureManager=new mx(r.gpgpu),r.numMBBeforeWarning=null==Object(a.be)().global.screen?1024:Object(a.be)().global.screen.height*Object(a.be)().global.screen.width*window.devicePixelRatio*600/1024/1024,r.texData=new a.N(Object(ta.a)(r),Object(a.ae)()),r}return Object(ea.a)(n,[{key:"nextDataId",value:function(){return n.nextDataId++}},{key:"numDataIds",value:function(){return this.texData.numDataIds()-this.pendingDeletes}},{key:"write",value:function(e,t,n){if((Object(a.be)().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||Object(a.be)().getBool("DEBUG"))&&this.checkNumericalProblems(e),"complex64"===n&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var r={id:this.nextDataId()};return this.texData.set(r,{shape:t,dtype:n,values:e,usage:Lb.UPLOAD,refCount:1}),r}},{key:"refCount",value:function(e){return this.texData.has(e)?this.texData.get(e).refCount:0}},{key:"incRef",value:function(e){this.texData.get(e).refCount++}},{key:"decRef",value:function(e){this.texData.has(e)&&this.texData.get(e).refCount--}},{key:"move",value:function(e,t,n,r,i){if(Object(a.be)().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:n,dtype:r,values:t,usage:Lb.UPLOAD,refCount:i})}},{key:"disposeIntermediateTensorInfo",value:function(e){this.disposeData(e.dataId)}},{key:"readSync",value:function(e){var t=this.texData.get(e),n=t.values,r=t.dtype,i=t.complexTensorInfos,o=t.slice,s=t.shape,u=t.isPacked;if(null!=o){var c;c=u?new Cx(s,Ix):new yx(s,Ix);var l=this.runWebGLProgram(c,[{dataId:e,shape:s,dtype:r}],r),d=this.readSync(l.dataId);return this.disposeIntermediateTensorInfo(l),d}if(null!=n)return this.convertAndCacheOnCPU(e);if("string"===r)return n;var p,f,h=null!=this.activeTimers;if(h&&(p=a.Df.now()),"complex64"===r){var m=this.readSync(i.real.dataId),v=this.readSync(i.imag.dataId);f=a.zd.mergeRealAndImagArrays(m,v)}else f=this.getValuesFromTexture(e);return h&&(this.downloadWaitMs+=a.Df.now()-p),this.convertAndCacheOnCPU(e,f)}},{key:"read",value:function(){var e=Object(Oo.a)(wo.a.mark((function e(t){var n,r,i,o,s,u,c,l,d,p,f,h,m,v,b,g,y,x,k,w,O,I,S;return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.pendingRead.has(t)){e.next=3;break}return n=this.pendingRead.get(t),e.abrupt("return",new Promise((function(e){return n.push(e)})));case 3:if(r=this.texData.get(t),i=r.values,o=r.shape,s=r.slice,u=r.dtype,c=r.complexTensorInfos,l=r.isPacked,null==s){e.next=11;break}return d=l?new Cx(o,Ix):new yx(o,Ix),p=this.runWebGLProgram(d,[{dataId:t,shape:o,dtype:u}],u),f=this.read(p.dataId),this.disposeIntermediateTensorInfo(p),e.abrupt("return",f);case 11:if(null==i){e.next=13;break}return e.abrupt("return",this.convertAndCacheOnCPU(t));case 13:if(!Object(a.be)().getBool("DEBUG")){e.next=16;break}if(Object(a.be)().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")||2!==Object(a.be)().getNumber("WEBGL_VERSION")){e.next=16;break}throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");case 16:if(h=null,"complex64"!==u&&Object(a.be)().get("WEBGL_BUFFER_SUPPORTED")&&(m=this.decode(t),b=this.texData.get(m.dataId),h=(v=this.gpgpu).createBufferFromTexture.apply(v,[b.texture.texture].concat(Object(qn.a)(Gb(o))))),this.pendingRead.set(t,[]),"complex64"===u){e.next=22;break}return e.next=22,this.gpgpu.createAndWaitForFence();case 22:if("complex64"!==u){e.next=31;break}return e.next=25,Promise.all([this.read(c.real.dataId),this.read(c.imag.dataId)]);case 25:y=e.sent,x=y[0],k=y[1],g=a.zd.mergeRealAndImagArrays(x,k),e.next=32;break;case 31:null==h?g=this.getValuesFromTexture(t):(w=a.Df.sizeFromShape(o),g=this.gpgpu.downloadFloat32MatrixFromBuffer(h,w));case 32:return null!=m&&this.disposeIntermediateTensorInfo(m),null!=h&&Kb(O=this.gpgpu.gl,(function(){return O.deleteBuffer(h)})),I=this.convertAndCacheOnCPU(t,g),S=this.pendingRead.get(t),this.pendingRead.delete(t),S.forEach((function(e){return e(I)})),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t)&&Object(a.ae)().removeDataId(t,this),this.pendingDeletes--),e.abrupt("return",I);case 40:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"readToGPU",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.texData.get(e),r=n.values,i=n.shape,o=n.slice,s=n.dtype,u=n.isPacked,c=n.texture;if("complex64"===s)throw new Error("Does not support reading texture for complex64 dtype.");if(null!=o){var l;l=u?new Cx(i,Ix):new yx(i,Ix);var d=this.runWebGLProgram(l,[{dataId:e,shape:i,dtype:s}],s),p=this.readToGPU(d,t);return this.disposeIntermediateTensorInfo(d),p}if(null==c)throw null!=r?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");var f=this.decode(e,t.customTexShape),h=Object(a.ae)().makeTensorFromTensorInfo(f),m=this.texData.get(f.dataId);return Object.assign({tensorRef:h},m.texture)}},{key:"bufferSync",value:function(e){var t=this.readSync(e.dataId);if("string"===e.dtype)try{var n=t.map((function(e){return a.Df.decodeString(e)}));return Object(a.Gd)(e.shape,e.dtype,n)}catch(r){throw new Error("Failed to decode encoded string bytes into utf-8")}return Object(a.Gd)(e.shape,e.dtype,t)}},{key:"checkNumericalProblems",value:function(e){if(null!=e)for(var t=0;t<e.length;t++){var n=e[t];if(!Xb(n)){if(Object(a.be)().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error("The value ".concat(n," cannot be represented with your ")+"current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'");throw Error("The value ".concat(n," cannot be represented on this device."))}}}},{key:"getValuesFromTexture",value:function(e){var t=this.texData.get(e),n=t.shape,r=t.dtype,i=t.isPacked,o=a.Df.sizeFromShape(n);if(Object(a.be)().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var s,u=this.decode(e),c=this.texData.get(u.dataId),l=(s=this.gpgpu).downloadMatrixFromPackedTexture.apply(s,[c.texture.texture].concat(Object(qn.a)(Gb(n)))).subarray(0,o);return this.disposeIntermediateTensorInfo(u),l}var d=Object(a.be)().getBool("WEBGL_PACK")&&!0===i,p=d?pg(n):n,f=d?new iy(p):new ay(p),h=this.runWebGLProgram(f,[{shape:p,dtype:r,dataId:e}],"float32"),m=this.texData.get(h.dataId),v=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(m.texture.texture,m.texShape[0],m.texShape[1]).subarray(0,o);return this.disposeIntermediateTensorInfo(h),v}},{key:"timerAvailable",value:function(){return Object(a.be)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}},{key:"time",value:function(e){var t=this,n=this.activeTimers,r=[],i=!1;null==this.programTimersStack?(this.programTimersStack=r,i=!0):this.activeTimers.push(r),this.activeTimers=r,e();var o=a.Df.flatten(this.activeTimers.map((function(e){return e.query}))).filter((function(e){return null!=e})),s=a.Df.flatten(this.activeTimers.map((function(e){return e.name}))).filter((function(e){return null!=e}));this.activeTimers=n,i&&(this.programTimersStack=null);var u={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return Object(Oo.a)(wo.a.mark((function e(){var n;return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(Object(a.be)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)){e.next=8;break}return e.next=3,Promise.all(o);case 3:n=e.sent,u.kernelMs=a.Df.sum(n),u.getExtraProfileInfo=function(){return n.map((function(e,t){return{name:s[t],ms:e}})).map((function(e){return"".concat(e.name,": ").concat(e.ms)})).join(", ")},e.next=9;break;case 8:u.kernelMs={error:"WebGL query timers are not supported in this environment."};case 9:return t.uploadWaitMs=0,t.downloadWaitMs=0,e.abrupt("return",u);case 12:case"end":return e.stop()}}),e)})))()}},{key:"memory",value:function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}},{key:"startTimer",value:function(){return Object(a.be)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:a.Df.now(),endMs:null}}},{key:"endTimer",value:function(e){return Object(a.be)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=a.Df.now(),e)}},{key:"getQueryTime",value:function(){var e=Object(Oo.a)(wo.a.mark((function e(t){var n;return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(Object(a.be)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)){e.next=2;break}return e.abrupt("return",this.gpgpu.waitForQueryAndGetTime(t));case 2:return n=t,e.abrupt("return",n.endMs-n.startMs);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"disposeData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(t?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!t&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);var n=this.texData.get(e),r=n.complexTensorInfos;return null!=r&&(this.disposeData(r.real.dataId,t),this.disposeData(r.imag.dataId,t)),this.texData.delete(e),!0}},{key:"releaseGPUData",value:function(e){var t=this.texData.get(e),n=t.texture,r=t.dtype,a=t.texShape,i=t.usage,o=t.isPacked,s=t.slice,u=s&&s.origDataId||e,c=this.dataRefCount.get(u);c>1?this.dataRefCount.set(u,c-1):(this.dataRefCount.delete(u),null!=n&&(this.numBytesInGPU-=this.computeBytes(a,r),this.textureManager.releaseTexture(n,a,i,o)));var l=this.texData.get(e);l.texture=null,l.texShape=null,l.isPacked=!1,l.slice=null}},{key:"getTexture",value:function(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}},{key:"getDataInfo",value:function(e){return this.texData.get(e)}},{key:"shouldExecuteOnCPU",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Rx;return Object(a.be)().getBool("WEBGL_CPU_FORWARD")&&e.every((function(e){return null==t.texData.get(e.dataId).texture&&a.Df.sizeFromShape(e.shape)<n}))}},{key:"getGPGPUContext",value:function(){return this.gpgpu}},{key:"where",value:function(e){a.zd.warn("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var t=e.dataSync();return _x(e.shape,t)}},{key:"packedUnaryOp",value:function(e,t,n){var r=new Cx(e.shape,t),i=this.compileAndRun(r,[e],n);return Object(a.ae)().makeTensorFromTensorInfo(i)}},{key:"abs",value:function(e){if(this.shouldExecuteOnCPU([e])&&"complex64"!==e.dtype){var t=Zy(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,t)}if(Object(a.be)().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,kx,e.dtype);var n=new yx(e.shape,kx),r=this.compileAndRun(n,[e]);return Object(a.ae)().makeTensorFromTensorInfo(r)}},{key:"makeTensorInfo",value:function(e,t,n){var r;if("string"===t&&null!=n&&n.length>0&&a.Df.isString(n[0])){var i=n.map((function(e){return a.Df.encodeString(e)}));r=this.write(i,e,t)}else r=this.write(n,e,t);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:t}}},{key:"makeOutput",value:function(e,t,n){return Object(a.ae)().makeTensorFromTensorInfo(this.makeTensorInfo(e,t,n),this)}},{key:"unpackTensor",value:function(e){var t=new Ex(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}},{key:"packTensor",value:function(e){var t=new fx(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}},{key:"packedReshape",value:function(e,t){var n=[lg(e.shape)].concat(Object(qn.a)(dg(e.shape))),r={dtype:e.dtype,shape:n,dataId:e.dataId},a=[lg(t)].concat(Object(qn.a)(dg(t))),i=new hx(a,n),o=[n],s=this.runWebGLProgram(i,[r],e.dtype,o,!0);return{dataId:s.dataId,shape:t,dtype:s.dtype}}},{key:"decode",value:function(e,t){var n=this.texData.get(e),r=n.isPacked,i=n.shape,o=n.dtype;if(null!=t){var s=a.Df.sizeFromShape(i),u=t[0]*t[1]*4;a.Df.assert(s<=u,(function(){return"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data."}))}var c,l=pg(i);c=r?new ry(l):new ny(l);var d=[null!=t?t:Gb(l)];return{dtype:o,shape:i,dataId:this.runWebGLProgram(c,[{shape:l,dtype:o,dataId:e}],o,d,!0,t).dataId}}},{key:"runWebGLProgram",value:function(e,t,n,r){var i=this,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5?arguments[5]:void 0,u=this.makeTensorInfo(e.outputShape,n),c=this.texData.get(u.dataId);if(e.packedOutput&&(c.isPacked=!0),e.outPackingScheme===zb.DENSE){var l=null!=s?s:Gb(e.outputShape);c.texShape=l.map((function(e){return 2*e}))}if(null!=e.outTexUsage&&(c.usage=e.outTexUsage),0===a.Df.sizeFromShape(u.shape))return c.values=a.Df.getTypedArrayFromDType(u.dtype,0),u;var d=[],p=t.map((function(t){if("complex64"===t.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var n=i.texData.get(t.dataId);if(null==n.texture){if(!e.packedInputs&&a.Df.sizeFromShape(t.shape)<=Object(a.be)().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:t.shape,texData:null,isUniform:!0,uniformValues:n.values};e.packedInputs&&(n.isPacked=!0,n.shape=t.shape)}if(i.uploadToGPU(t.dataId),!!n.isPacked!==!!e.packedInputs)t=n.isPacked?i.unpackTensor(t):i.packTensor(t),d.push(t),n=i.texData.get(t.dataId);else if(n.isPacked&&!hg(n.shape,t.shape)){var r=t,o=t.shape;t.shape=n.shape,t=i.packedReshape(t,o),d.push(t),n=i.texData.get(t.dataId),r.shape=o}return{shape:t.shape,texData:n,isUniform:!1}}));this.uploadToGPU(u.dataId);var f,h={shape:u.shape,texData:c,isUniform:!1},m=ey(e,p,h),v=this.getAndSaveBinary(m,(function(){return Zg(i.gpgpu,e,p,h)})),b=null!=this.activeTimers;b&&(f=this.startTimer()),Object(a.be)().get("ENGINE_COMPILE_ONLY")||$g(this.gpgpu,v,p,h,r),d.forEach((function(e){return i.disposeIntermediateTensorInfo(e)})),b&&(f=this.endTimer(f),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(f)}));var g=Object(a.be)().get("WEBGL_FLUSH_THRESHOLD");if(g>0){var y=a.Df.now();y-this.lastGlFlushTime>g&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=y)}if(!Object(a.be)().getBool("WEBGL_LAZILY_UNPACK")&&c.isPacked&&!1===o){var x=this.unpackTensor(u);return this.disposeIntermediateTensorInfo(u),x}return u}},{key:"compileAndRun",value:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];n=n||t[0].dtype;var i=this.runWebGLProgram(e,t,n,r,a);return i}},{key:"getAndSaveBinary",value:function(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}},{key:"getTextureManager",value:function(){return this.textureManager}},{key:"dispose",value:function(){var e=this;if(!this.disposed){if(!Object(a.be)().getBool("IS_TEST"))Object.keys(this.binaryCache).forEach((function(t){e.gpgpu.deleteProgram(e.binaryCache[t].webGLProgram),delete e.binaryCache[t]}));this.textureManager.dispose(),null!=this.canvas&&"undefined"!==typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0}}},{key:"floatPrecision",value:function(){var e=this;return null==this.floatPrecisionValue&&(this.floatPrecisionValue=Object(a.wf)((function(){if(!Object(a.be)().get("WEBGL_RENDER_FLOAT32_ENABLED")){var t=Object(a.be)().getBool("DEBUG");Object(a.be)().set("DEBUG",!1);var n=e.abs(Object(a.We)(1e-8)).dataSync()[0];if(Object(a.be)().set("DEBUG",t),n>0)return 32}return 16}))),this.floatPrecisionValue}},{key:"epsilon",value:function(){return 32===this.floatPrecision()?1e-7:1e-4}},{key:"uploadToGPU",value:function(e){var t=this.texData.get(e),n=t.shape,r=t.dtype,o=t.values,s=t.texture,u=t.usage,c=t.isPacked;if(null==s){var l,d=null!=this.activeTimers;d&&(l=a.Df.now());var p=t.texShape;if(null==p&&(p=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=Object(a.be)().getNumber("WEBGL_MAX_TEXTURE_SIZE"),r=Object(a.be)().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");if(r===1/0&&Object(a.be)().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(r=n/2),t&&(n*=2,r*=2,1===(e=e.map((function(t,n){return n>=e.length-2?a.Df.nearestLargerEven(e[n]):e[n]}))).length&&(e=[2,e[0]])),2!==e.length){var o=a.Df.squeezeShape(e);e=o.newShape}var s=a.Df.sizeFromShape(e),u=null;e.length<=1&&s<=n?u=[1,s]:2===e.length&&e[0]<=n&&e[1]<=n?u=e:3===e.length&&e[0]*e[1]<=n&&e[2]<=n?u=[e[0]*e[1],e[2]]:3===e.length&&e[0]<=n&&e[1]*e[2]<=n?u=[e[0],e[1]*e[2]]:4===e.length&&e[0]*e[1]*e[2]<=n&&e[3]<=n?u=[e[0]*e[1]*e[2],e[3]]:4===e.length&&e[0]<=n&&e[1]*e[2]*e[3]<=n&&(u=[e[0],e[1]*e[2]*e[3]]);var c=null!=u&&Math.max.apply(Math,Object(qn.a)(u))>r&&Math.min.apply(Math,Object(qn.a)(u))<=(t?2:1)&&Math.min.apply(Math,Object(qn.a)(u))>0;if(null==u||c)if(t){var l=lg(e),d=2,p=2;if(e.length){var f=dg(e),h=Object(i.a)(f,2);d=h[0],p=h[1]}s=l*(d/2)*(p/2),u=a.Df.sizeToSquarishShape(s).map((function(e){return 2*e}))}else u=a.Df.sizeToSquarishShape(s);return u}(n,c),t.texShape=p),null!=o){var f,h=pg(n),m=p[1],v=p[0],b=o instanceof Uint8Array||o instanceof Uint8ClampedArray;if(c||!b){var g=Hb(p[0],p[1]),y=Object(i.a)(g,2);m=y[0],v=y[1]}f=c?new sy(h,b):new oy(h,b);var x=b?[v,m]:p,k=this.makeTensorInfo(x,r),w=this.texData.get(k.dataId);w.usage=b?Lb.PIXELS:Lb.UPLOAD,w.texShape=x,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(k.dataId),m,v,o);var O=[[v,m]],I=this.runWebGLProgram(f,[k],r,O,!0),S=this.texData.get(I.dataId);t.texShape=S.texShape,t.isPacked=S.isPacked,t.usage=S.usage,Object(a.be)().get("ENGINE_COMPILE_ONLY")?this.disposeData(I.dataId):(t.texture=S.texture,t.values=null,this.texData.delete(I.dataId)),this.disposeIntermediateTensorInfo(k),d&&(this.uploadWaitMs+=a.Df.now()-l)}else{var N=this.acquireTexture(p,u,r,c);t.texture=N}}}},{key:"convertAndCacheOnCPU",value:function(e,t){var n=this.texData.get(e),r=n.dtype;return this.releaseGPUData(e),null!=t&&(n.values=function(e,t){if("float32"===t||"complex64"===t)return e;if("int32"===t||"bool"===t){for(var n="int32"===t?new Int32Array(e.length):new Uint8Array(e.length),r=0;r<n.length;++r)n[r]=Math.round(e[r]);return n}throw new Error("Unknown dtype ".concat(t))}(t,r)),n.values}},{key:"acquireTexture",value:function(e,t,n,r){if(this.numBytesInGPU+=this.computeBytes(e,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var a=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: ".concat(a," MB, ")+"most likely due to a memory leak")}return this.textureManager.acquireTexture(e,t,r)}},{key:"computeBytes",value:function(e,t){return e[0]*e[1]*a.Df.bytesPerElement(t)}},{key:"checkCompileCompletion",value:function(){for(var e=0,t=Object.entries(this.binaryCache);e<t.length;e++){var n=Object(i.a)(t[e],2)[1];this.checkCompletion_(n)}}},{key:"checkCompileCompletionAsync",value:function(){var e=Object(Oo.a)(wo.a.mark((function e(){var t,n,r,a,o,s,u,c,l=this;return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=[],!this.gpgpu.parallelCompilationExtension){e.next=6;break}for(n=0,r=Object.entries(this.binaryCache);n<r.length;n++)a=Object(i.a)(r[n],2),o=a[1],t.push(this.checkCompletionAsync_(o));return e.abrupt("return",Promise.all(t));case 6:for(s=function(){var e=Object(i.a)(c[u],2)[1],n=new Promise((function(t){try{l.checkCompletion_(e),t(!0)}catch(n){throw n}}));t.push(n)},u=0,c=Object.entries(this.binaryCache);u<c.length;u++)s();return e.abrupt("return",Promise.all(t));case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"checkCompletionAsync_",value:function(){var e=Object(Oo.a)(wo.a.mark((function e(t){return wo.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)){e.next=4;break}return e.abrupt("return",this.checkCompletion_(t));case 4:return e.next=6,Object(a.He)();case 6:return e.abrupt("return",this.checkCompletionAsync_(t));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"checkCompletion_",value:function(e){if(!1===this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)){if(console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),!1===this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS))throw $b(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.");throw new Error("Failed to link vertex and fragment shaders.")}return!0}},{key:"getUniformLocations",value:function(){for(var e=0,t=Object.entries(this.binaryCache);e<t.length;e++){var n=Object(i.a)(t[e],2)[1],r=Jg(this.gpgpu,n.program,n.webGLProgram),a=r.uniformLocations,o=r.customUniformLocations,s=r.infLoc,u=r.nanLoc,c=r.inShapesLocations,l=r.inTexShapesLocations,d=r.outShapeLocation,p=r.outShapeStridesLocation,f=r.outTexShapeLocation;n.uniformLocations=a,n.customUniformLocations=o,n.infLoc=s,n.nanLoc=u,n.inShapesLocations=c,n.inTexShapesLocations=l,n.outShapeLocation=d,n.outShapeStridesLocation=p,n.outTexShapeLocation=f}}}]),n}(a.yb);Dx.nextDataId=0;a.Vd.isBrowser()&&Object(a.Re)("webgl",(function(){return new Dx}),2);var Fx=function e(t,n,r){Object($r.a)(this,e),this.variableNames=["A","B"],this.outputShape=a.zd.assertAndGetBroadcastShape(n,r),this.enableShapeUniforms=ty(this.outputShape.length),this.userCode="\n      float binaryOperation(float a, float b) {\n        ".concat(t,"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    ")},Mx=function e(t,n,r){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];Object($r.a)(this,e),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=a.zd.assertAndGetBroadcastShape(n,r);var o=this.outputShape.length;this.enableShapeUniforms=ty(o);var s="";if(i)if(0===o||1===a.Df.sizeFromShape(this.outputShape))s="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else{var u=qg(o);if(s="\n          ".concat(u," coords = getOutputCoords();\n        "),1===o)this.enableShapeUniforms?s+="\n            result.y = (coords + 1) >= outShape ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ":s+="\n            result.y = (coords + 1) >= ".concat(this.outputShape[0]," ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ");else{var c=px("coords",o);this.enableShapeUniforms?s+="\n            bool nextRowOutOfBounds =\n              (".concat(c[o-2]," + 1) >= outShape[").concat(o," - 2];\n            bool nextColOutOfBounds =\n              (").concat(c[o-1]," + 1) >= outShape[").concat(o," - 1];\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          "):s+="\n            bool nextRowOutOfBounds =\n              (".concat(c[o-2]," + 1) >= ").concat(this.outputShape[o-2],";\n            bool nextColOutOfBounds =\n              (").concat(c[o-1]," + 1) >= ").concat(this.outputShape[o-1],";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          ")}}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        ".concat(t,"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        ").concat(s,"\n\n        setOutput(result);\n      }\n    ")};function zx(e){var t=e.inputs,n=e.backend,r=t.x;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var Lx={kernelName:a.tb,backendName:"webgl",kernelFunc:zx};function Px(e){var t=e.inputs,n=e.backend,r=t.real,a=t.imag,i=n.makeTensorInfo(r.shape,"complex64"),o=n.texData.get(i.dataId),s=zx({inputs:{x:r},backend:n}),u=zx({inputs:{x:a},backend:n});return o.complexTensorInfos={real:s,imag:u},i}var Bx={kernelName:a.z,backendName:"webgl",kernelFunc:Px},Wx="return (a < 0.) ? b * a : a;",Ux="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";var Vx={kernelName:a.Bb,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.x,o=r.alpha,s=n.makeTensorInfo([],"float32",a.Df.createScalarValue(o,"float32")),u=Object(a.be)().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Mx(Ux,i.shape,s.shape):new Fx(Wx,i.shape,s.shape),c=n.runWebGLProgram(u,[i,s],"float32");return n.disposeIntermediateTensorInfo(s),c}},Gx="return (a < 0.) ? b * a : a;",Hx="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";var qx={kernelName:a.jc,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,i=t.alpha,o=Object(a.be)().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Mx(Hx,r.shape,i.shape):new Fx(Gx,r.shape,i.shape);return n.runWebGLProgram(o,[r,i],"float32")}};function Kx(e){var t=e.opSnippet,n=e.packedOpSnippet,r=e.cpuKernelImpl,i=e.dtype;return function(e){var o,s=e.inputs,u=e.backend,c=s.x,l=u,d=i||c.dtype;if(l.shouldExecuteOnCPU([c])&&null!=r){var p=l.texData.get(c.dataId),f=r(p.values,d);return l.makeTensorInfo(c.shape,d,f)}return o=Object(a.be)().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&null!=n?new Cx(c.shape,n):new yx(c.shape,t),l.runWebGLProgram(o,[c],d)}}function Xx(e){var t=e.opSnippet,n=e.packedOpSnippet,r=e.checkOutOfBounds,o=void 0!==r&&r,s=e.supportsComplex,u=void 0!==s&&s,c=e.cpuKernelImpl,l=e.dtype;return function(e){var r=e.inputs,s=e.backend,d=r.a,p=r.b,f=s;if(u&&"complex64"===d.dtype){var h=f.texData.get(d.dataId),m=f.texData.get(p.dataId),v=[[h.complexTensorInfos.real,m.complexTensorInfos.real],[h.complexTensorInfos.imag,m.complexTensorInfos.imag]].map((function(e){var n=Object(i.a)(e,2),r=n[0],o=n[1],s={dataId:r.dataId,dtype:r.dtype,shape:d.shape},u={dataId:o.dataId,dtype:o.dtype,shape:p.shape},c=new Fx(t,d.shape,p.shape);return f.runWebGLProgram(c,[s,u],Object(a.Cf)(r.dtype,o.dtype))})),b=Object(i.a)(v,2),g=b[0],y=b[1],x=Px({inputs:{real:g,imag:y},backend:f});return f.disposeIntermediateTensorInfo(g),f.disposeIntermediateTensorInfo(y),x}var k,w=l||Object(a.Cf)(d.dtype,p.dtype);if(("string"===d.dtype||"string"===p.dtype||f.shouldExecuteOnCPU([d,p]))&&null!=c){var O=f.texData.get(d.dataId).values,I=f.texData.get(p.dataId).values,S="string"===d.dtype?a.zd.fromUint8ToStringArray(O):O,N="string"===d.dtype?a.zd.fromUint8ToStringArray(I):I,j=c(d.shape,p.shape,S,N,w),T=Object(i.a)(j,2),C=T[0],E=T[1],_=f.makeTensorInfo(E,w);return f.texData.get(_.dataId).values=C,_}return k=Object(a.be)().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&null!=n?new Mx(n,d.shape,p.shape,o):new Fx(t,d.shape,p.shape),f.runWebGLProgram(k,[d,p],w)}}function Yx(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("linear"===e)return"return x;";if("relu"===e)return t?jx:wx;if("elu"===e)return t?Nx:"return (x >= 0.0) ? x : (exp(x) - 1.0);";if("relu6"===e)return t?Tx:Ox;if("prelu"===e)return t?Hx:Gx;if("leakyrelu"===e)return t?Ux:Wx;if("sigmoid"===e)return t?"return 1.0 / (1.0 + exp(-1.0 * x));":Sx;throw new Error("Activation ".concat(e," has not been implemented for the WebGL backend."))}var Zx=function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,u=arguments.length>7&&void 0!==arguments[7]&&arguments[7],c=arguments.length>8&&void 0!==arguments[8]&&arguments[8];Object($r.a)(this,e),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r,this.enableShapeUniforms=ty(this.outputShape.length);var l=a?t[1]:t[2],d=Math.ceil(l/2),p=a?"i * 2, rc.y":"rc.y, i * 2",f=i?"rc.z, i * 2":"i * 2, rc.z",h=a?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],m=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],v="",b="";s&&(v=u?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ".concat(s,"\n        }"):c?"vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ".concat(s,"\n        }"):"vec4 activation(vec4 x) {\n          ".concat(s,"\n        }"),b="result = activation(result);");var g=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),u&&this.variableNames.push("preluActivationWeights"),c&&this.variableNames.push("leakyreluAlpha");var y="rc.x",x="rc.x";t[0]<n[0]?y="int(min(float(rc.x), ".concat(t[0]-1,".))"):n[0]<t[0]&&(x="int(min(float(rc.x), ".concat(n[0]-1,".))")),this.userCode="\n      ".concat(v,"\n      // Don't use uniform for sharedDimensionPacked for performance.\n      const float sharedDimension = ").concat(d,".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < ").concat(d,"; i++) {\n          int batchA = ").concat(y,";\n          int batchB = ").concat(x,";\n          vec4 a = getMatrixA(batchA, ").concat(p,");\n          vec4 b = getMatrixB(batchB, ").concat(f,");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += (").concat(h[0]," * ").concat(m[0],");\n          result += (").concat(h[1]," * ").concat(m[1],");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        ").concat(g,"\n\n        ").concat(b,"\n\n        setOutput(result);\n      }\n    ")},Jx="return areal * breal - aimag * bimag;",Qx="return areal * bimag + aimag * breal;",$x=function e(t,n,r){Object($r.a)(this,e),this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=a.zd.assertAndGetBroadcastShape(n,r),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        ".concat(t,"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    ")},ek="return a * b;";function tk(e){var t,n=e.inputs,r=e.backend,o=n.a,s=n.b,u=a.zd.upcastType(o.dtype,s.dtype);if("complex64"===o.dtype){var c=r.texData.get(o.dataId),l=r.texData.get(s.dataId),d=new $x(Jx,o.shape,s.shape),p=new $x(Qx,o.shape,s.shape),f=[{dataId:c.complexTensorInfos.real.dataId,dtype:c.complexTensorInfos.real.dtype,shape:o.shape},{dataId:c.complexTensorInfos.imag.dataId,dtype:c.complexTensorInfos.imag.dtype,shape:o.shape},{dataId:l.complexTensorInfos.real.dataId,dtype:l.complexTensorInfos.real.dtype,shape:s.shape},{dataId:l.complexTensorInfos.imag.dataId,dtype:l.complexTensorInfos.imag.dtype,shape:s.shape}],h=r.runWebGLProgram(d,f,"float32"),m=r.runWebGLProgram(p,f,"float32"),v=Px({inputs:{real:h,imag:m},backend:r});return r.disposeIntermediateTensorInfo(h),r.disposeIntermediateTensorInfo(m),v}if(r.shouldExecuteOnCPU([o,s])){var b=r.texData.get(o.dataId),g=r.texData.get(s.dataId),y=By(o.shape,s.shape,b.values,g.values,u),x=Object(i.a)(y,2),k=x[0],w=x[1],O=r.makeTensorInfo(w,u);return r.texData.get(O.dataId).values=k,O}return t=Object(a.be)().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Mx(ek,o.shape,s.shape):new Fx(ek,o.shape,s.shape),r.runWebGLProgram(t,[o,s],u)}var nk={kernelName:a.Xb,backendName:"webgl",kernelFunc:tk};function rk(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.x,o=r.shape,s=n,u=a.Df.sizeFromShape(i.shape),c=a.Df.inferFromImplicitShape(o,u),l=a.Df.sizeFromShape(c);a.Df.assert(u===l,(function(){return"The new shape (".concat(c,") has ").concat(l," elements and the old ")+"shape (".concat(i.shape,") has ").concat(u," elements. The new shape and old ")+"shape must have the same number of elements."}));var d=s.texData.get(i.dataId);return!d.isPacked||hg(i.shape,c)||null!==d.texture&&hg(d.shape,c)?(s.incRef(i.dataId),{dataId:i.dataId,shape:c,dtype:i.dtype}):function(e,t,n){var r=[lg(e.shape)].concat(Object(qn.a)(dg(e.shape))),a={dtype:e.dtype,shape:r,dataId:e.dataId},i=[lg(t)].concat(Object(qn.a)(dg(t))),o=new hx(i,r),s=[r],u=n.runWebGLProgram(o,[a],e.dtype,s,!0);return{dataId:u.dataId,shape:t,dtype:u.dtype}}(i,c,s)}var ak={kernelName:a.tc,backendName:"webgl",kernelFunc:rk},ik=function e(t,n){Object($r.a)(this,e),this.variableNames=["x"];var r=t.windowSize,i=t.batchSize,o=t.inSize,s=t.outSize;this.outputShape=[i,s];var u=4*Math.floor(r/4),c=r%4,l="sumValue += dot(values, ones);";if(null!=n){var d=1/n;l="sumValue += dot(values * ".concat(a.Df.isInt(d)?d.toPrecision(2):d,", ones);")}var p="";o%r>0&&(p="\n        if (inIdx < 0 || inIdx >= ".concat(o,") {\n          return 0.0;\n        }\n      ")),this.userCode="\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ".concat(p,"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ").concat(r,";\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ").concat(u,"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ").concat(l,"\n        }\n\n        int inIdx = inOffset + ").concat(u,";\n        if (").concat(1===c,") {\n          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);\n\n          ").concat(l,"\n        } else if (").concat(2===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1), 0.0, 0.0);\n\n          ").concat(l,"\n        } else if (").concat(3===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2), 0.0);\n\n          ").concat(l,"\n        }\n        setOutput(sumValue);\n      }\n    ")},ok=function e(t,n){Object($r.a)(this,e),this.variableNames=["x"];var r=t.windowSize,a=t.batchSize,i=t.inSize,o=t.outSize;this.outputShape=[a,o];var s="0.0",u="";"prod"===n?s="1.0":"min"===n?(s="1.0 / 1e-20",u="min"):"max"===n&&(s="-1.0 / 1e-20",u="max");var c="".concat(n,"(").concat(n,"(").concat(n,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===n?c="sumValue":"prod"===n?c="prodValue":"all"===n?c="allValue":"any"===n&&(c="anyValue");var l=4*Math.floor(r/4),d=r%4,p="\n      if (".concat("sum"===n,") {\n        sumValue += dot(values, ones);\n      } else if (").concat("prod"===n,") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = ").concat(u,"(values, minMaxValue);\n        if (").concat("min"===n," || ").concat("max"===n,") {\n          minMaxValue = ").concat(u,"(values, minMaxValue);\n          bvec4 isNaN = isnan(values);\n          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {\n            minMaxValue = vec4(NAN);\n          }\n        }\n      }\n    "),f="vec4";"all"===n?(s="1.0",p="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",f="bvec4"):"any"===n&&(s="0.0",p="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",f="bvec4");var h="";i%r>0&&(h="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return initializationValue;\n        }\n      ")),this.userCode="\n      const float initializationValue = ".concat(s,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ").concat(h,"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ").concat(r,";\n\n        vec4 minMaxValue = vec4(").concat(s,");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < ").concat(l,"; i += 4) {\n          int inIdx = inOffset + i;\n          ").concat(f," values = ").concat(f,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ").concat(p,"\n        }\n\n        int inIdx = inOffset + ").concat(l,";\n        if (").concat(1===d,") {\n          ").concat(f," values = ").concat(f,"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          ").concat(p,"\n        } else if (").concat(2===d,") {\n          ").concat(f," values = ").concat(f,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          ").concat(p,"\n        } else if (").concat(3===d,") {\n          ").concat(f," values = ").concat(f,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          ").concat(p,"\n        }\n        setOutput(").concat(c,");\n      }\n    ")};function sk(e,t,n,r){for(var i=function(e){for(var t=[];0===t.length||1!==t[t.length-1].outSize;){var n=t.length?t[t.length-1].outSize:e[1],r=a.zd.computeOptimalWindowSize(n);t.push({inSize:n,windowSize:r,outSize:Math.ceil(n/r)})}return t}(e.shape),o=e,s=0;s<i.length;s++){var u,c=i[s],l=c.inSize,d=c.windowSize,p=c.outSize,f=void 0;f="mean"===n?0===s?new ik({windowSize:d,inSize:l,batchSize:e.shape[0],outSize:p},l):new ik({windowSize:d,inSize:l,batchSize:e.shape[0],outSize:p}):new ok({windowSize:d,inSize:l,batchSize:e.shape[0],outSize:p},n),u=o,o=r.runWebGLProgram(f,[o],t),u.dataId!==e.dataId&&r.disposeIntermediateTensorInfo(u)}return o}var uk=function e(t,n){Object($r.a)(this,e),this.variableNames=["A"];for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[n[a]];this.outputShape=r,this.rank=r.length;var i=qg(this.rank),o=function(e){var t=e.length;if(t>6)throw Error("Transpose for rank ".concat(t," is not yet supported"));for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t),a=0;a<e.length;a++)r[e[a]]=n[a];return r.join()}(n);this.userCode="\n    void main() {\n      ".concat(i," resRC = getOutputCoords();\n      setOutput(getA(").concat(o,"));\n    }\n    ")};var ck=function e(t,n){Object($r.a)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[n[a]];if(this.outputShape=r,this.rank=r.length,this.rank>6)throw Error("Packed transpose for rank ".concat(this.rank," is not yet supported."));for(var i=qg(this.rank),o=dx("rc",this.rank),s=new Array(this.rank),u=0;u<n.length;u++)s[n[u]]=o[u];var c="vec2(".concat(s.slice(-2).join(),")"),l="++".concat(o[this.rank-1]," < ").concat(r[this.rank-1]),d="getChannel(getA(".concat(s.join(),"), ").concat(c,")");this.userCode="\n    void main() {\n      ".concat(i," rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = ").concat(d,";\n      if(").concat(l,") {\n        result[1] = ").concat(d,";\n      }\n      --").concat(o[this.rank-1],";\n      if(++").concat(o[this.rank-2]," < ").concat(r[this.rank-2],") {\n        result[2] = ").concat(d,";\n        if(").concat(l,") {\n          result[3] = ").concat(d,";\n        }\n      }\n      setOutput(result);\n    }\n    ")};function lk(e,t,n){var r=Object(a.be)().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new ck(e.shape,t):new uk(e.shape,t);return n.runWebGLProgram(r,[e],e.dtype)}function dk(e){var t=e.inputs,n=e.backend,r=e.attrs;return function(e,t,n,r){var o=t,s=e.shape.length,u=a.Df.parseAxisParam(o,e.shape),c=u,l=a.zd.getAxesPermutation(c,s),d=null!=l,p=e;d&&(p=lk(e,l,r),c=a.zd.getInnerMostAxes(c.length,s)),a.zd.assertAxesAreInnerMostDims("sum",c,s);var f=a.zd.computeOutAndReduceShapes(p.shape,c),h=Object(i.a)(f,2),m=h[0],v=h[1],b=m;n&&(b=a.zd.expandShapeToKeepDim(m,u));var g=a.Df.sizeFromShape(v),y=rk({inputs:{x:p},attrs:{shape:[a.Df.sizeFromShape(e.shape)/g,g]},backend:r}),x=sk(y,Object(a.qf)(e.dtype),"sum",r),k=rk({inputs:{x:x},attrs:{shape:b},backend:r});return r.disposeIntermediateTensorInfo(y),r.disposeIntermediateTensorInfo(x),d&&r.disposeIntermediateTensorInfo(p),k}(t.x,r.axis,r.keepDims,n)}var pk={kernelName:a.dd,backendName:"webgl",kernelFunc:dk};function fk(e){for(var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.perm,s=r,u=i.shape.length,c=new Array(u),l=0;l<c.length;l++)c[l]=i.shape[o[l]];if(s.shouldExecuteOnCPU([i])){var d=s.texData.get(i.dataId).values,p=cx(d,i.shape,i.dtype,o,c);t=s.makeTensorInfo(c,i.dtype),s.texData.get(t.dataId).values=p}else t=lk(i,o,s);return t}var hk={kernelName:a.ld,backendName:"webgl",kernelFunc:fk};function mk(e){var t=e.a,n=e.b,r=e.transposeA,i=e.transposeB,o=e.backend,s=e.bias,u=void 0===s?null:s,c=e.preluActivationWeights,l=void 0===c?null:c,d=e.leakyreluAlpha,p=void 0===d?0:d,f=e.activation,h=void 0===f?null:f,m=t.shape.length,v=n.shape.length,b=r?t.shape[m-2]:t.shape[m-1],g=i?n.shape[v-1]:n.shape[v-2],y=r?t.shape[m-1]:t.shape[m-2],x=i?n.shape[v-2]:n.shape[v-1],k=t.shape.slice(0,-2),w=n.shape.slice(0,-2),O=a.Df.sizeFromShape(k),I=a.Df.sizeFromShape(w),S=a.Ed.assertAndGetBroadcastShape(t.shape.slice(0,-2),n.shape.slice(0,-2)).concat([y,x]);a.Df.assert(b===g,(function(){return"Error in matMul: inner shapes (".concat(b,") and (")+"".concat(g,") of Tensors with shapes ").concat(t.shape," and ")+"".concat(n.shape," and transposeA=").concat(r)+" and transposeB=".concat(i," must match.")}));var N,j=r?[O,b,y]:[O,y,b],T=i?[I,x,g]:[I,g,x],C=rk({inputs:{x:t},backend:o,attrs:{shape:j}}),E=rk({inputs:{x:n},backend:o,attrs:{shape:T}}),_=[C,E],A=Math.max(O,I),R=r?C.shape[1]:C.shape[2],D=null!=u,F=null!=l,M="leakyrelu"===h,z=null!=h?Yx(h,!0):null;if((1===y||1===x)&&R>1e3&&!1===(D||F||M||null!=z)){var L=C,P=E;r&&(L=fk({inputs:{x:C},backend:o,attrs:{perm:[0,2,1]}}),_.push(L)),i&&(P=fk({inputs:{x:E},backend:o,attrs:{perm:[0,2,1]}}),_.push(P));var B=1===x,W=L;1!==x&&(W=rk({inputs:{x:L},backend:o,attrs:{shape:[A,R,1]}}),_.push(W));var U=1===x?2:1,V=P;B&&(V=rk({inputs:{x:P},backend:o,attrs:{shape:[A,1,R]}}),_.push(V));var G=tk({inputs:{a:W,b:V},backend:o});N=dk({inputs:{x:G},backend:o,attrs:{axis:U,keepDims:!0}}),_.push(G)}else{var H=Object(a.Cf)(t.dtype,n.dtype),q=new Zx(j,T,[A,y,x],r,i,D,z,F,M),K=[C,E];if(null!=u&&K.push(u),F&&K.push(l),M){var X=o.makeTensorInfo([],"float32",a.Df.createScalarValue(p,"float32"));K.push(X),_.push(X)}N=o.runWebGLProgram(q,K,H)}var Y=rk({inputs:{x:N},backend:o,attrs:{shape:S}});_.push(N);for(var Z=0,J=_;Z<J.length;Z++){var Q=J[Z];o.disposeIntermediateTensorInfo(Q)}return Y}var vk={kernelName:a.qd,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.a,i=t.b,o=t.bias,s=t.preluActivationWeights,u=r.transposeA,c=r.transposeB,l=r.activation;return mk({a:a,b:i,transposeA:u,transposeB:c,backend:n,bias:o,preluActivationWeights:s,leakyreluAlpha:r.leakyreluAlpha,activation:l})}};var bk={kernelName:a.a,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,i=n.x;if(r.shouldExecuteOnCPU([i])&&"complex64"!==i.dtype){var o=r.texData.get(i.dataId),s=Zy(o.values);return r.makeTensorInfo(i.shape,i.dtype,s)}return t=Object(a.be)().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new Cx(i.shape,"return abs(x);"):new yx(i.shape,"return abs(x);"),r.runWebGLProgram(t,[i],i.dtype)}},gk=Kx({opSnippet:"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n"}),yk={kernelName:a.b,backendName:"webgl",kernelFunc:gk},xk=Kx({opSnippet:"if (isnan(x)) return x;\n  if (x < 1.0) return NAN;\nreturn log(x + sqrt(x * x - 1.0));"}),kk={kernelName:a.c,backendName:"webgl",kernelFunc:xk},wk="return a + b;",Ok=Xx({opSnippet:wk,packedOpSnippet:wk,supportsComplex:!0,cpuKernelImpl:yy}),Ik={kernelName:a.d,backendName:"webgl",kernelFunc:Ok},Sk=function e(t,n){Object($r.a)(this,e),this.outputShape=[],this.outputShape=t,this.variableNames=n.map((function(e,t){return"T".concat(t)}));var r=[];this.variableNames.forEach((function(e){r.push("float v".concat(e," = get").concat(e,"AtOutCoords();"))}));var a=this.variableNames.map((function(e){return"v".concat(e)})).join(" + ");this.userCode="\n      void main() {\n        ".concat(r.join("\n        "),"\n\n        float result = ").concat(a,";\n        setOutput(result);\n      }\n    ")},Nk=function e(t,n){Object($r.a)(this,e),this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.variableNames=n.map((function(e,t){return"T".concat(t)}));var r=[];this.variableNames.forEach((function(e){r.push("vec4 v".concat(e," = get").concat(e,"AtOutCoords();"))}));var a=this.variableNames.map((function(e){return"v".concat(e)})).join(" + ");this.userCode="\n      void main() {\n        ".concat(r.join("\n        "),"\n\n        vec4 result = ").concat(a,";\n        setOutput(result);\n      }\n    ")};var jk={kernelName:a.e,backendName:"webgl",kernelFunc:function e(t){var n=t.inputs,r=t.backend,i=n;if(1===i.length)return zx({inputs:{x:i[0]},backend:r});if(i.length>Object(a.be)().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var o=Math.floor(i.length/2),s=e({inputs:i.slice(0,o),backend:r}),u=e({inputs:i.slice(o),backend:r});return e({inputs:[s,u],backend:r})}var c=i.map((function(e){return e.dtype})).reduce((function(e,t){return Object(a.Cf)(e,t)})),l=i.map((function(e){return e.shape})),d=Object(a.be)().getBool("WEBGL_PACK")?new Nk(i[0].shape,l):new Sk(i[0].shape,l);return r.runWebGLProgram(d,i,c)}};var Tk={kernelName:a.f,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,o=t.x,s=r.axis,u=r.keepDims,c=o.shape.length,l=a.Df.parseAxisParam(s,o.shape),d=l,p=a.zd.getAxesPermutation(d,c),f=o;null!=p&&(f=fk({inputs:{x:o},backend:n,attrs:{perm:p}}),d=a.zd.getInnerMostAxes(d.length,c)),a.zd.assertAxesAreInnerMostDims("all",d,c);var h,m=a.zd.computeOutAndReduceShapes(f.shape,d),v=Object(i.a)(m,2),b=v[0],g=v[1],y=rk({inputs:{x:f},backend:n,attrs:{shape:[-1,a.Df.sizeFromShape(g)]}}),x=sk(y,y.dtype,"all",n);return h=rk(u?{inputs:{x:x},backend:n,attrs:{shape:a.zd.expandShapeToKeepDim(b,l)}}:{inputs:{x:x},backend:n,attrs:{shape:b}}),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(x),null!=p&&n.disposeIntermediateTensorInfo(f),h}};var Ck={kernelName:a.g,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,o=t.x,s=r.axis,u=r.keepDims,c=o.shape.length,l=a.Df.parseAxisParam(s,o.shape),d=l,p=a.zd.getAxesPermutation(d,c),f=o;null!=p&&(f=fk({inputs:{x:o},backend:n,attrs:{perm:p}}),d=a.zd.getInnerMostAxes(d.length,c)),a.zd.assertAxesAreInnerMostDims("any",d,c);var h,m=a.zd.computeOutAndReduceShapes(f.shape,d),v=Object(i.a)(m,2),b=v[0],g=v[1],y=rk({inputs:{x:f},backend:n,attrs:{shape:[-1,a.Df.sizeFromShape(g)]}}),x=sk(y,y.dtype,"any",n);return h=rk(u?{inputs:{x:x},backend:n,attrs:{shape:a.zd.expandShapeToKeepDim(b,l)}}:{inputs:{x:x},backend:n,attrs:{shape:b}}),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(x),null!=p&&n.disposeIntermediateTensorInfo(f),h}},Ek=function e(t,n,r){Object($r.a)(this,e),this.variableNames=["A"];var a=t.windowSize,i=t.batchSize,o=t.outSize;r||this.variableNames.push("bestIndicesA"),this.outputShape=[i,o];var s="max"===n?">":"<",u=r?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ".concat(a,";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < ").concat(a,"; i++) {\n          int inIdx = ").concat(u,";\n          float candidate = getA(batch, inIdx);\n          if (candidate ").concat(s," bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    ")},_k=function e(t,n,r,i){Object($r.a)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,a.Df.assert(t.length>2,(function(){return"Packed arg".concat(r.charAt(0).toUpperCase()+r.slice(1)," supports only inputs with rank above 2.")}));var o=t[t.length-1],s=Math.ceil(o/n);this.outputShape=t.slice(0,-1),s>1&&this.outputShape.push(s),i||this.variableNames.push("bestIndicesA");var u,c,l=this.outputShape,d=l.length,p=qg(d),f=px("coords",d);if(1===s){var h=qg(c=d+1);u="\n        ".concat(h," sourceLocR = ").concat(h,"(").concat(f.join(),", 0);\n        ++").concat(f[d-1],";\n        ").concat(h," sourceLocG = ").concat(h,"(").concat(f.join(),", 0);\n        ++").concat(f[d-2],";\n        ").concat(h," sourceLocA = ").concat(h,"(").concat(f.join(),", 0);\n        --").concat(f[d-1],";\n        ").concat(h," sourceLocB = ").concat(h,"(").concat(f.join(),", 0);\n        --").concat(f[d-2],";")}else c=d,u="\n        ".concat(p," sourceLocR = coords;\n        ++").concat(f[d-1],";\n        ").concat(p," sourceLocG = coords;\n        ++").concat(f[d-2],";\n        ").concat(p," sourceLocA = coords;\n        --").concat(f[d-1],";\n        ").concat(p," sourceLocB = coords;\n        --").concat(f[d-2],";");var m=["x","y","z","w","u","v"].slice(0,c),v="."+m[c-1],b=m.map((function(e){return"int "+e})),g=px("sourceLocR",c-1).concat("inIdx.r"),y=px("sourceLocG",c-1).concat("inIdx.g"),x=px("sourceLocB",c-1).concat("inIdx.b"),k=px("sourceLocA",c-1).concat("inIdx.a"),w="max"===r?"greaterThan":"lessThan",O=i?"":"\n          inIdx = round(vec4(getBestIndicesAChannel(".concat(g.join(),"),\n                             getBestIndicesAChannel(").concat(y.join(),"),\n                             getBestIndicesAChannel(").concat(x.join(),"),\n                             getBestIndicesAChannel(").concat(k.join(),")));"),I="vec4(\n            getAChannel(".concat(g.join(),"),\n            hasNextCol ? getAChannel(").concat(y.join(),") : 0.,\n            hasNextRow ? getAChannel(").concat(x.join(),") : 0.,\n            hasNextRow && hasNextCol ? getAChannel(").concat(k.join(),") : 0.)"),S=i?"":"\n      float getBestIndicesAChannel(".concat(b.join(),") {\n        return getChannel(getBestIndicesA(").concat(m.join(),"),\n                                          vec2(").concat(m.slice(-2).join(),"));\n      }");this.userCode="\n      float getAChannel(".concat(b.join(),") {\n        return getChannel(getA(").concat(m.join(),"),\n                               vec2(").concat(m.slice(-2).join(),"));\n      }\n      ").concat(S,"\n      void main() {\n        ").concat(p," coords = getOutputCoords();\n        bool hasNextCol = ").concat(f[d-1]," < ").concat(l[d-1]-1,";\n        bool hasNextRow = ").concat(f[d-2]," < ").concat(l[d-2]-1,";\n        ").concat(u,"\n        ivec4 srcIdx = ivec4(sourceLocR").concat(v,", sourceLocG").concat(v,",\n          sourceLocB").concat(v,", sourceLocA").concat(v,") * ").concat(n,";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = ").concat(I,";\n\n        for (int i = 0; i < ").concat(n,"; i++) {\n          inIdx = srcIdx;\n          ").concat(O,"\n          vec4 candidate = ").concat(I,";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4(").concat(w,"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    ")};function Ak(e,t,n,r){var o=[n];if(a.zd.assertAxesAreInnerMostDims("arg"+r.charAt(0).toUpperCase()+r.slice(1),o,t.shape.length),!Object(a.be)().getBool("WEBGL_PACK_REDUCE")||t.shape.length<=2){var s=[],u=e.texData.get(t.dataId),c=t;null!==u&&u.isPacked&&(c=e.unpackTensor(t),s.push(c));var l=a.zd.computeOutAndReduceShapes(c.shape,o),d=Object(i.a)(l,2),p=d[0],f=d[1],h=a.Df.sizeFromShape(f),m=rk({inputs:{x:c},backend:e,attrs:{shape:[-1,h]}});s.push(m);var v=function e(t,n,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=n.shape[0],s=n.shape[1];null!=i&&(o=i.shape[0],s=i.shape[1]);var u=a.zd.computeOptimalWindowSize(s),c={windowSize:u,inSize:s,batchSize:o,outSize:Math.ceil(s/u)},l=new Ek(c,r,null==i),d=[n];null!=i&&d.push(i);var p=t.runWebGLProgram(l,d,"int32");if(1===p.shape[1])return p;var f=e(t,n,r,p);return t.disposeIntermediateTensorInfo(p),f}(e,m,r);s.push(v);var b=rk({inputs:{x:v},backend:e,attrs:{shape:p}});return s.forEach((function(t){return e.disposeIntermediateTensorInfo(t)})),b}return function e(t,n,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=null!=i?i.shape:n.shape,s=o[o.length-1],u=a.zd.computeOptimalWindowSize(s),c=new _k(o,u,r,null==i),l=null==i?[n]:[n,i],d=t.runWebGLProgram(c,l,"int32");if(d.shape.length===n.shape.length){var p=e(t,n,r,d);return t.disposeIntermediateTensorInfo(d),p}return d}(e,t,r)}var Rk={kernelName:a.h,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.x,o=r.axis,s=a.Df.parseAxisParam(o,i.shape),u=a.zd.getAxesPermutation(s,i.shape.length),c=i,l=[];null!=u&&(c=fk({inputs:{x:i},backend:n,attrs:{perm:u}}),l.push(c),s=a.zd.getInnerMostAxes(s.length,c.shape.length)),a.zd.assertAxesAreInnerMostDims("argMax",[s[0]],c.shape.length);var d=Ak(n,c,s[0],"max");return l.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),d}};var Dk={kernelName:a.i,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.x,o=r.axis,s=a.Df.parseAxisParam(o,i.shape),u=a.zd.getAxesPermutation(s,i.shape.length),c=i,l=[];null!=u&&(c=fk({inputs:{x:i},backend:n,attrs:{perm:u}}),l.push(c),s=a.zd.getInnerMostAxes(s.length,c.shape.length)),a.zd.assertAxesAreInnerMostDims("argMin",[s[0]],c.shape.length);var d=Ak(n,c,s[0],"min");return l.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),d}},Fk=Kx({opSnippet:"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n"}),Mk={kernelName:a.j,backendName:"webgl",kernelFunc:Fk},zk=Kx({opSnippet:"if (isnan(x)) return x;return log(x + sqrt(x * x + 1.0));"}),Lk={kernelName:a.k,backendName:"webgl",kernelFunc:zk},Pk=Kx({opSnippet:"if (isnan(x)) return x;\n  return atan(x);\n"}),Bk={kernelName:a.l,backendName:"webgl",kernelFunc:Pk},Wk=Xx({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",packedOpSnippet:"\n  vec4 result = atan(a, b);\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  \n  result.r = isNaN.r ? NAN : result.r;\n  result.g = isNaN.g ? NAN : result.g;\n  result.b = isNaN.b ? NAN : result.b;\n  result.a = isNaN.a ? NAN : result.a;\n\n  return result;\n"}),Uk={kernelName:a.m,backendName:"webgl",kernelFunc:Wk},Vk=Kx({opSnippet:"if (isnan(x)) return x;\n  if ((x < -1.0) || (x > 1.0)) return NAN;\nreturn (log(1.0 + x) - log(1.0 - x)) / 2.0;"}),Gk={kernelName:a.n,backendName:"webgl",kernelFunc:Vk},Hk=function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(Object($r.a)(this,e),this.variableNames=["x"],"avg"===n&&r)throw new Error("Cannot compute positions for average pool.");var o=t.filterWidth,s=t.strideHeight,u=t.strideWidth,c=t.dilationHeight,l=t.dilationWidth,d=t.effectiveFilterHeight,p=t.effectiveFilterWidth,f=t.padInfo.top,h=t.padInfo.left;this.outputShape=t.outShape;var m="avg"===n,v="((batch  * ".concat(t.inHeight," + xR) * ").concat(t.inWidth," + xC) * ").concat(t.inChannels," + d"),b="(xR * ".concat(t.inWidth," + xC) * ").concat(t.inChannels," + d"),g="0.0";if(m||(g="-1.0 / 1e-20"),r){var y=">=";this.userCode="\n        const ivec2 strides = ivec2(".concat(s,", ").concat(u,");\n        const ivec2 pads = ivec2(").concat(f,", ").concat(h,");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < ").concat(d,";\n              wR += ").concat(c,") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(p,";\n                wC += ").concat(l,") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value ").concat(y," currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = ").concat(a?i?v:b:"wR * ".concat(p," + wC"),";\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ")}else{var x="max",k="".concat(n,"(").concat(n,"(").concat(n,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===n&&(k="avgValue / count");var w=4*Math.floor(o/4),O=o%4,I="\n      if (".concat(m,") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = ").concat(x,"(values, minMaxValue);\n      }\n    ");this.userCode="\n      const ivec2 strides = ivec2(".concat(s,", ").concat(u,");\n      const ivec2 pads = ivec2(").concat(f,", ").concat(h,");\n      const float initializationValue = ").concat(g,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= ").concat(t.inWidth,") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(").concat(g,");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < ").concat(d,";\n            wR += ").concat(c,") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= ").concat(t.inHeight,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(w,"; wC += 4) {\n            int xC = xCCorner + wC * ").concat(l,";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              getValue(batch, xR, xC + 2 * ").concat(l,", d),\n              getValue(batch, xR, xC + 3 * ").concat(l,", d)\n            );\n\n            ").concat(I,"\n          }\n\n          int xC = xCCorner + ").concat(w,";\n          if (").concat(1===O,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            ").concat(I,"\n          } else if (").concat(2===O,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              initializationValue,\n              initializationValue\n            );\n\n            ").concat(I,"\n          } else if (").concat(3===O,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              getValue(batch, xR, xC + 2 * ").concat(l,", d),\n              initializationValue\n            );\n\n            ").concat(I,"\n          }\n        }\n        setOutput(").concat(k,");\n      }\n    ")}},qk=function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(Object($r.a)(this,e),this.variableNames=["x"],"avg"===n&&r)throw new Error("Cannot compute positions for average pool.");var o=t.filterWidth,s=t.strideDepth,u=t.strideHeight,c=t.strideWidth,l=t.dilationDepth,d=t.dilationHeight,p=t.dilationWidth,f=t.effectiveFilterDepth,h=t.effectiveFilterHeight,m=t.effectiveFilterWidth,v=t.padInfo.front,b=t.padInfo.top,g=t.padInfo.left;this.outputShape=t.outShape;var y="avg"===n,x="0.0";if(y||(x="-1.0 / 1e-20"),r){var k=">=";this.userCode="\n        const ivec3 strides =\n            ivec3(".concat(s,", ").concat(u,", ").concat(c,");\n        const ivec3 pads = ivec3(").concat(v,", ").concat(b,", ").concat(g,");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < ").concat(f,";\n              wD += ").concat(l,") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= ").concat(t.inDepth,") {\n              continue;\n            }\n\n            for (int wR = 0; wR < ").concat(h,";\n                wR += ").concat(d,") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= ").concat(t.inHeight,") {\n                continue;\n              }\n\n              for (int wC = 0; wC < ").concat(m,";\n                  wC += ").concat(p,") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value ").concat(k," currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition = ").concat(a?i?"(((batch * ".concat(t.inDepth," + xD) * ").concat(t.inHeight," + xR) * ").concat(t.inWidth," + xC) * ").concat(t.inChannels," + ch"):"((xD * ".concat(t.inHeight," + xR) * ").concat(t.inWidth," + xC) * ").concat(t.inChannels," + ch"):"wD * ".concat(h," * ").concat(m," +\n                      wR * ").concat(m," + wC"),";\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ")}else{var w="max",O="".concat(n,"(").concat(n,"(").concat(n,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===n&&(O="avgValue / count");var I=4*Math.floor(o/4),S=o%4,N="\n      if (".concat(y,") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = ").concat(w,"(values, minMaxValue);\n      }\n    ");this.userCode="\n      const ivec3 strides =\n        ivec3(".concat(s,", ").concat(u,", ").concat(c,");\n      const ivec3 pads = ivec3(").concat(v,", ").concat(b,", ").concat(g,");\n      const float initializationValue = ").concat(x,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= ").concat(t.inWidth,") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(").concat(x,");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < ").concat(f,";\n            wD += ").concat(l,") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= ").concat(t.inDepth,") {\n            continue;\n          }\n\n          for (int wR = 0; wR < ").concat(h,";\n            wR += ").concat(d,") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(I,"; wC += 4) {\n              int xC = xCCorner + wC * ").concat(p,";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(p,", ch),\n                getValue(batch, xD, xR, xC + 2 * ").concat(p,", ch),\n                getValue(batch, xD, xR, xC + 3 * ").concat(p,", ch)\n              );\n\n              ").concat(N,"\n            }\n\n            int xC = xCCorner + ").concat(I,";\n            if (").concat(1===S,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              ").concat(N,"\n            } else if (").concat(2===S,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(p,", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              ").concat(N,"\n            } else if (").concat(3===S,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(p,", ch),\n                getValue(batch, xD, xR, xC + 2 * ").concat(p,", ch),\n                initializationValue\n              );\n\n              ").concat(N,"\n            }\n          }\n          setOutput(").concat(O,");\n        }\n      }\n    ")}};var Kk={kernelName:a.o,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.x;yg(i,"avgPool");var o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode;a.Df.assert(a.zd.eitherStridesOrDilationsAreOne(s,1),(function(){return"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(s," and dilations '").concat(1,"'")}));var l=a.zd.computePool2DInfo(i.shape,o,s,1,u,c);if(1===l.filterWidth&&1===l.filterHeight&&a.Df.arraysEqual(l.inShape,l.outShape))return zx({inputs:{x:i},backend:n});var d=new Hk(l,"avg",!1);return n.runWebGLProgram(d,[i],"float32")}};var Xk={kernelName:a.p,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.x,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode,l=r.dataFormat,d=a.zd.computePool3DInfo(i.shape,o,s,[1,1,1],u,c,l),p=new qk(d,"avg",!1);return n.runWebGLProgram(p,[i],"float32")}},Yk=function e(t){Object($r.a)(this,e),this.variableNames=["dy"],this.outputShape=t.inShape;var n=t.filterHeight,r=t.filterWidth,a=t.strideHeight,i=t.strideWidth,o=t.dilationHeight,s=t.dilationWidth,u=t.effectiveFilterHeight,c=t.effectiveFilterWidth,l=u-1-t.padInfo.top,d=c-1-t.padInfo.left,p=1/(n*r);this.userCode="\n      const ivec2 pads = ivec2(".concat(l,", ").concat(d,");\n      const float avgMultiplier = float(").concat(p,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(u,";\n            wR += ").concat(o,") {\n          float dyR = float(dyRCorner + wR) / ").concat(a,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ").concat(c,";\n            wC+= ").concat(s,") {\n            float dyC = float(dyCCorner + wC) / ").concat(i,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},Zk=function e(t){Object($r.a)(this,e),this.variableNames=["dy"],this.outputShape=t.inShape;var n=t.filterDepth,r=t.filterHeight,a=t.filterWidth,i=t.strideDepth,o=t.strideHeight,s=t.strideWidth,u=t.dilationDepth,c=t.dilationHeight,l=t.dilationWidth,d=t.effectiveFilterDepth,p=t.effectiveFilterHeight,f=t.effectiveFilterWidth,h=d-1-t.padInfo.front,m=p-1-t.padInfo.top,v=f-1-t.padInfo.left,b=1/(n*r*a);this.userCode="\n      const ivec3 pads = ivec3(".concat(h,", ").concat(m,", ").concat(v,");\n      const float avgMultiplier = float(").concat(b,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ").concat(d,";\n            wD += ").concat(u,") {\n          float dyD = float(dyDCorner + wD) / ").concat(i,".0;\n\n          if (dyD < 0.0 || dyD >= ").concat(t.outDepth,".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ").concat(p,";\n              wR += ").concat(c,") {\n            float dyR = float(dyRCorner + wR) / ").concat(o,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ").concat(f,";\n                wC += ").concat(l,") {\n              float dyC = float(dyCCorner + wC) / ").concat(s,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")};var Jk={kernelName:a.q,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.dy,o=t.input,s=r.filterSize,u=r.strides,c=r.pad,l=r.dimRoundingMode,d=a.zd.computePool3DInfo(o.shape,s,u,[1,1,1],c,l),p=new Zk(d);return n.runWebGLProgram(p,[i],o.dtype)}};var Qk={kernelName:a.r,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.dy,o=t.input,s=o;yg([i,o],"avgPoolGrad");var u=r.filterSize,c=r.strides,l=r.pad,d=a.zd.computePool2DInfo(s.shape,u,c,1,l),p=new Yk(d);return n.runWebGLProgram(p,[i],s.dtype)}};var $k={kernelName:a.s,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs;return mk({a:t.a,b:t.b,transposeA:r.transposeA,transposeB:r.transposeB,backend:n})}},ew=function e(t,n,r,i,o,s){Object($r.a)(this,e),this.outputShape=[],this.variableNames=["x","mean","variance"],a.zd.assertAndGetBroadcastShape(t,n),a.zd.assertAndGetBroadcastShape(t,r);var u="0.0";null!=i&&(a.zd.assertAndGetBroadcastShape(t,i),this.variableNames.push("offset"),u="getOffsetAtOutCoords()");var c="1.0";null!=o&&(a.zd.assertAndGetBroadcastShape(t,o),this.variableNames.push("scale"),c="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = ".concat(u,";\n        float scale = ").concat(c,";\n        float inv = scale * inversesqrt(variance + float(").concat(s,"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    ")},tw=function e(t,n,r,i,o,s){Object($r.a)(this,e),this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],a.zd.assertAndGetBroadcastShape(t,n),a.zd.assertAndGetBroadcastShape(t,r);var u="vec4(0.0)";null!=i&&(a.zd.assertAndGetBroadcastShape(t,i),this.variableNames.push("offset"),u="getOffsetAtOutCoords()");var c="vec4(1.0)";null!=o&&(a.zd.assertAndGetBroadcastShape(t,o),this.variableNames.push("scale"),c="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        vec4 offset = ".concat(u,";\n        vec4 scale = ").concat(c,";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4(").concat(s,"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    ")},nw={kernelName:a.lb,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.x,o=t.mean,s=t.variance,u=t.offset,c=t.scale;a.Df.assert(o.shape.length===s.shape.length,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),a.Df.assert(null==u||o.shape.length===u.shape.length,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),a.Df.assert(null==c||o.shape.length===c.shape.length,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}));var l=r.varianceEpsilon;null==l&&(l=.001);var d=[i,o,s],p=null;null!=u&&(p=u.shape,d.push(u));var f=null;null!=c&&(f=c.shape,d.push(c));var h=Object(a.be)().getBool("WEBGL_PACK_NORMALIZATION")?new tw(i.shape,o.shape,s.shape,p,f,l):new ew(i.shape,o.shape,s.shape,p,f,l);return n.runWebGLProgram(h,d,d[0].dtype)}},rw=function e(t){Object($r.a)(this,e),this.variableNames=["source"],this.outputShape=t,this.rank=t.length;var n=qg(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];var r,a=function(e){if(1===e)return"sourceLoc";if(e<=6)return aw.slice(0,e).map((function(e){return"sourceLoc."+e})).join(",");throw Error("Slicing for rank ".concat(e," is not yet supported"))}(this.rank),i=t.map((function(e,t){return"sourceLoc.".concat(aw[t]," = start[").concat(t,"] + coords.").concat(aw[t],";")}));r="\n        ".concat(n," sourceLoc;\n        ").concat(n," coords = getOutputCoords();\n        ").concat(i.join("\n"),"\n      "),this.userCode="\n      void main() {\n        ".concat(r,"\n        setOutput(getSource(").concat(a,"));\n      }\n    ")},aw=["x","y","z","w","u","v"];var iw=function e(t){Object($r.a)(this,e),this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];var n=qg(this.rank),r=px("coords",this.rank),a=px("sourceLoc",this.rank),i=1===this.rank?"sourceLoc":"vec2(".concat(a.slice(-2).join(),")"),o="getChannel(getSource(".concat(a.join(),"), ").concat(i,")"),s="\n      result.x = ".concat(o,";\n      if (++").concat(r[this.rank-1]," < ").concat(t[this.rank-1],") {\n        ++").concat(a[this.rank-1],";\n        result.y = ").concat(o,";\n        --").concat(a[this.rank-1],";\n      }\n    "),u=1===this.rank?"":"\n      --".concat(r[this.rank-1],";\n      if (++").concat(r[this.rank-2]," < ").concat(t[this.rank-2],") {\n        ++").concat(a[this.rank-2],";\n        result.z = ").concat(o,";\n        if (++").concat(r[this.rank-1]," < ").concat(t[this.rank-1],") {\n          ++").concat(a[this.rank-1],";\n          result.w = ").concat(o,";\n        }\n      }\n    "),c=this.rank<=4?"sourceLoc = coords +\n            ".concat(n,"(").concat(t.map((function(e,t){return"start[".concat(t,"]")})).join(),");"):t.map((function(e,t){return"".concat(a[t]," = ").concat(r[t]," + start[").concat(t,"];")})).join("\n");this.userCode="\n      void main() {\n        ".concat(n," coords = getOutputCoords();\n        ").concat(n," sourceLoc;\n        ").concat(c,"\n        vec4 result = vec4(0.);\n        ").concat(s,"\n        ").concat(u,"\n        setOutput(result);\n      }\n    ")};function ow(e){var t=e.inputs,n=e.backend,r=e.attrs,o=t.x,s=r.begin,u=r.size,c=a.hf.parseSliceParams(o,s,u),l=Object(i.a)(c,2),d=l[0],p=l[1];if(a.hf.assertParamsValid(o,d,p),0===a.Df.sizeFromShape(p))return n.makeTensorInfo(p,o.dtype,[]);if(n.shouldExecuteOnCPU([o])||"string"===o.dtype){var f=n.texData.get(o.dataId),h=Jy(f.values,d,p,o.shape,o.dtype);return n.makeTensorInfo(p,o.dtype,h)}var m=n.texData.get(o.dataId).isPacked,v=a.hf.isSliceContinous(o.shape,d,p);if(m||!v){var b=Object(a.be)().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new iw(p):new rw(p),g=[d];return n.runWebGLProgram(b,[o],o.dtype,g)}return n.uploadToGPU(o.dataId),function(e,t,n,r){var i=r.texData.get(e.dataId),o=r.makeTensorInfo(n,e.dtype),s=r.texData.get(o.dataId);Object.assign(s,i),s.refCount=1,s.shape=n,s.dtype=e.dtype;var u=a.hf.computeFlatOffset(t,a.Df.computeStrides(e.shape));i.slice&&(u+=i.slice.flatOffset),s.slice={flatOffset:u,origDataId:i.slice&&i.slice.origDataId||e.dataId};var c=r.dataRefCount.get(s.slice.origDataId)||1;return r.dataRefCount.set(s.slice.origDataId,c+1),o}(o,d,p,n)}var sw={kernelName:a.Kc,backendName:"webgl",kernelFunc:ow},uw={kernelName:a.t,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.x,o=r.blockShape,s=r.crops;a.Df.assert(i.shape.length<=4,(function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"}));var u=o.reduce((function(e,t){return e*t})),c=a.zd.getReshaped(i.shape,o,u),l=a.zd.getPermuted(c.length,o.length),d=a.zd.getReshapedPermuted(i.shape,o,u),p=a.zd.getSliceBeginCoords(s,o.length),f=a.zd.getSliceSize(d,s,o.length),h=[],m=rk({inputs:{x:i},backend:n,attrs:{shape:c}}),v=fk({inputs:{x:m},backend:n,attrs:{perm:l}}),b=rk({inputs:{x:v},backend:n,attrs:{shape:d}}),g=ow({inputs:{x:b},backend:n,attrs:{begin:p,size:f}});return h.push(m),h.push(v),h.push(b),h.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),g}};var cw={kernelName:a.u,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=n.readSync(a.dataId),u=n.readSync(i.dataId),c=xy(s,u,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,c)}};var lw={kernelName:a.v,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.s0,i=t.s1,o=n.readSync(r.dataId),s=n.readSync(i.dataId),u=a.zd.assertAndGetBroadcastShape(Array.from(o),Array.from(s));return n.makeTensorInfo([u.length],"int32",Int32Array.from(u))}},dw=Xx({opSnippet:"return float(a != b);",cpuKernelImpl:Uy,dtype:"bool"}),pw={kernelName:a.cc,backendName:"webgl",kernelFunc:dw};function fw(e){var t=e.inputs,n=e.backend,r=t.input;return zx({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.real},backend:n})}var hw={kernelName:a.oc,backendName:"webgl",kernelFunc:fw};var mw={kernelName:a.w,backendName:"webgl",kernelFunc:function e(t){var n=t.inputs,r=t.backend,o=t.attrs,s=n.x,u=o.dtype;if("complex64"===u){if("complex64"===s.dtype)return zx({inputs:{x:s},backend:r});var c=a.If(s.shape),l=e({inputs:{x:s},backend:r,attrs:{dtype:"float32"}}),d=Px({inputs:{real:l,imag:c},backend:r});return c.dispose(),r.disposeIntermediateTensorInfo(l),d}if("complex64"===s.dtype){var p=fw({inputs:{input:s},backend:r}),f=e({inputs:{x:p},backend:r,attrs:{dtype:u}});return r.disposeIntermediateTensorInfo(p),f}if(!a.Df.hasEncodingLoss(s.dtype,u)){var h=zx({inputs:{x:s},backend:r});return{dataId:h.dataId,shape:h.shape,dtype:u}}if(r.shouldExecuteOnCPU([s])){var m=r.texData.get(s.dataId).values,v=wy(m,s.shape,s.dtype,u),b=Object(i.a)(v,3),g=b[0],y=b[1],x=b[2];return r.makeTensorInfo(g,y,x)}if("int32"===u)return function(e,t){var n=new yx(e.shape,"return float(int(x));"),r=t.runWebGLProgram(n,[e],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}(s,r);if("bool"===u){var k=r.makeTensorInfo([],"bool",a.Df.getTypedArrayFromDType("bool",1)),w=dw({inputs:{a:s,b:k},backend:r});return r.disposeIntermediateTensorInfo(k),w}throw new Error("Error in Cast: failed to cast ".concat(s.dtype," to ").concat(u))}},vw="return ceil(x);",bw=Kx({opSnippet:vw,packedOpSnippet:vw,cpuKernelImpl:Oy}),gw={kernelName:a.x,backendName:"webgl",kernelFunc:bw},yw=function e(t){Object($r.a)(this,e),this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode="\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "},xw=function e(t){Object($r.a)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode="\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "};var kw={kernelName:a.y,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,i=e.attrs,o=n.x,s=i.clipValueMin,u=i.clipValueMax;t=Object(a.be)().getBool("WEBGL_PACK_CLIP")?new xw(o.shape):new yw(o.shape);var c=[[s],[u]];return r.runWebGLProgram(t,[o],o.dtype,c)}},ww=function e(t){Object($r.a)(this,e),this.variableNames=["real","imag"],this.outputShape=t,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "};function Ow(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}}var Iw={kernelName:a.A,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=n.texData.get(r.dataId),i=new ww(r.shape),o=[Ow(r,a.complexTensorInfos.real),Ow(r,a.complexTensorInfos.imag)];return n.runWebGLProgram(i,o,o[0].dtype)}},Sw=function e(t){Object($r.a)(this,e),this.outputShape=[],this.outputShape=a.zd.computeOutShape(t,1),this.variableNames=t.map((function(e,t){return"T".concat(t)}));var n=new Array(t.length-1);n[0]=t[0][1];for(var r=1;r<n.length;r++)n[r]=n[r-1]+t[r][1];for(var i=["if (yC < ".concat(n[0],") setOutput(getT0(yR, yC));")],o=1;o<n.length;o++){var s=n[o-1];i.push("else if (yC < ".concat(n[o],") ")+"setOutput(getT".concat(o,"(yR, yC-").concat(s,"));"))}var u=n.length,c=n[n.length-1];i.push("else setOutput(getT".concat(u,"(yR, yC-").concat(c,"));")),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        ".concat(i.join("\n        "),"\n      }\n    ")},Nw=function e(t,n){Object($r.a)(this,e),this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=a.zd.computeOutShape(t,n);var r=this.outputShape,i=r.length,o=qg(i),s=px("coords",i),u=["x","y","z","w","u","v"].slice(0,i);this.variableNames=t.map((function(e,t){return"T".concat(t)}));var c=new Array(t.length-1);c[0]=t[0][n];for(var l=1;l<c.length;l++)c[l]=c[l-1]+t[l][n];for(var d=u[n],p=u.slice(-2),f=u.join(),h="if (".concat(d," < ").concat(c[0],") {\n        return getChannel(\n            getT0(").concat(f,"), vec2(").concat(p.join(),"));\n        }"),m=1;m<c.length;m++){var v=c[m-1];h+="\n        if (".concat(d," < ").concat(c[m],"  && ").concat(d," >= ").concat(c[m-1],") {\n          return getChannel(\n            getT").concat(m,"(").concat(jw(u,d,v),"),\n            vec2(").concat(jw(p,d,v),"));\n        }")}var b=c.length,g=c[c.length-1];h+="\n        return getChannel(\n          getT".concat(b,"(").concat(jw(u,d,g),"),\n          vec2(").concat(jw(p,d,g),"));"),this.userCode="\n      float getValue(".concat(u.map((function(e){return"int "+e})),") {\n        ").concat(h,"\n      }\n\n      void main() {\n        ").concat(o," coords = getOutputCoords();\n        vec4 result = vec4(getValue(").concat(s,"), 0., 0., 0.);\n\n        ").concat(s[i-1]," = ").concat(s[i-1]," + 1;\n        if (").concat(s[i-1]," < ").concat(r[i-1],") {\n          result.g = getValue(").concat(s,");\n        }\n\n        ").concat(s[i-2]," = ").concat(s[i-2]," + 1;\n        if (").concat(s[i-2]," < ").concat(r[i-2],") {\n          result.a = getValue(").concat(s,");\n        }\n\n        ").concat(s[i-1]," = ").concat(s[i-1]," - 1;\n        if (").concat(s[i-2]," < ").concat(r[i-2]," &&\n            ").concat(s[i-1]," < ").concat(r[i-1],") {\n          result.b = getValue(").concat(s,");\n        }\n        setOutput(result);\n      }\n    ")};function jw(e,t,n){var r=e.indexOf(t);return e.map((function(e,t){return t===r?"".concat(e," - ").concat(n):e})).join()}function Tw(e){var t=e.inputs,n=e.backend,r=t.input;return zx({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.imag},backend:n})}var Cw={kernelName:a.ub,backendName:"webgl",kernelFunc:Tw};function Ew(e,t,n){var r=e[0].dtype;if("complex64"===r){var i=e.map((function(e){return fw({inputs:{input:e},backend:n})})),o=e.map((function(e){return Tw({inputs:{input:e},backend:n})})),s=Ew(i,t,n),u=Ew(o,t,n),c=Px({inputs:{real:s,imag:u},backend:n});return i.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),o.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(u),c}var l=n.shouldExecuteOnCPU(e);if("string"===r&&(l=!0),l){var d=e.map((function(e){var r=a.Df.sizeFromShape(e.shape.slice(t));return rk({inputs:{x:e},backend:n,attrs:{shape:[-1,r]}})})),p=d.map((function(e){return{vals:n.readSync(e.dataId),shape:e.shape}})),f=a.zd.computeOutShape(d.map((function(e){return e.shape})),1),h=1===d[0].shape[0],m=Iy(p,f,r,h),v=a.zd.computeOutShape(e.map((function(e){return e.shape})),t),b=n.makeTensorInfo(v,r,m);return d.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),b}var g=Object(a.be)().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(e.length>g){for(var y=[],x=0;x<e.length;x+=g){var k=e.slice(x,x+g);y.push(Ew(k,t,n))}for(var w=Ew(y,t,n),O=0,I=y;O<I.length;O++){var S=I[O];n.disposeIntermediateTensorInfo(S)}return w}if(Object(a.be)().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&e[0].shape.length>1){var N=new Nw(e.map((function(e){return e.shape})),t);return n.runWebGLProgram(N,e,r)}var j=function(e,t,n){var r=a.zd.computeOutShape(e.map((function(e){return e.shape})),t);return{tensors2D:e.map((function(e){return rk({inputs:{x:e},attrs:{shape:[-1,a.Df.sizeFromShape(e.shape.slice(t))]},backend:n})})),outShape:r}}(e,t,n),T=j.tensors2D,C=j.outShape,E=new Sw(T.map((function(e){return e.shape}))),_=n.runWebGLProgram(E,T,r);T.forEach((function(e){return n.disposeIntermediateTensorInfo(e)}));var A=rk({inputs:{x:_},attrs:{shape:C},backend:n});return n.disposeIntermediateTensorInfo(_),A}function _w(e){var t=e.inputs,n=e.backend,r=e.attrs.axis,i=a.Df.parseAxisParam(r,t[0].shape)[0],o=t.map((function(e){return e.shape}));a.zd.assertParamsConsistent(o,i);var s=a.zd.computeOutShape(t.map((function(e){return e.shape})),i);if(0===a.Df.sizeFromShape(s))return n.makeTensorInfo(s,t[0].dtype,[]);var u=t.filter((function(e){return a.Df.sizeFromShape(e.shape)>0}));return 1===u.length?zx({inputs:{x:u[0]},backend:n}):Ew(u,i,n)}var Aw={kernelName:a.B,backendName:"webgl",kernelFunc:_w},Rw=function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];Object($r.a)(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var o=t.padInfo.top,s=t.padInfo.left,u=t.strideHeight,c=t.strideWidth,l=t.dilationHeight,d=t.dilationWidth,p=t.filterHeight,f=t.filterWidth,h=4*Math.floor(t.inChannels/4),m=t.inChannels%4,v="channelsLast"===t.dataFormat,b=v?1:2,g=v?2:3,y=v?3:1,x="",k="";r&&(x=a?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ".concat(r,"\n        }"):i?"float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ".concat(r,"\n        }"):"\n          float activation(float x) {\n            ".concat(r,"\n          }\n        "),k="result = activation(result);");var w=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(x,"\n\n      const ivec2 strides = ivec2(").concat(u,", ").concat(c,");\n      const ivec2 pads = ivec2(").concat(o,", ").concat(s,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[").concat(y,"];\n\n        ivec2 xRCCorner =\n            ivec2(coords[").concat(b,"], coords[").concat(g,"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(p,"; wR++) {\n          int xR = xRCorner + wR * ").concat(l,";\n\n          if (xR < 0 || xR >= ").concat(t.inHeight,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(f,"; wC++) {\n            int xC = xCCorner + wC * ").concat(d,";\n\n            if (xC < 0 || xC >= ").concat(t.inWidth,") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < ").concat(h,"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if (").concat(v,") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if (").concat(1===m,") {\n\n              if (").concat(v,") {\n                dotProd +=\n                    getX(batch, xR, xC, ").concat(h,") *\n                    getW(wR, wC, ").concat(h,", d2);\n              } else {\n                dotProd +=\n                    getX(batch, ").concat(h,", xR, xC) *\n                    getW(wR, wC, ").concat(h,", d2);\n              }\n\n            } else if (").concat(2===m,") {\n              vec2 wValues = vec2(\n                getW(wR, wC, ").concat(h,", d2),\n                getW(wR, wC, ").concat(h," + 1, d2)\n              );\n\n              if (").concat(v,") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, ").concat(h,"),\n                  getX(batch, xR, xC, ").concat(h," + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, ").concat(h,", xR, xC),\n                  getX(batch, ").concat(h," + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if (").concat(3===m,") {\n              vec3 wValues = vec3(\n                getW(wR, wC, ").concat(h,", d2),\n                getW(wR, wC, ").concat(h," + 1, d2),\n                getW(wR, wC, ").concat(h," + 2, d2)\n              );\n\n              if (").concat(v,") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, ").concat(h,"),\n                  getX(batch, xR, xC, ").concat(h," + 1),\n                  getX(batch, xR, xC, ").concat(h," + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, ").concat(h,", xR, xC),\n                  getX(batch, ").concat(h," + 1, xR, xC),\n                  getX(batch, ").concat(h," + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        ").concat(w,"\n        ").concat(k,"\n        setOutput(result);\n      }\n    ")},Dw=function e(t){Object($r.a)(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var n=t.padInfo.front,r=t.padInfo.top,a=t.padInfo.left,i=t.strideDepth,o=t.strideHeight,s=t.strideWidth,u=t.dilationDepth,c=t.dilationHeight,l=t.dilationWidth,d=t.filterDepth,p=t.filterHeight,f=t.filterWidth,h=4*Math.floor(t.inChannels/4),m=t.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3(".concat(i,", ").concat(o,", ").concat(s,");\n      const ivec3 pads = ivec3(").concat(n,", ").concat(r,", ").concat(a,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ").concat(d,"; wF++) {\n          int xF = xFCorner + wF * ").concat(u,";\n\n          if (xF < 0 || xF >= ").concat(t.inDepth,") {\n            continue;\n          }\n\n          for (int wR = 0; wR < ").concat(p,"; wR++) {\n            int xR = xRCorner + wR * ").concat(c,";\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(f,"; wC++) {\n              int xC = xCCorner + wC * ").concat(l,";\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < ").concat(h,"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if (").concat(1===m,") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, ").concat(h,") *\n                  getW(wF, wR, wC, ").concat(h,", d2);\n              } else if (").concat(2===m,") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, ").concat(h,"),\n                  getX(batch, xF, xR, xC, ").concat(h," + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, ").concat(h,", d2),\n                  getW(wF, wR, wC, ").concat(h," + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if (").concat(3===m,") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, ").concat(h,"),\n                  getX(batch, xF, xR, xC, ").concat(h," + 1),\n                  getX(batch, xF, xR, xC, ").concat(h," + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, ").concat(h,", d2),\n                  getW(wF, wR, wC, ").concat(h," + 1, d2),\n                  getW(wF, wR, wC, ").concat(h," + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},Fw=function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];Object($r.a)(this,e),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=ty(this.outputShape.length);for(var s=t.padInfo.left,u=t.strideWidth,c=t.dilationWidth,l=t.filterHeight,d=t.filterWidth,p=d,f="\n       int xR; int xC; int xCOffset;\n       vec4 wTexel; vec4 previous; vec4 final;",h=0;h<d;h++)f+="\n           vec4 xTexelC".concat(2*h,";\n           int xTexelC").concat(2*h,"Ready;\n           vec4 xTexelC").concat(2*h+1,";\n           int xTexelC").concat(2*h+1,"Ready;\n           vec4 xC").concat(h,";");f+="\n     for (int r = 0; r < ".concat(l,"; r++) {\n      for (int d1 = 0; d1 < ").concat(t.inChannels,"; d1 += 2) {\n       ");for(var m=0;m<d;m++)f+="\n           xTexelC".concat(2*m," = vec4(0.0);\n           xTexelC").concat(2*m,"Ready = 0;\n           xTexelC").concat(2*m+1," = vec4(0.0);\n           xTexelC").concat(2*m+1,"Ready = 0;\n           xC").concat(m," = vec4(0.0);");f+="\n         xR = xRCorner + r * dilations[0];\n         if (xR >=0 && xR < inDims[0]) {\n       ";for(var v=0;v<(p+1)/2;v++){var b=2*v;if(f+="\n           xC = xCCorner + ".concat(b*c,";\n           "),1===u){if(b<d&&(s%2===1?(f+="\n                 xCOffset = xC + 1;\n                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(b,"Ready == 0) {\n                   xTexelC").concat(b," = getX(batch, xR, xCOffset, d1);\n\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC").concat(b,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(b,"Ready = 1;\n                 }\n               "),f+=1===c&&b>0?"\n                 xC".concat(b," = vec4(xTexelC").concat(b-2,".zw, xTexelC").concat(b,".xy);\n                 "):"\n                   xCOffset = xC + 1 - 2;\n\n                   if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                     previous = getX(batch, xR, xCOffset, d1);\n\n                     // Need to manually clear unused channels in case\n                     // we're reading from recycled texture.\n                     if (xCOffset + 1 >= inDims[1]) {\n                       previous.zw = vec2(0.0);\n                     }\n\n                     xC".concat(b," = vec4(previous.zw, xTexelC").concat(b,".xy);\n                   } else {\n                     xC").concat(b," = vec4(0.0, 0.0, xTexelC").concat(b,".xy);\n                   }\n                   ")):f+="\n                 if (xC >= 0 && xC < inDims[1] && xTexelC".concat(b,"Ready == 0) {\n                   xTexelC").concat(b," = getX(batch, xR, xC, d1);\n                   if (xC + 1 >= inDims[1]) {\n                     xTexelC").concat(b,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(b,"Ready = 1;\n                 }\n\n                 xC").concat(b," = xTexelC").concat(b,";\n                 "),b+1<d)){var g=s%2===0?a.Df.nearestLargerEven(c):c;c%2===0&&s%2===1||c%2!==0&&s%2!==1?(f+="\n                   xCOffset = xC + imod(pads[1], 2) + ".concat(g,";\n\n                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(b+1,"Ready == 0) {\n                     xTexelC").concat(b+1," = getX(batch, xR, xCOffset, d1);\n\n                     // Need to manually clear unused channels in case\n                     // we're reading from recycled texture.\n                     if (xCOffset + 1 >= inDims[1]) {\n                       xTexelC").concat(b+1,".zw = vec2(0.0);\n                     }\n                     xTexelC").concat(b+1,"Ready = 1;\n                   }\n                   "),f+=c>1?"\n                     xCOffset -= 2;\n                     if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                      previous = getX(batch, xR, xCOffset, d1);\n                      xC".concat(b+1," = vec4(previous.zw, xTexelC").concat(b+1,".xy);\n                     } else {\n                      xC").concat(b+1," = vec4(0.0, 0.0, xTexelC").concat(b+1,".xy);\n                     }\n                     "):"\n                     xC".concat(b+1," = vec4(xTexelC").concat(b,".zw, xTexelC").concat(b+1,".xy);\n                     ")):f+=1===g?"\n                     xC".concat(b+1," = xTexelC").concat(b,";\n                     "):"\n                     xCOffset = xC + ".concat(g,";\n\n                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(b+1,"Ready == 0) {\n                       xTexelC").concat(b+1," = getX(batch, xR, xCOffset, d1);\n                       if (xCOffset + 1 >= inDims[1]) {\n                         xTexelC").concat(b+1,".zw = vec2(0.0);\n                       }\n                       xTexelC").concat(b+1,"Ready = 1;\n                     }\n\n                     xC").concat(b+1," = xTexelC").concat(b+1,";\n                     ")}}else b<d&&(s%2===1?(f+="\n                 xCOffset = xC + 1 - strides[1];\n                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(b,"Ready == 0) {\n                   xTexelC").concat(b," = getX(batch, xR, xCOffset, d1);\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC").concat(b,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(b,"Ready = 1;\n                 }\n\n                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC").concat(b+1,"Ready == 0) {\n                   xTexelC").concat(b+1," = getX(batch, xR, xC + 1, d1);\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xC + 2 >= inDims[1]) {\n                     xTexelC").concat(b+1,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(b+1,"Ready = 1;\n                 }\n\n                 xC").concat(b," = vec4(xTexelC").concat(b,".zw, xTexelC").concat(b+1,".zw);\n               "),b+1<d&&(f+="\n                   final = vec4(0.0);\n                   xCOffset = xC + 1 + strides[1];\n                   if(xCOffset >= 0 && xCOffset < inDims[1]) {\n                     final = getX(batch, xR, xCOffset, d1);\n                   }\n                   xC".concat(b+1," = vec4(xTexelC").concat(b+1,".xy, final.xy);\n                 "))):(f+="\n                 if(xC >= 0 && xC < inDims[1] && xTexelC".concat(b,"Ready == 0) {\n                   xTexelC").concat(b," = getX(batch, xR, xC, d1);\n                   if (xC + 1 >= inDims[1]) {\n                     xTexelC").concat(b,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(b,"Ready = 1;\n                 }\n\n                 xCOffset = xC + strides[1];\n                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(b+1,"Ready == 0) {\n                   xTexelC").concat(b+1," = getX(batch, xR, xCOffset, d1);\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC").concat(b+1,".zw = vec2(0.);\n                   }\n                   xTexelC").concat(b+1,"Ready = 1;\n                 }\n\n                 xC").concat(b," = vec4(\n                   xTexelC").concat(b,".xy, xTexelC").concat(b+1,".xy);\n               "),b+1<d&&(f+="\n                   xC".concat(b+1," = vec4(xTexelC").concat(b,".zw, xTexelC").concat(b+1,".zw);\n                 "))));b<d&&(f+="\n             wTexel = getW(r, ".concat(b,", d1, d2);\n             dotProd += xC").concat(b,".xxzz * vec4(wTexel.xy, wTexel.xy);\n             if(d1 + 1 < ").concat(t.inChannels,") {\n               dotProd += xC").concat(b,".yyww * vec4(wTexel.zw, wTexel.zw);\n             }\n           "),b+1<d&&(f+="\n               wTexel = getW(r, ".concat(b+1,", d1, d2);\n               dotProd += xC").concat(b+1,".xxzz * vec4(wTexel.xy, wTexel.xy);\n               if(d1 + 1 < ").concat(t.inChannels,") {\n                 dotProd += xC").concat(b+1,".yyww * vec4(wTexel.zw, wTexel.zw);\n               }\n             ")))}f+="\n     }\n   ",f+="\n     }\n   ",f+="\n     }\n   ";var y="",x="";r&&(y=i?"vec4 activation(vec4 a) {\n           vec4 b = getPreluActivationWeightsAtOutCoords();\n           ".concat(r,"\n         }"):o?"vec4 activation(vec4 a) {\n           vec4 b = getLeakyreluAlphaAtOutCoords();\n           ".concat(r,"\n         }"):"vec4 activation(vec4 x) {\n           ".concat(r,"\n         }"),x="result = activation(result);");var k=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n       ".concat(y,"\n\n       void main() {\n         ivec4 coords = getOutputCoords();\n         int batch = coords.x;\n         ivec2 xRCCorner = coords.yz * strides - pads;\n         int d2 = coords.w;\n         int xRCorner = xRCCorner.x;\n         int xCCorner = xRCCorner.y;\n\n         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.\n         vec4 dotProd = vec4(0.000000000000001);\n\n         ").concat(f,"\n\n         vec4 result = dotProd - vec4(0.000000000000001);\n         ").concat(k,"\n         ").concat(x,"\n         setOutput(result);\n       }\n     ")},Mw=function e(t,n){Object($r.a)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=t,this.enableShapeUniforms=ty(this.outputShape.length);for(var r=n.dataFormat,a=kg(),i="channelsLast"===r,o=i?1:2,s=i?2:3,u=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":"if(blockIndex < ".concat(t[2]," && pos < ").concat(t[1],") {"),c="",l=0;l<=1;l++)for(var d=0;d<=1;d++)c+="\n          blockIndex = rc.z + ".concat(d,";\n          pos = rc.y + ").concat(l,";\n\n          ").concat(u,"\n            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];\n            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);\n\n            if(d0 < inputShape[").concat(o,"] && d0 >= 0) {\n              // Use custom imod instead mod. On Intel GPU, mod may generate\n              // unexpected value.\n              // https://github.com/tensorflow/tfjs/issues/5447\n              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];\n              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /\n                  inChannels);\n\n              if(d1 < inputShape[").concat(s,"] && d1 >= 0) {\n\n                ch = imod(pos, inChannels);\n\n                if (").concat(i,") {\n                  innerDims = vec2(d1, ch);\n                  result[").concat(2*l+d,"] = getChannel(\n                    getA(rc.x, d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result[").concat(2*l+d,"] = getChannel(\n                    getA(rc.x, ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ");this.userCode="\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        ".concat(c,"\n\n        ").concat(a.output," = result;\n      }\n    ")};function zw(e,t){var n=e.length;return n>=3?[].concat(Object(qn.a)(e.slice(0,-3)),t?[e[n-3]*e[n-2],e[n-1]]:[e[n-3],e[n-2]*e[n-1]]):!t&&1===n&&e[0]>1?[e[0],1]:null}function Lw(e){var t,n=e.x,r=e.filter,i=e.convInfo,o=e.backend,s=e.bias,u=void 0===s?null:s,c=e.preluActivationWeights,l=void 0===c?null:c,d=e.leakyreluAlpha,p=void 0===d?0:d,f=e.activation,h=void 0===f?null:f,m=n.shape,v=o.texData.get(n.dataId),b=i.inChannels,g=m[0]*m[1]*m[2],y=i.outChannels,x="channelsLast"===i.dataFormat,k=[];if(null!=l){var w=zw(l.shape,x);null!=w&&(l=rk({inputs:{x:l},backend:o,attrs:{shape:w}}),k.push(l))}if(null!=u){var O=zw(u.shape,x);null!=O&&(u=rk({inputs:{x:u},backend:o,attrs:{shape:O}}),k.push(u))}if(!((1===g||1===y)&&b>1e3)&&v.isPacked&&x&&null!=v.texture&&m[2]%2!==0&&a.Df.arraysEqual(v.shape.slice(-3),m.slice(-3))){var I=m[0]*m[1]*(m[2]+1),S={dataId:n.dataId,shape:[1,I,i.inChannels],dtype:n.dtype},N=v.shape;v.shape=v.shape.slice(),v.shape[v.shape.length-2]++,a.Df.assert(hg(v.shape,S.shape),(function(){return"packed reshape ".concat(v.shape," to ").concat(S.shape," isn't free")}));var j=rk({inputs:{x:r},backend:o,attrs:{shape:[1,i.inChannels,i.outChannels]}});k.push(j);var T=mk({a:S,b:j,backend:o,transposeA:!1,transposeB:!1,bias:u,activation:h,preluActivationWeights:l,leakyreluAlpha:p}),C=o.texData.get(T.dataId);a.Df.assert(C.isPacked,(function(){return"batchMatMul result is expected to be packed"})),v.shape=N,C.shape=i.outShape,(t=zx({inputs:{x:T},backend:o})).shape=i.outShape,k.push(T)}else{var E=i.outHeight*i.outWidth,_=rk({inputs:{x:n},backend:o,attrs:{shape:x?[i.batchSize,E,i.inChannels]:[i.batchSize,i.inChannels,E]}}),A=rk({inputs:{x:r},backend:o,attrs:{shape:[1,i.inChannels,i.outChannels]}}),R=mk({a:x?_:A,b:x?A:_,transposeA:!x,transposeB:!1,backend:o,bias:u,activation:h,preluActivationWeights:l,leakyreluAlpha:p});t=rk({inputs:{x:R},backend:o,attrs:{shape:i.outShape}}),k.push(_),k.push(A),k.push(R)}for(var D=0,F=k;D<F.length;D++){var M=F[D];o.disposeIntermediateTensorInfo(M)}return t}function Pw(e){var t=e.x,n=e.filter,r=e.convInfo,i=e.backend,o=e.bias,s=void 0===o?null:o,u=e.preluActivationWeights,c=void 0===u?null:u,l=e.leakyreluAlpha,d=void 0===l?0:l,p=e.activation,f=void 0===p?null:p,h=r.filterWidth,m=r.filterHeight,v=r.inChannels,b=r.outWidth,g=r.outHeight,y="channelsLast"===r.dataFormat,x=h*m*v,k=g*b,w=[r.batchSize,x,k],O=[];if(null!=c){var I=zw(c.shape,y);null!=I&&(c=rk({inputs:{x:c},backend:i,attrs:{shape:I}}),O.push(c))}if(null!=s){var S=zw(s.shape,y);null!=S&&(s=rk({inputs:{x:s},backend:i,attrs:{shape:S}}),O.push(s))}var N=rk({inputs:{x:n},backend:i,attrs:{shape:[1,x,a.Df.sizeFromShape(n.shape)/x]}});O.push(N);var j=new Mw(w,r),T=[t.shape,[r.padInfo.top,r.padInfo.left],[r.strideHeight,r.strideWidth],[r.dilationHeight,r.dilationWidth],[r.inChannels],[r.filterWidth*r.inChannels],[r.outWidth]],C=i.runWebGLProgram(j,[t],"float32",T),E=rk({inputs:{x:C},backend:i,attrs:{shape:w}});O.push(C),O.push(E);var _=null!=s,A=null!=c,R="leakyrelu"===f,D=f?Yx(f,!0):null,F=new Zx(y?E.shape:N.shape,y?N.shape:E.shape,y?[r.batchSize,k,r.outChannels]:[r.batchSize,r.outChannels,k],!0,!1,_,D,A,R),M=y?[E,N]:[N,E];if(s&&M.push(s),A&&M.push(c),R){var z=i.makeTensorInfo([],"float32",a.Df.createScalarValue(d,"float32"));M.push(z),O.push(z)}var L=i.runWebGLProgram(F,M,"float32"),P=rk({inputs:{x:L},backend:i,attrs:{shape:r.outShape}});O.push(L);for(var B=0,W=O;B<W.length;B++){var U=W[B];i.disposeIntermediateTensorInfo(U)}return P}var Bw={kernelName:a.C,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,i=e.attrs,o=n.x,s=n.filter,u=i.strides,c=i.pad,l=i.dataFormat,d=i.dilations,p=i.dimRoundingMode,f=a.zd.convertConv2DDataFormat(l),h=a.zd.computeConv2DInfo(o.shape,s.shape,u,d,c,p,!1,f);if(1!==h.filterHeight||1!==h.filterWidth||1!==h.dilationHeight||1!==h.dilationWidth||1!==h.strideHeight||1!==h.strideWidth||"SAME"!==h.padInfo.type&&"VALID"!==h.padInfo.type)if(h.strideWidth<=2&&"channelsLast"===f&&Object(a.be)().getBool("WEBGL_EXP_CONV")){var m=new Fw(h),v=[[h.padInfo.top,h.padInfo.left],[h.strideHeight,h.strideWidth],[h.dilationHeight,h.dilationWidth],[h.inHeight,h.inWidth]];t=r.runWebGLProgram(m,[o,s],"float32",v)}else if(Object(a.be)().getBool("WEBGL_CONV_IM2COL"))t=Pw({x:o,filter:s,convInfo:h,backend:r});else{var b=new Rw(h);t=r.runWebGLProgram(b,[o,s],"float32")}else t=Lw({x:o,filter:s,convInfo:h,backend:r});var g=rk({inputs:{x:t},backend:r,attrs:{shape:h.outShape}});return r.disposeIntermediateTensorInfo(t),g}},Ww=function e(t){Object($r.a)(this,e),this.variableNames=["x","dy"],this.outputShape=t.filterShape;var n=t.strideHeight,r=t.strideWidth,a=t.padInfo.top,i=t.padInfo.left,o="channelsLast"===t.dataFormat;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ".concat(t.batchSize,"; b++) {\n          for (int yR = 0; yR < ").concat(t.outHeight,"; yR++) {\n            int xR = wR + yR * ").concat(n," - ").concat(a,";\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int yC = 0; yC < ").concat(t.outWidth,"; yC++) {\n              int xC = wC + yC * ").concat(r," - ").concat(i,";\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              if (").concat(o,") {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},Uw=function e(t){Object($r.a)(this,e),this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterHeight,r=t.filterWidth,a=t.strideHeight,i=t.strideWidth,o="channelsLast"===t.dataFormat,s=n-1-t.padInfo.top,u=r-1-t.padInfo.left,c=o?1:2,l=o?2:3,d=o?3:1;this.userCode="\n      const ivec2 pads = ivec2(".concat(s,", ").concat(u,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[").concat(d,"];\n\n        ivec2 dyCorner = ivec2(coords[").concat(c,"], coords[").concat(l,"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(n,"; wR++) {\n          float dyR = float(dyRCorner + wR) / ").concat(a,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ").concat(n," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(r,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(i,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ").concat(r," - 1 - wC;\n\n            for (int d2 = 0; d2 < ").concat(t.outChannels,"; d2++) {\n\n              if (").concat(o,") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},Vw=function e(t){Object($r.a)(this,e),this.variableNames=["x","dy"],this.outputShape=t.filterShape;var n=t.strideDepth,r=t.strideHeight,a=t.strideWidth,i=t.padInfo.front,o=t.padInfo.top,s=t.padInfo.left;this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ".concat(t.batchSize,"; b++) {\n          for (int yF = 0; yF < ").concat(t.outDepth,"; yF++) {\n            int xF = wF + yF * ").concat(n," - ").concat(i,";\n\n            if (xF < 0 || xF >= ").concat(t.inDepth,") {\n              continue;\n            }\n\n            for (int yR = 0; yR < ").concat(t.outHeight,"; yR++) {\n              int xR = wR + yR * ").concat(r," - ").concat(o,";\n\n              if (xR < 0 || xR >= ").concat(t.inHeight,") {\n                continue;\n              }\n\n              for (int yC = 0; yC < ").concat(t.outWidth,"; yC++) {\n                int xC = wC + yC * ").concat(a," - ").concat(s,";\n\n                if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},Gw=function e(t){Object($r.a)(this,e),this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterDepth,r=t.filterHeight,a=t.filterWidth,i=t.strideDepth,o=t.strideHeight,s=t.strideWidth,u=n-1-t.padInfo.front,c=r-1-t.padInfo.top,l=a-1-t.padInfo.left;this.userCode="\n      const ivec3 pads = ivec3(".concat(u,", ").concat(c,", ").concat(l,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ").concat(n,"; wF++) {\n          float dyF = float(dyFCorner + wF) / ").concat(i,".0;\n\n          if (dyF < 0.0 || dyF >= ").concat(t.outDepth,".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = ").concat(n," - 1 - wF;\n\n          for (int wR = 0; wR < ").concat(r,"; wR++) {\n            float dyR = float(dyRCorner + wR) / ").concat(o,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = ").concat(r," - 1 - wR;\n\n            for (int wC = 0; wC < ").concat(a,"; wC++) {\n              float dyC = float(dyCCorner + wC) / ").concat(s,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = ").concat(a," - 1 - wC;\n\n              for (int d2 = 0; d2 < ").concat(t.outChannels,"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")};var Hw={kernelName:a.D,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.x,o=t.dy,s=r.strides,u=r.pad,c=r.dataFormat,l=r.dimRoundingMode,d=r.filterShape,p=a.zd.convertConv2DDataFormat(c),f=a.zd.computeConv2DInfo(i.shape,d,s,1,u,l,!1,p),h=new Ww(f);return n.runWebGLProgram(h,[i,o],"float32")}};var qw={kernelName:a.E,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.dy,o=t.filter,s=r.inputShape,u=r.strides,c=r.pad,l=r.dataFormat,d=r.dimRoundingMode,p=a.zd.convertConv2DDataFormat(l),f=a.zd.computeConv2DInfo(s,o.shape,u,1,c,d,!1,p),h=new Uw(f);return n.runWebGLProgram(h,[i,o],"float32")}};var Kw={kernelName:a.F,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.x,o=t.filter,s=r.strides,u=r.pad,c=r.dilations,l=a.zd.computeConv3DInfo(i.shape,o.shape,s,c,u),d=new Dw(l);return n.runWebGLProgram(d,[i,o],"float32")}};var Xw={kernelName:a.G,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.x,o=t.dy,s=r.strides,u=r.pad,c=r.filterShape,l=a.zd.computeConv3DInfo(i.shape,c,s,1,u),d=new Vw(l);return n.runWebGLProgram(d,[i,o],"float32")}};var Yw,Zw={kernelName:a.H,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.dy,o=t.filter,s=r.pad,u=r.strides,c=r.inputShape,l=a.zd.computeConv3DInfo(c,o.shape,u,1,s),d=new Gw(l);return n.runWebGLProgram(d,[i,o],"float32")}},Jw=Kx({opSnippet:"if (isnan(x)) return x;\n  return cos(x);\n"}),Qw={kernelName:a.I,backendName:"webgl",kernelFunc:Jw},$w=Kx({opSnippet:"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n"}),eO={kernelName:a.J,backendName:"webgl",kernelFunc:$w},tO=function e(t,n,r,a,o){Object($r.a)(this,e),this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var s=Object(i.a)(t,4),u=s[0],c=s[1],l=s[2],d=s[3],p=Object(i.a)(n,1)[0],f=Object(i.a)(r,2),h=f[0],m=f[1];this.outputShape=[p,h,m,d];var v="bilinear"===a?1:0,b="".concat(c-1,".0"),g="".concat(l-1,".0"),y=h>1?["".concat((c-1)/(h-1)),"(y2-y1) * height_ratio","y1*".concat(b," + float(y)*(height_scale)")]:["0.0","0.0","0.5 * (y1+y2) * ".concat(b)],x=Object(i.a)(y,3),k=x[0],w=x[1],O=x[2],I=m>1?["".concat((l-1)/(m-1)),"(x2-x1) * width_ratio","x1*".concat(g," + float(x)*(width_scale)")]:["0.0","0.0","0.5 * (x1+x2) * ".concat(g)],S=Object(i.a)(I,3),N=S[0],j=S[1],T=S[2];this.userCode="\n      const float height_ratio = float(".concat(k,");\n      const float width_ratio = float(").concat(N,");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= ").concat(u,") {\n          return;\n        }\n\n        float height_scale = ").concat(w,";\n        float width_scale = ").concat(j,";\n\n        float in_y = ").concat(O,";\n        if( in_y < 0.0 || in_y > ").concat(b," ) {\n          setOutput(float(").concat(o,"));\n          return;\n        }\n        float in_x = ").concat(T,";\n        if( in_x < 0.0 || in_x > ").concat(g," ) {\n          setOutput(float(").concat(o,"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if(").concat(v," == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    ")},nO={kernelName:a.K,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.image,i=t.boxes,o=t.boxInd,s=r.cropSize,u=r.method,c=r.extrapolationValue,l=new tO(a.shape,i.shape,s,u,c);return n.runWebGLProgram(l,[a,i,o],"float32")}};!function(e){e.Prod="*",e.Sum="+"}(Yw||(Yw={}));var rO=function e(t,n,r,a){Object($r.a)(this,e),this.op=t,this.outputShape=n,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];var i=this.outputShape.length,o=this.op===Yw.Prod?"1.0":"0.0",s=r?o:"getX(".concat(aO(i,"coords",this.op),")"),u=this.outputShape[this.outputShape.length-1],c="",l="";r?(c=a?"end != ".concat(u-1):"end != 0",l=a?"end + 1":"end - 1"):(c=a?"end + pow2 < ".concat(u):"end >= pow2",l=a?"end + pow2":"end - pow2"),this.userCode="\n      void main() {\n        ".concat(qg(i)," coords = getOutputCoords();\n        int end = ").concat(iO(i,"coords",this.op),";\n        float val = ").concat(s,";\n        int pow2 = int(pow(2.0, index));\n        if (").concat(c,") {\n          int idx = ").concat(l,";\n          ").concat(iO(i,"coords",this.op)," = idx;\n          val ").concat(this.op,"= getX(").concat(aO(i,"coords",this.op),");\n        }\n        setOutput(val);\n      }\n    ")};function aO(e,t,n){if(1===e)return"".concat(t);if(2===e)return"".concat(t,".x, ").concat(t,".y");if(3===e)return"".concat(t,".x, ").concat(t,".y, ").concat(t,".z");if(4===e)return"".concat(t,".x, ").concat(t,".y, ").concat(t,".z, ").concat(t,".w");throw new Error("Cumulative ".concat(n," for rank ").concat(e," is not yet supported"))}function iO(e,t,n){if(1===e)return"".concat(t);if(2===e)return"".concat(t,".y");if(3===e)return"".concat(t,".z");if(4===e)return"".concat(t,".w");throw new Error("Cumulative ".concat(n," for rank ").concat(e," is not yet supported"))}function oO(e,t,n,r,i,o){var s=t.shape.length,u=a.zd.getAxesPermutation([r],s),c=t;null!=u&&(c=fk({inputs:{x:t},backend:n,attrs:{perm:u}}));var l=a.zd.getInnerMostAxes(1,s)[0];if(l!==s-1)throw new Error("WebGL cumprod shader expects an inner-most axis=".concat(t.shape.length-1," ")+"but got axis=".concat(r));for(var d=c.shape[l],p=zx({inputs:{x:c},backend:n}),f=0;f<=Math.ceil(Math.log2(d))-1;f++){var h=new rO(e,c.shape,!1,o),m=[[f]],v=p;p=n.runWebGLProgram(h,[p],p.dtype,m),n.disposeIntermediateTensorInfo(v)}if(i){var b=new rO(e,c.shape,i,o),g=p;p=n.runWebGLProgram(b,[p],p.dtype),n.disposeIntermediateTensorInfo(g)}if(null!=u){var y=fk({inputs:{x:p},backend:n,attrs:{perm:a.zd.getUndoAxesPermutation(u)}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(c),y}return p}var sO={kernelName:a.L,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse;return oO(Yw.Prod,a,n,i,o,s)}};var uO={kernelName:a.M,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse;return oO(Yw.Sum,a,n,i,o,s)}};var cO={kernelName:a.O,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=r.binaryOutput;if(1===a.shape.length){var u=n.readSync(a.dataId),c=n.readSync(i.dataId),l=xy(u,c,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,l)}if(2===a.shape.length){var d=n.bufferSync(a),p=n.bufferSync(i),f=ky(d,p,o,s);return n.makeTensorInfo(f.shape,i.dtype,f.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank"+"".concat(a.shape.length,"."))}},lO=function(){function e(t,n,r){Object($r.a)(this,e),this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=n,this.dataFormat=r,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = ".concat(this.getHeightCoordString(),";\n      int w = ").concat(this.getWidthCoordString(),";\n      int d = ").concat(this.getDepthCoordString(),";\n\n      int in_h = h / ").concat(n,";\n      int offset_h = imod(h, ").concat(n,");\n      int in_w = w / ").concat(n,";\n      int offset_w = imod(w, ").concat(n,");\n      int offset_d = (offset_h * ").concat(n," + offset_w) *\n        ").concat(this.getOutputDepthSize(),";\n      int in_d = d + offset_d;\n\n      float result = ").concat(this.getInputSamplingString(),";\n      setOutput(result);\n    }\n  ")}return Object(ea.a)(e,[{key:"getHeightCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"}},{key:"getWidthCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"}},{key:"getDepthCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"}},{key:"getOutputDepthSize",value:function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]}},{key:"getInputSamplingString",value:function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}]),e}();var dO={kernelName:a.P,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockSize,o=r.dataFormat,s=a.shape[0],u=("NHWC"===o?a.shape[1]:a.shape[2])*i,c=("NHWC"===o?a.shape[2]:a.shape[3])*i,l=("NHWC"===o?a.shape[3]:a.shape[1])/(i*i),d=new lO("NHWC"===o?[s,u,c,l]:[s,l,u,c],i,o);return n.runWebGLProgram(d,[a],a.dtype)}},pO=function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];Object($r.a)(this,e),this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=ty(this.outputShape.length);var o=t.filterHeight,s=t.filterWidth,u=t.outChannels/t.inChannels,c="",l="";r&&(c=a?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ".concat(r,"\n        }"):i?"float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ".concat(r,"\n        }"):"\n          float activation(float x) {\n            ".concat(r,"\n          }\n        "),l="result = activation(result);");var d=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(c,"\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ").concat(u,";\n        int q = d2 - d1 * ").concat(u,";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < ").concat(o,"; wR++) {\n          int xR = xRCorner + wR * dilations[0];\n\n          if (xR < 0 || xR >= inDims[0]) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(s,"; wC++) {\n            int xC = xCCorner + wC * dilations[1];\n\n            if (xC < 0 || xC >= inDims[1]) {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        ").concat(d,"\n        ").concat(l,"\n        setOutput(result);\n      }\n    ")},fO=function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];Object($r.a)(this,e),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=ty(this.outputShape.length);for(var s=t.outChannels/t.inChannels,u=t.padInfo.left,c=t.strideWidth,l=t.dilationWidth,d=t.filterHeight,p=t.filterWidth,f=p,h="\n      int xR; int xC; int xCOffset;\n      vec4 wTexel; vec4 previous; vec4 final;",m=0;m<p;m++)h+="\n          vec4 xTexelC".concat(2*m,";\n          int xTexelC").concat(2*m,"Ready;\n          vec4 xTexelC").concat(2*m+1,";\n          int xTexelC").concat(2*m+1,"Ready;\n          vec4 xC").concat(m,";");h+="\n    for (int r = 0; r < ".concat(d,"; r++) {\n      ");for(var v=0;v<p;v++)h+="\n          xTexelC".concat(2*v," = vec4(0.0);\n          xTexelC").concat(2*v,"Ready = 0;\n          xTexelC").concat(2*v+1," = vec4(0.0);\n          xTexelC").concat(2*v+1,"Ready = 0;\n          xC").concat(v," = vec4(0.0);");h+="\n        xR = xRCorner + r * dilations[0];\n        if (xR >=0 && xR < inDims[0]) {\n      ";for(var b=0;b<(f+1)/2;b++){var g=2*b;if(h+="\n          xC = xCCorner + ".concat(g*l,";\n          "),1===c){if(g<p&&(u%2===1?(h+="\n                xCOffset = xC + 1;\n                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(g,"Ready == 0) {\n                  xTexelC").concat(g," = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC").concat(g,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(g,"Ready = 1;\n                }\n              "),h+=1===l&&g>0?"\n                xC".concat(g," = vec4(xTexelC").concat(g-2,".zw, xTexelC").concat(g,".xy);\n                "):"\n                  xCOffset = xC + 1 - 2;\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                    previous = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      previous.zw = vec2(0.0);\n                    }\n\n                    xC".concat(g," = vec4(previous.zw, xTexelC").concat(g,".xy);\n                  } else {\n                    xC").concat(g," = vec4(0.0, 0.0, xTexelC").concat(g,".xy);\n                  }\n                  ")):h+="\n                if (xC >= 0 && xC < inDims[1] && xTexelC".concat(g,"Ready == 0) {\n                  xTexelC").concat(g," = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC").concat(g,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(g,"Ready = 1;\n                }\n\n                xC").concat(g," = xTexelC").concat(g,";\n                "),g+1<p)){var y=u%2===0?a.Df.nearestLargerEven(l):l;l%2===0&&u%2===1||l%2!==0&&u%2!==1?(h+="\n                  xCOffset = xC + imod(pads[1], 2) + ".concat(y,";\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(g+1,"Ready == 0) {\n                    xTexelC").concat(g+1," = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      xTexelC").concat(g+1,".zw = vec2(0.0);\n                    }\n                    xTexelC").concat(g+1,"Ready = 1;\n                  }\n                  "),h+=l>1?"\n                    xCOffset -= 2;\n                    if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                     previous = getX(batch, xR, xCOffset, d1);\n                     xC".concat(g+1," = vec4(previous.zw, xTexelC").concat(g+1,".xy);\n                    } else {\n                     xC").concat(g+1," = vec4(0.0, 0.0, xTexelC").concat(g+1,".xy);\n                    }\n                    "):"\n                    xC".concat(g+1," = vec4(xTexelC").concat(g,".zw, xTexelC").concat(g+1,".xy);\n                    ")):h+=1===y?"\n                    xC".concat(g+1," = xTexelC").concat(g,";\n                    "):"\n                    xCOffset = xC + ".concat(y,";\n\n                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(g+1,"Ready == 0) {\n                      xTexelC").concat(g+1," = getX(batch, xR, xCOffset, d1);\n                      if (xCOffset + 1 >= inDims[1]) {\n                        xTexelC").concat(g+1,".zw = vec2(0.0);\n                      }\n                      xTexelC").concat(g+1,"Ready = 1;\n                    }\n\n                    xC").concat(g+1," = xTexelC").concat(g+1,";\n                    ")}}else g<p&&(u%2===1?(h+="\n                xCOffset = xC + 1 - strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(g,"Ready == 0) {\n                  xTexelC").concat(g," = getX(batch, xR, xCOffset, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC").concat(g,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(g,"Ready = 1;\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC").concat(g+1,"Ready == 0) {\n                  xTexelC").concat(g+1," = getX(batch, xR, xC + 1, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xC + 2 >= inDims[1]) {\n                    xTexelC").concat(g+1,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(g+1,"Ready = 1;\n                }\n\n                xC").concat(g," = vec4(xTexelC").concat(g,".zw, xTexelC").concat(g+1,".zw);\n              "),g+1<p&&(h+="\n                  final = vec4(0.0);\n                  xCOffset = xC + 1 + strides[1];\n                  if(xCOffset >= 0 && xCOffset < inDims[1]) {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xC".concat(g+1," = vec4(xTexelC").concat(g+1,".xy, final.xy);\n                "))):(h+="\n                if(xC >= 0 && xC < inDims[1] && xTexelC".concat(g,"Ready == 0) {\n                  xTexelC").concat(g," = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC").concat(g,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(g,"Ready = 1;\n                }\n\n                xCOffset = xC + strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(g+1,"Ready == 0) {\n                  xTexelC").concat(g+1," = getX(batch, xR, xCOffset, d1);\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC").concat(g+1,".zw = vec2(0.);\n                  }\n                  xTexelC").concat(g+1,"Ready = 1;\n                }\n\n                xC").concat(g," = vec4(\n                  xTexelC").concat(g,".xy, xTexelC").concat(g+1,".xy);\n              "),g+1<p&&(h+="\n                  xC".concat(g+1," = vec4(xTexelC").concat(g,".zw, xTexelC").concat(g+1,".zw);\n                "))));g<p&&(h+="\n            wTexel = getW(r, ".concat(g,", d1, q);\n            dotProd += xC").concat(g," * vec4(wTexel.xz, wTexel.xz);\n          "),g+1<p&&(h+="\n              wTexel = getW(r, ".concat(g+1,", d1, q);\n              dotProd += xC").concat(g+1," * vec4(wTexel.xz, wTexel.xz);\n            ")))}h+="\n    }\n  ",h+="\n      }\n    ";var x="",k="";r&&(x=i?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ".concat(r,"\n        }"):o?"vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ".concat(r,"\n        }"):"vec4 activation(vec4 x) {\n          ".concat(r,"\n        }"),k="result = activation(result);");var w=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(x,"\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ").concat(s,";\n        int q = d2 - d1 * ").concat(s,";\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.\n        vec4 dotProd = vec4(0.000000000000001);\n\n        ").concat(h,"\n\n        vec4 result = dotProd - vec4(0.000000000000001);\n        ").concat(w,"\n        ").concat(k,"\n        setOutput(result);\n      }\n    ")};var hO={kernelName:a.Q,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.x,o=t.filter,s=r.strides,u=r.pad,c=r.dilations,l=r.dimRoundingMode,d=c;null==d&&(d=[1,1]),a.Df.assert(a.zd.eitherStridesOrDilationsAreOne(s,d),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(s," and dilations '").concat(d,"'")}));var p,f=a.zd.computeConv2DInfo(i.shape,o.shape,s,d,u,l,!0);p=Object(a.be)().getBool("WEBGL_PACK_DEPTHWISECONV")&&f.strideWidth<=2&&f.outChannels/f.inChannels===1?new fO(f):new pO(f);var h=[[f.padInfo.top,f.padInfo.left],[f.strideHeight,f.strideWidth],[f.dilationHeight,f.dilationWidth],[f.inHeight,f.inWidth]];return n.runWebGLProgram(p,[i,o],"float32",h)}},mO=function e(t){Object($r.a)(this,e),this.variableNames=["x","dy"],this.outputShape=t.filterShape;var n=t.strideHeight,r=t.strideWidth,a=t.padInfo.top,i=t.padInfo.left,o=t.outChannels/t.inChannels;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * ".concat(o," + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < ").concat(t.batchSize,"; b++) {\n          for (int yR = 0; yR < ").concat(t.outHeight,"; yR++) {\n            int xR = wR + yR * ").concat(n," - ").concat(a,";\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int yC = 0; yC < ").concat(t.outWidth,"; yC++) {\n              int xC = wC + yC * ").concat(r," - ").concat(i,";\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},vO=function e(t){Object($r.a)(this,e),this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterHeight,r=t.filterWidth,a=t.strideHeight,i=t.strideWidth,o=n-1-t.padInfo.top,s=r-1-t.padInfo.left,u=t.outChannels/t.inChannels;this.userCode="\n      const ivec2 pads = ivec2(".concat(o,", ").concat(s,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < ").concat(n,"; wR++) {\n          float dyR = float(dyRCorner + wR) / ").concat(a,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ").concat(n," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(r,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(i,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ").concat(r," - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < ").concat(u,"; dm++) {\n              int d2 = d1 * ").concat(u," + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")};var bO={kernelName:a.R,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.x,o=t.dy,s=r.strides,u=r.dilations,c=r.pad,l=r.dimRoundingMode,d=r.filterShape,p=a.zd.computeConv2DInfo(i.shape,d,s,u,c,l,!0),f=new mO(p);return n.runWebGLProgram(f,[i,o],"float32")}};var gO={kernelName:a.S,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.dy,o=t.filter,s=r.strides,u=r.dilations,c=r.pad,l=r.dimRoundingMode,d=r.inputShape,p=a.zd.computeConv2DInfo(d,o.shape,s,u,c,l,!0),f=new vO(p);return n.runWebGLProgram(f,[i,o],"float32")}},yO=function e(t){Object($r.a)(this,e),this.variableNames=["X"],this.outputShape=[t,t],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "};var xO={kernelName:a.T,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,i=[].concat(Object(qn.a)(r.shape),Object(qn.a)(r.shape)),o=a.Df.sizeFromShape(r.shape),s=rk({inputs:{x:r},backend:n,attrs:{shape:[o]}}),u=new yO(o),c=n.runWebGLProgram(u,[s],s.dtype),l=rk({inputs:{x:c},backend:n,attrs:{shape:i}});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(c),l}},kO=function e(t){Object($r.a)(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var n=t.inHeight,r=t.inWidth,a=t.padInfo,i=t.strideHeight,o=t.strideWidth,s=t.filterHeight,u=t.filterWidth,c=t.dilationHeight,l=t.dilationWidth,d=a.top,p=a.left;this.userCode="\n      const ivec2 strides = ivec2(".concat(i,", ").concat(o,");\n      const ivec2 pads = ivec2(").concat(d,", ").concat(p,");\n      const float neg_infinity = -3.4e38;\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.w;\n        ivec2 outTopLeftCorner =\n            coords.yz * strides - pads;\n        int hBeg = outTopLeftCorner.x;\n        int wBeg = outTopLeftCorner.y;\n\n        float curVal = neg_infinity;\n        for (int h = 0; h < ").concat(s,"; h++) {\n          int hIn = hBeg + h * ").concat(c,";\n\n          if (hIn >= 0 && hIn < ").concat(n,") {\n            for (int w = 0; w < ").concat(u,"; w++) {\n              int wIn = wBeg + w * ").concat(l,";\n\n              if (wIn >= 0 && wIn < ").concat(r,") {\n                float xVal = getX(batch, hIn, wIn, d1);\n                float wVal = getW(h, w, d1);\n\n                float val = xVal + wVal;\n                if (val > curVal) {\n                  curVal = val;\n                }\n              }\n            }\n          }\n        }\n\n        float result = curVal;\n        setOutput(result);\n      }\n    ")};var wO={kernelName:a.U,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,i=e.attrs,o=n.x,s=n.filter,u=i.strides,c=i.pad,l=i.dilations,d=a.zd.computeDilation2DInfo(o.shape,s.shape,u,c,"NHWC",l),p=new kO(d),f=rk({inputs:{x:t=r.runWebGLProgram(p,[o,s],"float32")},backend:r,attrs:{shape:d.outShape}});return r.disposeIntermediateTensorInfo(t),f}};var OO={kernelName:a.X,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.equation,i=t,o=a.zd.decodeEinsumEquation(r,i.length),s=o.allDims,u=o.summedDims,c=o.idDims;a.zd.checkEinsumDimSizes(s.length,c,i);for(var l=a.zd.getEinsumComputePath(u,c),d=l.path,p=l.steps,f=p.length,h=null,m=s.length,v=[],b=0;b<f;++b){var g,y=Object(Qr.a)(p[b]);try{for(y.s();!(g=y.n()).done;){var x=g.value,k=a.zd.getEinsumPermutation(m,c[x]),w=k.permutationIndices,O=k.expandDims,I=void 0;a.zd.isIdentityPermutation(w)?I=i[x]:(I=fk({inputs:{x:i[x]},backend:n,attrs:{perm:w}}),v.push(I));for(var S=I.shape.slice(),N=0;N<O.length;++N)S.splice(O[N],0,1);a.Df.arraysEqual(I.shape,S)||(I=rk({inputs:{x:I},backend:n,attrs:{shape:S}}),v.push(I)),null===h?h=I:(h=tk({inputs:{a:I,b:h},backend:n}),v.push(h))}}catch(E){y.e(E)}finally{y.f()}b<f-1&&(d[b]>=0&&(h=dk({inputs:{x:h},backend:n,attrs:{axis:d[b]-(s.length-m),keepDims:!1}}),v.push(h)),m--)}for(var j=0,T=v;j<T.length;j++){var C=T[j];C!==h&&n.disposeIntermediateTensorInfo(C)}return h}},IO=Kx({opSnippet:"return (x >= 0.0) ? x : (exp(x) - 1.0);",packedOpSnippet:"\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n"}),SO={kernelName:a.Y,backendName:"webgl",kernelFunc:IO},NO={kernelName:a.Z,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.dy,i=t.y,o=Object(a.be)().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Mx("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",r.shape,i.shape):new Fx("return (b >= 1.0) ? a : a * (b + 1.0);",r.shape,i.shape);return n.runWebGLProgram(o,[r,i],r.dtype)}},jO=Xx({opSnippet:"return float(a == b);",packedOpSnippet:"\n  return vec4(equal(a, b));\n",dtype:"bool",cpuKernelImpl:Sy}),TO={kernelName:a.ab,backendName:"webgl",kernelFunc:jO},CO=Kx({opSnippet:'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = '.concat(a.zd.ERF_P,";\n  float a1 = ").concat(a.zd.ERF_A1,";\n  float a2 = ").concat(a.zd.ERF_A2,";\n  float a3 = ").concat(a.zd.ERF_A3,";\n  float a4 = ").concat(a.zd.ERF_A4,";\n  float a5 = ").concat(a.zd.ERF_A5,";\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n")}),EO={kernelName:a.bb,backendName:"webgl",kernelFunc:CO},_O=Kx({opSnippet:"if (isnan(x)) return x;\n  return exp(x);\n",packedOpSnippet:"\n  vec4 result = exp(x);\n  bvec4 isNaN = isnan(x);\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",cpuKernelImpl:Ny,dtype:"float32"}),AO={kernelName:a.cb,backendName:"webgl",kernelFunc:_O};function RO(e){var t=e.inputs,n=e.attrs,r=e.backend,i=n.dim,o=t.input,s=o.shape.length,u=o.shape.slice(),c=i;return i<0&&(a.Df.assert(-(s+1)<=i,(function(){return"Axis must be in the interval [".concat(-(s+1),", ").concat(s,"]")})),c=s+i+1),u.splice(c,0,1),rk({inputs:{x:o},backend:r,attrs:{shape:u}})}var DO={kernelName:a.db,backendName:"webgl",kernelFunc:RO},FO="return exp(x) - 1.0;",MO=Kx({opSnippet:FO,packedOpSnippet:FO,cpuKernelImpl:jy}),zO={kernelName:a.eb,backendName:"webgl",kernelFunc:MO},LO=function e(t,n,r){Object($r.a)(this,e),this.variableNames=["real","imag"];var a=n[1];this.outputShape=n;var i,o=r?"2.0 * ".concat(Math.PI):"-2.0 * ".concat(Math.PI),s=r?"".concat(a,".0"):"1.0";if("real"===t)i="return real * expR - imag * expI;";else{if("imag"!==t)throw new Error('FFT component must be either "real" or "imag", got '.concat(t,"."));i="return real * expI + imag * expR;"}this.userCode="\n      const float exponentMultiplier = ".concat(o,";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        ").concat(i,"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float(").concat(a,");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < ").concat(a,"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / ").concat(s,";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    ")};function PO(e,t,n){var r=n.texData.get(e.dataId),i=a.Df.sizeFromShape(e.shape),o=e.shape[e.shape.length-1],s=rk({inputs:{x:e},backend:n,attrs:{shape:[i/o,o]}}),u=s.shape,c=new LO("real",u,t),l=new LO("imag",u,t),d=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:u},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:u}],p=n.runWebGLProgram(c,d,"float32"),f=n.runWebGLProgram(l,d,"float32"),h=Px({inputs:{real:p,imag:f},backend:n});n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f);var m=rk({inputs:{x:h},backend:n,attrs:{shape:e.shape}});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(h),m}var BO={kernelName:a.fb,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend;return PO(t.input,!1,n)}},WO=function e(t,n){Object($r.a)(this,e),this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=t,this.userCode="\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "};function UO(e){var t=e.backend,n=e.attrs,r=n.shape,i=n.value,o=n.dtype;if("string"===(o=o||a.Df.inferDtype(i))){var s=a.Df.getArrayFromDType(o,a.Df.sizeFromShape(r));return s.fill(i),t.makeTensorInfo(r,o,s)}var u=new WO(r,i),c=[[i]];return t.runWebGLProgram(u,[],o,c)}var VO,GO={kernelName:a.gb,backendName:"webgl",kernelFunc:UO},HO=function e(t){Object($r.a)(this,e),this.variableNames=["Image"],this.outputShape=[];var n=t[2];this.outputShape=t,this.userCode="\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n\n          int coordX = ".concat(n," - x - 1;\n          float outputValue;\n          if(coordX >= 0 && coordX < ").concat(n,") {\n            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);\n          } else {\n            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    ")},qO={kernelName:a.hb,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.image,a=n,i=new HO(r.shape);return a.runWebGLProgram(i,[r],r.dtype)}},KO="return floor(x);",XO=Kx({opSnippet:KO,packedOpSnippet:KO,cpuKernelImpl:Ty}),YO={kernelName:a.ib,backendName:"webgl",kernelFunc:XO},ZO=Xx({opSnippet:"\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",packedOpSnippet:"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n",dtype:"int32"}),JO={kernelName:a.jb,backendName:"webgl",kernelFunc:ZO},QO=function e(t){Object($r.a)(this,e),this.variableNames=["A"];var n=kg(),r=Object(i.a)(t,2),a=r[0],o=r[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(".concat(o,".0, ").concat(a,".0);\n\n        vec4 values = ").concat(n.texture2D,"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    ")},$O=function e(t){Object($r.a)(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var n=kg(),r=Object(i.a)(t,2),a=r[0],o=r[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2(".concat(o,".0, ").concat(a,".0);\n            vec4 values = ").concat(n.texture2D,"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        ").concat(n.output," = result;\n      }\n    ")},eI={kernelName:a.kb,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,o=t.pixels,s=r.numChannels,u="undefined"!==typeof HTMLVideoElement&&o instanceof HTMLVideoElement,c="undefined"!==typeof HTMLImageElement&&o instanceof HTMLImageElement,l=u?[o.videoWidth,o.videoHeight]:[o.width,o.height],d=Object(i.a)(l,2),p=d[0],f=d[1],h=[f,p],m=[f,p,s];if(c||u){var v=Object(a.be)().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");null!=VO&&v===tI||(tI=v,VO=document.createElement("canvas").getContext("2d",{willReadFrequently:tI})),VO.canvas.width=p,VO.canvas.height=f,VO.drawImage(o,0,0,p,f),o=VO.canvas}var b=n.makeTensorInfo(h,"int32");n.texData.get(b.dataId).usage=Lb.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(b.dataId),o);var g=Object(a.be)().getBool("WEBGL_PACK")?new $O(m):new QO(m),y=n.runWebGLProgram(g,[b],"int32");return n.disposeData(b.dataId),y}},tI=Object(a.be)().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");var nI={kernelName:a.mb,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,i=e.attrs,o=n.x,s=n.filter,u=n.bias,c=n.preluActivationWeights,l=i.strides,d=i.pad,p=i.dataFormat,f=i.dilations,h=i.dimRoundingMode,m=i.activation,v=i.leakyreluAlpha,b=a.zd.convertConv2DDataFormat(p),g=a.zd.computeConv2DInfo(o.shape,s.shape,l,f,d,h,!1,b),y=[],x=null!=u,k=null!=c,w="leakyrelu"===m,O=function(){var e=[o,s],t=function(e,t){if("NCHW"===t&&1===e.shape.length&&1!==e.shape[0]){var n=rk({inputs:{x:e},backend:r,attrs:{shape:[e.shape[0],1,1]}});return y.push(n),n}return e};if(x&&e.push(t(u,p)),k&&e.push(t(c,p)),w){var n=r.makeTensorInfo([],"float32",a.Df.createScalarValue(v,"float32"));e.push(n),y.push(n)}return e};if(1!==g.filterHeight||1!==g.filterWidth||1!==g.dilationHeight||1!==g.dilationWidth||1!==g.strideHeight||1!==g.strideWidth||"SAME"!==g.padInfo.type&&"VALID"!==g.padInfo.type)if(g.strideWidth<=2&&"channelsLast"===b&&Object(a.be)().getBool("WEBGL_EXP_CONV")){var I=m?Yx(m,!0):null,S=new Fw(g,x,I,k,w),N=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],j=O();t=r.runWebGLProgram(S,j,"float32",N)}else if(Object(a.be)().getBool("WEBGL_CONV_IM2COL"))t=Pw({x:o,filter:s,convInfo:g,backend:r,bias:u,activation:m,preluActivationWeights:c,leakyreluAlpha:v});else{var T=m?Yx(m,!1):null,C=new Rw(g,x,T,k,w),E=O();t=r.runWebGLProgram(C,E,"float32")}else t=Lw({x:o,filter:s,convInfo:g,backend:r,bias:u,activation:m,preluActivationWeights:c,leakyreluAlpha:v});var _=rk({inputs:{x:t},backend:r,attrs:{shape:g.outShape}});return y.push(t),y.forEach((function(e){return r.disposeIntermediateTensorInfo(e)})),_}};var rI={kernelName:a.nb,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.x,o=t.filter,s=t.bias,u=t.preluActivationWeights,c=r.strides,l=r.pad,d=r.dilations,p=r.dimRoundingMode,f=r.activation,h=r.leakyreluAlpha,m=[],v=d;null==v&&(v=[1,1]),a.Df.assert(a.zd.eitherStridesOrDilationsAreOne(c,v),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(c," and dilations '").concat(v,"'")}));var b,g=a.zd.computeConv2DInfo(i.shape,o.shape,c,v,l,p,!0),y=Object(a.be)().getBool("WEBGL_PACK_DEPTHWISECONV")&&g.strideWidth<=2&&g.outChannels/g.inChannels===1,x=f?Yx(f,y):null,k=[i,o],w=null!=s,O=null!=u,I="leakyrelu"===f;if(w&&k.push(s),O&&k.push(u),I){var S=n.makeTensorInfo([],"float32",a.Df.createScalarValue(h,"float32"));k.push(S),m.push(S)}b=y?new fO(g,w,x,O,I):new pO(g,w,x,O,I);var N=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],j=n.runWebGLProgram(b,k,"float32",N);return m.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),j}},aI=function e(t,n,r,a){Object($r.a)(this,e),this.sliceDim=t,this.strides=n,this.paramsShape=a,this.variableNames=["x","indices"],this.outputShape=r;for(var i=qg(r.length),o="\n    int index;",s=0;s<this.sliceDim;s++)o+="\n          index = round(getIndices(coords[0], ".concat(s,"));\n          out_of_bounds = out_of_bounds || index < 0;\n          out_of_bounds = out_of_bounds || index >= ").concat(this.paramsShape[s],";\n          flattenIndex += index * ").concat(this.strides[s],";");this.userCode="\n         void main() {\n          ".concat(i," coords = getOutputCoords();\n          int flattenIndex = 0;\n          bool out_of_bounds = false;\n\n          ").concat(o,"\n\n          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));\n        }\n      ")};var iI={kernelName:a.ob,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.params,o=t.indices,s=o.shape,u=s[s.length-1],c=a.Df.sizeFromShape(r.shape),l=a.zd.prepareAndValidate(r,o),d=Object(i.a)(l,4),p=d[0],f=d[1],h=d[2],m=d[3],v=rk({inputs:{x:o},backend:n,attrs:{shape:[f,u]}}),b=rk({inputs:{x:r},backend:n,attrs:{shape:[a.Df.sizeFromShape(r.shape)/h,h]}});if(n.shouldExecuteOnCPU([r,o])||"string"===r.dtype){var g=n.readSync(o.dataId),y=n.bufferSync(r),x=Cy(g,y,r.dtype,f,u,h,m,r.shape,c);return n.makeTensorInfo(p,r.dtype,x.values)}var k=new aI(u,m,[f,h],r.shape),w=n.runWebGLProgram(k,[b,v],b.dtype),O=rk({inputs:{x:w},backend:n,attrs:{shape:p}});return n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(b),n.disposeIntermediateTensorInfo(w),O}},oI=function e(t,n){Object($r.a)(this,e),this.variableNames=["A","indices"],this.outputShape=n,this.rank=n.length;var r=qg(this.rank),a=function(e,t){for(var n=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[],a=0;a<e.length;a++)2===a?r.push("index"):r.push("".concat(n[a]));return r.join()}(t);this.userCode="\n      void main() {\n        ".concat(r," resRC = getOutputCoords();\n        int index = int(getIndices(resRC.x, resRC.z));\n        float inBounds = (index >= 0) && (index < ").concat(t[2],") ? 1.0 : 0.0;\n        setOutput(inBounds * getA(").concat(a,"));\n      }\n    ")};function sI(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.x,o=t.indices,s=r.axis,u=r.batchDims,c=a.Df.parseAxisParam(s,i.shape)[0];Object(a.be)().get("DEBUG")&&function(){for(var e=n.readSync(o.dataId),t=i.shape[c],r=function(n){var r=e[n];a.Df.assert(r<=t-1&&r>=0,(function(){return"GatherV2: the index value ".concat(r," is not in [0, ").concat(t-1,"]")}))},s=0;s<e.length;++s)r(s)}();var l=a.zd.segment_util.collectGatherOpShapeInfo(i,o,c,u),d=a.Df.sizeFromShape(o.shape),p=[],f=rk({inputs:{x:i},backend:n,attrs:{shape:[l.batchSize,l.outerSize,l.dimSize,l.sliceSize]}}),h=rk({inputs:{x:o},backend:n,attrs:{shape:[l.batchSize,d/l.batchSize]}});p.push(f),p.push(h);var m=[l.batchSize,l.outerSize,d/l.batchSize,l.sliceSize];if(n.shouldExecuteOnCPU([i,o])||"string"===i.dtype){var v=n.bufferSync(h),b=n.bufferSync(f),g=Ey(b,v,m);return p.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(l.outputShape,g.dtype,g.values)}var y=new oI(f.shape,m),x=n.runWebGLProgram(y,[f,h],f.dtype);p.push(x);var k=rk({inputs:{x:x},backend:n,attrs:{shape:l.outputShape}});return p.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),k}var uI={kernelName:a.pb,backendName:"webgl",kernelFunc:sI},cI=Xx({opSnippet:"return float(a > b);",packedOpSnippet:"\n  return vec4(greaterThan(a, b));\n",cpuKernelImpl:_y,dtype:"bool"}),lI={kernelName:a.qb,backendName:"webgl",kernelFunc:cI},dI=Xx({opSnippet:"return float(a >= b);",packedOpSnippet:"\n  return vec4(greaterThanEqual(a, b));\n",dtype:"bool",cpuKernelImpl:Ay}),pI={kernelName:a.rb,backendName:"webgl",kernelFunc:dI};var fI={kernelName:a.sb,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend;return PO(t.input,!0,n)}},hI=Kx({opSnippet:"return float(!isnan(x) && !isinf(x));",dtype:"bool"}),mI={kernelName:a.vb,backendName:"webgl",kernelFunc:hI},vI=Kx({opSnippet:"return float(isinf(x));",dtype:"bool"}),bI={kernelName:a.wb,backendName:"webgl",kernelFunc:vI},gI=Kx({opSnippet:"return float(isnan(x));",dtype:"bool"}),yI={kernelName:a.xb,backendName:"webgl",kernelFunc:gI},xI=Xx({opSnippet:"return float(a < b);",packedOpSnippet:"\n  return vec4(lessThan(a, b));\n",cpuKernelImpl:Ry,dtype:"bool"}),kI={kernelName:a.Cb,backendName:"webgl",kernelFunc:xI},wI=Xx({opSnippet:"return float(a <= b);",packedOpSnippet:"\n  return vec4(lessThanEqual(a, b));\n",cpuKernelImpl:Dy,dtype:"bool"}),OI={kernelName:a.Db,backendName:"webgl",kernelFunc:wI};var II={kernelName:a.Eb,backendName:"webgl",kernelFunc:function(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,i=n.num,o=Fy(r,a,i);return t.makeTensorInfo([o.length],"float32",o)}},SI=Kx({opSnippet:"if (isnan(x)) return x;\n  return x < 0.0 ? 0./0. : log(x);\n",packedOpSnippet:"\n  vec4 result = log(x);\n  bvec4 isNaN = isnan(x);\n  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);\n  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);\n  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);\n  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);\n  return result;\n",cpuKernelImpl:My}),NI={kernelName:a.Fb,backendName:"webgl",kernelFunc:SI},jI=Kx({opSnippet:"if (isnan(x)) return x;\n  return log(1.0 + x);\n"}),TI={kernelName:a.Gb,backendName:"webgl",kernelFunc:jI},CI=Xx({opSnippet:"return float(a >= 1.0 && b >= 1.0);",packedOpSnippet:"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n",dtype:"bool"}),EI={kernelName:a.Hb,backendName:"webgl",kernelFunc:CI},_I=Kx({opSnippet:"return float(!(x >= 1.0));"}),AI={kernelName:a.Ib,backendName:"webgl",kernelFunc:_I},RI=Xx({opSnippet:"return float(a >= 1.0 || b >= 1.0);",packedOpSnippet:"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n",dtype:"bool"}),DI={kernelName:a.Jb,backendName:"webgl",kernelFunc:RI},FI=function e(t,n,r,a,i){Object($r.a)(this,e),this.variableNames=["x"],this.outputShape=[];var o,s=n,u=t[3]-1;this.outputShape=t;var c="float(".concat(r,") + float(").concat(a,") * sum");o=.5===i?"inversesqrt(".concat(c,")"):1===i?"1.0/(".concat(c,")"):"exp(log(".concat(c,") * float(-").concat(i,"));"),this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -".concat(s,"; j <= ").concat(s,"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  ").concat(u,") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * ").concat(o,";\n        setOutput(val);\n      }\n    ")},MI=function e(t,n,r,a,i){Object($r.a)(this,e),this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var o,s=n,u=t[3]-1;this.outputShape=t;var c="float(".concat(r,") + float(").concat(a,") * sum");o=.5===i?"inversesqrt(".concat(c,")"):1===i?"1.0/(".concat(c,")"):"exp(log(".concat(c,") * float(-").concat(i,"));"),this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < ".concat(this.outputShape[3],";\n        bool hasNextRow = c < ").concat(this.outputShape[2],";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - ").concat(s,";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - ").concat(s,"; j <= ").concat(s,"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(").concat(u,"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * ").concat(o,";\n        setOutput(result);\n      }\n    ")},zI={kernelName:a.zb,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.x,o=r.depthRadius,s=r.bias,u=r.alpha,c=r.beta,l=Object(a.be)().getBool("WEBGL_PACK_NORMALIZATION")?new MI(i.shape,o,s,u,c):new FI(i.shape,o,s,u,c);return n.runWebGLProgram(l,[i],i.dtype)}},LI=function e(t,n,r,a,i){Object($r.a)(this,e),this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=t,this.depth=t[3],this.depthRadius=n,this.bias=r,this.alpha=a,this.beta=i,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < ".concat(this.depth,"; ++d) {\n          int depthBegin = int(max(0.0, float(d - ").concat(n,")));\n          int depthEnd = int(min(float(").concat(this.depth,"),\n              float(d + ").concat(n," + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = ").concat(this.depth,";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float(").concat(a,") * norm + float(").concat(r,");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float(").concat(a,")\n                * float(").concat(i,")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * ").concat(i,");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    ")},PI={kernelName:a.Ab,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.y,o=t.dy,s=r.depthRadius,u=r.bias,c=r.alpha,l=r.beta,d=new LI(a.shape,s,u,c,l);return n.runWebGLProgram(d,[a,i,o],a.dtype)}};function BI(e){var t=e.inputs,n=e.backend,r=e.attrs,o=t.x,s=r.reductionIndices,u=r.keepDims,c=o.shape.length,l=a.Df.parseAxisParam(s,o.shape),d=l,p=a.zd.getAxesPermutation(d,c),f=null!=p,h=n.shouldExecuteOnCPU([o]),m=o;if(f){if(h){for(var v=n.texData.get(m.dataId).values,b=new Array(c),g=0;g<b.length;g++)b[g]=o.shape[p[g]];var y=cx(v,o.shape,o.dtype,p,b);m=n.makeTensorInfo(b,o.dtype),n.texData.get(m.dataId).values=y}else m=lk(o,p,n);d=a.zd.getInnerMostAxes(d.length,c)}a.zd.assertAxesAreInnerMostDims("max",d,c);var x,k=a.zd.computeOutAndReduceShapes(m.shape,d),w=Object(i.a)(k,2),O=w[0],I=w[1],S=O;if(u&&(S=a.zd.expandShapeToKeepDim(O,l)),h){var N=n.texData.get(m.dataId).values,j=zy(N,a.Df.sizeFromShape(I),S,o.dtype);x=n.makeTensorInfo(S,o.dtype),n.texData.get(x.dataId).values=j}else x=function(e,t,n,r){var i=a.Df.sizeFromShape(t),o=rk({inputs:{x:e},attrs:{shape:[a.Df.sizeFromShape(e.shape)/i,i]},backend:r}),s=sk(o,e.dtype,"max",r),u=rk({inputs:{x:s},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(o),r.disposeIntermediateTensorInfo(s),u}(m,I,S,n);return f&&n.disposeIntermediateTensorInfo(m),x}var WI={kernelName:a.Kb,backendName:"webgl",kernelFunc:BI},UI=Xx({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(max(a, b));\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  \n  result.r = isNaN.r ? NAN : result.r;\n  result.g = isNaN.g ? NAN : result.g;\n  result.b = isNaN.b ? NAN : result.b;\n  result.a = isNaN.a ? NAN : result.a;\n\n  return result;\n",cpuKernelImpl:Ly}),VI={kernelName:a.Qb,backendName:"webgl",kernelFunc:UI};var GI={kernelName:a.Lb,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.x;yg(i,"maxPool");var o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode;a.Df.assert(a.zd.eitherStridesOrDilationsAreOne(s,1),(function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(s," and dilations '").concat(1,"'")}));var l=a.zd.computePool2DInfo(i.shape,o,s,1,u,c);if(1===l.filterWidth&&1===l.filterHeight&&a.Df.arraysEqual(l.inShape,l.outShape))return zx({inputs:{x:i},backend:n});var d=new Hk(l,"max",!1);return n.runWebGLProgram(d,[i],i.dtype)}};var HI={kernelName:a.Mb,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.x,o=r.filterSize,s=r.strides,u=r.pad,c=r.dataFormat,l=r.dimRoundingMode,d=a.zd.computePool3DInfo(i.shape,o,s,[1,1,1],u,l,c),p=new qk(d,"max",!1);return n.runWebGLProgram(p,[i],i.dtype)}},qI=function e(t){Object($r.a)(this,e),this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var n=t.strideHeight,r=t.strideWidth,a=t.dilationHeight,i=t.effectiveFilterHeight,o=t.effectiveFilterWidth,s=i-1-t.padInfo.top,u=o-1-t.padInfo.left,c=i*o-1;this.userCode="\n      const ivec2 pads = ivec2(".concat(s,", ").concat(u,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(i,";\n          wR += ").concat(a,") {\n          float dyR = float(dyRCorner + wR) / ").concat(n,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ").concat(o,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(r,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = ").concat(c," - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * ").concat(o," + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},KI=function e(t){Object($r.a)(this,e),this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var n=t.strideDepth,r=t.strideHeight,a=t.strideWidth,i=t.dilationDepth,o=t.dilationHeight,s=t.dilationWidth,u=t.effectiveFilterDepth,c=t.effectiveFilterHeight,l=t.effectiveFilterWidth,d=u-1-t.padInfo.front,p=c-1-t.padInfo.top,f=l-1-t.padInfo.left,h=u*c*l-1;this.userCode="\n      const ivec3 pads = ivec3(".concat(d,", ").concat(p,", ").concat(f,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ").concat(u,";\n           wD += ").concat(i,") {\n          float dyD = float(dyDCorner + wD) / ").concat(n,".0;\n\n          if (dyD < 0.0 || dyD >= ").concat(t.outDepth,".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ").concat(c,";\n              wR += ").concat(o,") {\n            float dyR = float(dyRCorner + wR) / ").concat(r,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ").concat(l,";\n                wC += ").concat(s,") {\n              float dyC = float(dyCCorner + wC) / ").concat(a,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = ").concat(h," -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * ").concat(c," * ").concat(l," +\n                  wR * ").concat(l," + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")};var XI={kernelName:a.Nb,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.dy,o=t.input,s=r.filterSize,u=r.strides,c=r.pad,l=r.dimRoundingMode,d=a.zd.computePool3DInfo(o.shape,s,u,[1,1,1],c,l),p=new qk(d,"max",!0),f=n.runWebGLProgram(p,[o],o.dtype),h=new KI(d),m=n.runWebGLProgram(h,[i,f],o.dtype);return n.disposeIntermediateTensorInfo(f),m}};var YI={kernelName:a.Ob,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.dy,o=t.input,s=o;yg([o,t.output],"maxPoolGrad");var u=r.filterSize,c=r.strides,l=r.pad,d=r.dimRoundingMode,p=a.zd.computePool2DInfo(s.shape,u,c,1,l,d),f=new Hk(p,"max",!0),h=n.runWebGLProgram(f,[s],s.dtype),m=new qI(p),v=n.runWebGLProgram(m,[i,h],s.dtype);return n.disposeIntermediateTensorInfo(h),v}};var ZI={kernelName:a.Pb,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,o=t.x,s=n.filterSize,u=n.strides,c=n.pad,l=n.includeBatchInIndex,d=r;a.Df.assert(4===o.shape.length,(function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(o.shape.length,".")}));var p=[1,1];a.Df.assert(a.zd.eitherStridesOrDilationsAreOne(u,p),(function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(u," and dilations '").concat(p,"'")}));var f=a.zd.computePool2DInfo(o.shape,s,u,p,c),h=function(e,t,n,r){var a=new Hk(n,"max",!1),i=r.runWebGLProgram(a,[e],"float32");return a=new Hk(n,"max",!0,!0,t),[i,r.runWebGLProgram(a,[e],"float32")]}(o,l,f,d),m=Object(i.a)(h,2);return[m[0],m[1]]}};var JI={kernelName:a.Rb,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,o=t.x,s=n.keepDims,u=n.axis,c=r,l=o.shape.length,d=a.Df.parseAxisParam(u,o.shape),p=d,f=a.zd.getAxesPermutation(p,l),h=null!=f,m=c.shouldExecuteOnCPU([o]),v=[],b=o;if(h){if(m){for(var g=c.texData.get(b.dataId).values,y=new Array(l),x=0;x<y.length;x++)y[x]=o.shape[f[x]];var k=cx(g,o.shape,o.dtype,f,y);b=c.makeTensorInfo(y,o.dtype),c.texData.get(b.dataId).values=k}else b=lk(o,f,c);v.push(b),p=a.zd.getInnerMostAxes(p.length,l)}a.zd.assertAxesAreInnerMostDims("sum",p,l);var w=a.zd.computeOutAndReduceShapes(b.shape,p),O=Object(i.a)(w,2),I=O[0],S=O[1],N=I;s&&(N=a.zd.expandShapeToKeepDim(I,d));for(var j=function(e,t,n,r){var i=a.Df.sizeFromShape(t),o=rk({inputs:{x:e},attrs:{shape:[a.Df.sizeFromShape(e.shape)/i,i]},backend:r}),s=sk(o,"float32","mean",r),u=rk({inputs:{x:s},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(o),r.disposeIntermediateTensorInfo(s),u}(b,S,N,c),T=0,C=v;T<C.length;T++){var E=C[T];c.disposeIntermediateTensorInfo(E)}return j}};var QI={kernelName:a.Sb,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,o=t.x,s=r.axis,u=r.keepDims,c=o.shape.length,l=a.Df.parseAxisParam(s,o.shape),d=l,p=a.zd.getAxesPermutation(d,c),f=o;null!=p&&(f=fk({inputs:{x:o},backend:n,attrs:{perm:p}}),d=a.zd.getInnerMostAxes(d.length,o.shape.length)),a.zd.assertAxesAreInnerMostDims("min",d,c);var h,m=a.zd.computeOutAndReduceShapes(f.shape,d),v=Object(i.a)(m,2),b=v[0],g=v[1],y=rk({inputs:{x:f},backend:n,attrs:{shape:[-1,a.Df.sizeFromShape(g)]}}),x=sk(y,y.dtype,"min",n);return h=rk(u?{inputs:{x:x},backend:n,attrs:{shape:a.zd.expandShapeToKeepDim(b,l)}}:{inputs:{x:x},backend:n,attrs:{shape:b}}),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(x),null!=p&&n.disposeIntermediateTensorInfo(f),h}},$I=Xx({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(min(a, b));\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  \n  result.r = isNaN.r ? NAN : result.r;\n  result.g = isNaN.g ? NAN : result.g;\n  result.b = isNaN.b ? NAN : result.b;\n  result.a = isNaN.a ? NAN : result.a;\n\n  return result;\n",cpuKernelImpl:Py}),eS={kernelName:a.Tb,backendName:"webgl",kernelFunc:$I},tS=function e(t,n,r){Object($r.a)(this,e),this.variableNames=["x"],this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));var a=t.length,i=qg(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,a),c="reflect"===r?0:1;this.userCode=1!==a?"\n      ".concat(i," start = ").concat(i,"(").concat(o,");\n      ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outC = getOutputCoords();\n        for (int i = 0; i < ").concat(a,"; i++) {\n          if (outC[i] < start[i]) {\n            outC[i] = start[i] * 2 - outC[i] - ").concat(c,";\n          } else if(outC[i] >= end[i]) {\n            outC[i] = (end[i] - 1) * 2 - outC[i] + ").concat(c,";\n          }\n        }\n        ").concat(i," coords = outC - start;\n        setOutput(getX(").concat(u,"));\n      }\n    "):"\n        int start = ".concat(o,";\n        int end = ").concat(s,";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start) {\n            outC = start * 2 - outC - ").concat(c,";\n          } else if(outC >= end) {\n            outC = (end - 1) * 2 - outC + ").concat(c,";\n          }\n          setOutput(getX(outC - start));\n        }\n      ")},nS=function e(t,n,r){Object($r.a)(this,e),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));var a=t.length,i=qg(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=px("rc",a),c=px("source",a),l="".concat(u[a-1]," < ").concat(this.outputShape[a-1]),d=1===a?"source":"vec2(".concat(c.slice(-2).join(),")"),p="reflect"===r?0:1,f="";if(1===a){var h="\n        ".concat(i," source = rc;\n        if (source < start) {\n          source = start * 2 - source - ").concat(p,";\n        } else if (source >= end) {\n          source = (end - 1) * 2 - source + ").concat(p,";\n        }\n        source -= start;\n      ");f="\n        ".concat(i," rc = outputLoc;\n        ").concat(h,"\n        result[0] = getChannel(getX(").concat(c.join(),"), ").concat(d,");\n        ").concat(u[a-1]," += 1;\n        if(").concat(l,") {\n          ").concat(h,"\n          result[1] = getChannel(getX(").concat(c.join(),"), ").concat(d,");\n        }\n      ")}else{var m="\n        ".concat(i," source = rc;\n        ").concat(i," lt = ").concat(i,"(lessThan(source, start));\n        ").concat(i," gte = ").concat(i,"(greaterThanEqual(source, end));\n        ").concat(i," orig = 1 - (lt + gte);\n        source = orig * source +\n                lt * (start * 2 - source - ").concat(p,") +\n                gte * ((end - 1) * 2 - source + ").concat(p,");\n        source -= start;\n      ");f="\n        ".concat(i," rc = outputLoc;\n        ").concat(m,"\n        result[0] = getChannel(getX(").concat(c.join(),"), ").concat(d,");\n        ").concat(u[a-1]," += 1;\n        if(").concat(l,") {\n          ").concat(m,"\n          result[1] = getChannel(getX(").concat(c.join(),"), ").concat(d,");\n        }\n        rc = outputLoc;\n        ").concat(u[a-2]," += 1;\n        if(").concat(u[a-2]," < ").concat(this.outputShape[a-2],") {\n          ").concat(m,"\n          result[2] = getChannel(getX(").concat(c.join(),"), ").concat(d,");\n          ").concat(u[a-1]," += 1;\n          if(").concat(l,") {\n            ").concat(m,"\n            result[3] = getChannel(getX(").concat(c.join(),"), ").concat(d,");\n          }\n        }\n      ")}this.userCode="\n      const ".concat(i," start = ").concat(i,"(").concat(o,");\n      const ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ").concat(f,"\n        setOutput(result);\n      }\n    ")},rS={kernelName:a.Ub,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.x,o=r.paddings,s=r.mode,u=Object(a.be)().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new nS(i.shape,o,s):new tS(i.shape,o,s);return n.runWebGLProgram(u,[i],i.dtype)}},aS=Xx({opSnippet:"if (b == 0.0) return NAN;\n  return mod(a, b);",packedOpSnippet:"\n  vec4 result = mod(a, b);\n  bvec4 isNaN = equal(b, vec4(0.0));\n  \n  result.r = isNaN.r ? NAN : result.r;\n  result.g = isNaN.g ? NAN : result.g;\n  result.b = isNaN.b ? NAN : result.b;\n  result.a = isNaN.a ? NAN : result.a;\n\n  return result;\n"}),iS={kernelName:a.Vb,backendName:"webgl",kernelFunc:aS},oS=function e(t,n,r){Object($r.a)(this,e),this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[t,r],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < ".concat(n-1,"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float(").concat(n-1,"));\n      }\n    ")},sS=Xx({opSnippet:"\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",packedOpSnippet:"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n",checkOutOfBounds:!0}),uS={kernelName:a.pc,backendName:"webgl",kernelFunc:sS},cS="return a - b;",lS=Xx({opSnippet:cS,packedOpSnippet:cS,supportsComplex:!0,cpuKernelImpl:ox}),dS={kernelName:a.cd,backendName:"webgl",kernelFunc:lS};function pS(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.logits,o=r.dim,s=a.Df.parseAxisParam([o],i.shape),u=BI({inputs:{x:i},backend:n,attrs:{reductionIndices:s,keepDims:!1}}),c=a.zd.expandShapeToKeepDim(u.shape,s),l=rk({inputs:{x:u},backend:n,attrs:{shape:c}}),d=lS({inputs:{a:i,b:l},backend:n}),p=_O({inputs:{x:d},backend:n}),f=dk({inputs:{x:p},backend:n,attrs:{axis:s,keepDims:!1}}),h=rk({inputs:{x:f},backend:n,attrs:{shape:c}}),m=sS({inputs:{a:p,b:h},backend:n});return n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(h),m}var fS={kernelName:a.Lc,backendName:"webgl",kernelFunc:pS};var hS={kernelName:a.Wb,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,i=r.numSamples,o=r.seed,s=r.normalized,u=s?a:pS({inputs:{logits:a},backend:n,attrs:{dim:a.shape.length-1}}),c=u.shape[0],l=u.shape[1],d=new oS(c,l,i),p=[[o]],f=n.runWebGLProgram(d,[u],"int32",p);return s||n.disposeIntermediateTensorInfo(u),f}};var mS={kernelName:a.Yb,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,o=n.x;if(r.shouldExecuteOnCPU([o])){var s=r.texData.get(o.dataId),u=Wy(s.values,o.shape,o.dtype),c=Object(i.a)(u,2),l=c[0],d=c[1];return r.makeTensorInfo(d,o.dtype,l)}return t=Object(a.be)().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new Cx(o.shape,"\n  vec4 result = -x;\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"):new yx(o.shape,"if (isnan(x)) return x;\n  return -x;\n"),r.runWebGLProgram(t,[o],o.dtype)}},vS=a.pe.nonMaxSuppressionV3Impl;var bS={kernelName:a.Zb,backendName:"webgl",kernelFunc:function(e){a.zd.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var t=e.inputs,n=e.backend,r=e.attrs,i=t.boxes,o=t.scores,s=r.maxOutputSize,u=r.iouThreshold,c=r.scoreThreshold,l=n.readSync(i.dataId),d=n.readSync(o.dataId),p=vS(l,d,s,u,c).selectedIndices;return n.makeTensorInfo([p.length],"int32",new Int32Array(p))}},gS=a.pe.nonMaxSuppressionV4Impl;var yS={kernelName:a.ac,backendName:"webgl",kernelFunc:function(e){a.zd.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var t=e.inputs,n=e.backend,r=e.attrs,i=t.boxes,o=t.scores,s=r.maxOutputSize,u=r.iouThreshold,c=r.scoreThreshold,l=r.padToMaxOutputSize,d=n.readSync(i.dataId),p=n.readSync(o.dataId),f=gS(d,p,s,u,c,l),h=f.selectedIndices,m=f.validOutputs;return[n.makeTensorInfo([h.length],"int32",new Int32Array(h)),n.makeTensorInfo([],"int32",new Int32Array([m]))]}},xS=a.pe.nonMaxSuppressionV5Impl;var kS={kernelName:a.bc,backendName:"webgl",kernelFunc:function(e){a.zd.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var t=e.inputs,n=e.backend,r=e.attrs,i=t.boxes,o=t.scores,s=r.maxOutputSize,u=r.iouThreshold,c=r.scoreThreshold,l=r.softNmsSigma,d=n.readSync(i.dataId),p=n.readSync(o.dataId),f=xS(d,p,s,u,c,l),h=f.selectedIndices,m=f.selectedScores;return[n.makeTensorInfo([h.length],"int32",new Int32Array(h)),n.makeTensorInfo([m.length],"float32",new Float32Array(m))]}},wS=function e(t,n,r,a){Object($r.a)(this,e),this.variableNames=["indices"],this.outputShape=[t,n],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float(".concat(a,"), float(").concat(r,"),\n                      float(index == coords.y)));\n      }\n    ")},OS={kernelName:a.dc,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.indices,o=r.dtype,s=r.depth,u=r.onValue,c=r.offValue,l=a.Df.sizeFromShape(i.shape),d=new wS(l,s,u,c),p=rk({inputs:{x:i},backend:n,attrs:{shape:[l]}}),f=n.runWebGLProgram(d,[p],o);n.disposeIntermediateTensorInfo(p);var h=rk({inputs:{x:f},backend:n,attrs:{shape:[].concat(Object(qn.a)(i.shape),[s])}});return n.disposeIntermediateTensorInfo(f),h}};function IS(e){var t=e.inputs,n=e.backend,r=t.x;if("complex64"===r.dtype){var a=fw({inputs:{input:r},backend:n}),i=IS({inputs:{x:a},backend:n}),o=Tw({inputs:{input:r},backend:n}),s=IS({inputs:{x:o},backend:n}),u=Px({inputs:{real:i,imag:s},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}return UO({attrs:{shape:r.shape,dtype:r.dtype,value:"string"===r.dtype?"":0},backend:n})}var SS={kernelName:a.pd,backendName:"webgl",kernelFunc:IS};var NS={kernelName:a.ec,backendName:"webgl",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=n.x;if("string"===a.dtype)throw new Error("onesLike is not supported under string dtype");if("complex64"===a.dtype){var i=fw({inputs:{input:a},backend:r}),o=e({inputs:{x:i},backend:r}),s=Tw({inputs:{input:a},backend:r}),u=IS({inputs:{x:s},backend:r}),c=Px({inputs:{real:o,imag:u},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(u),c}return UO({attrs:{shape:a.shape,dtype:a.dtype,value:1},backend:r})}};var jS={kernelName:a.gc,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.axis;if(1===t.length)return RO({inputs:{input:t[0]},backend:n,attrs:{dim:r}});var i=t[0].shape,o=t[0].dtype;t.forEach((function(e){a.Df.assertShapesMatch(i,e.shape,"All tensors passed to stack must have matching shapes"),a.Df.assert(o===e.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var s=[],u=_w({inputs:t.map((function(e){var t=RO({inputs:{input:e},backend:n,attrs:{dim:r}});return s.push(t),t})),backend:n,attrs:{axis:r}});return s.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),u}},TS=function e(t,n,r){Object($r.a)(this,e),this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));var a=t.length,i=qg(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,a);this.userCode=1!==a?"\n      ".concat(i," start = ").concat(i,"(").concat(o,");\n      ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(value);\n        } else {\n          ").concat(i," coords = outC - start;\n          setOutput(getX(").concat(u,"));\n        }\n      }\n    "):"\n        int start = ".concat(o,";\n        int end = ").concat(s,";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(value);\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      ")},CS=function e(t,n,r){Object($r.a)(this,e),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));for(var a=t.length,i=qg(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=px("rc",a),c=px("source",a),l="".concat(u[a-1]," < ").concat(this.outputShape[a-1]),d=1===a?"source":"vec2(".concat(c.slice(-2).join(),")"),p=["".concat(i," rc = outputLoc;"),"".concat(u[a-1]," += 1;\n       if(").concat(l,") {\n      "),1===a?"":"}\n       rc = outputLoc;\n       ".concat(u[a-2]," += 1;\n       if(").concat(u[a-2]," < ").concat(this.outputShape[a-2],") {"),1===a?"":"  ".concat(u[a-1]," += 1;\n         if(").concat(l,") {")],f=1===a?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",h="",m=0,v=1===a?2:4;m<v;m++)h+="\n        ".concat(p[m],"\n        if (").concat(f,") {\n          result[").concat(m,"] = float(value);\n        } else {\n          ").concat(i," source = rc - start;\n          result[").concat(m,"] = getChannel(getX(").concat(c.join(),"), ").concat(d,");\n        }\n      ");h+=1===a?"} ":"}}",this.userCode="\n      const ".concat(i," start = ").concat(i,"(").concat(o,");\n      const ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ").concat(h,"\n        setOutput(result);\n      }\n    ")},ES=function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.x,o=r.paddings,s=r.constantValue;if(0===a.Df.sizeFromShape(i.shape))return UO({backend:n,attrs:{shape:o.map((function(e,t){return e[0]+i.shape[t]+e[1]})),value:s,dtype:i.dtype}});var u=Object(a.be)().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new CS(i.shape,o,s):new TS(i.shape,o,s),c=[[s]];return n.runWebGLProgram(u,[i],i.dtype,c)},_S={kernelName:a.hc,backendName:"webgl",kernelFunc:ES},AS=Xx({opSnippet:"\n  if(a < 0.0 && floor(b) < b){\n    return NAN;\n  }\n  if (b == 0.0) {\n    return 1.0;\n  }\n  return (round(mod(b, 2.0)) != 1) ?\n      pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",packedOpSnippet:"\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  bvec4 isNaN1 = lessThan(a, vec4(0.0));\n  bvec4 isNaN2 = lessThan(floor(b), b);\n  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);\n  \n  result.r = isNaN.r ? NAN : result.r;\n  result.g = isNaN.g ? NAN : result.g;\n  result.b = isNaN.b ? NAN : result.b;\n  result.a = isNaN.a ? NAN : result.a;\n\n  return result;\n"}),RS={kernelName:a.ic,backendName:"webgl",kernelFunc:AS};var DS={kernelName:a.kc,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,o=e.attrs,s=n.x,u=o.axis,c=o.keepDims,l=s.shape.length,d=[],p=a.Df.parseAxisParam(u,s.shape),f=p,h=a.zd.getAxesPermutation(f,l),m=s;if(null!=h&&(m=fk({inputs:{x:s},backend:r,attrs:{perm:h}}),f=a.zd.getInnerMostAxes(f.length,l),d.push(m)),a.zd.assertAxesAreInnerMostDims("prod",f,l),r.shouldExecuteOnCPU([m])){var v=r.texData.get(m.dataId).values,b=Vy(m.shape,m.dtype,v,f),g=b.outVals,y=b.outShape,x=b.outDtype;t=r.makeTensorInfo(y,x,g)}else{var k=a.zd.computeOutAndReduceShapes(m.shape,f),w=Object(i.a)(k,2),O=w[0],I=w[1],S=a.Df.sizeFromShape(I),N=rk({inputs:{x:m},backend:r,attrs:{shape:[-1,S]}}),j=sk(N,Object(a.qf)(s.dtype),"prod",r);t=rk({inputs:{x:j},backend:r,attrs:{shape:O}}),d.push(N),d.push(j)}if(c){d.push(t);var T=a.zd.expandShapeToKeepDim(t.shape,p);t=rk({inputs:{x:t},backend:r,attrs:{shape:T}})}return d.forEach((function(e){return r.disposeIntermediateTensorInfo(e)})),t}};var FS={kernelName:a.lc,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.paramsNestedSplits,o=t.paramsDenseValues,s=t.indices,u=r.outputRaggedRank,c=a.map((function(e){return n.readSync(e.dataId)})),l=a.map((function(e){return e.shape})),d=n.readSync(o.dataId),p=n.readSync(s.dataId),f=Gy(c,l,d,o.shape,o.dtype,p,s.shape,u),h=Object(i.a)(f,3),m=h[0],v=h[1],b=h[2],g=m.map((function(e){return n.makeTensorInfo([e.length],"int32",e)})),y=n.makeTensorInfo(b,o.dtype,v);return g.concat([y])}};var MS={kernelName:a.mc,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.shape,o=t.values,s=t.defaultValue,u=t.rowPartitionTensors,c=r.rowPartitionTypes,l=n.readSync(a.dataId),d=n.readSync(o.dataId),p=n.readSync(s.dataId),f=u.map((function(e){return n.readSync(e.dataId)})),h=u.map((function(e){return e.shape})),m=Hy(l,a.shape,d,o.shape,o.dtype,p,s.shape,f,h,c),v=Object(i.a)(m,2),b=v[0],g=v[1];return n.makeTensorInfo(b,o.dtype,g)}},zS=function(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,i=n.step,o=n.dtype,s=qy(r,a,i,o);return t.makeTensorInfo([s.length],o,s)},LS={kernelName:a.nc,backendName:"webgl",kernelFunc:zS},PS=Kx({opSnippet:"return 1.0 / x;"}),BS={kernelName:a.qc,backendName:"webgl",kernelFunc:PS},WS=Kx({opSnippet:"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : x;\n",packedOpSnippet:"\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"}),US={kernelName:a.rc,backendName:"webgl",kernelFunc:WS},VS=Kx({opSnippet:"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",packedOpSnippet:"\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"}),GS={kernelName:a.sc,backendName:"webgl",kernelFunc:VS},HS=function e(t,n,r,a,o){Object($r.a)(this,e),this.variableNames=["A"],this.outputShape=[];var s=Object(i.a)(t,4),u=s[0],c=s[1],l=s[2],d=s[3];this.outputShape=[u,n,r,d];var p,f=[a&&n>1?c-1:c,a&&r>1?l-1:l],h=[a&&n>1?n-1:n,a&&r>1?r-1:r];p=o?"(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ".concat(f[0]/h[0],",\n          ").concat(f[1]/h[1],");\n      const vec2 inputShapeRC = vec2(").concat(c,".0, ").concat(l,".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ").concat(p,";\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    ")},qS=function e(t,n,r,a,o){Object($r.a)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var s=Object(i.a)(t,4),u=s[0],c=s[1],l=s[2],d=s[3];this.outputShape=[u,n,r,d];var p,f=[a&&n>1?c-1:c,a&&r>1?l-1:l],h=[a&&n>1?n-1:n,a&&r>1?r-1:r];p=o?"(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ".concat(f[0]/h[0],",\n          ").concat(f[1]/h[1],",\n          ").concat(f[1]/h[1],");\n      const vec3 inputShapeRC = vec3(").concat(c,".0, ").concat(l,".0,\n                                     ").concat(l,".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ").concat(p,";\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ").concat(d-1,";\n        bool hasNextRow = coords.z < ").concat(r-1,";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    ")};var KS={kernelName:a.uc,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,o=t.images,s=r.alignCorners,u=r.halfPixelCenters,c=r.size,l=Object(i.a)(c,2),d=l[0],p=l[1],f=Object(a.be)().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new qS(o.shape,d,p,s,u):new HS(o.shape,d,p,s,u);return n.runWebGLProgram(f,[o],"float32")}},XS=function e(t,n,r){Object($r.a)(this,e),this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;var a=Object(i.a)(n,3),o=a[1],s=a[2],u=Object(i.a)(t,3),c=u[1],l=u[2],d=[r&&c>1?o-1:o,r&&l>1?s-1:s],p=[r&&c>1?c-1:c,r&&l>1?l-1:l],f=d[0]/p[0],h=d[1]/p[1],m=1/f,v=1/h,b=2*Math.ceil(m)+2,g=2*Math.ceil(v)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(".concat(f,");\n        const float widthScale = float(").concat(h,");\n\n        const float invHeightScale = float(").concat(m,");\n        const float invWidthScale = float(").concat(v,");\n\n        const int winHeight = int(").concat(b,");\n        const int winWidth = int(").concat(g,");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ").concat(c,") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ").concat(l,") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), ").concat(o-1,".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), ").concat(s-1,".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    ")};var YS={kernelName:a.vc,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=t.dy,o=r.alignCorners,s=new XS(i.shape,a.shape,o);return n.runWebGLProgram(s,[i],i.dtype)}},ZS=function e(t,n,r,a,o){Object($r.a)(this,e),this.variableNames=["A"],this.outputShape=[];var s=Object(i.a)(t,4),u=s[0],c=s[1],l=s[2],d=s[3];this.outputShape=[u,n,r,d];var p,f=[a&&n>1?c-1:c,a&&r>1?l-1:l],h=[a&&n>1?n-1:n,a&&r>1?r-1:r],m=a?"0.5":"0.0";p=o?"max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ".concat(f[0]/h[0],",\n          ").concat(f[1]/h[1],");\n      const vec2 inputShapeRC = vec2(").concat(c,".0, ").concat(l,".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ").concat(p,";\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ").concat(m,")));\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    ")},JS=function e(t,n,r,a,o){Object($r.a)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var s=Object(i.a)(t,4),u=s[0],c=s[1],l=s[2],d=s[3];this.outputShape=[u,n,r,d];var p,f=[a&&n>1?c-1:c,a&&r>1?l-1:l],h=[a&&n>1?n-1:n,a&&r>1?r-1:r],m=a?"0.5":"0.0";p=o?"max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ".concat(f[0]/h[0],",\n          ").concat(f[1]/h[1],",\n          ").concat(f[1]/h[1],");\n      const vec3 inputShapeRC = vec3(").concat(c,".0, ").concat(l,".0,\n                                     ").concat(l,".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ").concat(p,";\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec3 sourceNearestRC = ivec3(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ").concat(m,")));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ").concat(d-1,";\n        bool hasNextRow = coords.z < ").concat(r-1,";\n\n        vec4 newValue = vec4(\n          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),\n          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);\n\n        setOutput(newValue);\n      }\n    ")};var QS={kernelName:a.wc,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,o=t.images,s=r.alignCorners,u=r.halfPixelCenters,c=r.size,l=Object(i.a)(c,2),d=l[0],p=l[1],f=Object(a.be)().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new JS(o.shape,d,p,s,u):new ZS(o.shape,d,p,s,u);return n.runWebGLProgram(f,[o],o.dtype)}},$S=function e(t,n,r){Object($r.a)(this,e),this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;var a=Object(i.a)(n,3),o=a[1],s=a[2],u=Object(i.a)(t,3),c=u[1],l=u[2],d=[r&&c>1?o-1:o,r&&l>1?s-1:s],p=[r&&c>1?c-1:c,r&&l>1?l-1:l],f=d[0]/p[0],h=d[1]/p[1],m=1/f,v=1/h,b=2*Math.ceil(m)+2,g=2*Math.ceil(v)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(".concat(f,");\n        const float widthScale = float(").concat(h,");\n\n        const float invHeightScale = float(").concat(m,");\n        const float invWidthScale = float(").concat(v,");\n\n        const int winHeight = int(").concat(b,");\n        const int winWidth = int(").concat(g,");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ").concat(c,") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ").concat(l,") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float(").concat(d[0],") *\n                (float(dyR) / float(").concat(p[0],"));\n\n            float sourceFracCol =\n                float(").concat(d[1],") *\n                  (float(dyC) / float(").concat(p[1],"));\n\n            int sourceNearestRow = int(min(\n                float(int(").concat(o,") - 1),\n                ").concat(r," ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int(").concat(s,") - 1),\n                ").concat(r," ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    ")};var eN={kernelName:a.xc,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=t.dy,o=r.alignCorners,s=new $S(i.shape,a.shape,o);return n.runWebGLProgram(s,[i],i.dtype)}},tN=function e(t,n){Object($r.a)(this,e),this.variableNames=["x"];var r=t.length;if(r>4)throw new Error("WebGL backend: Reverse of rank-".concat(r," tensor is not yet supported"));if(this.outputShape=t,1!==r){var a=t.map((function(e,r){return function(e){return-1!==n.indexOf(e)&&1!==t[e]?"".concat(t[e]," - coords[").concat(e,"] - 1"):"coords[".concat(e,"]")}(r)})).join(","),i=qg(r);this.userCode="\n      void main() {\n        ".concat(i," coords = getOutputCoords();\n        setOutput(getX(").concat(a,"));\n      }\n    ")}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX(".concat(t[0]," - coord - 1));\n        }\n      ")},nN=function e(t,n){Object($r.a)(this,e),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var r=t.length;if(r>4)throw new Error("WebGL backend: Reverse of rank-".concat(r," tensor is not yet supported"));this.outputShape=t;var a=px("rc",r),i="".concat(a[r-1]," + 1 < ").concat(this.outputShape[r-1]),o="".concat(a[r-2]," + 1 < ").concat(this.outputShape[r-2]),s=qg(r);function u(e){var r=t.map((function(r,a){return function(e,r){return-1!==n.indexOf(e)&&1!==t[e]?"".concat(t[e]," - ").concat(r[e]," - 1"):"".concat(r[e])}(a,e)})),a=r.join(","),i=r.slice(-2).join(",");return"getChannel(getX(".concat(a,"), vec2(").concat(i,"))")}this.userCode=1===r?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX(".concat(t[0]," - rc - 1),\n            ").concat(t[0]," - rc - 1);\n          if(").concat(i,"){\n              result.g = getChannel(getX(").concat(t[0]," - (rc  + 1) - 1),\n                ").concat(t[0]," - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      "):"\n        void main() {\n          ".concat(s," rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = ").concat(function(e){return u(e)}(a.slice()),";\n          if(").concat(i,"){\n            result.g = ").concat(function(e){return e[r-1]="("+e[r-1]+" + 1)",u(e)}(a.slice()),";\n          }\n          if(").concat(o,") {\n            result.b = ").concat(function(e){return e[r-2]="("+e[r-2]+" + 1)",u(e)}(a.slice()),";\n            if(").concat(i,") {\n              result.a = ").concat(function(e){return e[r-1]="("+e[r-1]+" + 1)",e[r-2]="("+e[r-2]+" + 1)",u(e)}(a.slice()),";\n            }\n          }\n          setOutput(result);\n        }\n    ")};var rN={kernelName:a.yc,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.x,o=r.dims,s=i.shape.length,u=a.Df.parseAxisParam(o,i.shape);if(0===s)return zx({inputs:{x:i},backend:n});var c=Object(a.be)().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new nN(i.shape,u):new tN(i.shape,u);return n.runWebGLProgram(c,[i],i.dtype)}},aN=function e(t,n){Object($r.a)(this,e),this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];var r=t[1],a=t[2];this.outputShape=t;var i="";i="number"===typeof n?"float outputValue = ".concat(n.toFixed(2),";"):"\n        vec3 fill = vec3(".concat(n.join(","),");\n        float outputValue = fill[coords[3]];"),this.userCode="\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n          int y = coords[1];\n          float coordXFloat = (float(x) - params[0]) * params[3] -\n            (float(y) - params[1]) * params[2];\n          float coordYFloat = (float(x) - params[0]) * params[2] +\n            (float(y) - params[1]) * params[3];\n          int coordX = int(round(coordXFloat + params[0]));\n          int coordY = int(round(coordYFloat + params[1]));\n          ".concat(i,"\n          if(coordX >= 0 && coordX < ").concat(a," && coordY >= 0 && coordY < ").concat(r,") {\n            outputValue = getImage(coords[0], coordY, coordX, coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    ")},iN={kernelName:a.zc,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,o=t.image,s=n.radians,u=n.fillValue,c=n.center,l=r,d=new aN(o.shape,u),p=a.zd.getImageCenter(c,o.shape[1],o.shape[2]),f=Object(i.a)(p,2),h=[[f[0],f[1],Math.sin(s),Math.cos(s)]];return l.runWebGLProgram(d,[o],o.dtype,h)}},oN=Kx({opSnippet:"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n"}),sN={kernelName:a.Ac,backendName:"webgl",kernelFunc:oN},uN=Kx({opSnippet:"return inversesqrt(x);",cpuKernelImpl:Ky}),cN={kernelName:a.Bc,backendName:"webgl",kernelFunc:uN},lN=function e(t,n,r,a,i,o){Object($r.a)(this,e),this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;var s=qg(i.length),u=qg(o.length),c="";1===r?c="i":2===r&&(c="i, j");var l="getIndices(".concat(c,")"),d="";1===a?d="i":2===a&&(d="i, coords[1]");var p="getUpdates(".concat(d,")"),f=n>1?"strides[j]":"strides";this.userCode="\n        ".concat(s," strides = ").concat(s,"(").concat(i,");\n\n        void main() {\n          ").concat(u," coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < ").concat(t,"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < ").concat(n,"; j++) {\n              int index = round(").concat(l,");\n              flattenedIndex += index * ").concat(f,";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += ").concat(p,";\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      ")};var dN={kernelName:a.Cc,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.indices,o=t.updates,s=r.shape,u=a.zd.calculateShapes(o,i,s),c=u.sliceRank,l=u.numUpdates,d=u.sliceSize,p=u.strides,f=u.outputSize,h=[f/d,d];if(0===f)return n.makeTensorInfo(s,i.dtype);var m=rk({inputs:{x:i},backend:n,attrs:{shape:[l,c]}}),v=rk({inputs:{x:o},backend:n,attrs:{shape:[l,d]}}),b=n.makeTensorInfo([],"float32",new Float32Array([0])),g=new lN(l,c,m.shape.length,v.shape.length,p,h),y=n.runWebGLProgram(g,[v,m,b],v.dtype),x=rk({inputs:{x:y},backend:n,attrs:{shape:s}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(b),x}},pN=function e(t,n,r,i){Object($r.a)(this,e),this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[t,r];var o="for (int i = 0; i < ".concat(Math.ceil(Math.log2(n+1)),"; ++i) { if (left >= right) break;"),s=2===Object(a.be)().getNumber("WEBGL_VERSION")?"while (left < right) {":o,u="left"===i?"<":"<=";this.userCode="\n       int findBound(int batch, float value) {\n         int left = 0;\n         int right = numInputs;\n         int mid;\n         ".concat(s,"\n           mid = (left + right) / 2;\n           if (getSortedSequence(batch, mid) ").concat(u," value) {\n             left = mid + 1;\n           } else {\n             right = mid;\n           }\n         }\n         return right;\n       }\n\n       void main() {\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int valueIndex = coords[1];\n\n         float value = getValues(batch, valueIndex);\n\n         setOutput(float(findBound(batch, value)));\n       }\n     ")};var fN={kernelName:a.Dc,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.sortedSequence,i=t.values,o=r.side,s=new pN(a.shape[0],a.shape[1],i.shape[1],o),u=[[a.shape[1]]];return n.runWebGLProgram(s,[a,i],"int32",u)}},hN=function e(t,n,r){var a,i;if(Object($r.a)(this,e),this.variableNames=["c","a","b"],this.outputShape=n,r>4)throw Error("Where for rank ".concat(r," is not yet supported"));if(1===r)i="resRC",a="resRC";else{for(var o=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[],u=[],c=0;c<n.length;c++)u.push("".concat(o[c])),c<t&&s.push("".concat(o[c]));a=s.join(),i=u.join()}var l=qg(r);this.userCode="\n      void main() {\n        ".concat(l," resRC = getOutputCoords();\n        float cVal = getC(").concat(a,");\n        if (cVal >= 1.0) {\n          setOutput(getA(").concat(i,"));\n        } else {\n          setOutput(getB(").concat(i,"));\n        }\n      }\n    ")};var mN={kernelName:a.Ec,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.condition,i=t.t,o=t.e,s=new hN(r.shape.length,i.shape,i.shape.length);return n.runWebGLProgram(s,[r,i,o],Object(a.Cf)(i.dtype,o.dtype))}},vN=Kx({opSnippet:"\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = ".concat(a.zd.SELU_SCALEALPHA,";\n  float scale = ").concat(a.zd.SELU_SCALE,";\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n")}),bN={kernelName:a.Fc,backendName:"webgl",kernelFunc:vN},gN=Kx({opSnippet:"if (isnan(x)) return x;\n  return 1.0 / (1.0 + exp(-1.0 * x));\n",packedOpSnippet:"\n  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",cpuKernelImpl:Yy}),yN={kernelName:a.Gc,backendName:"webgl",kernelFunc:gN},xN=Kx({opSnippet:"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n"}),kN={kernelName:a.Hc,backendName:"webgl",kernelFunc:xN},wN=Kx({opSnippet:"if (isnan(x)) return x;\n  return sin(x);\n"}),ON={kernelName:a.Ic,backendName:"webgl",kernelFunc:wN},IN=Kx({opSnippet:"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n"}),SN={kernelName:a.Jc,backendName:"webgl",kernelFunc:IN},NN=Kx({opSnippet:"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n"}),jN={kernelName:a.Mc,backendName:"webgl",kernelFunc:NN},TN={kernelName:a.Nc,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.x,o=r.blockShape,s=r.paddings;a.Df.assert(i.shape.length<=4,(function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"}));var u=o.reduce((function(e,t){return e*t})),c=[[0,0]];c.push.apply(c,Object(qn.a)(s));for(var l=1+o.length;l<i.shape.length;++l)c.push([0,0]);var d=[],p=ES({inputs:{x:i},backend:n,attrs:{paddings:c,constantValue:0}}),f=a.zd.getReshaped(p.shape,o,u,!1),h=a.zd.getPermuted(f.length,o.length,!1),m=a.zd.getReshapedPermuted(p.shape,o,u,!1),v=rk({inputs:{x:p},backend:n,attrs:{shape:f}}),b=fk({inputs:{x:v},backend:n,attrs:{perm:h}}),g=rk({inputs:{x:b},backend:n,attrs:{shape:m}});return d.push(p),d.push(v),d.push(b),d.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),g}};var CN={kernelName:a.Oc,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.indices,a=t.values,o=t.denseShape,s=t.defaultValue;if(1!==o.shape.length)throw new Error("Dense shape must be a vector, saw:\n         ".concat(o.shape));if(2!==r.shape.length)throw new Error("Indices must be a matrix, saw:\n         ".concat(r.shape));if(1!==a.shape.length)throw new Error("Values must be a vector, saw:\n         ".concat(a.shape));if(0!==s.shape.length)throw new Error("Default value must be a scalar, saw:\n        ".concat(s.shape));var u=n.readSync(r.dataId),c=n.readSync(a.dataId),l=n.readSync(o.dataId),d=n.readSync(s.dataId)[0],p=Qy(u,r.shape,r.dtype,c,a.dtype,l,d),f=Object(i.a)(p,5),h=f[0],m=f[1],v=f[2],b=f[3],g=f[4];return[n.makeTensorInfo(m,r.dtype,h),n.makeTensorInfo([m[0]],a.dtype,v),n.makeTensorInfo([b.length],"bool",new Uint8Array(b.map((function(e){return Number(e)})))),n.makeTensorInfo([g.length],r.dtype,new Int32Array(g))]}};var EN={kernelName:a.Pc,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.inputIndices,a=t.inputShape,o=t.newShape;if(2!==r.shape.length)throw new Error("Input indices should be a matrix but received shape ".concat(r.shape));if(1!==a.shape.length)throw new Error("Input shape should be a vector but received shape ".concat(a.shape));if(1!==o.shape.length)throw new Error("Target shape should be a vector but received shape ".concat(o.shape));var s=Array.from(n.readSync(a.dataId)),u=n.readSync(r.dataId),c=Array.from(n.readSync(o.dataId)),l=$y(u,r.shape,r.dtype,s,c),d=Object(i.a)(l,3),p=d[0],f=d[1],h=d[2];return[n.makeTensorInfo(f,r.dtype,p),n.makeTensorInfo([h.length],o.dtype,new Int32Array(h))]}};var _N={kernelName:a.Qc,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.data,a=t.indices,o=t.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n              ".concat(a.shape));if(1!==o.shape.length)throw new Error("Segment ids should be a vector but received shape\n              ".concat(o.shape));var s=n.readSync(r.dataId),u=n.readSync(a.dataId),c=n.readSync(o.dataId),l=ex(s,r.shape,r.dtype,u,c,!0),d=Object(i.a)(l,2),p=d[0],f=d[1];return n.makeTensorInfo(f,r.dtype,p)}};var AN={kernelName:a.Rc,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.data,a=t.indices,o=t.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n             ".concat(a.shape));if(1!==o.shape.length)throw new Error("Segment ids should be a vector but received shape\n             ".concat(o.shape));var s=n.readSync(r.dataId),u=n.readSync(a.dataId),c=n.readSync(o.dataId),l=ex(s,r.shape,r.dtype,u,c),d=Object(i.a)(l,2),p=d[0],f=d[1];return n.makeTensorInfo(f,r.dtype,p)}};var RN={kernelName:a.Sc,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.sparseIndices,o=t.sparseValues,s=t.defaultValue,u=r.outputShape,c=a.zd.calculateShapes(o,i,u),l=c.sliceRank,d=c.numUpdates,p=c.sliceSize,f=c.strides,h=c.outputSize;if("string"===o.dtype){var m=n.bufferSync(i),v=n.bufferSync(o),b=a.Df.decodeString(n.readSync(s.dataId)[0]),g=Xy(m,v,u,h,p,d,l,f,b,!1);return n.makeTensorInfo(u,g.dtype,g.values)}var y=new lN(d,l,i.shape.length,o.shape.length,f,[h,1],!1),x=n.runWebGLProgram(y,[o,i,s],o.dtype),k=rk({inputs:{x:x},backend:n,attrs:{shape:u}});return n.disposeIntermediateTensorInfo(x),k}};var DN={kernelName:a.Tc,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.x,o=r.numOrSizeSplits,s=r.axis,u=a.Df.parseAxisParam(s,i.shape)[0],c=a.zd.prepareSplitSize(i,o,u),l=i.shape.length,d=new Array(l).fill(0),p=i.shape.slice();return c.map((function(e){var t=Object(qn.a)(p);t[u]=e;var r=ow({inputs:{x:i},backend:n,attrs:{begin:d,size:t}});return d[u]+=e,r}))}},FN="return sqrt(x);",MN=Kx({opSnippet:FN,packedOpSnippet:FN,cpuKernelImpl:tx}),zN={kernelName:a.Uc,backendName:"webgl",kernelFunc:MN},LN=Kx({opSnippet:"return x * x;"}),PN={kernelName:a.Vc,backendName:"webgl",kernelFunc:LN},BN=Xx({opSnippet:"return (a - b) * (a - b);",packedOpSnippet:"return (a - b) * (a - b);"}),WN={kernelName:a.Wc,backendName:"webgl",kernelFunc:BN};var UN={kernelName:a.Xc,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=xx+"\n    return x > 0.0 ? 1.0 : float(".concat(n.alpha,");\n  "),o=new yx(a.shape,i);return r.runWebGLProgram(o,[a],a.dtype)}},VN=function e(t,n,r){Object($r.a)(this,e),this.variableNames=["x"],this.outputShape=r;var a=r.length,i=qg(r.length),o=qg(r.length),s="";if(1===a)s="coords * strides + begin";else{var u=0;s=r.map((function(e,t){return u++,1===r.length?"coords * strides[".concat(t,"] + begin[").concat(t,"]"):"coords[".concat(u-1,"] * strides[").concat(t,"] + begin[").concat(t,"]")})).join(",")}this.userCode="\n      ".concat(i," begin = ").concat(i,"(").concat(t,");\n      ").concat(i," strides = ").concat(i,"(").concat(n,");\n\n      void main() {\n        ").concat(o," coords = getOutputCoords();\n        setOutput(getX(").concat(s,"));\n      }\n    ")};var GN={kernelName:a.Yc,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,i=e.attrs,o=n.x,s=i.begin,u=i.end,c=i.strides,l=i.beginMask,d=i.endMask,p=i.ellipsisMask,f=i.newAxisMask,h=i.shrinkAxisMask,m=a.hf.sliceInfo(o.shape,s,u,c,l,d,p,f,h),v=m.finalShapeSparse,b=m.finalShape,g=m.isIdentity,y=m.sliceDim0,x=m.isSimpleSlice,k=m.begin,w=m.end,O=m.strides;if(g)t=rk({inputs:{x:o},backend:r,attrs:{shape:b}});else if(y||x){a.Df.assert(o.shape.length>=1,(function(){return"Input must have rank at least 1, got: ".concat(o.shape.length)}));var I=a.hf.computeOutShape(k,w,O),S=ow({inputs:{x:o},backend:r,attrs:{begin:k,size:I}});t=rk({inputs:{x:S},backend:r,attrs:{shape:b}}),r.disposeIntermediateTensorInfo(S)}else{if(r.shouldExecuteOnCPU([o])){var N=r.readSync(o.dataId),j=Object(a.Gd)(o.shape,o.dtype,N),T=nx(v,j,O,k);t=r.makeTensorInfo(b,o.dtype,T.values)}else{var C=new VN(k,O,v);t=r.runWebGLProgram(C,[o],o.dtype)}}var E=rk({inputs:{x:t},backend:r,attrs:{shape:b}});return r.disposeIntermediateTensorInfo(t),E}};var HN={kernelName:a.Zc,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=r.separator,o=r.nGramWidths,s=r.leftPad,u=r.rightPad,c=r.padWidth,l=r.preserveShortSequences,d=t.data,p=t.dataSplits,f=n.readSync(d.dataId),h=n.readSync(p.dataId),m=rx(f,h,a,o,s,u,c,l),v=Object(i.a)(m,2),b=v[0],g=v[1];return[n.makeTensorInfo([b.length],"string",b),n.makeTensorInfo(p.shape,"int32",g)]}};var qN={kernelName:a.ad,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.skipEmpty,a=t.input,o=t.delimiter;if("string"!==a.dtype)throw new Error("Input must be of datatype string");if(1!==a.shape.length)throw new Error("Input must be a vector, got shape: ".concat(a.shape));if(0!==o.shape.length)throw new Error("Delimiter must be a scalar, got shape: ".concat(o.shape));var s=n.readSync(a.dataId),u=n.readSync(o.dataId)[0],c=ax(s,u,r),l=Object(i.a)(c,3),d=l[0],p=l[1],f=l[2],h=p.length;return[n.makeTensorInfo([h,2],"int32",d),n.makeTensorInfo([h],"string",p),n.makeTensorInfo([2],"int32",new Int32Array(f))]}};var KN={kernelName:a.bd,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.numBuckets,a=t.input;if("string"!==a.dtype)throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");var i=n.readSync(a.dataId),o=ix(i,r);return n.makeTensorInfo(a.shape,"int32",o)}},XN=Kx({opSnippet:"return tan(x);"}),YN={kernelName:a.ed,backendName:"webgl",kernelFunc:XN},ZN=Kx({opSnippet:"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n"}),JN={kernelName:a.fd,backendName:"webgl",kernelFunc:ZN},QN=function e(t,n){Object($r.a)(this,e),this.variableNames=["A"];for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[a]*n[a];this.outputShape=r,this.rank=r.length;var i=qg(this.rank),o=function(e){var t=e.length;if(t>5)throw Error("Tile for rank ".concat(t," is not yet supported"));if(1===t)return"imod(resRC, ".concat(e[0],")");for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],a=0;a<e.length;a++)r.push("imod(".concat(n[a],", ").concat(e[a],")"));return r.join()}(t);this.userCode="\n      void main() {\n        ".concat(i," resRC = getOutputCoords();\n        setOutput(getA(").concat(o,"));\n      }\n    ")};function $N(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.x,o=r.reps;if("string"===i.dtype||i.shape.length>5){var s=n.readSync(i.dataId),u="string"===i.dtype?s.map((function(e){return a.Df.decodeString(e)})):s,c=Object(a.Gd)(i.shape,i.dtype,u),l=sx(c,o);return n.makeTensorInfo(l.shape,l.dtype,l.values)}var d=new QN(i.shape,o);return n.runWebGLProgram(d,[i],i.dtype)}var ej={kernelName:a.id,backendName:"webgl",kernelFunc:$N},tj=function e(t){Object($r.a)(this,e),this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=t,this.userCode="\n       void main() {\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int elemIdx = coords[1];\n\n         // We compare elements pair-wise within a group of size 2 * inc.\n         // The comparing rule for each group alternates between ascending\n         // and descending. Within each group, we compare each pair at\n         // positions i and i+inc. To decide whether an element at position i\n         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than\n         // inc, it is in the first half of the group, we denote it as x0,\n         // otherwise we denote it as x1.\n         // For example, as shown in the Bitonic top K paper referenced above,\n         // Figure5(a) shows that element[1] is in the\n         // second half of the group when group size is 2, but it is in the\n         // first half of the group when group size is 4.\n\n         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;\n         int i = isFirstInPair ? elemIdx : elemIdx - inc;\n\n         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));\n         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));\n         float x0 = i0 < n ? getX(batch, i0) : negativeInf;\n         float x1 = i1 < n ? getX(batch, i1) : negativeInf;\n\n         // Denotes which direction indices are in (ascending or descending).\n         bool reverse = imod(elemIdx, 2 * dir) >= dir;\n         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);\n         if (reverse == isGreater) { // Elements in opposite order of direction\n           int iTemp = i0;\n           i0 = i1;\n           i1 = iTemp;\n         }\n         if (isFirstInPair) {\n            setOutput(float(i0));\n         } else {\n            setOutput(float(i1));\n         }\n       }\n     "},nj=function e(t){Object($r.a)(this,e),this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=t,this.userCode="\n    void main() {\n         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int elemIdx = coords[1];\n\n         // The output size is half of the previous size.\n         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),\n         // we only need to output the indices at positions |, the indices at\n         // positions _ can be thrown away, see Figure5(b) After Phase 2\n         // (Merge phase) in the Bitonic Top K paper referenced above.\n         // For example, the paper shows we only need to output the orange bars.\n         // The output sequence should look like this | | | | | | | |.\n         // Because the sequence is halved, to map the output index back\n         // to the previous sequence to find the corresponding value,\n         // we need to double the index. When we double the index,\n         // we basically interpolate a position, so 2i looks like\n         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position\n         // of each 2k positions by - elemIdx % k. E.g. for output at\n         // index 4,5,6,7, we want to get the corresponding element at\n         // original index 8,9,10,11, for output at index 8,9,10,11,\n         // we want to get the corresponding element at original index\n         // 16,17,18,19, so on and so forth.\n\n         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));\n         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));\n         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));\n\n         float x0 = getX(batch, i0);\n         float x1 = i1 < n ? getX(batch, i1) : x0;\n\n         setOutput(x0 >= x1 ? float(i0) : float(i1));\n       }\n     "};function rj(e,t){null!==t&&e.disposeIntermediateTensorInfo(t)}function aj(e){for(var t=1;t<e;)t*=2;return t}var ij={kernelName:a.jd,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,o=t.x,s=r.k,u=r.sorted,c=Object(a.be)().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),l=Object(a.be)().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),d=o.shape,p=d[d.length-1];if(n.shouldExecuteOnCPU([o])||p<c||s>l){var f=n.readSync(o.dataId),h=ux(f,d,o.dtype,s,u),m=Object(i.a)(h,2),v=m[0],b=m[1];return[n.makeTensorInfo(v.shape,v.dtype,v.values),n.makeTensorInfo(b.shape,b.dtype,b.values)]}if(0===s)return d[d.length-1]=0,[n.makeTensorInfo(d,o.dtype,[]),n.makeTensorInfo(d,"int32",[])];if(1===p)return[o,UO({attrs:{shape:d,dtype:"int32",value:0},backend:n})];var g=n.texData.get(o.dataId),y=null!==g&&g.isPacked,x=y?n.unpackTensor(o):o,k=a.Df.sizeFromShape(d)/p,w=rk({inputs:{x:x},attrs:{shape:[k,p]},backend:n});y&&rj(n,x);for(var O=aj(s),I=aj(p),S=null,N=function(){return null===S?[w,w]:[w,S]},j=function(e,t,r){var a=N(),i=new tj(r),o=[[p],[null===S?1:0],[Number.NEGATIVE_INFINITY],[e],[t]],s=S;S=n.runWebGLProgram(i,a,"int32",o),rj(n,s)},T=1;T<O;T*=2)for(var C=2*T,E=T;E>=1;E/=2)j(C,E,[k,I]);for(var _=I;_>O;_/=2){var A=N(),R=new nj([k,_/2]),D=[[p],[null===S?1:0],[O]],F=S;S=n.runWebGLProgram(R,A,"int32",D),rj(n,F);for(var M=O/2,z=2*M,L=M;L>=1;L/=2)j(z,L,S.shape)}var P=S;S=ow({inputs:{x:S},backend:n,attrs:{begin:0,size:[k,s]}}),rj(n,P);var B=sI({inputs:{x:w,indices:S},backend:n,attrs:{axis:1,batchDims:1}});rj(n,w);var W=d.slice(0,-1);W.push(s),P=S,S=rk({inputs:{x:S},attrs:{shape:W},backend:n}),rj(n,P);var U=B;return B=rk({inputs:{x:B},attrs:{shape:W},backend:n}),rj(n,U),[B,S]}},oj=function e(t,n,r,a,i,o){Object($r.a)(this,e),this.variableNames=["Image","Transforms"],this.outputShape=o;var s,u="nearest"===r?1:2;switch(a){case"constant":s=1;break;case"reflect":s=2;break;case"wrap":s=3;break;case"nearest":s=4;break;default:s=1}this.userCode="\n            float mapCoord(float outCoord, float len) {\n              float inCoord = outCoord;\n              if(".concat(s," == 2) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    if (inCoord < sz2) {\n                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +\n                      inCoord;\n                    }\n                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    inCoord -= sz2 * float(int(float(inCoord / sz2)));\n                    if (inCoord >= len) {\n                      inCoord = sz2 - inCoord - 1.0;\n                    }\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (").concat(s," == 3) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord -= len * float(int(float(inCoord / sz)));\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (").concat(s," == 4) {\n                return clamp(outCoord, 0.0, len - 1.0);\n              } else {\n                return outCoord;\n              }\n            }\n\n            float readWithFillValue(int batch, int coordY, int coordX,\n              int channel) {\n              float outputValue;\n              if (0 <= coordY && coordY < ").concat(t," && 0 <= coordX && coordX < ").concat(n,") {\n                  outputValue = getImage(batch, coordY, coordX, channel);\n              } else {\n                outputValue = float(").concat(i,");\n              }\n              return outputValue;\n            }\n\n            void main() {\n              ivec4 coords = getOutputCoords();\n              float outputValue;\n              int batch = coords[0];\n              int x = coords[2];\n              int y = coords[1];\n              int channel = coords[3];\n              float xf = float(x);\n              float yf = float(y);\n              float a1 = getTransforms(batch, 0);\n              float a2 = getTransforms(batch, 1);\n              float a3 = getTransforms(batch, 2);\n              float b1 = getTransforms(batch, 3);\n              float b2 = getTransforms(batch, 4);\n              float b3 = getTransforms(batch, 5);\n              float c1 = getTransforms(batch, 6);\n              float c2 = getTransforms(batch, 7);\n              float projection = c1 * xf + c2 * yf + 1.0;\n              if (projection == 0.0) {\n                outputValue = float(").concat(i,");\n              } else {\n                float inX = (a1 * xf + a2 * yf + a3) / projection;\n                float inY = (b1 * xf + b2 * yf + b3) / projection;\n                float mapX = mapCoord(inX, float(").concat(n,"));\n                float mapY = mapCoord(inY, float(").concat(t,"));\n\n                if (").concat(u," == 1) {\n                  int coordY = int(round(mapY));\n                  int coordX = int(round(mapX));\n                  outputValue = readWithFillValue(batch, coordY, coordX,\n                    channel);\n                } else {\n                  float yFloor = floor(mapY);\n                  float xFloor = floor(mapX);\n                  float yCeil = yFloor + 1.0;\n                  float xCeil = xFloor + 1.0;\n                  float valueYFloor = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);\n                  float valueYCeil = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);\n                  outputValue = (yCeil - mapY) * valueYFloor +\n                  (mapY - yFloor) * valueYCeil;\n                }\n              }\n              setOutput(outputValue);\n            }\n        ")};var sj={kernelName:a.kd,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.image,o=t.transforms,s=r.interpolation,u=r.fillMode,c=r.fillValue,l=r.outputShape,d=Object(i.a)(a.shape,4),p=d[0],f=d[1],h=d[2],m=d[3],v=null!=l?l:[f,h],b=Object(i.a)(v,2),g=b[0],y=b[1],x=new oj(f,h,s,u,c,[p,g,y,m]);return n.runWebGLProgram(x,[a,o],"float32")}};var uj={kernelName:a.md,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=n.axis,i=t.x;yg(i,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");var o=r.readSync(i.dataId),s=lx(o,a,i.shape,i.dtype),u=s.outputValues,c=s.outputShape,l=s.indices;return[r.makeTensorInfo(c,i.dtype,u),r.makeTensorInfo([l.length],"int32",l)]}};var cj={kernelName:a.nd,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.value,i=r.axis;i<0&&(i+=a.shape.length);for(var o=a,s=o.shape.length,u=a.shape[i],c=new Array(s-1),l=0,d=0;d<s;d++)d!==i&&(c[l++]=o.shape[d]);var p=[],f=new Array(s).fill(0),h=o.shape.slice();h[i]=1;for(var m=new Array(u),v=0;v<m.length;v++){f[i]=v;var b=ow({inputs:{x:o},backend:n,attrs:{begin:f,size:h}}),g=rk({inputs:{x:b},backend:n,attrs:{shape:c}});m[v]=g,p.push(b)}return p.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),m}},lj=function e(t,n){Object($r.a)(this,e),this.variableNames=["x","segmentIds"];var r=t.windowSize,a=t.batchSize,i=t.inSize,o=t.numSegments,s=o*Math.ceil(i/r);this.outputShape=[a,s];var u=4*Math.floor(r/4),c=r%4,l="\n        sumValue += dot(values, segFilter);\n    ",d="";i%r>0&&(d="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return initializationValue;\n        }\n      "));var p="";i%r>0&&(p="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return -1.0;\n        }\n      ")),this.userCode="\n      const float initializationValue = ".concat("0.0",";\n\n      float getValue(int batch, int inIdx) {\n        ").concat(d,"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        ").concat(p,"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          ").concat(o,")) * float(").concat(r,"));\n        int currentSeg = int(mod(float(outIdx), float(").concat(o,")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ").concat(u,"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          ").concat(l,"\n        }\n\n        int inIdx = inOffset + ").concat(u,";\n        if (").concat(1===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          ").concat(l,"\n        } else if (").concat(2===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          ").concat(l,"\n        } else if (").concat(3===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          ").concat(l,"\n        }\n        setOutput(").concat("sumValue",");\n      }\n    ")};for(var dj=0,pj=[vk,bk,yk,kk,Ik,jk,Tk,Ck,Rk,Dk,Mk,Lk,Bk,Uk,Gk,Kk,Xk,Jk,Qk,$k,nw,uw,cw,lw,mw,gw,kw,Bx,Iw,Aw,Bw,Hw,qw,Kw,Xw,Zw,Qw,eO,nO,sO,uO,cO,dO,hO,bO,gO,xO,wO,OO,SO,NO,TO,EO,AO,DO,zO,BO,GO,qO,YO,JO,eI,nI,rI,iI,uI,lI,pI,Lx,fI,Cw,mI,bI,yI,Vx,kI,OI,II,NI,TI,EI,AI,DI,zI,PI,WI,VI,GI,HI,XI,YI,ZI,JI,QI,eS,rS,iS,hS,nk,mS,bS,yS,kS,pw,OS,NS,jS,_S,RS,qx,DS,FS,MS,LS,hw,uS,BS,US,GS,ak,KS,YS,QS,eN,rN,iN,sN,cN,dN,fN,mN,bN,yN,kN,ON,SN,sw,fS,jN,TN,CN,EN,_N,AN,RN,DN,zN,PN,WN,UN,GN,HN,qN,KN,dS,pk,YN,JN,ej,ij,sj,hk,uj,cj,{kernelName:a.od,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.x,o=t.segmentIds,s=r.numSegments,u=i.shape.length,c=[],l=0,d=a.zd.getAxesPermutation([l],u),p=i;null!=d&&(p=fk({inputs:{x:i},backend:n,attrs:{perm:d}}),c.push(p),l=a.zd.getInnerMostAxes(1,u)[0]);var f=a.zd.segment_util.computeOutShape(p.shape,l,s),h=a.Df.sizeFromShape([p.shape[l]]),m=rk({inputs:{x:p},backend:n,attrs:{shape:[-1,h]}});c.push(m);var v=rk({inputs:{x:function e(t,r,i,o,s){var u=t.shape[0],l=t.shape[1],d=a.zd.segment_util.segOpComputeOptimalWindowSize(l,s),p=new lj({windowSize:d,inSize:l,batchSize:u,numSegments:s},r),f=n.compileAndRun(p,[t,i],o);if(c.push(f),f.shape[1]===s)return f;var h=zS({backend:n,attrs:{start:0,stop:s,step:1,dtype:"float32"}}),m=$N({inputs:{x:h},backend:n,attrs:{reps:[l/d]}});return c.push(h),c.push(m),e(f,r,m,o,s)}(m,"unsortedSegmentSum",o,Object(a.qf)(i.dtype),s)},backend:n,attrs:{shape:f}}),b=v;if(null!=d){c.push(v);var g=a.zd.getUndoAxesPermutation(d);b=fk({inputs:{x:b},backend:n,attrs:{perm:g}})}return c.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),b}},SS];dj<pj.length;dj++){var fj=pj[dj];Object(a.Se)(fj)}a.Gf},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(7),i=n(6),o=n(9);var s=Object(o.b)({mean_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=Object(i.a)(e,"x","mean"),s={x:o},u={axis:t,keepDims:n};return r.a.runKernel(a.Rb,s,u)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(7),i=n(6),o=n(9);var s=Object(o.b)({real_:function(e){var t={input:Object(i.a)(e,"input","real")};return r.a.runKernel(a.nc,t)}})},function(e,t,n){"use strict";var r,a,i,o,s;n.d(t,"b",(function(){return c})),n.d(t,"a",(function(){return l})),function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"}(r||(r={})),function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(a||(a={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(i||(i={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(o||(o={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(s||(s={}));var u={float32:o,int32:a,bool:i,complex64:s};function c(e,t){if("string"===e||"string"===t){if("string"===e&&"string"===t)return"string";throw new Error("Can not upcast ".concat(e," with ").concat(t))}return u[e][t]}function l(e){return c(e,"int32")}},function(e,t,n){"use strict";n.d(t,"a",(function(){return d})),n.d(t,"d",(function(){return k})),n.d(t,"b",(function(){return y})),n.d(t,"e",(function(){return b})),n.d(t,"c",(function(){return m}));var r=n(14),a=n(1),i=n.n(a),o=n(8),s=n(2),u=n(4),c=n(18),l=n(51),d=function(){function e(){Object(s.a)(this,e),this.managers={}}return Object(u.a)(e,null,[{key:"getInstance",value:function(){return null==e.instance&&(e.instance=new e),e.instance}},{key:"registerManager",value:function(t,n){Object(c.b)(null!=t,(function(){return"scheme must not be undefined or null."})),t.endsWith("://")&&(t=t.slice(0,t.indexOf("://"))),Object(c.b)(t.length>0,(function(){return"scheme must not be an empty string."}));var r=e.getInstance();Object(c.b)(null==r.managers[t],(function(){return"A model store manager is already registered for scheme '".concat(t,"'.")})),r.managers[t]=n}},{key:"getManager",value:function(t){var n=e.getInstance().managers[t];if(null==n)throw new Error("Cannot find model manager for scheme '".concat(t,"'"));return n}},{key:"getSchemes",value:function(){return Object.keys(e.getInstance().managers)}}]),e}();function p(e){if(-1===e.indexOf("://"))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+"".concat(d.getSchemes().join(",")));return{scheme:e.split("://")[0],path:e.split("://")[1]}}function f(e,t){return h.apply(this,arguments)}function h(){return(h=Object(o.a)(i.a.mark((function e(t,n){var r,a,o,s,u,f,h,m,v,b,g=arguments;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=g.length>2&&void 0!==g[2]&&g[2],Object(c.b)(t!==n,(function(){return"Old path and new path are the same: '".concat(t,"'")})),a=l.a.getLoadHandlers(t),Object(c.b)(a.length>0,(function(){return"Copying failed because no load handler is found for source URL ".concat(t,".")})),Object(c.b)(a.length<2,(function(){return"Copying failed because more than one (".concat(a.length,") ")+"load handlers for source URL ".concat(t,".")})),o=a[0],s=l.a.getSaveHandlers(n),Object(c.b)(s.length>0,(function(){return"Copying failed because no save handler is found for destination "+"URL ".concat(n,".")})),Object(c.b)(s.length<2,(function(){return"Copying failed because more than one (".concat(a.length,") ")+"save handlers for destination URL ".concat(n,".")})),u=s[0],f=p(t).scheme,h=p(t).path,m=f===p(t).scheme,e.next=15,o.load();case 15:if(v=e.sent,!r||!m){e.next=19;break}return e.next=19,d.getManager(f).removeModel(h);case 19:return e.next=21,u.save(v);case 21:if(b=e.sent,!r||m){e.next=25;break}return e.next=25,d.getManager(f).removeModel(h);case 25:return e.abrupt("return",b.modelArtifactsInfo);case 26:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(){return v.apply(this,arguments)}function v(){return(v=Object(o.a)(i.a.mark((function e(){var t,n,a,o,s,u,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=d.getSchemes(),n={},a=Object(r.a)(t),e.prev=3,a.s();case 5:if((o=a.n()).done){e.next=13;break}return s=o.value,e.next=9,d.getManager(s).listModels();case 9:for(c in u=e.sent)n[s+"://"+c]=u[c];case 11:e.next=5;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(3),a.e(e.t0);case 18:return e.prev=18,a.f(),e.finish(18);case 21:return e.abrupt("return",n);case 22:case"end":return e.stop()}}),e,null,[[3,15,18,21]])})))).apply(this,arguments)}function b(e){return g.apply(this,arguments)}function g(){return(g=Object(o.a)(i.a.mark((function e(t){var n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=p(t),r=d.getManager(n.scheme),e.abrupt("return",r.removeModel(n.path));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e,t){return x.apply(this,arguments)}function x(){return(x=Object(o.a)(i.a.mark((function e(t,n){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return!1,e.abrupt("return",f(t,n,!1));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e,t){return w.apply(this,arguments)}function w(){return(w=Object(o.a)(i.a.mark((function e(t,n){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return!0,e.abrupt("return",f(t,n,!0));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(12),a=n(7),i=n(6),o=n(18),s=n(9);var u=Object(s.b)({batchToSpaceND_:function(e,t,n){var s=Object(i.a)(e,"x","batchToSpaceND"),u=t.reduce((function(e,t){return e*t}));o.b(s.rank>=1+t.length,(function(){return"input rank is ".concat(s.rank," but should be > than blockShape.length ").concat(t.length)})),o.b(n.length===t.length,(function(){return"crops.length is ".concat(n.length," but should be equal to blockShape.length  ").concat(t.length)})),o.b(s.shape[0]%u===0,(function(){return"input tensor batch is ".concat(s.shape[0]," but is not divisible by the product of ")+"the elements of blockShape ".concat(t.join(" * ")," === ").concat(u)}));var c={x:s},l={blockShape:t,crops:n};return r.a.runKernel(a.t,c,l)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var r=n(12),a=n(7),i=n(6),o=n(18),s=n(33),u=n(9),c=n(16);var l=Object(u.b)({depthwiseConv2d_:function(e,t,n,u){var l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],p=arguments.length>6?arguments[6]:void 0,f=Object(i.a)(e,"x","depthwiseConv2d","float32"),h=Object(i.a)(t,"filter","depthwiseConv2d","float32"),m=f,v=!1;3===f.rank&&(v=!0,m=Object(c.a)(f,[1,f.shape[0],f.shape[1],f.shape[2]])),o.b(4===m.rank,(function(){return"Error in depthwiseConv2d: input must be rank 4, but got "+"rank ".concat(m.rank,".")})),o.b(4===h.rank,(function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+"".concat(h.rank,".")}));var b="NHWC"===l?m.shape[3]:m.shape[1];o.b(b===h.shape[2],(function(){return"Error in depthwiseConv2d: number of input channels "+"(".concat(b,") must match the inChannels dimension in ")+"filter ".concat(h.shape[2],".")})),s.a("depthwiseConv2d",u,p);var g={x:m,filter:h},y={strides:n,pad:u,dataFormat:l,dilations:d,dimRoundingMode:p},x=r.a.runKernel(a.Q,g,y);return v?Object(c.a)(x,[x.shape[1],x.shape[2],x.shape[3]]):x}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var r=n(3),a=n(12),i=n(7),o=n(32),s=n(6),u=n(26),c=n(9);var l=Object(c.b)({equal_:function(e,t){var n=Object(s.a)(e,"a","equal","string_or_numeric"),c=Object(s.a)(t,"b","equal","string_or_numeric"),l=Object(o.makeTypesMatch)(n,c),d=Object(r.a)(l,2);n=d[0],c=d[1],Object(u.assertAndGetBroadcastShape)(n.shape,c.shape);var p={a:n,b:c};return a.a.runKernel(i.ab,p)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return b}));var r=n(6),a=n(18),i=n(53),o=n(49),s=n(81),u=n(114),c=n(9),l=n(64),d=n(16),p=n(28),f=n(47),h=n(34),m=n(27);function v(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(0===e.rank)return Object(i.a)(e);if(1!==e.rank&&null===n)return v(Object(d.a)(e,[-1]),t,n);if(1===e.rank||"number"===typeof n||Array.isArray(n)&&1===n.length){if(1===t)return Object(m.a)(Object(i.a)(e),n);if(t===1/0)return Object(s.a)(Object(i.a)(e),n);if(t===-1/0)return Object(u.a)(Object(i.a)(e),n);if("euclidean"===t||2===t)return Object(f.a)(Object(m.a)(Object(l.a)(Object(i.a)(e),Object(p.a)(2,"int32")),n));throw new Error("Error in norm: invalid ord value: ".concat(t))}if(Array.isArray(n)&&2===n.length){if(1===t)return Object(s.a)(Object(m.a)(Object(i.a)(e),n[0]),n[1]-1);if(t===1/0)return Object(s.a)(Object(m.a)(Object(i.a)(e),n[1]),n[0]);if(t===-1/0)return Object(u.a)(Object(m.a)(Object(i.a)(e),n[1]),n[0]);if("fro"===t||"euclidean"===t)return Object(f.a)(Object(m.a)(Object(h.a)(e),n));throw new Error("Error in norm: invalid ord value: ".concat(t))}throw new Error("Error in norm: invalid axis: ".concat(n))}var b=Object(c.b)({norm_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"euclidean",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=v(e=Object(r.a)(e,"x","norm"),t,n),u=s.shape;if(i){var c=Object(a.I)(n,e.shape);u=o.e(s.shape,c)}return Object(d.a)(s,u)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(7),i=n(6),o=n(9);var s=Object(o.b)({gather_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=Object(i.a)(e,"x","gather"),u=Object(i.a)(t,"indices","gather","int32"),c={x:s,indices:u},l={axis:n,batchDims:o};return r.a.runKernel(a.pb,c,l)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(7),i=n(6),o=n(9);var s=Object(o.b)({imag_:function(e){var t={input:Object(i.a)(e,"input","imag")};return r.a.runKernel(a.ub,t)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(7),i=n(6),o=n(9);var s=Object(o.b)({logicalNot_:function(e){var t={x:Object(i.a)(e,"x","logicalNot","bool")};return r.a.runKernel(a.Ib,t)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var r=n(3),a=n(12),i=n(7),o=n(32),s=n(6),u=n(26),c=n(22),l=n(9);var d=Object(l.b)({maximum_:function(e,t){var n=Object(s.a)(e,"a","maximum"),l=Object(s.a)(t,"b","maximum"),d=Object(o.makeTypesMatch)(n,l),p=Object(r.a)(d,2);n=p[0],l=p[1],"bool"===n.dtype&&(n=Object(c.a)(n,"int32"),l=Object(c.a)(l,"int32")),Object(u.assertAndGetBroadcastShape)(n.shape,l.shape);var f={a:n,b:l};return a.a.runKernel(i.Qb,f)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(12),a=n(7),i=n(6),o=n(18),s=n(9);var u=Object(s.b)({spaceToBatchND_:function(e,t,n){var s=Object(i.a)(e,"x","spaceToBatchND");o.b(s.rank>=1+t.length,(function(){return"input rank ".concat(s.rank," should be > than [blockShape] ").concat(t.length)})),o.b(n.length===t.length,(function(){return"paddings.shape[0] ".concat(n.length," must be equal to [blockShape] ").concat(t.length)})),o.b(s.shape.reduce((function(e,r,a){return a>0&&a<=t.length?e&&(r+n[a-1][0]+n[a-1][1])%t[a-1]===0:e}),!0),(function(){return"input spatial dimensions ".concat(s.shape.slice(1)," with paddings ").concat(n.toString()," must be divisible by blockShapes ").concat(t.toString())}));var u={x:s},c={blockShape:t,paddings:n};return r.a.runKernel(a.Mc,u,c)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(6),a=n(18),i=n(9),o=n(16);var s=Object(i.b)({squeeze_:function(e,t){var n=Object(r.a)(e,"x","squeeze","string_or_numeric");return Object(o.a)(n,Object(a.Q)(n.shape,t).newShape)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(150);function a(e,t){if(e){if("string"===typeof e)return Object(r.a)(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Object(r.a)(e,t):void 0}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(12),a=n(7),i=n(6),o=n(79),s=n(9),u=n(16);var c=Object(s.b)({broadcastTo_:function(e,t){var n=Object(i.a)(e,"broadcastTo","x"),s=n.shape;if(t.some((function(e){return!(e>0)||e%1!==0})))throw new Error("broadcastTo(): Invalid broadcast shape [".concat(t,"]."));if(t.length<n.rank)throw new Error("broadcastTo(): shape.length=".concat(t.length," < input.rank=").concat(n.rank,"."));if(t.length>n.rank){for(var c=n.shape.slice();c.length<t.length;)c.unshift(1);n=Object(u.a)(n,c)}for(var l=n.shape,d=Array.from(t),p=t.length-1;p>=0;p--)if(l[p]===t[p])d[p]=1;else if(1!==n.shape[p])throw new Error("broadcastTo(): [".concat(s,"] cannot be broadcast to [").concat(t,"]."));if(0===d.map((function(e,t){return e>1?t:-1})).filter((function(e){return e>=0})).length)return Object(o.a)(n);var f={x:n},h={reps:d};return r.a.runKernel(a.fd,f,h)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r={};function a(e){return r[e]}},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(7),i=n(6),o=n(9);var s=Object(o.b)({cumprod_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=Object(i.a)(e,"x","cumprod"),u={x:s},c={axis:t,exclusive:n,reverse:o};return r.a.runKernel(a.M,u,c)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(7),i=n(6),o=n(9);var s=Object(o.b)({min_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=Object(i.a)(e,"x","min"),s={x:o},u={axis:t,keepDims:n};return r.a.runKernel(a.Sb,s,u)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(7),i=n(18),o=n(9);var s=Object(o.b)({ifft_:function(e){Object(i.b)("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.ifft() must be complex64 "+"but got ".concat(e.dtype,".")}));var t={input:e};return r.a.runKernel(a.sb,t)}})},function(e,t,n){"use strict";(function(e,r){var a;function i(){if(null==a){var t;if("undefined"!==typeof window)t=window;else if("undefined"!==typeof e)t=e;else if("undefined"!==typeof r)t=r;else{if("undefined"===typeof self)throw new Error("Could not find a global object");t=self}a=t}return a}function o(e,t){var n=function(){var e=i();return null==e._tfGlobals&&(e._tfGlobals=new Map),e._tfGlobals}();if(n.has(e))return n.get(e);var r=t();return n.set(e,r),n.get(e)}n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return o}))}).call(this,n(143),n(144))},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(190),a=n(188),i=n(110),o=n(191);function s(e){return Object(r.a)(e)||Object(a.a)(e)||Object(i.a)(e)||Object(o.a)()}},function(e,t,n){"use strict";n.d(t,"c",(function(){return i})),n.d(t,"b",(function(){return o})),n.d(t,"a",(function(){return s}));var r=n(15),a=n(18);function i(e,t,n){var r=t.rank>1?t.shape[t.rank-1]:1,a=t.rank>1?t.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + "+"shape[sliceDim:], got updates.shape: ".concat(n.shape)+", indices.shape: ".concat(t.shape,", shape: ").concat(e)+", sliceDim: ".concat(r,", and batchDim: ").concat(a,".");if(n.rank<a)throw new Error(i+" update.rank < ".concat(a,". "));if(e.length<r+(n.rank-a))throw new Error(i+" Output shape length < ".concat(r+(n.rank-a)));if(n.rank!==a+e.length-r)throw new Error(i+" update.rank != ".concat(a+e.length-r));for(var o=0;o<a;++o)if(n.shape[o]!==t.shape[o])throw new Error(i+" updates.shape[".concat(o,"] (").concat(n.shape[o],") != indices.shape[").concat(o,"] (").concat(t.shape[o],")."));for(var s=0;s<n.rank-a;++s)if(n.shape[s+a]!==e[s+r])throw new Error(i+" updates.shape[".concat(s+a,"] (").concat(n.shape[s+a],") != shape[").concat(s+a,"] (").concat(e[s+a],")"))}function o(e,t,n){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher,"+" but the rank was ".concat(t.rank,"."));if(e.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher,"+" but the rank was ".concat(e.rank,"."));if("int32"!==t.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: ".concat(t.dtype));if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: ".concat(n));if(0===n.length){if(0===t.size)throw new Error("Indices specified for empty output. indices shape: ".concat(t.shape));if(0===e.size)throw new Error("Updates specified for empty output. updates shape: ".concat(e.shape))}i(n,t,e)}function s(e,t,n){for(var i=t.shape.length,o=i>1?t.shape[i-1]:1,s=n.length,u=1,c=o;c<s;++c)u*=n[c];var l=o<1?1:o;return{sliceRank:o,numUpdates:Object(a.O)(t.shape)/l,sliceSize:u,strides:[].concat(Object(r.a)(Object(a.j)(n.slice(0,o))),[1]),outputSize:Object(a.O)(n)}}},function(e,t,n){"use strict";n.r(t),n.d(t,"assertParamsValid",(function(){return i})),n.d(t,"maskToAxes",(function(){return o})),n.d(t,"computeOutShape",(function(){return s})),n.d(t,"stridesWithElidedDims",(function(){return u})),n.d(t,"getNormalizedAxes",(function(){return d})),n.d(t,"startIndicesWithElidedDims",(function(){return p})),n.d(t,"stopIndicesWithElidedDims",(function(){return f})),n.d(t,"stridesForAxis",(function(){return h})),n.d(t,"startForAxis",(function(){return m})),n.d(t,"stopForAxis",(function(){return v})),n.d(t,"isSliceContinous",(function(){return b})),n.d(t,"computeFlatOffset",(function(){return g})),n.d(t,"parseSliceParams",(function(){return y})),n.d(t,"sliceInfo",(function(){return x}));var r=n(15),a=n(18);function i(e,t,n){var r=e.shape.length;a.b(r===t.length,(function(){return"Error in slice".concat(r,"D: Length of begin ").concat(t," must ")+"match the rank of the array (".concat(r,").")})),a.b(r===n.length,(function(){return"Error in slice".concat(r,"D: Length of size ").concat(n," must ")+"match the rank of the array (".concat(r,").")}));for(var i=function(i){a.b(t[i]+n[i]<=e.shape[i],(function(){return"Error in slice".concat(r,"D: begin[").concat(i,"] + size[").concat(i,"] ")+"(".concat(t[i]+n[i],") would overflow input.shape[").concat(i,"] (").concat(e.shape[i],")")}))},o=0;o<r;++o)i(o)}function o(e){for(var t=[],n=0;e>0;)1&e&&t.push(n),e/=2,n++;return t}function s(e,t,n){for(var r=[],a=0;a<e.length;a++)r[a]=Math.ceil((t[a]-e[a])/n[a]);return r}function u(e,t,n,a){for(var i=Object(r.a)(e),o=i.length;o<a.length;o++)i.push(1);for(var s=0;s<n;s++)0===s?i[t]=1:(i.splice(t,0,1),i.pop());return i}function c(e,t,n){return n<=e?n:n-(t-1)}function l(e,t){for(var n=[],r=0;r<e;r++)n.push(t+r);return n}function d(e,t,n,r,a,i,o,s,c){var l=e.length,d=new Array(l),b=new Array(l),g=new Array(l);if(t.length&&n>0){var y=t[0],x=n+1;d=p(o,y,x,r,e),b=f(s,y,x,a,e),g=u(i,y,x,e)}else for(var k=0;k<l;k++)d[k]=m(o,r,i,e,k,c),b[k]=v(s,a,i,e,k,c),g[k]=h(i,k,c);return{begin:d,end:b,strides:g}}function p(e,t,n,a,i){for(var o=Object(r.a)(i),s=l(n,t),u=0;u<o.length;u++)if(s.indexOf(u)>-1)o[u]=0;else{var d=c(t,n,u),p=a[d];e&1<<d&&(p=0),o[u]=p}return o}function f(e,t,n,i,o){for(var s=Object(r.a)(o),u=l(n,t),d=0;d<s.length;d++)if(u.indexOf(d)>-1)s[d]=Number.MAX_SAFE_INTEGER;else{var p=c(t,n,d),f=i[p];e&1<<p&&(f=Number.MAX_SAFE_INTEGER),s[d]=f}for(var h=0;h<s.length;h++){var m=o[h];s[h]<0&&(s[h]+=m),s[h]=a.i(0,s[h],o[h])}return s}function h(e,t,n){var r=e[t];return(n&1<<t||null==r)&&(r=1),r}function m(e,t,n,r,i,o){var s=t[i],u=n[i]||1;(e&1<<i||o&1<<i||null==s)&&(s=u>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var c=r[i];return s<0&&(s+=c),s=a.i(0,s,c-1)}function v(e,t,n,r,i,o){var s=t[i],u=n[i]||1;(e&1<<i||o&1<<i||null==s)&&(s=u>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var c=r[i];return s<0&&(s+=c),s=u>0?a.i(0,s,c):a.i(-1,s,c-1)}function b(e,t,n){for(var r=n.length,a=0;a<n.length;a++)if(n[a]>1){r=a;break}for(var i=r+1;i<n.length;i++)if(t[i]>0||n[i]!==e[i])return!1;return!0}function g(e,t){for(var n=e.length>0?e[e.length-1]:1,r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}function y(e,t,n){var i,o,s=e.shape.length;return(i="number"===typeof t?[t].concat(Object(r.a)(new Array(s-1).fill(0))):t.length<s?t.concat(new Array(s-t.length).fill(0)):t.slice()).forEach((function(e){a.b(-1!==e,(function(){return"slice() does not support negative begin indexing."}))})),o=(o=null==n?new Array(s).fill(-1):"number"===typeof n?[n].concat(Object(r.a)(new Array(s-1).fill(-1))):n.length<s?n.concat(new Array(s-n.length).fill(-1)):n).map((function(t,n){return t>=0?t:(a.b(-1===t,(function(){return"Negative size values should be exactly -1 but got "+"".concat(t," for the slice() size at index ").concat(n,".")})),e.shape[n]-i[n])})),[i,o]}function x(e,t,n,r,a,i,o,s,u){var c;if(null==r?(c=new Array(t.length)).fill(1):c=r,null!=o&&0!==(o&o-1))throw new Error("Multiple ellipses in slice is not allowed.");for(var l=!1,d={dims:c.length,numAddAxisAfterEllipsis:0,begin:t.slice(),end:n.slice(),strides:c.slice(),beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u},p=0;p<d.dims;p++)l&&0!==(1<<p&s)&&d.numAddAxisAfterEllipsis++,1<<p&o&&(l=!0);l||(d.ellipsisMask|=1<<d.dims,d.dims++);var f={dims:e.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};!function(e,t){t.beginMask=0,t.endMask=0,t.shrinkAxisMask=0;var n=0;t.beginValid=null!=e.begin,t.endValid=null!=e.end,t.begin=new Array(t.dims),t.end=new Array(t.dims),t.strides=new Array(t.dims),t.finalShapeGatherIndices=[],t.finalShapeGatherIndicesSparse=[],t.inputShapeGatherIndicesSparse=new Array(t.dims);for(var r=0;r<e.dims;r++)if(1<<r&e.ellipsisMask)for(var a=Math.min(t.dims-(e.dims-r)+1+e.numAddAxisAfterEllipsis,t.dims);n<a;n++)t.begin[n]=0,t.end[n]=0,t.strides[n]=1,t.beginMask|=1<<n,t.endMask|=1<<n,t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(-1),t.inputShapeGatherIndicesSparse[n]=r;else if(1<<r&e.newAxisMask)t.finalShapeGatherIndices.push(-2),t.finalShapeGatherIndicesSparse.push(-1);else{if(n===t.begin.length)throw Error("Index out of range using input dim ".concat(n,"; input ")+"has only ".concat(t.dims," dims, ").concat(t.begin.length,"."));null!=e.begin&&(t.begin[n]=e.begin[r]),null!=e.end&&(t.end[n]=e.end[r]),t.strides[n]=e.strides[r],e.beginMask&1<<r&&(t.beginMask|=1<<n),e.endMask&1<<r&&(t.endMask|=1<<n),e.shrinkAxisMask&1<<r?(t.finalShapeGatherIndices.push(-1),t.finalShapeGatherIndicesSparse.push(-1),t.shrinkAxisMask|=1<<n):(t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(r)),t.inputShapeGatherIndicesSparse[n]=r,n++}}(d,f);for(var h=!0,m=!0,v=!0,b=[],g=[],y=0;y<e.length;++y){if(0===f.strides[y])throw Error("strides[".concat(y,"] must be non-zero"));var x=!!(f.shrinkAxisMask&1<<y),w=e[y];if(-1!==w){var O=[f.beginMask&1<<y,f.endMask&1<<y],I=[f.strides[y]>0?0:-1,f.strides[y]>0?w:w-1];if(x&&f.strides[y]<=0)throw Error("only stride 1 allowed on non-range indexing.");v=v&&1===f.strides[y];var S=!!(f.beginMask&1<<y&&f.endMask&1<<y);if(f.beginValid&&f.endValid){if(x){var N=f.begin[y]<0?w+f.begin[y]:f.begin[y];if(f.begin[y]=N,f.end[y]=f.begin[y]+1,N<0||N>=w)throw Error("slice index ".concat(f.begin[y]," of dimension ").concat(y," out of bounds."))}else f.begin[y]=k(f.begin[y],0,f.strides[y],w,O,I),f.end[y]=k(f.end[y],1,f.strides[y],w,O,I);var j=1===f.strides[y]&&0===f.begin[y]&&f.end[y]===w;h=h&&j,m=m&&(0===y&&1===f.strides[y]||j)}else h=h&&1===f.strides[y]&&S,m=m&&(0===y&&1===f.strides[y]||S);var T=void 0,C=!1;if(f.beginValid&&f.endValid?(T=f.end[y]-f.begin[y],C=!0):x?(T=1,C=!0):S&&w>=0&&(T=f.strides[y]<0?-w:w,C=!0),C){var E=void 0;E=0===T||T<0!==f.strides[y]<0?0:Math.trunc(T/f.strides[y])+(T%f.strides[y]!==0?1:0),b.push(E)}else b.push(-1)}else b.push(x?1:-1)}for(var _=0;_<f.finalShapeGatherIndices.length;++_){var A=f.finalShapeGatherIndices[_];A>=0?g.push(b[A]):-2===A&&g.push(1)}return{finalShapeSparse:g.filter((function(e,t){return-2!==f.finalShapeGatherIndices[t]})),finalShape:g,isIdentity:h,sliceDim0:m,isSimpleSlice:v,begin:f.begin,end:f.end,strides:f.strides}}function k(e,t,n,r,a,i){if(a[t])return n>0?i[t]:i[t+1&1];var o=e<0?r+e:e;return o<i[0]?i[0]:o>i[1]?i[1]:o}},function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var r=n(12),a=n(7),i=n(6),o=n(18),s=n(22),u=n(33),c=n(9),l=n(16);var d=Object(c.b)({avgPool_:function(e,t,n,c,d){var p=Object(i.a)(e,"x","avgPool","float32");o.b(u.i(n,1),(function(){return"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(1,"'")}));var f=p,h=!1;3===p.rank&&(h=!0,f=Object(l.a)(p,[1,p.shape[0],p.shape[1],p.shape[2]])),o.b(4===f.rank,(function(){return"Error in avgPool: x must be rank 4 but got rank ".concat(f.rank,".")})),u.a("avgPool",c,d);var m={x:f},v={filterSize:t,strides:n,pad:c,dimRoundingMode:d},b=r.a.runKernel(a.o,m,v);return b=Object(s.a)(b,p.dtype),h?Object(l.a)(b,[b.shape[1],b.shape[2],b.shape[3]]):b}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(7),i=n(6),o=n(9);var s=Object(o.b)({cos_:function(e){var t={x:Object(i.a)(e,"x","cos","float32")};return r.a.runKernel(a.J,t)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(7),i=n(6),o=n(9);var s=Object(o.b)({cumsum_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=Object(i.a)(e,"x","cumsum"),u={x:s},c={axis:t,exclusive:n,reverse:o};return r.a.runKernel(a.N,u,c)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(3),a=n(12),i=n(7),o=n(32),s=n(6),u=n(9);var c=Object(u.b)({floorDiv_:function(e,t){var n=Object(s.a)(e,"a","floorDiv"),u=Object(s.a)(t,"b","floorDiv"),c=Object(o.makeTypesMatch)(n,u),l=Object(r.a)(c,2),d={a:n=l[0],b:u=l[1]};return a.a.runKernel(i.jb,d)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(7),i=n(6),o=n(9);var s=Object(o.b)({elu_:function(e){var t={x:Object(i.a)(e,"x","elu","float32")};return r.a.runKernel(a.Y,t)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(7),i=n(6),o=n(9);var s=Object(o.b)({floor_:function(e){var t={x:Object(i.a)(e,"x","floor","float32")};return r.a.runKernel(a.ib,t)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(7),i=n(6),o=n(9);var s=Object(o.b)({leakyRelu_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2,n=Object(i.a)(e,"x","leakyRelu"),o={x:n},s={alpha:t};return r.a.runKernel(a.Ab,o,s)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var r=n(3),a=n(12),i=n(7),o=n(32),s=n(6),u=n(26),c=n(9);var l=Object(c.b)({less_:function(e,t){var n=Object(s.a)(e,"a","less","string_or_numeric"),c=Object(s.a)(t,"b","less","string_or_numeric"),l=Object(o.makeTypesMatch)(n,c),d=Object(r.a)(l,2);n=d[0],c=d[1],Object(u.assertAndGetBroadcastShape)(n.shape,c.shape);var p={a:n,b:c};return a.a.runKernel(i.Bb,p)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return h}));var r=n(6),a=n(18),i=n(23),o=n(49),s=n(50),u=n(84),c=n(81),l=n(9),d=n(16),p=n(24),f=n(27);var h=Object(l.b)({logSumExp_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],l=Object(r.a)(e,"x","logSumExp"),h=Object(a.I)(t,l.shape),m=Object(c.a)(l,h,!0),v=Object(p.a)(l,m),b=Object(s.a)(v),g=Object(f.a)(b,h),y=Object(u.a)(g),x=Object(i.a)(Object(d.a)(m,y.shape),y);if(n){var k=Object(o.e)(x.shape,h);return Object(d.a)(x,k)}return x}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(12),a=n(7),i=n(6),o=n(26),s=n(9);var u=Object(s.b)({logicalOr_:function(e,t){var n=Object(i.a)(e,"a","logicalOr","bool"),s=Object(i.a)(t,"b","logicalOr","bool");Object(o.assertAndGetBroadcastShape)(n.shape,s.shape);var u={a:n,b:s};return r.a.runKernel(a.Jb,u)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var r=n(12),a=n(7),i=n(6),o=n(18),s=n(33),u=n(9),c=n(16);var l=Object(u.b)({maxPool_:function(e,t,n,u,l){var d=Object(i.a)(e,"x","maxPool"),p=d,f=!1;3===d.rank&&(f=!0,p=Object(c.a)(d,[1,d.shape[0],d.shape[1],d.shape[2]])),o.b(4===p.rank,(function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(p.rank,".")})),o.b(s.i(n,1),(function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(1,"'")})),s.a("maxPool",u,l);var h={x:p},m={filterSize:t,strides:n,pad:u,dimRoundingMode:l},v=r.a.runKernel(a.Lb,h,m);return f?Object(c.a)(v,[v.shape[1],v.shape[2],v.shape[3]]):v}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var r=n(3),a=n(12),i=n(7),o=n(32),s=n(6),u=n(26),c=n(22),l=n(9);var d=Object(l.b)({minimum_:function(e,t){var n=Object(s.a)(e,"a","minimum"),l=Object(s.a)(t,"b","minimum"),d=Object(o.makeTypesMatch)(n,l),p=Object(r.a)(d,2);n=p[0],l=p[1],"bool"===n.dtype&&(n=Object(c.a)(n,"int32"),l=Object(c.a)(l,"int32")),Object(u.assertAndGetBroadcastShape)(n.shape,l.shape);var f={a:n,b:l};return a.a.runKernel(i.Tb,f)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var r=n(3),a=n(12),i=n(7),o=n(32),s=n(6),u=n(26),c=n(9);var l=Object(c.b)({notEqual_:function(e,t){var n=Object(s.a)(e,"a","notEqual","string_or_numeric"),c=Object(s.a)(t,"b","notEqual","string_or_numeric"),l=Object(o.makeTypesMatch)(n,c),d=Object(r.a)(l,2);n=d[0],c=d[1],Object(u.assertAndGetBroadcastShape)(n.shape,c.shape);var p={a:n,b:c};return a.a.runKernel(i.cc,p)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(7),i=n(6),o=n(9);var s=Object(o.b)({prelu_:function(e,t){var n={x:Object(i.a)(e,"x","prelu"),alpha:Object(i.a)(t,"alpha","prelu")};return r.a.runKernel(a.ic,n)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(7),i=n(6),o=n(9);var s=Object(o.b)({relu6_:function(e){var t={x:Object(i.a)(e,"x","relu6")};return r.a.runKernel(a.rc,t)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(7),i=n(18),o=n(9);var s=Object(o.b)({fft_:function(e){Object(i.b)("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.fft() must be complex64 "+"but got ".concat(e.dtype,".")}));var t={input:e};return r.a.runKernel(a.fb,t)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return m}));var r=n(18),a=n(63),i=n(43),o=n(105),s=n(9),u=n(97),c=n(16),l=n(37),d=n(71),p=n(89),f=n(29),h=n(135);var m=Object(s.b)({rfft_:function(e,t){Object(r.b)("float32"===e.dtype,(function(){return"The dtype for rfft() must be real value but got ".concat(e.dtype)}));var n,s=e.shape[e.shape.length-1],m=e.size/s;if(null!=t&&t<s){var v=e.shape.map((function(e){return 0})),b=e.shape.map((function(e){return e}));b[e.shape.length-1]=t,n=Object(l.a)(e,v,b),s=t}else if(null!=t&&t>s){var g=e.shape.map((function(e){return e}));g[e.shape.length-1]=t-s,n=Object(i.a)([e,Object(p.a)(g)],e.shape.length-1),s=t}else n=e;var y=Object(f.a)(n),x=Object(c.a)(Object(a.a)(n,y),[m,s]),k=Object(h.a)(x),w=Math.floor(s/2)+1,O=Object(u.a)(k),I=Object(o.a)(k),S=Object(d.a)(O,[w,s-w],O.shape.length-1),N=Object(d.a)(I,[w,s-w],I.shape.length-1),j=n.shape.slice();return j[n.shape.length-1]=w,Object(c.a)(Object(a.a)(S[0],N[0]),j)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var r=n(3),a=n(12),i=n(7),o=n(32),s=n(6),u=n(26),c=n(9);var l=Object(c.b)({squaredDifference_:function(e,t){var n=Object(s.a)(e,"a","squaredDifference"),c=Object(s.a)(t,"b","squaredDifference"),l=Object(o.makeTypesMatch)(n,c),d=Object(r.a)(l,2);n=d[0],c=d[1],Object(u.assertAndGetBroadcastShape)(n.shape,c.shape);var p={a:n,b:c};return a.a.runKernel(i.Vc,p,{})}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(12),a=n(7),i=n(6),o=n(18),s=n(9);var u=Object(s.b)({unsortedSegmentSum_:function(e,t,n){var s=Object(i.a)(e,"x","unsortedSegmentSum"),u=Object(i.a)(t,"segmentIds","unsortedSegmentSum","int32");Object(o.b)(Object(o.v)(n),(function(){return"numSegments must be of dtype int"}));var c={x:s,segmentIds:u},l={numSegments:n};return r.a.runKernel(a.ld,c,l)}})},function(e,t,n){"use strict";function r(e,t){return(r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(12),a=n(7),i=n(18),o=n(33),s=n(9),u=n(16);var c=Object(s.b)({conv2DBackpropInput_:function(e,t,n,s,c){var l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",d=arguments.length>6?arguments[6]:void 0;i.b(e.length===t.rank,(function(){return"Length of inShape "+"(".concat(e.length,") and rank of dy (").concat(t.rank,") must match")}));var p=e,f=t,h=!1;3===t.rank&&(h=!0,f=Object(u.a)(t,[1,t.shape[0],t.shape[1],t.shape[2]]),p=[1,e[0],e[1],e[2]]),i.b(4===p.length,(function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+"".concat(p.length,".")})),i.b(4===f.rank,(function(){return"Error in conv2dDerInput: dy must be rank 4, but got "+"rank ".concat(f.rank)})),i.b(4===n.rank,(function(){return"Error in conv2dDerInput: filter must be rank 4, but got "+"rank ".concat(n.rank)}));var m="NHWC"===l?p[3]:p[1],v="NHWC"===l?f.shape[3]:f.shape[1];i.b(m===n.shape[2],(function(){return"Error in conv2dDerInput: depth of input (".concat(m,") must ")+"match input depth for filter ".concat(n.shape[2],".")})),i.b(v===n.shape[3],(function(){return"Error in conv2dDerInput: depth of output (".concat(v,") must ")+"match output depth for filter ".concat(n.shape[3],".")})),o.a("conv2dDerInput",c,d);var b={dy:f,filter:n},g={strides:s,pad:c,dataFormat:l,dimRoundingMode:d,inputShape:p},y=r.a.runKernel(a.F,b,g);return h?Object(u.a)(y,[y.shape[1],y.shape[2],y.shape[3]]):y}})},function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return i}));n(1),n(8);var r=n(12);n(6),n(18),n(21);function a(){return 32===r.a.backend.floatPrecision()?.001:.1}function i(e,t,n){if(null==n&&(n=a()),!o(e,t,n))throw new Error("Numbers differ: actual === ".concat(e,", expected === ").concat(t));"undefined"!==typeof expect&&expect().nothing()}function o(e,t,n){return!isFinite(e)&&!isFinite(t)||!(isNaN(e)||isNaN(t)||Math.abs(e-t)>n)}},function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(12),a=n(7),i=n(18),o=n(33),s=n(9),u=n(16);var c=Object(s.b)({conv2DBackpropFilter_:function(e,t,n,s,c){var l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",d=arguments.length>6?arguments[6]:void 0,p=e;3===e.rank&&(p=Object(u.a)(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var f=t;3===f.rank&&(f=Object(u.a)(t,[1,t.shape[0],t.shape[1],t.shape[2]])),i.b(4===p.rank,(function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+"".concat(p.shape,".")})),i.b(4===f.rank,(function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+"".concat(f.shape,".")})),i.b(4===n.length,(function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+"".concat(n,".")}));var h="NHWC"===l?p.shape[3]:p.shape[1],m="NHWC"===l?f.shape[3]:f.shape[1];i.b(h===n[2],(function(){return"Error in conv2dDerFilter: depth of input ".concat(h,") must ")+"match input depth in filter (".concat(n[2],".")})),i.b(m===n[3],(function(){return"Error in conv2dDerFilter: depth of dy (".concat(m,") must ")+"match output depth for filter (".concat(n[3],").")})),o.a("conv2dDerFilter",c,d);var v={x:p,dy:f},b={strides:s,pad:c,dataFormat:l,dimRoundingMode:d,filterShape:n};return r.a.runKernel(a.E,v,b)}})},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(r){"object"===typeof window&&(n=window)}e.exports=n},function(e,t){var n,r,a=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===i||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"===typeof setTimeout?setTimeout:i}catch(e){n=i}try{r="function"===typeof clearTimeout?clearTimeout:o}catch(e){r=o}}();var u,c=[],l=!1,d=-1;function p(){l&&u&&(l=!1,u.length?c=u.concat(c):d=-1,c.length&&f())}function f(){if(!l){var e=s(p);l=!0;for(var t=c.length;t;){for(u=c,c=[];++d<t;)u&&u[d].run();d=-1,t=c.length}u=null,l=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===o||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function m(){}a.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new h(e,t)),1!==c.length||l||s(f)},h.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=m,a.addListener=m,a.once=m,a.off=m,a.removeListener=m,a.removeAllListeners=m,a.emit=m,a.prependListener=m,a.prependOnceListener=m,a.listeners=function(e){return[]},a.binding=function(e){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},function(e,t,n){"use strict";(function(e){n(12);var t=n(153),r=n(30),a=Object(r.b)();a.registerFlag("DEBUG",(function(){return!1}),(function(e){e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),a.registerFlag("IS_BROWSER",(function(){return t.isBrowser()})),a.registerFlag("IS_NODE",(function(){return"undefined"!==typeof e&&"undefined"!==typeof e.versions&&"undefined"!==typeof e.versions.node})),a.registerFlag("IS_CHROME",(function(){return"undefined"!==typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)})),a.registerFlag("PROD",(function(){return!1})),a.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(function(){return a.getBool("DEBUG")})),a.registerFlag("DEPRECATION_WARNINGS_ENABLED",(function(){return!0})),a.registerFlag("IS_TEST",(function(){return!1})),a.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",(function(){return!0})),a.registerFlag("WRAP_TO_IMAGEBITMAP",(function(){return!1})),a.registerFlag("ENGINE_COMPILE_ONLY",(function(){return!1})),a.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",(function(){return!1})),a.registerFlag("USE_SETTIMEOUTCUSTOM",(function(){return!1}))}).call(this,n(144))},function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return o}));var r=n(2),a=n(4),i=function(){function e(t,n){Object(r.a)(this,e),this.backend=t,this.dataMover=n,this.data=new WeakMap,this.dataIdsCount=0}return Object(a.a)(e,[{key:"get",value:function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}},{key:"set",value:function(e,t){this.dataIdsCount++,this.data.set(e,t)}},{key:"has",value:function(e){return this.data.has(e)}},{key:"delete",value:function(e){return this.dataIdsCount--,this.data.delete(e)}},{key:"numDataIds",value:function(){return this.dataIdsCount}}]),e}(),o=function(){function e(){Object(r.a)(this,e)}return Object(a.a)(e,[{key:"refCount",value:function(e){return s("refCount")}},{key:"incRef",value:function(e){return s("incRef")}},{key:"timerAvailable",value:function(){return!0}},{key:"time",value:function(e){return s("time")}},{key:"read",value:function(e){return s("read")}},{key:"readSync",value:function(e){return s("readSync")}},{key:"readToGPU",value:function(e,t){return s("readToGPU")}},{key:"numDataIds",value:function(){return s("numDataIds")}},{key:"disposeData",value:function(e,t){return s("disposeData")}},{key:"write",value:function(e,t,n){return s("write")}},{key:"move",value:function(e,t,n,r,a){return s("move")}},{key:"memory",value:function(){return s("memory")}},{key:"floatPrecision",value:function(){return s("floatPrecision")}},{key:"epsilon",value:function(){return 32===this.floatPrecision()?1e-7:1e-4}},{key:"dispose",value:function(){return s("dispose")}}]),e}();function s(e){throw new Error("'".concat(e,"' not yet implemented or not found in the registry. ")+"This kernel may not be supported by the tfjs backend you have chosen")}},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(7),i=n(6),o=n(9);var s=Object(o.b)({tanh_:function(e){var t={x:Object(i.a)(e,"x","tanh","float32")};return r.a.runKernel(a.ed,t)}})},function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return a}));var r=1.7580993408473768,a=1.0507009873554805},function(e,t,n){"use strict";n.d(t,"fc",(function(){return ke})),n.d(t,"gd",(function(){return J.a})),n.d(t,"hd",(function(){return J.b})),n.d(t,"qf",(function(){return we.a})),n.d(t,"Cf",(function(){return we.b})),n.d(t,"rd",(function(){return Oe.b})),n.d(t,"sd",(function(){return Oe.e})),n.d(t,"td",(function(){return Oe.g})),n.d(t,"ud",(function(){return Oe.h})),n.d(t,"vd",(function(){return Oe.i})),n.d(t,"wd",(function(){return Oe.p})),n.d(t,"xd",(function(){return Oe.q})),n.d(t,"Ad",(function(){return Oe.t})),n.d(t,"Bd",(function(){return Oe.u})),n.d(t,"Cd",(function(){return Oe.v})),n.d(t,"Dd",(function(){return Oe.A})),n.d(t,"Gd",(function(){return Oe.B})),n.d(t,"Hd",(function(){return Oe.C})),n.d(t,"Id",(function(){return Oe.E})),n.d(t,"Jd",(function(){return Oe.F})),n.d(t,"Kd",(function(){return Oe.H})),n.d(t,"Ld",(function(){return Oe.I})),n.d(t,"Md",(function(){return Oe.J})),n.d(t,"Nd",(function(){return Oe.K})),n.d(t,"Od",(function(){return Oe.L})),n.d(t,"Pd",(function(){return Oe.M})),n.d(t,"Qd",(function(){return Oe.N})),n.d(t,"Rd",(function(){return Oe.O})),n.d(t,"Sd",(function(){return Oe.P})),n.d(t,"Td",(function(){return Oe.Q})),n.d(t,"Ud",(function(){return Oe.Y})),n.d(t,"Xd",(function(){return Oe.bb})),n.d(t,"Zd",(function(){return Oe.gb})),n.d(t,"ce",(function(){return Oe.ib})),n.d(t,"de",(function(){return Oe.lb})),n.d(t,"ee",(function(){return Oe.mb})),n.d(t,"fe",(function(){return Oe.ob})),n.d(t,"ge",(function(){return Oe.qb})),n.d(t,"he",(function(){return Oe.rb})),n.d(t,"je",(function(){return Oe.ub})),n.d(t,"ke",(function(){return Oe.wb})),n.d(t,"le",(function(){return Oe.xb})),n.d(t,"qe",(function(){return Oe.Gb})),n.d(t,"se",(function(){return Oe.Mb})),n.d(t,"te",(function(){return Oe.Nb})),n.d(t,"ue",(function(){return Oe.Pb})),n.d(t,"ve",(function(){return Oe.Rb})),n.d(t,"we",(function(){return Oe.Xb})),n.d(t,"xe",(function(){return Oe.Yb})),n.d(t,"ye",(function(){return Oe.Zb})),n.d(t,"ze",(function(){return Oe.ac})),n.d(t,"Ae",(function(){return Oe.cc})),n.d(t,"Be",(function(){return Oe.dc})),n.d(t,"De",(function(){return Oe.gc})),n.d(t,"Ee",(function(){return Oe.jc})),n.d(t,"Fe",(function(){return Oe.lc})),n.d(t,"Ge",(function(){return Oe.oc})),n.d(t,"Ie",(function(){return Oe.qc})),n.d(t,"Je",(function(){return Oe.rc})),n.d(t,"Ke",(function(){return Oe.sc})),n.d(t,"Le",(function(){return Oe.tc})),n.d(t,"Me",(function(){return Oe.wc})),n.d(t,"Ne",(function(){return Oe.Cc})),n.d(t,"Oe",(function(){return Oe.Dc})),n.d(t,"Pe",(function(){return Oe.Kc})),n.d(t,"Qe",(function(){return Oe.Mc})),n.d(t,"Te",(function(){return Oe.Qc})),n.d(t,"Ue",(function(){return Oe.Sc})),n.d(t,"Ve",(function(){return Oe.Tc})),n.d(t,"We",(function(){return Oe.bd})),n.d(t,"Xe",(function(){return Oe.ed})),n.d(t,"Ye",(function(){return Oe.fd})),n.d(t,"bf",(function(){return Oe.hd})),n.d(t,"cf",(function(){return Oe.md})),n.d(t,"df",(function(){return Oe.nd})),n.d(t,"ef",(function(){return Oe.od})),n.d(t,"ff",(function(){return Oe.pd})),n.d(t,"gf",(function(){return Oe.qd})),n.d(t,"if",(function(){return Oe.rd})),n.d(t,"jf",(function(){return Oe.sd})),n.d(t,"kf",(function(){return Oe.xd})),n.d(t,"lf",(function(){return Oe.yd})),n.d(t,"mf",(function(){return Oe.Bd})),n.d(t,"nf",(function(){return Oe.Cd})),n.d(t,"of",(function(){return Oe.Gd})),n.d(t,"pf",(function(){return Oe.Hd})),n.d(t,"rf",(function(){return Oe.Jd})),n.d(t,"sf",(function(){return Oe.Kd})),n.d(t,"tf",(function(){return Oe.Ld})),n.d(t,"uf",(function(){return Oe.Md})),n.d(t,"xf",(function(){return Oe.Rd})),n.d(t,"Af",(function(){return Oe.Ud})),n.d(t,"Bf",(function(){return Oe.Xd})),n.d(t,"Ef",(function(){return Oe.Zd})),n.d(t,"Hf",(function(){return Oe.ae})),n.d(t,"If",(function(){return Oe.ce})),n.d(t,"Jf",(function(){return Oe.de})),n.d(t,"zf",(function(){return Oe.Td})),n.d(t,"Yd",(function(){return Oe.eb})),n.d(t,"me",(function(){return Oe.Ab})),n.d(t,"re",(function(){return Oe.Jb})),n.d(t,"ie",(function(){return Oe.tb})),n.d(t,"yf",(function(){return Ve})),n.d(t,"ae",(function(){return ge.c})),n.d(t,"Ce",(function(){return ge.e})),n.d(t,"wf",(function(){return ge.h})),n.d(t,"Wd",(function(){return ge.b})),n.d(t,"oe",(function(){return ge.d})),n.d(t,"af",(function(){return ge.g})),n.d(t,"Re",(function(){return ge.f})),n.d(t,"yd",(function(){return ge.a})),n.d(t,"Se",(function(){return Z.e})),n.d(t,"Ff",(function(){return ye.b})),n.d(t,"be",(function(){return v.b})),n.d(t,"Gf",(function(){return me})),n.d(t,"He",(function(){return Ge.a})),n.d(t,"Fd",(function(){return a})),n.d(t,"ne",(function(){return r})),n.d(t,"Ze",(function(){return i})),n.d(t,"Df",(function(){return he})),n.d(t,"zd",(function(){return s})),n.d(t,"Ed",(function(){return K})),n.d(t,"vf",(function(){return fe})),n.d(t,"hf",(function(){return ce})),n.d(t,"Vd",(function(){return Qt})),n.d(t,"pe",(function(){return u})),n.d(t,"yb",(function(){return tn.b})),n.d(t,"N",(function(){return tn.a})),n.d(t,"a",(function(){return Y.a})),n.d(t,"b",(function(){return Y.b})),n.d(t,"c",(function(){return Y.c})),n.d(t,"d",(function(){return Y.d})),n.d(t,"e",(function(){return Y.e})),n.d(t,"f",(function(){return Y.f})),n.d(t,"g",(function(){return Y.g})),n.d(t,"h",(function(){return Y.h})),n.d(t,"i",(function(){return Y.i})),n.d(t,"j",(function(){return Y.j})),n.d(t,"k",(function(){return Y.k})),n.d(t,"l",(function(){return Y.l})),n.d(t,"n",(function(){return Y.n})),n.d(t,"m",(function(){return Y.m})),n.d(t,"o",(function(){return Y.o})),n.d(t,"r",(function(){return Y.r})),n.d(t,"p",(function(){return Y.p})),n.d(t,"q",(function(){return Y.q})),n.d(t,"s",(function(){return Y.s})),n.d(t,"t",(function(){return Y.t})),n.d(t,"u",(function(){return Y.u})),n.d(t,"v",(function(){return Y.v})),n.d(t,"w",(function(){return Y.x})),n.d(t,"x",(function(){return Y.y})),n.d(t,"y",(function(){return Y.z})),n.d(t,"z",(function(){return Y.A})),n.d(t,"A",(function(){return Y.B})),n.d(t,"B",(function(){return Y.C})),n.d(t,"C",(function(){return Y.D})),n.d(t,"D",(function(){return Y.E})),n.d(t,"E",(function(){return Y.F})),n.d(t,"F",(function(){return Y.G})),n.d(t,"G",(function(){return Y.H})),n.d(t,"H",(function(){return Y.I})),n.d(t,"I",(function(){return Y.J})),n.d(t,"J",(function(){return Y.K})),n.d(t,"L",(function(){return Y.M})),n.d(t,"M",(function(){return Y.N})),n.d(t,"K",(function(){return Y.L})),n.d(t,"O",(function(){return Y.O})),n.d(t,"P",(function(){return Y.P})),n.d(t,"Q",(function(){return Y.Q})),n.d(t,"R",(function(){return Y.R})),n.d(t,"S",(function(){return Y.S})),n.d(t,"T",(function(){return Y.T})),n.d(t,"U",(function(){return Y.U})),n.d(t,"W",(function(){return Y.W})),n.d(t,"V",(function(){return Y.V})),n.d(t,"pc",(function(){return Y.oc})),n.d(t,"X",(function(){return Y.X})),n.d(t,"Y",(function(){return Y.Y})),n.d(t,"Z",(function(){return Y.Z})),n.d(t,"bb",(function(){return Y.bb})),n.d(t,"ab",(function(){return Y.ab})),n.d(t,"cb",(function(){return Y.cb})),n.d(t,"db",(function(){return Y.db})),n.d(t,"eb",(function(){return Y.eb})),n.d(t,"fb",(function(){return Y.fb})),n.d(t,"gb",(function(){return Y.gb})),n.d(t,"hb",(function(){return Y.hb})),n.d(t,"ib",(function(){return Y.ib})),n.d(t,"jb",(function(){return Y.jb})),n.d(t,"lb",(function(){return Y.lb})),n.d(t,"pb",(function(){return Y.pb})),n.d(t,"ob",(function(){return Y.ob})),n.d(t,"qb",(function(){return Y.qb})),n.d(t,"rb",(function(){return Y.rb})),n.d(t,"tb",(function(){return Y.tb})),n.d(t,"sb",(function(){return Y.sb})),n.d(t,"ub",(function(){return Y.ub})),n.d(t,"vb",(function(){return Y.vb})),n.d(t,"wb",(function(){return Y.wb})),n.d(t,"xb",(function(){return Y.xb})),n.d(t,"Bb",(function(){return Y.Ab})),n.d(t,"Cb",(function(){return Y.Bb})),n.d(t,"Db",(function(){return Y.Cb})),n.d(t,"Eb",(function(){return Y.Db})),n.d(t,"Fb",(function(){return Y.Eb})),n.d(t,"Gb",(function(){return Y.Fb})),n.d(t,"Hb",(function(){return Y.Hb})),n.d(t,"Ib",(function(){return Y.Ib})),n.d(t,"Jb",(function(){return Y.Jb})),n.d(t,"zb",(function(){return Y.yb})),n.d(t,"Ab",(function(){return Y.zb})),n.d(t,"Kb",(function(){return Y.Kb})),n.d(t,"Qb",(function(){return Y.Qb})),n.d(t,"Lb",(function(){return Y.Lb})),n.d(t,"Ob",(function(){return Y.Ob})),n.d(t,"Mb",(function(){return Y.Mb})),n.d(t,"Nb",(function(){return Y.Nb})),n.d(t,"Pb",(function(){return Y.Pb})),n.d(t,"Rb",(function(){return Y.Rb})),n.d(t,"Sb",(function(){return Y.Sb})),n.d(t,"Tb",(function(){return Y.Tb})),n.d(t,"Ub",(function(){return Y.Ub})),n.d(t,"Vb",(function(){return Y.Vb})),n.d(t,"Wb",(function(){return Y.Wb})),n.d(t,"Xb",(function(){return Y.Xb})),n.d(t,"Yb",(function(){return Y.Yb})),n.d(t,"cc",(function(){return Y.cc})),n.d(t,"Zb",(function(){return Y.Zb})),n.d(t,"ac",(function(){return Y.ac})),n.d(t,"bc",(function(){return Y.bc})),n.d(t,"ec",(function(){return Y.ec})),n.d(t,"dc",(function(){return Y.dc})),n.d(t,"gc",(function(){return Y.fc})),n.d(t,"hc",(function(){return Y.gc})),n.d(t,"ic",(function(){return Y.hc})),n.d(t,"jc",(function(){return Y.ic})),n.d(t,"kc",(function(){return Y.jc})),n.d(t,"lc",(function(){return Y.kc})),n.d(t,"mc",(function(){return Y.lc})),n.d(t,"nc",(function(){return Y.mc})),n.d(t,"oc",(function(){return Y.nc})),n.d(t,"qc",(function(){return Y.pc})),n.d(t,"rc",(function(){return Y.qc})),n.d(t,"tc",(function(){return Y.sc})),n.d(t,"wc",(function(){return Y.vc})),n.d(t,"xc",(function(){return Y.wc})),n.d(t,"uc",(function(){return Y.tc})),n.d(t,"vc",(function(){return Y.uc})),n.d(t,"sc",(function(){return Y.rc})),n.d(t,"yc",(function(){return Y.xc})),n.d(t,"Ac",(function(){return Y.zc})),n.d(t,"Bc",(function(){return Y.Ac})),n.d(t,"Cc",(function(){return Y.Bc})),n.d(t,"Dc",(function(){return Y.Cc})),n.d(t,"Ec",(function(){return Y.Dc})),n.d(t,"Fc",(function(){return Y.Ec})),n.d(t,"Kc",(function(){return Y.Jc})),n.d(t,"Ic",(function(){return Y.Hc})),n.d(t,"Jc",(function(){return Y.Ic})),n.d(t,"Hc",(function(){return Y.Gc})),n.d(t,"Gc",(function(){return Y.Fc})),n.d(t,"Mc",(function(){return Y.Lc})),n.d(t,"Uc",(function(){return Y.Tc})),n.d(t,"dd",(function(){return Y.cd})),n.d(t,"Nc",(function(){return Y.Mc})),n.d(t,"Tc",(function(){return Y.Sc})),n.d(t,"Lc",(function(){return Y.Kc})),n.d(t,"Oc",(function(){return Y.Nc})),n.d(t,"Pc",(function(){return Y.Oc})),n.d(t,"Qc",(function(){return Y.Pc})),n.d(t,"Rc",(function(){return Y.Qc})),n.d(t,"Sc",(function(){return Y.Rc})),n.d(t,"Wc",(function(){return Y.Vc})),n.d(t,"Vc",(function(){return Y.Uc})),n.d(t,"Yc",(function(){return Y.Xc})),n.d(t,"Zc",(function(){return Y.Yc})),n.d(t,"ad",(function(){return Y.Zc})),n.d(t,"bd",(function(){return Y.ad})),n.d(t,"cd",(function(){return Y.bd})),n.d(t,"ed",(function(){return Y.dd})),n.d(t,"fd",(function(){return Y.ed})),n.d(t,"id",(function(){return Y.fd})),n.d(t,"jd",(function(){return Y.gd})),n.d(t,"kd",(function(){return Y.hd})),n.d(t,"ld",(function(){return Y.id})),n.d(t,"md",(function(){return Y.jd})),n.d(t,"nd",(function(){return Y.kd})),n.d(t,"od",(function(){return Y.ld})),n.d(t,"pd",(function(){return Y.md})),n.d(t,"Xc",(function(){return Y.Wc})),n.d(t,"kb",(function(){return Y.kb})),n.d(t,"zc",(function(){return Y.yc})),n.d(t,"qd",(function(){return Y.nd})),n.d(t,"mb",(function(){return Y.mb})),n.d(t,"nb",(function(){return Y.nb}));var r={};n.r(r),n.d(r,"copyModel",(function(){return q.b})),n.d(r,"listModels",(function(){return q.c})),n.d(r,"moveModel",(function(){return q.d})),n.d(r,"removeModel",(function(){return q.e})),n.d(r,"browserFiles",(function(){return w})),n.d(r,"browserHTTPRequest",(function(){return z})),n.d(r,"concatenateArrayBuffers",(function(){return b.d})),n.d(r,"decodeWeights",(function(){return b.e})),n.d(r,"encodeWeights",(function(){return b.f})),n.d(r,"fromMemory",(function(){return W})),n.d(r,"fromMemorySync",(function(){return U})),n.d(r,"getLoadHandlers",(function(){return g.b})),n.d(r,"getModelArtifactsForJSON",(function(){return b.g})),n.d(r,"getModelArtifactsForJSONSync",(function(){return b.h})),n.d(r,"getModelArtifactsInfoForJSON",(function(){return b.i})),n.d(r,"getSaveHandlers",(function(){return g.c})),n.d(r,"getWeightSpecs",(function(){return b.k})),n.d(r,"http",(function(){return M})),n.d(r,"isHTTPScheme",(function(){return D})),n.d(r,"loadWeights",(function(){return C})),n.d(r,"registerLoadRouter",(function(){return g.d})),n.d(r,"registerSaveRouter",(function(){return g.e})),n.d(r,"weightsLoaderFactory",(function(){return _})),n.d(r,"withSaveHandler",(function(){return V})),n.d(r,"withSaveHandlerSync",(function(){return G}));var a={};n.r(a),n.d(a,"fromPixelsAsync",(function(){return ae})),n.d(a,"toPixels",(function(){return oe})),n.d(a,"fromPixels",(function(){return ue}));var i={};n.r(i),n.d(i,"Serializable",(function(){return le})),n.d(i,"SerializationMap",(function(){return de})),n.d(i,"registerClass",(function(){return pe}));var o={};n.r(o),n.d(o,"segOpComputeOptimalWindowSize",(function(){return Kt})),n.d(o,"computeOutShape",(function(){return Xt})),n.d(o,"collectGatherOpShapeInfo",(function(){return Yt}));var s={};n.r(s),n.d(s,"axesAreInnerMostDims",(function(){return He.b})),n.d(s,"combineLocations",(function(){return He.c})),n.d(s,"computeOutAndReduceShapes",(function(){return He.d})),n.d(s,"expandShapeToKeepDim",(function(){return He.e})),n.d(s,"assertAxesAreInnerMostDims",(function(){return He.a})),n.d(s,"getAxesPermutation",(function(){return He.f})),n.d(s,"getUndoAxesPermutation",(function(){return He.h})),n.d(s,"getInnerMostAxes",(function(){return He.g})),n.d(s,"getBroadcastDims",(function(){return K.getBroadcastDims})),n.d(s,"getReductionAxes",(function(){return K.getReductionAxes})),n.d(s,"assertAndGetBroadcastShape",(function(){return K.assertAndGetBroadcastShape})),n.d(s,"assertParamsConsistent",(function(){return qe})),n.d(s,"computeOutShape",(function(){return Ke})),n.d(s,"computeDilation2DInfo",(function(){return Ye.e})),n.d(s,"computePool2DInfo",(function(){return Ye.f})),n.d(s,"computePool3DInfo",(function(){return Ye.g})),n.d(s,"computeConv2DInfo",(function(){return Ye.b})),n.d(s,"computeConv3DInfo",(function(){return Ye.c})),n.d(s,"computeDefaultPad",(function(){return Ye.d})),n.d(s,"tupleValuesAreOne",(function(){return Ye.j})),n.d(s,"eitherStridesOrDilationsAreOne",(function(){return Ye.i})),n.d(s,"convertConv2DDataFormat",(function(){return Ye.h})),n.d(s,"checkPadOnDimRoundingMode",(function(){return Ye.a})),n.d(s,"getFusedDyActivation",(function(){return Ze.c})),n.d(s,"getFusedBiasGradient",(function(){return Ze.b})),n.d(s,"applyActivation",(function(){return Ze.a})),n.d(s,"shouldFuse",(function(){return Ze.d})),n.d(s,"RowPartitionType",(function(){return Xe})),n.d(s,"combineRaggedTensorToTensorShapes",(function(){return Je})),n.d(s,"getRowPartitionTypesHelper",(function(){return Qe})),n.d(s,"getRaggedRank",(function(){return $e})),n.d(s,"validateDefaultValueShape",(function(){return et})),n.d(s,"PARALLELIZE_THRESHOLD",(function(){return tt})),n.d(s,"computeOptimalWindowSize",(function(){return nt})),n.d(s,"slice_util",(function(){return ce})),n.d(s,"upcastType",(function(){return we.b})),n.d(s,"getImageCenter",(function(){return rt})),n.d(s,"getReshaped",(function(){return at})),n.d(s,"getPermuted",(function(){return it})),n.d(s,"getReshapedPermuted",(function(){return ot})),n.d(s,"getSliceBeginCoords",(function(){return st})),n.d(s,"getSliceSize",(function(){return ut})),n.d(s,"prepareAndValidate",(function(){return ct})),n.d(s,"validateUpdateShape",(function(){return lt.c})),n.d(s,"validateInput",(function(){return lt.b})),n.d(s,"calculateShapes",(function(){return lt.a})),n.d(s,"SELU_SCALEALPHA",(function(){return dt.b})),n.d(s,"SELU_SCALE",(function(){return dt.a})),n.d(s,"ERF_P",(function(){return pt})),n.d(s,"ERF_A1",(function(){return ft})),n.d(s,"ERF_A2",(function(){return ht})),n.d(s,"ERF_A3",(function(){return mt})),n.d(s,"ERF_A4",(function(){return vt})),n.d(s,"ERF_A5",(function(){return bt})),n.d(s,"warn",(function(){return gt.b})),n.d(s,"log",(function(){return gt.a})),n.d(s,"mergeRealAndImagArrays",(function(){return yt})),n.d(s,"splitRealAndImagArrays",(function(){return xt})),n.d(s,"complexWithEvenIndex",(function(){return kt})),n.d(s,"complexWithOddIndex",(function(){return wt})),n.d(s,"getComplexWithIndex",(function(){return Ot})),n.d(s,"assignToTypedArray",(function(){return It})),n.d(s,"exponents",(function(){return St})),n.d(s,"exponent",(function(){return Nt})),n.d(s,"decodeEinsumEquation",(function(){return Tt})),n.d(s,"getEinsumPermutation",(function(){return Ct})),n.d(s,"checkEinsumDimSizes",(function(){return Et})),n.d(s,"getEinsumComputePath",(function(){return _t})),n.d(s,"isIdentityPermutation",(function(){return At})),n.d(s,"prepareSplitSize",(function(){return Dt})),n.d(s,"getSparseFillEmptyRowsIndicesDenseShapeMismatch",(function(){return Ft})),n.d(s,"getSparseFillEmptyRowsNegativeIndexErrorMessage",(function(){return Mt})),n.d(s,"getSparseFillEmptyRowsOutOfRangeIndexErrorMessage",(function(){return zt})),n.d(s,"getSparseReshapeMultipleNegativeOneOutputDimErrorMessage",(function(){return Lt})),n.d(s,"getSparseReshapeNegativeOutputDimErrorMessage",(function(){return Pt})),n.d(s,"getSparseReshapeEmptyTensorZeroOutputDimErrorMessage",(function(){return Bt})),n.d(s,"getSparseReshapeInputOutputMultipleErrorMessage",(function(){return Wt})),n.d(s,"getSparseReshapeInputOutputMismatchErrorMessage",(function(){return Ut})),n.d(s,"getSparseSegmentReductionNegativeSegmentIdsErrorMessage",(function(){return Vt})),n.d(s,"getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage",(function(){return Gt})),n.d(s,"getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage",(function(){return Ht})),n.d(s,"getSparseSegmentReductionIndicesOutOfRangeErrorMessage",(function(){return qt})),n.d(s,"segment_util",(function(){return o})),n.d(s,"fromUint8ToStringArray",(function(){return Zt})),n.d(s,"fromStringArrayToUint8",(function(){return Jt}));var u={};n.r(u),n.d(u,"nonMaxSuppressionV3Impl",(function(){return $t.a})),n.d(u,"nonMaxSuppressionV4Impl",(function(){return $t.b})),n.d(u,"nonMaxSuppressionV5Impl",(function(){return $t.c})),n.d(u,"whereImpl",(function(){return en.a}));n(192),n(193);var c=n(15),l=n(14),d=n(1),p=n.n(d),f=n(8),h=n(2),m=n(4),v=(n(145),n(30)),b=n(42),g=n(51);function y(e){return new Promise((function(e){return setTimeout(e)})).then(e)}var x=function(){function e(t){if(Object(h.a)(this,e),!Object(v.b)().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(e.URL_SCHEME)&&(t=t.slice(e.URL_SCHEME.length)),null!=t&&0!==t.length||(t="model"),this.modelJsonFileName=t+".json",this.weightDataFileName=t+".weights.bin"}return Object(m.a)(e,[{key:"save",value:function(){var e=Object(f.a)(p.a.mark((function e(t){var n,r,a,i,o,s;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"!==typeof document){e.next=2;break}throw new Error("Browser downloads are not supported in this environment since `document` is not present");case 2:if(n=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"})),!(t.modelTopology instanceof ArrayBuffer)){e.next=7;break}throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 7:return r=[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}],a=Object(b.j)(t,r),i=window.URL.createObjectURL(new Blob([JSON.stringify(a)],{type:"application/json"})),(o=null==this.modelJsonAnchor?document.createElement("a"):this.modelJsonAnchor).download=this.modelJsonFileName,o.href=i,e.next=15,y((function(){return o.dispatchEvent(new MouseEvent("click"))}));case 15:if(null==t.weightData){e.next=21;break}return(s=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,s.href=n,e.next=21,y((function(){return s.dispatchEvent(new MouseEvent("click"))}));case 21:return e.abrupt("return",{modelArtifactsInfo:Object(b.i)(t)});case 22:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();x.URL_SCHEME="downloads://";var k=function(){function e(t){if(Object(h.a)(this,e),null==t||t.length<1)throw new Error("When calling browserFiles, at least 1 file is required, "+"but received ".concat(t));this.jsonFile=t[0],this.weightsFiles=t.slice(1)}return Object(m.a)(e,[{key:"load",value:function(){var e=Object(f.a)(p.a.mark((function e(){var t=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=new FileReader;r.onload=function(r){var a=JSON.parse(r.target.result),i=a.modelTopology;if(null!=i)if(null!=a.weightsManifest)if(0!==t.weightsFiles.length){var o=Object(b.g)(a,(function(e){return t.loadWeights(e)}));e(o)}else e({modelTopology:i});else n(new Error("weightManifest field is missing from file ".concat(t.jsonFile.name)));else n(new Error("modelTopology field is missing from file ".concat(t.jsonFile.name)))},r.onerror=function(e){return n("Failed to read model topology and weights manifest JSON "+"from file '".concat(t.jsonFile.name,"'. BrowserFiles supports loading ")+"Keras-style tf.Model artifacts only.")},r.readAsText(t.jsonFile)})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"loadWeights",value:function(e){var t,n=this,r=[],a=[],i=Object(l.a)(e);try{for(i.s();!(t=i.n()).done;){var o=t.value;r.push.apply(r,Object(c.a)(o.weights)),a.push.apply(a,Object(c.a)(o.paths))}}catch(d){i.e(d)}finally{i.f()}var s=this.checkManifestAndWeightFiles(e),u=a.map((function(e){return n.loadWeightsFile(e,s[e])}));return Promise.all(u).then((function(e){return[r,Object(b.d)(e)]}))}},{key:"loadWeightsFile",value:function(e,t){return new Promise((function(n,r){var a=new FileReader;a.onload=function(e){var t=e.target.result;n(t)},a.onerror=function(t){return r("Failed to weights data from file of path '".concat(e,"'."))},a.readAsArrayBuffer(t)}))}},{key:"checkManifestAndWeightFiles",value:function(e){var t,n=this,r=[],a=this.weightsFiles.map((function(e){return Object(b.c)(e.name)})),i={},o=Object(l.a)(e);try{for(o.s();!(t=o.n()).done;){t.value.paths.forEach((function(e){var t=Object(b.c)(e);if(-1!==r.indexOf(t))throw new Error("Duplicate file basename found in weights manifest: "+"'".concat(t,"'"));if(r.push(t),-1===a.indexOf(t))throw new Error("Weight file with basename '".concat(t,"' is not provided."));i[e]=n.weightsFiles[a.indexOf(t)]}))}}catch(s){o.e(s)}finally{o.f()}if(r.length!==this.weightsFiles.length)throw new Error("Mismatch in the number of files in weights manifest "+"(".concat(r.length,") and the number of weight files provided ")+"(".concat(this.weightsFiles.length,")."));return i}}]),e}();function w(e){return new k(e)}g.a.registerSaveRouter((function(e){return Object(v.b)().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(x.URL_SCHEME)?function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"model";return new x(e)}(e.slice(x.URL_SCHEME.length)):null}));var O=n(3),I=n(18);function S(e,t,n,r){!function(e){Object(I.b)(null!=e&&Array.isArray(e)&&e.length>0,(function(){return"promises must be a none empty array"}))}(e),function(e,t){Object(I.b)(e>=0&&e<=1,(function(){return"Progress fraction must be in range [0, 1], but "+"got startFraction ".concat(e)})),Object(I.b)(t>=0&&t<=1,(function(){return"Progress fraction must be in range [0, 1], but "+"got endFraction ".concat(t)})),Object(I.b)(t>=e,(function(){return"startFraction must be no more than endFraction, but "+"got startFraction ".concat(e," and endFraction ")+"".concat(t)}))}(n=null==n?0:n,r=null==r?1:r);var a=0;return Promise.all(e.map((function(i){return i.then((function(i){var o=n+ ++a/e.length*(r-n);return t(o),i})),i})))}var N=n(151);function j(e,t){return T.apply(this,arguments)}function T(){return(T=Object(f.a)(p.a.mark((function e(t,n){var r,a,i,o,s,u,c,l,d;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n&&(n={}),r=null==n.fetchFunc?Object(v.b)().platform.fetch:n.fetchFunc,a=t.map((function(e){return r(e,n.requestInit,{isBinary:!0})})),i=0,o=.5,null!=n.onProgress){e.next=11;break}return e.next=8,Promise.all(a);case 8:e.t0=e.sent,e.next=14;break;case 11:return e.next=13,S(a,n.onProgress,i,o);case 13:e.t0=e.sent;case 14:if(s=e.t0,u=s.map((function(e){return e.arrayBuffer()})),c=.5,l=1,null!=n.onProgress){e.next=24;break}return e.next=21,Promise.all(u);case 21:e.t1=e.sent,e.next=27;break;case 24:return e.next=26,S(u,n.onProgress,c,l);case 26:e.t1=e.sent;case 27:return d=e.t1,e.abrupt("return",d);case 29:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function C(e){return E.apply(this,arguments)}function E(){return(E=Object(f.a)(p.a.mark((function e(t){var n,r,a,i,o=arguments;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:"",r=o.length>2?o[2]:void 0,a=o.length>3?o[3]:void 0,i=_((function(e){return j(e,{requestInit:a})})),e.abrupt("return",i(t,n,r));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _(e){return function(){var t=Object(f.a)(p.a.mark((function t(n){var r,a,i,o,s,u,c,l,d,f,h,m,v=arguments;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=v.length>1&&void 0!==v[1]?v[1]:"",a=v.length>2?v[2]:void 0,i=n.map((function(){return!1})),o={},s=null!=a?a.map((function(){return!1})):[],u=[],n.forEach((function(e,t){var n=0;e.weights.forEach((function(e){var r="quantization"in e?e.quantization.dtype:e.dtype,c=N.a[r]*I.O(e.shape),l=function(){i[t]=!0,null==o[t]&&(o[t]=[]),o[t].push({manifestEntry:e,groupOffset:n,sizeBytes:c})};null!=a?a.forEach((function(t,n){t===e.name&&(l(),s[n]=!0)})):l(),u.push(e.name),n+=c}))})),s.every((function(e){return e}))){t.next=10;break}throw c=a.filter((function(e,t){return!s[t]})),new Error("Could not find weights in manifest with names: "+"".concat(c.join(", "),". \n")+"Manifest JSON has weights with names: "+"".concat(u.join(", "),"."));case 10:return l=i.reduce((function(e,t,n){return t&&e.push(n),e}),[]),d=[],l.forEach((function(e){n[e].paths.forEach((function(e){var t=r+(r.endsWith("/")?"":"/")+e;d.push(t)}))})),t.next=15,e(d);case 15:return f=t.sent,h={},m=0,l.forEach((function(e){for(var t=n[e].paths.length,r=0,a=0;a<t;a++)r+=f[m+a].byteLength;for(var i=new ArrayBuffer(r),s=new Uint8Array(i),u=0,c=0;c<t;c++){var l=new Uint8Array(f[m+c]);s.set(l,u),u+=l.byteLength}o[e].forEach((function(e){var t=i.slice(e.groupOffset,e.groupOffset+e.sizeBytes),n=Object(b.e)(t,[e.manifestEntry]);for(var r in n)h[r]=n[r]})),m+=t})),t.abrupt("return",h);case 20:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}var A=function(){function e(t,n){if(Object(h.a)(this,e),this.DEFAULT_METHOD="POST",null==n&&(n={}),this.weightPathPrefix=n.weightPathPrefix,this.onProgress=n.onProgress,this.weightUrlConverter=n.weightUrlConverter,null!=n.fetchFunc?(Object(I.b)("function"===typeof n.fetchFunc,(function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"})),this.fetch=n.fetchFunc):this.fetch=Object(v.b)().platform.fetch,Object(I.b)(null!=t&&t.length>0,(function(){return"URL path for http must not be null, undefined or empty."})),Array.isArray(t)&&Object(I.b)(2===t.length,(function(){return"URL paths for http must have a length of 2, "+"(actual length is ".concat(t.length,").")})),this.path=t,null!=n.requestInit&&null!=n.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=n.requestInit||{}}return Object(m.a)(e,[{key:"save",value:function(){var e=Object(f.a)(p.a.mark((function e(t){var n,r,a,i;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=2;break}throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");case 2:return(n=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,r=[{paths:["./model.weights.bin"],weights:t.weightSpecs}],a=Object(b.j)(t,r),n.body.append("model.json",new Blob([JSON.stringify(a)],{type:"application/json"}),"model.json"),null!=t.weightData&&n.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin"),e.next=10,this.fetch(this.path,n);case 10:if(!(i=e.sent).ok){e.next=15;break}return e.abrupt("return",{modelArtifactsInfo:Object(b.i)(t),responses:[i]});case 15:throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+"".concat(i.status,"."));case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=Object(f.a)(p.a.mark((function e(){var t,n,r,a,i,o=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetch(this.path,this.requestInit);case 2:if((t=e.sent).ok){e.next=5;break}throw new Error("Request to ".concat(this.path," failed with status code ")+"".concat(t.status,". Please verify this URL points to ")+"the model JSON of the model to load.");case 5:return e.prev=5,e.next=8,t.json();case 8:n=e.sent,e.next=16;break;case 11:throw e.prev=11,e.t0=e.catch(5),r="Failed to parse model JSON of response from ".concat(this.path,"."),this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 16:if(a=n.modelTopology,i=n.weightsManifest,null!=a||null!=i){e.next=20;break}throw new Error("The JSON from HTTP path ".concat(this.path," contains neither model ")+"topology or manifest for weights.");case 20:return e.abrupt("return",Object(b.g)(n,(function(e){return o.loadWeights(e)})));case 21:case"end":return e.stop()}}),e,this,[[5,11]])})));return function(){return e.apply(this,arguments)}}()},{key:"loadWeights",value:function(){var e=Object(f.a)(p.a.mark((function e(t){var n,r,a,i,o,s,u,d,f,h,m,v,g,y,x,k;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Array.isArray(this.path)?this.path[1]:this.path,r=R(n),a=Object(O.a)(r,2),i=a[0],o=a[1],s=this.weightPathPrefix||i,u=Object(b.k)(t),d=[],f=[],h=Object(l.a)(t);try{for(h.s();!(m=h.n()).done;){v=m.value,g=Object(l.a)(v.paths);try{for(g.s();!(y=g.n()).done;)x=y.value,null!=this.weightUrlConverter?f.push(this.weightUrlConverter(x)):d.push(s+x+o)}catch(p){g.e(p)}finally{g.f()}}}catch(p){h.e(p)}finally{h.f()}if(!this.weightUrlConverter){e.next=17;break}return e.t0=d.push,e.t1=d,e.t2=c.a,e.next=14,Promise.all(f);case 14:e.t3=e.sent,e.t4=(0,e.t2)(e.t3),e.t0.apply.call(e.t0,e.t1,e.t4);case 17:return e.next=19,j(d,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress});case 19:return k=e.sent,e.abrupt("return",[u,Object(b.d)(k)]);case 21:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();function R(e){var t=e.lastIndexOf("/"),n=e.lastIndexOf("?");return[e.substring(0,t)+"/",n>t?e.substring(n):""]}function D(e){return null!=e.match(A.URL_SCHEME_REGEX)}A.URL_SCHEME_REGEX=/^https?:\/\//;var F=function(e,t){if("undefined"===typeof fetch&&(null==t||null==t.fetchFunc))return null;return(Array.isArray(e)?e.every((function(e){return D(e)})):D(e))?M(e,t):null};function M(e,t){return new A(e,t)}function z(e,t){return M(e,t)}g.a.registerSaveRouter(F),g.a.registerLoadRouter(F);var L=function(){function e(t){Object(h.a)(this,e),this.modelArtifacts=t}return Object(m.a)(e,[{key:"load",value:function(){return this.modelArtifacts}}]),e}(),P=function(){function e(t){Object(h.a)(this,e),this.saveHandler=t}return Object(m.a)(e,[{key:"save",value:function(e){return this.saveHandler(e)}}]),e}(),B=function e(t){Object(h.a)(this,e),t.load&&(this.load=function(){return Promise.resolve(t.load())}),t.save&&(this.save=function(e){return Promise.resolve(t.save(e))})};function W(e,t,n,r){var a=arguments;return new B(U.apply(void 0,Object(c.a)(a)))}function U(e,t,n,r){if(1===arguments.length){var a=null!=e.modelTopology||null!=e.weightSpecs;return a?new L(e):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new L({modelTopology:e}))}return console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new L({modelTopology:e,weightSpecs:t,weightData:n,trainingConfig:r})}function V(e){return new P(e)}function G(e){return new P(e)}var H,q=n(99),K=n(26),X=n(12),Y=n(7),Z=n(73),J=n(13),Q=n(6),$=n(22),ee=n(9),te=n(184);function ne(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;if(t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==e)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n=!1,r=!1,a=!1,i=!1,o=!1,s=!1;if(e.data instanceof Uint8Array)n=!0;else if("undefined"!==typeof ImageData&&e instanceof ImageData)r=!0;else if("undefined"!==typeof HTMLVideoElement&&e instanceof HTMLVideoElement)a=!0;else if("undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement)i=!0;else if(null!=e.getContext)o=!0;else{if(!("undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap))throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, "+"but was ".concat(e.constructor.name));s=!0}var u=Object(Z.b)(Y.kb,X.a.backendName);if(null!=u){var c={pixels:e},l={numChannels:t};return X.a.runKernel(Y.kb,c,l)}var d,p,f=a?[e.videoWidth,e.videoHeight]:[e.width,e.height],h=Object(O.a)(f,2),m=h[0],v=h[1];if(o)d=e.getContext("2d").getImageData(0,0,m,v).data;else if(r||n)d=e.data;else if(i||a||s){if(null==H)if("undefined"===typeof document){if("undefined"===typeof OffscreenCanvas||"undefined"===typeof OffscreenCanvasRenderingContext2D)throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");H=new OffscreenCanvas(1,1).getContext("2d")}else H=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});H.canvas.width=m,H.canvas.height=v,H.drawImage(e,0,0,m,v),d=H.getImageData(0,0,m,v).data}if(4===t)p=new Int32Array(d);else{var b=m*v;p=new Int32Array(b*t);for(var g=0;g<b;g++)for(var y=0;y<t;++y)p[g*t+y]=d[4*g+y]}var x=[v,m,t];return Object(te.a)(p,x,"int32")}function re(e){return"undefined"!==typeof window&&"undefined"!==typeof ImageBitmap&&window.hasOwnProperty("createImageBitmap")&&!(e instanceof ImageBitmap)&&function(e){return null!=e&&0!==e.width&&0!==e.height}(e)&&!function(e){return null!=e&&e.data instanceof Uint8Array}(e)}function ae(e){return ie.apply(this,arguments)}function ie(){return(ie=Object(f.a)(p.a.mark((function e(t){var n,r,a,i=arguments;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=i.length>1&&void 0!==i[1]?i[1]:3,r=null,!Object(v.b)().getBool("WRAP_TO_IMAGEBITMAP")||!re(t)){e.next=15;break}return e.prev=3,e.next=6,createImageBitmap(t,{premultiplyAlpha:"none"});case 6:a=e.sent,e.next=12;break;case 9:e.prev=9,e.t0=e.catch(3),a=null;case 12:r=null!=a&&a.width===t.width&&a.height===t.height?a:t,e.next=16;break;case 15:r=t;case 16:return e.abrupt("return",ne(r,n));case 17:case"end":return e.stop()}}),e,null,[[3,9]])})))).apply(this,arguments)}function oe(e,t){return se.apply(this,arguments)}function se(){return(se=Object(f.a)(p.a.mark((function e(t,n){var r,a,i,o,s,u,c,l,d,f,h,m,v,b,g,y,x;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=Object(Q.a)(t,"img","toPixels"),t instanceof J.a||(a=r,r=Object($.a)(a,"int32"),a.dispose()),2===r.rank||3===r.rank){e.next=4;break}throw new Error("toPixels only supports rank 2 or 3 tensors, got rank ".concat(r.rank,"."));case 4:if(i=r.shape.slice(0,2),o=Object(O.a)(i,2),s=o[0],u=o[1],!((c=2===r.rank?1:r.shape[2])>4||2===c)){e.next=8;break}throw new Error("toPixels only supports depth of size "+"1, 3 or 4 but got ".concat(c));case 8:if("float32"===r.dtype||"int32"===r.dtype){e.next=10;break}throw new Error("Unsupported type for toPixels: ".concat(r.dtype,".")+" Please use float32 or int32 tensors.");case 10:return e.next=12,r.data();case 12:l=e.sent,d="float32"===r.dtype?255:1,f=new Uint8ClampedArray(u*s*4),h=0;case 16:if(!(h<s*u)){e.next=41;break}m=[0,0,0,255],v=0;case 19:if(!(v<c)){e.next=33;break}if(b=l[h*c+v],"float32"!==r.dtype){e.next=26;break}if(!(b<0||b>1)){e.next=24;break}throw new Error("Tensor values for a float32 Tensor must be in the "+"range [0 - 1] but encountered ".concat(b,"."));case 24:e.next=29;break;case 26:if("int32"!==r.dtype){e.next=29;break}if(!(b<0||b>255)){e.next=29;break}throw new Error("Tensor values for a int32 Tensor must be in the "+"range [0 - 255] but encountered ".concat(b,"."));case 29:1===c?(m[0]=b*d,m[1]=b*d,m[2]=b*d):m[v]=b*d;case 30:v++,e.next=19;break;case 33:f[(g=4*h)+0]=Math.round(m[0]),f[g+1]=Math.round(m[1]),f[g+2]=Math.round(m[2]),f[g+3]=Math.round(m[3]);case 38:++h,e.next=16;break;case 41:return null!=n&&(n.width=u,n.height=s,y=n.getContext("2d"),x=new ImageData(f,u,s),y.putImageData(x,0,0)),r!==t&&r.dispose(),e.abrupt("return",f);case 44:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ue=Object(ee.b)({fromPixels_:ne}),ce=n(119),le=function(){function e(){Object(h.a)(this,e)}return Object(m.a)(e,[{key:"getClassName",value:function(){return this.constructor.className}}],[{key:"fromConfig",value:function(e,t){return new e(t)}}]),e}(),de=function(){function e(){Object(h.a)(this,e),this.classNameMap={}}return Object(m.a)(e,null,[{key:"getMap",value:function(){return null==e.instance&&(e.instance=new e),e.instance}},{key:"register",value:function(t){e.getMap().classNameMap[t.className]=[t,t.fromConfig]}}]),e}();function pe(e){Object(I.b)(null!=e.className,(function(){return"Class being registered does not have the static className property defined."})),Object(I.b)("string"===typeof e.className,(function(){return"className is required to be a string, but got type "+typeof e.className})),Object(I.b)(e.className.length>0,(function(){return"Class being registered has an empty-string as its className, which is disallowed."})),de.register(e)}var fe=n(32),he=n(21),me="3.21.0",ve=n(10),be=n(11),ge=n(35),ye=n(45),xe=n(28),ke=function(e){Object(ve.a)(n,e);var t=Object(be.a)(n);function n(){return Object(h.a)(this,n),t.apply(this,arguments)}return Object(m.a)(n,[{key:"minimize",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0,r=this.computeGradients(e,n),a=r.value,i=r.grads;if(null!=n){var o=n.map((function(e){return{name:e.name,tensor:i[e.name]}}));this.applyGradients(o)}else this.applyGradients(i);return Object(ge.b)(i),t?a:(a.dispose(),null)}},{key:"incrementIterations",value:function(){this.iterations_=this.iterations+1}},{key:"computeGradients",value:function(e,t){return Object(ye.b)(e,t)}},{key:"dispose",value:function(){null!=this.iterations_&&Object(ge.b)(this.iterations_)}},{key:"saveIterations",value:function(){var e=Object(f.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null==this.iterations_&&(this.iterations_=0),e.abrupt("return",{name:"iter",tensor:Object(xe.a)(this.iterations_,"int32")});case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getWeights",value:function(){var e=Object(f.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("getWeights() is not implemented for this optimizer yet.");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=Object(f.a)(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("setWeights() is not implemented for this optimizer class "+"".concat(this.getClassName()));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"extractIterations",value:function(){var e=Object(f.a)(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t[0].tensor.data();case 2:return this.iterations_=e.sent[0],e.abrupt("return",t.slice(1));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"iterations",get:function(){return null==this.iterations_&&(this.iterations_=0),this.iterations_}}]),n}(le);Object.defineProperty(ke,Symbol.hasInstance,{value:function(e){return null!=e.minimize&&null!=e.computeGradients&&null!=e.applyGradients}});var we=n(98),Oe=n(31),Ie=n(23),Se=n(25),Ne=n(17),je=n(47),Te=n(34),Ce=n(29),Ee=function(e){Object(ve.a)(n,e);var t=Object(be.a)(n);function n(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return Object(h.a)(this,n),(a=t.call(this)).learningRate=e,a.rho=r,a.epsilon=i,a.accumulatedGrads=[],a.accumulatedUpdates=[],null==i&&(a.epsilon=X.a.backend.epsilon()),a}return Object(m.a)(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=X.a.registeredVariables[n];null==t.accumulatedGrads[r]&&(t.accumulatedGrads[r]={originalName:"".concat(n,"/accum_grad"),variable:Object(ge.h)((function(){return Object(Ce.a)(a).variable(!1)}))}),null==t.accumulatedUpdates[r]&&(t.accumulatedUpdates[r]={originalName:"".concat(n,"/accum_var"),variable:Object(ge.h)((function(){return Object(Ce.a)(a).variable(!1)}))});var i=Array.isArray(e)?e[r].tensor:e[n];if(null!=i){var o=t.accumulatedGrads[r].variable,s=t.accumulatedUpdates[r].variable;Object(ge.h)((function(){var e=Object(Ie.a)(Object(Ne.a)(o,t.rho),Object(Ne.a)(Object(Te.a)(i),1-t.rho)),n=Object(Ne.a)(Object(Se.a)(Object(je.a)(Object(Ie.a)(s,t.epsilon)),Object(je.a)(Object(Ie.a)(o,t.epsilon))),i),r=Object(Ie.a)(Object(Ne.a)(s,t.rho),Object(Ne.a)(Object(Te.a)(n),1-t.rho));o.assign(e),s.assign(r);var u=Object(Ie.a)(Object(Ne.a)(n,-t.learningRate),a);a.assign(u)}))}})),this.incrementIterations()}},{key:"dispose",value:function(){null!=this.accumulatedUpdates&&(Object(ge.b)(this.accumulatedGrads.map((function(e){return e.variable}))),Object(ge.b)(this.accumulatedUpdates.map((function(e){return e.variable}))))}},{key:"getWeights",value:function(){var e=Object(f.a)(p.a.mark((function e(){var t;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[].concat(Object(c.a)(this.accumulatedGrads),Object(c.a)(this.accumulatedUpdates)),e.next=3,this.saveIterations();case 3:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(t.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=Object(f.a)(p.a.mark((function e(t){var n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,n=t.length/2,!1,this.accumulatedGrads=t.slice(0,n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),this.accumulatedUpdates=t.slice(n,2*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.rho,t.epsilon)}}]),n}(ke);Ee.className="Adadelta",pe(Ee);var _e=n(88),Ae=function(e){Object(ve.a)(n,e);var t=Object(be.a)(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1;return Object(h.a)(this,n),(r=t.call(this)).learningRate=e,r.initialAccumulatorValue=a,r.accumulatedGrads=[],r}return Object(m.a)(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=X.a.registeredVariables[n];if(null==t.accumulatedGrads[r]){t.accumulatedGrads[r]={originalName:"".concat(n,"/accumulator"),variable:Object(ge.h)((function(){return Object(_e.a)(a.shape,t.initialAccumulatorValue).variable(!1)}))}}var i=Array.isArray(e)?e[r].tensor:e[n];if(null!=i){var o=t.accumulatedGrads[r].variable;Object(ge.h)((function(){var e=Object(Ie.a)(o,Object(Te.a)(i));o.assign(e);var n=Object(Ie.a)(Object(Ne.a)(Object(Se.a)(i,Object(je.a)(Object(Ie.a)(e,X.a.backend.epsilon()))),-t.learningRate),a);a.assign(n)}))}})),this.incrementIterations()}},{key:"dispose",value:function(){null!=this.accumulatedGrads&&Object(ge.b)(this.accumulatedGrads.map((function(e){return e.variable})))}},{key:"getWeights",value:function(){var e=Object(f.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.saveIterations();case 2:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(this.accumulatedGrads.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=Object(f.a)(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,!1,this.accumulatedGrads=t.map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}}]),n}(ke);Ae.className="Adagrad",pe(Ae);var Re=n(64),De=n(24),Fe=function(e){Object(ve.a)(n,e);var t=Object(be.a)(n);function n(e,r,a){var i,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return Object(h.a)(this,n),(i=t.call(this)).learningRate=e,i.beta1=r,i.beta2=a,i.epsilon=o,i.accumulatedFirstMoment=[],i.accumulatedSecondMoment=[],Object(ge.h)((function(){i.accBeta1=Object(xe.a)(r).variable(),i.accBeta2=Object(xe.a)(a).variable()})),null==o&&(i.epsilon=X.a.backend.epsilon()),i}return Object(m.a)(n,[{key:"applyGradients",value:function(e){var t=this,n=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e);Object(ge.h)((function(){var r=Object(De.a)(1,t.accBeta1),a=Object(De.a)(1,t.accBeta2);n.forEach((function(n,i){var o=X.a.registeredVariables[n];null==t.accumulatedFirstMoment[i]&&(t.accumulatedFirstMoment[i]={originalName:"".concat(n,"/m"),variable:Object(ge.h)((function(){return Object(Ce.a)(o).variable(!1)}))}),null==t.accumulatedSecondMoment[i]&&(t.accumulatedSecondMoment[i]={originalName:"".concat(n,"/v"),variable:Object(ge.h)((function(){return Object(Ce.a)(o).variable(!1)}))});var s=Array.isArray(e)?e[i].tensor:e[n];if(null!=s){var u=t.accumulatedFirstMoment[i].variable,c=t.accumulatedSecondMoment[i].variable,l=Object(Ie.a)(Object(Ne.a)(u,t.beta1),Object(Ne.a)(s,1-t.beta1)),d=Object(Ie.a)(Object(Ne.a)(c,t.beta2),Object(Ne.a)(Object(Te.a)(s),1-t.beta2)),p=Object(Se.a)(l,r),f=Object(Se.a)(d,a);u.assign(l),c.assign(d);var h=Object(Ie.a)(Object(Ne.a)(Object(Se.a)(p,Object(Ie.a)(Object(je.a)(f),t.epsilon)),-t.learningRate),o);o.assign(h)}})),t.accBeta1.assign(Object(Ne.a)(t.accBeta1,t.beta1)),t.accBeta2.assign(Object(Ne.a)(t.accBeta2,t.beta2))})),this.incrementIterations()}},{key:"dispose",value:function(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&Object(ge.b)(this.accumulatedFirstMoment.map((function(e){return e.variable}))),null!=this.accumulatedSecondMoment&&Object(ge.b)(this.accumulatedSecondMoment.map((function(e){return e.variable})))}},{key:"getWeights",value:function(){var e=Object(f.a)(p.a.mark((function e(){var t;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[].concat(Object(c.a)(this.accumulatedFirstMoment),Object(c.a)(this.accumulatedSecondMoment)),e.next=3,this.saveIterations();case 3:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(t.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=Object(f.a)(p.a.mark((function e(t){var n,r=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,Object(ge.h)((function(){r.accBeta1.assign(Object(Re.a)(r.beta1,r.iterations_+1)),r.accBeta2.assign(Object(Re.a)(r.beta2,r.iterations_+1))})),n=t.length/2,!1,this.accumulatedFirstMoment=t.slice(0,n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),this.accumulatedSecondMoment=t.slice(n,2*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}));case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}}]),n}(ke);Fe.className="Adam",pe(Fe);var Me=n(53),ze=n(107),Le=function(e){Object(ve.a)(n,e);var t=Object(be.a)(n);function n(e,r,a){var i,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return Object(h.a)(this,n),(i=t.call(this)).learningRate=e,i.beta1=r,i.beta2=a,i.epsilon=o,i.decay=s,i.accumulatedFirstMoment=[],i.accumulatedWeightedInfNorm=[],Object(ge.h)((function(){i.iteration=Object(xe.a)(0).variable(),i.accBeta1=Object(xe.a)(r).variable()})),null==o&&(i.epsilon=X.a.backend.epsilon()),i}return Object(m.a)(n,[{key:"applyGradients",value:function(e){var t=this,n=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e);Object(ge.h)((function(){var r=Object(De.a)(1,t.accBeta1),a=Object(Se.a)(-t.learningRate,Object(Ie.a)(Object(Ne.a)(t.iteration,t.decay),1));n.forEach((function(n,i){var o=X.a.registeredVariables[n];null==t.accumulatedFirstMoment[i]&&(t.accumulatedFirstMoment[i]={originalName:"".concat(n,"/m"),variable:Object(Ce.a)(o).variable(!1)}),null==t.accumulatedWeightedInfNorm[i]&&(t.accumulatedWeightedInfNorm[i]={originalName:"".concat(n,"/v"),variable:Object(Ce.a)(o).variable(!1)});var s=Array.isArray(e)?e[i].tensor:e[n];if(null!=s){var u=t.accumulatedFirstMoment[i].variable,c=t.accumulatedWeightedInfNorm[i].variable,l=Object(Ie.a)(Object(Ne.a)(u,t.beta1),Object(Ne.a)(s,1-t.beta1)),d=Object(Ne.a)(c,t.beta2),p=Object(Me.a)(s),f=Object(ze.a)(d,p);u.assign(l),c.assign(f);var h=Object(Ie.a)(Object(Ne.a)(Object(Se.a)(a,r),Object(Se.a)(l,Object(Ie.a)(f,t.epsilon))),o);o.assign(h)}})),t.iteration.assign(Object(Ie.a)(t.iteration,1)),t.accBeta1.assign(Object(Ne.a)(t.accBeta1,t.beta1))})),this.incrementIterations()}},{key:"dispose",value:function(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&Object(ge.b)(this.accumulatedFirstMoment.map((function(e){return e.variable}))),null!=this.accumulatedWeightedInfNorm&&Object(ge.b)(this.accumulatedWeightedInfNorm.map((function(e){return e.variable})))}},{key:"getWeights",value:function(){var e=Object(f.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("getWeights() is not implemented for Adamax yet.");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=Object(f.a)(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("setWeights() is not implemented for Adamax yet.");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}}]),n}(ke);Le.className="Adamax",pe(Le);var Pe=function(e){Object(ve.a)(n,e);var t=Object(be.a)(n);function n(e){var r;return Object(h.a)(this,n),(r=t.call(this)).learningRate=e,r.setLearningRate(e),r}return Object(m.a)(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=Array.isArray(e)?e[r].tensor:e[n];if(null!=a){var i=X.a.registeredVariables[n];Object(ge.h)((function(){var e=Object(Ie.a)(Object(Ne.a)(t.c,a),i);i.assign(e)}))}})),this.incrementIterations()}},{key:"setLearningRate",value:function(e){this.learningRate=e,null!=this.c&&this.c.dispose(),this.c=Object(ge.d)(Object(xe.a)(-e))}},{key:"dispose",value:function(){this.c.dispose()}},{key:"getWeights",value:function(){var e=Object(f.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.saveIterations();case 2:return e.t0=e.sent,e.abrupt("return",[e.t0]);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=Object(f.a)(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:if(0===(t=e.sent).length){e.next=5;break}throw new Error("SGD optimizer does not have settable weights.");case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate)}}]),n}(ke);Pe.className="SGD",pe(Pe);var Be=function(e){Object(ve.a)(n,e);var t=Object(be.a)(n);function n(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Object(h.a)(this,n),(a=t.call(this,e)).learningRate=e,a.momentum=r,a.useNesterov=i,a.accumulations=[],a.m=Object(xe.a)(a.momentum),a}return Object(m.a)(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=X.a.registeredVariables[n];if(null==t.accumulations[r]){t.accumulations[r]={originalName:"".concat(n,"/momentum"),variable:Object(ge.h)((function(){return Object(Ce.a)(a).variable(!1)}))}}var i=t.accumulations[r].variable,o=Array.isArray(e)?e[r].tensor:e[n];null!=o&&Object(ge.h)((function(){var e,n=Object(Ie.a)(Object(Ne.a)(t.m,i),o);e=t.useNesterov?Object(Ie.a)(Object(Ne.a)(t.c,Object(Ie.a)(o,Object(Ne.a)(n,t.m))),a):Object(Ie.a)(Object(Ne.a)(t.c,n),a),i.assign(n),a.assign(e)}))})),this.incrementIterations()}},{key:"dispose",value:function(){this.m.dispose(),null!=this.accumulations&&Object(ge.b)(this.accumulations.map((function(e){return e.variable})))}},{key:"setMomentum",value:function(e){this.momentum=e}},{key:"getWeights",value:function(){var e=Object(f.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.saveIterations();case 2:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(this.accumulations.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=Object(f.a)(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,!1,this.accumulations=t.map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}}]),n}(Pe);Be.className="Momentum",pe(Be);var We=function(e){Object(ve.a)(n,e);var t=Object(be.a)(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(Object(h.a)(this,n),(r=t.call(this)).learningRate=e,r.decay=a,r.momentum=i,r.epsilon=o,r.accumulatedMeanSquares=[],r.accumulatedMoments=[],r.accumulatedMeanGrads=[],r.centered=s,null==o&&(r.epsilon=X.a.backend.epsilon()),null==e)throw new Error("learningRate for RMSPropOptimizer must be defined.");return r}return Object(m.a)(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=X.a.registeredVariables[n];null==t.accumulatedMeanSquares[r]&&(t.accumulatedMeanSquares[r]={originalName:"".concat(n,"/rms"),variable:Object(ge.h)((function(){return Object(Ce.a)(a).variable(!1)}))}),null==t.accumulatedMoments[r]&&(t.accumulatedMoments[r]={originalName:"".concat(n,"/momentum"),variable:Object(ge.h)((function(){return Object(Ce.a)(a).variable(!1)}))}),null==t.accumulatedMeanGrads[r]&&t.centered&&(t.accumulatedMeanGrads[r]={originalName:"".concat(n,"/mg"),variable:Object(ge.h)((function(){return Object(Ce.a)(a).variable(!1)}))});var i=Array.isArray(e)?e[r].tensor:e[n];if(null!=i){var o=t.accumulatedMeanSquares[r].variable,s=t.accumulatedMoments[r].variable;Object(ge.h)((function(){var e=Object(Ie.a)(Object(Ne.a)(o,t.decay),Object(Ne.a)(Object(Te.a)(i),1-t.decay));if(t.centered){var n=t.accumulatedMeanGrads[r].variable,u=Object(Ie.a)(Object(Ne.a)(n,t.decay),Object(Ne.a)(i,1-t.decay)),c=Object(Se.a)(Object(Ne.a)(i,t.learningRate),Object(je.a)(Object(De.a)(e,Object(Ie.a)(Object(Te.a)(u),t.epsilon)))),l=Object(Ie.a)(Object(Ne.a)(s,t.momentum),c);o.assign(e),n.assign(u),s.assign(l);var d=Object(De.a)(a,l);a.assign(d)}else{var p=Object(Ie.a)(Object(Ne.a)(o,t.decay),Object(Ne.a)(Object(Te.a)(i),1-t.decay)),f=Object(Ie.a)(Object(Ne.a)(s,t.momentum),Object(Se.a)(Object(Ne.a)(i,t.learningRate),Object(je.a)(Object(Ie.a)(p,t.epsilon))));o.assign(p),s.assign(f);var h=Object(De.a)(a,f);a.assign(h)}}))}})),this.incrementIterations()}},{key:"dispose",value:function(){null!=this.accumulatedMeanSquares&&Object(ge.b)(this.accumulatedMeanSquares.map((function(e){return e.variable}))),null!=this.accumulatedMeanGrads&&this.centered&&Object(ge.b)(this.accumulatedMeanGrads.map((function(e){return e.variable}))),null!=this.accumulatedMoments&&Object(ge.b)(this.accumulatedMoments.map((function(e){return e.variable})))}},{key:"getWeights",value:function(){var e=Object(f.a)(p.a.mark((function e(){var t;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[].concat(Object(c.a)(this.accumulatedMeanSquares),Object(c.a)(this.accumulatedMoments)),this.centered&&t.push.apply(t,Object(c.a)(this.accumulatedMeanGrads)),e.next=4,this.saveIterations();case 4:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(t.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=Object(f.a)(p.a.mark((function e(t){var n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,n=this.centered?t.length/3:t.length/2,!1,this.accumulatedMeanSquares=t.slice(0,n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),this.accumulatedMoments=t.slice(n,2*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),this.centered&&(this.accumulatedMeanGrads=t.slice(2*n,3*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})));case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}}]),n}(ke);We.className="RMSProp",pe(We);var Ue=function(){function e(){Object(h.a)(this,e)}return Object(m.a)(e,null,[{key:"sgd",value:function(e){return new Pe(e)}},{key:"momentum",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return new Be(e,t,n)}},{key:"rmsprop",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return new We(e,t,n,r,a)}},{key:"adam",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.001,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.999,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return new Fe(e,t,n,r)}},{key:"adadelta",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.001,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.95,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return new Ee(e,t,n)}},{key:"adamax",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.002,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.999,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return new Le(e,t,n,r,a)}},{key:"adagrad",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1;return new Ae(e,t)}}]),e}(),Ve={sgd:Ue.sgd,momentum:Ue.momentum,adadelta:Ue.adadelta,adagrad:Ue.adagrad,rmsprop:Ue.rmsprop,adamax:Ue.adamax,adam:Ue.adam},Ge=n(226),He=n(49);function qe(e,t){var n=e[0].length;e.forEach((function(e,t){I.b(e.length===n,(function(){return"Error in concat".concat(n,"D: rank of tensors[").concat(t,"] must be the same ")+"as the rank of the rest (".concat(n,")")}))})),I.b(t>=0&&t<n,(function(){return"Error in concat".concat(n,"D: axis must be between 0 and ").concat(n-1,".")}));var r=e[0];e.forEach((function(e,a){for(var i=0;i<n;i++)I.b(i===t||e[i]===r[i],(function(){return"Error in concat".concat(n,"D: Shape of tensors[").concat(a,"] (").concat(e,") ")+"does not match the shape of the rest (".concat(r,") ")+"along the non-concatenated axis ".concat(a,".")}))}))}function Ke(e,t){for(var n=e[0].slice(),r=1;r<e.length;r++)n[t]+=e[r][t];return n}var Xe,Ye=n(33),Ze=n(54);function Je(e,t,n){var r=new Array;if(null==n&&null==t)return r;if(null==t)for(;r.length<e+n.length;)r.push(-1);else r=t.slice();if(null==n)return r;if(e+n.length!==r.length)throw new Error("rt input.shape and shape=".concat(t," are incompatible: rt input.rank = ").concat(e+n.length,", but shape.rank = ").concat(r.length));for(var a=1;a<n.length;++a){var i=n[a],o=r[r.length-n.length+a],s=r[o];if(i>=0)if(s>=0){if(s!==i)throw new Error("rt input.shape and shape=".concat(t," are incompatible: rt input.shape[").concat(a+e,"] = ").concat(i," but shape[").concat(a+e,"] = ").concat(s))}else r[o]=i}return r}function Qe(e){var t,n={FIRST_DIM_SIZE:Xe.FIRST_DIM_SIZE,VALUE_ROWIDS:Xe.VALUE_ROWIDS,ROW_LENGTHS:Xe.ROW_LENGTHS,ROW_SPLITS:Xe.ROW_SPLITS,ROW_LIMITS:Xe.ROW_LIMITS,ROW_STARTS:Xe.ROW_STARTS},r=[],a=Object(l.a)(e);try{for(a.s();!(t=a.n()).done;){var i=t.value;if(!(i in n))break;r.push(n[i])}}catch(o){a.e(o)}finally{a.f()}return r}function $e(e){return 0===e.length?0:e[0]===Xe.FIRST_DIM_SIZE?e.length-1:e.length}function et(e,t){if(null!=e&&null!=t){var n=e.length,r=t.length;if(n>=r)throw new Error("defaultValue.shape=".concat(e," and ragged tensor flatValues.shape=").concat(t,", are incompatible: defaultValue.rank = ").concat(n," must be less than ragged tensor input flatValues.rank = ").concat(r,")"));for(var a=0;a<Math.min(n,r-1);++a){var i=e[a],o=t[a+1];if(i>=0&&o>=0&&1!==i&&i!==o)throw new Error("defaultValue.shape=".concat(e,", and ragged tensor input flatValues.shape=").concat(t," are incompatible: defaultValue.shape[").concat(a-e.length,"] = ").concat(i," but ragged tensor input.flatValues.shape[").concat(a-e.length,"] = ").concat(o))}}}!function(e){e[e.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",e[e.VALUE_ROWIDS=1]="VALUE_ROWIDS",e[e.ROW_LENGTHS=2]="ROW_LENGTHS",e[e.ROW_SPLITS=3]="ROW_SPLITS",e[e.ROW_LIMITS=4]="ROW_LIMITS",e[e.ROW_STARTS=5]="ROW_STARTS"}(Xe||(Xe={}));var tt=30;function nt(e){return e<=tt?e:Object(I.G)(e,Math.floor(Math.sqrt(e)))}function rt(e,t,n){return[n*("number"===typeof e?e:e[0]),t*("number"===typeof e?e:e[1])]}function at(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=[];if(r)(a=a.concat(t.slice(0))).push(e[0]/n),a=a.concat(e.slice(1));else{a=a.concat(e[0]);for(var i=t.length,o=0;o<i;++o)a=a.concat([e[o+1]/t[o],t[o]]);a=a.concat(e.slice(i+1))}return a}function it(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=[];if(n){r.push(t);for(var a=t+1;a<e;++a)a<=2*t?(r.push(a),r.push(a-(t+1))):r.push(a)}else{for(var i=[],o=[],s=1;s<e;++s)s>=2*t+1||s%2===1?o.push(s):i.push(s);r.push.apply(r,i),r.push(0),r.push.apply(r,o)}return r}function ot(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=[];r?a.push(e[0]/n):a.push(e[0]*n);for(var i=1;i<e.length;++i)i<=t.length?r?a.push(t[i-1]*e[i]):a.push(e[i]/t[i-1]):a.push(e[i]);return a}function st(e,t){for(var n=[0],r=0;r<t;++r)n.push(e[r][0]);return n}function ut(e,t,n){for(var r=e.slice(0,1),a=0;a<n;++a)r.push(e[a+1]-t[a][0]-t[a][1]);return r}function ct(e,t){var n=e.shape.length,r=t.shape.length;if(n<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher,"+" but the rank was ".concat(n,"."));if(r<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher,"+" but the rank was ".concat(r,"."));if("int32"!==t.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type,"+" but the dtype was ".concat(t.dtype,"."));if(t.shape[r-1]>n)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+"".concat(t.shape[r-1]," vs. ").concat(n));if(0===Object(I.O)(e.shape))throw new Error("Requested more than 0 entries, but input is empty."+" Input shape: ".concat(e.shape,"."));for(var a=t.shape,i=a[a.length-1],o=1,s=0;s<a.length-1;++s)o*=a[s];var u=e.shape,l=a.slice();l.pop();for(var d=1,p=i;p<n;++p)d*=u[p],l.push(u[p]);var f=[].concat(Object(c.a)(Object(I.j)(e.shape).map((function(e){return e/d}))),[1]).slice(0,i);return[l,o,d,f]}var lt=n(118),dt=n(148),pt=.3275911,ft=.254829592,ht=-.284496736,mt=1.421413741,vt=-1.453152027,bt=1.061405429,gt=n(85);function yt(e,t){if(e.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+"".concat(e.length,", imag: ").concat(t.length,"."));for(var n=new Float32Array(2*e.length),r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}function xt(e){for(var t=new Float32Array(e.length/2),n=new Float32Array(e.length/2),r=0;r<e.length;r+=2)t[r/2]=e[r],n[r/2]=e[r+1];return{real:t,imag:n}}function kt(e){for(var t=Math.ceil(e.length/4),n=new Float32Array(t),r=new Float32Array(t),a=0;a<e.length;a+=4)n[Math.floor(a/4)]=e[a],r[Math.floor(a/4)]=e[a+1];return{real:n,imag:r}}function wt(e){for(var t=Math.floor(e.length/4),n=new Float32Array(t),r=new Float32Array(t),a=2;a<e.length;a+=4)n[Math.floor(a/4)]=e[a],r[Math.floor(a/4)]=e[a+1];return{real:n,imag:r}}function Ot(e,t){return{real:e[2*t],imag:e[2*t+1]}}function It(e,t,n,r){e[2*r]=t,e[2*r+1]=n}function St(e,t){for(var n=new Float32Array(e/2),r=new Float32Array(e/2),a=0;a<Math.ceil(e/2);a++){var i=(t?2:-2)*Math.PI*(a/e);n[a]=Math.cos(i),r[a]=Math.sin(i)}return{real:n,imag:r}}function Nt(e,t,n){var r=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(r),imag:Math.sin(r)}}var jt=/->/g;function Tt(e,t){var n=((e=e.replace(/\s/g,"")).length-e.replace(jt,"").length)/"->".length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error('Equation must contain exactly one arrow ("'.concat("->",'").'));var r=e.split("->"),a=Object(O.a)(r,2),i=a[0],o=a[1];Object(I.b)(-1===i.indexOf("..."),(function(){return'The ellipsis notation ("'.concat("...",'") is not supported yet.')}));var s=i.split(","),u=s.length;if(t!==u)throw new Error("Expected ".concat(u," input tensors, received ").concat(t));if(u>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");for(var c=[],l=function(e){var t=o[e];if(!s.some((function(e){return-1!==e.indexOf(t)})))throw new Error("Output subscripts contain the label ".concat(t," ")+"not present in the input subscripts.");-1===c.indexOf(t)&&c.push(t)},d=0;d<o.length;++d)l(d);for(var p=0;p<i.length;++p){var f=i[p];-1===c.indexOf(f)&&","!==f&&c.push(f)}for(var h=new Array(s.length),m=0;m<u;++m){if(new Set(s[m].split("")).size!==s[m].length)throw new Error("Found duplicate axes in input component ".concat(s[m],". ")+"Support for duplicate axes in input is not implemented yet.");h[m]=[];for(var v=0;v<s[m].length;++v)h[m].push(c.indexOf(s[m][v]))}for(var b=c.length,g=[],y=o.length;y<b;++y)g.push(y);return{allDims:c,summedDims:g,idDims:h}}function Ct(e,t){var n=new Array(e);n.fill(-1);for(var r=0;r<t.length;++r)n[t[r]]=r;for(var a=[],i=0;i<e;++i)-1===n[i]&&a.push(i);return{permutationIndices:n=n.filter((function(e){return-1!==e})),expandDims:a}}function Et(e,t,n){for(var r=new Array(e),a=function(e){for(var a=n[e].shape,i=function(n){void 0===r[t[e][n]]?r[t[e][n]]=a[n]:Object(I.b)(r[t[e][n]]===a[n],(function(){return"Expected dimension ".concat(r[t[e][n]]," at axis ").concat(n," ")+"of input shaped ".concat(JSON.stringify(a),", ")+"but got dimension ".concat(a[n])}))},o=0;o<t[e].length;++o)i(o)},i=0;i<n.length;++i)a(i)}function _t(e,t){var n,r=e,a=[];0===e.length&&r.push(-1),n=e.length+1;for(var i=0;i<n;++i)a.push([]);for(var o=[],s=0;s<r.length;++s){var u,c=Rt(t,r[s]),d=Object(l.a)(c);try{for(d.s();!(u=d.n()).done;){var p=u.value;-1===o.indexOf(p)&&(a[s].push(p),o.push(p))}}catch(f){d.e(f)}finally{d.f()}}return{path:r,steps:a}}function At(e){return e.every((function(e,t){return e===t}))}function Rt(e,t){for(var n=[],r=0;r<e.length;++r)0!==e[r].length&&-1===e[r].indexOf(t)&&-1!==t||n.push(r);return n}function Dt(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=[];if("number"===typeof t)Object(I.b)(e.shape[n]%t===0,(function(){return"Number of splits must evenly divide the axis."})),r=new Array(t).fill(e.shape[n]/t);else{var a=t.reduce((function(e,t){return-1===t&&(e+=1),e}),0);Object(I.b)(a<=1,(function(){return"There should be only one negative value in split array."}));var i=t.indexOf(-1);if(-1!==i){var o=t.reduce((function(e,t){return t>0?e+t:e}));t[i]=e.shape[n]-o}Object(I.b)(e.shape[n]===t.reduce((function(e,t){return e+t})),(function(){return"The sum of sizes must match the size of the axis dimension."})),r=t}return r}function Ft(e){return"Received SparseTensor with denseShape[0] = 0 but\n  indices.shape[0] = ".concat(e)}function Mt(e,t){return"indices(".concat(e,", 0) is invalid: ").concat(t," < 0")}function zt(e,t,n){return"indices(".concat(e,", 0) is invalid: ").concat(t," >= ").concat(n)}function Lt(e,t){return"only one output dimension may be -1, not both ".concat(e," and ").concat(t)}function Pt(e,t){return"size ".concat(e," must be non-negative, not ").concat(t)}function Bt(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function Wt(e,t){var n=Object(I.O)(e),r=Object(I.O)(t);return"Input to reshape is a SparseTensor with ".concat(n,"\n  dense values, but the requested shape requires a multiple of ").concat(r,". inputShape=").concat(e," outputShape= ").concat(t)}function Ut(e,t){var n=Object(I.O)(e),r=Object(I.O)(t);return"Input to reshape is a tensor with ".concat(n," dense values, but the requested shape has ").concat(r,". inputShape=").concat(e," outputShape=").concat(t)}function Vt(){return"segment ids must be >= 0"}function Gt(){return"segment ids are not increasing"}function Ht(e,t){return"Segment id ".concat(e," out of range [0, ").concat(t,"), possibly because segmentIds input is not sorted.")}function qt(e,t,n){return"Bad: indices[".concat(e,"] == ").concat(t," out of range [0, ").concat(n,")")}function Kt(e,t){var n,r=!1;for(e<=tt?(n=e,r=!0):n=Object(I.G)(e,Math.floor(Math.sqrt(e)));!r;)n>t||n===e?r=!0:n=Object(I.G)(e,n+1);return n}function Xt(e,t,n){for(var r=[],a=e.length,i=0;i<a;i++)i!==t?r.push(e[i]):r.push(n);return r}function Yt(e,t,n,r){var a=t.shape.length,i=e.shape.length;if(0!==r&&(r<-a||r>a))throw new Error("Expect batchDims in the range of [-".concat(a,", ").concat(a,"], but got ").concat(r));if(r<0&&(r+=a),r>i)throw new Error("batchDims (".concat(r,") must be less than rank(x) (\n    ").concat(i,")."));if(n<r)throw new Error("batchDims (".concat(r,") must be less than or equal to axis (").concat(n,")."));for(var o=0;o<r;++o)if(e.shape[o]!==t.shape[o])throw new Error("x.shape[".concat(o,"]: ").concat(e.shape[o]," should be equal to indices.shape[").concat(o,"]: ").concat(t.shape[o],"."));for(var s=e.shape[n],u=[],c=1,l=1,d=1,p=0;p<r;++p)u.push(e.shape[p]),c*=e.shape[p];for(var f=r;f<n;f++)u.push(e.shape[f]),l*=e.shape[f];for(var h=r;h<a;h++)u.push(t.shape[h]);for(var m=n+1;m<i;m++)u.push(e.shape[m]),d*=e.shape[m];return{batchSize:c,sliceSize:d,outerSize:l,dimSize:s,outputShape:u}}function Zt(e){try{return e.map((function(e){return Object(he.decodeString)(e)}))}catch(t){throw new Error("Failed to decode encoded string bytes into utf-8, error: ".concat(t))}}function Jt(e){return e.map((function(e){return Object(he.encodeString)(e)}))}var Qt=n(153),$t=n(87),en=n(187),tn=n(146)},function(e,t,n){"use strict";function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8}},function(e,t,n){"use strict";(function(e){var r=n(261),a=n(262),i=n(263);function o(){return u.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function s(e,t){if(o()<t)throw new RangeError("Invalid typed array length");return u.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=u.prototype:(null===e&&(e=new u(t)),e.length=t),e}function u(e,t,n){if(!u.TYPED_ARRAY_SUPPORT&&!(this instanceof u))return new u(e,t,n);if("number"===typeof e){if("string"===typeof t)throw new Error("If encoding is specified then the first argument must be a string");return d(this,e)}return c(this,e,t,n)}function c(e,t,n,r){if("number"===typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!==typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,r){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r);u.TYPED_ARRAY_SUPPORT?(e=t).__proto__=u.prototype:e=p(e,t);return e}(e,t,n,r):"string"===typeof t?function(e,t,n){"string"===typeof n&&""!==n||(n="utf8");if(!u.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|h(t,n),a=(e=s(e,r)).write(t,n);a!==r&&(e=e.slice(0,a));return e}(e,t,n):function(e,t){if(u.isBuffer(t)){var n=0|f(t.length);return 0===(e=s(e,n)).length||t.copy(e,0,0,n),e}if(t){if("undefined"!==typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!==typeof t.length||(r=t.length)!==r?s(e,0):p(e,t);if("Buffer"===t.type&&i(t.data))return p(e,t.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function l(e){if("number"!==typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function d(e,t){if(l(t),e=s(e,t<0?0:0|f(t)),!u.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function p(e,t){var n=t.length<0?0:0|f(t.length);e=s(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function f(e){if(e>=o())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o().toString(16)+" bytes");return 0|e}function h(e,t){if(u.isBuffer(e))return e.length;if("undefined"!==typeof ArrayBuffer&&"function"===typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!==typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return B(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return W(e).length;default:if(r)return B(e).length;t=(""+t).toLowerCase(),r=!0}}function m(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return C(this,t,n);case"utf8":case"utf-8":return N(this,t,n);case"ascii":return j(this,t,n);case"latin1":case"binary":return T(this,t,n);case"base64":return S(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return E(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function v(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function b(e,t,n,r,a){if(0===e.length)return-1;if("string"===typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=a?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(a)return-1;n=e.length-1}else if(n<0){if(!a)return-1;n=0}if("string"===typeof t&&(t=u.from(t,r)),u.isBuffer(t))return 0===t.length?-1:g(e,t,n,r,a);if("number"===typeof t)return t&=255,u.TYPED_ARRAY_SUPPORT&&"function"===typeof Uint8Array.prototype.indexOf?a?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):g(e,[t],n,r,a);throw new TypeError("val must be string, number or Buffer")}function g(e,t,n,r,a){var i,o=1,s=e.length,u=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;o=2,s/=2,u/=2,n/=2}function c(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(a){var l=-1;for(i=n;i<s;i++)if(c(e,i)===c(t,-1===l?0:i-l)){if(-1===l&&(l=i),i-l+1===u)return l*o}else-1!==l&&(i-=i-l),l=-1}else for(n+u>s&&(n=s-u),i=n;i>=0;i--){for(var d=!0,p=0;p<u;p++)if(c(e,i+p)!==c(t,p)){d=!1;break}if(d)return i}return-1}function y(e,t,n,r){n=Number(n)||0;var a=e.length-n;r?(r=Number(r))>a&&(r=a):r=a;var i=t.length;if(i%2!==0)throw new TypeError("Invalid hex string");r>i/2&&(r=i/2);for(var o=0;o<r;++o){var s=parseInt(t.substr(2*o,2),16);if(isNaN(s))return o;e[n+o]=s}return o}function x(e,t,n,r){return U(B(t,e.length-n),e,n,r)}function k(e,t,n,r){return U(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function w(e,t,n,r){return k(e,t,n,r)}function O(e,t,n,r){return U(W(t),e,n,r)}function I(e,t,n,r){return U(function(e,t){for(var n,r,a,i=[],o=0;o<e.length&&!((t-=2)<0);++o)n=e.charCodeAt(o),r=n>>8,a=n%256,i.push(a),i.push(r);return i}(t,e.length-n),e,n,r)}function S(e,t,n){return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function N(e,t,n){n=Math.min(e.length,n);for(var r=[],a=t;a<n;){var i,o,s,u,c=e[a],l=null,d=c>239?4:c>223?3:c>191?2:1;if(a+d<=n)switch(d){case 1:c<128&&(l=c);break;case 2:128===(192&(i=e[a+1]))&&(u=(31&c)<<6|63&i)>127&&(l=u);break;case 3:i=e[a+1],o=e[a+2],128===(192&i)&&128===(192&o)&&(u=(15&c)<<12|(63&i)<<6|63&o)>2047&&(u<55296||u>57343)&&(l=u);break;case 4:i=e[a+1],o=e[a+2],s=e[a+3],128===(192&i)&&128===(192&o)&&128===(192&s)&&(u=(15&c)<<18|(63&i)<<12|(63&o)<<6|63&s)>65535&&u<1114112&&(l=u)}null===l?(l=65533,d=1):l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|1023&l),r.push(l),a+=d}return function(e){var t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);var n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=4096));return n}(r)}t.Buffer=u,t.SlowBuffer=function(e){+e!=e&&(e=0);return u.alloc(+e)},t.INSPECT_MAX_BYTES=50,u.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"===typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(t){return!1}}(),t.kMaxLength=o(),u.poolSize=8192,u._augment=function(e){return e.__proto__=u.prototype,e},u.from=function(e,t,n){return c(null,e,t,n)},u.TYPED_ARRAY_SUPPORT&&(u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array,"undefined"!==typeof Symbol&&Symbol.species&&u[Symbol.species]===u&&Object.defineProperty(u,Symbol.species,{value:null,configurable:!0})),u.alloc=function(e,t,n){return function(e,t,n,r){return l(t),t<=0?s(e,t):void 0!==n?"string"===typeof r?s(e,t).fill(n,r):s(e,t).fill(n):s(e,t)}(null,e,t,n)},u.allocUnsafe=function(e){return d(null,e)},u.allocUnsafeSlow=function(e){return d(null,e)},u.isBuffer=function(e){return!(null==e||!e._isBuffer)},u.compare=function(e,t){if(!u.isBuffer(e)||!u.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,a=0,i=Math.min(n,r);a<i;++a)if(e[a]!==t[a]){n=e[a],r=t[a];break}return n<r?-1:r<n?1:0},u.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(e,t){if(!i(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return u.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=u.allocUnsafe(t),a=0;for(n=0;n<e.length;++n){var o=e[n];if(!u.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,a),a+=o.length}return r},u.byteLength=h,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var e=this.length;if(e%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)v(this,t,t+1);return this},u.prototype.swap32=function(){var e=this.length;if(e%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)v(this,t,t+3),v(this,t+1,t+2);return this},u.prototype.swap64=function(){var e=this.length;if(e%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)v(this,t,t+7),v(this,t+1,t+6),v(this,t+2,t+5),v(this,t+3,t+4);return this},u.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?N(this,0,e):m.apply(this,arguments)},u.prototype.equals=function(e){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===u.compare(this,e)},u.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},u.prototype.compare=function(e,t,n,r,a){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===a&&(a=this.length),t<0||n>e.length||r<0||a>this.length)throw new RangeError("out of range index");if(r>=a&&t>=n)return 0;if(r>=a)return-1;if(t>=n)return 1;if(this===e)return 0;for(var i=(a>>>=0)-(r>>>=0),o=(n>>>=0)-(t>>>=0),s=Math.min(i,o),c=this.slice(r,a),l=e.slice(t,n),d=0;d<s;++d)if(c[d]!==l[d]){i=c[d],o=l[d];break}return i<o?-1:o<i?1:0},u.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},u.prototype.indexOf=function(e,t,n){return b(this,e,t,n,!0)},u.prototype.lastIndexOf=function(e,t,n){return b(this,e,t,n,!1)},u.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"===typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var a=this.length-t;if((void 0===n||n>a)&&(n=a),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var i=!1;;)switch(r){case"hex":return y(this,e,t,n);case"utf8":case"utf-8":return x(this,e,t,n);case"ascii":return k(this,e,t,n);case"latin1":case"binary":return w(this,e,t,n);case"base64":return O(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return I(this,e,t,n);default:if(i)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),i=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function j(e,t,n){var r="";n=Math.min(e.length,n);for(var a=t;a<n;++a)r+=String.fromCharCode(127&e[a]);return r}function T(e,t,n){var r="";n=Math.min(e.length,n);for(var a=t;a<n;++a)r+=String.fromCharCode(e[a]);return r}function C(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var a="",i=t;i<n;++i)a+=P(e[i]);return a}function E(e,t,n){for(var r=e.slice(t,n),a="",i=0;i<r.length;i+=2)a+=String.fromCharCode(r[i]+256*r[i+1]);return a}function _(e,t,n){if(e%1!==0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function A(e,t,n,r,a,i){if(!u.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>a||t<i)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function R(e,t,n,r){t<0&&(t=65535+t+1);for(var a=0,i=Math.min(e.length-n,2);a<i;++a)e[n+a]=(t&255<<8*(r?a:1-a))>>>8*(r?a:1-a)}function D(e,t,n,r){t<0&&(t=4294967295+t+1);for(var a=0,i=Math.min(e.length-n,4);a<i;++a)e[n+a]=t>>>8*(r?a:3-a)&255}function F(e,t,n,r,a,i){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function M(e,t,n,r,i){return i||F(e,0,n,4),a.write(e,t,n,r,23,4),n+4}function z(e,t,n,r,i){return i||F(e,0,n,8),a.write(e,t,n,r,52,8),n+8}u.prototype.slice=function(e,t){var n,r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),u.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=u.prototype;else{var a=t-e;n=new u(a,void 0);for(var i=0;i<a;++i)n[i]=this[i+e]}return n},u.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||_(e,t,this.length);for(var r=this[e],a=1,i=0;++i<t&&(a*=256);)r+=this[e+i]*a;return r},u.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||_(e,t,this.length);for(var r=this[e+--t],a=1;t>0&&(a*=256);)r+=this[e+--t]*a;return r},u.prototype.readUInt8=function(e,t){return t||_(e,1,this.length),this[e]},u.prototype.readUInt16LE=function(e,t){return t||_(e,2,this.length),this[e]|this[e+1]<<8},u.prototype.readUInt16BE=function(e,t){return t||_(e,2,this.length),this[e]<<8|this[e+1]},u.prototype.readUInt32LE=function(e,t){return t||_(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},u.prototype.readUInt32BE=function(e,t){return t||_(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},u.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||_(e,t,this.length);for(var r=this[e],a=1,i=0;++i<t&&(a*=256);)r+=this[e+i]*a;return r>=(a*=128)&&(r-=Math.pow(2,8*t)),r},u.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||_(e,t,this.length);for(var r=t,a=1,i=this[e+--r];r>0&&(a*=256);)i+=this[e+--r]*a;return i>=(a*=128)&&(i-=Math.pow(2,8*t)),i},u.prototype.readInt8=function(e,t){return t||_(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},u.prototype.readInt16LE=function(e,t){t||_(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},u.prototype.readInt16BE=function(e,t){t||_(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},u.prototype.readInt32LE=function(e,t){return t||_(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},u.prototype.readInt32BE=function(e,t){return t||_(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},u.prototype.readFloatLE=function(e,t){return t||_(e,4,this.length),a.read(this,e,!0,23,4)},u.prototype.readFloatBE=function(e,t){return t||_(e,4,this.length),a.read(this,e,!1,23,4)},u.prototype.readDoubleLE=function(e,t){return t||_(e,8,this.length),a.read(this,e,!0,52,8)},u.prototype.readDoubleBE=function(e,t){return t||_(e,8,this.length),a.read(this,e,!1,52,8)},u.prototype.writeUIntLE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||A(this,e,t,n,Math.pow(2,8*n)-1,0);var a=1,i=0;for(this[t]=255&e;++i<n&&(a*=256);)this[t+i]=e/a&255;return t+n},u.prototype.writeUIntBE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||A(this,e,t,n,Math.pow(2,8*n)-1,0);var a=n-1,i=1;for(this[t+a]=255&e;--a>=0&&(i*=256);)this[t+a]=e/i&255;return t+n},u.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,1,255,0),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},u.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):R(this,e,t,!0),t+2},u.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):R(this,e,t,!1),t+2},u.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):D(this,e,t,!0),t+4},u.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):D(this,e,t,!1),t+4},u.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var a=Math.pow(2,8*n-1);A(this,e,t,n,a-1,-a)}var i=0,o=1,s=0;for(this[t]=255&e;++i<n&&(o*=256);)e<0&&0===s&&0!==this[t+i-1]&&(s=1),this[t+i]=(e/o>>0)-s&255;return t+n},u.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var a=Math.pow(2,8*n-1);A(this,e,t,n,a-1,-a)}var i=n-1,o=1,s=0;for(this[t+i]=255&e;--i>=0&&(o*=256);)e<0&&0===s&&0!==this[t+i+1]&&(s=1),this[t+i]=(e/o>>0)-s&255;return t+n},u.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,1,127,-128),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},u.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):R(this,e,t,!0),t+2},u.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):R(this,e,t,!1),t+2},u.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,4,2147483647,-2147483648),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):D(this,e,t,!0),t+4},u.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):D(this,e,t,!1),t+4},u.prototype.writeFloatLE=function(e,t,n){return M(this,e,t,!0,n)},u.prototype.writeFloatBE=function(e,t,n){return M(this,e,t,!1,n)},u.prototype.writeDoubleLE=function(e,t,n){return z(this,e,t,!0,n)},u.prototype.writeDoubleBE=function(e,t,n){return z(this,e,t,!1,n)},u.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var a,i=r-n;if(this===e&&n<t&&t<r)for(a=i-1;a>=0;--a)e[a+t]=this[a+n];else if(i<1e3||!u.TYPED_ARRAY_SUPPORT)for(a=0;a<i;++a)e[a+t]=this[a+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+i),t);return i},u.prototype.fill=function(e,t,n,r){if("string"===typeof e){if("string"===typeof t?(r=t,t=0,n=this.length):"string"===typeof n&&(r=n,n=this.length),1===e.length){var a=e.charCodeAt(0);a<256&&(e=a)}if(void 0!==r&&"string"!==typeof r)throw new TypeError("encoding must be a string");if("string"===typeof r&&!u.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"===typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var i;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"===typeof e)for(i=t;i<n;++i)this[i]=e;else{var o=u.isBuffer(e)?e:B(new u(e,r).toString()),s=o.length;for(i=0;i<n-t;++i)this[i+t]=o[i%s]}return this};var L=/[^+\/0-9A-Za-z-_]/g;function P(e){return e<16?"0"+e.toString(16):e.toString(16)}function B(e,t){var n;t=t||1/0;for(var r=e.length,a=null,i=[],o=0;o<r;++o){if((n=e.charCodeAt(o))>55295&&n<57344){if(!a){if(n>56319){(t-=3)>-1&&i.push(239,191,189);continue}if(o+1===r){(t-=3)>-1&&i.push(239,191,189);continue}a=n;continue}if(n<56320){(t-=3)>-1&&i.push(239,191,189),a=n;continue}n=65536+(a-55296<<10|n-56320)}else a&&(t-=3)>-1&&i.push(239,191,189);if(a=null,n<128){if((t-=1)<0)break;i.push(n)}else if(n<2048){if((t-=2)<0)break;i.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;i.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;i.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return i}function W(e){return r.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(L,"")).length<2)return"";for(;e.length%4!==0;)e+="=";return e}(e))}function U(e,t,n,r){for(var a=0;a<r&&!(a+n>=t.length||a>=e.length);++a)t[a+n]=e[a];return a}}).call(this,n(143))},function(e,t,n){"use strict";var r;function a(e){r=e}function i(e){if(void 0!==r)return r;if(e||"undefined"!==typeof navigator&&null!=navigator){if(e||(e=navigator),"ReactNative"===e.product)return!0;var t=e.userAgent||e.vendor||("undefined"!==typeof window?window.opera:"");if(!t){var n=e;return n.userAgentData&&n.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))}return!1}function o(){return"undefined"!==typeof window&&null!=window.document||"undefined"!==typeof WorkerGlobalScope}n.r(t),n.d(t,"mockIsMobile",(function(){return a})),n.d(t,"isMobile",(function(){return i})),n.d(t,"isBrowser",(function(){return o}))},function(e,t,n){"use strict";function r(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];console.log(e.toString(t))}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(7),i=n(6),o=n(9);var s=Object(o.b)({all_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=Object(i.a)(e,"x","all","bool"),s={x:o},u={axis:t,keepDims:n};return r.a.runKernel(a.f,s,u)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(7),i=n(6),o=n(9);var s=Object(o.b)({any_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=Object(i.a)(e,"x","any","bool"),s={x:o},u={axis:t,keepDims:n};return r.a.runKernel(a.g,s,u)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(7),i=n(6),o=n(9);var s=Object(o.b)({argMax_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Object(i.a)(e,"x","argMax"),o={x:n},s={axis:t};return r.a.runKernel(a.h,o,s)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(7),i=n(6),o=n(9);var s=Object(o.b)({argMin_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Object(i.a)(e,"x","argMin"),o={x:n},s={axis:t};return r.a.runKernel(a.i,o,s)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(3),a=n(12),i=n(7),o=n(32),s=n(6),u=n(9);var c=Object(u.b)({atan2_:function(e,t){var n=Object(s.a)(e,"a","atan2"),u=Object(s.a)(t,"b","atan2"),c=Object(o.makeTypesMatch)(n,u),l=Object(r.a)(c,2),d={a:n=l[0],b:u=l[1]};return a.a.runKernel(i.m,d)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(6),a=n(18),i=n(77),o=n(33),s=n(9),u=n(16);var c=Object(s.b)({conv1d_:function(e,t,n,s){var c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NWC",l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,d=arguments.length>6?arguments[6]:void 0,p=Object(r.a)(e,"x","conv1d"),f=Object(r.a)(t,"filter","conv1d"),h=p,m=!1;2===p.rank&&(m=!0,h=Object(u.a)(p,[1,p.shape[0],p.shape[1]])),a.b(3===h.rank,(function(){return"Error in conv1d: input must be rank 3, but got rank ".concat(h.rank,".")})),a.b(3===f.rank,(function(){return"Error in conv1d: filter must be rank 3, but got rank "+"".concat(f.rank,".")})),o.a("conv1d",s,d),a.b(h.shape[2]===f.shape[1],(function(){return"Error in conv1d: depth of input (".concat(h.shape[2],") must match ")+"input depth for filter ".concat(f.shape[1],".")})),a.b(o.i(n,l),(function(){return"Error in conv1D: Either stride or dilation must be 1. "+"Got stride ".concat(n," and dilation '").concat(l,"'")})),a.b("NWC"===c,(function(){return"Error in conv1d: got dataFormat of ".concat(c," but only NWC is currently supported.")}));var v=Object(u.a)(f,[1,f.shape[0],f.shape[1],f.shape[2]]),b=Object(u.a)(h,[h.shape[0],1,h.shape[1],h.shape[2]]),g=[1,n],y=[1,l],x="NHWC",k=Object(i.a)(b,v,g,s,x,y,d);return m?Object(u.a)(k,[k.shape[2],k.shape[3]]):Object(u.a)(k,[k.shape[0],k.shape[2],k.shape[3]])}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(6),a=n(140),i=n(9);var o=Object(i.b)({conv2dTranspose_:function(e,t,n,i,o,s){var u=Object(r.a)(e,"x","conv2dTranspose"),c=Object(r.a)(t,"filter","conv2dTranspose");return Object(a.a)(n,u,c,i,o,"NHWC",s)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(7),i=n(6),o=n(9);var s=Object(o.b)({cosh_:function(e){var t={x:Object(i.a)(e,"x","cosh","float32")};return r.a.runKernel(a.K,t)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(12),a=n(7),i=n(6),o=n(18),s=n(9);var u=Object(s.b)({depthToSpace_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"NHWC",s=Object(i.a)(e,"x","depthToSpace","float32"),u="NHWC"===n?s.shape[1]:s.shape[2],c="NHWC"===n?s.shape[2]:s.shape[3],l="NHWC"===n?s.shape[3]:s.shape[1];o.b(t>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: ".concat(t)})),o.b(u*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n    ".concat(u," and ").concat(t,"  for depthToSpace with input shape\n    ").concat(s.shape)})),o.b(c*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n    ".concat(c," and ").concat(t," for depthToSpace with input shape\n        ").concat(s.shape)})),o.b(l%(t*t)===0,(function(){return"Dimension size must be evenly divisible by ".concat(t*t," but is ").concat(l," for depthToSpace with input shape ").concat(s.shape)}));var d={x:s},p={blockSize:t,dataFormat:n};return r.a.runKernel(a.P,d,p)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(12),a=n(7),i=n(6),o=n(18),s=n(9),u=n(16);var c=Object(s.b)({dilation2d_:function(e,t,n,s){var c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[1,1],l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",d=Object(i.a)(e,"x","dilation2d"),p=Object(i.a)(t,"filter","dilation2d");o.b(3===d.rank||4===d.rank,(function(){return"Error in dilation2d: input must be rank 3 or 4, but got rank "+"".concat(d.rank,".")})),o.b(3===p.rank,(function(){return"Error in dilation2d: filter must be rank 3, but got rank "+"".concat(p.rank,".")})),o.b("NHWC"===l,(function(){return"Error in dilation2d: Only NHWC is currently supported, "+"but got dataFormat of ".concat(l)}));var f=d,h=!1;3===d.rank&&(f=Object(u.a)(d,[1,d.shape[0],d.shape[1],d.shape[2]]),h=!0);var m={x:f,filter:p},v={strides:n,pad:s,dilations:c},b=r.a.runKernel(a.U,m,v);return h?Object(u.a)(b,[b.shape[1],b.shape[2],b.shape[3]]):b}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var r=n(3),a=n(32),i=n(6),o=n(25),s=n(102),u=n(9),c=n(44),l=n(29);var d=Object(u.b)({divNoNan_:function(e,t){var n=Object(i.a)(e,"a","div"),u=Object(i.a)(t,"b","div"),d=Object(a.makeTypesMatch)(n,u),p=Object(r.a)(d,2);n=p[0],u=p[1];var f=Object(o.a)(n,u),h=Object(l.a)(f),m=Object(s.a)(u,h);return Object(c.a)(m,h,f)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(6),a=n(18),i=n(36),o=n(9),s=n(16);var u=Object(o.b)({dot_:function(e,t){var n=Object(r.a)(e,"t1","dot"),o=Object(r.a)(t,"t2","dot");a.b((1===n.rank||2===n.rank)&&(1===o.rank||2===o.rank),(function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+"".concat(n.rank," and ").concat(o.rank,".")}));var u=1===n.rank?n.size:n.shape[1],c=1===o.rank?o.size:o.shape[0];if(a.b(u===c,(function(){return"Error in dot: inner dimensions of inputs must match, but got "+"".concat(u," and ").concat(c,".")})),1===n.rank&&1===o.rank){var l=Object(s.a)(n,[1,-1]),d=Object(s.a)(o,[-1,1]),p=Object(i.a)(l,d);return Object(s.a)(p,[])}if(1===n.rank&&2===o.rank){var f=Object(s.a)(n,[1,-1]),h=Object(s.a)(o,[o.shape[0],o.shape[1]]),m=Object(i.a)(f,h);return Object(s.a)(m,[m.size])}if(2===n.rank&&1===o.rank){var v=Object(s.a)(o,[-1,1]),b=Object(i.a)(n,v);return Object(s.a)(b,[b.size])}var g=Object(s.a)(o,[o.shape[0],o.shape[1]]);return Object(i.a)(n,g)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(103),a=n(9);var i=Object(a.b)({euclideanNorm_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Object(r.a)(e,"euclidean",t,n)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(12),a=n(7),i=n(6),o=n(18),s=n(9),u=n(16);var c=Object(s.b)({localResponseNormalization_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5,l=Object(i.a)(e,"x","localResponseNormalization");o.b(4===l.rank||3===l.rank,(function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank ".concat(l.rank,".")})),o.b(o.v(t),(function(){return"Error in localResponseNormalization: depthRadius must be an "+"integer but got depthRadius ".concat(t,".")}));var d=l,p=!1;3===l.rank&&(p=!0,d=Object(u.a)(l,[1,l.shape[0],l.shape[1],l.shape[2]]));var f={x:d},h={depthRadius:t,bias:n,alpha:s,beta:c},m=r.a.runKernel(a.yb,f,h);return p?Object(u.a)(m,[m.shape[1],m.shape[2],m.shape[3]]):m}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(7),i=n(6),o=n(9);var s=Object(o.b)({log1p_:function(e){var t={x:Object(i.a)(e,"x","log1p")};return r.a.runKernel(a.Fb,t)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(7),i=n(6),o=n(9);var s=Object(o.b)({softplus_:function(e){var t={x:Object(i.a)(e,"x","softplus")};return r.a.runKernel(a.Lc,t)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(6),a=n(26),i=n(70),o=n(106),s=n(129),u=n(9);var c=Object(u.b)({logicalXor_:function(e,t){var n=Object(r.a)(e,"a","logicalXor","bool"),u=Object(r.a)(t,"b","logicalXor","bool");return Object(a.assertAndGetBroadcastShape)(n.shape,u.shape),Object(i.a)(Object(s.a)(e,t),Object(o.a)(Object(i.a)(e,t)))}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(12),a=n(7),i=n(6),o=n(18),s=n(9);var u=Object(s.b)({mirrorPad_:function(e,t,n){o.b("reflect"===n||"symmetric"===n,(function(){return"Invalid mode. Mode must be either reflect or symmetric. "+"Got ".concat(n,".")}));var s=Object(i.a)(e,"x","mirrorPad");if(0===s.rank)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");o.b(t.length===s.rank,(function(){return"Padding doesn't match input. Must be ".concat(s.rank,". ")+"Got ".concat(t.length,".")}));for(var u="reflect"===n?1:0,c=function(e){o.b(2===t[e].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),o.b(t[e][0]>=0&&t[e][0]<=s.shape[e]-u&&t[e][1]>=0&&t[e][1]<=s.shape[e]-u,(function(){return"Padding in dimension ".concat(e," cannot be greater than or equal ")+"to ".concat(s.shape[e]-u," or less than 0 for input of ")+"shape ".concat(s.shape)}))},l=0;l<s.rank;l++)c(l);var d={paddings:t,mode:n},p={x:s};return r.a.runKernel(a.Ub,p,d)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(3),a=n(12),i=n(7),o=n(32),s=n(6),u=n(9);var c=Object(u.b)({mod_:function(e,t){var n=Object(s.a)(e,"a","mod"),u=Object(s.a)(t,"b","mod"),c=Object(o.makeTypesMatch)(n,u),l=Object(r.a)(c,2),d={a:n=l[0],b:u=l[1]};return a.a.runKernel(i.Vb,d)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(7),i=n(6),o=n(9);var s=Object(o.b)({oneHot_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"int32";if(t<2)throw new Error("Error in oneHot: depth must be >=2, but it is ".concat(t));var u=Object(i.a)(e,"indices","oneHot","int32"),c={indices:u},l={dtype:s,depth:t,onValue:n,offValue:o};return r.a.runKernel(a.dc,c,l)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return f}));var r=n(3),a=n(6),i=n(18),o=n(120),s=n(100),u=n(33),c=n(130),l=n(9),d=n(16),p=n(108);var f=Object(l.b)({pool_:function(e,t,n,l,f,h,m){null==f&&(f=[1,1]),null==h&&(h=1),0===l&&(l="valid");var v=Object(a.a)(e,"x","maxPool"),b=v,g=!1;3===v.rank&&(g=!0,b=Object(d.a)(v,[1,v.shape[0],v.shape[1],v.shape[2]])),i.b(u.i(h,f),(function(){return"Error in pool: Either strides or dilations must be 1. "+"Got strides ".concat(h," and dilations '").concat(f,"'")}));var y,x=u.f(b.shape,t,h,f,l),k=[x.dilationHeight,x.dilationWidth];y="same"===l?function(e,t){var n=e.map((function(e,n){return e+(e-1)*(t[n]-1)})).map((function(e){return e-1})),r=n.map((function(e){return Math.floor(e/2)})),a=n.map((function(e,t){return e-r[t]}));return n.map((function(e,t){return[r[t],a[t]]}))}([x.filterHeight,x.filterWidth],k):[[0,0],[0,0]];var w=1===k[0]&&1===k[1],O=function(e,t,n){var r=n.map((function(e){return e[0]})),a=n.map((function(e){return e[1]})),i=e.concat(r,a),o=t.map((function(e,t){return(e-i[t]%e)%e})),s=a.map((function(e,t){return e+o[t]})),u=t.map((function(e,t){return[r[t],s[t]]})),c=t.map((function(e,t){return[0,o[t]]}));return[u,c]}([x.inHeight,x.inWidth],k,y),I=Object(r.a)(O,2),S=I[0],N=I[1],j=w?l:"valid",T=w?b:Object(p.a)(b,k,S),C=("avg"===n?function(){return Object(o.a)(T,t,h,j,m)}:function(){return Object(c.a)(T,t,h,j,m)})(),E=w?C:Object(s.a)(C,k,N);return g?Object(d.a)(E,[E.shape[1],E.shape[2],E.shape[3]]):E}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(12),a=n(7),i=n(6),o=n(22),s=n(9);var u=Object(s.b)({prod_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=Object(i.a)(e,"x","prod");"bool"===s.dtype&&(s=Object(o.a)(s,"int32"));var u={x:s},c={axis:t,keepDims:n};return r.a.runKernel(a.jc,u,c)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(7),i=n(6),o=n(9);var s=Object(o.b)({round_:function(e){var t={x:Object(i.a)(e,"x","round")};return r.a.runKernel(a.zc,t)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(7),i=n(6),o=n(9);var s=Object(o.b)({rsqrt_:function(e){var t={x:Object(i.a)(e,"x","rsqrt","float32")};return r.a.runKernel(a.Ac,t)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(7),i=n(6),o=n(9);var s=Object(o.b)({selu_:function(e){var t={x:Object(i.a)(e,"x","selu")};return r.a.runKernel(a.Ec,t)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(6),a=n(18),i=n(77),o=n(101),s=n(9),u=n(16);var c=Object(s.b)({separableConv2d_:function(e,t,n,s,c){var l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],d=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"NHWC",p=Object(r.a)(e,"x","separableConv2d"),f=Object(r.a)(t,"depthwiseFilter","separableConv2d"),h=Object(r.a)(n,"pointwiseFilter","separableConv2d"),m=p,v=!1;if(3===p.rank&&(v=!0,m=Object(u.a)(p,[1,p.shape[0],p.shape[1],p.shape[2]])),"NCHW"===d)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");a.b(4===m.rank,(function(){return"Error in separableConv2d: input must be rank 4, but got "+"rank ".concat(m.rank,".")})),a.b(4===f.rank,(function(){return"Error in separableConv2d: depthwise filter must be rank 4, but "+"got rank ".concat(f.rank,".")})),a.b(4===h.rank,(function(){return"Error in separableConv2d: pointwise filter must be rank 4, but "+"got rank ".concat(f.rank,".")})),a.b(1===h.shape[0],(function(){return"Error in separableConv2d: the first dimension of pointwise filter "+" must be 1, but got ".concat(h.shape[0],".")})),a.b(1===h.shape[1],(function(){return"Error in separableConv2d: the second dimension of pointwise "+"filter must be 1, but got ".concat(h.shape[1],".")}));var b=f.shape[2],g=f.shape[3];a.b(h.shape[2]===b*g,(function(){return"Error in separableConv2d: the third dimension of pointwise filter "+"must be ".concat(b*g,", ")+"but got ".concat(h.shape[2],".")}));var y=Object(o.a)(m,f,s,c,d,l),x=1,k=Object(i.a)(y,h,x,"valid",d);return v?Object(u.a)(k,[k.shape[1],k.shape[2],k.shape[3]]):k}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(7),i=n(6),o=n(9);var s=Object(o.b)({sin_:function(e){var t={x:Object(i.a)(e,"x","sin","float32")};return r.a.runKernel(a.Hc,t)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(7),i=n(6),o=n(9);var s=Object(o.b)({sinh_:function(e){var t={x:Object(i.a)(e,"x","sinh")};return r.a.runKernel(a.Ic,t)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return h}));var r=n(63),a=n(43),i=n(105),o=n(17),s=n(9),u=n(97),c=n(16),l=n(60),d=n(28),p=n(37),f=n(115);var h=Object(s.b)({irfft_:function(e){var t,n=e.shape[e.shape.length-1],s=e.size/n;if(n<=2){var h=Object(c.a)(e,[s,n]);t=Object(f.a)(h)}else{var m=[s,2*(n-1)],v=Object(c.a)(Object(u.a)(e),[s,n]),b=Object(c.a)(Object(i.a)(e),[s,n]),g=Object(l.a)(Object(p.a)(v,[0,1],[s,n-2]),1),y=Object(o.a)(Object(l.a)(Object(p.a)(b,[0,1],[s,n-2]),1),Object(d.a)(-1)),x=Object(a.a)([v,g],1),k=Object(a.a)([b,y],1),w=Object(c.a)(Object(r.a)(x,k),[m[0],m[1]]);t=Object(f.a)(w)}if(t=Object(u.a)(t),3===e.rank&&0!==e.shape[0]){var O=t,I=e.shape[0];t=Object(c.a)(t,[I,t.shape[0]/I,t.shape[1]]),O.dispose()}return t}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(6),a=n(18),i=n(62);function o(e,t,n){if(Object(a.d)(e),null!=t&&3!==t.length)throw new Error("tensor3d() requires shape to have three numbers");var o=Object(r.c)(e,n);if(3!==o.length&&1!==o.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===o.length&&null==t)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Object(i.a)(e,t,o,n)}},function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(3),a=n(12),i=n(7),o=n(6),s=n(9);var u=Object(s.b)({topk_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],s=Object(o.a)(e,"x","topk");if(0===s.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var u=s.shape[s.shape.length-1];if(t<0)throw new Error("'k' passed to topk() must be >= 0 but got ".concat(t));if(t>u)throw new Error("'k' passed to topk() must be <= the last dimension (".concat(u,") ")+"but got ".concat(t));var c={x:s},l={k:t,sorted:n},d=a.a.runKernel(i.gd,c,l),p=Object(r.a)(d,2),f=p[0],h=p[1];return{values:f,indices:h}}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(3),a=n(12),i=n(7),o=n(6),s=n(18),u=n(9);var c=Object(u.b)({unique_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Object(o.a)(e,"x","unique","string_or_numeric");Object(s.b)(n.rank>0,(function(){return"The input tensor must be at least 1D"}));var u={x:n},c={axis:t},l=a.a.runKernel(i.jd,u,c),d=Object(r.a)(l,2),p=d[0],f=d[1];return{values:p,indices:f}}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(59);function a(e,t){for(var n=[],a=0;a<t.length;a++)t[a]&&n.push(a);for(var i=Object(r.a)(e,"int32"),o=Object(r.a)([n.length,e.length],"int32"),s=0;s<n.length;s++){var u=i.indexToLoc(n[s]),c=s*e.length;o.values.set(u,c)}return o.toTensor()}},function(e,t,n){"use strict";function r(e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";function r(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";function r(e){if(Array.isArray(e))return e}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";function r(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return h})),n.d(t,"b",(function(){return v}));var r=n(14),a=n(1),i=n.n(a),o=n(2),s=n(4),u=n(8),c=(n(145),n(30)),l=n(42),d=n(51);function p(){if(!Object(c.b)().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var e="undefined"===typeof window?self:window,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function f(e){var t=e.result;t.createObjectStore("models_store",{keyPath:"modelPath"}),t.createObjectStore("model_info_store",{keyPath:"modelPath"})}var h=function(){function e(t){if(Object(o.a)(this,e),this.indexedDB=p(),null==t||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}return Object(s.a)(e,[{key:"save",value:function(){var e=Object(u.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=2;break}throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");case 2:return e.abrupt("return",this.databaseAction(this.modelPath,t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=Object(u.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.databaseAction(this.modelPath));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"databaseAction",value:function(e,t){var n=this;return new Promise((function(e,r){var a=n.indexedDB.open("tensorflowjs",1);a.onupgradeneeded=function(){return f(a)},a.onsuccess=function(){var i=a.result;if(null==t){var o=i.transaction("models_store","readonly"),s=o.objectStore("models_store").get(n.modelPath);s.onsuccess=function(){if(null==s.result)return i.close(),r(new Error("Cannot find model with path '".concat(n.modelPath,"' ")+"in IndexedDB."));e(s.result.modelArtifacts)},s.onerror=function(e){return i.close(),r(s.error)},o.oncomplete=function(){return i.close()}}else{var u,c=Object(l.i)(t),d=i.transaction("model_info_store","readwrite"),p=d.objectStore("model_info_store"),f=p.put({modelPath:n.modelPath,modelArtifactsInfo:c});f.onsuccess=function(){var a=(u=i.transaction("models_store","readwrite")).objectStore("models_store").put({modelPath:n.modelPath,modelArtifacts:t,modelArtifactsInfo:c});a.onsuccess=function(){return e({modelArtifactsInfo:c})},a.onerror=function(e){var t=(p=d.objectStore("model_info_store")).delete(n.modelPath);t.onsuccess=function(){return i.close(),r(a.error)},t.onerror=function(e){return i.close(),r(a.error)}}},f.onerror=function(e){return i.close(),r(f.error)},d.oncomplete=function(){null==u?i.close():u.oncomplete=function(){return i.close()}}}},a.onerror=function(e){return r(a.error)}}))}}]),e}();h.URL_SCHEME="indexeddb://";var m=function(e){return Object(c.b)().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(h.URL_SCHEME)?(t=e.slice(h.URL_SCHEME.length),new h(t)):null;var t};d.a.registerSaveRouter(m),d.a.registerLoadRouter(m);var v=function(){function e(){Object(o.a)(this,e),this.indexedDB=p()}return Object(s.a)(e,[{key:"listModels",value:function(){var e=Object(u.a)(i.a.mark((function e(){var t=this;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var a=t.indexedDB.open("tensorflowjs",1);a.onupgradeneeded=function(){return f(a)},a.onsuccess=function(){var t=a.result,i=t.transaction("model_info_store","readonly"),o=i.objectStore("model_info_store").getAll();o.onsuccess=function(){var t,n={},a=Object(r.a)(o.result);try{for(a.s();!(t=a.n()).done;){var i=t.value;n[i.modelPath]=i.modelArtifactsInfo}}catch(s){a.e(s)}finally{a.f()}e(n)},o.onerror=function(e){return t.close(),n(o.error)},i.oncomplete=function(){return t.close()}},a.onerror=function(e){return n(a.error)}})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"removeModel",value:function(){var e=Object(u.a)(i.a.mark((function e(t){var n=this;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=(r=t).startsWith(h.URL_SCHEME)?r.slice(h.URL_SCHEME.length):r,e.abrupt("return",new Promise((function(e,r){var a=n.indexedDB.open("tensorflowjs",1);a.onupgradeneeded=function(){return f(a)},a.onsuccess=function(){var n,i=a.result,o=i.transaction("model_info_store","readwrite"),s=o.objectStore("model_info_store"),u=s.get(t);u.onsuccess=function(){if(null==u.result)return i.close(),r(new Error("Cannot find model with path '".concat(t,"' ")+"in IndexedDB."));var a=s.delete(t),o=function(){var a=(n=i.transaction("models_store","readwrite")).objectStore("models_store").delete(t);a.onsuccess=function(){return e(u.result.modelArtifactsInfo)},a.onerror=function(e){return r(u.error)}};a.onsuccess=o,a.onerror=function(e){return o(),i.close(),r(u.error)}},u.onerror=function(e){return i.close(),r(u.error)},o.oncomplete=function(){null==n?i.close():n.oncomplete=function(){return i.close()}}},a.onerror=function(e){return r(a.error)}})));case 2:case"end":return e.stop()}var r}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return k})),n.d(t,"b",(function(){return O}));var r=n(1),a=n.n(r),i=n(8),o=n(2),s=n(4),u=(n(145),n(30)),c=n(18),l=n(42),d=n(51),p="tensorflowjs_models",f="info",h="model_topology",m="weight_specs",v="weight_data",b="model_metadata";function g(e){return{info:[p,e,f].join("/"),topology:[p,e,h].join("/"),weightSpecs:[p,e,m].join("/"),weightData:[p,e,v].join("/"),modelMetadata:[p,e,b].join("/")}}function y(e){for(var t=0,n=Object.values(e);t<n.length;t++){var r=n[t];window.localStorage.removeItem(r)}}function x(e){var t=e.split("/");if(t.length<3)throw new Error("Invalid key format: ".concat(e));return t.slice(1,t.length-1).join("/")}var k=function(){function e(t){if(Object(o.a)(this,e),!Object(u.b)().getBool("IS_BROWSER")||"undefined"===typeof window||"undefined"===typeof window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==t||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=g(this.modelPath)}return Object(s.a)(e,[{key:"save",value:function(){var e=Object(i.a)(a.a.mark((function e(t){var n,r,i,o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=4;break}throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");case 4:return n=JSON.stringify(t.modelTopology),r=JSON.stringify(t.weightSpecs),i=Object(l.i)(t),e.prev=7,this.LS.setItem(this.keys.info,JSON.stringify(i)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,Object(l.a)(t.weightData)),o={format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,signature:null!=t.signature?t.signature:void 0,userDefinedMetadata:null!=t.userDefinedMetadata?t.userDefinedMetadata:void 0,modelInitializer:null!=t.modelInitializer?t.modelInitializer:void 0,trainingConfig:null!=t.trainingConfig?t.trainingConfig:void 0},this.LS.setItem(this.keys.modelMetadata,JSON.stringify(o)),e.abrupt("return",{modelArtifactsInfo:i});case 17:throw e.prev=17,e.t0=e.catch(7),y(this.keys),new Error("Failed to save model '".concat(this.modelPath,"' to local storage: ")+"size quota being exceeded is a possible cause of this failure: "+"modelTopologyBytes=".concat(i.modelTopologyBytes,", ")+"weightSpecsBytes=".concat(i.weightSpecsBytes,", ")+"weightDataBytes=".concat(i.weightDataBytes,"."));case 21:case"end":return e.stop()}}),e,this,[[7,17]])})));return function(t){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=Object(i.a)(a.a.mark((function e(){var t,n,r,i,o,s,u;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(t=JSON.parse(this.LS.getItem(this.keys.info)))){e.next=3;break}throw new Error("In local storage, there is no model with name '".concat(this.modelPath,"'"));case 3:if("JSON"===t.modelTopologyType){e.next=5;break}throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");case 5:if(n={},null!=(r=JSON.parse(this.LS.getItem(this.keys.topology)))){e.next=9;break}throw new Error("In local storage, the topology of model '".concat(this.modelPath,"' ")+"is missing.");case 9:if(n.modelTopology=r,null!=(i=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))){e.next=13;break}throw new Error("In local storage, the weight specs of model '".concat(this.modelPath,"' ")+"are missing.");case 13:if(n.weightSpecs=i,null!=(o=this.LS.getItem(this.keys.modelMetadata))&&(s=JSON.parse(o),n.format=s.format,n.generatedBy=s.generatedBy,n.convertedBy=s.convertedBy,null!=s.signature&&(n.signature=s.signature),null!=s.userDefinedMetadata&&(n.userDefinedMetadata=s.userDefinedMetadata),null!=s.modelInitializer&&(n.modelInitializer=s.modelInitializer),null!=s.trainingConfig&&(n.trainingConfig=s.trainingConfig)),null!=(u=this.LS.getItem(this.keys.weightData))){e.next=19;break}throw new Error("In local storage, the binary weight values of model "+"'".concat(this.modelPath,"' are missing."));case 19:return n.weightData=Object(l.b)(u),e.abrupt("return",n);case 21:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}();k.URL_SCHEME="localstorage://";var w=function(e){return Object(u.b)().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(k.URL_SCHEME)?(t=e.slice(k.URL_SCHEME.length),new k(t)):null;var t};d.a.registerSaveRouter(w),d.a.registerLoadRouter(w);var O=function(){function e(){Object(o.a)(this,e),Object(c.b)(Object(u.b)().getBool("IS_BROWSER"),(function(){return"Current environment is not a web browser"})),Object(c.b)("undefined"===typeof window||"undefined"!==typeof window.localStorage,(function(){return"Current browser does not appear to support localStorage"})),this.LS=window.localStorage}return Object(s.a)(e,[{key:"listModels",value:function(){var e=Object(i.a)(a.a.mark((function e(){var t,n,r,i,o,s;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t={},n=p+"/",r="/"+f,i=0;i<this.LS.length;++i)(o=this.LS.key(i)).startsWith(n)&&o.endsWith(r)&&(s=x(o),t[s]=JSON.parse(this.LS.getItem(o)));return e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"removeModel",value:function(){var e=Object(i.a)(a.a.mark((function e(t){var n,r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=(a=t).startsWith(k.URL_SCHEME)?a.slice(k.URL_SCHEME.length):a,n=g(t),null!=this.LS.getItem(n.info)){e.next=4;break}throw new Error("Cannot find model at path '".concat(t,"'"));case 4:return r=JSON.parse(this.LS.getItem(n.info)),y(n),e.abrupt("return",r);case 7:case"end":return e.stop()}var a}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(12),a=n(7),i=n(18),o=n(9),s=n(16);var u=Object(o.b)({conv3DBackpropInput_:function(e,t,n,o,u){i.b(e.length===t.rank,(function(){return"Length of inShape "+"(".concat(e.length,") and rank of dy (").concat(t.rank,") must match")}));var c=e,l=t,d=!1;4===t.rank&&(d=!0,l=Object(s.a)(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]),c=[1,e[0],e[1],e[2],e[3]]);var p=c[4],f=l.shape[4];i.b(5===c.length,(function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+"".concat(c.length,".")})),i.b(5===l.rank,(function(){return"Error in conv3dDerInput: dy must be rank 5, but got "+"rank ".concat(l.rank)})),i.b(5===n.rank,(function(){return"Error in conv3dDerInput: filter must be rank 5, but got "+"rank ".concat(n.rank)})),i.b(p===n.shape[3],(function(){return"Error in conv3dDerInput: depth of input (".concat(p,") must ")+"match input depth for filter ".concat(n.shape[3],".")})),i.b(f===n.shape[4],(function(){return"Error in conv3dDerInput: depth of output (".concat(f,") must ")+"match output depth for filter ".concat(n.shape[4],".")}));var h={dy:l,filter:n},m={pad:u,strides:o,inputShape:c},v=r.a.runKernel(a.I,h,m);return d?Object(s.a)(v,[v.shape[1],v.shape[2],v.shape[3],v.shape[4]]):v}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var r=n(117),a=n(12),i=n(7),o=n(6),s=n(18),u=n(9),c=n(16);var l=Object(u.b)({resizeNearestNeighbor_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],u=arguments.length>3&&void 0!==arguments[3]&&arguments[3],l=Object(o.a)(e,"images","resizeNearestNeighbor");s.b(3===l.rank||4===l.rank,(function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got "+"rank ".concat(l.rank,".")})),s.b(2===t.length,(function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+"".concat(t,".")})),s.b("float32"===l.dtype||"int32"===l.dtype,(function(){return"`images` must have `int32` or `float32` as dtype"})),s.b(!1===u||!1===n,(function(){return"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."}));var d=l,p=!1;3===l.rank&&(p=!0,d=Object(c.a)(l,[1,l.shape[0],l.shape[1],l.shape[2]])),Object(r.a)(t);var f={images:d},h={alignCorners:n,halfPixelCenters:u,size:t},m=a.a.runKernel(i.vc,f,h);return p?Object(c.a)(m,[m.shape[1],m.shape[2],m.shape[3]]):m}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var r=n(117),a=n(12),i=n(7),o=n(6),s=n(18),u=n(9),c=n(16);var l=Object(u.b)({resizeBilinear_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],u=arguments.length>3&&void 0!==arguments[3]&&arguments[3],l=Object(o.a)(e,"images","resizeBilinear");s.b(3===l.rank||4===l.rank,(function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got "+"rank ".concat(l.rank,".")})),s.b(2===t.length,(function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+"".concat(t,".")})),s.b(!1===u||!1===n,(function(){return"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."}));var d=l,p=!1;3===l.rank&&(p=!0,d=Object(c.a)(l,[1,l.shape[0],l.shape[1],l.shape[2]])),Object(r.a)(t);var f={images:d},h={alignCorners:n,halfPixelCenters:u,size:t},m=a.a.runKernel(i.tc,f,h);return p?Object(c.a)(m,[m.shape[1],m.shape[2],m.shape[3]]):m}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(7),i=n(9),o=n(16);var s=Object(i.b)({depthwiseConv2dNativeBackpropInput_:function(e,t,n,i,s){var u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],c=arguments.length>6?arguments[6]:void 0,l=t,d=!1;3===t.rank&&(d=!0,l=Object(o.a)(t,[1,t.shape[0],t.shape[1],t.shape[2]]));var p={dy:l,filter:n},f={strides:i,pad:s,dimRoundingMode:c,dilations:u,inputShape:e},h=r.a.runKernel(a.S,p,f);return d?Object(o.a)(h,[h.shape[1],h.shape[2],h.shape[3]]):h}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(7),i=n(9),o=n(16);var s=Object(i.b)({depthwiseConv2dNativeBackpropFilter_:function(e,t,n,i,s){var u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],c=arguments.length>6?arguments[6]:void 0,l=e;3===e.rank&&(l=Object(o.a)(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var d=t;3===d.rank&&(d=Object(o.a)(t,[1,t.shape[0],t.shape[1],t.shape[2]]));var p={x:l,dy:d},f={strides:i,pad:s,dimRoundingMode:c,dilations:u,filterShape:n};return r.a.runKernel(a.R,p,f)}})},function(e,t,n){var r=n(276),a=n(277),i=n(278),o=n(279),s=n(280),u=n(281),c=n(282);c.alea=r,c.xor128=a,c.xorwow=i,c.xorshift7=o,c.xor4096=s,c.tychei=u,e.exports=c},function(e,t,n){var r=n(267),a=n(268),i=n(269),o=n(270),s=n(271),u=n(272),c=n(273);c.alea=r,c.xor128=a,c.xorwow=i,c.xorshift7=o,c.xor4096=s,c.tychei=u,e.exports=c},function(e,t){e.exports=r;var n=null;try{n=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(N){}function r(e,t,n){this.low=0|e,this.high=0|t,this.unsigned=!!n}function a(e){return!0===(e&&e.__isLong__)}r.prototype.__isLong__,Object.defineProperty(r.prototype,"__isLong__",{value:!0}),r.isLong=a;var i={},o={};function s(e,t){var n,r,a;return t?(a=0<=(e>>>=0)&&e<256)&&(r=o[e])?r:(n=c(e,(0|e)<0?-1:0,!0),a&&(o[e]=n),n):(a=-128<=(e|=0)&&e<128)&&(r=i[e])?r:(n=c(e,e<0?-1:0,!1),a&&(i[e]=n),n)}function u(e,t){if(isNaN(e))return t?g:b;if(t){if(e<0)return g;if(e>=h)return O}else{if(e<=-m)return I;if(e+1>=m)return w}return e<0?u(-e,t).neg():c(e%f|0,e/f|0,t)}function c(e,t,n){return new r(e,t,n)}r.fromInt=s,r.fromNumber=u,r.fromBits=c;var l=Math.pow;function d(e,t,n){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return b;if("number"===typeof t?(n=t,t=!1):t=!!t,(n=n||10)<2||36<n)throw RangeError("radix");var r;if((r=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return d(e.substring(1),t,n).neg();for(var a=u(l(n,8)),i=b,o=0;o<e.length;o+=8){var s=Math.min(8,e.length-o),c=parseInt(e.substring(o,o+s),n);if(s<8){var p=u(l(n,s));i=i.mul(p).add(u(c))}else i=(i=i.mul(a)).add(u(c))}return i.unsigned=t,i}function p(e,t){return"number"===typeof e?u(e,t):"string"===typeof e?d(e,t):c(e.low,e.high,"boolean"===typeof t?t:e.unsigned)}r.fromString=d,r.fromValue=p;var f=4294967296,h=f*f,m=h/2,v=s(1<<24),b=s(0);r.ZERO=b;var g=s(0,!0);r.UZERO=g;var y=s(1);r.ONE=y;var x=s(1,!0);r.UONE=x;var k=s(-1);r.NEG_ONE=k;var w=c(-1,2147483647,!1);r.MAX_VALUE=w;var O=c(-1,-1,!0);r.MAX_UNSIGNED_VALUE=O;var I=c(0,-2147483648,!1);r.MIN_VALUE=I;var S=r.prototype;S.toInt=function(){return this.unsigned?this.low>>>0:this.low},S.toNumber=function(){return this.unsigned?(this.high>>>0)*f+(this.low>>>0):this.high*f+(this.low>>>0)},S.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(I)){var t=u(e),n=this.div(t),r=n.mul(t).sub(this);return n.toString(e)+r.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var a=u(l(e,6),this.unsigned),i=this,o="";;){var s=i.div(a),c=(i.sub(s.mul(a)).toInt()>>>0).toString(e);if((i=s).isZero())return c+o;for(;c.length<6;)c="0"+c;o=""+c+o}},S.getHighBits=function(){return this.high},S.getHighBitsUnsigned=function(){return this.high>>>0},S.getLowBits=function(){return this.low},S.getLowBitsUnsigned=function(){return this.low>>>0},S.getNumBitsAbs=function(){if(this.isNegative())return this.eq(I)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},S.isZero=function(){return 0===this.high&&0===this.low},S.eqz=S.isZero,S.isNegative=function(){return!this.unsigned&&this.high<0},S.isPositive=function(){return this.unsigned||this.high>=0},S.isOdd=function(){return 1===(1&this.low)},S.isEven=function(){return 0===(1&this.low)},S.equals=function(e){return a(e)||(e=p(e)),(this.unsigned===e.unsigned||this.high>>>31!==1||e.high>>>31!==1)&&(this.high===e.high&&this.low===e.low)},S.eq=S.equals,S.notEquals=function(e){return!this.eq(e)},S.neq=S.notEquals,S.ne=S.notEquals,S.lessThan=function(e){return this.comp(e)<0},S.lt=S.lessThan,S.lessThanOrEqual=function(e){return this.comp(e)<=0},S.lte=S.lessThanOrEqual,S.le=S.lessThanOrEqual,S.greaterThan=function(e){return this.comp(e)>0},S.gt=S.greaterThan,S.greaterThanOrEqual=function(e){return this.comp(e)>=0},S.gte=S.greaterThanOrEqual,S.ge=S.greaterThanOrEqual,S.compare=function(e){if(a(e)||(e=p(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},S.comp=S.compare,S.negate=function(){return!this.unsigned&&this.eq(I)?I:this.not().add(y)},S.neg=S.negate,S.add=function(e){a(e)||(e=p(e));var t=this.high>>>16,n=65535&this.high,r=this.low>>>16,i=65535&this.low,o=e.high>>>16,s=65535&e.high,u=e.low>>>16,l=0,d=0,f=0,h=0;return f+=(h+=i+(65535&e.low))>>>16,d+=(f+=r+u)>>>16,l+=(d+=n+s)>>>16,l+=t+o,c((f&=65535)<<16|(h&=65535),(l&=65535)<<16|(d&=65535),this.unsigned)},S.subtract=function(e){return a(e)||(e=p(e)),this.add(e.neg())},S.sub=S.subtract,S.multiply=function(e){if(this.isZero())return b;if(a(e)||(e=p(e)),n)return c(n.mul(this.low,this.high,e.low,e.high),n.get_high(),this.unsigned);if(e.isZero())return b;if(this.eq(I))return e.isOdd()?I:b;if(e.eq(I))return this.isOdd()?I:b;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(v)&&e.lt(v))return u(this.toNumber()*e.toNumber(),this.unsigned);var t=this.high>>>16,r=65535&this.high,i=this.low>>>16,o=65535&this.low,s=e.high>>>16,l=65535&e.high,d=e.low>>>16,f=65535&e.low,h=0,m=0,g=0,y=0;return g+=(y+=o*f)>>>16,m+=(g+=i*f)>>>16,g&=65535,m+=(g+=o*d)>>>16,h+=(m+=r*f)>>>16,m&=65535,h+=(m+=i*d)>>>16,m&=65535,h+=(m+=o*l)>>>16,h+=t*f+r*d+i*l+o*s,c((g&=65535)<<16|(y&=65535),(h&=65535)<<16|(m&=65535),this.unsigned)},S.mul=S.multiply,S.divide=function(e){if(a(e)||(e=p(e)),e.isZero())throw Error("division by zero");var t,r,i;if(n)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?c((this.unsigned?n.div_u:n.div_s)(this.low,this.high,e.low,e.high),n.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?g:b;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return g;if(e.gt(this.shru(1)))return x;i=g}else{if(this.eq(I))return e.eq(y)||e.eq(k)?I:e.eq(I)?y:(t=this.shr(1).div(e).shl(1)).eq(b)?e.isNegative()?y:k:(r=this.sub(e.mul(t)),i=t.add(r.div(e)));if(e.eq(I))return this.unsigned?g:b;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=b}for(r=this;r.gte(e);){t=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));for(var o=Math.ceil(Math.log(t)/Math.LN2),s=o<=48?1:l(2,o-48),d=u(t),f=d.mul(e);f.isNegative()||f.gt(r);)f=(d=u(t-=s,this.unsigned)).mul(e);d.isZero()&&(d=y),i=i.add(d),r=r.sub(f)}return i},S.div=S.divide,S.modulo=function(e){return a(e)||(e=p(e)),n?c((this.unsigned?n.rem_u:n.rem_s)(this.low,this.high,e.low,e.high),n.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},S.mod=S.modulo,S.rem=S.modulo,S.not=function(){return c(~this.low,~this.high,this.unsigned)},S.and=function(e){return a(e)||(e=p(e)),c(this.low&e.low,this.high&e.high,this.unsigned)},S.or=function(e){return a(e)||(e=p(e)),c(this.low|e.low,this.high|e.high,this.unsigned)},S.xor=function(e){return a(e)||(e=p(e)),c(this.low^e.low,this.high^e.high,this.unsigned)},S.shiftLeft=function(e){return a(e)&&(e=e.toInt()),0===(e&=63)?this:e<32?c(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):c(0,this.low<<e-32,this.unsigned)},S.shl=S.shiftLeft,S.shiftRight=function(e){return a(e)&&(e=e.toInt()),0===(e&=63)?this:e<32?c(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):c(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},S.shr=S.shiftRight,S.shiftRightUnsigned=function(e){if(a(e)&&(e=e.toInt()),0===(e&=63))return this;var t=this.high;return e<32?c(this.low>>>e|t<<32-e,t>>>e,this.unsigned):c(32===e?t:t>>>e-32,0,this.unsigned)},S.shru=S.shiftRightUnsigned,S.shr_u=S.shiftRightUnsigned,S.toSigned=function(){return this.unsigned?c(this.low,this.high,!1):this},S.toUnsigned=function(){return this.unsigned?this:c(this.low,this.high,!0)},S.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},S.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},S.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},r.fromBytes=function(e,t,n){return n?r.fromBytesLE(e,t):r.fromBytesBE(e,t)},r.fromBytesLE=function(e,t){return new r(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},r.fromBytesBE=function(e,t){return new r(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)}},function(e,t,n){"use strict";function r(e){if(null==e)throw new TypeError("Cannot destructure undefined")}n.d(t,"a",(function(){return r}))},,function(e,t,n){"use strict";var r=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable;function o(e){if(null===e||void 0===e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach((function(e){r[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(a){return!1}}()?Object.assign:function(e,t){for(var n,s,u=o(e),c=1;c<arguments.length;c++){for(var l in n=Object(arguments[c]))a.call(n,l)&&(u[l]=n[l]);if(r){s=r(n);for(var d=0;d<s.length;d++)i.call(n,s[d])&&(u[s[d]]=n[s[d]])}}return u}},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(7),i=n(6),o=n(9);var s=Object(o.b)({acos_:function(e){var t={x:Object(i.a)(e,"x","acos")};return r.a.runKernel(a.b,t)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(7),i=n(6),o=n(9);var s=Object(o.b)({acosh_:function(e){var t={x:Object(i.a)(e,"x","acosh")};return r.a.runKernel(a.c,t)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(7),i=n(6),o=n(9);var s=Object(o.b)({asin_:function(e){var t={x:Object(i.a)(e,"x","asin")};return r.a.runKernel(a.j,t)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(7),i=n(6),o=n(9);var s=Object(o.b)({asinh_:function(e){var t={x:Object(i.a)(e,"x","asinh")};return r.a.runKernel(a.k,t)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(7),i=n(6),o=n(9);var s=Object(o.b)({atan_:function(e){var t={x:Object(i.a)(e,"x","atan")};return r.a.runKernel(a.l,t)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(7),i=n(6),o=n(9);var s=Object(o.b)({atanh_:function(e){var t={x:Object(i.a)(e,"x","atanh")};return r.a.runKernel(a.n,t)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(7),i=n(6),o=n(9);var s=Object(o.b)({ceil_:function(e){var t={x:Object(i.a)(e,"x","ceil","float32")};return r.a.runKernel(a.y,t)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(12),a=n(7),i=n(6),o=n(18),s=n(88),u=n(9);var c=Object(u.b)({clipByValue_:function(e,t,n){var u=Object(i.a)(e,"x","clipByValue");if(o.b(t<=n,(function(){return"Error in clip: min (".concat(t,") must be ")+"less than or equal to max (".concat(n,").")})),t===n)return Object(s.a)(u.shape,t,u.dtype);var c={x:u},l={clipValueMin:t,clipValueMax:n};return r.a.runKernel(a.z,c,l)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(12),a=n(7),i=n(6),o=n(18),s=n(22),u=n(9);var c=Object(u.b)({erf_:function(e){var t=Object(i.a)(e,"x","erf");o.b("int32"===t.dtype||"float32"===t.dtype,(function(){return"Input dtype must be `int32` or `float32`."})),"int32"===t.dtype&&(t=Object(s.a)(t,"float32"));var n={x:t};return r.a.runKernel(a.bb,n)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(7),i=n(6),o=n(9);var s=Object(o.b)({expm1_:function(e){var t={x:Object(i.a)(e,"x","expm1")};return r.a.runKernel(a.eb,t)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(7),i=n(6),o=n(9);var s=Object(o.b)({isFinite_:function(e){var t={x:Object(i.a)(e,"x","isFinite")};return r.a.runKernel(a.vb,t)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(7),i=n(6),o=n(9);var s=Object(o.b)({isInf_:function(e){var t={x:Object(i.a)(e,"x","isInf")};return r.a.runKernel(a.wb,t)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(7),i=n(6),o=n(9);var s=Object(o.b)({isNaN_:function(e){var t={x:Object(i.a)(e,"x","isNaN")};return r.a.runKernel(a.xb,t)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var r=n(45),a=n(6),i=n(17),o=n(38),s=n(9),u=n(80),c=n(170);var l=Object(s.b)({logSigmoid_:function(e){var t=Object(a.a)(e,"x","logSigmoid");return Object(r.a)((function(e){return{value:Object(o.a)(Object(c.a)(Object(o.a)(e))),gradFunc:function(t){return Object(i.a)(t,Object(u.a)(Object(o.a)(e)))}}}))(t)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return h}));var r=n(3),a=n(45),i=n(6),o=n(22),s=n(50),u=n(84),c=n(81),l=n(17),d=n(9),p=n(24),f=n(27);var h=Object(d.b)({logSoftmax_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=Object(i.a)(e,"logits","logSoftmax");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(n.rank," and axis was ").concat(t));var d=Object(a.a)((function(e,n){var a=Object(c.a)(e,t,!0),i=Object(p.a)(e,a),d=Object(p.a)(Object(o.a)(i,"float32"),Object(u.a)(Object(f.a)(Object(s.a)(i),t,!0)));n([d]);return{value:d,gradFunc:function(e,n){var a=Object(r.a)(n,1)[0],i=Object(s.a)(a);return Object(p.a)(e,Object(l.a)(Object(f.a)(e,t,!0),i))}}}));return d(n)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(7),i=n(6),o=n(9);var s=Object(o.b)({onesLike_:function(e){var t={x:Object(i.a)(e,"x","onesLike")};return r.a.runKernel(a.ec,t)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(7),i=n(6),o=n(9);var s=Object(o.b)({reciprocal_:function(e){var t={x:Object(i.a)(e,"x","reciprocal")};return r.a.runKernel(a.pc,t)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(7),i=n(6),o=n(9);var s=Object(o.b)({sign_:function(e){var t={x:Object(i.a)(e,"x","sign")};return r.a.runKernel(a.Gc,t)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(7),i=n(6),o=n(9);var s=Object(o.b)({softmax_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=Object(i.a)(e,"logits","softmax","float32");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(n.rank," and dim was ").concat(t));var o={logits:n},s={dim:t};return r.a.runKernel(a.Kc,o,s)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(7),i=n(6),o=n(9);var s=Object(o.b)({stridedSlice_:function(e,t,n,o){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,d=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,p=Object(i.a)(e,"x","stridedSlice","string_or_numeric"),f={x:p},h={begin:t,end:n,strides:o,beginMask:s,endMask:u,ellipsisMask:c,newAxisMask:l,shrinkAxisMask:d};return r.a.runKernel(a.Xc,f,h)}})},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(12),a=n(7),i=n(6),o=n(9);var s=Object(o.b)({tan_:function(e){var t={x:Object(i.a)(e,"x","tan","float32")};return r.a.runKernel(a.dd,t)}})},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return a}));var r="undefined"!==typeof requestAnimationFrame?requestAnimationFrame:"undefined"!==typeof e?e:function(e){return e()};function a(){return new Promise((function(e){return r((function(){return e()}))}))}}).call(this,n(227).setImmediate)},function(e,t,n){(function(e){var r="undefined"!==typeof e&&e||"undefined"!==typeof self&&self||window,a=Function.prototype.apply;function i(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new i(a.call(setTimeout,r,arguments),clearTimeout)},t.setInterval=function(){return new i(a.call(setInterval,r,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},i.prototype.unref=i.prototype.ref=function(){},i.prototype.close=function(){this._clearFn.call(r,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout((function(){e._onTimeout&&e._onTimeout()}),t))},n(275),t.setImmediate="undefined"!==typeof self&&self.setImmediate||"undefined"!==typeof e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!==typeof self&&self.clearImmediate||"undefined"!==typeof e&&e.clearImmediate||this&&this.clearImmediate}).call(this,n(143))},,function(e,t,n){"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE){0;try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}}(),e.exports=n(256)},function(e,t,n){"use strict";n.r(t),n.d(t,"json",(function(){return r}));var r=[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]},function(e,t,n){"use strict";n.r(t),n.d(t,"json",(function(){return r}));var r=[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Prod",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axes",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsNan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]},function(e,t,n){"use strict";n.r(t),n.d(t,"json",(function(){return r}));var r=[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcatV2",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListLength",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}]},{tfOpName:"TensorListResize",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"size",type:"number"}]}]},function(e,t,n){"use strict";n.r(t),n.d(t,"json",(function(){return r}));var r=[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}]},function(e,t,n){"use strict";n.r(t),n.d(t,"json",(function(){return r}));var r=[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomStandardNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}]},function(e,t,n){"use strict";n.r(t),n.d(t,"json",(function(){return r}));var r=[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]},function(e,t,n){"use strict";n.r(t),n.d(t,"json",(function(){return r}));var r=[{tfOpName:"LowerBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"UpperBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}]},function(e,t,n){"use strict";n.r(t),n.d(t,"json",(function(){return r}));var r=[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}]},function(e,t,n){"use strict";n.r(t),n.d(t,"json",(function(){return r}));var r=[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableSize",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"LookupTableSizeV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]}]},function(e,t,n){"use strict";n.r(t),n.d(t,"json",(function(){return r}));var r=[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]},{tfOpName:"ImageProjectiveTransformV3",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"transforms",type:"tensor"},{start:2,name:"outputShape",type:"number[]"},{start:3,name:"fillValue",type:"number"}],attrs:[{tfName:"interpolation",name:"interpolation",type:"string"},{tfName:"fill_mode",name:"fillMode",type:"string"}]}]},function(e,t,n){"use strict";n.r(t),n.d(t,"json",(function(){return r}));var r=[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]},function(e,t,n){"use strict";n.r(t),n.d(t,"json",(function(){return r}));var r=[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Einsum",category:"matrices",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"equation",name:"equation",type:"string"},{tfName:"N",name:"n",type:"number",defaultValue:2},{tfName:"T",name:"dtype",type:"dtype"}]}]},function(e,t,n){"use strict";n.r(t),n.d(t,"json",(function(){return r}));var r=[{tfOpName:"EuclideanNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",defaultValue:!1}]},{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"SparseToDense",category:"normalization",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!0,notSupported:!0}]}]},function(e,t,n){"use strict";n.r(t),n.d(t,"json",(function(){return r}));var r=[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Cumprod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}]},function(e,t,n){"use strict";n.r(t),n.d(t,"json",(function(){return r}));var r=[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]}]},function(e,t,n){"use strict";n.r(t),n.d(t,"json",(function(){return r}));var r=[{tfOpName:"SparseFillEmptyRows",category:"sparse",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"denseShape",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}]},{tfOpName:"SparseReshape",category:"sparse",inputs:[{start:0,name:"inputIndices",type:"tensor"},{start:1,name:"inputShape",type:"tensor"},{start:2,name:"newShape",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SparseSegmentMean",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]},{tfOpName:"SparseSegmentSum",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]}]},function(e,t,n){"use strict";n.r(t),n.d(t,"json",(function(){return r}));var r=[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}]},function(e,t,n){"use strict";n.r(t),n.d(t,"json",(function(){return r}));var r=[{tfOpName:"StringNGrams",category:"string",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"dataSplits",type:"tensor"}],attrs:[{tfName:"separator",name:"separator",type:"string"},{tfName:"ngram_widths",name:"nGramWidths",type:"number[]"},{tfName:"left_pad",name:"leftPad",type:"string"},{tfName:"right_pad",name:"rightPad",type:"string"},{tfName:"pad_width",name:"padWidth",type:"number"},{tfName:"preserve_short_sequences",name:"preserveShortSequences",type:"bool"}],outputs:["ngrams","ngrams_splits"]},{tfOpName:"StringSplit",category:"string",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"delimiter",type:"tensor"}],attrs:[{tfName:"skip_empty",name:"skipEmpty",type:"bool"}],outputs:["indices","values","shape"]},{tfOpName:"StringToHashBucketFast",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"num_buckets",name:"numBuckets",type:"number"}]}]},function(e,t,n){"use strict";n.r(t),n.d(t,"json",(function(){return r}));var r=[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]},{tfOpName:"BroadcastArgs",category:"transformation",inputs:[{start:0,name:"s0",type:"tensor"},{start:1,name:"s1",type:"tensor"}],attrs:[]}]},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return f}));var r=n(1),a=n.n(r),i=n(8),o=n(2),s=n(4),u=n(10),c=n(11),l=n(0),d=n(55),p=n(250),f=function(e){Object(u.a)(n,e);var t=Object(c.a)(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"decodeUTF8",value:function(){return new h(this)}}]),n}(d.a),h=function(e){Object(u.a)(n,e);var t=Object(c.a)(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this)).upstream=e,r.impl=new m(e),r}return Object(s.a)(n,[{key:"summary",value:function(){return this.impl.summary()}},{key:"next",value:function(){var e=Object(i.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.impl.next());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(p.a),m=function(t){Object(u.a)(d,t);var r=Object(c.a)(d);function d(e){var t;if(Object(o.a)(this,d),(t=r.call(this)).upstream=e,Object(l.be)().get("IS_BROWSER"))t.decoder=new TextDecoder("utf-8");else{var a=n(285).StringDecoder;t.decoder=new a("utf8")}return t}return Object(s.a)(d,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Utf8")}},{key:"pump",value:function(){var t=Object(i.a)(a.a.mark((function t(){var n,r,i;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.upstream.next();case 2:if(!(n=t.sent).done){t.next=7;break}return t.abrupt("return",!1);case 7:r=n.value;case 8:return i=Object(l.be)().get("IS_BROWSER")?this.decoder.decode(r,{stream:!0}):this.decoder.write(e.from(r.buffer)),this.outputQueue.push(i),t.abrupt("return",!0);case 11:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()}]),d}(d.b)}).call(this,n(152).Buffer)},function(e,t,n){"use strict";n.d(t,"a",(function(){return p}));var r=n(14),a=n(1),i=n.n(a),o=n(8),s=n(2),u=n(4),c=n(10),l=n(11),d=n(55),p=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(u.a)(n,[{key:"split",value:function(e){return new f(this,e)}}]),n}(d.a),f=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(e,r){var a;return Object(s.a)(this,n),(a=t.call(this)).upstream=e,a.impl=new h(e,r),a}return Object(u.a)(n,[{key:"summary",value:function(){return this.impl.summary()}},{key:"next",value:function(){var e=Object(o.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.impl.next());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(p),h=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(e,r){var a;return Object(s.a)(this,n),(a=t.call(this)).upstream=e,a.separator=r,a.carryover="",a}return Object(u.a)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Split('").concat(this.separator,"')")}},{key:"pump",value:function(){var e=Object(o.a)(i.a.mark((function e(){var t,n,a,o,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=9;break}if(""!==this.carryover){e.next=6;break}return e.abrupt("return",!1);case 6:return this.outputQueue.push(this.carryover),this.carryover="",e.abrupt("return",!0);case 9:(n=t.value.split(this.separator))[0]=this.carryover+n[0],a=Object(r.a)(n.slice(0,-1));try{for(a.s();!(o=a.n()).done;)s=o.value,this.outputQueue.push(s)}catch(i){a.e(i)}finally{a.f()}return this.carryover=n[n.length-1],e.abrupt("return",!0);case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(d.b)},function(e,t,n){var r=n(287),a=n(288),i=n(289),o=n(290),s=n(291),u=n(292),c=n(293);c.alea=r,c.xor128=a,c.xorwow=i,c.xorshift7=o,c.xor4096=s,c.tychei=u,e.exports=c},function(e,t,n){var r;r=function(e){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s="./src/react-webcam.tsx")}({"./src/react-webcam.tsx":function(e,t,n){"use strict";n.r(t);var r=n("react"),a=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=function(){return(i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},o=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n};function s(){return!(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)}"undefined"!==typeof window&&(void 0===navigator.mediaDevices&&(navigator.mediaDevices={}),void 0===navigator.mediaDevices.getUserMedia&&(navigator.mediaDevices.getUserMedia=function(e){var t=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return t?new Promise((function(n,r){t.call(navigator,e,n,r)})):Promise.reject(new Error("getUserMedia is not implemented in this browser"))}));var u=function(e){function t(t){var n=e.call(this,t)||this;return n.canvas=null,n.ctx=null,n.state={hasUserMedia:!1},n}return a(t,e),t.prototype.componentDidMount=function(){var e=this.state,t=this.props;s()?e.hasUserMedia||this.requestUserMedia():t.onUserMediaError("getUserMedia not supported")},t.prototype.componentDidUpdate=function(e){var t=this.props;if(s()){var n=JSON.stringify(e.audioConstraints)!==JSON.stringify(t.audioConstraints),r=JSON.stringify(e.videoConstraints)!==JSON.stringify(t.videoConstraints),a=e.minScreenshotWidth!==t.minScreenshotWidth,i=e.minScreenshotHeight!==t.minScreenshotHeight;(r||a||i)&&(this.canvas=null,this.ctx=null),(n||r)&&(this.stopAndCleanup(),this.requestUserMedia())}else t.onUserMediaError("getUserMedia not supported")},t.prototype.componentWillUnmount=function(){this.stopAndCleanup()},t.prototype.stopAndCleanup=function(){var e=this.state;e.hasUserMedia&&(this.stream&&(this.stream.getVideoTracks&&this.stream.getAudioTracks?(this.stream.getVideoTracks().map((function(e){return e.stop()})),this.stream.getAudioTracks().map((function(e){return e.stop()}))):this.stream.stop()),e.src&&window.URL.revokeObjectURL(e.src))},t.prototype.getScreenshot=function(e){var t=this.state,n=this.props;if(!t.hasUserMedia)return null;var r=this.getCanvas(e);return r&&r.toDataURL(n.screenshotFormat,n.screenshotQuality)},t.prototype.getCanvas=function(e){var t=this.state,n=this.props;if(!this.video)return null;if(!t.hasUserMedia||!this.video.videoHeight)return null;if(!this.ctx){var r=this.video.videoWidth,a=this.video.videoHeight;if(!this.props.forceScreenshotSourceSize){var i=r/a;a=(r=n.minScreenshotWidth||this.video.clientWidth)/i,n.minScreenshotHeight&&a<n.minScreenshotHeight&&(r=(a=n.minScreenshotHeight)*i)}this.canvas=document.createElement("canvas"),this.canvas.width=(null===e||void 0===e?void 0:e.width)||r,this.canvas.height=(null===e||void 0===e?void 0:e.height)||a,this.ctx=this.canvas.getContext("2d")}var o=this.ctx,s=this.canvas;return o&&s&&(n.mirrored&&(o.translate(s.width,0),o.scale(-1,1)),o.imageSmoothingEnabled=n.imageSmoothing,o.drawImage(this.video,0,0,s.width,s.height),n.mirrored&&(o.scale(-1,1),o.translate(-s.width,0))),s},t.prototype.requestUserMedia=function(){var e=this,t=this.props,n=function(n,r){var a={video:"undefined"===typeof r||r};t.audio&&(a.audio="undefined"===typeof n||n),navigator.mediaDevices.getUserMedia(a).then((function(t){e.handleUserMedia(null,t)})).catch((function(t){e.handleUserMedia(t)}))};if("mediaDevices"in navigator)n(t.audioConstraints,t.videoConstraints);else{var r=function(e){return{optional:[{sourceId:e}]}},a=function(e){var t=e.deviceId;return"string"===typeof t?t:Array.isArray(t)&&t.length>0?t[0]:"object"===typeof t&&t.ideal?t.ideal:null};MediaStreamTrack.getSources((function(e){var i=null,o=null;e.forEach((function(e){"audio"===e.kind?i=e.id:"video"===e.kind&&(o=e.id)}));var s=a(t.audioConstraints);s&&(i=s);var u=a(t.videoConstraints);u&&(o=u),n(r(i),r(o))}))}},t.prototype.handleUserMedia=function(e,t){var n=this.props;if(e||!t)return this.setState({hasUserMedia:!1}),void n.onUserMediaError(e);this.stream=t;try{this.video&&(this.video.srcObject=t),this.setState({hasUserMedia:!0})}catch(r){this.setState({hasUserMedia:!0,src:window.URL.createObjectURL(t)})}n.onUserMedia(t)},t.prototype.render=function(){var e=this,t=this.state,n=this.props,a=n.audio,s=(n.forceScreenshotSourceSize,n.onUserMedia,n.onUserMediaError,n.screenshotFormat,n.screenshotQuality,n.minScreenshotWidth,n.minScreenshotHeight,n.audioConstraints,n.videoConstraints,n.imageSmoothing,n.mirrored),u=n.style,c=void 0===u?{}:u,l=o(n,["audio","forceScreenshotSourceSize","onUserMedia","onUserMediaError","screenshotFormat","screenshotQuality","minScreenshotWidth","minScreenshotHeight","audioConstraints","videoConstraints","imageSmoothing","mirrored","style"]),d=s?i(i({},c),{transform:(c.transform||"")+" scaleX(-1)"}):c;return r.createElement("video",i({autoPlay:!0,src:t.src,muted:a,playsInline:!0,ref:function(t){e.video=t},style:d},l))},t.defaultProps={audio:!0,forceScreenshotSourceSize:!1,imageSmoothing:!0,mirrored:!1,onUserMedia:function(){},onUserMediaError:function(){},screenshotFormat:"image/webp",screenshotQuality:.92},t}(r.Component);t.default=u},react:function(t,n){t.exports=e}}).default},e.exports=r(n(75))},,,function(e,t,n){"use strict";var r=n(204),a="function"===typeof Symbol&&Symbol.for,i=a?Symbol.for("react.element"):60103,o=a?Symbol.for("react.portal"):60106,s=a?Symbol.for("react.fragment"):60107,u=a?Symbol.for("react.strict_mode"):60108,c=a?Symbol.for("react.profiler"):60114,l=a?Symbol.for("react.provider"):60109,d=a?Symbol.for("react.context"):60110,p=a?Symbol.for("react.forward_ref"):60112,f=a?Symbol.for("react.suspense"):60113,h=a?Symbol.for("react.memo"):60115,m=a?Symbol.for("react.lazy"):60116,v="function"===typeof Symbol&&Symbol.iterator;function b(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var g={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},y={};function x(e,t,n){this.props=e,this.context=t,this.refs=y,this.updater=n||g}function k(){}function w(e,t,n){this.props=e,this.context=t,this.refs=y,this.updater=n||g}x.prototype.isReactComponent={},x.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error(b(85));this.updater.enqueueSetState(this,e,t,"setState")},x.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},k.prototype=x.prototype;var O=w.prototype=new k;O.constructor=w,r(O,x.prototype),O.isPureReactComponent=!0;var I={current:null},S=Object.prototype.hasOwnProperty,N={key:!0,ref:!0,__self:!0,__source:!0};function j(e,t,n){var r,a={},o=null,s=null;if(null!=t)for(r in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(o=""+t.key),t)S.call(t,r)&&!N.hasOwnProperty(r)&&(a[r]=t[r]);var u=arguments.length-2;if(1===u)a.children=n;else if(1<u){for(var c=Array(u),l=0;l<u;l++)c[l]=arguments[l+2];a.children=c}if(e&&e.defaultProps)for(r in u=e.defaultProps)void 0===a[r]&&(a[r]=u[r]);return{$$typeof:i,type:e,key:o,ref:s,props:a,_owner:I.current}}function T(e){return"object"===typeof e&&null!==e&&e.$$typeof===i}var C=/\/+/g,E=[];function _(e,t,n,r){if(E.length){var a=E.pop();return a.result=e,a.keyPrefix=t,a.func=n,a.context=r,a.count=0,a}return{result:e,keyPrefix:t,func:n,context:r,count:0}}function A(e){e.result=null,e.keyPrefix=null,e.func=null,e.context=null,e.count=0,10>E.length&&E.push(e)}function R(e,t,n){return null==e?0:function e(t,n,r,a){var s=typeof t;"undefined"!==s&&"boolean"!==s||(t=null);var u=!1;if(null===t)u=!0;else switch(s){case"string":case"number":u=!0;break;case"object":switch(t.$$typeof){case i:case o:u=!0}}if(u)return r(a,t,""===n?"."+D(t,0):n),1;if(u=0,n=""===n?".":n+":",Array.isArray(t))for(var c=0;c<t.length;c++){var l=n+D(s=t[c],c);u+=e(s,l,r,a)}else if(null===t||"object"!==typeof t?l=null:l="function"===typeof(l=v&&t[v]||t["@@iterator"])?l:null,"function"===typeof l)for(t=l.call(t),c=0;!(s=t.next()).done;)u+=e(s=s.value,l=n+D(s,c++),r,a);else if("object"===s)throw r=""+t,Error(b(31,"[object Object]"===r?"object with keys {"+Object.keys(t).join(", ")+"}":r,""));return u}(e,"",t,n)}function D(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+(""+e).replace(/[=:]/g,(function(e){return t[e]}))}(e.key):t.toString(36)}function F(e,t){e.func.call(e.context,t,e.count++)}function M(e,t,n){var r=e.result,a=e.keyPrefix;e=e.func.call(e.context,t,e.count++),Array.isArray(e)?z(e,r,n,(function(e){return e})):null!=e&&(T(e)&&(e=function(e,t){return{$$typeof:i,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(e,a+(!e.key||t&&t.key===e.key?"":(""+e.key).replace(C,"$&/")+"/")+n)),r.push(e))}function z(e,t,n,r,a){var i="";null!=n&&(i=(""+n).replace(C,"$&/")+"/"),R(e,M,t=_(t,i,r,a)),A(t)}var L={current:null};function P(){var e=L.current;if(null===e)throw Error(b(321));return e}var B={ReactCurrentDispatcher:L,ReactCurrentBatchConfig:{suspense:null},ReactCurrentOwner:I,IsSomeRendererActing:{current:!1},assign:r};t.Children={map:function(e,t,n){if(null==e)return e;var r=[];return z(e,r,null,t,n),r},forEach:function(e,t,n){if(null==e)return e;R(e,F,t=_(null,null,t,n)),A(t)},count:function(e){return R(e,(function(){return null}),null)},toArray:function(e){var t=[];return z(e,t,null,(function(e){return e})),t},only:function(e){if(!T(e))throw Error(b(143));return e}},t.Component=x,t.Fragment=s,t.Profiler=c,t.PureComponent=w,t.StrictMode=u,t.Suspense=f,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=B,t.cloneElement=function(e,t,n){if(null===e||void 0===e)throw Error(b(267,e));var a=r({},e.props),o=e.key,s=e.ref,u=e._owner;if(null!=t){if(void 0!==t.ref&&(s=t.ref,u=I.current),void 0!==t.key&&(o=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(l in t)S.call(t,l)&&!N.hasOwnProperty(l)&&(a[l]=void 0===t[l]&&void 0!==c?c[l]:t[l])}var l=arguments.length-2;if(1===l)a.children=n;else if(1<l){c=Array(l);for(var d=0;d<l;d++)c[d]=arguments[d+2];a.children=c}return{$$typeof:i,type:e.type,key:o,ref:s,props:a,_owner:u}},t.createContext=function(e,t){return void 0===t&&(t=null),(e={$$typeof:d,_calculateChangedBits:t,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider={$$typeof:l,_context:e},e.Consumer=e},t.createElement=j,t.createFactory=function(e){var t=j.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:p,render:e}},t.isValidElement=T,t.lazy=function(e){return{$$typeof:m,_ctor:e,_status:-1,_result:null}},t.memo=function(e,t){return{$$typeof:h,type:e,compare:void 0===t?null:t}},t.useCallback=function(e,t){return P().useCallback(e,t)},t.useContext=function(e,t){return P().useContext(e,t)},t.useDebugValue=function(){},t.useEffect=function(e,t){return P().useEffect(e,t)},t.useImperativeHandle=function(e,t,n){return P().useImperativeHandle(e,t,n)},t.useLayoutEffect=function(e,t){return P().useLayoutEffect(e,t)},t.useMemo=function(e,t){return P().useMemo(e,t)},t.useReducer=function(e,t,n){return P().useReducer(e,t,n)},t.useRef=function(e){return P().useRef(e)},t.useState=function(e){return P().useState(e)},t.version="16.13.1"},function(e,t,n){"use strict";var r=n(75),a=n(204),i=n(257);function o(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!r)throw Error(o(227));function s(e,t,n,r,a,i,o,s,u){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(l){this.onError(l)}}var u=!1,c=null,l=!1,d=null,p={onError:function(e){u=!0,c=e}};function f(e,t,n,r,a,i,o,l,d){u=!1,c=null,s.apply(p,arguments)}var h=null,m=null,v=null;function b(e,t,n){var r=e.type||"unknown-event";e.currentTarget=v(n),function(e,t,n,r,a,i,s,p,h){if(f.apply(this,arguments),u){if(!u)throw Error(o(198));var m=c;u=!1,c=null,l||(l=!0,d=m)}}(r,t,void 0,e),e.currentTarget=null}var g=null,y={};function x(){if(g)for(var e in y){var t=y[e],n=g.indexOf(e);if(!(-1<n))throw Error(o(96,e));if(!w[n]){if(!t.extractEvents)throw Error(o(97,e));for(var r in w[n]=t,n=t.eventTypes){var a=void 0,i=n[r],s=t,u=r;if(O.hasOwnProperty(u))throw Error(o(99,u));O[u]=i;var c=i.phasedRegistrationNames;if(c){for(a in c)c.hasOwnProperty(a)&&k(c[a],s,u);a=!0}else i.registrationName?(k(i.registrationName,s,u),a=!0):a=!1;if(!a)throw Error(o(98,r,e))}}}}function k(e,t,n){if(I[e])throw Error(o(100,e));I[e]=t,S[e]=t.eventTypes[n].dependencies}var w=[],O={},I={},S={};function N(e){var t,n=!1;for(t in e)if(e.hasOwnProperty(t)){var r=e[t];if(!y.hasOwnProperty(t)||y[t]!==r){if(y[t])throw Error(o(102,t));y[t]=r,n=!0}}n&&x()}var j=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),T=null,C=null,E=null;function _(e){if(e=m(e)){if("function"!==typeof T)throw Error(o(280));var t=e.stateNode;t&&(t=h(t),T(e.stateNode,e.type,t))}}function A(e){C?E?E.push(e):E=[e]:C=e}function R(){if(C){var e=C,t=E;if(E=C=null,_(e),t)for(e=0;e<t.length;e++)_(t[e])}}function D(e,t){return e(t)}function F(e,t,n,r,a){return e(t,n,r,a)}function M(){}var z=D,L=!1,P=!1;function B(){null===C&&null===E||(M(),R())}function W(e,t,n){if(P)return e(t,n);P=!0;try{return z(e,t,n)}finally{P=!1,B()}}var U=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,V=Object.prototype.hasOwnProperty,G={},H={};function q(e,t,n,r,a,i){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=a,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=i}var K={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){K[e]=new q(e,0,!1,e,null,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];K[t]=new q(t,1,!1,e[1],null,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){K[e]=new q(e,2,!1,e.toLowerCase(),null,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){K[e]=new q(e,2,!1,e,null,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){K[e]=new q(e,3,!1,e.toLowerCase(),null,!1)})),["checked","multiple","muted","selected"].forEach((function(e){K[e]=new q(e,3,!0,e,null,!1)})),["capture","download"].forEach((function(e){K[e]=new q(e,4,!1,e,null,!1)})),["cols","rows","size","span"].forEach((function(e){K[e]=new q(e,6,!1,e,null,!1)})),["rowSpan","start"].forEach((function(e){K[e]=new q(e,5,!1,e.toLowerCase(),null,!1)}));var X=/[\-:]([a-z])/g;function Y(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(X,Y);K[t]=new q(t,1,!1,e,null,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(X,Y);K[t]=new q(t,1,!1,e,"http://www.w3.org/1999/xlink",!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(X,Y);K[t]=new q(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1)})),["tabIndex","crossOrigin"].forEach((function(e){K[e]=new q(e,1,!1,e.toLowerCase(),null,!1)})),K.xlinkHref=new q("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0),["src","href","action","formAction"].forEach((function(e){K[e]=new q(e,1,!1,e.toLowerCase(),null,!0)}));var Z=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function J(e,t,n,r){var a=K.hasOwnProperty(t)?K[t]:null;(null!==a?0===a.type:!r&&(2<t.length&&("o"===t[0]||"O"===t[0])&&("n"===t[1]||"N"===t[1])))||(function(e,t,n,r){if(null===t||"undefined"===typeof t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,a,r)&&(n=null),r||null===a?function(e){return!!V.call(H,e)||!V.call(G,e)&&(U.test(e)?H[e]=!0:(G[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):a.mustUseProperty?e[a.propertyName]=null===n?3!==a.type&&"":n:(t=a.attributeName,r=a.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(a=a.type)||4===a&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}Z.hasOwnProperty("ReactCurrentDispatcher")||(Z.ReactCurrentDispatcher={current:null}),Z.hasOwnProperty("ReactCurrentBatchConfig")||(Z.ReactCurrentBatchConfig={suspense:null});var Q=/^(.*)[\\\/]/,$="function"===typeof Symbol&&Symbol.for,ee=$?Symbol.for("react.element"):60103,te=$?Symbol.for("react.portal"):60106,ne=$?Symbol.for("react.fragment"):60107,re=$?Symbol.for("react.strict_mode"):60108,ae=$?Symbol.for("react.profiler"):60114,ie=$?Symbol.for("react.provider"):60109,oe=$?Symbol.for("react.context"):60110,se=$?Symbol.for("react.concurrent_mode"):60111,ue=$?Symbol.for("react.forward_ref"):60112,ce=$?Symbol.for("react.suspense"):60113,le=$?Symbol.for("react.suspense_list"):60120,de=$?Symbol.for("react.memo"):60115,pe=$?Symbol.for("react.lazy"):60116,fe=$?Symbol.for("react.block"):60121,he="function"===typeof Symbol&&Symbol.iterator;function me(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=he&&e[he]||e["@@iterator"])?e:null}function ve(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case ne:return"Fragment";case te:return"Portal";case ae:return"Profiler";case re:return"StrictMode";case ce:return"Suspense";case le:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case oe:return"Context.Consumer";case ie:return"Context.Provider";case ue:var t=e.render;return t=t.displayName||t.name||"",e.displayName||(""!==t?"ForwardRef("+t+")":"ForwardRef");case de:return ve(e.type);case fe:return ve(e.render);case pe:if(e=1===e._status?e._result:null)return ve(e)}return null}function be(e){var t="";do{e:switch(e.tag){case 3:case 4:case 6:case 7:case 10:case 9:var n="";break e;default:var r=e._debugOwner,a=e._debugSource,i=ve(e.type);n=null,r&&(n=ve(r.type)),r=i,i="",a?i=" (at "+a.fileName.replace(Q,"")+":"+a.lineNumber+")":n&&(i=" (created by "+n+")"),n="\n    in "+(r||"Unknown")+i}t+=n,e=e.return}while(e);return t}function ge(e){switch(typeof e){case"boolean":case"number":case"object":case"string":case"undefined":return e;default:return""}}function ye(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function xe(e){e._valueTracker||(e._valueTracker=function(e){var t=ye(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var a=n.get,i=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return a.call(this)},set:function(e){r=""+e,i.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function ke(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=ye(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function we(e,t){var n=t.checked;return a({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function Oe(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=ge(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Ie(e,t){null!=(t=t.checked)&&J(e,"checked",t,!1)}function Se(e,t){Ie(e,t);var n=ge(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?je(e,t.type,n):t.hasOwnProperty("defaultValue")&&je(e,t.type,ge(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Ne(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function je(e,t,n){"number"===t&&e.ownerDocument.activeElement===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}function Te(e,t){return e=a({children:void 0},t),(t=function(e){var t="";return r.Children.forEach(e,(function(e){null!=e&&(t+=e)})),t}(t.children))&&(e.children=t),e}function Ce(e,t,n,r){if(e=e.options,t){t={};for(var a=0;a<n.length;a++)t["$"+n[a]]=!0;for(n=0;n<e.length;n++)a=t.hasOwnProperty("$"+e[n].value),e[n].selected!==a&&(e[n].selected=a),a&&r&&(e[n].defaultSelected=!0)}else{for(n=""+ge(n),t=null,a=0;a<e.length;a++){if(e[a].value===n)return e[a].selected=!0,void(r&&(e[a].defaultSelected=!0));null!==t||e[a].disabled||(t=e[a])}null!==t&&(t.selected=!0)}}function Ee(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(o(91));return a({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function _e(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(o(92));if(Array.isArray(n)){if(!(1>=n.length))throw Error(o(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:ge(n)}}function Ae(e,t){var n=ge(t.value),r=ge(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function Re(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}var De="http://www.w3.org/1999/xhtml",Fe="http://www.w3.org/2000/svg";function Me(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ze(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?Me(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var Le,Pe=function(e){return"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(t,n,r,a){MSApp.execUnsafeLocalFunction((function(){return e(t,n)}))}:e}((function(e,t){if(e.namespaceURI!==Fe||"innerHTML"in e)e.innerHTML=t;else{for((Le=Le||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=Le.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}}));function Be(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}function We(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Ue={animationend:We("Animation","AnimationEnd"),animationiteration:We("Animation","AnimationIteration"),animationstart:We("Animation","AnimationStart"),transitionend:We("Transition","TransitionEnd")},Ve={},Ge={};function He(e){if(Ve[e])return Ve[e];if(!Ue[e])return e;var t,n=Ue[e];for(t in n)if(n.hasOwnProperty(t)&&t in Ge)return Ve[e]=n[t];return e}j&&(Ge=document.createElement("div").style,"AnimationEvent"in window||(delete Ue.animationend.animation,delete Ue.animationiteration.animation,delete Ue.animationstart.animation),"TransitionEvent"in window||delete Ue.transitionend.transition);var qe=He("animationend"),Ke=He("animationiteration"),Xe=He("animationstart"),Ye=He("transitionend"),Ze="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Je=new("function"===typeof WeakMap?WeakMap:Map);function Qe(e){var t=Je.get(e);return void 0===t&&(t=new Map,Je.set(e,t)),t}function $e(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(1026&(t=e).effectTag)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function et(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function tt(e){if($e(e)!==e)throw Error(o(188))}function nt(e){if(!(e=function(e){var t=e.alternate;if(!t){if(null===(t=$e(e)))throw Error(o(188));return t!==e?null:e}for(var n=e,r=t;;){var a=n.return;if(null===a)break;var i=a.alternate;if(null===i){if(null!==(r=a.return)){n=r;continue}break}if(a.child===i.child){for(i=a.child;i;){if(i===n)return tt(a),e;if(i===r)return tt(a),t;i=i.sibling}throw Error(o(188))}if(n.return!==r.return)n=a,r=i;else{for(var s=!1,u=a.child;u;){if(u===n){s=!0,n=a,r=i;break}if(u===r){s=!0,r=a,n=i;break}u=u.sibling}if(!s){for(u=i.child;u;){if(u===n){s=!0,n=i,r=a;break}if(u===r){s=!0,r=i,n=a;break}u=u.sibling}if(!s)throw Error(o(189))}}if(n.alternate!==r)throw Error(o(190))}if(3!==n.tag)throw Error(o(188));return n.stateNode.current===n?e:t}(e)))return null;for(var t=e;;){if(5===t.tag||6===t.tag)return t;if(t.child)t.child.return=t,t=t.child;else{if(t===e)break;for(;!t.sibling;){if(!t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}}return null}function rt(e,t){if(null==t)throw Error(o(30));return null==e?t:Array.isArray(e)?Array.isArray(t)?(e.push.apply(e,t),e):(e.push(t),e):Array.isArray(t)?[e].concat(t):[e,t]}function at(e,t,n){Array.isArray(e)?e.forEach(t,n):e&&t.call(n,e)}var it=null;function ot(e){if(e){var t=e._dispatchListeners,n=e._dispatchInstances;if(Array.isArray(t))for(var r=0;r<t.length&&!e.isPropagationStopped();r++)b(e,t[r],n[r]);else t&&b(e,t,n);e._dispatchListeners=null,e._dispatchInstances=null,e.isPersistent()||e.constructor.release(e)}}function st(e){if(null!==e&&(it=rt(it,e)),e=it,it=null,e){if(at(e,ot),it)throw Error(o(95));if(l)throw e=d,l=!1,d=null,e}}function ut(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}function ct(e){if(!j)return!1;var t=(e="on"+e)in document;return t||((t=document.createElement("div")).setAttribute(e,"return;"),t="function"===typeof t[e]),t}var lt=[];function dt(e){e.topLevelType=null,e.nativeEvent=null,e.targetInst=null,e.ancestors.length=0,10>lt.length&&lt.push(e)}function pt(e,t,n,r){if(lt.length){var a=lt.pop();return a.topLevelType=e,a.eventSystemFlags=r,a.nativeEvent=t,a.targetInst=n,a}return{topLevelType:e,eventSystemFlags:r,nativeEvent:t,targetInst:n,ancestors:[]}}function ft(e){var t=e.targetInst,n=t;do{if(!n){e.ancestors.push(n);break}var r=n;if(3===r.tag)r=r.stateNode.containerInfo;else{for(;r.return;)r=r.return;r=3!==r.tag?null:r.stateNode.containerInfo}if(!r)break;5!==(t=n.tag)&&6!==t||e.ancestors.push(n),n=jn(r)}while(n);for(n=0;n<e.ancestors.length;n++){t=e.ancestors[n];var a=ut(e.nativeEvent);r=e.topLevelType;var i=e.nativeEvent,o=e.eventSystemFlags;0===n&&(o|=64);for(var s=null,u=0;u<w.length;u++){var c=w[u];c&&(c=c.extractEvents(r,t,i,a,o))&&(s=rt(s,c))}st(s)}}function ht(e,t,n){if(!n.has(e)){switch(e){case"scroll":Xt(t,"scroll",!0);break;case"focus":case"blur":Xt(t,"focus",!0),Xt(t,"blur",!0),n.set("blur",null),n.set("focus",null);break;case"cancel":case"close":ct(e)&&Xt(t,e,!0);break;case"invalid":case"submit":case"reset":break;default:-1===Ze.indexOf(e)&&Kt(e,t)}n.set(e,null)}}var mt,vt,bt,gt=!1,yt=[],xt=null,kt=null,wt=null,Ot=new Map,It=new Map,St=[],Nt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput close cancel copy cut paste click change contextmenu reset submit".split(" "),jt="focus blur dragenter dragleave mouseover mouseout pointerover pointerout gotpointercapture lostpointercapture".split(" ");function Tt(e,t,n,r,a){return{blockedOn:e,topLevelType:t,eventSystemFlags:32|n,nativeEvent:a,container:r}}function Ct(e,t){switch(e){case"focus":case"blur":xt=null;break;case"dragenter":case"dragleave":kt=null;break;case"mouseover":case"mouseout":wt=null;break;case"pointerover":case"pointerout":Ot.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":It.delete(t.pointerId)}}function Et(e,t,n,r,a,i){return null===e||e.nativeEvent!==i?(e=Tt(t,n,r,a,i),null!==t&&(null!==(t=Tn(t))&&vt(t)),e):(e.eventSystemFlags|=r,e)}function _t(e){var t=jn(e.target);if(null!==t){var n=$e(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=et(n)))return e.blockedOn=t,void i.unstable_runWithPriority(e.priority,(function(){bt(n)}))}else if(3===t&&n.stateNode.hydrate)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function At(e){if(null!==e.blockedOn)return!1;var t=Qt(e.topLevelType,e.eventSystemFlags,e.container,e.nativeEvent);if(null!==t){var n=Tn(t);return null!==n&&vt(n),e.blockedOn=t,!1}return!0}function Rt(e,t,n){At(e)&&n.delete(t)}function Dt(){for(gt=!1;0<yt.length;){var e=yt[0];if(null!==e.blockedOn){null!==(e=Tn(e.blockedOn))&&mt(e);break}var t=Qt(e.topLevelType,e.eventSystemFlags,e.container,e.nativeEvent);null!==t?e.blockedOn=t:yt.shift()}null!==xt&&At(xt)&&(xt=null),null!==kt&&At(kt)&&(kt=null),null!==wt&&At(wt)&&(wt=null),Ot.forEach(Rt),It.forEach(Rt)}function Ft(e,t){e.blockedOn===t&&(e.blockedOn=null,gt||(gt=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,Dt)))}function Mt(e){function t(t){return Ft(t,e)}if(0<yt.length){Ft(yt[0],e);for(var n=1;n<yt.length;n++){var r=yt[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==xt&&Ft(xt,e),null!==kt&&Ft(kt,e),null!==wt&&Ft(wt,e),Ot.forEach(t),It.forEach(t),n=0;n<St.length;n++)(r=St[n]).blockedOn===e&&(r.blockedOn=null);for(;0<St.length&&null===(n=St[0]).blockedOn;)_t(n),null===n.blockedOn&&St.shift()}var zt={},Lt=new Map,Pt=new Map,Bt=["abort","abort",qe,"animationEnd",Ke,"animationIteration",Xe,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata","loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",Ye,"transitionEnd","waiting","waiting"];function Wt(e,t){for(var n=0;n<e.length;n+=2){var r=e[n],a=e[n+1],i="on"+(a[0].toUpperCase()+a.slice(1));i={phasedRegistrationNames:{bubbled:i,captured:i+"Capture"},dependencies:[r],eventPriority:t},Pt.set(r,t),Lt.set(r,i),zt[a]=i}}Wt("blur blur cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focus focus input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),0),Wt("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1),Wt(Bt,2);for(var Ut="change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),Vt=0;Vt<Ut.length;Vt++)Pt.set(Ut[Vt],0);var Gt=i.unstable_UserBlockingPriority,Ht=i.unstable_runWithPriority,qt=!0;function Kt(e,t){Xt(t,e,!1)}function Xt(e,t,n){var r=Pt.get(t);switch(void 0===r?2:r){case 0:r=Yt.bind(null,t,1,e);break;case 1:r=Zt.bind(null,t,1,e);break;default:r=Jt.bind(null,t,1,e)}n?e.addEventListener(t,r,!0):e.addEventListener(t,r,!1)}function Yt(e,t,n,r){L||M();var a=Jt,i=L;L=!0;try{F(a,e,t,n,r)}finally{(L=i)||B()}}function Zt(e,t,n,r){Ht(Gt,Jt.bind(null,e,t,n,r))}function Jt(e,t,n,r){if(qt)if(0<yt.length&&-1<Nt.indexOf(e))e=Tt(null,e,t,n,r),yt.push(e);else{var a=Qt(e,t,n,r);if(null===a)Ct(e,r);else if(-1<Nt.indexOf(e))e=Tt(a,e,t,n,r),yt.push(e);else if(!function(e,t,n,r,a){switch(t){case"focus":return xt=Et(xt,e,t,n,r,a),!0;case"dragenter":return kt=Et(kt,e,t,n,r,a),!0;case"mouseover":return wt=Et(wt,e,t,n,r,a),!0;case"pointerover":var i=a.pointerId;return Ot.set(i,Et(Ot.get(i)||null,e,t,n,r,a)),!0;case"gotpointercapture":return i=a.pointerId,It.set(i,Et(It.get(i)||null,e,t,n,r,a)),!0}return!1}(a,e,t,n,r)){Ct(e,r),e=pt(e,r,null,t);try{W(ft,e)}finally{dt(e)}}}}function Qt(e,t,n,r){if(null!==(n=jn(n=ut(r)))){var a=$e(n);if(null===a)n=null;else{var i=a.tag;if(13===i){if(null!==(n=et(a)))return n;n=null}else if(3===i){if(a.stateNode.hydrate)return 3===a.tag?a.stateNode.containerInfo:null;n=null}else a!==n&&(n=null)}}e=pt(e,r,n,t);try{W(ft,e)}finally{dt(e)}return null}var $t={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},en=["Webkit","ms","Moz","O"];function tn(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||$t.hasOwnProperty(e)&&$t[e]?(""+t).trim():t+"px"}function nn(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),a=tn(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,a):e[n]=a}}Object.keys($t).forEach((function(e){en.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),$t[t]=$t[e]}))}));var rn=a({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function an(e,t){if(t){if(rn[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(o(137,e,""));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(o(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(o(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(o(62,""))}}function on(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var sn=De;function un(e,t){var n=Qe(e=9===e.nodeType||11===e.nodeType?e:e.ownerDocument);t=S[t];for(var r=0;r<t.length;r++)ht(t[r],e,n)}function cn(){}function ln(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function dn(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function pn(e,t){var n,r=dn(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=dn(r)}}function fn(){for(var e=window,t=ln();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=ln((e=t.contentWindow).document)}return t}function hn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var mn=null,vn=null;function bn(e,t){switch(e){case"button":case"input":case"select":case"textarea":return!!t.autoFocus}return!1}function gn(e,t){return"textarea"===e||"option"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var yn="function"===typeof setTimeout?setTimeout:void 0,xn="function"===typeof clearTimeout?clearTimeout:void 0;function kn(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break}return e}function wn(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var On=Math.random().toString(36).slice(2),In="__reactInternalInstance$"+On,Sn="__reactEventHandlers$"+On,Nn="__reactContainere$"+On;function jn(e){var t=e[In];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Nn]||n[In]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=wn(e);null!==e;){if(n=e[In])return n;e=wn(e)}return t}n=(e=n).parentNode}return null}function Tn(e){return!(e=e[In]||e[Nn])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function Cn(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(o(33))}function En(e){return e[Sn]||null}function _n(e){do{e=e.return}while(e&&5!==e.tag);return e||null}function An(e,t){var n=e.stateNode;if(!n)return null;var r=h(n);if(!r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(o(231,t,typeof n));return n}function Rn(e,t,n){(t=An(e,n.dispatchConfig.phasedRegistrationNames[t]))&&(n._dispatchListeners=rt(n._dispatchListeners,t),n._dispatchInstances=rt(n._dispatchInstances,e))}function Dn(e){if(e&&e.dispatchConfig.phasedRegistrationNames){for(var t=e._targetInst,n=[];t;)n.push(t),t=_n(t);for(t=n.length;0<t--;)Rn(n[t],"captured",e);for(t=0;t<n.length;t++)Rn(n[t],"bubbled",e)}}function Fn(e,t,n){e&&n&&n.dispatchConfig.registrationName&&(t=An(e,n.dispatchConfig.registrationName))&&(n._dispatchListeners=rt(n._dispatchListeners,t),n._dispatchInstances=rt(n._dispatchInstances,e))}function Mn(e){e&&e.dispatchConfig.registrationName&&Fn(e._targetInst,null,e)}function zn(e){at(e,Dn)}var Ln=null,Pn=null,Bn=null;function Wn(){if(Bn)return Bn;var e,t,n=Pn,r=n.length,a="value"in Ln?Ln.value:Ln.textContent,i=a.length;for(e=0;e<r&&n[e]===a[e];e++);var o=r-e;for(t=1;t<=o&&n[r-t]===a[i-t];t++);return Bn=a.slice(e,1<t?1-t:void 0)}function Un(){return!0}function Vn(){return!1}function Gn(e,t,n,r){for(var a in this.dispatchConfig=e,this._targetInst=t,this.nativeEvent=n,e=this.constructor.Interface)e.hasOwnProperty(a)&&((t=e[a])?this[a]=t(n):"target"===a?this.target=r:this[a]=n[a]);return this.isDefaultPrevented=(null!=n.defaultPrevented?n.defaultPrevented:!1===n.returnValue)?Un:Vn,this.isPropagationStopped=Vn,this}function Hn(e,t,n,r){if(this.eventPool.length){var a=this.eventPool.pop();return this.call(a,e,t,n,r),a}return new this(e,t,n,r)}function qn(e){if(!(e instanceof this))throw Error(o(279));e.destructor(),10>this.eventPool.length&&this.eventPool.push(e)}function Kn(e){e.eventPool=[],e.getPooled=Hn,e.release=qn}a(Gn.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=Un)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=Un)},persist:function(){this.isPersistent=Un},isPersistent:Vn,destructor:function(){var e,t=this.constructor.Interface;for(e in t)this[e]=null;this.nativeEvent=this._targetInst=this.dispatchConfig=null,this.isPropagationStopped=this.isDefaultPrevented=Vn,this._dispatchInstances=this._dispatchListeners=null}}),Gn.Interface={type:null,target:null,currentTarget:function(){return null},eventPhase:null,bubbles:null,cancelable:null,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:null,isTrusted:null},Gn.extend=function(e){function t(){}function n(){return r.apply(this,arguments)}var r=this;t.prototype=r.prototype;var i=new t;return a(i,n.prototype),n.prototype=i,n.prototype.constructor=n,n.Interface=a({},r.Interface,e),n.extend=r.extend,Kn(n),n},Kn(Gn);var Xn=Gn.extend({data:null}),Yn=Gn.extend({data:null}),Zn=[9,13,27,32],Jn=j&&"CompositionEvent"in window,Qn=null;j&&"documentMode"in document&&(Qn=document.documentMode);var $n=j&&"TextEvent"in window&&!Qn,er=j&&(!Jn||Qn&&8<Qn&&11>=Qn),tr=String.fromCharCode(32),nr={beforeInput:{phasedRegistrationNames:{bubbled:"onBeforeInput",captured:"onBeforeInputCapture"},dependencies:["compositionend","keypress","textInput","paste"]},compositionEnd:{phasedRegistrationNames:{bubbled:"onCompositionEnd",captured:"onCompositionEndCapture"},dependencies:"blur compositionend keydown keypress keyup mousedown".split(" ")},compositionStart:{phasedRegistrationNames:{bubbled:"onCompositionStart",captured:"onCompositionStartCapture"},dependencies:"blur compositionstart keydown keypress keyup mousedown".split(" ")},compositionUpdate:{phasedRegistrationNames:{bubbled:"onCompositionUpdate",captured:"onCompositionUpdateCapture"},dependencies:"blur compositionupdate keydown keypress keyup mousedown".split(" ")}},rr=!1;function ar(e,t){switch(e){case"keyup":return-1!==Zn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"blur":return!0;default:return!1}}function ir(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var or=!1;var sr={eventTypes:nr,extractEvents:function(e,t,n,r){var a;if(Jn)e:{switch(e){case"compositionstart":var i=nr.compositionStart;break e;case"compositionend":i=nr.compositionEnd;break e;case"compositionupdate":i=nr.compositionUpdate;break e}i=void 0}else or?ar(e,n)&&(i=nr.compositionEnd):"keydown"===e&&229===n.keyCode&&(i=nr.compositionStart);return i?(er&&"ko"!==n.locale&&(or||i!==nr.compositionStart?i===nr.compositionEnd&&or&&(a=Wn()):(Pn="value"in(Ln=r)?Ln.value:Ln.textContent,or=!0)),i=Xn.getPooled(i,t,n,r),a?i.data=a:null!==(a=ir(n))&&(i.data=a),zn(i),a=i):a=null,(e=$n?function(e,t){switch(e){case"compositionend":return ir(t);case"keypress":return 32!==t.which?null:(rr=!0,tr);case"textInput":return(e=t.data)===tr&&rr?null:e;default:return null}}(e,n):function(e,t){if(or)return"compositionend"===e||!Jn&&ar(e,t)?(e=Wn(),Bn=Pn=Ln=null,or=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return er&&"ko"!==t.locale?null:t.data;default:return null}}(e,n))?((t=Yn.getPooled(nr.beforeInput,t,n,r)).data=e,zn(t)):t=null,null===a?t:null===t?a:[a,t]}},ur={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function cr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!ur[e.type]:"textarea"===t}var lr={change:{phasedRegistrationNames:{bubbled:"onChange",captured:"onChangeCapture"},dependencies:"blur change click focus input keydown keyup selectionchange".split(" ")}};function dr(e,t,n){return(e=Gn.getPooled(lr.change,e,t,n)).type="change",A(n),zn(e),e}var pr=null,fr=null;function hr(e){st(e)}function mr(e){if(ke(Cn(e)))return e}function vr(e,t){if("change"===e)return t}var br=!1;function gr(){pr&&(pr.detachEvent("onpropertychange",yr),fr=pr=null)}function yr(e){if("value"===e.propertyName&&mr(fr))if(e=dr(fr,e,ut(e)),L)st(e);else{L=!0;try{D(hr,e)}finally{L=!1,B()}}}function xr(e,t,n){"focus"===e?(gr(),fr=n,(pr=t).attachEvent("onpropertychange",yr)):"blur"===e&&gr()}function kr(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return mr(fr)}function wr(e,t){if("click"===e)return mr(t)}function Or(e,t){if("input"===e||"change"===e)return mr(t)}j&&(br=ct("input")&&(!document.documentMode||9<document.documentMode));var Ir={eventTypes:lr,_isInputEventSupported:br,extractEvents:function(e,t,n,r){var a=t?Cn(t):window,i=a.nodeName&&a.nodeName.toLowerCase();if("select"===i||"input"===i&&"file"===a.type)var o=vr;else if(cr(a))if(br)o=Or;else{o=kr;var s=xr}else(i=a.nodeName)&&"input"===i.toLowerCase()&&("checkbox"===a.type||"radio"===a.type)&&(o=wr);if(o&&(o=o(e,t)))return dr(o,n,r);s&&s(e,a,t),"blur"===e&&(e=a._wrapperState)&&e.controlled&&"number"===a.type&&je(a,"number",a.value)}},Sr=Gn.extend({view:null,detail:null}),Nr={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function jr(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Nr[e])&&!!t[e]}function Tr(){return jr}var Cr=0,Er=0,_r=!1,Ar=!1,Rr=Sr.extend({screenX:null,screenY:null,clientX:null,clientY:null,pageX:null,pageY:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,getModifierState:Tr,button:null,buttons:null,relatedTarget:function(e){return e.relatedTarget||(e.fromElement===e.srcElement?e.toElement:e.fromElement)},movementX:function(e){if("movementX"in e)return e.movementX;var t=Cr;return Cr=e.screenX,_r?"mousemove"===e.type?e.screenX-t:0:(_r=!0,0)},movementY:function(e){if("movementY"in e)return e.movementY;var t=Er;return Er=e.screenY,Ar?"mousemove"===e.type?e.screenY-t:0:(Ar=!0,0)}}),Dr=Rr.extend({pointerId:null,width:null,height:null,pressure:null,tangentialPressure:null,tiltX:null,tiltY:null,twist:null,pointerType:null,isPrimary:null}),Fr={mouseEnter:{registrationName:"onMouseEnter",dependencies:["mouseout","mouseover"]},mouseLeave:{registrationName:"onMouseLeave",dependencies:["mouseout","mouseover"]},pointerEnter:{registrationName:"onPointerEnter",dependencies:["pointerout","pointerover"]},pointerLeave:{registrationName:"onPointerLeave",dependencies:["pointerout","pointerover"]}},Mr={eventTypes:Fr,extractEvents:function(e,t,n,r,a){var i="mouseover"===e||"pointerover"===e,o="mouseout"===e||"pointerout"===e;if(i&&0===(32&a)&&(n.relatedTarget||n.fromElement)||!o&&!i)return null;(i=r.window===r?r:(i=r.ownerDocument)?i.defaultView||i.parentWindow:window,o)?(o=t,null!==(t=(t=n.relatedTarget||n.toElement)?jn(t):null)&&(t!==$e(t)||5!==t.tag&&6!==t.tag)&&(t=null)):o=null;if(o===t)return null;if("mouseout"===e||"mouseover"===e)var s=Rr,u=Fr.mouseLeave,c=Fr.mouseEnter,l="mouse";else"pointerout"!==e&&"pointerover"!==e||(s=Dr,u=Fr.pointerLeave,c=Fr.pointerEnter,l="pointer");if(e=null==o?i:Cn(o),i=null==t?i:Cn(t),(u=s.getPooled(u,o,n,r)).type=l+"leave",u.target=e,u.relatedTarget=i,(n=s.getPooled(c,t,n,r)).type=l+"enter",n.target=i,n.relatedTarget=e,l=t,(r=o)&&l)e:{for(c=l,o=0,e=s=r;e;e=_n(e))o++;for(e=0,t=c;t;t=_n(t))e++;for(;0<o-e;)s=_n(s),o--;for(;0<e-o;)c=_n(c),e--;for(;o--;){if(s===c||s===c.alternate)break e;s=_n(s),c=_n(c)}s=null}else s=null;for(c=s,s=[];r&&r!==c&&(null===(o=r.alternate)||o!==c);)s.push(r),r=_n(r);for(r=[];l&&l!==c&&(null===(o=l.alternate)||o!==c);)r.push(l),l=_n(l);for(l=0;l<s.length;l++)Fn(s[l],"bubbled",u);for(l=r.length;0<l--;)Fn(r[l],"captured",n);return 0===(64&a)?[u]:[u,n]}};var zr="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t},Lr=Object.prototype.hasOwnProperty;function Pr(e,t){if(zr(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++)if(!Lr.call(t,n[r])||!zr(e[n[r]],t[n[r]]))return!1;return!0}var Br=j&&"documentMode"in document&&11>=document.documentMode,Wr={select:{phasedRegistrationNames:{bubbled:"onSelect",captured:"onSelectCapture"},dependencies:"blur contextmenu dragend focus keydown keyup mousedown mouseup selectionchange".split(" ")}},Ur=null,Vr=null,Gr=null,Hr=!1;function qr(e,t){var n=t.window===t?t.document:9===t.nodeType?t:t.ownerDocument;return Hr||null==Ur||Ur!==ln(n)?null:("selectionStart"in(n=Ur)&&hn(n)?n={start:n.selectionStart,end:n.selectionEnd}:n={anchorNode:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset},Gr&&Pr(Gr,n)?null:(Gr=n,(e=Gn.getPooled(Wr.select,Vr,e,t)).type="select",e.target=Ur,zn(e),e))}var Kr={eventTypes:Wr,extractEvents:function(e,t,n,r,a,i){if(!(i=!(a=i||(r.window===r?r.document:9===r.nodeType?r:r.ownerDocument)))){e:{a=Qe(a),i=S.onSelect;for(var o=0;o<i.length;o++)if(!a.has(i[o])){a=!1;break e}a=!0}i=!a}if(i)return null;switch(a=t?Cn(t):window,e){case"focus":(cr(a)||"true"===a.contentEditable)&&(Ur=a,Vr=t,Gr=null);break;case"blur":Gr=Vr=Ur=null;break;case"mousedown":Hr=!0;break;case"contextmenu":case"mouseup":case"dragend":return Hr=!1,qr(n,r);case"selectionchange":if(Br)break;case"keydown":case"keyup":return qr(n,r)}return null}},Xr=Gn.extend({animationName:null,elapsedTime:null,pseudoElement:null}),Yr=Gn.extend({clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Zr=Sr.extend({relatedTarget:null});function Jr(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}var Qr={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},$r={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},ea=Sr.extend({key:function(e){if(e.key){var t=Qr[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=Jr(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?$r[e.keyCode]||"Unidentified":""},location:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,repeat:null,locale:null,getModifierState:Tr,charCode:function(e){return"keypress"===e.type?Jr(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?Jr(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),ta=Rr.extend({dataTransfer:null}),na=Sr.extend({touches:null,targetTouches:null,changedTouches:null,altKey:null,metaKey:null,ctrlKey:null,shiftKey:null,getModifierState:Tr}),ra=Gn.extend({propertyName:null,elapsedTime:null,pseudoElement:null}),aa=Rr.extend({deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:null,deltaMode:null}),ia={eventTypes:zt,extractEvents:function(e,t,n,r){var a=Lt.get(e);if(!a)return null;switch(e){case"keypress":if(0===Jr(n))return null;case"keydown":case"keyup":e=ea;break;case"blur":case"focus":e=Zr;break;case"click":if(2===n.button)return null;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":e=Rr;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":e=ta;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":e=na;break;case qe:case Ke:case Xe:e=Xr;break;case Ye:e=ra;break;case"scroll":e=Sr;break;case"wheel":e=aa;break;case"copy":case"cut":case"paste":e=Yr;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":e=Dr;break;default:e=Gn}return zn(t=e.getPooled(a,t,n,r)),t}};if(g)throw Error(o(101));g=Array.prototype.slice.call("ResponderEventPlugin SimpleEventPlugin EnterLeaveEventPlugin ChangeEventPlugin SelectEventPlugin BeforeInputEventPlugin".split(" ")),x(),h=En,m=Tn,v=Cn,N({SimpleEventPlugin:ia,EnterLeaveEventPlugin:Mr,ChangeEventPlugin:Ir,SelectEventPlugin:Kr,BeforeInputEventPlugin:sr});var oa=[],sa=-1;function ua(e){0>sa||(e.current=oa[sa],oa[sa]=null,sa--)}function ca(e,t){sa++,oa[sa]=e.current,e.current=t}var la={},da={current:la},pa={current:!1},fa=la;function ha(e,t){var n=e.type.contextTypes;if(!n)return la;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var a,i={};for(a in n)i[a]=t[a];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=i),i}function ma(e){return null!==(e=e.childContextTypes)&&void 0!==e}function va(){ua(pa),ua(da)}function ba(e,t,n){if(da.current!==la)throw Error(o(168));ca(da,t),ca(pa,n)}function ga(e,t,n){var r=e.stateNode;if(e=t.childContextTypes,"function"!==typeof r.getChildContext)return n;for(var i in r=r.getChildContext())if(!(i in e))throw Error(o(108,ve(t)||"Unknown",i));return a({},n,{},r)}function ya(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||la,fa=da.current,ca(da,e),ca(pa,pa.current),!0}function xa(e,t,n){var r=e.stateNode;if(!r)throw Error(o(169));n?(e=ga(e,t,fa),r.__reactInternalMemoizedMergedChildContext=e,ua(pa),ua(da),ca(da,e)):ua(pa),ca(pa,n)}var ka=i.unstable_runWithPriority,wa=i.unstable_scheduleCallback,Oa=i.unstable_cancelCallback,Ia=i.unstable_requestPaint,Sa=i.unstable_now,Na=i.unstable_getCurrentPriorityLevel,ja=i.unstable_ImmediatePriority,Ta=i.unstable_UserBlockingPriority,Ca=i.unstable_NormalPriority,Ea=i.unstable_LowPriority,_a=i.unstable_IdlePriority,Aa={},Ra=i.unstable_shouldYield,Da=void 0!==Ia?Ia:function(){},Fa=null,Ma=null,za=!1,La=Sa(),Pa=1e4>La?Sa:function(){return Sa()-La};function Ba(){switch(Na()){case ja:return 99;case Ta:return 98;case Ca:return 97;case Ea:return 96;case _a:return 95;default:throw Error(o(332))}}function Wa(e){switch(e){case 99:return ja;case 98:return Ta;case 97:return Ca;case 96:return Ea;case 95:return _a;default:throw Error(o(332))}}function Ua(e,t){return e=Wa(e),ka(e,t)}function Va(e,t,n){return e=Wa(e),wa(e,t,n)}function Ga(e){return null===Fa?(Fa=[e],Ma=wa(ja,qa)):Fa.push(e),Aa}function Ha(){if(null!==Ma){var e=Ma;Ma=null,Oa(e)}qa()}function qa(){if(!za&&null!==Fa){za=!0;var e=0;try{var t=Fa;Ua(99,(function(){for(;e<t.length;e++){var n=t[e];do{n=n(!0)}while(null!==n)}})),Fa=null}catch(n){throw null!==Fa&&(Fa=Fa.slice(e+1)),wa(ja,Ha),n}finally{za=!1}}}function Ka(e,t,n){return 1073741821-(1+((1073741821-e+t/10)/(n/=10)|0))*n}function Xa(e,t){if(e&&e.defaultProps)for(var n in t=a({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}var Ya={current:null},Za=null,Ja=null,Qa=null;function $a(){Qa=Ja=Za=null}function ei(e){var t=Ya.current;ua(Ya),e.type._context._currentValue=t}function ti(e,t){for(;null!==e;){var n=e.alternate;if(e.childExpirationTime<t)e.childExpirationTime=t,null!==n&&n.childExpirationTime<t&&(n.childExpirationTime=t);else{if(!(null!==n&&n.childExpirationTime<t))break;n.childExpirationTime=t}e=e.return}}function ni(e,t){Za=e,Qa=Ja=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(e.expirationTime>=t&&(Eo=!0),e.firstContext=null)}function ri(e,t){if(Qa!==e&&!1!==t&&0!==t)if("number"===typeof t&&1073741823!==t||(Qa=e,t=1073741823),t={context:e,observedBits:t,next:null},null===Ja){if(null===Za)throw Error(o(308));Ja=t,Za.dependencies={expirationTime:0,firstContext:t,responders:null}}else Ja=Ja.next=t;return e._currentValue}var ai=!1;function ii(e){e.updateQueue={baseState:e.memoizedState,baseQueue:null,shared:{pending:null},effects:null}}function oi(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,baseQueue:e.baseQueue,shared:e.shared,effects:e.effects})}function si(e,t){return(e={expirationTime:e,suspenseConfig:t,tag:0,payload:null,callback:null,next:null}).next=e}function ui(e,t){if(null!==(e=e.updateQueue)){var n=(e=e.shared).pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}}function ci(e,t){var n=e.alternate;null!==n&&oi(n,e),null===(n=(e=e.updateQueue).baseQueue)?(e.baseQueue=t.next=t,t.next=t):(t.next=n.next,n.next=t)}function li(e,t,n,r){var i=e.updateQueue;ai=!1;var o=i.baseQueue,s=i.shared.pending;if(null!==s){if(null!==o){var u=o.next;o.next=s.next,s.next=u}o=s,i.shared.pending=null,null!==(u=e.alternate)&&(null!==(u=u.updateQueue)&&(u.baseQueue=s))}if(null!==o){u=o.next;var c=i.baseState,l=0,d=null,p=null,f=null;if(null!==u)for(var h=u;;){if((s=h.expirationTime)<r){var m={expirationTime:h.expirationTime,suspenseConfig:h.suspenseConfig,tag:h.tag,payload:h.payload,callback:h.callback,next:null};null===f?(p=f=m,d=c):f=f.next=m,s>l&&(l=s)}else{null!==f&&(f=f.next={expirationTime:1073741823,suspenseConfig:h.suspenseConfig,tag:h.tag,payload:h.payload,callback:h.callback,next:null}),iu(s,h.suspenseConfig);e:{var v=e,b=h;switch(s=t,m=n,b.tag){case 1:if("function"===typeof(v=b.payload)){c=v.call(m,c,s);break e}c=v;break e;case 3:v.effectTag=-4097&v.effectTag|64;case 0:if(null===(s="function"===typeof(v=b.payload)?v.call(m,c,s):v)||void 0===s)break e;c=a({},c,s);break e;case 2:ai=!0}}null!==h.callback&&(e.effectTag|=32,null===(s=i.effects)?i.effects=[h]:s.push(h))}if(null===(h=h.next)||h===u){if(null===(s=i.shared.pending))break;h=o.next=s.next,s.next=u,i.baseQueue=o=s,i.shared.pending=null}}null===f?d=c:f.next=p,i.baseState=d,i.baseQueue=f,ou(l),e.expirationTime=l,e.memoizedState=c}}function di(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],a=r.callback;if(null!==a){if(r.callback=null,r=a,a=n,"function"!==typeof r)throw Error(o(191,r));r.call(a)}}}var pi=Z.ReactCurrentBatchConfig,fi=(new r.Component).refs;function hi(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:a({},t,n),e.memoizedState=n,0===e.expirationTime&&(e.updateQueue.baseState=n)}var mi={isMounted:function(e){return!!(e=e._reactInternalFiber)&&$e(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternalFiber;var r=qs(),a=pi.suspense;(a=si(r=Ks(r,e,a),a)).payload=t,void 0!==n&&null!==n&&(a.callback=n),ui(e,a),Xs(e,r)},enqueueReplaceState:function(e,t,n){e=e._reactInternalFiber;var r=qs(),a=pi.suspense;(a=si(r=Ks(r,e,a),a)).tag=1,a.payload=t,void 0!==n&&null!==n&&(a.callback=n),ui(e,a),Xs(e,r)},enqueueForceUpdate:function(e,t){e=e._reactInternalFiber;var n=qs(),r=pi.suspense;(r=si(n=Ks(n,e,r),r)).tag=2,void 0!==t&&null!==t&&(r.callback=t),ui(e,r),Xs(e,n)}};function vi(e,t,n,r,a,i,o){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,i,o):!t.prototype||!t.prototype.isPureReactComponent||(!Pr(n,r)||!Pr(a,i))}function bi(e,t,n){var r=!1,a=la,i=t.contextType;return"object"===typeof i&&null!==i?i=ri(i):(a=ma(t)?fa:da.current,i=(r=null!==(r=t.contextTypes)&&void 0!==r)?ha(e,a):la),t=new t(n,i),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=mi,e.stateNode=t,t._reactInternalFiber=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=a,e.__reactInternalMemoizedMaskedChildContext=i),t}function gi(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&mi.enqueueReplaceState(t,t.state,null)}function yi(e,t,n,r){var a=e.stateNode;a.props=n,a.state=e.memoizedState,a.refs=fi,ii(e);var i=t.contextType;"object"===typeof i&&null!==i?a.context=ri(i):(i=ma(t)?fa:da.current,a.context=ha(e,i)),li(e,n,a,r),a.state=e.memoizedState,"function"===typeof(i=t.getDerivedStateFromProps)&&(hi(e,t,i,n),a.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof a.getSnapshotBeforeUpdate||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||(t=a.state,"function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount(),t!==a.state&&mi.enqueueReplaceState(a,a.state,null),li(e,n,a,r),a.state=e.memoizedState),"function"===typeof a.componentDidMount&&(e.effectTag|=4)}var xi=Array.isArray;function ki(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(o(309));var r=n.stateNode}if(!r)throw Error(o(147,e));var a=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===a?t.ref:((t=function(e){var t=r.refs;t===fi&&(t=r.refs={}),null===e?delete t[a]:t[a]=e})._stringRef=a,t)}if("string"!==typeof e)throw Error(o(284));if(!n._owner)throw Error(o(290,e))}return e}function wi(e,t){if("textarea"!==e.type)throw Error(o(31,"[object Object]"===Object.prototype.toString.call(t)?"object with keys {"+Object.keys(t).join(", ")+"}":t,""))}function Oi(e){function t(t,n){if(e){var r=t.lastEffect;null!==r?(r.nextEffect=n,t.lastEffect=n):t.firstEffect=t.lastEffect=n,n.nextEffect=null,n.effectTag=8}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function a(e,t){return(e=Nu(e,t)).index=0,e.sibling=null,e}function i(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.effectTag=2,n):r:(t.effectTag=2,n):n}function s(t){return e&&null===t.alternate&&(t.effectTag=2),t}function u(e,t,n,r){return null===t||6!==t.tag?((t=Cu(n,e.mode,r)).return=e,t):((t=a(t,n)).return=e,t)}function c(e,t,n,r){return null!==t&&t.elementType===n.type?((r=a(t,n.props)).ref=ki(e,t,n),r.return=e,r):((r=ju(n.type,n.key,n.props,null,e.mode,r)).ref=ki(e,t,n),r.return=e,r)}function l(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Eu(n,e.mode,r)).return=e,t):((t=a(t,n.children||[])).return=e,t)}function d(e,t,n,r,i){return null===t||7!==t.tag?((t=Tu(n,e.mode,r,i)).return=e,t):((t=a(t,n)).return=e,t)}function p(e,t,n){if("string"===typeof t||"number"===typeof t)return(t=Cu(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case ee:return(n=ju(t.type,t.key,t.props,null,e.mode,n)).ref=ki(e,null,t),n.return=e,n;case te:return(t=Eu(t,e.mode,n)).return=e,t}if(xi(t)||me(t))return(t=Tu(t,e.mode,n,null)).return=e,t;wi(e,t)}return null}function f(e,t,n,r){var a=null!==t?t.key:null;if("string"===typeof n||"number"===typeof n)return null!==a?null:u(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case ee:return n.key===a?n.type===ne?d(e,t,n.props.children,r,a):c(e,t,n,r):null;case te:return n.key===a?l(e,t,n,r):null}if(xi(n)||me(n))return null!==a?null:d(e,t,n,r,null);wi(e,n)}return null}function h(e,t,n,r,a){if("string"===typeof r||"number"===typeof r)return u(t,e=e.get(n)||null,""+r,a);if("object"===typeof r&&null!==r){switch(r.$$typeof){case ee:return e=e.get(null===r.key?n:r.key)||null,r.type===ne?d(t,e,r.props.children,a,r.key):c(t,e,r,a);case te:return l(t,e=e.get(null===r.key?n:r.key)||null,r,a)}if(xi(r)||me(r))return d(t,e=e.get(n)||null,r,a,null);wi(t,r)}return null}function m(a,o,s,u){for(var c=null,l=null,d=o,m=o=0,v=null;null!==d&&m<s.length;m++){d.index>m?(v=d,d=null):v=d.sibling;var b=f(a,d,s[m],u);if(null===b){null===d&&(d=v);break}e&&d&&null===b.alternate&&t(a,d),o=i(b,o,m),null===l?c=b:l.sibling=b,l=b,d=v}if(m===s.length)return n(a,d),c;if(null===d){for(;m<s.length;m++)null!==(d=p(a,s[m],u))&&(o=i(d,o,m),null===l?c=d:l.sibling=d,l=d);return c}for(d=r(a,d);m<s.length;m++)null!==(v=h(d,a,m,s[m],u))&&(e&&null!==v.alternate&&d.delete(null===v.key?m:v.key),o=i(v,o,m),null===l?c=v:l.sibling=v,l=v);return e&&d.forEach((function(e){return t(a,e)})),c}function v(a,s,u,c){var l=me(u);if("function"!==typeof l)throw Error(o(150));if(null==(u=l.call(u)))throw Error(o(151));for(var d=l=null,m=s,v=s=0,b=null,g=u.next();null!==m&&!g.done;v++,g=u.next()){m.index>v?(b=m,m=null):b=m.sibling;var y=f(a,m,g.value,c);if(null===y){null===m&&(m=b);break}e&&m&&null===y.alternate&&t(a,m),s=i(y,s,v),null===d?l=y:d.sibling=y,d=y,m=b}if(g.done)return n(a,m),l;if(null===m){for(;!g.done;v++,g=u.next())null!==(g=p(a,g.value,c))&&(s=i(g,s,v),null===d?l=g:d.sibling=g,d=g);return l}for(m=r(a,m);!g.done;v++,g=u.next())null!==(g=h(m,a,v,g.value,c))&&(e&&null!==g.alternate&&m.delete(null===g.key?v:g.key),s=i(g,s,v),null===d?l=g:d.sibling=g,d=g);return e&&m.forEach((function(e){return t(a,e)})),l}return function(e,r,i,u){var c="object"===typeof i&&null!==i&&i.type===ne&&null===i.key;c&&(i=i.props.children);var l="object"===typeof i&&null!==i;if(l)switch(i.$$typeof){case ee:e:{for(l=i.key,c=r;null!==c;){if(c.key===l){switch(c.tag){case 7:if(i.type===ne){n(e,c.sibling),(r=a(c,i.props.children)).return=e,e=r;break e}break;default:if(c.elementType===i.type){n(e,c.sibling),(r=a(c,i.props)).ref=ki(e,c,i),r.return=e,e=r;break e}}n(e,c);break}t(e,c),c=c.sibling}i.type===ne?((r=Tu(i.props.children,e.mode,u,i.key)).return=e,e=r):((u=ju(i.type,i.key,i.props,null,e.mode,u)).ref=ki(e,r,i),u.return=e,e=u)}return s(e);case te:e:{for(c=i.key;null!==r;){if(r.key===c){if(4===r.tag&&r.stateNode.containerInfo===i.containerInfo&&r.stateNode.implementation===i.implementation){n(e,r.sibling),(r=a(r,i.children||[])).return=e,e=r;break e}n(e,r);break}t(e,r),r=r.sibling}(r=Eu(i,e.mode,u)).return=e,e=r}return s(e)}if("string"===typeof i||"number"===typeof i)return i=""+i,null!==r&&6===r.tag?(n(e,r.sibling),(r=a(r,i)).return=e,e=r):(n(e,r),(r=Cu(i,e.mode,u)).return=e,e=r),s(e);if(xi(i))return m(e,r,i,u);if(me(i))return v(e,r,i,u);if(l&&wi(e,i),"undefined"===typeof i&&!c)switch(e.tag){case 1:case 0:throw e=e.type,Error(o(152,e.displayName||e.name||"Component"))}return n(e,r)}}var Ii=Oi(!0),Si=Oi(!1),Ni={},ji={current:Ni},Ti={current:Ni},Ci={current:Ni};function Ei(e){if(e===Ni)throw Error(o(174));return e}function _i(e,t){switch(ca(Ci,t),ca(Ti,e),ca(ji,Ni),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:ze(null,"");break;default:t=ze(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}ua(ji),ca(ji,t)}function Ai(){ua(ji),ua(Ti),ua(Ci)}function Ri(e){Ei(Ci.current);var t=Ei(ji.current),n=ze(t,e.type);t!==n&&(ca(Ti,e),ca(ji,n))}function Di(e){Ti.current===e&&(ua(ji),ua(Ti))}var Fi={current:0};function Mi(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(64&t.effectTag))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}function zi(e,t){return{responder:e,props:t}}var Li=Z.ReactCurrentDispatcher,Pi=Z.ReactCurrentBatchConfig,Bi=0,Wi=null,Ui=null,Vi=null,Gi=!1;function Hi(){throw Error(o(321))}function qi(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!zr(e[n],t[n]))return!1;return!0}function Ki(e,t,n,r,a,i){if(Bi=i,Wi=t,t.memoizedState=null,t.updateQueue=null,t.expirationTime=0,Li.current=null===e||null===e.memoizedState?bo:go,e=n(r,a),t.expirationTime===Bi){i=0;do{if(t.expirationTime=0,!(25>i))throw Error(o(301));i+=1,Vi=Ui=null,t.updateQueue=null,Li.current=yo,e=n(r,a)}while(t.expirationTime===Bi)}if(Li.current=vo,t=null!==Ui&&null!==Ui.next,Bi=0,Vi=Ui=Wi=null,Gi=!1,t)throw Error(o(300));return e}function Xi(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===Vi?Wi.memoizedState=Vi=e:Vi=Vi.next=e,Vi}function Yi(){if(null===Ui){var e=Wi.alternate;e=null!==e?e.memoizedState:null}else e=Ui.next;var t=null===Vi?Wi.memoizedState:Vi.next;if(null!==t)Vi=t,Ui=e;else{if(null===e)throw Error(o(310));e={memoizedState:(Ui=e).memoizedState,baseState:Ui.baseState,baseQueue:Ui.baseQueue,queue:Ui.queue,next:null},null===Vi?Wi.memoizedState=Vi=e:Vi=Vi.next=e}return Vi}function Zi(e,t){return"function"===typeof t?t(e):t}function Ji(e){var t=Yi(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var r=Ui,a=r.baseQueue,i=n.pending;if(null!==i){if(null!==a){var s=a.next;a.next=i.next,i.next=s}r.baseQueue=a=i,n.pending=null}if(null!==a){a=a.next,r=r.baseState;var u=s=i=null,c=a;do{var l=c.expirationTime;if(l<Bi){var d={expirationTime:c.expirationTime,suspenseConfig:c.suspenseConfig,action:c.action,eagerReducer:c.eagerReducer,eagerState:c.eagerState,next:null};null===u?(s=u=d,i=r):u=u.next=d,l>Wi.expirationTime&&(Wi.expirationTime=l,ou(l))}else null!==u&&(u=u.next={expirationTime:1073741823,suspenseConfig:c.suspenseConfig,action:c.action,eagerReducer:c.eagerReducer,eagerState:c.eagerState,next:null}),iu(l,c.suspenseConfig),r=c.eagerReducer===e?c.eagerState:e(r,c.action);c=c.next}while(null!==c&&c!==a);null===u?i=r:u.next=s,zr(r,t.memoizedState)||(Eo=!0),t.memoizedState=r,t.baseState=i,t.baseQueue=u,n.lastRenderedState=r}return[t.memoizedState,n.dispatch]}function Qi(e){var t=Yi(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var r=n.dispatch,a=n.pending,i=t.memoizedState;if(null!==a){n.pending=null;var s=a=a.next;do{i=e(i,s.action),s=s.next}while(s!==a);zr(i,t.memoizedState)||(Eo=!0),t.memoizedState=i,null===t.baseQueue&&(t.baseState=i),n.lastRenderedState=i}return[i,r]}function $i(e){var t=Xi();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e=(e=t.queue={pending:null,dispatch:null,lastRenderedReducer:Zi,lastRenderedState:e}).dispatch=mo.bind(null,Wi,e),[t.memoizedState,e]}function eo(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=Wi.updateQueue)?(t={lastEffect:null},Wi.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function to(){return Yi().memoizedState}function no(e,t,n,r){var a=Xi();Wi.effectTag|=e,a.memoizedState=eo(1|t,n,void 0,void 0===r?null:r)}function ro(e,t,n,r){var a=Yi();r=void 0===r?null:r;var i=void 0;if(null!==Ui){var o=Ui.memoizedState;if(i=o.destroy,null!==r&&qi(r,o.deps))return void eo(t,n,i,r)}Wi.effectTag|=e,a.memoizedState=eo(1|t,n,i,r)}function ao(e,t){return no(516,4,e,t)}function io(e,t){return ro(516,4,e,t)}function oo(e,t){return ro(4,2,e,t)}function so(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function uo(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,ro(4,2,so.bind(null,t,e),n)}function co(){}function lo(e,t){return Xi().memoizedState=[e,void 0===t?null:t],e}function po(e,t){var n=Yi();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&qi(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function fo(e,t){var n=Yi();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&qi(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function ho(e,t,n){var r=Ba();Ua(98>r?98:r,(function(){e(!0)})),Ua(97<r?97:r,(function(){var r=Pi.suspense;Pi.suspense=void 0===t?null:t;try{e(!1),n()}finally{Pi.suspense=r}}))}function mo(e,t,n){var r=qs(),a=pi.suspense;a={expirationTime:r=Ks(r,e,a),suspenseConfig:a,action:n,eagerReducer:null,eagerState:null,next:null};var i=t.pending;if(null===i?a.next=a:(a.next=i.next,i.next=a),t.pending=a,i=e.alternate,e===Wi||null!==i&&i===Wi)Gi=!0,a.expirationTime=Bi,Wi.expirationTime=Bi;else{if(0===e.expirationTime&&(null===i||0===i.expirationTime)&&null!==(i=t.lastRenderedReducer))try{var o=t.lastRenderedState,s=i(o,n);if(a.eagerReducer=i,a.eagerState=s,zr(s,o))return}catch(u){}Xs(e,r)}}var vo={readContext:ri,useCallback:Hi,useContext:Hi,useEffect:Hi,useImperativeHandle:Hi,useLayoutEffect:Hi,useMemo:Hi,useReducer:Hi,useRef:Hi,useState:Hi,useDebugValue:Hi,useResponder:Hi,useDeferredValue:Hi,useTransition:Hi},bo={readContext:ri,useCallback:lo,useContext:ri,useEffect:ao,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,no(4,2,so.bind(null,t,e),n)},useLayoutEffect:function(e,t){return no(4,2,e,t)},useMemo:function(e,t){var n=Xi();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=Xi();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e=(e=r.queue={pending:null,dispatch:null,lastRenderedReducer:e,lastRenderedState:t}).dispatch=mo.bind(null,Wi,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},Xi().memoizedState=e},useState:$i,useDebugValue:co,useResponder:zi,useDeferredValue:function(e,t){var n=$i(e),r=n[0],a=n[1];return ao((function(){var n=Pi.suspense;Pi.suspense=void 0===t?null:t;try{a(e)}finally{Pi.suspense=n}}),[e,t]),r},useTransition:function(e){var t=$i(!1),n=t[0];return t=t[1],[lo(ho.bind(null,t,e),[t,e]),n]}},go={readContext:ri,useCallback:po,useContext:ri,useEffect:io,useImperativeHandle:uo,useLayoutEffect:oo,useMemo:fo,useReducer:Ji,useRef:to,useState:function(){return Ji(Zi)},useDebugValue:co,useResponder:zi,useDeferredValue:function(e,t){var n=Ji(Zi),r=n[0],a=n[1];return io((function(){var n=Pi.suspense;Pi.suspense=void 0===t?null:t;try{a(e)}finally{Pi.suspense=n}}),[e,t]),r},useTransition:function(e){var t=Ji(Zi),n=t[0];return t=t[1],[po(ho.bind(null,t,e),[t,e]),n]}},yo={readContext:ri,useCallback:po,useContext:ri,useEffect:io,useImperativeHandle:uo,useLayoutEffect:oo,useMemo:fo,useReducer:Qi,useRef:to,useState:function(){return Qi(Zi)},useDebugValue:co,useResponder:zi,useDeferredValue:function(e,t){var n=Qi(Zi),r=n[0],a=n[1];return io((function(){var n=Pi.suspense;Pi.suspense=void 0===t?null:t;try{a(e)}finally{Pi.suspense=n}}),[e,t]),r},useTransition:function(e){var t=Qi(Zi),n=t[0];return t=t[1],[po(ho.bind(null,t,e),[t,e]),n]}},xo=null,ko=null,wo=!1;function Oo(e,t){var n=Iu(5,null,null,0);n.elementType="DELETED",n.type="DELETED",n.stateNode=t,n.return=e,n.effectTag=8,null!==e.lastEffect?(e.lastEffect.nextEffect=n,e.lastEffect=n):e.firstEffect=e.lastEffect=n}function Io(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,!0);case 13:default:return!1}}function So(e){if(wo){var t=ko;if(t){var n=t;if(!Io(e,t)){if(!(t=kn(n.nextSibling))||!Io(e,t))return e.effectTag=-1025&e.effectTag|2,wo=!1,void(xo=e);Oo(xo,n)}xo=e,ko=kn(t.firstChild)}else e.effectTag=-1025&e.effectTag|2,wo=!1,xo=e}}function No(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;xo=e}function jo(e){if(e!==xo)return!1;if(!wo)return No(e),wo=!0,!1;var t=e.type;if(5!==e.tag||"head"!==t&&"body"!==t&&!gn(t,e.memoizedProps))for(t=ko;t;)Oo(e,t),t=kn(t.nextSibling);if(No(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(o(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){ko=kn(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}ko=null}}else ko=xo?kn(e.stateNode.nextSibling):null;return!0}function To(){ko=xo=null,wo=!1}var Co=Z.ReactCurrentOwner,Eo=!1;function _o(e,t,n,r){t.child=null===e?Si(t,null,n,r):Ii(t,e.child,n,r)}function Ao(e,t,n,r,a){n=n.render;var i=t.ref;return ni(t,a),r=Ki(e,t,n,r,i,a),null===e||Eo?(t.effectTag|=1,_o(e,t,r,a),t.child):(t.updateQueue=e.updateQueue,t.effectTag&=-517,e.expirationTime<=a&&(e.expirationTime=0),Xo(e,t,a))}function Ro(e,t,n,r,a,i){if(null===e){var o=n.type;return"function"!==typeof o||Su(o)||void 0!==o.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=ju(n.type,null,r,null,t.mode,i)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=o,Do(e,t,o,r,a,i))}return o=e.child,a<i&&(a=o.memoizedProps,(n=null!==(n=n.compare)?n:Pr)(a,r)&&e.ref===t.ref)?Xo(e,t,i):(t.effectTag|=1,(e=Nu(o,r)).ref=t.ref,e.return=t,t.child=e)}function Do(e,t,n,r,a,i){return null!==e&&Pr(e.memoizedProps,r)&&e.ref===t.ref&&(Eo=!1,a<i)?(t.expirationTime=e.expirationTime,Xo(e,t,i)):Mo(e,t,n,r,i)}function Fo(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.effectTag|=128)}function Mo(e,t,n,r,a){var i=ma(n)?fa:da.current;return i=ha(t,i),ni(t,a),n=Ki(e,t,n,r,i,a),null===e||Eo?(t.effectTag|=1,_o(e,t,n,a),t.child):(t.updateQueue=e.updateQueue,t.effectTag&=-517,e.expirationTime<=a&&(e.expirationTime=0),Xo(e,t,a))}function zo(e,t,n,r,a){if(ma(n)){var i=!0;ya(t)}else i=!1;if(ni(t,a),null===t.stateNode)null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),bi(t,n,r),yi(t,n,r,a),r=!0;else if(null===e){var o=t.stateNode,s=t.memoizedProps;o.props=s;var u=o.context,c=n.contextType;"object"===typeof c&&null!==c?c=ri(c):c=ha(t,c=ma(n)?fa:da.current);var l=n.getDerivedStateFromProps,d="function"===typeof l||"function"===typeof o.getSnapshotBeforeUpdate;d||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==r||u!==c)&&gi(t,o,r,c),ai=!1;var p=t.memoizedState;o.state=p,li(t,r,o,a),u=t.memoizedState,s!==r||p!==u||pa.current||ai?("function"===typeof l&&(hi(t,n,l,r),u=t.memoizedState),(s=ai||vi(t,n,s,r,p,u,c))?(d||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||("function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"===typeof o.componentDidMount&&(t.effectTag|=4)):("function"===typeof o.componentDidMount&&(t.effectTag|=4),t.memoizedProps=r,t.memoizedState=u),o.props=r,o.state=u,o.context=c,r=s):("function"===typeof o.componentDidMount&&(t.effectTag|=4),r=!1)}else o=t.stateNode,oi(e,t),s=t.memoizedProps,o.props=t.type===t.elementType?s:Xa(t.type,s),u=o.context,"object"===typeof(c=n.contextType)&&null!==c?c=ri(c):c=ha(t,c=ma(n)?fa:da.current),(d="function"===typeof(l=n.getDerivedStateFromProps)||"function"===typeof o.getSnapshotBeforeUpdate)||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==r||u!==c)&&gi(t,o,r,c),ai=!1,u=t.memoizedState,o.state=u,li(t,r,o,a),p=t.memoizedState,s!==r||u!==p||pa.current||ai?("function"===typeof l&&(hi(t,n,l,r),p=t.memoizedState),(l=ai||vi(t,n,s,r,u,p,c))?(d||"function"!==typeof o.UNSAFE_componentWillUpdate&&"function"!==typeof o.componentWillUpdate||("function"===typeof o.componentWillUpdate&&o.componentWillUpdate(r,p,c),"function"===typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(r,p,c)),"function"===typeof o.componentDidUpdate&&(t.effectTag|=4),"function"===typeof o.getSnapshotBeforeUpdate&&(t.effectTag|=256)):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&u===e.memoizedState||(t.effectTag|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&u===e.memoizedState||(t.effectTag|=256),t.memoizedProps=r,t.memoizedState=p),o.props=r,o.state=p,o.context=c,r=l):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&u===e.memoizedState||(t.effectTag|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&u===e.memoizedState||(t.effectTag|=256),r=!1);return Lo(e,t,n,r,i,a)}function Lo(e,t,n,r,a,i){Fo(e,t);var o=0!==(64&t.effectTag);if(!r&&!o)return a&&xa(t,n,!1),Xo(e,t,i);r=t.stateNode,Co.current=t;var s=o&&"function"!==typeof n.getDerivedStateFromError?null:r.render();return t.effectTag|=1,null!==e&&o?(t.child=Ii(t,e.child,null,i),t.child=Ii(t,null,s,i)):_o(e,t,s,i),t.memoizedState=r.state,a&&xa(t,n,!0),t.child}function Po(e){var t=e.stateNode;t.pendingContext?ba(0,t.pendingContext,t.pendingContext!==t.context):t.context&&ba(0,t.context,!1),_i(e,t.containerInfo)}var Bo,Wo,Uo,Vo={dehydrated:null,retryTime:0};function Go(e,t,n){var r,a=t.mode,i=t.pendingProps,o=Fi.current,s=!1;if((r=0!==(64&t.effectTag))||(r=0!==(2&o)&&(null===e||null!==e.memoizedState)),r?(s=!0,t.effectTag&=-65):null!==e&&null===e.memoizedState||void 0===i.fallback||!0===i.unstable_avoidThisFallback||(o|=1),ca(Fi,1&o),null===e){if(void 0!==i.fallback&&So(t),s){if(s=i.fallback,(i=Tu(null,a,0,null)).return=t,0===(2&t.mode))for(e=null!==t.memoizedState?t.child.child:t.child,i.child=e;null!==e;)e.return=i,e=e.sibling;return(n=Tu(s,a,n,null)).return=t,i.sibling=n,t.memoizedState=Vo,t.child=i,n}return a=i.children,t.memoizedState=null,t.child=Si(t,null,a,n)}if(null!==e.memoizedState){if(a=(e=e.child).sibling,s){if(i=i.fallback,(n=Nu(e,e.pendingProps)).return=t,0===(2&t.mode)&&(s=null!==t.memoizedState?t.child.child:t.child)!==e.child)for(n.child=s;null!==s;)s.return=n,s=s.sibling;return(a=Nu(a,i)).return=t,n.sibling=a,n.childExpirationTime=0,t.memoizedState=Vo,t.child=n,a}return n=Ii(t,e.child,i.children,n),t.memoizedState=null,t.child=n}if(e=e.child,s){if(s=i.fallback,(i=Tu(null,a,0,null)).return=t,i.child=e,null!==e&&(e.return=i),0===(2&t.mode))for(e=null!==t.memoizedState?t.child.child:t.child,i.child=e;null!==e;)e.return=i,e=e.sibling;return(n=Tu(s,a,n,null)).return=t,i.sibling=n,n.effectTag|=2,i.childExpirationTime=0,t.memoizedState=Vo,t.child=i,n}return t.memoizedState=null,t.child=Ii(t,e,i.children,n)}function Ho(e,t){e.expirationTime<t&&(e.expirationTime=t);var n=e.alternate;null!==n&&n.expirationTime<t&&(n.expirationTime=t),ti(e.return,t)}function qo(e,t,n,r,a,i){var o=e.memoizedState;null===o?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailExpiration:0,tailMode:a,lastEffect:i}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=r,o.tail=n,o.tailExpiration=0,o.tailMode=a,o.lastEffect=i)}function Ko(e,t,n){var r=t.pendingProps,a=r.revealOrder,i=r.tail;if(_o(e,t,r.children,n),0!==(2&(r=Fi.current)))r=1&r|2,t.effectTag|=64;else{if(null!==e&&0!==(64&e.effectTag))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Ho(e,n);else if(19===e.tag)Ho(e,n);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(ca(Fi,r),0===(2&t.mode))t.memoizedState=null;else switch(a){case"forwards":for(n=t.child,a=null;null!==n;)null!==(e=n.alternate)&&null===Mi(e)&&(a=n),n=n.sibling;null===(n=a)?(a=t.child,t.child=null):(a=n.sibling,n.sibling=null),qo(t,!1,a,n,i,t.lastEffect);break;case"backwards":for(n=null,a=t.child,t.child=null;null!==a;){if(null!==(e=a.alternate)&&null===Mi(e)){t.child=a;break}e=a.sibling,a.sibling=n,n=a,a=e}qo(t,!0,n,null,i,t.lastEffect);break;case"together":qo(t,!1,null,null,void 0,t.lastEffect);break;default:t.memoizedState=null}return t.child}function Xo(e,t,n){null!==e&&(t.dependencies=e.dependencies);var r=t.expirationTime;if(0!==r&&ou(r),t.childExpirationTime<n)return null;if(null!==e&&t.child!==e.child)throw Error(o(153));if(null!==t.child){for(n=Nu(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Nu(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Yo(e,t){switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Zo(e,t,n){var r=t.pendingProps;switch(t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:return ma(t.type)&&va(),null;case 3:return Ai(),ua(pa),ua(da),(n=t.stateNode).pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),null!==e&&null!==e.child||!jo(t)||(t.effectTag|=4),null;case 5:Di(t),n=Ei(Ci.current);var i=t.type;if(null!==e&&null!=t.stateNode)Wo(e,t,i,r,n),e.ref!==t.ref&&(t.effectTag|=128);else{if(!r){if(null===t.stateNode)throw Error(o(166));return null}if(e=Ei(ji.current),jo(t)){r=t.stateNode,i=t.type;var s=t.memoizedProps;switch(r[In]=t,r[Sn]=s,i){case"iframe":case"object":case"embed":Kt("load",r);break;case"video":case"audio":for(e=0;e<Ze.length;e++)Kt(Ze[e],r);break;case"source":Kt("error",r);break;case"img":case"image":case"link":Kt("error",r),Kt("load",r);break;case"form":Kt("reset",r),Kt("submit",r);break;case"details":Kt("toggle",r);break;case"input":Oe(r,s),Kt("invalid",r),un(n,"onChange");break;case"select":r._wrapperState={wasMultiple:!!s.multiple},Kt("invalid",r),un(n,"onChange");break;case"textarea":_e(r,s),Kt("invalid",r),un(n,"onChange")}for(var u in an(i,s),e=null,s)if(s.hasOwnProperty(u)){var c=s[u];"children"===u?"string"===typeof c?r.textContent!==c&&(e=["children",c]):"number"===typeof c&&r.textContent!==""+c&&(e=["children",""+c]):I.hasOwnProperty(u)&&null!=c&&un(n,u)}switch(i){case"input":xe(r),Ne(r,s,!0);break;case"textarea":xe(r),Re(r);break;case"select":case"option":break;default:"function"===typeof s.onClick&&(r.onclick=cn)}n=e,t.updateQueue=n,null!==n&&(t.effectTag|=4)}else{switch(u=9===n.nodeType?n:n.ownerDocument,e===sn&&(e=Me(i)),e===sn?"script"===i?((e=u.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof r.is?e=u.createElement(i,{is:r.is}):(e=u.createElement(i),"select"===i&&(u=e,r.multiple?u.multiple=!0:r.size&&(u.size=r.size))):e=u.createElementNS(e,i),e[In]=t,e[Sn]=r,Bo(e,t),t.stateNode=e,u=on(i,r),i){case"iframe":case"object":case"embed":Kt("load",e),c=r;break;case"video":case"audio":for(c=0;c<Ze.length;c++)Kt(Ze[c],e);c=r;break;case"source":Kt("error",e),c=r;break;case"img":case"image":case"link":Kt("error",e),Kt("load",e),c=r;break;case"form":Kt("reset",e),Kt("submit",e),c=r;break;case"details":Kt("toggle",e),c=r;break;case"input":Oe(e,r),c=we(e,r),Kt("invalid",e),un(n,"onChange");break;case"option":c=Te(e,r);break;case"select":e._wrapperState={wasMultiple:!!r.multiple},c=a({},r,{value:void 0}),Kt("invalid",e),un(n,"onChange");break;case"textarea":_e(e,r),c=Ee(e,r),Kt("invalid",e),un(n,"onChange");break;default:c=r}an(i,c);var l=c;for(s in l)if(l.hasOwnProperty(s)){var d=l[s];"style"===s?nn(e,d):"dangerouslySetInnerHTML"===s?null!=(d=d?d.__html:void 0)&&Pe(e,d):"children"===s?"string"===typeof d?("textarea"!==i||""!==d)&&Be(e,d):"number"===typeof d&&Be(e,""+d):"suppressContentEditableWarning"!==s&&"suppressHydrationWarning"!==s&&"autoFocus"!==s&&(I.hasOwnProperty(s)?null!=d&&un(n,s):null!=d&&J(e,s,d,u))}switch(i){case"input":xe(e),Ne(e,r,!1);break;case"textarea":xe(e),Re(e);break;case"option":null!=r.value&&e.setAttribute("value",""+ge(r.value));break;case"select":e.multiple=!!r.multiple,null!=(n=r.value)?Ce(e,!!r.multiple,n,!1):null!=r.defaultValue&&Ce(e,!!r.multiple,r.defaultValue,!0);break;default:"function"===typeof c.onClick&&(e.onclick=cn)}bn(i,r)&&(t.effectTag|=4)}null!==t.ref&&(t.effectTag|=128)}return null;case 6:if(e&&null!=t.stateNode)Uo(0,t,e.memoizedProps,r);else{if("string"!==typeof r&&null===t.stateNode)throw Error(o(166));n=Ei(Ci.current),Ei(ji.current),jo(t)?(n=t.stateNode,r=t.memoizedProps,n[In]=t,n.nodeValue!==r&&(t.effectTag|=4)):((n=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[In]=t,t.stateNode=n)}return null;case 13:return ua(Fi),r=t.memoizedState,0!==(64&t.effectTag)?(t.expirationTime=n,t):(n=null!==r,r=!1,null===e?void 0!==t.memoizedProps.fallback&&jo(t):(r=null!==(i=e.memoizedState),n||null===i||null!==(i=e.child.sibling)&&(null!==(s=t.firstEffect)?(t.firstEffect=i,i.nextEffect=s):(t.firstEffect=t.lastEffect=i,i.nextEffect=null),i.effectTag=8)),n&&!r&&0!==(2&t.mode)&&(null===e&&!0!==t.memoizedProps.unstable_avoidThisFallback||0!==(1&Fi.current)?js===xs&&(js=ks):(js!==xs&&js!==ks||(js=ws),0!==As&&null!==Is&&(Ru(Is,Ns),Du(Is,As)))),(n||r)&&(t.effectTag|=4),null);case 4:return Ai(),null;case 10:return ei(t),null;case 17:return ma(t.type)&&va(),null;case 19:if(ua(Fi),null===(r=t.memoizedState))return null;if(i=0!==(64&t.effectTag),null===(s=r.rendering)){if(i)Yo(r,!1);else if(js!==xs||null!==e&&0!==(64&e.effectTag))for(s=t.child;null!==s;){if(null!==(e=Mi(s))){for(t.effectTag|=64,Yo(r,!1),null!==(i=e.updateQueue)&&(t.updateQueue=i,t.effectTag|=4),null===r.lastEffect&&(t.firstEffect=null),t.lastEffect=r.lastEffect,r=t.child;null!==r;)s=n,(i=r).effectTag&=2,i.nextEffect=null,i.firstEffect=null,i.lastEffect=null,null===(e=i.alternate)?(i.childExpirationTime=0,i.expirationTime=s,i.child=null,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null):(i.childExpirationTime=e.childExpirationTime,i.expirationTime=e.expirationTime,i.child=e.child,i.memoizedProps=e.memoizedProps,i.memoizedState=e.memoizedState,i.updateQueue=e.updateQueue,s=e.dependencies,i.dependencies=null===s?null:{expirationTime:s.expirationTime,firstContext:s.firstContext,responders:s.responders}),r=r.sibling;return ca(Fi,1&Fi.current|2),t.child}s=s.sibling}}else{if(!i)if(null!==(e=Mi(s))){if(t.effectTag|=64,i=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.effectTag|=4),Yo(r,!0),null===r.tail&&"hidden"===r.tailMode&&!s.alternate)return null!==(t=t.lastEffect=r.lastEffect)&&(t.nextEffect=null),null}else 2*Pa()-r.renderingStartTime>r.tailExpiration&&1<n&&(t.effectTag|=64,i=!0,Yo(r,!1),t.expirationTime=t.childExpirationTime=n-1);r.isBackwards?(s.sibling=t.child,t.child=s):(null!==(n=r.last)?n.sibling=s:t.child=s,r.last=s)}return null!==r.tail?(0===r.tailExpiration&&(r.tailExpiration=Pa()+500),n=r.tail,r.rendering=n,r.tail=n.sibling,r.lastEffect=t.lastEffect,r.renderingStartTime=Pa(),n.sibling=null,t=Fi.current,ca(Fi,i?1&t|2:1&t),n):null}throw Error(o(156,t.tag))}function Jo(e){switch(e.tag){case 1:ma(e.type)&&va();var t=e.effectTag;return 4096&t?(e.effectTag=-4097&t|64,e):null;case 3:if(Ai(),ua(pa),ua(da),0!==(64&(t=e.effectTag)))throw Error(o(285));return e.effectTag=-4097&t|64,e;case 5:return Di(e),null;case 13:return ua(Fi),4096&(t=e.effectTag)?(e.effectTag=-4097&t|64,e):null;case 19:return ua(Fi),null;case 4:return Ai(),null;case 10:return ei(e),null;default:return null}}function Qo(e,t){return{value:e,source:t,stack:be(t)}}Bo=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Wo=function(e,t,n,r,i){var o=e.memoizedProps;if(o!==r){var s,u,c=t.stateNode;switch(Ei(ji.current),e=null,n){case"input":o=we(c,o),r=we(c,r),e=[];break;case"option":o=Te(c,o),r=Te(c,r),e=[];break;case"select":o=a({},o,{value:void 0}),r=a({},r,{value:void 0}),e=[];break;case"textarea":o=Ee(c,o),r=Ee(c,r),e=[];break;default:"function"!==typeof o.onClick&&"function"===typeof r.onClick&&(c.onclick=cn)}for(s in an(n,r),n=null,o)if(!r.hasOwnProperty(s)&&o.hasOwnProperty(s)&&null!=o[s])if("style"===s)for(u in c=o[s])c.hasOwnProperty(u)&&(n||(n={}),n[u]="");else"dangerouslySetInnerHTML"!==s&&"children"!==s&&"suppressContentEditableWarning"!==s&&"suppressHydrationWarning"!==s&&"autoFocus"!==s&&(I.hasOwnProperty(s)?e||(e=[]):(e=e||[]).push(s,null));for(s in r){var l=r[s];if(c=null!=o?o[s]:void 0,r.hasOwnProperty(s)&&l!==c&&(null!=l||null!=c))if("style"===s)if(c){for(u in c)!c.hasOwnProperty(u)||l&&l.hasOwnProperty(u)||(n||(n={}),n[u]="");for(u in l)l.hasOwnProperty(u)&&c[u]!==l[u]&&(n||(n={}),n[u]=l[u])}else n||(e||(e=[]),e.push(s,n)),n=l;else"dangerouslySetInnerHTML"===s?(l=l?l.__html:void 0,c=c?c.__html:void 0,null!=l&&c!==l&&(e=e||[]).push(s,l)):"children"===s?c===l||"string"!==typeof l&&"number"!==typeof l||(e=e||[]).push(s,""+l):"suppressContentEditableWarning"!==s&&"suppressHydrationWarning"!==s&&(I.hasOwnProperty(s)?(null!=l&&un(i,s),e||c===l||(e=[])):(e=e||[]).push(s,l))}n&&(e=e||[]).push("style",n),i=e,(t.updateQueue=i)&&(t.effectTag|=4)}},Uo=function(e,t,n,r){n!==r&&(t.effectTag|=4)};var $o="function"===typeof WeakSet?WeakSet:Set;function es(e,t){var n=t.source,r=t.stack;null===r&&null!==n&&(r=be(n)),null!==n&&ve(n.type),t=t.value,null!==e&&1===e.tag&&ve(e.type);try{console.error(t)}catch(a){setTimeout((function(){throw a}))}}function ts(e){var t=e.ref;if(null!==t)if("function"===typeof t)try{t(null)}catch(n){gu(e,n)}else t.current=null}function ns(e,t){switch(t.tag){case 0:case 11:case 15:case 22:return;case 1:if(256&t.effectTag&&null!==e){var n=e.memoizedProps,r=e.memoizedState;t=(e=t.stateNode).getSnapshotBeforeUpdate(t.elementType===t.type?n:Xa(t.type,n),r),e.__reactInternalSnapshotBeforeUpdate=t}return;case 3:case 5:case 6:case 4:case 17:return}throw Error(o(163))}function rs(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.destroy;n.destroy=void 0,void 0!==r&&r()}n=n.next}while(n!==t)}}function as(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function is(e,t,n){switch(n.tag){case 0:case 11:case 15:case 22:return void as(3,n);case 1:if(e=n.stateNode,4&n.effectTag)if(null===t)e.componentDidMount();else{var r=n.elementType===n.type?t.memoizedProps:Xa(n.type,t.memoizedProps);e.componentDidUpdate(r,t.memoizedState,e.__reactInternalSnapshotBeforeUpdate)}return void(null!==(t=n.updateQueue)&&di(n,t,e));case 3:if(null!==(t=n.updateQueue)){if(e=null,null!==n.child)switch(n.child.tag){case 5:e=n.child.stateNode;break;case 1:e=n.child.stateNode}di(n,t,e)}return;case 5:return e=n.stateNode,void(null===t&&4&n.effectTag&&bn(n.type,n.memoizedProps)&&e.focus());case 6:case 4:case 12:return;case 13:return void(null===n.memoizedState&&(n=n.alternate,null!==n&&(n=n.memoizedState,null!==n&&(n=n.dehydrated,null!==n&&Mt(n)))));case 19:case 17:case 20:case 21:return}throw Error(o(163))}function os(e,t,n){switch("function"===typeof wu&&wu(t),t.tag){case 0:case 11:case 14:case 15:case 22:if(null!==(e=t.updateQueue)&&null!==(e=e.lastEffect)){var r=e.next;Ua(97<n?97:n,(function(){var e=r;do{var n=e.destroy;if(void 0!==n){var a=t;try{n()}catch(i){gu(a,i)}}e=e.next}while(e!==r)}))}break;case 1:ts(t),"function"===typeof(n=t.stateNode).componentWillUnmount&&function(e,t){try{t.props=e.memoizedProps,t.state=e.memoizedState,t.componentWillUnmount()}catch(n){gu(e,n)}}(t,n);break;case 5:ts(t);break;case 4:ls(e,t,n)}}function ss(e){var t=e.alternate;e.return=null,e.child=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.alternate=null,e.firstEffect=null,e.lastEffect=null,e.pendingProps=null,e.memoizedProps=null,e.stateNode=null,null!==t&&ss(t)}function us(e){return 5===e.tag||3===e.tag||4===e.tag}function cs(e){e:{for(var t=e.return;null!==t;){if(us(t)){var n=t;break e}t=t.return}throw Error(o(160))}switch(t=n.stateNode,n.tag){case 5:var r=!1;break;case 3:case 4:t=t.containerInfo,r=!0;break;default:throw Error(o(161))}16&n.effectTag&&(Be(t,""),n.effectTag&=-17);e:t:for(n=e;;){for(;null===n.sibling;){if(null===n.return||us(n.return)){n=null;break e}n=n.return}for(n.sibling.return=n.return,n=n.sibling;5!==n.tag&&6!==n.tag&&18!==n.tag;){if(2&n.effectTag)continue t;if(null===n.child||4===n.tag)continue t;n.child.return=n,n=n.child}if(!(2&n.effectTag)){n=n.stateNode;break e}}r?function e(t,n,r){var a=t.tag,i=5===a||6===a;if(i)t=i?t.stateNode:t.stateNode.instance,n?8===r.nodeType?r.parentNode.insertBefore(t,n):r.insertBefore(t,n):(8===r.nodeType?(n=r.parentNode).insertBefore(t,r):(n=r).appendChild(t),null!==(r=r._reactRootContainer)&&void 0!==r||null!==n.onclick||(n.onclick=cn));else if(4!==a&&null!==(t=t.child))for(e(t,n,r),t=t.sibling;null!==t;)e(t,n,r),t=t.sibling}(e,n,t):function e(t,n,r){var a=t.tag,i=5===a||6===a;if(i)t=i?t.stateNode:t.stateNode.instance,n?r.insertBefore(t,n):r.appendChild(t);else if(4!==a&&null!==(t=t.child))for(e(t,n,r),t=t.sibling;null!==t;)e(t,n,r),t=t.sibling}(e,n,t)}function ls(e,t,n){for(var r,a,i=t,s=!1;;){if(!s){s=i.return;e:for(;;){if(null===s)throw Error(o(160));switch(r=s.stateNode,s.tag){case 5:a=!1;break e;case 3:case 4:r=r.containerInfo,a=!0;break e}s=s.return}s=!0}if(5===i.tag||6===i.tag){e:for(var u=e,c=i,l=n,d=c;;)if(os(u,d,l),null!==d.child&&4!==d.tag)d.child.return=d,d=d.child;else{if(d===c)break e;for(;null===d.sibling;){if(null===d.return||d.return===c)break e;d=d.return}d.sibling.return=d.return,d=d.sibling}a?(u=r,c=i.stateNode,8===u.nodeType?u.parentNode.removeChild(c):u.removeChild(c)):r.removeChild(i.stateNode)}else if(4===i.tag){if(null!==i.child){r=i.stateNode.containerInfo,a=!0,i.child.return=i,i=i.child;continue}}else if(os(e,i,n),null!==i.child){i.child.return=i,i=i.child;continue}if(i===t)break;for(;null===i.sibling;){if(null===i.return||i.return===t)return;4===(i=i.return).tag&&(s=!1)}i.sibling.return=i.return,i=i.sibling}}function ds(e,t){switch(t.tag){case 0:case 11:case 14:case 15:case 22:return void rs(3,t);case 1:return;case 5:var n=t.stateNode;if(null!=n){var r=t.memoizedProps,a=null!==e?e.memoizedProps:r;e=t.type;var i=t.updateQueue;if(t.updateQueue=null,null!==i){for(n[Sn]=r,"input"===e&&"radio"===r.type&&null!=r.name&&Ie(n,r),on(e,a),t=on(e,r),a=0;a<i.length;a+=2){var s=i[a],u=i[a+1];"style"===s?nn(n,u):"dangerouslySetInnerHTML"===s?Pe(n,u):"children"===s?Be(n,u):J(n,s,u,t)}switch(e){case"input":Se(n,r);break;case"textarea":Ae(n,r);break;case"select":t=n._wrapperState.wasMultiple,n._wrapperState.wasMultiple=!!r.multiple,null!=(e=r.value)?Ce(n,!!r.multiple,e,!1):t!==!!r.multiple&&(null!=r.defaultValue?Ce(n,!!r.multiple,r.defaultValue,!0):Ce(n,!!r.multiple,r.multiple?[]:"",!1))}}}return;case 6:if(null===t.stateNode)throw Error(o(162));return void(t.stateNode.nodeValue=t.memoizedProps);case 3:return void((t=t.stateNode).hydrate&&(t.hydrate=!1,Mt(t.containerInfo)));case 12:return;case 13:if(n=t,null===t.memoizedState?r=!1:(r=!0,n=t.child,Ds=Pa()),null!==n)e:for(e=n;;){if(5===e.tag)i=e.stateNode,r?"function"===typeof(i=i.style).setProperty?i.setProperty("display","none","important"):i.display="none":(i=e.stateNode,a=void 0!==(a=e.memoizedProps.style)&&null!==a&&a.hasOwnProperty("display")?a.display:null,i.style.display=tn("display",a));else if(6===e.tag)e.stateNode.nodeValue=r?"":e.memoizedProps;else{if(13===e.tag&&null!==e.memoizedState&&null===e.memoizedState.dehydrated){(i=e.child.sibling).return=e,e=i;continue}if(null!==e.child){e.child.return=e,e=e.child;continue}}if(e===n)break;for(;null===e.sibling;){if(null===e.return||e.return===n)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}return void ps(t);case 19:return void ps(t);case 17:return}throw Error(o(163))}function ps(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new $o),t.forEach((function(t){var r=xu.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))}))}}var fs="function"===typeof WeakMap?WeakMap:Map;function hs(e,t,n){(n=si(n,null)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Ms||(Ms=!0,zs=r),es(e,t)},n}function ms(e,t,n){(n=si(n,null)).tag=3;var r=e.type.getDerivedStateFromError;if("function"===typeof r){var a=t.value;n.payload=function(){return es(e,t),r(a)}}var i=e.stateNode;return null!==i&&"function"===typeof i.componentDidCatch&&(n.callback=function(){"function"!==typeof r&&(null===Ls?Ls=new Set([this]):Ls.add(this),es(e,t));var n=t.stack;this.componentDidCatch(t.value,{componentStack:null!==n?n:""})}),n}var vs,bs=Math.ceil,gs=Z.ReactCurrentDispatcher,ys=Z.ReactCurrentOwner,xs=0,ks=3,ws=4,Os=0,Is=null,Ss=null,Ns=0,js=xs,Ts=null,Cs=1073741823,Es=1073741823,_s=null,As=0,Rs=!1,Ds=0,Fs=null,Ms=!1,zs=null,Ls=null,Ps=!1,Bs=null,Ws=90,Us=null,Vs=0,Gs=null,Hs=0;function qs(){return 0!==(48&Os)?1073741821-(Pa()/10|0):0!==Hs?Hs:Hs=1073741821-(Pa()/10|0)}function Ks(e,t,n){if(0===(2&(t=t.mode)))return 1073741823;var r=Ba();if(0===(4&t))return 99===r?1073741823:1073741822;if(0!==(16&Os))return Ns;if(null!==n)e=Ka(e,0|n.timeoutMs||5e3,250);else switch(r){case 99:e=1073741823;break;case 98:e=Ka(e,150,100);break;case 97:case 96:e=Ka(e,5e3,250);break;case 95:e=2;break;default:throw Error(o(326))}return null!==Is&&e===Ns&&--e,e}function Xs(e,t){if(50<Vs)throw Vs=0,Gs=null,Error(o(185));if(null!==(e=Ys(e,t))){var n=Ba();1073741823===t?0!==(8&Os)&&0===(48&Os)?$s(e):(Js(e),0===Os&&Ha()):Js(e),0===(4&Os)||98!==n&&99!==n||(null===Us?Us=new Map([[e,t]]):(void 0===(n=Us.get(e))||n>t)&&Us.set(e,t))}}function Ys(e,t){e.expirationTime<t&&(e.expirationTime=t);var n=e.alternate;null!==n&&n.expirationTime<t&&(n.expirationTime=t);var r=e.return,a=null;if(null===r&&3===e.tag)a=e.stateNode;else for(;null!==r;){if(n=r.alternate,r.childExpirationTime<t&&(r.childExpirationTime=t),null!==n&&n.childExpirationTime<t&&(n.childExpirationTime=t),null===r.return&&3===r.tag){a=r.stateNode;break}r=r.return}return null!==a&&(Is===a&&(ou(t),js===ws&&Ru(a,Ns)),Du(a,t)),a}function Zs(e){var t=e.lastExpiredTime;if(0!==t)return t;if(!Au(e,t=e.firstPendingTime))return t;var n=e.lastPingedTime;return 2>=(e=n>(e=e.nextKnownPendingLevel)?n:e)&&t!==e?0:e}function Js(e){if(0!==e.lastExpiredTime)e.callbackExpirationTime=1073741823,e.callbackPriority=99,e.callbackNode=Ga($s.bind(null,e));else{var t=Zs(e),n=e.callbackNode;if(0===t)null!==n&&(e.callbackNode=null,e.callbackExpirationTime=0,e.callbackPriority=90);else{var r=qs();if(1073741823===t?r=99:1===t||2===t?r=95:r=0>=(r=10*(1073741821-t)-10*(1073741821-r))?99:250>=r?98:5250>=r?97:95,null!==n){var a=e.callbackPriority;if(e.callbackExpirationTime===t&&a>=r)return;n!==Aa&&Oa(n)}e.callbackExpirationTime=t,e.callbackPriority=r,t=1073741823===t?Ga($s.bind(null,e)):Va(r,Qs.bind(null,e),{timeout:10*(1073741821-t)-Pa()}),e.callbackNode=t}}}function Qs(e,t){if(Hs=0,t)return Fu(e,t=qs()),Js(e),null;var n=Zs(e);if(0!==n){if(t=e.callbackNode,0!==(48&Os))throw Error(o(327));if(mu(),e===Is&&n===Ns||nu(e,n),null!==Ss){var r=Os;Os|=16;for(var a=au();;)try{uu();break}catch(u){ru(e,u)}if($a(),Os=r,gs.current=a,1===js)throw t=Ts,nu(e,n),Ru(e,n),Js(e),t;if(null===Ss)switch(a=e.finishedWork=e.current.alternate,e.finishedExpirationTime=n,r=js,Is=null,r){case xs:case 1:throw Error(o(345));case 2:Fu(e,2<n?2:n);break;case ks:if(Ru(e,n),n===(r=e.lastSuspendedTime)&&(e.nextKnownPendingLevel=du(a)),1073741823===Cs&&10<(a=Ds+500-Pa())){if(Rs){var i=e.lastPingedTime;if(0===i||i>=n){e.lastPingedTime=n,nu(e,n);break}}if(0!==(i=Zs(e))&&i!==n)break;if(0!==r&&r!==n){e.lastPingedTime=r;break}e.timeoutHandle=yn(pu.bind(null,e),a);break}pu(e);break;case ws:if(Ru(e,n),n===(r=e.lastSuspendedTime)&&(e.nextKnownPendingLevel=du(a)),Rs&&(0===(a=e.lastPingedTime)||a>=n)){e.lastPingedTime=n,nu(e,n);break}if(0!==(a=Zs(e))&&a!==n)break;if(0!==r&&r!==n){e.lastPingedTime=r;break}if(1073741823!==Es?r=10*(1073741821-Es)-Pa():1073741823===Cs?r=0:(r=10*(1073741821-Cs)-5e3,0>(r=(a=Pa())-r)&&(r=0),(n=10*(1073741821-n)-a)<(r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*bs(r/1960))-r)&&(r=n)),10<r){e.timeoutHandle=yn(pu.bind(null,e),r);break}pu(e);break;case 5:if(1073741823!==Cs&&null!==_s){i=Cs;var s=_s;if(0>=(r=0|s.busyMinDurationMs)?r=0:(a=0|s.busyDelayMs,r=(i=Pa()-(10*(1073741821-i)-(0|s.timeoutMs||5e3)))<=a?0:a+r-i),10<r){Ru(e,n),e.timeoutHandle=yn(pu.bind(null,e),r);break}}pu(e);break;default:throw Error(o(329))}if(Js(e),e.callbackNode===t)return Qs.bind(null,e)}}return null}function $s(e){var t=e.lastExpiredTime;if(t=0!==t?t:1073741823,0!==(48&Os))throw Error(o(327));if(mu(),e===Is&&t===Ns||nu(e,t),null!==Ss){var n=Os;Os|=16;for(var r=au();;)try{su();break}catch(a){ru(e,a)}if($a(),Os=n,gs.current=r,1===js)throw n=Ts,nu(e,t),Ru(e,t),Js(e),n;if(null!==Ss)throw Error(o(261));e.finishedWork=e.current.alternate,e.finishedExpirationTime=t,Is=null,pu(e),Js(e)}return null}function eu(e,t){var n=Os;Os|=1;try{return e(t)}finally{0===(Os=n)&&Ha()}}function tu(e,t){var n=Os;Os&=-2,Os|=8;try{return e(t)}finally{0===(Os=n)&&Ha()}}function nu(e,t){e.finishedWork=null,e.finishedExpirationTime=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,xn(n)),null!==Ss)for(n=Ss.return;null!==n;){var r=n;switch(r.tag){case 1:null!==(r=r.type.childContextTypes)&&void 0!==r&&va();break;case 3:Ai(),ua(pa),ua(da);break;case 5:Di(r);break;case 4:Ai();break;case 13:case 19:ua(Fi);break;case 10:ei(r)}n=n.return}Is=e,Ss=Nu(e.current,null),Ns=t,js=xs,Ts=null,Es=Cs=1073741823,_s=null,As=0,Rs=!1}function ru(e,t){for(;;){try{if($a(),Li.current=vo,Gi)for(var n=Wi.memoizedState;null!==n;){var r=n.queue;null!==r&&(r.pending=null),n=n.next}if(Bi=0,Vi=Ui=Wi=null,Gi=!1,null===Ss||null===Ss.return)return js=1,Ts=t,Ss=null;e:{var a=e,i=Ss.return,o=Ss,s=t;if(t=Ns,o.effectTag|=2048,o.firstEffect=o.lastEffect=null,null!==s&&"object"===typeof s&&"function"===typeof s.then){var u=s;if(0===(2&o.mode)){var c=o.alternate;c?(o.updateQueue=c.updateQueue,o.memoizedState=c.memoizedState,o.expirationTime=c.expirationTime):(o.updateQueue=null,o.memoizedState=null)}var l=0!==(1&Fi.current),d=i;do{var p;if(p=13===d.tag){var f=d.memoizedState;if(null!==f)p=null!==f.dehydrated;else{var h=d.memoizedProps;p=void 0!==h.fallback&&(!0!==h.unstable_avoidThisFallback||!l)}}if(p){var m=d.updateQueue;if(null===m){var v=new Set;v.add(u),d.updateQueue=v}else m.add(u);if(0===(2&d.mode)){if(d.effectTag|=64,o.effectTag&=-2981,1===o.tag)if(null===o.alternate)o.tag=17;else{var b=si(1073741823,null);b.tag=2,ui(o,b)}o.expirationTime=1073741823;break e}s=void 0,o=t;var g=a.pingCache;if(null===g?(g=a.pingCache=new fs,s=new Set,g.set(u,s)):void 0===(s=g.get(u))&&(s=new Set,g.set(u,s)),!s.has(o)){s.add(o);var y=yu.bind(null,a,u,o);u.then(y,y)}d.effectTag|=4096,d.expirationTime=t;break e}d=d.return}while(null!==d);s=Error((ve(o.type)||"A React component")+" suspended while rendering, but no fallback UI was specified.\n\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display."+be(o))}5!==js&&(js=2),s=Qo(s,o),d=i;do{switch(d.tag){case 3:u=s,d.effectTag|=4096,d.expirationTime=t,ci(d,hs(d,u,t));break e;case 1:u=s;var x=d.type,k=d.stateNode;if(0===(64&d.effectTag)&&("function"===typeof x.getDerivedStateFromError||null!==k&&"function"===typeof k.componentDidCatch&&(null===Ls||!Ls.has(k)))){d.effectTag|=4096,d.expirationTime=t,ci(d,ms(d,u,t));break e}}d=d.return}while(null!==d)}Ss=lu(Ss)}catch(w){t=w;continue}break}}function au(){var e=gs.current;return gs.current=vo,null===e?vo:e}function iu(e,t){e<Cs&&2<e&&(Cs=e),null!==t&&e<Es&&2<e&&(Es=e,_s=t)}function ou(e){e>As&&(As=e)}function su(){for(;null!==Ss;)Ss=cu(Ss)}function uu(){for(;null!==Ss&&!Ra();)Ss=cu(Ss)}function cu(e){var t=vs(e.alternate,e,Ns);return e.memoizedProps=e.pendingProps,null===t&&(t=lu(e)),ys.current=null,t}function lu(e){Ss=e;do{var t=Ss.alternate;if(e=Ss.return,0===(2048&Ss.effectTag)){if(t=Zo(t,Ss,Ns),1===Ns||1!==Ss.childExpirationTime){for(var n=0,r=Ss.child;null!==r;){var a=r.expirationTime,i=r.childExpirationTime;a>n&&(n=a),i>n&&(n=i),r=r.sibling}Ss.childExpirationTime=n}if(null!==t)return t;null!==e&&0===(2048&e.effectTag)&&(null===e.firstEffect&&(e.firstEffect=Ss.firstEffect),null!==Ss.lastEffect&&(null!==e.lastEffect&&(e.lastEffect.nextEffect=Ss.firstEffect),e.lastEffect=Ss.lastEffect),1<Ss.effectTag&&(null!==e.lastEffect?e.lastEffect.nextEffect=Ss:e.firstEffect=Ss,e.lastEffect=Ss))}else{if(null!==(t=Jo(Ss)))return t.effectTag&=2047,t;null!==e&&(e.firstEffect=e.lastEffect=null,e.effectTag|=2048)}if(null!==(t=Ss.sibling))return t;Ss=e}while(null!==Ss);return js===xs&&(js=5),null}function du(e){var t=e.expirationTime;return t>(e=e.childExpirationTime)?t:e}function pu(e){var t=Ba();return Ua(99,fu.bind(null,e,t)),null}function fu(e,t){do{mu()}while(null!==Bs);if(0!==(48&Os))throw Error(o(327));var n=e.finishedWork,r=e.finishedExpirationTime;if(null===n)return null;if(e.finishedWork=null,e.finishedExpirationTime=0,n===e.current)throw Error(o(177));e.callbackNode=null,e.callbackExpirationTime=0,e.callbackPriority=90,e.nextKnownPendingLevel=0;var a=du(n);if(e.firstPendingTime=a,r<=e.lastSuspendedTime?e.firstSuspendedTime=e.lastSuspendedTime=e.nextKnownPendingLevel=0:r<=e.firstSuspendedTime&&(e.firstSuspendedTime=r-1),r<=e.lastPingedTime&&(e.lastPingedTime=0),r<=e.lastExpiredTime&&(e.lastExpiredTime=0),e===Is&&(Ss=Is=null,Ns=0),1<n.effectTag?null!==n.lastEffect?(n.lastEffect.nextEffect=n,a=n.firstEffect):a=n:a=n.firstEffect,null!==a){var i=Os;Os|=32,ys.current=null,mn=qt;var s=fn();if(hn(s)){if("selectionStart"in s)var u={start:s.selectionStart,end:s.selectionEnd};else e:{var c=(u=(u=s.ownerDocument)&&u.defaultView||window).getSelection&&u.getSelection();if(c&&0!==c.rangeCount){u=c.anchorNode;var l=c.anchorOffset,d=c.focusNode;c=c.focusOffset;try{u.nodeType,d.nodeType}catch(N){u=null;break e}var p=0,f=-1,h=-1,m=0,v=0,b=s,g=null;t:for(;;){for(var y;b!==u||0!==l&&3!==b.nodeType||(f=p+l),b!==d||0!==c&&3!==b.nodeType||(h=p+c),3===b.nodeType&&(p+=b.nodeValue.length),null!==(y=b.firstChild);)g=b,b=y;for(;;){if(b===s)break t;if(g===u&&++m===l&&(f=p),g===d&&++v===c&&(h=p),null!==(y=b.nextSibling))break;g=(b=g).parentNode}b=y}u=-1===f||-1===h?null:{start:f,end:h}}else u=null}u=u||{start:0,end:0}}else u=null;vn={activeElementDetached:null,focusedElem:s,selectionRange:u},qt=!1,Fs=a;do{try{hu()}catch(N){if(null===Fs)throw Error(o(330));gu(Fs,N),Fs=Fs.nextEffect}}while(null!==Fs);Fs=a;do{try{for(s=e,u=t;null!==Fs;){var x=Fs.effectTag;if(16&x&&Be(Fs.stateNode,""),128&x){var k=Fs.alternate;if(null!==k){var w=k.ref;null!==w&&("function"===typeof w?w(null):w.current=null)}}switch(1038&x){case 2:cs(Fs),Fs.effectTag&=-3;break;case 6:cs(Fs),Fs.effectTag&=-3,ds(Fs.alternate,Fs);break;case 1024:Fs.effectTag&=-1025;break;case 1028:Fs.effectTag&=-1025,ds(Fs.alternate,Fs);break;case 4:ds(Fs.alternate,Fs);break;case 8:ls(s,l=Fs,u),ss(l)}Fs=Fs.nextEffect}}catch(N){if(null===Fs)throw Error(o(330));gu(Fs,N),Fs=Fs.nextEffect}}while(null!==Fs);if(w=vn,k=fn(),x=w.focusedElem,u=w.selectionRange,k!==x&&x&&x.ownerDocument&&function e(t,n){return!(!t||!n)&&(t===n||(!t||3!==t.nodeType)&&(n&&3===n.nodeType?e(t,n.parentNode):"contains"in t?t.contains(n):!!t.compareDocumentPosition&&!!(16&t.compareDocumentPosition(n))))}(x.ownerDocument.documentElement,x)){null!==u&&hn(x)&&(k=u.start,void 0===(w=u.end)&&(w=k),"selectionStart"in x?(x.selectionStart=k,x.selectionEnd=Math.min(w,x.value.length)):(w=(k=x.ownerDocument||document)&&k.defaultView||window).getSelection&&(w=w.getSelection(),l=x.textContent.length,s=Math.min(u.start,l),u=void 0===u.end?s:Math.min(u.end,l),!w.extend&&s>u&&(l=u,u=s,s=l),l=pn(x,s),d=pn(x,u),l&&d&&(1!==w.rangeCount||w.anchorNode!==l.node||w.anchorOffset!==l.offset||w.focusNode!==d.node||w.focusOffset!==d.offset)&&((k=k.createRange()).setStart(l.node,l.offset),w.removeAllRanges(),s>u?(w.addRange(k),w.extend(d.node,d.offset)):(k.setEnd(d.node,d.offset),w.addRange(k))))),k=[];for(w=x;w=w.parentNode;)1===w.nodeType&&k.push({element:w,left:w.scrollLeft,top:w.scrollTop});for("function"===typeof x.focus&&x.focus(),x=0;x<k.length;x++)(w=k[x]).element.scrollLeft=w.left,w.element.scrollTop=w.top}qt=!!mn,vn=mn=null,e.current=n,Fs=a;do{try{for(x=e;null!==Fs;){var O=Fs.effectTag;if(36&O&&is(x,Fs.alternate,Fs),128&O){k=void 0;var I=Fs.ref;if(null!==I){var S=Fs.stateNode;switch(Fs.tag){case 5:k=S;break;default:k=S}"function"===typeof I?I(k):I.current=k}}Fs=Fs.nextEffect}}catch(N){if(null===Fs)throw Error(o(330));gu(Fs,N),Fs=Fs.nextEffect}}while(null!==Fs);Fs=null,Da(),Os=i}else e.current=n;if(Ps)Ps=!1,Bs=e,Ws=t;else for(Fs=a;null!==Fs;)t=Fs.nextEffect,Fs.nextEffect=null,Fs=t;if(0===(t=e.firstPendingTime)&&(Ls=null),1073741823===t?e===Gs?Vs++:(Vs=0,Gs=e):Vs=0,"function"===typeof ku&&ku(n.stateNode,r),Js(e),Ms)throw Ms=!1,e=zs,zs=null,e;return 0!==(8&Os)||Ha(),null}function hu(){for(;null!==Fs;){var e=Fs.effectTag;0!==(256&e)&&ns(Fs.alternate,Fs),0===(512&e)||Ps||(Ps=!0,Va(97,(function(){return mu(),null}))),Fs=Fs.nextEffect}}function mu(){if(90!==Ws){var e=97<Ws?97:Ws;return Ws=90,Ua(e,vu)}}function vu(){if(null===Bs)return!1;var e=Bs;if(Bs=null,0!==(48&Os))throw Error(o(331));var t=Os;for(Os|=32,e=e.current.firstEffect;null!==e;){try{var n=e;if(0!==(512&n.effectTag))switch(n.tag){case 0:case 11:case 15:case 22:rs(5,n),as(5,n)}}catch(r){if(null===e)throw Error(o(330));gu(e,r)}n=e.nextEffect,e.nextEffect=null,e=n}return Os=t,Ha(),!0}function bu(e,t,n){ui(e,t=hs(e,t=Qo(n,t),1073741823)),null!==(e=Ys(e,1073741823))&&Js(e)}function gu(e,t){if(3===e.tag)bu(e,e,t);else for(var n=e.return;null!==n;){if(3===n.tag){bu(n,e,t);break}if(1===n.tag){var r=n.stateNode;if("function"===typeof n.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===Ls||!Ls.has(r))){ui(n,e=ms(n,e=Qo(t,e),1073741823)),null!==(n=Ys(n,1073741823))&&Js(n);break}}n=n.return}}function yu(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),Is===e&&Ns===n?js===ws||js===ks&&1073741823===Cs&&Pa()-Ds<500?nu(e,Ns):Rs=!0:Au(e,n)&&(0!==(t=e.lastPingedTime)&&t<n||(e.lastPingedTime=n,Js(e)))}function xu(e,t){var n=e.stateNode;null!==n&&n.delete(t),0===(t=0)&&(t=Ks(t=qs(),e,null)),null!==(e=Ys(e,t))&&Js(e)}vs=function(e,t,n){var r=t.expirationTime;if(null!==e){var a=t.pendingProps;if(e.memoizedProps!==a||pa.current)Eo=!0;else{if(r<n){switch(Eo=!1,t.tag){case 3:Po(t),To();break;case 5:if(Ri(t),4&t.mode&&1!==n&&a.hidden)return t.expirationTime=t.childExpirationTime=1,null;break;case 1:ma(t.type)&&ya(t);break;case 4:_i(t,t.stateNode.containerInfo);break;case 10:r=t.memoizedProps.value,a=t.type._context,ca(Ya,a._currentValue),a._currentValue=r;break;case 13:if(null!==t.memoizedState)return 0!==(r=t.child.childExpirationTime)&&r>=n?Go(e,t,n):(ca(Fi,1&Fi.current),null!==(t=Xo(e,t,n))?t.sibling:null);ca(Fi,1&Fi.current);break;case 19:if(r=t.childExpirationTime>=n,0!==(64&e.effectTag)){if(r)return Ko(e,t,n);t.effectTag|=64}if(null!==(a=t.memoizedState)&&(a.rendering=null,a.tail=null),ca(Fi,Fi.current),!r)return null}return Xo(e,t,n)}Eo=!1}}else Eo=!1;switch(t.expirationTime=0,t.tag){case 2:if(r=t.type,null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),e=t.pendingProps,a=ha(t,da.current),ni(t,n),a=Ki(null,t,r,e,a,n),t.effectTag|=1,"object"===typeof a&&null!==a&&"function"===typeof a.render&&void 0===a.$$typeof){if(t.tag=1,t.memoizedState=null,t.updateQueue=null,ma(r)){var i=!0;ya(t)}else i=!1;t.memoizedState=null!==a.state&&void 0!==a.state?a.state:null,ii(t);var s=r.getDerivedStateFromProps;"function"===typeof s&&hi(t,r,s,e),a.updater=mi,t.stateNode=a,a._reactInternalFiber=t,yi(t,r,e,n),t=Lo(null,t,r,!0,i,n)}else t.tag=0,_o(null,t,a,n),t=t.child;return t;case 16:e:{if(a=t.elementType,null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),e=t.pendingProps,function(e){if(-1===e._status){e._status=0;var t=e._ctor;t=t(),e._result=t,t.then((function(t){0===e._status&&(t=t.default,e._status=1,e._result=t)}),(function(t){0===e._status&&(e._status=2,e._result=t)}))}}(a),1!==a._status)throw a._result;switch(a=a._result,t.type=a,i=t.tag=function(e){if("function"===typeof e)return Su(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===ue)return 11;if(e===de)return 14}return 2}(a),e=Xa(a,e),i){case 0:t=Mo(null,t,a,e,n);break e;case 1:t=zo(null,t,a,e,n);break e;case 11:t=Ao(null,t,a,e,n);break e;case 14:t=Ro(null,t,a,Xa(a.type,e),r,n);break e}throw Error(o(306,a,""))}return t;case 0:return r=t.type,a=t.pendingProps,Mo(e,t,r,a=t.elementType===r?a:Xa(r,a),n);case 1:return r=t.type,a=t.pendingProps,zo(e,t,r,a=t.elementType===r?a:Xa(r,a),n);case 3:if(Po(t),r=t.updateQueue,null===e||null===r)throw Error(o(282));if(r=t.pendingProps,a=null!==(a=t.memoizedState)?a.element:null,oi(e,t),li(t,r,null,n),(r=t.memoizedState.element)===a)To(),t=Xo(e,t,n);else{if((a=t.stateNode.hydrate)&&(ko=kn(t.stateNode.containerInfo.firstChild),xo=t,a=wo=!0),a)for(n=Si(t,null,r,n),t.child=n;n;)n.effectTag=-3&n.effectTag|1024,n=n.sibling;else _o(e,t,r,n),To();t=t.child}return t;case 5:return Ri(t),null===e&&So(t),r=t.type,a=t.pendingProps,i=null!==e?e.memoizedProps:null,s=a.children,gn(r,a)?s=null:null!==i&&gn(r,i)&&(t.effectTag|=16),Fo(e,t),4&t.mode&&1!==n&&a.hidden?(t.expirationTime=t.childExpirationTime=1,t=null):(_o(e,t,s,n),t=t.child),t;case 6:return null===e&&So(t),null;case 13:return Go(e,t,n);case 4:return _i(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=Ii(t,null,r,n):_o(e,t,r,n),t.child;case 11:return r=t.type,a=t.pendingProps,Ao(e,t,r,a=t.elementType===r?a:Xa(r,a),n);case 7:return _o(e,t,t.pendingProps,n),t.child;case 8:case 12:return _o(e,t,t.pendingProps.children,n),t.child;case 10:e:{r=t.type._context,a=t.pendingProps,s=t.memoizedProps,i=a.value;var u=t.type._context;if(ca(Ya,u._currentValue),u._currentValue=i,null!==s)if(u=s.value,0===(i=zr(u,i)?0:0|("function"===typeof r._calculateChangedBits?r._calculateChangedBits(u,i):1073741823))){if(s.children===a.children&&!pa.current){t=Xo(e,t,n);break e}}else for(null!==(u=t.child)&&(u.return=t);null!==u;){var c=u.dependencies;if(null!==c){s=u.child;for(var l=c.firstContext;null!==l;){if(l.context===r&&0!==(l.observedBits&i)){1===u.tag&&((l=si(n,null)).tag=2,ui(u,l)),u.expirationTime<n&&(u.expirationTime=n),null!==(l=u.alternate)&&l.expirationTime<n&&(l.expirationTime=n),ti(u.return,n),c.expirationTime<n&&(c.expirationTime=n);break}l=l.next}}else s=10===u.tag&&u.type===t.type?null:u.child;if(null!==s)s.return=u;else for(s=u;null!==s;){if(s===t){s=null;break}if(null!==(u=s.sibling)){u.return=s.return,s=u;break}s=s.return}u=s}_o(e,t,a.children,n),t=t.child}return t;case 9:return a=t.type,r=(i=t.pendingProps).children,ni(t,n),r=r(a=ri(a,i.unstable_observedBits)),t.effectTag|=1,_o(e,t,r,n),t.child;case 14:return i=Xa(a=t.type,t.pendingProps),Ro(e,t,a,i=Xa(a.type,i),r,n);case 15:return Do(e,t,t.type,t.pendingProps,r,n);case 17:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:Xa(r,a),null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),t.tag=1,ma(r)?(e=!0,ya(t)):e=!1,ni(t,n),bi(t,r,a),yi(t,r,a,n),Lo(null,t,r,!0,e,n);case 19:return Ko(e,t,n)}throw Error(o(156,t.tag))};var ku=null,wu=null;function Ou(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.effectTag=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childExpirationTime=this.expirationTime=0,this.alternate=null}function Iu(e,t,n,r){return new Ou(e,t,n,r)}function Su(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Nu(e,t){var n=e.alternate;return null===n?((n=Iu(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.effectTag=0,n.nextEffect=null,n.firstEffect=null,n.lastEffect=null),n.childExpirationTime=e.childExpirationTime,n.expirationTime=e.expirationTime,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{expirationTime:t.expirationTime,firstContext:t.firstContext,responders:t.responders},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function ju(e,t,n,r,a,i){var s=2;if(r=e,"function"===typeof e)Su(e)&&(s=1);else if("string"===typeof e)s=5;else e:switch(e){case ne:return Tu(n.children,a,i,t);case se:s=8,a|=7;break;case re:s=8,a|=1;break;case ae:return(e=Iu(12,n,t,8|a)).elementType=ae,e.type=ae,e.expirationTime=i,e;case ce:return(e=Iu(13,n,t,a)).type=ce,e.elementType=ce,e.expirationTime=i,e;case le:return(e=Iu(19,n,t,a)).elementType=le,e.expirationTime=i,e;default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case ie:s=10;break e;case oe:s=9;break e;case ue:s=11;break e;case de:s=14;break e;case pe:s=16,r=null;break e;case fe:s=22;break e}throw Error(o(130,null==e?e:typeof e,""))}return(t=Iu(s,n,t,a)).elementType=e,t.type=r,t.expirationTime=i,t}function Tu(e,t,n,r){return(e=Iu(7,e,r,t)).expirationTime=n,e}function Cu(e,t,n){return(e=Iu(6,e,null,t)).expirationTime=n,e}function Eu(e,t,n){return(t=Iu(4,null!==e.children?e.children:[],e.key,t)).expirationTime=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function _u(e,t,n){this.tag=t,this.current=null,this.containerInfo=e,this.pingCache=this.pendingChildren=null,this.finishedExpirationTime=0,this.finishedWork=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=n,this.callbackNode=null,this.callbackPriority=90,this.lastExpiredTime=this.lastPingedTime=this.nextKnownPendingLevel=this.lastSuspendedTime=this.firstSuspendedTime=this.firstPendingTime=0}function Au(e,t){var n=e.firstSuspendedTime;return e=e.lastSuspendedTime,0!==n&&n>=t&&e<=t}function Ru(e,t){var n=e.firstSuspendedTime,r=e.lastSuspendedTime;n<t&&(e.firstSuspendedTime=t),(r>t||0===n)&&(e.lastSuspendedTime=t),t<=e.lastPingedTime&&(e.lastPingedTime=0),t<=e.lastExpiredTime&&(e.lastExpiredTime=0)}function Du(e,t){t>e.firstPendingTime&&(e.firstPendingTime=t);var n=e.firstSuspendedTime;0!==n&&(t>=n?e.firstSuspendedTime=e.lastSuspendedTime=e.nextKnownPendingLevel=0:t>=e.lastSuspendedTime&&(e.lastSuspendedTime=t+1),t>e.nextKnownPendingLevel&&(e.nextKnownPendingLevel=t))}function Fu(e,t){var n=e.lastExpiredTime;(0===n||n>t)&&(e.lastExpiredTime=t)}function Mu(e,t,n,r){var a=t.current,i=qs(),s=pi.suspense;i=Ks(i,a,s);e:if(n){t:{if($e(n=n._reactInternalFiber)!==n||1!==n.tag)throw Error(o(170));var u=n;do{switch(u.tag){case 3:u=u.stateNode.context;break t;case 1:if(ma(u.type)){u=u.stateNode.__reactInternalMemoizedMergedChildContext;break t}}u=u.return}while(null!==u);throw Error(o(171))}if(1===n.tag){var c=n.type;if(ma(c)){n=ga(n,c,u);break e}}n=u}else n=la;return null===t.context?t.context=n:t.pendingContext=n,(t=si(i,s)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),ui(a,t),Xs(a,i),i}function zu(e){if(!(e=e.current).child)return null;switch(e.child.tag){case 5:default:return e.child.stateNode}}function Lu(e,t){null!==(e=e.memoizedState)&&null!==e.dehydrated&&e.retryTime<t&&(e.retryTime=t)}function Pu(e,t){Lu(e,t),(e=e.alternate)&&Lu(e,t)}function Bu(e,t,n){var r=new _u(e,t,n=null!=n&&!0===n.hydrate),a=Iu(3,null,null,2===t?7:1===t?3:0);r.current=a,a.stateNode=r,ii(a),e[Nn]=r.current,n&&0!==t&&function(e,t){var n=Qe(t);Nt.forEach((function(e){ht(e,t,n)})),jt.forEach((function(e){ht(e,t,n)}))}(0,9===e.nodeType?e:e.ownerDocument),this._internalRoot=r}function Wu(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Uu(e,t,n,r,a){var i=n._reactRootContainer;if(i){var o=i._internalRoot;if("function"===typeof a){var s=a;a=function(){var e=zu(o);s.call(e)}}Mu(t,o,e,a)}else{if(i=n._reactRootContainer=function(e,t){if(t||(t=!(!(t=e?9===e.nodeType?e.documentElement:e.firstChild:null)||1!==t.nodeType||!t.hasAttribute("data-reactroot"))),!t)for(var n;n=e.lastChild;)e.removeChild(n);return new Bu(e,0,t?{hydrate:!0}:void 0)}(n,r),o=i._internalRoot,"function"===typeof a){var u=a;a=function(){var e=zu(o);u.call(e)}}tu((function(){Mu(t,o,e,a)}))}return zu(o)}function Vu(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:te,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}function Gu(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Wu(t))throw Error(o(200));return Vu(e,t,null,n)}Bu.prototype.render=function(e){Mu(e,this._internalRoot,null,null)},Bu.prototype.unmount=function(){var e=this._internalRoot,t=e.containerInfo;Mu(null,e,null,(function(){t[Nn]=null}))},mt=function(e){if(13===e.tag){var t=Ka(qs(),150,100);Xs(e,t),Pu(e,t)}},vt=function(e){13===e.tag&&(Xs(e,3),Pu(e,3))},bt=function(e){if(13===e.tag){var t=qs();Xs(e,t=Ks(t,e,null)),Pu(e,t)}},T=function(e,t,n){switch(t){case"input":if(Se(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var a=En(r);if(!a)throw Error(o(90));ke(r),Se(r,a)}}}break;case"textarea":Ae(e,n);break;case"select":null!=(t=n.value)&&Ce(e,!!n.multiple,t,!1)}},D=eu,F=function(e,t,n,r,a){var i=Os;Os|=4;try{return Ua(98,e.bind(null,t,n,r,a))}finally{0===(Os=i)&&Ha()}},M=function(){0===(49&Os)&&(function(){if(null!==Us){var e=Us;Us=null,e.forEach((function(e,t){Fu(t,e),Js(t)})),Ha()}}(),mu())},z=function(e,t){var n=Os;Os|=2;try{return e(t)}finally{0===(Os=n)&&Ha()}};var Hu={Events:[Tn,Cn,En,N,O,zn,function(e){at(e,Mn)},A,R,Jt,st,mu,{current:!1}]};!function(e){var t=e.findFiberByHostInstance;(function(e){if("undefined"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)return!1;var t=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(t.isDisabled||!t.supportsFiber)return!0;try{var n=t.inject(e);ku=function(e){try{t.onCommitFiberRoot(n,e,void 0,64===(64&e.current.effectTag))}catch(r){}},wu=function(e){try{t.onCommitFiberUnmount(n,e)}catch(r){}}}catch(r){}})(a({},e,{overrideHookState:null,overrideProps:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Z.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=nt(e))?null:e.stateNode},findFiberByHostInstance:function(e){return t?t(e):null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null}))}({findFiberByHostInstance:jn,bundleType:0,version:"16.13.1",rendererPackageName:"react-dom"}),t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Hu,t.createPortal=Gu,t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternalFiber;if(void 0===t){if("function"===typeof e.render)throw Error(o(188));throw Error(o(268,Object.keys(e)))}return e=null===(e=nt(t))?null:e.stateNode},t.flushSync=function(e,t){if(0!==(48&Os))throw Error(o(187));var n=Os;Os|=1;try{return Ua(99,e.bind(null,t))}finally{Os=n,Ha()}},t.hydrate=function(e,t,n){if(!Wu(t))throw Error(o(200));return Uu(null,e,t,!0,n)},t.render=function(e,t,n){if(!Wu(t))throw Error(o(200));return Uu(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Wu(e))throw Error(o(40));return!!e._reactRootContainer&&(tu((function(){Uu(null,null,e,!1,(function(){e._reactRootContainer=null,e[Nn]=null}))})),!0)},t.unstable_batchedUpdates=eu,t.unstable_createPortal=function(e,t){return Gu(e,t,2<arguments.length&&void 0!==arguments[2]?arguments[2]:null)},t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!Wu(n))throw Error(o(200));if(null==e||void 0===e._reactInternalFiber)throw Error(o(38));return Uu(e,t,n,!1,r)},t.version="16.13.1"},function(e,t,n){"use strict";e.exports=n(258)},function(e,t,n){"use strict";var r,a,i,o,s;if("undefined"===typeof window||"function"!==typeof MessageChannel){var u=null,c=null,l=function e(){if(null!==u)try{var n=t.unstable_now();u(!0,n),u=null}catch(r){throw setTimeout(e,0),r}},d=Date.now();t.unstable_now=function(){return Date.now()-d},r=function(e){null!==u?setTimeout(r,0,e):(u=e,setTimeout(l,0))},a=function(e,t){c=setTimeout(e,t)},i=function(){clearTimeout(c)},o=function(){return!1},s=t.unstable_forceFrameRate=function(){}}else{var p=window.performance,f=window.Date,h=window.setTimeout,m=window.clearTimeout;if("undefined"!==typeof console){var v=window.cancelAnimationFrame;"function"!==typeof window.requestAnimationFrame&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"),"function"!==typeof v&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills")}if("object"===typeof p&&"function"===typeof p.now)t.unstable_now=function(){return p.now()};else{var b=f.now();t.unstable_now=function(){return f.now()-b}}var g=!1,y=null,x=-1,k=5,w=0;o=function(){return t.unstable_now()>=w},s=function(){},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing framerates higher than 125 fps is not unsupported"):k=0<e?Math.floor(1e3/e):5};var O=new MessageChannel,I=O.port2;O.port1.onmessage=function(){if(null!==y){var e=t.unstable_now();w=e+k;try{y(!0,e)?I.postMessage(null):(g=!1,y=null)}catch(n){throw I.postMessage(null),n}}else g=!1},r=function(e){y=e,g||(g=!0,I.postMessage(null))},a=function(e,n){x=h((function(){e(t.unstable_now())}),n)},i=function(){m(x),x=-1}}function S(e,t){var n=e.length;e.push(t);e:for(;;){var r=n-1>>>1,a=e[r];if(!(void 0!==a&&0<T(a,t)))break e;e[r]=t,e[n]=a,n=r}}function N(e){return void 0===(e=e[0])?null:e}function j(e){var t=e[0];if(void 0!==t){var n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,a=e.length;r<a;){var i=2*(r+1)-1,o=e[i],s=i+1,u=e[s];if(void 0!==o&&0>T(o,n))void 0!==u&&0>T(u,o)?(e[r]=u,e[s]=n,r=s):(e[r]=o,e[i]=n,r=i);else{if(!(void 0!==u&&0>T(u,n)))break e;e[r]=u,e[s]=n,r=s}}}return t}return null}function T(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}var C=[],E=[],_=1,A=null,R=3,D=!1,F=!1,M=!1;function z(e){for(var t=N(E);null!==t;){if(null===t.callback)j(E);else{if(!(t.startTime<=e))break;j(E),t.sortIndex=t.expirationTime,S(C,t)}t=N(E)}}function L(e){if(M=!1,z(e),!F)if(null!==N(C))F=!0,r(P);else{var t=N(E);null!==t&&a(L,t.startTime-e)}}function P(e,n){F=!1,M&&(M=!1,i()),D=!0;var r=R;try{for(z(n),A=N(C);null!==A&&(!(A.expirationTime>n)||e&&!o());){var s=A.callback;if(null!==s){A.callback=null,R=A.priorityLevel;var u=s(A.expirationTime<=n);n=t.unstable_now(),"function"===typeof u?A.callback=u:A===N(C)&&j(C),z(n)}else j(C);A=N(C)}if(null!==A)var c=!0;else{var l=N(E);null!==l&&a(L,l.startTime-n),c=!1}return c}finally{A=null,R=r,D=!1}}function B(e){switch(e){case 1:return-1;case 2:return 250;case 5:return 1073741823;case 4:return 1e4;default:return 5e3}}var W=s;t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){F||D||(F=!0,r(P))},t.unstable_getCurrentPriorityLevel=function(){return R},t.unstable_getFirstCallbackNode=function(){return N(C)},t.unstable_next=function(e){switch(R){case 1:case 2:case 3:var t=3;break;default:t=R}var n=R;R=t;try{return e()}finally{R=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=W,t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=R;R=e;try{return t()}finally{R=n}},t.unstable_scheduleCallback=function(e,n,o){var s=t.unstable_now();if("object"===typeof o&&null!==o){var u=o.delay;u="number"===typeof u&&0<u?s+u:s,o="number"===typeof o.timeout?o.timeout:B(e)}else o=B(e),u=s;return e={id:_++,callback:n,priorityLevel:e,startTime:u,expirationTime:o=u+o,sortIndex:-1},u>s?(e.sortIndex=u,S(E,e),null===N(C)&&e===N(E)&&(M?i():M=!0,a(L,u-s))):(e.sortIndex=o,S(C,e),F||D||(F=!0,r(P))),e},t.unstable_shouldYield=function(){var e=t.unstable_now();z(e);var n=N(C);return n!==A&&null!==A&&null!==n&&null!==n.callback&&n.startTime<=e&&n.expirationTime<A.expirationTime||o()},t.unstable_wrapCallback=function(e){var t=R;return function(){var n=R;R=t;try{return e.apply(this,arguments)}finally{R=n}}}},,function(e,t,n){var r=function(e){"use strict";var t=Object.prototype,n=t.hasOwnProperty,r="function"===typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",i=r.asyncIterator||"@@asyncIterator",o=r.toStringTag||"@@toStringTag";function s(e,t,n,r){var a=t&&t.prototype instanceof l?t:l,i=Object.create(a.prototype),o=new w(r||[]);return i._invoke=function(e,t,n){var r="suspendedStart";return function(a,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===a)throw i;return I()}for(n.method=a,n.arg=i;;){var o=n.delegate;if(o){var s=y(o,n);if(s){if(s===c)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var l=u(e,t,n);if("normal"===l.type){if(r=n.done?"completed":"suspendedYield",l.arg===c)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(r="completed",n.method="throw",n.arg=l.arg)}}}(e,n,o),i}function u(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(r){return{type:"throw",arg:r}}}e.wrap=s;var c={};function l(){}function d(){}function p(){}var f={};f[a]=function(){return this};var h=Object.getPrototypeOf,m=h&&h(h(O([])));m&&m!==t&&n.call(m,a)&&(f=m);var v=p.prototype=l.prototype=Object.create(f);function b(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function g(e,t){var r;this._invoke=function(a,i){function o(){return new t((function(r,o){!function r(a,i,o,s){var c=u(e[a],e,i);if("throw"!==c.type){var l=c.arg,d=l.value;return d&&"object"===typeof d&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){r("next",e,o,s)}),(function(e){r("throw",e,o,s)})):t.resolve(d).then((function(e){l.value=e,o(l)}),(function(e){return r("throw",e,o,s)}))}s(c.arg)}(a,i,r,o)}))}return r=r?r.then(o,o):o()}}function y(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,y(e,t),"throw"===t.method))return c;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return c}var r=u(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,c;var a=r.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,c):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,c)}function x(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function k(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function w(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(x,this),this.reset(!0)}function O(e){if(e){var t=e[a];if(t)return t.call(e);if("function"===typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:I}}function I(){return{value:void 0,done:!0}}return d.prototype=v.constructor=p,p.constructor=d,p[o]=d.displayName="GeneratorFunction",e.isGeneratorFunction=function(e){var t="function"===typeof e&&e.constructor;return!!t&&(t===d||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,o in e||(e[o]="GeneratorFunction")),e.prototype=Object.create(v),e},e.awrap=function(e){return{__await:e}},b(g.prototype),g.prototype[i]=function(){return this},e.AsyncIterator=g,e.async=function(t,n,r,a,i){void 0===i&&(i=Promise);var o=new g(s(t,n,r,a),i);return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},b(v),v[o]="Generator",v[a]=function(){return this},v.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=O,w.prototype={constructor:w,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return o.type="throw",o.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],o=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var s=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(s&&u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var i=a;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,c):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),c},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),k(n),c}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var a=r.arg;k(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:O(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),c}},e}(e.exports);try{regeneratorRuntime=r}catch(a){Function("r","regeneratorRuntime = r")(r)}},function(e,t,n){"use strict";t.byteLength=function(e){var t=c(e),n=t[0],r=t[1];return 3*(n+r)/4-r},t.toByteArray=function(e){var t,n,r=c(e),o=r[0],s=r[1],u=new i(function(e,t,n){return 3*(t+n)/4-n}(0,o,s)),l=0,d=s>0?o-4:o;for(n=0;n<d;n+=4)t=a[e.charCodeAt(n)]<<18|a[e.charCodeAt(n+1)]<<12|a[e.charCodeAt(n+2)]<<6|a[e.charCodeAt(n+3)],u[l++]=t>>16&255,u[l++]=t>>8&255,u[l++]=255&t;2===s&&(t=a[e.charCodeAt(n)]<<2|a[e.charCodeAt(n+1)]>>4,u[l++]=255&t);1===s&&(t=a[e.charCodeAt(n)]<<10|a[e.charCodeAt(n+1)]<<4|a[e.charCodeAt(n+2)]>>2,u[l++]=t>>8&255,u[l++]=255&t);return u},t.fromByteArray=function(e){for(var t,n=e.length,a=n%3,i=[],o=0,s=n-a;o<s;o+=16383)i.push(l(e,o,o+16383>s?s:o+16383));1===a?(t=e[n-1],i.push(r[t>>2]+r[t<<4&63]+"==")):2===a&&(t=(e[n-2]<<8)+e[n-1],i.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"="));return i.join("")};for(var r=[],a=[],i="undefined"!==typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,u=o.length;s<u;++s)r[s]=o[s],a[o.charCodeAt(s)]=s;function c(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function l(e,t,n){for(var a,i,o=[],s=t;s<n;s+=3)a=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),o.push(r[(i=a)>>18&63]+r[i>>12&63]+r[i>>6&63]+r[63&i]);return o.join("")}a["-".charCodeAt(0)]=62,a["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,n,r,a){var i,o,s=8*a-r-1,u=(1<<s)-1,c=u>>1,l=-7,d=n?a-1:0,p=n?-1:1,f=e[t+d];for(d+=p,i=f&(1<<-l)-1,f>>=-l,l+=s;l>0;i=256*i+e[t+d],d+=p,l-=8);for(o=i&(1<<-l)-1,i>>=-l,l+=r;l>0;o=256*o+e[t+d],d+=p,l-=8);if(0===i)i=1-c;else{if(i===u)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,r),i-=c}return(f?-1:1)*o*Math.pow(2,i-r)},t.write=function(e,t,n,r,a,i){var o,s,u,c=8*i-a-1,l=(1<<c)-1,d=l>>1,p=23===a?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:i-1,h=r?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=l):(o=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-o))<1&&(o--,u*=2),(t+=o+d>=1?p/u:p*Math.pow(2,1-d))*u>=2&&(o++,u/=2),o+d>=l?(s=0,o=l):o+d>=1?(s=(t*u-1)*Math.pow(2,a),o+=d):(s=t*Math.pow(2,d-1)*Math.pow(2,a),o=0));a>=8;e[n+f]=255&s,f+=h,s/=256,a-=8);for(o=o<<a|s,c+=a;c>0;e[n+f]=255&o,f+=h,o/=256,c-=8);e[n+f-h]|=128*m}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t,n){"use strict";(function(e){var t,r=n(2),a=n(4),i=n(30),o=function(){return n(265)};var s=function(){function s(){Object(r.a)(this,s),this.util=n(266),this.textEncoder=new this.util.TextEncoder}return Object(a.a)(s,[{key:"fetch",value:function(e,n){return null!=Object(i.b)().global.fetch?Object(i.b)().global.fetch(e,n):(null==t&&(t=o()),t(e,n))}},{key:"now",value:function(){var t=e.hrtime();return 1e3*t[0]+t[1]/1e6}},{key:"encode",value:function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Node built-in encoder only supports utf-8, but got ".concat(t));return this.textEncoder.encode(e)}},{key:"decode",value:function(e,t){return 0===e.length?"":new this.util.TextDecoder(t).decode(e)}}]),s}();Object(i.b)().get("IS_NODE")&&!Object(i.b)().get("IS_BROWSER")&&Object(i.b)().setPlatform("node",new s)}).call(this,n(144))},,,function(e,t,n){(function(e){var r;!function(e,a,i){function o(e){var t=this,n=function(){var e=4022871197;return function(t){t=String(t);for(var n=0;n<t.length;n++){var r=.02519603282416938*(e+=t.charCodeAt(n));r-=e=r>>>0,e=(r*=e)>>>0,e+=4294967296*(r-=e)}return 2.3283064365386963e-10*(e>>>0)}}();t.next=function(){var e=2091639*t.s0+2.3283064365386963e-10*t.c;return t.s0=t.s1,t.s1=t.s2,t.s2=e-(t.c=0|e)},t.c=1,t.s0=n(" "),t.s1=n(" "),t.s2=n(" "),t.s0-=n(e),t.s0<0&&(t.s0+=1),t.s1-=n(e),t.s1<0&&(t.s1+=1),t.s2-=n(e),t.s2<0&&(t.s2+=1),n=null}function s(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function u(e,t){var n=new o(e),r=t&&t.state,a=n.next;return a.int32=function(){return 4294967296*n.next()|0},a.double=function(){return a()+11102230246251565e-32*(2097152*a()|0)},a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n(39)&&n(48)?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.alea=u}(0,e,n(39))}).call(this,n(57)(e))},function(e,t,n){(function(e){var r;!function(e,a,i){function o(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function s(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function u(e,t){var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n(39)&&n(48)?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.xor128=u}(0,e,n(39))}).call(this,n(57)(e))},function(e,t,n){(function(e){var r;!function(e,a,i){function o(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function s(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function u(e,t){var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n(39)&&n(48)?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.xorwow=u}(0,e,n(39))}).call(this,n(57)(e))},function(e,t,n){(function(e){var r;!function(e,a,i){function o(e){var t=this;t.next=function(){var e,n,r=t.x,a=t.i;return e=r[a],n=(e^=e>>>7)^e<<24,n^=(e=r[a+1&7])^e>>>10,n^=(e=r[a+3&7])^e>>>3,n^=(e=r[a+4&7])^e<<7,e=r[a+7&7],n^=(e^=e<<13)^e<<9,r[a]=n,t.i=a+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function s(e,t){return t.x=e.x.slice(),t.i=e.i,t}function u(e,t){null==e&&(e=+new Date);var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&(r.x&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n(39)&&n(48)?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.xorshift7=u}(0,e,n(39))}).call(this,n(57)(e))},function(e,t,n){(function(e){var r;!function(e,a,i){function o(e){var t=this;t.next=function(){var e,n,r=t.w,a=t.X,i=t.i;return t.w=r=r+1640531527|0,n=a[i+34&127],e=a[i=i+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=a[i]=n^e,t.i=i,n+(r^r>>>16)|0},function(e,t){var n,r,a,i,o,s=[],u=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,u=Math.max(u,t.length)),a=0,i=-32;i<u;++i)t&&(r^=t.charCodeAt((i+32)%t.length)),0===i&&(o=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,i>=0&&(o=o+1640531527|0,a=0==(n=s[127&i]^=r+o)?a+1:0);for(a>=128&&(s[127&(t&&t.length||0)]=-1),a=127,i=512;i>0;--i)r=s[a+34&127],n=s[a=a+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,s[a]=r^n;e.w=o,e.X=s,e.i=a}(t,e)}function s(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function u(e,t){null==e&&(e=+new Date);var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&(r.X&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n(39)&&n(48)?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.xor4096=u}(0,e,n(39))}).call(this,n(57)(e))},function(e,t,n){(function(e){var r;!function(e,a,i){function o(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,a=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^a,a=a-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^a,t.a=a-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function s(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function u(e,t){var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n(39)&&n(48)?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.tychei=u}(0,e,n(39))}).call(this,n(57)(e))},function(e,t,n){var r;!function(a,i,o){var s,u=o.pow(256,6),c=o.pow(2,52),l=2*c;function d(e,t,n){var r=[],d=h(function e(t,n){var r,a=[],i=typeof t;if(n&&"object"==i)for(r in t)try{a.push(e(t[r],n-1))}catch(o){}return a.length?a:"string"==i?t:t+"\0"}((t=1==t?{entropy:!0}:t||{}).entropy?[e,m(i)]:null==e?function(){try{var e;return s&&(e=s.randomBytes)?e=e(256):(e=new Uint8Array(256),(a.crypto||a.msCrypto).getRandomValues(e)),m(e)}catch(r){var t=a.navigator,n=t&&t.plugins;return[+new Date,a,n,a.screen,m(i)]}}():e,3),r),v=new p(r),b=function(){for(var e=v.g(6),t=u,n=0;e<c;)e=256*(e+n),t*=256,n=v.g(1);for(;e>=l;)e/=2,t/=2,n>>>=1;return(e+n)/t};return b.int32=function(){return 0|v.g(4)},b.quick=function(){return v.g(4)/4294967296},b.double=b,h(m(v.S),i),(t.pass||n||function(e,t,n,r){return r&&(r.S&&f(r,v),e.state=function(){return f(v,{})}),n?(o.random=e,t):e})(b,d,"global"in t?t.global:this==o,t.state)}function p(e){var t,n=e.length,r=this,a=0,i=r.i=r.j=0,o=r.S=[];for(n||(e=[n++]);a<256;)o[a]=a++;for(a=0;a<256;a++)o[a]=o[i=255&i+e[a%n]+(t=o[a])],o[i]=t;(r.g=function(e){for(var t,n=0,a=r.i,i=r.j,o=r.S;e--;)t=o[a=255&a+1],n=256*n+o[255&(o[a]=o[i=255&i+t])+(o[i]=t)];return r.i=a,r.j=i,n})(256)}function f(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function h(e,t){for(var n,r=e+"",a=0;a<r.length;)t[255&a]=255&(n^=19*t[255&a])+r.charCodeAt(a++);return m(t)}function m(e){return String.fromCharCode.apply(0,e)}if(h(o.random(),i),e.exports){e.exports=d;try{s=n(274)}catch(v){}}else void 0===(r=function(){return d}.call(t,n,t,e))||(e.exports=r)}("undefined"!==typeof self?self:this,[],Math)},,function(e,t,n){(function(e,t){!function(e,n){"use strict";if(!e.setImmediate){var r,a=1,i={},o=!1,s=e.document,u=Object.getPrototypeOf&&Object.getPrototypeOf(e);u=u&&u.setTimeout?u:e,"[object process]"==={}.toString.call(e.process)?r=function(e){t.nextTick((function(){l(e)}))}:function(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?function(){var t="setImmediate$"+Math.random()+"$",n=function(n){n.source===e&&"string"===typeof n.data&&0===n.data.indexOf(t)&&l(+n.data.slice(t.length))};e.addEventListener?e.addEventListener("message",n,!1):e.attachEvent("onmessage",n),r=function(n){e.postMessage(t+n,"*")}}():e.MessageChannel?function(){var e=new MessageChannel;e.port1.onmessage=function(e){l(e.data)},r=function(t){e.port2.postMessage(t)}}():s&&"onreadystatechange"in s.createElement("script")?function(){var e=s.documentElement;r=function(t){var n=s.createElement("script");n.onreadystatechange=function(){l(t),n.onreadystatechange=null,e.removeChild(n),n=null},e.appendChild(n)}}():r=function(e){setTimeout(l,0,e)},u.setImmediate=function(e){"function"!==typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var o={callback:e,args:t};return i[a]=o,r(a),a++},u.clearImmediate=c}function c(e){delete i[e]}function l(e){if(o)setTimeout(l,0,e);else{var t=i[e];if(t){o=!0;try{!function(e){var t=e.callback,n=e.args;switch(n.length){case 0:t();break;case 1:t(n[0]);break;case 2:t(n[0],n[1]);break;case 3:t(n[0],n[1],n[2]);break;default:t.apply(void 0,n)}}(t)}finally{c(e),o=!1}}}}}("undefined"===typeof self?"undefined"===typeof e?this:e:self)}).call(this,n(143),n(144))},function(e,t,n){(function(e){var r;!function(e,a,i){function o(e){var t=this,n=function(){var e=4022871197;return function(t){t=String(t);for(var n=0;n<t.length;n++){var r=.02519603282416938*(e+=t.charCodeAt(n));r-=e=r>>>0,e=(r*=e)>>>0,e+=4294967296*(r-=e)}return 2.3283064365386963e-10*(e>>>0)}}();t.next=function(){var e=2091639*t.s0+2.3283064365386963e-10*t.c;return t.s0=t.s1,t.s1=t.s2,t.s2=e-(t.c=0|e)},t.c=1,t.s0=n(" "),t.s1=n(" "),t.s2=n(" "),t.s0-=n(e),t.s0<0&&(t.s0+=1),t.s1-=n(e),t.s1<0&&(t.s1+=1),t.s2-=n(e),t.s2<0&&(t.s2+=1),n=null}function s(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function u(e,t){var n=new o(e),r=t&&t.state,a=n.next;return a.int32=function(){return 4294967296*n.next()|0},a.double=function(){return a()+11102230246251565e-32*(2097152*a()|0)},a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n(39)&&n(48)?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.alea=u}(0,e,n(39))}).call(this,n(57)(e))},function(e,t,n){(function(e){var r;!function(e,a,i){function o(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function s(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function u(e,t){var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n(39)&&n(48)?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.xor128=u}(0,e,n(39))}).call(this,n(57)(e))},function(e,t,n){(function(e){var r;!function(e,a,i){function o(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function s(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function u(e,t){var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n(39)&&n(48)?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.xorwow=u}(0,e,n(39))}).call(this,n(57)(e))},function(e,t,n){(function(e){var r;!function(e,a,i){function o(e){var t=this;t.next=function(){var e,n,r=t.x,a=t.i;return e=r[a],n=(e^=e>>>7)^e<<24,n^=(e=r[a+1&7])^e>>>10,n^=(e=r[a+3&7])^e>>>3,n^=(e=r[a+4&7])^e<<7,e=r[a+7&7],n^=(e^=e<<13)^e<<9,r[a]=n,t.i=a+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function s(e,t){return t.x=e.x.slice(),t.i=e.i,t}function u(e,t){null==e&&(e=+new Date);var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&(r.x&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n(39)&&n(48)?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.xorshift7=u}(0,e,n(39))}).call(this,n(57)(e))},function(e,t,n){(function(e){var r;!function(e,a,i){function o(e){var t=this;t.next=function(){var e,n,r=t.w,a=t.X,i=t.i;return t.w=r=r+1640531527|0,n=a[i+34&127],e=a[i=i+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=a[i]=n^e,t.i=i,n+(r^r>>>16)|0},function(e,t){var n,r,a,i,o,s=[],u=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,u=Math.max(u,t.length)),a=0,i=-32;i<u;++i)t&&(r^=t.charCodeAt((i+32)%t.length)),0===i&&(o=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,i>=0&&(o=o+1640531527|0,a=0==(n=s[127&i]^=r+o)?a+1:0);for(a>=128&&(s[127&(t&&t.length||0)]=-1),a=127,i=512;i>0;--i)r=s[a+34&127],n=s[a=a+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,s[a]=r^n;e.w=o,e.X=s,e.i=a}(t,e)}function s(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function u(e,t){null==e&&(e=+new Date);var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&(r.X&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n(39)&&n(48)?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.xor4096=u}(0,e,n(39))}).call(this,n(57)(e))},function(e,t,n){(function(e){var r;!function(e,a,i){function o(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,a=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^a,a=a-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^a,t.a=a-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function s(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function u(e,t){var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n(39)&&n(48)?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.tychei=u}(0,e,n(39))}).call(this,n(57)(e))},function(e,t,n){var r;!function(a,i,o){var s,u=o.pow(256,6),c=o.pow(2,52),l=2*c;function d(e,t,n){var r=[],d=h(function e(t,n){var r,a=[],i=typeof t;if(n&&"object"==i)for(r in t)try{a.push(e(t[r],n-1))}catch(o){}return a.length?a:"string"==i?t:t+"\0"}((t=1==t?{entropy:!0}:t||{}).entropy?[e,m(i)]:null==e?function(){try{var e;return s&&(e=s.randomBytes)?e=e(256):(e=new Uint8Array(256),(a.crypto||a.msCrypto).getRandomValues(e)),m(e)}catch(r){var t=a.navigator,n=t&&t.plugins;return[+new Date,a,n,a.screen,m(i)]}}():e,3),r),v=new p(r),b=function(){for(var e=v.g(6),t=u,n=0;e<c;)e=256*(e+n),t*=256,n=v.g(1);for(;e>=l;)e/=2,t/=2,n>>>=1;return(e+n)/t};return b.int32=function(){return 0|v.g(4)},b.quick=function(){return v.g(4)/4294967296},b.double=b,h(m(v.S),i),(t.pass||n||function(e,t,n,r){return r&&(r.S&&f(r,v),e.state=function(){return f(v,{})}),n?(o.random=e,t):e})(b,d,"global"in t?t.global:this==o,t.state)}function p(e){var t,n=e.length,r=this,a=0,i=r.i=r.j=0,o=r.S=[];for(n||(e=[n++]);a<256;)o[a]=a++;for(a=0;a<256;a++)o[a]=o[i=255&i+e[a%n]+(t=o[a])],o[i]=t;(r.g=function(e){for(var t,n=0,a=r.i,i=r.j,o=r.S;e--;)t=o[a=255&a+1],n=256*n+o[255&(o[a]=o[i=255&i+t])+(o[i]=t)];return r.i=a,r.j=i,n})(256)}function f(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function h(e,t){for(var n,r=e+"",a=0;a<r.length;)t[255&a]=255&(n^=19*t[255&a])+r.charCodeAt(a++);return m(t)}function m(e){return String.fromCharCode.apply(0,e)}if(h(o.random(),i),e.exports){e.exports=d;try{s=n(283)}catch(v){}}else void 0===(r=function(){return d}.call(t,n,t,e))||(e.exports=r)}("undefined"!==typeof self?self:this,[],Math)},,,,,function(e,t,n){(function(e){var r;!function(e,a,i){function o(e){var t=this,n=function(){var e=4022871197;return function(t){t=String(t);for(var n=0;n<t.length;n++){var r=.02519603282416938*(e+=t.charCodeAt(n));r-=e=r>>>0,e=(r*=e)>>>0,e+=4294967296*(r-=e)}return 2.3283064365386963e-10*(e>>>0)}}();t.next=function(){var e=2091639*t.s0+2.3283064365386963e-10*t.c;return t.s0=t.s1,t.s1=t.s2,t.s2=e-(t.c=0|e)},t.c=1,t.s0=n(" "),t.s1=n(" "),t.s2=n(" "),t.s0-=n(e),t.s0<0&&(t.s0+=1),t.s1-=n(e),t.s1<0&&(t.s1+=1),t.s2-=n(e),t.s2<0&&(t.s2+=1),n=null}function s(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function u(e,t){var n=new o(e),r=t&&t.state,a=n.next;return a.int32=function(){return 4294967296*n.next()|0},a.double=function(){return a()+11102230246251565e-32*(2097152*a()|0)},a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n(39)&&n(48)?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.alea=u}(0,e,n(39))}).call(this,n(57)(e))},function(e,t,n){(function(e){var r;!function(e,a,i){function o(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function s(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function u(e,t){var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n(39)&&n(48)?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.xor128=u}(0,e,n(39))}).call(this,n(57)(e))},function(e,t,n){(function(e){var r;!function(e,a,i){function o(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function s(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function u(e,t){var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n(39)&&n(48)?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.xorwow=u}(0,e,n(39))}).call(this,n(57)(e))},function(e,t,n){(function(e){var r;!function(e,a,i){function o(e){var t=this;t.next=function(){var e,n,r=t.x,a=t.i;return e=r[a],n=(e^=e>>>7)^e<<24,n^=(e=r[a+1&7])^e>>>10,n^=(e=r[a+3&7])^e>>>3,n^=(e=r[a+4&7])^e<<7,e=r[a+7&7],n^=(e^=e<<13)^e<<9,r[a]=n,t.i=a+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function s(e,t){return t.x=e.x.slice(),t.i=e.i,t}function u(e,t){null==e&&(e=+new Date);var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&(r.x&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n(39)&&n(48)?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.xorshift7=u}(0,e,n(39))}).call(this,n(57)(e))},function(e,t,n){(function(e){var r;!function(e,a,i){function o(e){var t=this;t.next=function(){var e,n,r=t.w,a=t.X,i=t.i;return t.w=r=r+1640531527|0,n=a[i+34&127],e=a[i=i+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=a[i]=n^e,t.i=i,n+(r^r>>>16)|0},function(e,t){var n,r,a,i,o,s=[],u=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,u=Math.max(u,t.length)),a=0,i=-32;i<u;++i)t&&(r^=t.charCodeAt((i+32)%t.length)),0===i&&(o=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,i>=0&&(o=o+1640531527|0,a=0==(n=s[127&i]^=r+o)?a+1:0);for(a>=128&&(s[127&(t&&t.length||0)]=-1),a=127,i=512;i>0;--i)r=s[a+34&127],n=s[a=a+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,s[a]=r^n;e.w=o,e.X=s,e.i=a}(t,e)}function s(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function u(e,t){null==e&&(e=+new Date);var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&(r.X&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n(39)&&n(48)?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.xor4096=u}(0,e,n(39))}).call(this,n(57)(e))},function(e,t,n){(function(e){var r;!function(e,a,i){function o(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,a=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^a,a=a-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^a,t.a=a-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function s(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function u(e,t){var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n(39)&&n(48)?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.tychei=u}(0,e,n(39))}).call(this,n(57)(e))},function(e,t,n){var r;!function(a,i,o){var s,u=o.pow(256,6),c=o.pow(2,52),l=2*c;function d(e,t,n){var r=[],d=h(function e(t,n){var r,a=[],i=typeof t;if(n&&"object"==i)for(r in t)try{a.push(e(t[r],n-1))}catch(o){}return a.length?a:"string"==i?t:t+"\0"}((t=1==t?{entropy:!0}:t||{}).entropy?[e,m(i)]:null==e?function(){try{var e;return s&&(e=s.randomBytes)?e=e(256):(e=new Uint8Array(256),(a.crypto||a.msCrypto).getRandomValues(e)),m(e)}catch(r){var t=a.navigator,n=t&&t.plugins;return[+new Date,a,n,a.screen,m(i)]}}():e,3),r),v=new p(r),b=function(){for(var e=v.g(6),t=u,n=0;e<c;)e=256*(e+n),t*=256,n=v.g(1);for(;e>=l;)e/=2,t/=2,n>>>=1;return(e+n)/t};return b.int32=function(){return 0|v.g(4)},b.quick=function(){return v.g(4)/4294967296},b.double=b,h(m(v.S),i),(t.pass||n||function(e,t,n,r){return r&&(r.S&&f(r,v),e.state=function(){return f(v,{})}),n?(o.random=e,t):e})(b,d,"global"in t?t.global:this==o,t.state)}function p(e){var t,n=e.length,r=this,a=0,i=r.i=r.j=0,o=r.S=[];for(n||(e=[n++]);a<256;)o[a]=a++;for(a=0;a<256;a++)o[a]=o[i=255&i+e[a%n]+(t=o[a])],o[i]=t;(r.g=function(e){for(var t,n=0,a=r.i,i=r.j,o=r.S;e--;)t=o[a=255&a+1],n=256*n+o[255&(o[a]=o[i=255&i+t])+(o[i]=t)];return r.i=a,r.j=i,n})(256)}function f(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function h(e,t){for(var n,r=e+"",a=0;a<r.length;)t[255&a]=255&(n^=19*t[255&a])+r.charCodeAt(a++);return m(t)}function m(e){return String.fromCharCode.apply(0,e)}if(h(o.random(),i),e.exports){e.exports=d;try{s=n(294)}catch(v){}}else void 0===(r=function(){return d}.call(t,n,t,e))||(e.exports=r)}("undefined"!==typeof self?self:this,[],Math)}]]);
//# sourceMappingURL=2.50044c6e.chunk.js.map