(this.webpackJsonpreactapptestausa=this.webpackJsonpreactapptestausa||[]).push([[0],{202:function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=202},227:function(e,t,n){e.exports=n(252)},232:function(e,t,n){},237:function(e,t){},238:function(e,t){},246:function(e,t){},248:function(e,t){},249:function(e,t){},250:function(e,t){},251:function(e,t,n){},252:function(e,t,n){"use strict";n.r(t);var o=n(41),a=n.n(o),c=n(203),i=n.n(c),s=(n(232),n(58)),r=n(45),l=n(225),d=n.n(l);n(251),n(201);const u={1:{name:"person",color:"red"},2:{name:"ThumbsDown",color:"yellow"},3:{name:"ThankYou",color:"lime"},4:{name:"LiveLong",color:"blue"}},g=(e,t,n,o,a,c,i)=>{for(let s=0;s<=e.length;s++)if(e[s]&&t[s]&&n[s]>o){const[o,r,l,d]=e[s],g=t[s];1===g&&(i.strokeStyle=u[g].color,i.lineWidth=5,i.fillStyle="white",i.font="30px Arial",i.beginPath(),i.fillText(u[g].name+" - "+Math.round(100*n[s])/100,r*a,o*c-10),i.rect(r*a,o*c,(d-r)*a,(l-o)*c),i.stroke())}};var h=[],m=[];var p=function(){const e=Object(o.useRef)(null),t=Object(o.useRef)(null),[c,i]=Object(o.useState)("webcam");var[l,u]=Object(o.useState)({width:1440,height:1080});const p=n(201);var w,f,b,v,y,x,E,C=!1,j=(new Image,[]),k=[],O=[],I=[],D=[],L=[],R=0,U=new Set;const N=document.createElement("li");var S,B,M;N.id="lista immagini",N.style.display="block",document.createElement("div").style.display="block";var T=[];async function A(e,t,n){const o=R++,a=new Image(640,480);a.src=e.src,a.id=t,a.onload=await(async function(){const e=await Promise.all(["Elon Musk","Marco","Obama"].map(async e=>{var t=[];for(E=1;E<=8;E++){const n=await s.g("/tfodreactapptest"+"/labels/".concat(e,"/").concat(E,".jpeg")),o=await s.e(n).withFaceLandmarks().withFaceDescriptor();t.push(o.descriptor)}return new s.b(e,t)})),t=new s.a(e),c=s.c(a),i={width:640,height:480};s.h(c,i);const r=await s.d(a).withFaceLandmarks().withFaceDescriptors(),l=s.j(r,i),d=l.map(e=>t.findBestMatch(e.descriptor));console.log(d.length);var u=0;if(0!==d.length){if(l.length>=1){const e=t.findBestMatch(l[0].descriptor),i=l[0].detection.box,r=new s.f.DrawBox(i,{label:e});console.log(e),console.log(i),console.log(r),console.log(o),c.width=640,c.height=480,c.style.zIndex=10,c.id="ritaglio";const d=c.getContext("2d"),g=document.createElement("div");g.style.display="flex";let p=!0;console.log("prima "+o),!U.has(a.src)&&p&&!("undefined"===typeof a)&!("undefined"===typeof a.src)&&(console.log("dentro "+o),await d.drawImage(a,0,0),await r.draw(c),document.body.append(N),g.appendChild(c),u=document.createTextNode(a.id),M=document.createTextNode("   "+o),console.log(u),g.appendChild(u),g.appendChild(M),g.id=u.textContent,g.className="immagini",N.appendChild(g),console.log("container "+o),p=!1,U.add(a.src),console.log(h.length),m.push(a.id),console.log(h),console.log(U.size),console.log(a.src),console.log("seconda chiamata if"),await z(a,n,c)),console.log("dopo "+o)}}else{c.width=640,c.height=480,c.style.zIndex=10,c.id="ritaglio";const e=c.getContext("2d"),t=document.createElement("div");t.style.display="flex",t.setAttribute("name","No");let i=!0;console.log("ggggggg"),!U.has(a.src)&&i&&!("undefined"===typeof a)&!("undefined"===typeof a.src)&&(console.log("dentro "+o),await e.drawImage(a,0,0),document.body.append(N),t.appendChild(c),u=document.createTextNode(a.id),M=document.createTextNode("   "+o),console.log(u),t.appendChild(u),t.appendChild(M),t.id=u.textContent,N.appendChild(t),console.log("container "+o),i=!1,U.add(a.src),await z(a,n,c),console.log("seconda chiamta else"))}})}async function z(e,t,n){console.log("inizio seconda detect");const o=await r.a.fromPixels(e),a=await r.c.resizeBilinear(o,[640,480]),c=await a.cast("int32"),i=await c.expandDims(0),s=await t.executeAsync(i),l=await s[1].array(),d=await s[0].array(),u=await s[4].array(),m=n.getContext("2d");g(l[0],d[0],u[0],.4,e.width,e.height,m),h.push(n.toDataURL()),console.log("fine seconda detect"),r.b(o),r.b(a),r.b(c),r.b(i),r.b(s)}async function F(e,t,n,o,a,c,i){if(e&&t&&n&&o&&a&&c){var s=document.createElement("canvas");s.width=640,s.height=480;var r=s.getContext("2d"),l=new Image(640,480);l.src=e,l.onload=async function(){await r.drawImage(l,640*t,480*n,640*o,480*a,0,0,640*o,480*a),w=await s.toDataURL("image/png"),document.getElementById("screenshot").src=w,C=!1;document.getElementById("screenshot");var e=document.createElement("img");e.src=await w,T.push(e),console.log("face recognition"),await async function(e,t,n){for(var o=0;o<e.length;o++){var a=e[o];await A(a,t,n)}}(T.slice(),c.slice(),i)}}}async function P(e,t,n,o,a,c,i,s){if(e&&i&&c&&t&&n&&o&&a)for(var r=0;r<i.length;r++)await F(i[r],t[r],n[r],o[r],a[r],c[r],s)}navigator.mediaDevices.enumerateDevices().then(e=>console.log(e));const H=async n=>{var o=document.getElementById("webcam");if("undefined"!==typeof e.current&&null!==e.current&&4===e.current.video.readyState){console.log("Pausing the webcam stream..."),e.current.video.pause(),B=((S=new Date).getHours()<10?"0"+S.getHours():S.getHours())+":"+(S.getMinutes()<10?"0"+S.getMinutes():S.getMinutes())+":"+(S.getSeconds()<10?"0"+S.getSeconds():S.getSeconds());var a=o.currentTime;console.log(a),console.log("Webcam stream paused.");const c=e.current.video,i=e.current.video.srcObject,s=e.current.video.videoWidth,l=e.current.video.videoHeight;e.current.video.width=s,e.current.video.height=l,t.current.width=s,t.current.height=l;const d=await r.a.fromPixels(c),u=await r.c.resizeBilinear(d,[640,480]),h=await u.cast("int32"),m=await h.expandDims(0),p=await n.executeAsync(m),w=await p[1].array(),E=await p[0].array(),R=await p[4].array(),U=t.current.getContext("2d");j=[],k=[],L=[],D=[],O=[],I=[],T=[],await async function(){for(var t=0;t<R[0].length;t++)if(R[0][t]>.4&&1==E[0][t])x=await e.current.getScreenshot(),j.push(x),k.push(B),C=!0,f=w[0][t][1],O.push(f),b=w[0][t][0],I.push(b),v=w[0][t][3]-w[0][t][1],D.push(v),y=w[0][t][2]-w[0][t][0],L.push(y);else if(C){await P(C,O.slice(),I.slice(),D.slice(),L.slice(),k.slice(),j.slice(),n);break}}(),console.log(w[0][0]),g(w[0],E[0],R[0],.4,s,l,U),34.48===a&&(a=0),e.current.video.srcObject=null,o.currentTime=await a,e.current.video.srcObject=await i,r.b(d),r.b(u),r.b(h),r.b(m),r.b(p)}return x};return Object(o.useEffect)(()=>{(async()=>{const e=await r.d("https://testtfodausa.s3.eu-de.cloud-object-storage.appdomain.cloud/model.json");Promise.all([s.i.ssdMobilenetv1.loadFromUri("/tfodreactapptest/models"),s.i.faceLandmark68Net.loadFromUri("/tfodreactapptest/models"),s.i.faceRecognitionNet.loadFromUri("/tfodreactapptest/models")]),setInterval(()=>{H(e)},5e3)})()},[]),a.a.createElement("div",{className:"App"},a.a.createElement("header",{className:"App-header"},a.a.createElement(d.a,{ref:e,videoConstraints:l,id:"webcam",muted:!0,style:{position:"absolute",marginLeft:"auto",marginRight:"auto",left:0,right:0,textAlign:"center",zindex:9,width:640,height:480}}),a.a.createElement("canvas",{ref:t,style:{position:"absolute",marginLeft:"auto",marginRight:"auto",left:0,right:0,textAlign:"center",zindex:8,width:640,height:480}}),a.a.createElement("img",{id:"screenshot",alt:"Screenshot",style:{width:640,height:480}})),a.a.createElement("button",{onClick:function(){var t=document.getElementById("webcam");e.current.video.srcObject&&(e.current.video.pause(),e.current.video.srcObject=null,t.src="/tfodreactapptest/video/alley.mp4",t.width=640,t.height=480,t.style.width="640px",t.style.height="480px",t.style.aspectRatio="4 / 3",t.play())}},"Test video 1"),a.a.createElement("button",{onClick:function(){var t=e.current.video;if(!t.srcObject){const e={video:{width:1440,height:1080}};navigator.mediaDevices.getUserMedia(e).then(e=>{t.srcObject=e,t.width=1440,t.height=1080,t.play(),i("webcam")}).catch(e=>{console.error("Error accessing webcam:",e)})}}},"Attiva Webcam"),a.a.createElement("button",{onClick:function(){const e=h;console.log(e),console.log(e.length),console.log(m.length),console.log(m);const t=new p,n=[];e.forEach((e,o)=>{const a=new Image;a.src=e;const c=new Promise(e=>{a.onload=function(){const n=document.createElement("canvas"),c=n.getContext("2d");n.width=a.width,n.height=a.height,c.drawImage(a,0,0);const i=n.toDataURL("image/png");console.log(o),console.log(m[o]),t.file("".concat(m[o].replace(/:/g,"-"),"(").concat(o,").png"),i.split(",")[1],{base64:!0}),e()}});n.push(c)}),Promise.all(n).then(()=>{t.generateAsync({type:"blob"}).then((function(e){const t=new Blob([e]),n=URL.createObjectURL(t),o=document.createElement("a");o.href=n,o.download="images.zip",o.click(),URL.revokeObjectURL(n)}))})}},"Scarica risultati"))};function w(){i.a.render(a.a.createElement(p,null),document.getElementById("root"))}w(),window.onload=function(){w()}}},[[227,1,2]]]);
//# sourceMappingURL=main.c02d39c8.chunk.js.map