(this.webpackJsonpreactapptestausa=this.webpackJsonpreactapptestausa||[]).push([[0],{202:function(e,t){function a(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}a.keys=function(){return[]},a.resolve=a,e.exports=a,a.id=202},227:function(e,t,a){e.exports=a(252)},232:function(e,t,a){},237:function(e,t){},238:function(e,t){},246:function(e,t){},248:function(e,t){},249:function(e,t){},250:function(e,t){},251:function(e,t,a){},252:function(e,t,a){"use strict";a.r(t);var n=a(41),o=a.n(n),i=a(203),c=a.n(i),r=(a(232),a(58)),s=a(42),l=a(225),d=a.n(l);a(251),a(201);const u={1:{name:"person",color:"red"},2:{name:"cartellino",color:"yellow"},3:{name:"ThankYou",color:"lime"},4:{name:"LiveLong",color:"blue"}},h=(e,t,a,n,o,i,c,r)=>{for(let l=0;l<=e.length;l++)if(e[l]&&t[l]&&a[l]>n){const[n,d,h,p]=e[l];var s=t[l];1!==s||r?1===s&&r&&(console.log("cartellino"),console.log(e[l]),s=2,c.strokeStyle=u[s].color,c.lineWidth=2,console.log("provaprovaprova"),c.fillStyle="white",c.font="30px Arial",console.log(c.lineWidth),c.beginPath(),c.fillText(u[s].name+" - "+Math.round(100*a[l])/100,d*o,n*i-10),c.rect(d*o,n*i,(p-d)*o,(h-n)*i),c.stroke()):(console.log("persona"),c.strokeStyle=u[s].color,c.lineWidth=5,c.fillStyle="white",c.font="30px Arial",c.beginPath(),c.fillText(u[s].name+" - "+Math.round(100*a[l])/100,d*o,n*i-10),c.rect(d*o,n*i,(p-d)*o,(h-n)*i),c.stroke())}};var p,m=[],g=[];var w=function(){const e=Object(n.useRef)(null),t=Object(n.useRef)(null),[i,c]=Object(n.useState)("webcam");var[l,u]=Object(n.useState)({width:1440,height:1080,deviceId:"a8a4d319ea873e9a51b45d8d67762d3709ed2cbc0ae66396e996b2ff137fdc4d"});const w=a(201);var f,v,b,y,x,E,C,j=!1,O=(new Image,[]),I=[],k=[],D=[],L=[],R=[],N=new Set;const A=document.createElement("li");var S,U;A.id="lista immagini",A.style.display="block",document.createElement("div").style.display="block";var B=[];async function T(e,t,a){0;const n=new Image;n.src=e.src,n.id=t,n.onload=await(async function(){const e=await Promise.all(["Elon Musk","Marco","Obama"].map(async e=>{var t=[];for(C=1;C<=8;C++){const a=await r.g("/tfodreactapptest"+"/labels/".concat(e,"/").concat(C,".jpeg")),n=await r.e(a).withFaceLandmarks().withFaceDescriptor();t.push(n.descriptor)}return new r.b(e,t)})),t=new r.a(e),o=r.c(n),i={width:n.width,height:n.height};r.h(o,i);const c=await r.d(n).withFaceLandmarks().withFaceDescriptors(),s=r.j(c,i);var l=0;if(0!==s.map(e=>t.findBestMatch(e.descriptor)).length){if(s.length>=1){const e=t.findBestMatch(s[0].descriptor),i=s[0].detection.box,c=new r.f.DrawBox(i,{label:e});o.width=n.width,o.height=n.height,o.style.zIndex=10,o.id="ritaglio";const d=o.getContext("2d"),u=document.createElement("div");u.style.display="flex";let h=!0;!N.has(n.src)&&h&&!("undefined"===typeof n)&!("undefined"===typeof n.src)&&(await d.drawImage(n,0,0),await c.draw(o),document.body.append(A),u.appendChild(o),l=document.createTextNode(n.id+" "),u.appendChild(l),u.id=l.textContent,u.className="immagini",A.appendChild(u),h=!1,N.add(n.src),m.push(o.toDataURL()),g.push(n.id),await M(n,a,o,u))}}else{o.width=n.width,o.height=n.height,o.style.zIndex=10,o.id="ritaglio";const e=o.getContext("2d"),t=document.createElement("div");t.style.display="flex",t.setAttribute("name","No");let i=!0;!N.has(n.src)&&i&&!("undefined"===typeof n)&!("undefined"===typeof n.src)&&(await e.drawImage(n,0,0),document.body.append(A),t.appendChild(o),l=document.createTextNode(n.id+" "),t.appendChild(l),t.id=l.textContent,t.className="immagini",A.appendChild(t),i=!1,N.add(n.src),await M(n,a,o,t))}})}async function M(e,t,a,n){var o=new Image(640,480);o.src=e.src,console.log(o.src),o.onload=async function(){const i=await s.a.fromPixels(o),c=await s.c.resizeBilinear(i,[640,480]),r=await c.cast("int32"),l=await r.expandDims(0),d=await t.executeAsync(l),u=await d[2].array(),p=await d[0].array(),m=await d[4].array(),g=a.getContext("2d");h(u[0],p[0],m[0],.5,e.width,e.height,g,!0),console.log(m[0][0]);var w=100*m[0][0].toFixed(2);if(m[0][0]>.5){var f=document.createTextNode("Cartellino RILEVATO: "+w+"%");n.appendChild(f),n.setAttribute("perc",w)}else{null!==w&&"undefined"!==typeof w||(w=0);f=document.createTextNode("Cartellino NON rilevato: "+w+"%");n.appendChild(f),n.setAttribute("perc",w)}return s.b(i),s.b(c),s.b(r),s.b(l),s.b(d),w}}async function F(e,t,a,n,o,i,c){if(e&&i){var r=document.createElement("canvas");r.width=640,r.height=480;var s=r.getContext("2d"),l=new Image;l.src=e,l.onload=async function(e){await s.drawImage(l,640*t,480*a,640*n,480*o,0,0,640*n,480*o),f=await r.toDataURL("image/png"),document.getElementById("screenshot").src=f,j=!1;document.getElementById("screenshot");var d=document.createElement("img"),u=s.getImageData(0,0,640*n,480*o),h=document.createElement("canvas");h.width=u.width,h.height=u.height,h.getContext("2d").putImageData(u,0,0);var p=h.toDataURL("image/png");d.src=await p,B.push(d),await async function(e,t,a){for(var n=0;n<e.length;n++){var o=e[n];await T(o,t,a)}}(B.slice(),i.slice(),c)}}}async function P(e,t,a,n,o,i,c,r){if(e&&c&&i&&t&&a&&n&&o)for(var s=0;s<c.length;s++)await F(c[s],t[s],a[s],n[s],o[s],i[s],r)}function z(){var t=document.getElementById("webcam");p=2,e.current.video.srcObject&&(e.current.video.pause(),e.current.video.srcObject=null),t.pause(),t.src="/tfodreactapptest/video/testcartellino.mp4",t.preload="auto",t.width=640,t.height=480,t.style.width="640px",t.style.height="480px",t.style.aspectRatio="4 / 3",t.play()}navigator.mediaDevices.enumerateDevices().then(e=>console.log(e));const W=async(a,n)=>{var o,i=document.getElementById("webcam");if("undefined"!==typeof e.current&&null!==e.current&&4===e.current.video.readyState){console.log("Pausing the webcam stream..."),await e.current.video.pause(),i.pause(),U=((S=new Date).getHours()<10?"0"+S.getHours():S.getHours())+":"+(S.getMinutes()<10?"0"+S.getMinutes():S.getMinutes())+":"+(S.getSeconds()<10?"0"+S.getSeconds():S.getSeconds()),o=i.currentTime,console.log(o),console.log("Webcam stream paused.");const c=e.current.video,r=e.current.video.srcObject,l=e.current.video.videoWidth,d=e.current.video.videoHeight;e.current.video.width=l,e.current.video.height=d,t.current.width=l,t.current.height=d;const u=await s.a.fromPixels(c),m=await s.c.resizeBilinear(u,[640,480]),g=await m.cast("int32"),w=await g.expandDims(0),f=await a.executeAsync(w),C=await f[1].array(),N=await f[0].array(),A=await f[4].array(),T=t.current.getContext("2d");O=[],I=[],R=[],L=[],k=[],D=[],B=[],await e.current.video.pause(),await async function(){for(var t=0;t<A[0].length;t++)if(A[0][t]>.4&&1==N[0][t])E=await e.current.getScreenshot(),O.push(E),I.push(U),j=!0,v=C[0][t][1],k.push(v),b=C[0][t][0],D.push(b),y=C[0][t][3]-C[0][t][1],L.push(y),x=C[0][t][2]-C[0][t][0],R.push(x),console.log(y),console.log(x),console.log(v),console.log(b);else if(j){await P(j,k.slice(),D.slice(),L.slice(),R.slice(),I.slice(),O.slice(),n);break}}(),await e.current.video.pause();await h(C[0],N[0],A[0],.4,l,d,T,!1),console.log(p),34.48===o&&1===p&&(o=0),console.log(o),30.283333===o&&2===p?(!function(){var t=document.getElementById("webcam");p=3,e.current.video.srcObject&&(e.current.video.pause(),e.current.video.srcObject=null),t.pause(),t.src="/tfodreactapptest/video/testcartellino2.mp4",t.width=640,t.height=480,t.style.width="640px",t.style.height="480px",t.style.aspectRatio="4 / 3",t.play()}(),o=0):42.933333===o&&(z(),o=0,!1),e.current.video.srcObject=null,i.currentTime=await o,e.current.video.srcObject=await r,s.b(u),s.b(m),s.b(g),s.b(w),s.b(f),console.log("finito")}return E};return Object(n.useEffect)(()=>{(async()=>{const e=await s.d("https://testtfodausa.s3.eu-de.cloud-object-storage.appdomain.cloud/model.json"),t=await s.d("https://testtfodappcartellino.s3.eu-de.cloud-object-storage.appdomain.cloud/model.json");Promise.all([r.i.ssdMobilenetv1.loadFromUri("/tfodreactapptest/models"),r.i.faceLandmark68Net.loadFromUri("/tfodreactapptest/models"),r.i.faceRecognitionNet.loadFromUri("/tfodreactapptest/models")]),setInterval(()=>{W(e,t)},5e3)})()},[]),o.a.createElement("div",{className:"App"},o.a.createElement("header",{className:"App-header"},o.a.createElement(d.a,{ref:e,videoConstraints:l,id:"webcam",muted:!0,style:{position:"absolute",marginLeft:"auto",marginRight:"auto",left:0,right:0,textAlign:"center",zindex:9,width:640,height:480}}),o.a.createElement("canvas",{ref:t,style:{position:"absolute",marginLeft:"auto",marginRight:"auto",left:0,right:0,textAlign:"center",zindex:8,width:640,height:480}}),o.a.createElement("img",{id:"screenshot",alt:"Screenshot",style:{width:640,height:480}})),o.a.createElement("button",{onClick:function(){var t=document.getElementById("webcam");p=1,e.current.video.srcObject&&(e.current.video.pause(),e.current.video.srcObject=null),t.pause(),t.src="/tfodreactapptest/video/alley.mp4",t.width=640,t.height=480,t.style.width="640px",t.style.height="480px",t.style.aspectRatio="4 / 3",t.play()}},"Test video 1"),o.a.createElement("button",{onClick:z},"Test video 2"),o.a.createElement("button",{onClick:function(){var t=e.current.video;if(!t.srcObject){const e={video:{width:1440,height:1080}};navigator.mediaDevices.getUserMedia(e).then(e=>{t.srcObject=e,t.width=1440,t.height=1080,t.play(),c("webcam")}).catch(e=>{console.error("Error accessing webcam:",e)})}}},"Attiva Webcam"),o.a.createElement("button",{onClick:function(){const e=m,t=new w,a=[];e.forEach((e,n)=>{const o=new Image;o.src=e;const i=new Promise(e=>{o.onload=function(){const a=document.createElement("canvas"),i=a.getContext("2d");a.width=o.width,a.height=o.height,i.drawImage(o,0,0);const c=a.toDataURL("image/png");t.file("".concat(g[n].replace(/:/g,"-"),"(").concat(n,").png"),c.split(",")[1],{base64:!0}),e()}});a.push(i)}),Promise.all(a).then(()=>{t.generateAsync({type:"blob"}).then((function(e){const t=new Blob([e]),a=URL.createObjectURL(t),n=document.createElement("a");n.href=a,n.download="images.zip",n.click(),URL.revokeObjectURL(a)}))})}},"Scarica risultati"))};function f(){c.a.render(o.a.createElement(w,null),document.getElementById("root"))}f(),window.onload=function(){f()}}},[[227,1,2]]]);
//# sourceMappingURL=main.81705433.chunk.js.map