(this.webpackJsonpreactapptestausa=this.webpackJsonpreactapptestausa||[]).push([[0],{202:function(e,t){function o(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}o.keys=function(){return[]},o.resolve=o,e.exports=o,o.id=202},227:function(e,t,o){e.exports=o(252)},232:function(e,t,o){},237:function(e,t){},238:function(e,t){},246:function(e,t){},248:function(e,t){},249:function(e,t){},250:function(e,t){},251:function(e,t,o){},252:function(e,t,o){"use strict";o.r(t);var n=o(41),a=o.n(n),c=o(203),i=o.n(c),s=(o(232),o(58)),r=o(42),l=o(225),d=o.n(l);o(251),o(201);const u={1:{name:"person",color:"red"},2:{name:"cartellino",color:"yellow"},3:{name:"ThankYou",color:"lime"},4:{name:"LiveLong",color:"blue"}},g=(e,t,o,n,a,c,i,s)=>{for(let l=0;l<=e.length;l++)if(e[l]&&t[l]&&o[l]>n){const[n,d,g,h]=e[l];var r=t[l];1!==r||s?1===r&&s&&(console.log("cartellino"),console.log(e[l]),r=2,i.strokeStyle=u[r].color,i.lineWidth=5,i.fillStyle="white",i.font="30px Arial",i.beginPath(),i.fillText(u[r].name+" - "+Math.round(100*o[l])/100,d*a,n*c-10),i.rect(d*a,n*c,(h-d)*a,(g-n)*c),i.stroke()):(console.log("persona"),i.strokeStyle=u[r].color,i.lineWidth=5,i.fillStyle="white",i.font="30px Arial",i.beginPath(),i.fillText(u[r].name+" - "+Math.round(100*o[l])/100,d*a,n*c-10),i.rect(d*a,n*c,(h-d)*a,(g-n)*c),i.stroke())}};var h=[],m=[];var p=function(){const e=Object(n.useRef)(null),t=Object(n.useRef)(null),[c,i]=Object(n.useState)("webcam");var[l,u]=Object(n.useState)({width:1440,height:1080});const p=o(201);var w,f,b,v,y,x,E,C=!1,j=(new Image,[]),k=[],O=[],I=[],L=[],D=[],S=0,R=new Set;const U=document.createElement("li");var M,N,A;U.id="lista immagini",U.style.display="block",document.createElement("div").style.display="block";var B=[];async function T(e,t,o){const n=S++,a=new Image(640,480);a.src=e.src,a.id=t,a.onload=await(async function(){const e=await Promise.all(["Elon Musk","Marco","Obama"].map(async e=>{var t=[];for(E=1;E<=8;E++){const o=await s.g("/tfodreactapptest"+"/labels/".concat(e,"/").concat(E,".jpeg")),n=await s.e(o).withFaceLandmarks().withFaceDescriptor();t.push(n.descriptor)}return new s.b(e,t)})),t=new s.a(e),c=s.c(a),i={width:640,height:480};s.h(c,i);const r=await s.d(a).withFaceLandmarks().withFaceDescriptors(),l=s.j(r,i),d=l.map(e=>t.findBestMatch(e.descriptor));console.log(d.length);var u=0;if(0!==d.length){if(l.length>=1){const e=t.findBestMatch(l[0].descriptor),i=l[0].detection.box,r=new s.f.DrawBox(i,{label:e});console.log(e),console.log(i),console.log(r),console.log(n),c.width=640,c.height=480,c.style.zIndex=10,c.id="ritaglio";const d=c.getContext("2d"),g=document.createElement("div");g.style.display="flex";let p=!0;console.log("prima "+n),!R.has(a.src)&&p&&!("undefined"===typeof a)&!("undefined"===typeof a.src)&&(console.log("dentro "+n),await d.drawImage(a,0,0),await r.draw(c),document.body.append(U),g.appendChild(c),u=document.createTextNode(a.id),A=document.createTextNode("   "+n),console.log(u),g.appendChild(u),g.appendChild(A),g.id=u.textContent,g.className="immagini",U.appendChild(g),console.log("container "+n),p=!1,R.add(a.src),h.push(c.toDataURL()),console.log(h.length),m.push(a.id),console.log(h),console.log(R.size),console.log(a.src),console.log("seconda chiamata if"),await z(a,o,c)),console.log("dopo "+n)}}else{c.width=640,c.height=480,c.style.zIndex=10,c.id="ritaglio";const e=c.getContext("2d"),t=document.createElement("div");t.style.display="flex",t.setAttribute("name","No");let i=!0;console.log("ggggggg"),!R.has(a.src)&&i&&!("undefined"===typeof a)&!("undefined"===typeof a.src)&&(console.log("dentro "+n),await e.drawImage(a,0,0),document.body.append(U),t.appendChild(c),u=document.createTextNode(a.id),A=document.createTextNode("   "+n),console.log(u),t.appendChild(u),t.appendChild(A),t.id=u.textContent,U.appendChild(t),console.log("container "+n),i=!1,R.add(a.src),await z(a,o,c),console.log("seconda chiamta else"))}})}async function z(e,t,o){console.log("inizio seconda detect"),console.log(t);const n=await r.a.fromPixels(e),a=await r.c.resizeBilinear(n,[640,480]),c=await a.cast("int32"),i=await c.expandDims(0),s=await t.executeAsync(i),l=await s[2].array(),d=await s[0].array(),u=await s[4].array();console.log(l[0]);const h=o.getContext("2d");g(l[0],d[0],u[0],.5,e.width,e.height,h,!0),console.log("fine seconda detect"),r.b(n),r.b(a),r.b(c),r.b(i),r.b(s)}async function P(e,t,o,n,a,c,i){if(e&&t&&o&&n&&a&&c){var s=document.createElement("canvas");s.width=640,s.height=480;var r=s.getContext("2d"),l=new Image(640,480);l.src=e,l.onload=async function(){await r.drawImage(l,640*t,480*o,640*n,480*a,0,0,640*n,480*a),w=await s.toDataURL("image/png"),document.getElementById("screenshot").src=w,C=!1;document.getElementById("screenshot");var e=document.createElement("img");e.src=await w,B.push(e),console.log("face recognition"),await async function(e,t,o){for(var n=0;n<e.length;n++){var a=e[n];await T(a,t,o)}}(B.slice(),c.slice(),i)}}}async function F(e,t,o,n,a,c,i,s){if(e&&i&&c&&t&&o&&n&&a)for(var r=0;r<i.length;r++)await P(i[r],t[r],o[r],n[r],a[r],c[r],s)}navigator.mediaDevices.enumerateDevices().then(e=>console.log(e));const W=async(o,n)=>{var a=document.getElementById("webcam");if("undefined"!==typeof e.current&&null!==e.current&&4===e.current.video.readyState){console.log("Pausing the webcam stream..."),e.current.video.pause(),N=((M=new Date).getHours()<10?"0"+M.getHours():M.getHours())+":"+(M.getMinutes()<10?"0"+M.getMinutes():M.getMinutes())+":"+(M.getSeconds()<10?"0"+M.getSeconds():M.getSeconds());var c=a.currentTime;console.log(c),console.log("Webcam stream paused.");const i=e.current.video,s=e.current.video.srcObject,l=e.current.video.videoWidth,d=e.current.video.videoHeight;e.current.video.width=l,e.current.video.height=d,t.current.width=l,t.current.height=d;const u=await r.a.fromPixels(i),h=await r.c.resizeBilinear(u,[640,480]),m=await h.cast("int32"),p=await m.expandDims(0),w=await o.executeAsync(p),E=await w[1].array(),S=await w[0].array(),R=await w[4].array(),U=t.current.getContext("2d");j=[],k=[],D=[],L=[],O=[],I=[],B=[],await async function(){for(var t=0;t<R[0].length;t++)if(R[0][t]>.4&&1==S[0][t])x=await e.current.getScreenshot(),j.push(x),k.push(N),C=!0,f=E[0][t][1],O.push(f),b=E[0][t][0],I.push(b),v=E[0][t][3]-E[0][t][1],L.push(v),y=E[0][t][2]-E[0][t][0],D.push(y);else if(C){await F(C,O.slice(),I.slice(),L.slice(),D.slice(),k.slice(),j.slice(),n);break}}(),console.log(E[0][0]);g(E[0],S[0],R[0],.4,l,d,U,!1),34.48===c&&(c=0),e.current.video.srcObject=null,a.currentTime=await c,e.current.video.srcObject=await s,r.b(u),r.b(h),r.b(m),r.b(p),r.b(w)}return x};return Object(n.useEffect)(()=>{(async()=>{const e=await r.d("https://testtfodausa.s3.eu-de.cloud-object-storage.appdomain.cloud/model.json"),t=await r.d("https://testtfodappcartellino.s3.eu-de.cloud-object-storage.appdomain.cloud/model.json");Promise.all([s.i.ssdMobilenetv1.loadFromUri("/tfodreactapptest/models"),s.i.faceLandmark68Net.loadFromUri("/tfodreactapptest/models"),s.i.faceRecognitionNet.loadFromUri("/tfodreactapptest/models")]),setInterval(()=>{W(e,t)},5e3)})()},[]),a.a.createElement("div",{className:"App"},a.a.createElement("header",{className:"App-header"},a.a.createElement(d.a,{ref:e,videoConstraints:l,id:"webcam",muted:!0,style:{position:"absolute",marginLeft:"auto",marginRight:"auto",left:0,right:0,textAlign:"center",zindex:9,width:640,height:480}}),a.a.createElement("canvas",{ref:t,style:{position:"absolute",marginLeft:"auto",marginRight:"auto",left:0,right:0,textAlign:"center",zindex:8,width:640,height:480}}),a.a.createElement("img",{id:"screenshot",alt:"Screenshot",style:{width:640,height:480}})),a.a.createElement("button",{onClick:function(){var t=document.getElementById("webcam");e.current.video.srcObject&&(e.current.video.pause(),e.current.video.srcObject=null,t.src="/tfodreactapptest/video/alley.mp4",t.width=640,t.height=480,t.style.width="640px",t.style.height="480px",t.style.aspectRatio="4 / 3",t.play())}},"Test video 1"),a.a.createElement("button",{onClick:function(){var t=e.current.video;if(!t.srcObject){const e={video:{width:1440,height:1080}};navigator.mediaDevices.getUserMedia(e).then(e=>{t.srcObject=e,t.width=1440,t.height=1080,t.play(),i("webcam")}).catch(e=>{console.error("Error accessing webcam:",e)})}}},"Attiva Webcam"),a.a.createElement("button",{onClick:function(){const e=h;console.log(e),console.log(e.length),console.log(m.length),console.log(m);const t=new p,o=[];e.forEach((e,n)=>{const a=new Image;a.src=e;const c=new Promise(e=>{a.onload=function(){const o=document.createElement("canvas"),c=o.getContext("2d");o.width=a.width,o.height=a.height,c.drawImage(a,0,0);const i=o.toDataURL("image/png");console.log(n),console.log(m[n]),t.file("".concat(m[n].replace(/:/g,"-"),"(").concat(n,").png"),i.split(",")[1],{base64:!0}),e()}});o.push(c)}),Promise.all(o).then(()=>{t.generateAsync({type:"blob"}).then((function(e){const t=new Blob([e]),o=URL.createObjectURL(t),n=document.createElement("a");n.href=o,n.download="images.zip",n.click(),URL.revokeObjectURL(o)}))})}},"Scarica risultati"))};function w(){i.a.render(a.a.createElement(p,null),document.getElementById("root"))}w(),window.onload=function(){w()}}},[[227,1,2]]]);
//# sourceMappingURL=main.745aace6.chunk.js.map